begin_unit
comment|'#!/usr/bin/env python'
nl|'\n'
nl|'\n'
comment|'# Copyright (c) 2009 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'conch'
op|'.'
name|'ssh'
name|'import'
name|'transport'
op|','
name|'userauth'
op|','
name|'connection'
op|','
name|'common'
op|','
name|'keys'
op|','
name|'channel'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'defer'
op|','
name|'protocol'
op|','
name|'reactor'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'log'
newline|'\n'
name|'import'
name|'struct'
op|','
name|'sys'
op|','
name|'getpass'
op|','
name|'os'
newline|'\n'
nl|'\n'
DECL|variable|USER
name|'USER'
op|'='
string|"'z3p'"
comment|'# replace this with a valid username'
newline|'\n'
DECL|variable|HOST
name|'HOST'
op|'='
string|"'localhost'"
comment|'# and a valid host'
newline|'\n'
nl|'\n'
DECL|class|SimpleTransport
name|'class'
name|'SimpleTransport'
op|'('
name|'transport'
op|'.'
name|'SSHClientTransport'
op|')'
op|':'
newline|'\n'
DECL|member|verifyHostKey
indent|'    '
name|'def'
name|'verifyHostKey'
op|'('
name|'self'
op|','
name|'hostKey'
op|','
name|'fingerprint'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'host key fingerprint: %s'"
op|'%'
name|'fingerprint'
newline|'\n'
name|'return'
name|'defer'
op|'.'
name|'succeed'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|connectionSecure
dedent|''
name|'def'
name|'connectionSecure'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'requestService'
op|'('
nl|'\n'
name|'SimpleUserAuth'
op|'('
name|'USER'
op|','
nl|'\n'
name|'SimpleConnection'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|class|SimpleUserAuth
dedent|''
dedent|''
name|'class'
name|'SimpleUserAuth'
op|'('
name|'userauth'
op|'.'
name|'SSHUserAuthClient'
op|')'
op|':'
newline|'\n'
DECL|member|getPassword
indent|'    '
name|'def'
name|'getPassword'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'defer'
op|'.'
name|'succeed'
op|'('
name|'getpass'
op|'.'
name|'getpass'
op|'('
string|'"%s@%s\'s password: "'
op|'%'
op|'('
name|'USER'
op|','
name|'HOST'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getGenericAnswers
dedent|''
name|'def'
name|'getGenericAnswers'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'instruction'
op|','
name|'questions'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
name|'name'
newline|'\n'
name|'print'
name|'instruction'
newline|'\n'
name|'answers'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'prompt'
op|','
name|'echo'
name|'in'
name|'questions'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'echo'
op|':'
newline|'\n'
indent|'                '
name|'answer'
op|'='
name|'raw_input'
op|'('
name|'prompt'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'answer'
op|'='
name|'getpass'
op|'.'
name|'getpass'
op|'('
name|'prompt'
op|')'
newline|'\n'
dedent|''
name|'answers'
op|'.'
name|'append'
op|'('
name|'answer'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'defer'
op|'.'
name|'succeed'
op|'('
name|'answers'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getPublicKey
dedent|''
name|'def'
name|'getPublicKey'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'expanduser'
op|'('
string|"'~/.ssh/id_dsa'"
op|')'
newline|'\n'
comment|'# this works with rsa too'
nl|'\n'
comment|'# just change the name here and in getPrivateKey'
nl|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'path'
op|')'
name|'or'
name|'self'
op|'.'
name|'lastPublicKey'
op|':'
newline|'\n'
comment|"# the file doesn't exist, or we've tried a public key"
nl|'\n'
indent|'            '
name|'return'
newline|'\n'
dedent|''
name|'return'
name|'keys'
op|'.'
name|'getPublicKeyString'
op|'('
name|'path'
op|'+'
string|"'.pub'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|getPrivateKey
dedent|''
name|'def'
name|'getPrivateKey'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'expanduser'
op|'('
string|"'~/.ssh/id_dsa'"
op|')'
newline|'\n'
name|'return'
name|'defer'
op|'.'
name|'succeed'
op|'('
name|'keys'
op|'.'
name|'getPrivateKeyObject'
op|'('
name|'path'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|class|SimpleConnection
dedent|''
dedent|''
name|'class'
name|'SimpleConnection'
op|'('
name|'connection'
op|'.'
name|'SSHConnection'
op|')'
op|':'
newline|'\n'
DECL|member|serviceStarted
indent|'    '
name|'def'
name|'serviceStarted'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'openChannel'
op|'('
name|'TrueChannel'
op|'('
number|'2'
op|'**'
number|'16'
op|','
number|'2'
op|'**'
number|'15'
op|','
name|'self'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'openChannel'
op|'('
name|'FalseChannel'
op|'('
number|'2'
op|'**'
number|'16'
op|','
number|'2'
op|'**'
number|'15'
op|','
name|'self'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'openChannel'
op|'('
name|'CatChannel'
op|'('
number|'2'
op|'**'
number|'16'
op|','
number|'2'
op|'**'
number|'15'
op|','
name|'self'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|class|TrueChannel
dedent|''
dedent|''
name|'class'
name|'TrueChannel'
op|'('
name|'channel'
op|'.'
name|'SSHChannel'
op|')'
op|':'
newline|'\n'
DECL|variable|name
indent|'    '
name|'name'
op|'='
string|"'session'"
comment|'# needed for commands'
newline|'\n'
nl|'\n'
DECL|member|openFailed
name|'def'
name|'openFailed'
op|'('
name|'self'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'true failed'"
op|','
name|'reason'
newline|'\n'
nl|'\n'
DECL|member|channelOpen
dedent|''
name|'def'
name|'channelOpen'
op|'('
name|'self'
op|','
name|'ignoredData'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'conn'
op|'.'
name|'sendRequest'
op|'('
name|'self'
op|','
string|"'exec'"
op|','
name|'common'
op|'.'
name|'NS'
op|'('
string|"'true'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|request_exit_status
dedent|''
name|'def'
name|'request_exit_status'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'status'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'>L'"
op|','
name|'data'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'print'
string|"'true status was: %s'"
op|'%'
name|'status'
newline|'\n'
name|'self'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|class|FalseChannel
dedent|''
dedent|''
name|'class'
name|'FalseChannel'
op|'('
name|'channel'
op|'.'
name|'SSHChannel'
op|')'
op|':'
newline|'\n'
DECL|variable|name
indent|'    '
name|'name'
op|'='
string|"'session'"
newline|'\n'
nl|'\n'
DECL|member|openFailed
name|'def'
name|'openFailed'
op|'('
name|'self'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'false failed'"
op|','
name|'reason'
newline|'\n'
nl|'\n'
DECL|member|channelOpen
dedent|''
name|'def'
name|'channelOpen'
op|'('
name|'self'
op|','
name|'ignoredData'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'conn'
op|'.'
name|'sendRequest'
op|'('
name|'self'
op|','
string|"'exec'"
op|','
name|'common'
op|'.'
name|'NS'
op|'('
string|"'false'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|request_exit_status
dedent|''
name|'def'
name|'request_exit_status'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'status'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'>L'"
op|','
name|'data'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'print'
string|"'false status was: %s'"
op|'%'
name|'status'
newline|'\n'
name|'self'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|class|CatChannel
dedent|''
dedent|''
name|'class'
name|'CatChannel'
op|'('
name|'channel'
op|'.'
name|'SSHChannel'
op|')'
op|':'
newline|'\n'
DECL|variable|name
indent|'    '
name|'name'
op|'='
string|"'session'"
newline|'\n'
nl|'\n'
DECL|member|openFailed
name|'def'
name|'openFailed'
op|'('
name|'self'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'echo failed'"
op|','
name|'reason'
newline|'\n'
nl|'\n'
DECL|member|channelOpen
dedent|''
name|'def'
name|'channelOpen'
op|'('
name|'self'
op|','
name|'ignoredData'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'data'
op|'='
string|"''"
newline|'\n'
name|'d'
op|'='
name|'self'
op|'.'
name|'conn'
op|'.'
name|'sendRequest'
op|'('
name|'self'
op|','
string|"'exec'"
op|','
name|'common'
op|'.'
name|'NS'
op|'('
string|"'cat'"
op|')'
op|','
name|'wantReply'
op|'='
number|'1'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbRequest'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_cbRequest
dedent|''
name|'def'
name|'_cbRequest'
op|'('
name|'self'
op|','
name|'ignored'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'write'
op|'('
string|"'hello conch\\n'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conn'
op|'.'
name|'sendEOF'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|dataReceived
dedent|''
name|'def'
name|'dataReceived'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'data'
op|'+='
name|'data'
newline|'\n'
nl|'\n'
DECL|member|closed
dedent|''
name|'def'
name|'closed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'got data from cat: %s'"
op|'%'
name|'repr'
op|'('
name|'self'
op|'.'
name|'data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'stop'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'protocol'
op|'.'
name|'ClientCreator'
op|'('
name|'reactor'
op|','
name|'SimpleTransport'
op|')'
op|'.'
name|'connectTCP'
op|'('
name|'HOST'
op|','
number|'22'
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'run'
op|'('
op|')'
newline|'\n'
endmarker|''
end_unit
