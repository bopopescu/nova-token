begin_unit
comment|'#!/usr/bin/env python'
nl|'\n'
nl|'\n'
comment|'# Copyright (c) 2009 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'spread'
name|'import'
name|'pb'
op|','
name|'jelly'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'log'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
nl|'\n'
DECL|class|MyException
name|'class'
name|'MyException'
op|'('
name|'pb'
op|'.'
name|'Error'
op|')'
op|':'
name|'pass'
newline|'\n'
DECL|class|MyOtherException
name|'class'
name|'MyOtherException'
op|'('
name|'pb'
op|'.'
name|'Error'
op|')'
op|':'
name|'pass'
newline|'\n'
nl|'\n'
DECL|class|ScaryObject
name|'class'
name|'ScaryObject'
op|':'
newline|'\n'
comment|'# not safe for serialization'
nl|'\n'
indent|'    '
name|'pass'
newline|'\n'
nl|'\n'
DECL|function|worksLike
dedent|''
name|'def'
name|'worksLike'
op|'('
name|'obj'
op|')'
op|':'
newline|'\n'
comment|'# the callback/errback sequence in class One works just like an'
nl|'\n'
comment|'# asynchronous version of the following:'
nl|'\n'
indent|'    '
name|'try'
op|':'
newline|'\n'
indent|'        '
name|'response'
op|'='
name|'obj'
op|'.'
name|'callMethod'
op|'('
name|'name'
op|','
name|'arg'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'pb'
op|'.'
name|'DeadReferenceError'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'" stale reference: the client disconnected or crashed"'
newline|'\n'
dedent|''
name|'except'
name|'jelly'
op|'.'
name|'InsecureJelly'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'" InsecureJelly: you tried to send something unsafe to them"'
newline|'\n'
dedent|''
name|'except'
op|'('
name|'MyException'
op|','
name|'MyOtherException'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'" remote raised a MyException"'
comment|'# or MyOtherException'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'" something else happened"'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'" method successful, response:"'
op|','
name|'response'
newline|'\n'
nl|'\n'
DECL|class|One
dedent|''
dedent|''
name|'class'
name|'One'
op|':'
newline|'\n'
DECL|member|worked
indent|'    '
name|'def'
name|'worked'
op|'('
name|'self'
op|','
name|'response'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'" method successful, response:"'
op|','
name|'response'
newline|'\n'
DECL|member|check_InsecureJelly
dedent|''
name|'def'
name|'check_InsecureJelly'
op|'('
name|'self'
op|','
name|'failure'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'failure'
op|'.'
name|'trap'
op|'('
name|'jelly'
op|'.'
name|'InsecureJelly'
op|')'
newline|'\n'
name|'print'
string|'" InsecureJelly: you tried to send something unsafe to them"'
newline|'\n'
name|'return'
name|'None'
newline|'\n'
DECL|member|check_MyException
dedent|''
name|'def'
name|'check_MyException'
op|'('
name|'self'
op|','
name|'failure'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'which'
op|'='
name|'failure'
op|'.'
name|'trap'
op|'('
name|'MyException'
op|','
name|'MyOtherException'
op|')'
newline|'\n'
name|'if'
name|'which'
op|'=='
name|'MyException'
op|':'
newline|'\n'
indent|'            '
name|'print'
string|'" remote raised a MyException"'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'print'
string|'" remote raised a MyOtherException"'
newline|'\n'
dedent|''
name|'return'
name|'None'
newline|'\n'
DECL|member|catch_everythingElse
dedent|''
name|'def'
name|'catch_everythingElse'
op|'('
name|'self'
op|','
name|'failure'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'" something else happened"'
newline|'\n'
name|'log'
op|'.'
name|'err'
op|'('
name|'failure'
op|')'
newline|'\n'
name|'return'
name|'None'
newline|'\n'
nl|'\n'
DECL|member|doCall
dedent|''
name|'def'
name|'doCall'
op|'('
name|'self'
op|','
name|'explanation'
op|','
name|'arg'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
name|'explanation'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'deferred'
op|'='
name|'self'
op|'.'
name|'remote'
op|'.'
name|'callRemote'
op|'('
string|'"fooMethod"'
op|','
name|'arg'
op|')'
newline|'\n'
name|'deferred'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'worked'
op|')'
newline|'\n'
name|'deferred'
op|'.'
name|'addErrback'
op|'('
name|'self'
op|'.'
name|'check_InsecureJelly'
op|')'
newline|'\n'
name|'deferred'
op|'.'
name|'addErrback'
op|'('
name|'self'
op|'.'
name|'check_MyException'
op|')'
newline|'\n'
name|'deferred'
op|'.'
name|'addErrback'
op|'('
name|'self'
op|'.'
name|'catch_everythingElse'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'pb'
op|'.'
name|'DeadReferenceError'
op|':'
newline|'\n'
indent|'            '
name|'print'
string|'" stale reference: the client disconnected or crashed"'
newline|'\n'
nl|'\n'
DECL|member|callOne
dedent|''
dedent|''
name|'def'
name|'callOne'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'doCall'
op|'('
string|'"callOne: call with safe object"'
op|','
string|'"safe string"'
op|')'
newline|'\n'
DECL|member|callTwo
dedent|''
name|'def'
name|'callTwo'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'doCall'
op|'('
string|'"callTwo: call with dangerous object"'
op|','
name|'ScaryObject'
op|'('
op|')'
op|')'
newline|'\n'
DECL|member|callThree
dedent|''
name|'def'
name|'callThree'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'doCall'
op|'('
string|'"callThree: call that raises remote exception"'
op|','
string|'"panic!"'
op|')'
newline|'\n'
DECL|member|callShutdown
dedent|''
name|'def'
name|'callShutdown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"telling them to shut down"'
newline|'\n'
name|'self'
op|'.'
name|'remote'
op|'.'
name|'callRemote'
op|'('
string|'"shutdown"'
op|')'
newline|'\n'
DECL|member|callFour
dedent|''
name|'def'
name|'callFour'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'doCall'
op|'('
string|'"callFour: call on stale reference"'
op|','
string|'"dummy"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|got_obj
dedent|''
name|'def'
name|'got_obj'
op|'('
name|'self'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'remote'
op|'='
name|'obj'
newline|'\n'
name|'reactor'
op|'.'
name|'callLater'
op|'('
number|'1'
op|','
name|'self'
op|'.'
name|'callOne'
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'callLater'
op|'('
number|'2'
op|','
name|'self'
op|'.'
name|'callTwo'
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'callLater'
op|'('
number|'3'
op|','
name|'self'
op|'.'
name|'callThree'
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'callLater'
op|'('
number|'4'
op|','
name|'self'
op|'.'
name|'callShutdown'
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'callLater'
op|'('
number|'5'
op|','
name|'self'
op|'.'
name|'callFour'
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'callLater'
op|'('
number|'6'
op|','
name|'reactor'
op|'.'
name|'stop'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|factory
dedent|''
dedent|''
name|'factory'
op|'='
name|'pb'
op|'.'
name|'PBClientFactory'
op|'('
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'connectTCP'
op|'('
string|'"localhost"'
op|','
number|'8800'
op|','
name|'factory'
op|')'
newline|'\n'
DECL|variable|deferred
name|'deferred'
op|'='
name|'factory'
op|'.'
name|'getRootObject'
op|'('
op|')'
newline|'\n'
name|'deferred'
op|'.'
name|'addCallback'
op|'('
name|'One'
op|'('
op|')'
op|'.'
name|'got_obj'
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'run'
op|'('
op|')'
newline|'\n'
endmarker|''
end_unit
