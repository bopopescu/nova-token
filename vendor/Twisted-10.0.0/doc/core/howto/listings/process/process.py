begin_unit
comment|'#!/usr/bin/env python'
nl|'\n'
nl|'\n'
comment|'# Copyright (c) 2009-2010 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'protocol'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
name|'import'
name|'re'
newline|'\n'
nl|'\n'
DECL|class|MyPP
name|'class'
name|'MyPP'
op|'('
name|'protocol'
op|'.'
name|'ProcessProtocol'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'verses'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'verses'
op|'='
name|'verses'
newline|'\n'
name|'self'
op|'.'
name|'data'
op|'='
string|'""'
newline|'\n'
DECL|member|connectionMade
dedent|''
name|'def'
name|'connectionMade'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"connectionMade!"'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'self'
op|'.'
name|'verses'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'transport'
op|'.'
name|'write'
op|'('
string|'"Aleph-null bottles of beer on the wall,\\n"'
op|'+'
nl|'\n'
string|'"Aleph-null bottles of beer,\\n"'
op|'+'
nl|'\n'
string|'"Take one down and pass it around,\\n"'
op|'+'
nl|'\n'
string|'"Aleph-null bottles of beer on the wall.\\n"'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'transport'
op|'.'
name|'closeStdin'
op|'('
op|')'
comment|"# tell them we're done"
newline|'\n'
DECL|member|outReceived
dedent|''
name|'def'
name|'outReceived'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"outReceived! with %d bytes!"'
op|'%'
name|'len'
op|'('
name|'data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'data'
op|'='
name|'self'
op|'.'
name|'data'
op|'+'
name|'data'
newline|'\n'
DECL|member|errReceived
dedent|''
name|'def'
name|'errReceived'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"errReceived! with %d bytes!"'
op|'%'
name|'len'
op|'('
name|'data'
op|')'
newline|'\n'
DECL|member|inConnectionLost
dedent|''
name|'def'
name|'inConnectionLost'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"inConnectionLost! stdin is closed! (we probably did it)"'
newline|'\n'
DECL|member|outConnectionLost
dedent|''
name|'def'
name|'outConnectionLost'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"outConnectionLost! The child closed their stdout!"'
newline|'\n'
comment|'# now is the time to examine what they wrote'
nl|'\n'
comment|'#print "I saw them write:", self.data'
nl|'\n'
op|'('
name|'dummy'
op|','
name|'lines'
op|','
name|'words'
op|','
name|'chars'
op|','
name|'file'
op|')'
op|'='
name|'re'
op|'.'
name|'split'
op|'('
string|"r'\\s+'"
op|','
name|'self'
op|'.'
name|'data'
op|')'
newline|'\n'
name|'print'
string|'"I saw %s lines"'
op|'%'
name|'lines'
newline|'\n'
DECL|member|errConnectionLost
dedent|''
name|'def'
name|'errConnectionLost'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"errConnectionLost! The child closed their stderr."'
newline|'\n'
DECL|member|processExited
dedent|''
name|'def'
name|'processExited'
op|'('
name|'self'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"processExited, status %d"'
op|'%'
op|'('
name|'reason'
op|'.'
name|'value'
op|'.'
name|'exitCode'
op|','
op|')'
newline|'\n'
DECL|member|processEnded
dedent|''
name|'def'
name|'processEnded'
op|'('
name|'self'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"processEnded, status %d"'
op|'%'
op|'('
name|'reason'
op|'.'
name|'value'
op|'.'
name|'exitCode'
op|','
op|')'
newline|'\n'
name|'print'
string|'"quitting"'
newline|'\n'
name|'reactor'
op|'.'
name|'stop'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|variable|pp
dedent|''
dedent|''
name|'pp'
op|'='
name|'MyPP'
op|'('
number|'10'
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'spawnProcess'
op|'('
name|'pp'
op|','
string|'"wc"'
op|','
op|'['
string|'"wc"'
op|']'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'run'
op|'('
op|')'
newline|'\n'
endmarker|''
end_unit
