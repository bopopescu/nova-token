begin_unit
comment|'#!/usr/bin/env python'
nl|'\n'
nl|'\n'
comment|'# Copyright (c) 2009 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'defer'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'failure'
op|','
name|'util'
newline|'\n'
nl|'\n'
string|'"""\nThe deferred callback chain is stateful, and can be executed before\nor after all callbacks have been added to the chain\n"""'
newline|'\n'
nl|'\n'
DECL|class|Counter
name|'class'
name|'Counter'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|variable|num
indent|'    '
name|'num'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|function|handleFailure
dedent|''
name|'def'
name|'handleFailure'
op|'('
name|'f'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'print'
string|'"errback"'
newline|'\n'
name|'print'
string|'"we got an exception: %s"'
op|'%'
op|'('
name|'f'
op|'.'
name|'getTraceback'
op|'('
op|')'
op|','
op|')'
newline|'\n'
name|'f'
op|'.'
name|'trap'
op|'('
name|'RuntimeError'
op|')'
newline|'\n'
nl|'\n'
DECL|function|handleResult
dedent|''
name|'def'
name|'handleResult'
op|'('
name|'result'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'Counter'
op|'.'
name|'num'
op|'+='
number|'1'
newline|'\n'
name|'print'
string|'"callback %s"'
op|'%'
op|'('
name|'Counter'
op|'.'
name|'num'
op|','
op|')'
newline|'\n'
name|'print'
string|'"\\tgot result: %s"'
op|'%'
op|'('
name|'result'
op|','
op|')'
newline|'\n'
name|'return'
string|'"yay! handleResult was successful!"'
newline|'\n'
nl|'\n'
DECL|function|failAtHandlingResult
dedent|''
name|'def'
name|'failAtHandlingResult'
op|'('
name|'result'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'Counter'
op|'.'
name|'num'
op|'+='
number|'1'
newline|'\n'
name|'print'
string|'"callback %s"'
op|'%'
op|'('
name|'Counter'
op|'.'
name|'num'
op|','
op|')'
newline|'\n'
name|'print'
string|'"\\tgot result: %s"'
op|'%'
op|'('
name|'result'
op|','
op|')'
newline|'\n'
name|'print'
string|'"\\tabout to raise exception"'
newline|'\n'
name|'raise'
name|'RuntimeError'
op|','
string|'"whoops! we encountered an error"'
newline|'\n'
nl|'\n'
DECL|function|deferredExample1
dedent|''
name|'def'
name|'deferredExample1'
op|'('
op|')'
op|':'
newline|'\n'
comment|'# this is another common idiom, since all add* methods'
nl|'\n'
comment|'# return the deferred instance, you can just chain your'
nl|'\n'
comment|'# calls to addCallback and addErrback'
nl|'\n'
nl|'\n'
indent|'    '
name|'d'
op|'='
name|'defer'
op|'.'
name|'Deferred'
op|'('
op|')'
op|'.'
name|'addCallback'
op|'('
name|'failAtHandlingResult'
nl|'\n'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'handleResult'
nl|'\n'
op|')'
op|'.'
name|'addErrback'
op|'('
name|'handleFailure'
op|')'
newline|'\n'
nl|'\n'
name|'d'
op|'.'
name|'callback'
op|'('
string|'"success"'
op|')'
newline|'\n'
nl|'\n'
DECL|function|deferredExample2
dedent|''
name|'def'
name|'deferredExample2'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'d'
op|'='
name|'defer'
op|'.'
name|'Deferred'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'d'
op|'.'
name|'callback'
op|'('
string|'"success"'
op|')'
newline|'\n'
nl|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'failAtHandlingResult'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'handleResult'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addErrback'
op|'('
name|'handleFailure'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'deferredExample1'
op|'('
op|')'
newline|'\n'
name|'print'
string|'"\\n-------------------------------------------------\\n"'
newline|'\n'
name|'Counter'
op|'.'
name|'num'
op|'='
number|'0'
newline|'\n'
name|'deferredExample2'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
endmarker|''
end_unit
