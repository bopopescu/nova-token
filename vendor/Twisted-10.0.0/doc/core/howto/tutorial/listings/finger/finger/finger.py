begin_unit
comment|'# finger.py module'
nl|'\n'
nl|'\n'
name|'from'
name|'zope'
op|'.'
name|'interface'
name|'import'
name|'Interface'
op|','
name|'implements'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'application'
name|'import'
name|'internet'
op|','
name|'service'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'protocol'
op|','
name|'reactor'
op|','
name|'defer'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'words'
op|'.'
name|'protocols'
name|'import'
name|'irc'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'protocols'
name|'import'
name|'basic'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'components'
op|','
name|'log'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'web'
name|'import'
name|'resource'
op|','
name|'server'
op|','
name|'xmlrpc'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'spread'
name|'import'
name|'pb'
newline|'\n'
nl|'\n'
name|'from'
name|'OpenSSL'
name|'import'
name|'SSL'
newline|'\n'
nl|'\n'
DECL|class|IFingerService
name|'class'
name|'IFingerService'
op|'('
name|'Interface'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|getUser
indent|'    '
name|'def'
name|'getUser'
op|'('
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Return a deferred returning a string"""'
newline|'\n'
nl|'\n'
DECL|member|getUsers
dedent|''
name|'def'
name|'getUsers'
op|'('
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Return a deferred returning a list of strings"""'
newline|'\n'
nl|'\n'
DECL|class|IFingerSetterService
dedent|''
dedent|''
name|'class'
name|'IFingerSetterService'
op|'('
name|'Interface'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUser
indent|'    '
name|'def'
name|'setUser'
op|'('
name|'user'
op|','
name|'status'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Set the user\'s status to something"""'
newline|'\n'
nl|'\n'
DECL|function|catchError
dedent|''
dedent|''
name|'def'
name|'catchError'
op|'('
name|'err'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
string|'"Internal error in server"'
newline|'\n'
nl|'\n'
DECL|class|FingerProtocol
dedent|''
name|'class'
name|'FingerProtocol'
op|'('
name|'basic'
op|'.'
name|'LineReceiver'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|lineReceived
indent|'    '
name|'def'
name|'lineReceived'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'factory'
op|'.'
name|'getUser'
op|'('
name|'user'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addErrback'
op|'('
name|'catchError'
op|')'
newline|'\n'
DECL|function|writeValue
name|'def'
name|'writeValue'
op|'('
name|'value'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'transport'
op|'.'
name|'write'
op|'('
name|'value'
op|'+'
string|"'\\n'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
dedent|''
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'writeValue'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|IFingerFactory
dedent|''
dedent|''
name|'class'
name|'IFingerFactory'
op|'('
name|'Interface'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|getUser
indent|'    '
name|'def'
name|'getUser'
op|'('
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Return a deferred returning a string"""'
newline|'\n'
nl|'\n'
DECL|member|buildProtocol
dedent|''
name|'def'
name|'buildProtocol'
op|'('
name|'addr'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Return a protocol returning a string"""'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FingerFactoryFromService
dedent|''
dedent|''
name|'class'
name|'FingerFactoryFromService'
op|'('
name|'protocol'
op|'.'
name|'ServerFactory'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'implements'
op|'('
name|'IFingerFactory'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|protocol
name|'protocol'
op|'='
name|'FingerProtocol'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'service'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'service'
op|'='
name|'service'
newline|'\n'
nl|'\n'
DECL|member|getUser
dedent|''
name|'def'
name|'getUser'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'service'
op|'.'
name|'getUser'
op|'('
name|'user'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'components'
op|'.'
name|'registerAdapter'
op|'('
name|'FingerFactoryFromService'
op|','
nl|'\n'
name|'IFingerService'
op|','
nl|'\n'
name|'IFingerFactory'
op|')'
newline|'\n'
nl|'\n'
DECL|class|FingerSetterProtocol
name|'class'
name|'FingerSetterProtocol'
op|'('
name|'basic'
op|'.'
name|'LineReceiver'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|connectionMade
indent|'    '
name|'def'
name|'connectionMade'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'lines'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|member|lineReceived
dedent|''
name|'def'
name|'lineReceived'
op|'('
name|'self'
op|','
name|'line'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'lines'
op|'.'
name|'append'
op|'('
name|'line'
op|')'
newline|'\n'
nl|'\n'
DECL|member|connectionLost
dedent|''
name|'def'
name|'connectionLost'
op|'('
name|'self'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'lines'
op|')'
op|'=='
number|'2'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'factory'
op|'.'
name|'setUser'
op|'('
op|'*'
name|'self'
op|'.'
name|'lines'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|IFingerSetterFactory
dedent|''
dedent|''
dedent|''
name|'class'
name|'IFingerSetterFactory'
op|'('
name|'Interface'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUser
indent|'    '
name|'def'
name|'setUser'
op|'('
name|'user'
op|','
name|'status'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Return a deferred returning a string"""'
newline|'\n'
nl|'\n'
DECL|member|buildProtocol
dedent|''
name|'def'
name|'buildProtocol'
op|'('
name|'addr'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Return a protocol returning a string"""'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FingerSetterFactoryFromService
dedent|''
dedent|''
name|'class'
name|'FingerSetterFactoryFromService'
op|'('
name|'protocol'
op|'.'
name|'ServerFactory'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'implements'
op|'('
name|'IFingerSetterFactory'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|protocol
name|'protocol'
op|'='
name|'FingerSetterProtocol'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'service'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'service'
op|'='
name|'service'
newline|'\n'
nl|'\n'
DECL|member|setUser
dedent|''
name|'def'
name|'setUser'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'status'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'service'
op|'.'
name|'setUser'
op|'('
name|'user'
op|','
name|'status'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'components'
op|'.'
name|'registerAdapter'
op|'('
name|'FingerSetterFactoryFromService'
op|','
nl|'\n'
name|'IFingerSetterService'
op|','
nl|'\n'
name|'IFingerSetterFactory'
op|')'
newline|'\n'
nl|'\n'
DECL|class|IRCReplyBot
name|'class'
name|'IRCReplyBot'
op|'('
name|'irc'
op|'.'
name|'IRCClient'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|connectionMade
indent|'    '
name|'def'
name|'connectionMade'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'nickname'
op|'='
name|'self'
op|'.'
name|'factory'
op|'.'
name|'nickname'
newline|'\n'
name|'irc'
op|'.'
name|'IRCClient'
op|'.'
name|'connectionMade'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|privmsg
dedent|''
name|'def'
name|'privmsg'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'channel'
op|','
name|'msg'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|'='
name|'user'
op|'.'
name|'split'
op|'('
string|"'!'"
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'nickname'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
name|'channel'
op|'.'
name|'lower'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'d'
op|'='
name|'self'
op|'.'
name|'factory'
op|'.'
name|'getUser'
op|'('
name|'msg'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addErrback'
op|'('
name|'catchError'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'lambda'
name|'m'
op|':'
string|'"Status of %s: %s"'
op|'%'
op|'('
name|'msg'
op|','
name|'m'
op|')'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'lambda'
name|'m'
op|':'
name|'self'
op|'.'
name|'msg'
op|'('
name|'user'
op|','
name|'m'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|IIRCClientFactory
dedent|''
dedent|''
dedent|''
name|'class'
name|'IIRCClientFactory'
op|'('
name|'Interface'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
string|'"""\n    @ivar nickname\n    """'
newline|'\n'
nl|'\n'
DECL|member|getUser
name|'def'
name|'getUser'
op|'('
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Return a deferred returning a string"""'
newline|'\n'
nl|'\n'
DECL|member|buildProtocol
dedent|''
name|'def'
name|'buildProtocol'
op|'('
name|'addr'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Return a protocol"""'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|IRCClientFactoryFromService
dedent|''
dedent|''
name|'class'
name|'IRCClientFactoryFromService'
op|'('
name|'protocol'
op|'.'
name|'ClientFactory'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'implements'
op|'('
name|'IIRCClientFactory'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|protocol
name|'protocol'
op|'='
name|'IRCReplyBot'
newline|'\n'
DECL|variable|nickname
name|'nickname'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'service'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'service'
op|'='
name|'service'
newline|'\n'
nl|'\n'
DECL|member|getUser
dedent|''
name|'def'
name|'getUser'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'service'
op|'.'
name|'getUser'
op|'('
name|'user'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'components'
op|'.'
name|'registerAdapter'
op|'('
name|'IRCClientFactoryFromService'
op|','
nl|'\n'
name|'IFingerService'
op|','
nl|'\n'
name|'IIRCClientFactory'
op|')'
newline|'\n'
nl|'\n'
DECL|class|UserStatusTree
name|'class'
name|'UserStatusTree'
op|'('
name|'resource'
op|'.'
name|'Resource'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'template'
op|'='
string|'"""<html><head><title>Users</title></head><body>\n    <h1>Users</h1>\n    <ul>\n    %(users)s\n    </ul>\n    </body>\n    </html>"""'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'service'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resource'
op|'.'
name|'Resource'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'service'
op|'='
name|'service'
newline|'\n'
nl|'\n'
DECL|member|getChild
dedent|''
name|'def'
name|'getChild'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'request'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'path'
op|'=='
string|"''"
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
newline|'\n'
dedent|''
name|'elif'
name|'path'
op|'=='
string|"'RPC2'"
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'UserStatusXR'
op|'('
name|'self'
op|'.'
name|'service'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'UserStatus'
op|'('
name|'path'
op|','
name|'self'
op|'.'
name|'service'
op|')'
newline|'\n'
nl|'\n'
DECL|member|render_GET
dedent|''
dedent|''
name|'def'
name|'render_GET'
op|'('
name|'self'
op|','
name|'request'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'users'
op|'='
name|'self'
op|'.'
name|'service'
op|'.'
name|'getUsers'
op|'('
op|')'
newline|'\n'
DECL|function|cbUsers
name|'def'
name|'cbUsers'
op|'('
name|'users'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'request'
op|'.'
name|'write'
op|'('
name|'self'
op|'.'
name|'template'
op|'%'
op|'{'
string|"'users'"
op|':'
string|"''"
op|'.'
name|'join'
op|'('
op|'['
nl|'\n'
comment|'# Name should be quoted properly these uses.'
nl|'\n'
string|'\'<li><a href="%s">%s</a></li>\''
op|'%'
op|'('
name|'name'
op|','
name|'name'
op|')'
nl|'\n'
name|'for'
name|'name'
name|'in'
name|'users'
op|']'
op|')'
op|'}'
op|')'
newline|'\n'
name|'request'
op|'.'
name|'finish'
op|'('
op|')'
newline|'\n'
dedent|''
name|'users'
op|'.'
name|'addCallback'
op|'('
name|'cbUsers'
op|')'
newline|'\n'
DECL|function|ebUsers
name|'def'
name|'ebUsers'
op|'('
name|'err'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'log'
op|'.'
name|'err'
op|'('
name|'err'
op|','
string|'"UserStatusTree failed"'
op|')'
newline|'\n'
name|'request'
op|'.'
name|'finish'
op|'('
op|')'
newline|'\n'
dedent|''
name|'users'
op|'.'
name|'addErrback'
op|'('
name|'ebUsers'
op|')'
newline|'\n'
name|'return'
name|'server'
op|'.'
name|'NOT_DONE_YET'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'components'
op|'.'
name|'registerAdapter'
op|'('
name|'UserStatusTree'
op|','
name|'IFingerService'
op|','
name|'resource'
op|'.'
name|'IResource'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|UserStatus
name|'class'
name|'UserStatus'
op|'('
name|'resource'
op|'.'
name|'Resource'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'template'
op|'='
string|"'''<html><head><title>%(title)s</title></head>\n    <body><h1>%(name)s</h1><p>%(status)s</p></body></html>'''"
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'service'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resource'
op|'.'
name|'Resource'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'user'
op|'='
name|'user'
newline|'\n'
name|'self'
op|'.'
name|'service'
op|'='
name|'service'
newline|'\n'
nl|'\n'
DECL|member|render_GET
dedent|''
name|'def'
name|'render_GET'
op|'('
name|'self'
op|','
name|'request'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'status'
op|'='
name|'self'
op|'.'
name|'service'
op|'.'
name|'getUser'
op|'('
name|'self'
op|'.'
name|'user'
op|')'
newline|'\n'
DECL|function|cbStatus
name|'def'
name|'cbStatus'
op|'('
name|'status'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'request'
op|'.'
name|'write'
op|'('
name|'self'
op|'.'
name|'template'
op|'%'
op|'{'
nl|'\n'
string|"'title'"
op|':'
name|'self'
op|'.'
name|'user'
op|','
nl|'\n'
string|"'name'"
op|':'
name|'self'
op|'.'
name|'user'
op|','
nl|'\n'
string|"'status'"
op|':'
name|'status'
op|'}'
op|')'
newline|'\n'
name|'request'
op|'.'
name|'finish'
op|'('
op|')'
newline|'\n'
dedent|''
name|'status'
op|'.'
name|'addCallback'
op|'('
name|'cbStatus'
op|')'
newline|'\n'
DECL|function|ebStatus
name|'def'
name|'ebStatus'
op|'('
name|'err'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'log'
op|'.'
name|'err'
op|'('
name|'err'
op|','
string|'"UserStatus failed"'
op|')'
newline|'\n'
name|'request'
op|'.'
name|'finish'
op|'('
op|')'
newline|'\n'
dedent|''
name|'status'
op|'.'
name|'addErrback'
op|'('
name|'ebStatus'
op|')'
newline|'\n'
name|'return'
name|'server'
op|'.'
name|'NOT_DONE_YET'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|UserStatusXR
dedent|''
dedent|''
name|'class'
name|'UserStatusXR'
op|'('
name|'xmlrpc'
op|'.'
name|'XMLRPC'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'service'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'xmlrpc'
op|'.'
name|'XMLRPC'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'service'
op|'='
name|'service'
newline|'\n'
nl|'\n'
DECL|member|xmlrpc_getUser
dedent|''
name|'def'
name|'xmlrpc_getUser'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'service'
op|'.'
name|'getUser'
op|'('
name|'user'
op|')'
newline|'\n'
nl|'\n'
DECL|member|xmlrpc_getUsers
dedent|''
name|'def'
name|'xmlrpc_getUsers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'service'
op|'.'
name|'getUsers'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|IPerspectiveFinger
dedent|''
dedent|''
name|'class'
name|'IPerspectiveFinger'
op|'('
name|'Interface'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|remote_getUser
indent|'    '
name|'def'
name|'remote_getUser'
op|'('
name|'username'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""return a user\'s status"""'
newline|'\n'
nl|'\n'
DECL|member|remote_getUsers
dedent|''
name|'def'
name|'remote_getUsers'
op|'('
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""return a user\'s status"""'
newline|'\n'
nl|'\n'
DECL|class|PerspectiveFingerFromService
dedent|''
dedent|''
name|'class'
name|'PerspectiveFingerFromService'
op|'('
name|'pb'
op|'.'
name|'Root'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'implements'
op|'('
name|'IPerspectiveFinger'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'service'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'service'
op|'='
name|'service'
newline|'\n'
nl|'\n'
DECL|member|remote_getUser
dedent|''
name|'def'
name|'remote_getUser'
op|'('
name|'self'
op|','
name|'username'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'service'
op|'.'
name|'getUser'
op|'('
name|'username'
op|')'
newline|'\n'
nl|'\n'
DECL|member|remote_getUsers
dedent|''
name|'def'
name|'remote_getUsers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'service'
op|'.'
name|'getUsers'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'components'
op|'.'
name|'registerAdapter'
op|'('
name|'PerspectiveFingerFromService'
op|','
nl|'\n'
name|'IFingerService'
op|','
nl|'\n'
name|'IPerspectiveFinger'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FingerService
name|'class'
name|'FingerService'
op|'('
name|'service'
op|'.'
name|'Service'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'implements'
op|'('
name|'IFingerService'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'filename'
op|'='
name|'filename'
newline|'\n'
name|'self'
op|'.'
name|'_read'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_read
dedent|''
name|'def'
name|'_read'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'users'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'file'
op|'('
name|'self'
op|'.'
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'user'
op|','
name|'status'
op|'='
name|'line'
op|'.'
name|'split'
op|'('
string|"':'"
op|','
number|'1'
op|')'
newline|'\n'
name|'user'
op|'='
name|'user'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'status'
op|'='
name|'status'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'users'
op|'['
name|'user'
op|']'
op|'='
name|'status'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'call'
op|'='
name|'reactor'
op|'.'
name|'callLater'
op|'('
number|'30'
op|','
name|'self'
op|'.'
name|'_read'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getUser
dedent|''
name|'def'
name|'getUser'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'defer'
op|'.'
name|'succeed'
op|'('
name|'self'
op|'.'
name|'users'
op|'.'
name|'get'
op|'('
name|'user'
op|','
string|'"No such user"'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getUsers
dedent|''
name|'def'
name|'getUsers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'defer'
op|'.'
name|'succeed'
op|'('
name|'self'
op|'.'
name|'users'
op|'.'
name|'keys'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ServerContextFactory
dedent|''
dedent|''
name|'class'
name|'ServerContextFactory'
op|':'
newline|'\n'
nl|'\n'
DECL|member|getContext
indent|'    '
name|'def'
name|'getContext'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Create an SSL context.\n\n        This is a sample implementation that loads a certificate from a file\n        called \'server.pem\'."""'
newline|'\n'
name|'ctx'
op|'='
name|'SSL'
op|'.'
name|'Context'
op|'('
name|'SSL'
op|'.'
name|'SSLv23_METHOD'
op|')'
newline|'\n'
name|'ctx'
op|'.'
name|'use_certificate_file'
op|'('
string|"'server.pem'"
op|')'
newline|'\n'
name|'ctx'
op|'.'
name|'use_privatekey_file'
op|'('
string|"'server.pem'"
op|')'
newline|'\n'
name|'return'
name|'ctx'
newline|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
comment|'# Easy configuration'
nl|'\n'
nl|'\n'
DECL|function|makeService
dedent|''
dedent|''
name|'def'
name|'makeService'
op|'('
name|'config'
op|')'
op|':'
newline|'\n'
comment|'# finger on port 79'
nl|'\n'
indent|'    '
name|'s'
op|'='
name|'service'
op|'.'
name|'MultiService'
op|'('
op|')'
newline|'\n'
name|'f'
op|'='
name|'FingerService'
op|'('
name|'config'
op|'['
string|"'file'"
op|']'
op|')'
newline|'\n'
name|'h'
op|'='
name|'internet'
op|'.'
name|'TCPServer'
op|'('
number|'1079'
op|','
name|'IFingerFactory'
op|'('
name|'f'
op|')'
op|')'
newline|'\n'
name|'h'
op|'.'
name|'setServiceParent'
op|'('
name|'s'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
comment|'# website on port 8000'
nl|'\n'
name|'r'
op|'='
name|'resource'
op|'.'
name|'IResource'
op|'('
name|'f'
op|')'
newline|'\n'
name|'r'
op|'.'
name|'templateDirectory'
op|'='
name|'config'
op|'['
string|"'templates'"
op|']'
newline|'\n'
name|'site'
op|'='
name|'server'
op|'.'
name|'Site'
op|'('
name|'r'
op|')'
newline|'\n'
name|'j'
op|'='
name|'internet'
op|'.'
name|'TCPServer'
op|'('
number|'8000'
op|','
name|'site'
op|')'
newline|'\n'
name|'j'
op|'.'
name|'setServiceParent'
op|'('
name|'s'
op|')'
newline|'\n'
nl|'\n'
comment|'# ssl on port 443'
nl|'\n'
comment|"#    if config.get('ssl'):"
nl|'\n'
comment|'#        k = internet.SSLServer(443, site, ServerContextFactory())'
nl|'\n'
comment|'#        k.setServiceParent(s)'
nl|'\n'
nl|'\n'
comment|'# irc fingerbot'
nl|'\n'
name|'if'
name|'config'
op|'.'
name|'has_key'
op|'('
string|"'ircnick'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'i'
op|'='
name|'IIRCClientFactory'
op|'('
name|'f'
op|')'
newline|'\n'
name|'i'
op|'.'
name|'nickname'
op|'='
name|'config'
op|'['
string|"'ircnick'"
op|']'
newline|'\n'
name|'ircserver'
op|'='
name|'config'
op|'['
string|"'ircserver'"
op|']'
newline|'\n'
name|'b'
op|'='
name|'internet'
op|'.'
name|'TCPClient'
op|'('
name|'ircserver'
op|','
number|'6667'
op|','
name|'i'
op|')'
newline|'\n'
name|'b'
op|'.'
name|'setServiceParent'
op|'('
name|'s'
op|')'
newline|'\n'
nl|'\n'
comment|'# Pespective Broker on port 8889'
nl|'\n'
dedent|''
name|'if'
name|'config'
op|'.'
name|'has_key'
op|'('
string|"'pbport'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'m'
op|'='
name|'internet'
op|'.'
name|'TCPServer'
op|'('
nl|'\n'
name|'int'
op|'('
name|'config'
op|'['
string|"'pbport'"
op|']'
op|')'
op|','
nl|'\n'
name|'pb'
op|'.'
name|'PBServerFactory'
op|'('
name|'IPerspectiveFinger'
op|'('
name|'f'
op|')'
op|')'
op|')'
newline|'\n'
name|'m'
op|'.'
name|'setServiceParent'
op|'('
name|'s'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'s'
newline|'\n'
dedent|''
endmarker|''
end_unit
