begin_unit
nl|'\n'
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
string|'"""\nAn example of using the FTP client\n"""'
newline|'\n'
nl|'\n'
comment|'# Twisted imports'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'protocols'
op|'.'
name|'ftp'
name|'import'
name|'FTPClient'
op|','
name|'FTPFileListProtocol'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
op|'.'
name|'protocol'
name|'import'
name|'Protocol'
op|','
name|'ClientCreator'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'usage'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
nl|'\n'
comment|'# Standard library imports'
nl|'\n'
name|'import'
name|'string'
newline|'\n'
name|'import'
name|'sys'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'from'
name|'cStringIO'
name|'import'
name|'StringIO'
newline|'\n'
dedent|''
name|'except'
name|'ImportError'
op|':'
newline|'\n'
indent|'    '
name|'from'
name|'StringIO'
name|'import'
name|'StringIO'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|BufferingProtocol
dedent|''
name|'class'
name|'BufferingProtocol'
op|'('
name|'Protocol'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Simple utility class that holds all data written to it in a buffer."""'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'buffer'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|dataReceived
dedent|''
name|'def'
name|'dataReceived'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'buffer'
op|'.'
name|'write'
op|'('
name|'data'
op|')'
newline|'\n'
nl|'\n'
comment|'# Define some callbacks'
nl|'\n'
nl|'\n'
DECL|function|success
dedent|''
dedent|''
name|'def'
name|'success'
op|'('
name|'response'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'print'
string|"'Success!  Got response:'"
newline|'\n'
name|'print'
string|"'---'"
newline|'\n'
name|'if'
name|'response'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'        '
name|'print'
name|'None'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'print'
name|'string'
op|'.'
name|'join'
op|'('
name|'response'
op|','
string|"'\\n'"
op|')'
newline|'\n'
dedent|''
name|'print'
string|"'---'"
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|fail
dedent|''
name|'def'
name|'fail'
op|'('
name|'error'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'print'
string|"'Failed.  Error was:'"
newline|'\n'
name|'print'
name|'error'
newline|'\n'
nl|'\n'
DECL|function|showFiles
dedent|''
name|'def'
name|'showFiles'
op|'('
name|'result'
op|','
name|'fileListProtocol'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'print'
string|"'Processed file listing:'"
newline|'\n'
name|'for'
name|'file'
name|'in'
name|'fileListProtocol'
op|'.'
name|'files'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'    %s: %d bytes, %s'"
op|'%'
op|'('
name|'file'
op|'['
string|"'filename'"
op|']'
op|','
name|'file'
op|'['
string|"'size'"
op|']'
op|','
name|'file'
op|'['
string|"'date'"
op|']'
op|')'
newline|'\n'
dedent|''
name|'print'
string|"'Total: %d files'"
op|'%'
op|'('
name|'len'
op|'('
name|'fileListProtocol'
op|'.'
name|'files'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|showBuffer
dedent|''
name|'def'
name|'showBuffer'
op|'('
name|'result'
op|','
name|'bufferProtocol'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'print'
string|"'Got data:'"
newline|'\n'
name|'print'
name|'bufferProtocol'
op|'.'
name|'buffer'
op|'.'
name|'getvalue'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|Options
dedent|''
name|'class'
name|'Options'
op|'('
name|'usage'
op|'.'
name|'Options'
op|')'
op|':'
newline|'\n'
DECL|variable|optParameters
indent|'    '
name|'optParameters'
op|'='
op|'['
op|'['
string|"'host'"
op|','
string|"'h'"
op|','
string|"'localhost'"
op|']'
op|','
nl|'\n'
op|'['
string|"'port'"
op|','
string|"'p'"
op|','
number|'21'
op|']'
op|','
nl|'\n'
op|'['
string|"'username'"
op|','
string|"'u'"
op|','
string|"'anonymous'"
op|']'
op|','
nl|'\n'
op|'['
string|"'password'"
op|','
name|'None'
op|','
string|"'twisted@'"
op|']'
op|','
nl|'\n'
op|'['
string|"'passive'"
op|','
name|'None'
op|','
number|'0'
op|']'
op|','
nl|'\n'
op|'['
string|"'debug'"
op|','
string|"'d'"
op|','
number|'1'
op|']'
op|','
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
DECL|function|run
dedent|''
name|'def'
name|'run'
op|'('
op|')'
op|':'
newline|'\n'
comment|'# Get config'
nl|'\n'
indent|'    '
name|'config'
op|'='
name|'Options'
op|'('
op|')'
newline|'\n'
name|'config'
op|'.'
name|'parseOptions'
op|'('
op|')'
newline|'\n'
name|'config'
op|'.'
name|'opts'
op|'['
string|"'port'"
op|']'
op|'='
name|'int'
op|'('
name|'config'
op|'.'
name|'opts'
op|'['
string|"'port'"
op|']'
op|')'
newline|'\n'
name|'config'
op|'.'
name|'opts'
op|'['
string|"'passive'"
op|']'
op|'='
name|'int'
op|'('
name|'config'
op|'.'
name|'opts'
op|'['
string|"'passive'"
op|']'
op|')'
newline|'\n'
name|'config'
op|'.'
name|'opts'
op|'['
string|"'debug'"
op|']'
op|'='
name|'int'
op|'('
name|'config'
op|'.'
name|'opts'
op|'['
string|"'debug'"
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Create the client'
nl|'\n'
name|'FTPClient'
op|'.'
name|'debug'
op|'='
name|'config'
op|'.'
name|'opts'
op|'['
string|"'debug'"
op|']'
newline|'\n'
name|'creator'
op|'='
name|'ClientCreator'
op|'('
name|'reactor'
op|','
name|'FTPClient'
op|','
name|'config'
op|'.'
name|'opts'
op|'['
string|"'username'"
op|']'
op|','
nl|'\n'
name|'config'
op|'.'
name|'opts'
op|'['
string|"'password'"
op|']'
op|','
name|'passive'
op|'='
name|'config'
op|'.'
name|'opts'
op|'['
string|"'passive'"
op|']'
op|')'
newline|'\n'
name|'creator'
op|'.'
name|'connectTCP'
op|'('
name|'config'
op|'.'
name|'opts'
op|'['
string|"'host'"
op|']'
op|','
name|'config'
op|'.'
name|'opts'
op|'['
string|"'port'"
op|']'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'connectionMade'
op|')'
op|'.'
name|'addErrback'
op|'('
name|'connectionFailed'
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'run'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|connectionFailed
dedent|''
name|'def'
name|'connectionFailed'
op|'('
name|'f'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'print'
string|'"Connection Failed:"'
op|','
name|'f'
newline|'\n'
name|'reactor'
op|'.'
name|'stop'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|connectionMade
dedent|''
name|'def'
name|'connectionMade'
op|'('
name|'ftpClient'
op|')'
op|':'
newline|'\n'
comment|'# Get the current working directory'
nl|'\n'
indent|'    '
name|'ftpClient'
op|'.'
name|'pwd'
op|'('
op|')'
op|'.'
name|'addCallbacks'
op|'('
name|'success'
op|','
name|'fail'
op|')'
newline|'\n'
nl|'\n'
comment|'# Get a detailed listing of the current directory'
nl|'\n'
name|'fileList'
op|'='
name|'FTPFileListProtocol'
op|'('
op|')'
newline|'\n'
name|'d'
op|'='
name|'ftpClient'
op|'.'
name|'list'
op|'('
string|"'.'"
op|','
name|'fileList'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallbacks'
op|'('
name|'showFiles'
op|','
name|'fail'
op|','
name|'callbackArgs'
op|'='
op|'('
name|'fileList'
op|','
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# Change to the parent directory'
nl|'\n'
name|'ftpClient'
op|'.'
name|'cdup'
op|'('
op|')'
op|'.'
name|'addCallbacks'
op|'('
name|'success'
op|','
name|'fail'
op|')'
newline|'\n'
nl|'\n'
comment|'# Create a buffer'
nl|'\n'
name|'proto'
op|'='
name|'BufferingProtocol'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# Get short listing of current directory, and quit when done'
nl|'\n'
name|'d'
op|'='
name|'ftpClient'
op|'.'
name|'nlst'
op|'('
string|"'.'"
op|','
name|'proto'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallbacks'
op|'('
name|'showBuffer'
op|','
name|'fail'
op|','
name|'callbackArgs'
op|'='
op|'('
name|'proto'
op|','
op|')'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'lambda'
name|'result'
op|':'
name|'reactor'
op|'.'
name|'stop'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
comment|'# this only runs if the module was *not* imported'
nl|'\n'
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'run'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
endmarker|''
end_unit
