begin_unit
nl|'\n'
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
name|'import'
name|'sys'
newline|'\n'
name|'from'
name|'zope'
op|'.'
name|'interface'
name|'import'
name|'implements'
op|','
name|'Interface'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'protocols'
name|'import'
name|'basic'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'protocol'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'log'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'cred'
name|'import'
name|'error'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'cred'
name|'import'
name|'portal'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'cred'
name|'import'
name|'checkers'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'cred'
name|'import'
name|'credentials'
newline|'\n'
nl|'\n'
DECL|class|IProtocolUser
name|'class'
name|'IProtocolUser'
op|'('
name|'Interface'
op|')'
op|':'
newline|'\n'
DECL|member|getPrivileges
indent|'    '
name|'def'
name|'getPrivileges'
op|'('
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Return a list of privileges this user has."""'
newline|'\n'
nl|'\n'
DECL|member|logout
dedent|''
name|'def'
name|'logout'
op|'('
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Cleanup per-login resources allocated to this avatar"""'
newline|'\n'
nl|'\n'
DECL|class|AnonymousUser
dedent|''
dedent|''
name|'class'
name|'AnonymousUser'
op|':'
newline|'\n'
indent|'    '
name|'implements'
op|'('
name|'IProtocolUser'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getPrivileges
name|'def'
name|'getPrivileges'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
op|'['
number|'1'
op|','
number|'2'
op|','
number|'3'
op|']'
newline|'\n'
nl|'\n'
DECL|member|logout
dedent|''
name|'def'
name|'logout'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"Cleaning up anonymous user resources"'
newline|'\n'
nl|'\n'
DECL|class|RegularUser
dedent|''
dedent|''
name|'class'
name|'RegularUser'
op|':'
newline|'\n'
indent|'    '
name|'implements'
op|'('
name|'IProtocolUser'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getPrivileges
name|'def'
name|'getPrivileges'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
op|'['
number|'1'
op|','
number|'2'
op|','
number|'3'
op|','
number|'5'
op|','
number|'6'
op|']'
newline|'\n'
nl|'\n'
DECL|member|logout
dedent|''
name|'def'
name|'logout'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"Cleaning up regular user resources"'
newline|'\n'
nl|'\n'
DECL|class|Administrator
dedent|''
dedent|''
name|'class'
name|'Administrator'
op|':'
newline|'\n'
indent|'    '
name|'implements'
op|'('
name|'IProtocolUser'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getPrivileges
name|'def'
name|'getPrivileges'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'range'
op|'('
number|'50'
op|')'
newline|'\n'
nl|'\n'
DECL|member|logout
dedent|''
name|'def'
name|'logout'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"Cleaning up administrator resources"'
newline|'\n'
nl|'\n'
DECL|class|Protocol
dedent|''
dedent|''
name|'class'
name|'Protocol'
op|'('
name|'basic'
op|'.'
name|'LineReceiver'
op|')'
op|':'
newline|'\n'
DECL|variable|user
indent|'    '
name|'user'
op|'='
name|'None'
newline|'\n'
DECL|variable|portal
name|'portal'
op|'='
name|'None'
newline|'\n'
DECL|variable|avatar
name|'avatar'
op|'='
name|'None'
newline|'\n'
DECL|variable|logout
name|'logout'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|connectionMade
name|'def'
name|'connectionMade'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'sendLine'
op|'('
string|'"Login with USER <name> followed by PASS <password> or ANON"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendLine'
op|'('
string|'"Check privileges with PRIVS"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|connectionLost
dedent|''
name|'def'
name|'connectionLost'
op|'('
name|'self'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'logout'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'logout'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'avatar'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'logout'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|lineReceived
dedent|''
dedent|''
name|'def'
name|'lineReceived'
op|'('
name|'self'
op|','
name|'line'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'f'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
string|"'cmd_'"
op|'+'
name|'line'
op|'.'
name|'upper'
op|'('
op|')'
op|'.'
name|'split'
op|'('
op|')'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'if'
name|'f'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'f'
op|'('
op|'*'
name|'line'
op|'.'
name|'split'
op|'('
op|')'
op|'['
number|'1'
op|':'
op|']'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'TypeError'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sendLine'
op|'('
string|'"Wrong number of arguments."'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sendLine'
op|'('
string|'"Server error (probably your fault)"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|cmd_ANON
dedent|''
dedent|''
dedent|''
name|'def'
name|'cmd_ANON'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'portal'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'portal'
op|'.'
name|'login'
op|'('
name|'credentials'
op|'.'
name|'Anonymous'
op|'('
op|')'
op|','
name|'None'
op|','
name|'IProtocolUser'
nl|'\n'
op|')'
op|'.'
name|'addCallbacks'
op|'('
name|'self'
op|'.'
name|'_cbLogin'
op|','
name|'self'
op|'.'
name|'_ebLogin'
nl|'\n'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendLine'
op|'('
string|'"DENIED"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|cmd_USER
dedent|''
dedent|''
name|'def'
name|'cmd_USER'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'user'
op|'='
name|'name'
newline|'\n'
name|'self'
op|'.'
name|'sendLine'
op|'('
string|'"Alright.  Now PASS?"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|cmd_PASS
dedent|''
name|'def'
name|'cmd_PASS'
op|'('
name|'self'
op|','
name|'password'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'user'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendLine'
op|'('
string|'"USER required before PASS"'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'portal'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'portal'
op|'.'
name|'login'
op|'('
nl|'\n'
name|'credentials'
op|'.'
name|'UsernamePassword'
op|'('
name|'self'
op|'.'
name|'user'
op|','
name|'password'
op|')'
op|','
nl|'\n'
name|'None'
op|','
nl|'\n'
name|'IProtocolUser'
nl|'\n'
op|')'
op|'.'
name|'addCallbacks'
op|'('
name|'self'
op|'.'
name|'_cbLogin'
op|','
name|'self'
op|'.'
name|'_ebLogin'
nl|'\n'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sendLine'
op|'('
string|'"DENIED"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|cmd_PRIVS
dedent|''
dedent|''
dedent|''
name|'def'
name|'cmd_PRIVS'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'sendLine'
op|'('
string|'"You have the following privileges: "'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendLine'
op|'('
string|'" "'
op|'.'
name|'join'
op|'('
name|'map'
op|'('
name|'str'
op|','
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'getPrivileges'
op|'('
op|')'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_cbLogin
dedent|''
name|'def'
name|'_cbLogin'
op|'('
name|'self'
op|','
op|'('
name|'interface'
op|','
name|'avatar'
op|','
name|'logout'
op|')'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'assert'
name|'interface'
name|'is'
name|'IProtocolUser'
newline|'\n'
name|'self'
op|'.'
name|'avatar'
op|'='
name|'avatar'
newline|'\n'
name|'self'
op|'.'
name|'logout'
op|'='
name|'logout'
newline|'\n'
name|'self'
op|'.'
name|'sendLine'
op|'('
string|'"Login successful.  Available commands: PRIVS"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_ebLogin
dedent|''
name|'def'
name|'_ebLogin'
op|'('
name|'self'
op|','
name|'failure'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'failure'
op|'.'
name|'trap'
op|'('
name|'error'
op|'.'
name|'UnauthorizedLogin'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendLine'
op|'('
string|'"Login denied!  Go away."'
op|')'
newline|'\n'
nl|'\n'
DECL|class|ServerFactory
dedent|''
dedent|''
name|'class'
name|'ServerFactory'
op|'('
name|'protocol'
op|'.'
name|'ServerFactory'
op|')'
op|':'
newline|'\n'
DECL|variable|protocol
indent|'    '
name|'protocol'
op|'='
name|'Protocol'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'portal'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'portal'
op|'='
name|'portal'
newline|'\n'
nl|'\n'
DECL|member|buildProtocol
dedent|''
name|'def'
name|'buildProtocol'
op|'('
name|'self'
op|','
name|'addr'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'p'
op|'='
name|'protocol'
op|'.'
name|'ServerFactory'
op|'.'
name|'buildProtocol'
op|'('
name|'self'
op|','
name|'addr'
op|')'
newline|'\n'
name|'p'
op|'.'
name|'portal'
op|'='
name|'self'
op|'.'
name|'portal'
newline|'\n'
name|'return'
name|'p'
newline|'\n'
nl|'\n'
DECL|class|Realm
dedent|''
dedent|''
name|'class'
name|'Realm'
op|':'
newline|'\n'
indent|'    '
name|'implements'
op|'('
name|'portal'
op|'.'
name|'IRealm'
op|')'
newline|'\n'
nl|'\n'
DECL|member|requestAvatar
name|'def'
name|'requestAvatar'
op|'('
name|'self'
op|','
name|'avatarId'
op|','
name|'mind'
op|','
op|'*'
name|'interfaces'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'IProtocolUser'
name|'in'
name|'interfaces'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'avatarId'
op|'=='
name|'checkers'
op|'.'
name|'ANONYMOUS'
op|':'
newline|'\n'
indent|'                '
name|'av'
op|'='
name|'AnonymousUser'
op|'('
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'avatarId'
op|'.'
name|'isupper'
op|'('
op|')'
op|':'
newline|'\n'
comment|'# Capitalized usernames are administrators.'
nl|'\n'
indent|'                '
name|'av'
op|'='
name|'Administrator'
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'av'
op|'='
name|'RegularUser'
op|'('
op|')'
newline|'\n'
dedent|''
name|'return'
name|'IProtocolUser'
op|','
name|'av'
op|','
name|'av'
op|'.'
name|'logout'
newline|'\n'
dedent|''
name|'raise'
name|'NotImplementedError'
op|'('
string|'"Only IProtocolUser interface is supported by this realm"'
op|')'
newline|'\n'
nl|'\n'
DECL|function|main
dedent|''
dedent|''
name|'def'
name|'main'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'r'
op|'='
name|'Realm'
op|'('
op|')'
newline|'\n'
name|'p'
op|'='
name|'portal'
op|'.'
name|'Portal'
op|'('
name|'r'
op|')'
newline|'\n'
name|'c'
op|'='
name|'checkers'
op|'.'
name|'InMemoryUsernamePasswordDatabaseDontUse'
op|'('
op|')'
newline|'\n'
name|'c'
op|'.'
name|'addUser'
op|'('
string|'"auser"'
op|','
string|'"thepass"'
op|')'
newline|'\n'
name|'c'
op|'.'
name|'addUser'
op|'('
string|'"SECONDUSER"'
op|','
string|'"secret"'
op|')'
newline|'\n'
name|'p'
op|'.'
name|'registerChecker'
op|'('
name|'c'
op|')'
newline|'\n'
name|'p'
op|'.'
name|'registerChecker'
op|'('
name|'checkers'
op|'.'
name|'AllowAnonymousAccess'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'f'
op|'='
name|'ServerFactory'
op|'('
name|'p'
op|')'
newline|'\n'
nl|'\n'
name|'log'
op|'.'
name|'startLogging'
op|'('
name|'sys'
op|'.'
name|'stdout'
op|')'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
name|'reactor'
op|'.'
name|'listenTCP'
op|'('
number|'4738'
op|','
name|'f'
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'run'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
