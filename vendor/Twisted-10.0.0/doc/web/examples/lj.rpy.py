begin_unit
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Syndicate LiveJournal users'
nl|'\n'
comment|'# Demonstrates how to use chained callbacks'
nl|'\n'
name|'from'
name|'__future__'
name|'import'
name|'nested_scopes'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'web'
name|'import'
name|'resource'
name|'as'
name|'resourcelib'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'web'
name|'import'
name|'client'
op|','
name|'microdom'
op|','
name|'domhelpers'
op|','
name|'server'
newline|'\n'
nl|'\n'
DECL|variable|urlTemplate
name|'urlTemplate'
op|'='
string|"'http://www.livejournal.com/users/%s/rss'"
newline|'\n'
nl|'\n'
DECL|class|LJSyndicatingResource
name|'class'
name|'LJSyndicatingResource'
op|'('
name|'resourcelib'
op|'.'
name|'Resource'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|render_GET
indent|'    '
name|'def'
name|'render_GET'
op|'('
name|'self'
op|','
name|'request'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'url'
op|'='
name|'urlTemplate'
op|'%'
name|'request'
op|'.'
name|'args'
op|'['
string|"'user'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'client'
op|'.'
name|'getPage'
op|'('
name|'url'
op|')'
op|'.'
name|'addCallback'
op|'('
nl|'\n'
name|'microdom'
op|'.'
name|'parseString'
op|')'
op|'.'
name|'addCallback'
op|'('
nl|'\n'
name|'lambda'
name|'t'
op|':'
name|'domhelpers'
op|'.'
name|'findNodesNamed'
op|'('
name|'t'
op|','
string|"'item'"
op|')'
op|')'
op|'.'
name|'addCallback'
op|'('
nl|'\n'
name|'lambda'
name|'itms'
op|':'
name|'zip'
op|'('
op|'['
name|'domhelpers'
op|'.'
name|'findNodesNamed'
op|'('
name|'x'
op|','
string|"'title'"
op|')'
op|'['
number|'0'
op|']'
nl|'\n'
name|'for'
name|'x'
name|'in'
name|'itms'
op|']'
op|','
nl|'\n'
op|'['
name|'domhelpers'
op|'.'
name|'findNodesNamed'
op|'('
name|'x'
op|','
string|"'link'"
op|')'
op|'['
number|'0'
op|']'
nl|'\n'
name|'for'
name|'x'
name|'in'
name|'itms'
op|']'
nl|'\n'
op|')'
op|')'
op|'.'
name|'addCallback'
op|'('
nl|'\n'
name|'lambda'
name|'itms'
op|':'
string|"'<html><head></head><body><ul>%s</ul></body></html>'"
op|'%'
nl|'\n'
string|"'\\n'"
op|'.'
name|'join'
op|'('
nl|'\n'
op|'['
string|'\'<li><a href="%s">%s</a></li>\''
op|'%'
op|'('
nl|'\n'
name|'domhelpers'
op|'.'
name|'getNodeText'
op|'('
name|'link'
op|')'
op|','
name|'domhelpers'
op|'.'
name|'getNodeText'
op|'('
name|'title'
op|')'
op|')'
nl|'\n'
name|'for'
op|'('
name|'title'
op|','
name|'link'
op|')'
name|'in'
name|'itms'
op|']'
op|')'
nl|'\n'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'lambda'
name|'s'
op|':'
op|'('
name|'request'
op|'.'
name|'write'
op|'('
name|'s'
op|')'
op|','
name|'request'
op|'.'
name|'finish'
op|'('
op|')'
op|')'
op|')'
op|'.'
name|'addErrback'
op|'('
nl|'\n'
name|'lambda'
name|'e'
op|':'
op|'('
name|'request'
op|'.'
name|'write'
op|'('
string|"'Error: %s'"
op|'%'
name|'e'
op|')'
op|','
name|'request'
op|'.'
name|'finish'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'return'
name|'server'
op|'.'
name|'NOT_DONE_YET'
newline|'\n'
nl|'\n'
DECL|variable|resource
dedent|''
dedent|''
name|'resource'
op|'='
name|'LJSyndicatingResource'
op|'('
op|')'
newline|'\n'
endmarker|''
end_unit
