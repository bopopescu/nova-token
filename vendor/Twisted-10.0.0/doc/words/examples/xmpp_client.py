begin_unit
comment|'# Copyright (c) 2001-2009 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
name|'import'
name|'sys'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
op|'.'
name|'srvconnect'
name|'import'
name|'SRVConnector'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'words'
op|'.'
name|'xish'
name|'import'
name|'domish'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'words'
op|'.'
name|'protocols'
op|'.'
name|'jabber'
name|'import'
name|'xmlstream'
op|','
name|'client'
op|','
name|'jid'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|XMPPClientConnector
name|'class'
name|'XMPPClientConnector'
op|'('
name|'SRVConnector'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'reactor'
op|','
name|'domain'
op|','
name|'factory'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'SRVConnector'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
name|'reactor'
op|','
string|"'xmpp-client'"
op|','
name|'domain'
op|','
name|'factory'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|pickServer
dedent|''
name|'def'
name|'pickServer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'host'
op|','
name|'port'
op|'='
name|'SRVConnector'
op|'.'
name|'pickServer'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'servers'
name|'and'
name|'not'
name|'self'
op|'.'
name|'orderedServers'
op|':'
newline|'\n'
comment|'# no SRV record, fall back..'
nl|'\n'
indent|'            '
name|'port'
op|'='
number|'5222'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'host'
op|','
name|'port'
newline|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
DECL|class|Client
dedent|''
dedent|''
name|'class'
name|'Client'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'client_jid'
op|','
name|'secret'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'f'
op|'='
name|'client'
op|'.'
name|'XMPPClientFactory'
op|'('
name|'client_jid'
op|','
name|'secret'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'addBootstrap'
op|'('
name|'xmlstream'
op|'.'
name|'STREAM_CONNECTED_EVENT'
op|','
name|'self'
op|'.'
name|'connected'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'addBootstrap'
op|'('
name|'xmlstream'
op|'.'
name|'STREAM_END_EVENT'
op|','
name|'self'
op|'.'
name|'disconnected'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'addBootstrap'
op|'('
name|'xmlstream'
op|'.'
name|'STREAM_AUTHD_EVENT'
op|','
name|'self'
op|'.'
name|'authenticated'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'addBootstrap'
op|'('
name|'xmlstream'
op|'.'
name|'INIT_FAILED_EVENT'
op|','
name|'self'
op|'.'
name|'init_failed'
op|')'
newline|'\n'
name|'connector'
op|'='
name|'XMPPClientConnector'
op|'('
name|'reactor'
op|','
name|'client_jid'
op|'.'
name|'host'
op|','
name|'f'
op|')'
newline|'\n'
name|'connector'
op|'.'
name|'connect'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|rawDataIn
dedent|''
name|'def'
name|'rawDataIn'
op|'('
name|'self'
op|','
name|'buf'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"RECV: %s"'
op|'%'
name|'unicode'
op|'('
name|'buf'
op|','
string|"'utf-8'"
op|')'
op|'.'
name|'encode'
op|'('
string|"'ascii'"
op|','
string|"'replace'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|rawDataOut
dedent|''
name|'def'
name|'rawDataOut'
op|'('
name|'self'
op|','
name|'buf'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"SEND: %s"'
op|'%'
name|'unicode'
op|'('
name|'buf'
op|','
string|"'utf-8'"
op|')'
op|'.'
name|'encode'
op|'('
string|"'ascii'"
op|','
string|"'replace'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|connected
dedent|''
name|'def'
name|'connected'
op|'('
name|'self'
op|','
name|'xs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'Connected.'"
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'xmlstream'
op|'='
name|'xs'
newline|'\n'
nl|'\n'
comment|'# Log all traffic'
nl|'\n'
name|'xs'
op|'.'
name|'rawDataInFn'
op|'='
name|'self'
op|'.'
name|'rawDataIn'
newline|'\n'
name|'xs'
op|'.'
name|'rawDataOutFn'
op|'='
name|'self'
op|'.'
name|'rawDataOut'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|disconnected
dedent|''
name|'def'
name|'disconnected'
op|'('
name|'self'
op|','
name|'xs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'Disconnected.'"
newline|'\n'
nl|'\n'
name|'reactor'
op|'.'
name|'stop'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|authenticated
dedent|''
name|'def'
name|'authenticated'
op|'('
name|'self'
op|','
name|'xs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"Authenticated."'
newline|'\n'
nl|'\n'
name|'presence'
op|'='
name|'domish'
op|'.'
name|'Element'
op|'('
op|'('
name|'None'
op|','
string|"'presence'"
op|')'
op|')'
newline|'\n'
name|'xs'
op|'.'
name|'send'
op|'('
name|'presence'
op|')'
newline|'\n'
nl|'\n'
name|'reactor'
op|'.'
name|'callLater'
op|'('
number|'5'
op|','
name|'xs'
op|'.'
name|'sendFooter'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|init_failed
dedent|''
name|'def'
name|'init_failed'
op|'('
name|'self'
op|','
name|'failure'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|'"Initialization failed."'
newline|'\n'
name|'print'
name|'failure'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'xmlstream'
op|'.'
name|'sendFooter'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|client_jid
dedent|''
dedent|''
name|'client_jid'
op|'='
name|'jid'
op|'.'
name|'JID'
op|'('
name|'sys'
op|'.'
name|'argv'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
DECL|variable|secret
name|'secret'
op|'='
name|'sys'
op|'.'
name|'argv'
op|'['
number|'2'
op|']'
newline|'\n'
DECL|variable|c
name|'c'
op|'='
name|'Client'
op|'('
name|'client_jid'
op|','
name|'secret'
op|')'
newline|'\n'
nl|'\n'
name|'reactor'
op|'.'
name|'run'
op|'('
op|')'
newline|'\n'
endmarker|''
end_unit
