begin_unit
comment|'#!/usr/bin/env python'
nl|'\n'
nl|'\n'
comment|'# Copyright (c) 2009 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
string|'"""\nSimple PB Words client demo\n\nThis connects to a server (host/port specified by argv[1]/argv[2]),\nauthenticates with a username and password (given by argv[3] and argv[4]),\njoins a group (argv[5]) sends a simple message, leaves the group, and quits\nthe server.\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'sys'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'log'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'cred'
name|'import'
name|'credentials'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'words'
name|'import'
name|'service'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'spread'
name|'import'
name|'pb'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
nl|'\n'
DECL|class|DemoMind
name|'class'
name|'DemoMind'
op|'('
name|'service'
op|'.'
name|'PBMind'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""An utterly pointless PBMind subclass.\n\n    This notices messages received and prints them to stdout.  Since\n    the bot never stays in a channel very long, it is exceedingly\n    unlikely this will ever do anything interesting.\n    """'
newline|'\n'
DECL|member|remote_receive
name|'def'
name|'remote_receive'
op|'('
name|'self'
op|','
name|'sender'
op|','
name|'recipient'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'Woop'"
op|','
name|'sender'
op|','
name|'recipient'
op|','
name|'message'
newline|'\n'
nl|'\n'
DECL|function|quitServer
dedent|''
dedent|''
name|'def'
name|'quitServer'
op|'('
name|'ignored'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Quit succeeded, shut down the reactor.\n    """'
newline|'\n'
name|'reactor'
op|'.'
name|'stop'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|leftGroup
dedent|''
name|'def'
name|'leftGroup'
op|'('
name|'ignored'
op|','
name|'avatar'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Left the group successfully, quit the server.\n    """'
newline|'\n'
name|'q'
op|'='
name|'avatar'
op|'.'
name|'quit'
op|'('
op|')'
newline|'\n'
name|'q'
op|'.'
name|'addCallback'
op|'('
name|'quitServer'
op|')'
newline|'\n'
name|'return'
name|'q'
newline|'\n'
nl|'\n'
DECL|function|sentMessage
dedent|''
name|'def'
name|'sentMessage'
op|'('
name|'ignored'
op|','
name|'group'
op|','
name|'avatar'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Sent the message successfully, leave the group.\n    """'
newline|'\n'
name|'l'
op|'='
name|'group'
op|'.'
name|'leave'
op|'('
op|')'
newline|'\n'
name|'l'
op|'.'
name|'addCallback'
op|'('
name|'leftGroup'
op|','
name|'avatar'
op|')'
newline|'\n'
name|'return'
name|'l'
newline|'\n'
nl|'\n'
DECL|function|joinedGroup
dedent|''
name|'def'
name|'joinedGroup'
op|'('
name|'group'
op|','
name|'avatar'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Joined the group successfully, send a stupid message.\n    """'
newline|'\n'
name|'s'
op|'='
name|'group'
op|'.'
name|'send'
op|'('
op|'{'
string|'"text"'
op|':'
string|'"Hello, monkeys"'
op|'}'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'addCallback'
op|'('
name|'sentMessage'
op|','
name|'group'
op|','
name|'avatar'
op|')'
newline|'\n'
name|'return'
name|'s'
newline|'\n'
nl|'\n'
DECL|function|loggedIn
dedent|''
name|'def'
name|'loggedIn'
op|'('
name|'avatar'
op|','
name|'group'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Logged in successfully, join a group.\n    """'
newline|'\n'
name|'j'
op|'='
name|'avatar'
op|'.'
name|'join'
op|'('
name|'group'
op|')'
newline|'\n'
name|'j'
op|'.'
name|'addCallback'
op|'('
name|'joinedGroup'
op|','
name|'avatar'
op|')'
newline|'\n'
name|'return'
name|'j'
newline|'\n'
nl|'\n'
DECL|function|errorOccurred
dedent|''
name|'def'
name|'errorOccurred'
op|'('
name|'err'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Something went awry, log it and shutdown.\n    """'
newline|'\n'
name|'log'
op|'.'
name|'err'
op|'('
name|'err'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'        '
name|'reactor'
op|'.'
name|'stop'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'RuntimeError'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|function|run
dedent|''
dedent|''
name|'def'
name|'run'
op|'('
name|'host'
op|','
name|'port'
op|','
name|'username'
op|','
name|'password'
op|','
name|'group'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Create a mind and factory and set things in motion.\n    """'
newline|'\n'
name|'m'
op|'='
name|'DemoMind'
op|'('
op|')'
newline|'\n'
name|'f'
op|'='
name|'pb'
op|'.'
name|'PBClientFactory'
op|'('
op|')'
newline|'\n'
name|'f'
op|'.'
name|'unsafeTracebacks'
op|'='
name|'True'
newline|'\n'
name|'l'
op|'='
name|'f'
op|'.'
name|'login'
op|'('
name|'credentials'
op|'.'
name|'UsernamePassword'
op|'('
name|'username'
op|','
name|'password'
op|')'
op|','
name|'m'
op|')'
newline|'\n'
name|'l'
op|'.'
name|'addCallback'
op|'('
name|'loggedIn'
op|','
name|'group'
op|')'
newline|'\n'
name|'l'
op|'.'
name|'addErrback'
op|'('
name|'errorOccurred'
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'connectTCP'
op|'('
name|'host'
op|','
name|'int'
op|'('
name|'port'
op|')'
op|','
name|'f'
op|')'
newline|'\n'
nl|'\n'
DECL|function|main
dedent|''
name|'def'
name|'main'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    Set up logging, have the real main function run, and start the reactor.\n    """'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|')'
op|'!='
number|'6'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'SystemExit'
op|'('
string|'"Usage: %s host port username password group"'
op|'%'
op|'('
name|'sys'
op|'.'
name|'argv'
op|'['
number|'0'
op|']'
op|','
op|')'
op|')'
newline|'\n'
dedent|''
name|'log'
op|'.'
name|'startLogging'
op|'('
name|'sys'
op|'.'
name|'stdout'
op|')'
newline|'\n'
nl|'\n'
name|'host'
op|','
name|'port'
op|','
name|'username'
op|','
name|'password'
op|','
name|'group'
op|'='
name|'sys'
op|'.'
name|'argv'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
name|'port'
op|'='
name|'int'
op|'('
name|'port'
op|')'
newline|'\n'
name|'username'
op|'='
name|'username'
op|'.'
name|'decode'
op|'('
name|'sys'
op|'.'
name|'stdin'
op|'.'
name|'encoding'
op|')'
newline|'\n'
name|'group'
op|'='
name|'group'
op|'.'
name|'decode'
op|'('
name|'sys'
op|'.'
name|'stdin'
op|'.'
name|'encoding'
op|')'
newline|'\n'
nl|'\n'
name|'reactor'
op|'.'
name|'callWhenRunning'
op|'('
name|'run'
op|','
name|'host'
op|','
name|'port'
op|','
name|'username'
op|','
name|'password'
op|','
name|'group'
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'run'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
