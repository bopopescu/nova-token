begin_unit
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
string|'"""\nMaintainer: Jp Calderone\n"""'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'news'
name|'import'
name|'nntp'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'protocol'
op|','
name|'reactor'
newline|'\n'
nl|'\n'
name|'import'
name|'time'
newline|'\n'
nl|'\n'
DECL|class|NNTPFactory
name|'class'
name|'NNTPFactory'
op|'('
name|'protocol'
op|'.'
name|'ServerFactory'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""A factory for NNTP server protocols."""'
newline|'\n'
nl|'\n'
DECL|variable|protocol
name|'protocol'
op|'='
name|'nntp'
op|'.'
name|'NNTPServer'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'backend'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'backend'
op|'='
name|'backend'
newline|'\n'
nl|'\n'
DECL|member|buildProtocol
dedent|''
name|'def'
name|'buildProtocol'
op|'('
name|'self'
op|','
name|'connection'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'p'
op|'='
name|'self'
op|'.'
name|'protocol'
op|'('
op|')'
newline|'\n'
name|'p'
op|'.'
name|'factory'
op|'='
name|'self'
newline|'\n'
name|'return'
name|'p'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|UsenetClientFactory
dedent|''
dedent|''
name|'class'
name|'UsenetClientFactory'
op|'('
name|'protocol'
op|'.'
name|'ClientFactory'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'groups'
op|','
name|'storage'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'lastChecks'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'groups'
op|'='
name|'groups'
newline|'\n'
name|'self'
op|'.'
name|'storage'
op|'='
name|'storage'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|clientConnectionLost
dedent|''
name|'def'
name|'clientConnectionLost'
op|'('
name|'self'
op|','
name|'connector'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|clientConnectionFailed
dedent|''
name|'def'
name|'clientConnectionFailed'
op|'('
name|'self'
op|','
name|'connector'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'Connection failed: '"
op|','
name|'reason'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|updateChecks
dedent|''
name|'def'
name|'updateChecks'
op|'('
name|'self'
op|','
name|'addr'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'lastChecks'
op|'['
name|'addr'
op|']'
op|'='
name|'time'
op|'.'
name|'mktime'
op|'('
name|'time'
op|'.'
name|'gmtime'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|buildProtocol
dedent|''
name|'def'
name|'buildProtocol'
op|'('
name|'self'
op|','
name|'addr'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'last'
op|'='
name|'self'
op|'.'
name|'lastChecks'
op|'.'
name|'setdefault'
op|'('
name|'addr'
op|','
name|'time'
op|'.'
name|'mktime'
op|'('
name|'time'
op|'.'
name|'gmtime'
op|'('
op|')'
op|')'
op|'-'
op|'('
number|'60'
op|'*'
number|'60'
op|'*'
number|'24'
op|'*'
number|'7'
op|')'
op|')'
newline|'\n'
name|'p'
op|'='
name|'nntp'
op|'.'
name|'UsenetClientProtocol'
op|'('
name|'self'
op|'.'
name|'groups'
op|','
name|'last'
op|','
name|'self'
op|'.'
name|'storage'
op|')'
newline|'\n'
name|'p'
op|'.'
name|'factory'
op|'='
name|'self'
newline|'\n'
name|'return'
name|'p'
newline|'\n'
nl|'\n'
nl|'\n'
comment|"# XXX - Maybe this inheritence doesn't make so much sense?"
nl|'\n'
DECL|class|UsenetServerFactory
dedent|''
dedent|''
name|'class'
name|'UsenetServerFactory'
op|'('
name|'NNTPFactory'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""A factory for NNTP Usenet server protocols."""'
newline|'\n'
nl|'\n'
DECL|variable|protocol
name|'protocol'
op|'='
name|'nntp'
op|'.'
name|'NNTPServer'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'backend'
op|','
name|'remoteHosts'
op|'='
name|'None'
op|','
name|'updatePeriod'
op|'='
number|'60'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'NNTPFactory'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
name|'backend'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'updatePeriod'
op|'='
name|'updatePeriod'
newline|'\n'
name|'self'
op|'.'
name|'remoteHosts'
op|'='
name|'remoteHosts'
name|'or'
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'clientFactory'
op|'='
name|'UsenetClientFactory'
op|'('
name|'self'
op|'.'
name|'remoteHosts'
op|','
name|'self'
op|'.'
name|'backend'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|startFactory
dedent|''
name|'def'
name|'startFactory'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_updateCall'
op|'='
name|'reactor'
op|'.'
name|'callLater'
op|'('
number|'0'
op|','
name|'self'
op|'.'
name|'syncWithRemotes'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|stopFactory
dedent|''
name|'def'
name|'stopFactory'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'_updateCall'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_updateCall'
op|'.'
name|'cancel'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_updateCall'
op|'='
name|'None'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|buildProtocol
dedent|''
dedent|''
name|'def'
name|'buildProtocol'
op|'('
name|'self'
op|','
name|'connection'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'p'
op|'='
name|'self'
op|'.'
name|'protocol'
op|'('
op|')'
newline|'\n'
name|'p'
op|'.'
name|'factory'
op|'='
name|'self'
newline|'\n'
name|'return'
name|'p'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|syncWithRemotes
dedent|''
name|'def'
name|'syncWithRemotes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'remote'
name|'in'
name|'self'
op|'.'
name|'remoteHosts'
op|':'
newline|'\n'
indent|'            '
name|'reactor'
op|'.'
name|'connectTCP'
op|'('
name|'remote'
op|','
number|'119'
op|','
name|'self'
op|'.'
name|'clientFactory'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'_updateCall'
op|'='
name|'reactor'
op|'.'
name|'callLater'
op|'('
name|'self'
op|'.'
name|'updatePeriod'
op|','
name|'self'
op|'.'
name|'syncWithRemotes'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
comment|'# backwards compatability'
nl|'\n'
DECL|variable|Factory
dedent|''
dedent|''
name|'Factory'
op|'='
name|'UsenetServerFactory'
newline|'\n'
endmarker|''
end_unit
