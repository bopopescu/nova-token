begin_unit
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
name|'import'
name|'sys'
op|','
name|'types'
newline|'\n'
name|'from'
name|'pprint'
name|'import'
name|'pformat'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'trial'
name|'import'
name|'unittest'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'news'
name|'import'
name|'database'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
nl|'\n'
DECL|variable|MESSAGE_ID
name|'MESSAGE_ID'
op|'='
string|'"f83ba57450ed0fd8ac9a472b847e830e"'
newline|'\n'
nl|'\n'
name|'POST_STRING'
op|'='
string|'"""Path: not-for-mail\nFrom: <exarkun@somehost.domain.com>\nSubject: a test\nNewsgroups: alt.test.nntp\nOrganization: \nSummary: \nKeywords: \nMessage-Id: %s\nUser-Agent: tin/1.4.5-20010409 ("One More Nightmare") (UNIX) (Linux/2.4.17 (i686))\n\nthis is a test\n...\nlala\nmoo\n-- \n"One World, one Web, one Program." - Microsoft(R) promotional ad\n"Ein Volk, ein Reich, ein Fuhrer." - Adolf Hitler\n--\n 10:56pm up 4 days, 4:42, 1 user, load average: 0.08, 0.08, 0.12\n"""'
op|'%'
op|'('
name|'MESSAGE_ID'
op|')'
newline|'\n'
nl|'\n'
DECL|class|NewsTestCase
name|'class'
name|'NewsTestCase'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'backend'
op|'='
name|'database'
op|'.'
name|'NewsShelf'
op|'('
name|'None'
op|','
string|"'news2.db'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'backend'
op|'.'
name|'addGroup'
op|'('
string|"'alt.test.nntp'"
op|','
string|"'y'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'backend'
op|'.'
name|'postRequest'
op|'('
name|'POST_STRING'
op|'.'
name|'replace'
op|'('
string|"'\\n'"
op|','
string|"'\\r\\n'"
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testArticleExists
dedent|''
name|'def'
name|'testArticleExists'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'backend'
op|'.'
name|'articleExistsRequest'
op|'('
name|'MESSAGE_ID'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'failUnless'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testArticleRequest
dedent|''
name|'def'
name|'testArticleRequest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'backend'
op|'.'
name|'articleRequest'
op|'('
name|'None'
op|','
name|'None'
op|','
name|'MESSAGE_ID'
op|')'
newline|'\n'
nl|'\n'
DECL|function|cbArticle
name|'def'
name|'cbArticle'
op|'('
name|'result'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'isinstance'
op|'('
name|'result'
op|','
name|'tuple'
op|')'
op|','
nl|'\n'
string|"'callback result is wrong type: '"
op|'+'
name|'str'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'result'
op|')'
op|','
number|'3'
op|','
nl|'\n'
string|"'callback result list should have three entries: '"
op|'+'
nl|'\n'
name|'str'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'result'
op|'['
number|'1'
op|']'
op|','
name|'MESSAGE_ID'
op|','
nl|'\n'
string|'"callback result Message-Id doesn\'t match: %s vs %s"'
op|'%'
nl|'\n'
op|'('
name|'MESSAGE_ID'
op|','
name|'result'
op|'['
number|'1'
op|']'
op|')'
op|')'
newline|'\n'
name|'body'
op|'='
name|'result'
op|'['
number|'2'
op|']'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfEqual'
op|'('
name|'body'
op|'.'
name|'find'
op|'('
string|"'\\r\\n\\r\\n'"
op|')'
op|','
op|'-'
number|'1'
op|','
nl|'\n'
string|'"Can\'t find \\\\r\\\\n\\\\r\\\\n between header and body"'
op|')'
newline|'\n'
name|'return'
name|'result'
newline|'\n'
nl|'\n'
dedent|''
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'cbArticle'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testHeadRequest
dedent|''
name|'def'
name|'testHeadRequest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'testArticleRequest'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|cbArticle
name|'def'
name|'cbArticle'
op|'('
name|'result'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'index'
op|'='
name|'result'
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
name|'d'
op|'='
name|'self'
op|'.'
name|'backend'
op|'.'
name|'headRequest'
op|'('
string|'"alt.test.nntp"'
op|','
name|'index'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'cbHead'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|function|cbHead
dedent|''
name|'def'
name|'cbHead'
op|'('
name|'result'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'result'
op|'['
number|'1'
op|']'
op|','
name|'MESSAGE_ID'
op|','
nl|'\n'
string|'"callback result Message-Id doesn\'t match: %s vs %s"'
op|'%'
nl|'\n'
op|'('
name|'MESSAGE_ID'
op|','
name|'result'
op|'['
number|'1'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'result'
op|'['
number|'2'
op|']'
op|'['
op|'-'
number|'2'
op|':'
op|']'
op|','
string|"'\\r\\n'"
op|','
nl|'\n'
string|'"headers must be \\\\r\\\\n terminated."'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'cbArticle'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testBodyRequest
dedent|''
name|'def'
name|'testBodyRequest'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'testArticleRequest'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|cbArticle
name|'def'
name|'cbArticle'
op|'('
name|'result'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'index'
op|'='
name|'result'
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
name|'d'
op|'='
name|'self'
op|'.'
name|'backend'
op|'.'
name|'bodyRequest'
op|'('
string|'"alt.test.nntp"'
op|','
name|'index'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'cbBody'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|function|cbBody
dedent|''
name|'def'
name|'cbBody'
op|'('
name|'result'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
name|'result'
op|'['
number|'2'
op|']'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'body'
op|'['
number|'0'
op|':'
number|'4'
op|']'
op|','
string|"'this'"
op|','
nl|'\n'
string|'"message body has been altered: "'
op|'+'
nl|'\n'
name|'pformat'
op|'('
name|'body'
op|'['
number|'0'
op|':'
number|'4'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'cbArticle'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
