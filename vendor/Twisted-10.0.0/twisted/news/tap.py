begin_unit
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'news'
name|'import'
name|'news'
op|','
name|'database'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'application'
name|'import'
name|'strports'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'usage'
op|','
name|'log'
newline|'\n'
nl|'\n'
DECL|class|DBOptions
name|'class'
name|'DBOptions'
op|'('
name|'usage'
op|'.'
name|'Options'
op|')'
op|':'
newline|'\n'
DECL|variable|optParameters
indent|'    '
name|'optParameters'
op|'='
op|'['
nl|'\n'
op|'['
string|"'module'"
op|','
name|'None'
op|','
string|"'pyPgSQL.PgSQL'"
op|','
string|'"DB-API 2.0 module to use"'
op|']'
op|','
nl|'\n'
op|'['
string|"'dbhost'"
op|','
name|'None'
op|','
string|"'localhost'"
op|','
string|'"Host where database manager is listening"'
op|']'
op|','
nl|'\n'
op|'['
string|"'dbuser'"
op|','
name|'None'
op|','
string|"'news'"
op|','
string|'"Username with which to connect to database"'
op|']'
op|','
nl|'\n'
op|'['
string|"'database'"
op|','
name|'None'
op|','
string|"'news'"
op|','
string|'"Database name to use"'
op|']'
op|','
nl|'\n'
op|'['
string|"'schema'"
op|','
name|'None'
op|','
string|"'schema.sql'"
op|','
string|'"File to which to write SQL schema initialisation"'
op|']'
op|','
nl|'\n'
nl|'\n'
comment|'# XXX - Hrm.'
nl|'\n'
op|'['
string|'"groups"'
op|','
string|'"g"'
op|','
string|'"groups.list"'
op|','
string|'"File containing group list"'
op|']'
op|','
nl|'\n'
op|'['
string|'"servers"'
op|','
string|'"s"'
op|','
string|'"servers.list"'
op|','
string|'"File containing server list"'
op|']'
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
DECL|member|postOptions
name|'def'
name|'postOptions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# XXX - Hmmm.'
nl|'\n'
indent|'        '
name|'self'
op|'['
string|"'groups'"
op|']'
op|'='
op|'['
name|'g'
op|'.'
name|'strip'
op|'('
op|')'
name|'for'
name|'g'
name|'in'
name|'open'
op|'('
name|'self'
op|'['
string|"'groups'"
op|']'
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
name|'if'
name|'not'
name|'g'
op|'.'
name|'startswith'
op|'('
string|"'#'"
op|')'
op|']'
newline|'\n'
name|'self'
op|'['
string|"'servers'"
op|']'
op|'='
op|'['
name|'s'
op|'.'
name|'strip'
op|'('
op|')'
name|'for'
name|'s'
name|'in'
name|'open'
op|'('
name|'self'
op|'['
string|"'servers'"
op|']'
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
name|'if'
name|'not'
name|'s'
op|'.'
name|'startswith'
op|'('
string|"'#'"
op|')'
op|']'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'__import__'
op|'('
name|'self'
op|'['
string|"'module'"
op|']'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ImportError'
op|':'
newline|'\n'
indent|'            '
name|'log'
op|'.'
name|'msg'
op|'('
string|'"Warning: Cannot import %s"'
op|'%'
op|'('
name|'self'
op|'['
string|"'module'"
op|']'
op|','
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'f'
op|'='
name|'open'
op|'('
name|'self'
op|'['
string|"'schema'"
op|']'
op|','
string|"'w'"
op|')'
newline|'\n'
name|'f'
op|'.'
name|'write'
op|'('
nl|'\n'
name|'database'
op|'.'
name|'NewsStorageAugmentation'
op|'.'
name|'schema'
op|'+'
string|"'\\n'"
op|'+'
nl|'\n'
name|'database'
op|'.'
name|'makeGroupSQL'
op|'('
name|'self'
op|'['
string|"'groups'"
op|']'
op|')'
op|'+'
string|"'\\n'"
op|'+'
nl|'\n'
name|'database'
op|'.'
name|'makeOverviewSQL'
op|'('
op|')'
nl|'\n'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'info'
op|'='
op|'{'
nl|'\n'
string|"'host'"
op|':'
name|'self'
op|'['
string|"'dbhost'"
op|']'
op|','
string|"'user'"
op|':'
name|'self'
op|'['
string|"'dbuser'"
op|']'
op|','
nl|'\n'
string|"'database'"
op|':'
name|'self'
op|'['
string|"'database'"
op|']'
op|','
string|"'dbapiName'"
op|':'
name|'self'
op|'['
string|"'module'"
op|']'
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'db'
op|'='
name|'database'
op|'.'
name|'NewsStorageAugmentation'
op|'('
name|'info'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|PickleOptions
dedent|''
dedent|''
name|'class'
name|'PickleOptions'
op|'('
name|'usage'
op|'.'
name|'Options'
op|')'
op|':'
newline|'\n'
DECL|variable|optParameters
indent|'    '
name|'optParameters'
op|'='
op|'['
nl|'\n'
op|'['
string|"'file'"
op|','
name|'None'
op|','
string|"'news.pickle'"
op|','
string|'"File to which to save pickle"'
op|']'
op|','
nl|'\n'
nl|'\n'
comment|'# XXX - Hrm.'
nl|'\n'
op|'['
string|'"groups"'
op|','
string|'"g"'
op|','
string|'"groups.list"'
op|','
string|'"File containing group list"'
op|']'
op|','
nl|'\n'
op|'['
string|'"servers"'
op|','
string|'"s"'
op|','
string|'"servers.list"'
op|','
string|'"File containing server list"'
op|']'
op|','
nl|'\n'
op|'['
string|'"moderators"'
op|','
string|'"m"'
op|','
string|'"moderators.list"'
op|','
nl|'\n'
string|'"File containing moderators list"'
op|']'
op|','
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
DECL|variable|subCommands
name|'subCommands'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|postOptions
name|'def'
name|'postOptions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# XXX - Hmmm.'
nl|'\n'
indent|'        '
name|'filename'
op|'='
name|'self'
op|'['
string|"'file'"
op|']'
newline|'\n'
name|'self'
op|'['
string|"'groups'"
op|']'
op|'='
op|'['
name|'g'
op|'.'
name|'strip'
op|'('
op|')'
name|'for'
name|'g'
name|'in'
name|'open'
op|'('
name|'self'
op|'['
string|"'groups'"
op|']'
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
nl|'\n'
name|'if'
name|'not'
name|'g'
op|'.'
name|'startswith'
op|'('
string|"'#'"
op|')'
op|']'
newline|'\n'
name|'self'
op|'['
string|"'servers'"
op|']'
op|'='
op|'['
name|'s'
op|'.'
name|'strip'
op|'('
op|')'
name|'for'
name|'s'
name|'in'
name|'open'
op|'('
name|'self'
op|'['
string|"'servers'"
op|']'
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
nl|'\n'
name|'if'
name|'not'
name|'s'
op|'.'
name|'startswith'
op|'('
string|"'#'"
op|')'
op|']'
newline|'\n'
name|'self'
op|'['
string|"'moderators'"
op|']'
op|'='
op|'['
name|'s'
op|'.'
name|'split'
op|'('
op|')'
nl|'\n'
name|'for'
name|'s'
name|'in'
name|'open'
op|'('
name|'self'
op|'['
string|"'moderators'"
op|']'
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
nl|'\n'
name|'if'
name|'not'
name|'s'
op|'.'
name|'startswith'
op|'('
string|"'#'"
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'db'
op|'='
name|'database'
op|'.'
name|'PickleStorage'
op|'('
name|'filename'
op|','
name|'self'
op|'['
string|"'groups'"
op|']'
op|','
nl|'\n'
name|'self'
op|'['
string|"'moderators'"
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|Options
dedent|''
dedent|''
name|'class'
name|'Options'
op|'('
name|'usage'
op|'.'
name|'Options'
op|')'
op|':'
newline|'\n'
DECL|variable|synopsis
indent|'    '
name|'synopsis'
op|'='
string|'"[options]"'
newline|'\n'
nl|'\n'
DECL|variable|groups
name|'groups'
op|'='
name|'None'
newline|'\n'
DECL|variable|servers
name|'servers'
op|'='
name|'None'
newline|'\n'
DECL|variable|subscriptions
name|'subscriptions'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|variable|optParameters
name|'optParameters'
op|'='
op|'['
nl|'\n'
op|'['
string|'"port"'
op|','
string|'"p"'
op|','
string|'"119"'
op|','
string|'"Listen port"'
op|']'
op|','
nl|'\n'
op|'['
string|'"interface"'
op|','
string|'"i"'
op|','
string|'""'
op|','
string|'"Interface to which to bind"'
op|']'
op|','
nl|'\n'
op|'['
string|'"datadir"'
op|','
string|'"d"'
op|','
string|'"news.db"'
op|','
string|'"Root data storage path"'
op|']'
op|','
nl|'\n'
op|'['
string|'"mailhost"'
op|','
string|'"m"'
op|','
string|'"localhost"'
op|','
string|'"Host of SMTP server to use"'
op|']'
nl|'\n'
op|']'
newline|'\n'
DECL|variable|zsh_actions
name|'zsh_actions'
op|'='
op|'{'
string|'"datadir"'
op|':'
string|'"_dirs"'
op|','
string|'"mailhost"'
op|':'
string|'"_hosts"'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'usage'
op|'.'
name|'Options'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'groups'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'servers'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'subscriptions'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|opt_group
dedent|''
name|'def'
name|'opt_group'
op|'('
name|'self'
op|','
name|'group'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""The name of a newsgroup to carry."""'
newline|'\n'
name|'self'
op|'.'
name|'groups'
op|'.'
name|'append'
op|'('
op|'['
name|'group'
op|','
name|'None'
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|opt_moderator
dedent|''
name|'def'
name|'opt_moderator'
op|'('
name|'self'
op|','
name|'moderator'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""The email of the moderator for the most recently passed group."""'
newline|'\n'
name|'self'
op|'.'
name|'groups'
op|'['
op|'-'
number|'1'
op|']'
op|'['
number|'1'
op|']'
op|'='
name|'moderator'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|opt_subscription
dedent|''
name|'def'
name|'opt_subscription'
op|'('
name|'self'
op|','
name|'group'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""A newsgroup to list as a recommended subscription."""'
newline|'\n'
name|'self'
op|'.'
name|'subscriptions'
op|'.'
name|'append'
op|'('
name|'group'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|opt_server
dedent|''
name|'def'
name|'opt_server'
op|'('
name|'self'
op|','
name|'server'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""The address of a Usenet server to pass messages to and receive messages from."""'
newline|'\n'
name|'self'
op|'.'
name|'servers'
op|'.'
name|'append'
op|'('
name|'server'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|makeService
dedent|''
dedent|''
name|'def'
name|'makeService'
op|'('
name|'config'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'not'
name|'len'
op|'('
name|'config'
op|'.'
name|'groups'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
string|'"No newsgroups specified"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'db'
op|'='
name|'database'
op|'.'
name|'NewsShelf'
op|'('
name|'config'
op|'['
string|"'mailhost'"
op|']'
op|','
name|'config'
op|'['
string|"'datadir'"
op|']'
op|')'
newline|'\n'
name|'for'
op|'('
name|'g'
op|','
name|'m'
op|')'
name|'in'
name|'config'
op|'.'
name|'groups'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'m'
op|':'
newline|'\n'
indent|'            '
name|'db'
op|'.'
name|'addGroup'
op|'('
name|'g'
op|','
string|"'m'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'addModerator'
op|'('
name|'g'
op|','
name|'m'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'db'
op|'.'
name|'addGroup'
op|'('
name|'g'
op|','
string|"'y'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'for'
name|'s'
name|'in'
name|'config'
op|'.'
name|'subscriptions'
op|':'
newline|'\n'
indent|'        '
name|'print'
name|'s'
newline|'\n'
name|'db'
op|'.'
name|'addSubscription'
op|'('
name|'s'
op|')'
newline|'\n'
dedent|''
name|'s'
op|'='
name|'config'
op|'['
string|"'port'"
op|']'
newline|'\n'
name|'if'
name|'config'
op|'['
string|"'interface'"
op|']'
op|':'
newline|'\n'
comment|'# Add a warning here'
nl|'\n'
indent|'        '
name|'s'
op|'+='
string|"':interface='"
op|'+'
name|'config'
op|'['
string|"'interface'"
op|']'
newline|'\n'
dedent|''
name|'return'
name|'strports'
op|'.'
name|'service'
op|'('
name|'s'
op|','
name|'news'
op|'.'
name|'UsenetServerFactory'
op|'('
name|'db'
op|','
name|'config'
op|'.'
name|'servers'
op|')'
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
