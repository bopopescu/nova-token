begin_unit
comment|'# -*- test-case-name: twisted.conch.test.test_default -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2009 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
string|'"""\nAccesses the key agent for user authentication.\n\nMaintainer: Paul Swartz\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'os'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'conch'
op|'.'
name|'ssh'
name|'import'
name|'agent'
op|','
name|'channel'
op|','
name|'keys'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'protocol'
op|','
name|'reactor'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'log'
newline|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
DECL|class|SSHAgentClient
name|'class'
name|'SSHAgentClient'
op|'('
name|'agent'
op|'.'
name|'SSHAgentClient'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'agent'
op|'.'
name|'SSHAgentClient'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'blobs'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|getPublicKeys
dedent|''
name|'def'
name|'getPublicKeys'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'requestIdentities'
op|'('
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbPublicKeys'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|_cbPublicKeys
dedent|''
name|'def'
name|'_cbPublicKeys'
op|'('
name|'self'
op|','
name|'blobcomm'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'log'
op|'.'
name|'msg'
op|'('
string|"'got %i public keys'"
op|'%'
name|'len'
op|'('
name|'blobcomm'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'blobs'
op|'='
op|'['
name|'x'
op|'['
number|'0'
op|']'
name|'for'
name|'x'
name|'in'
name|'blobcomm'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|getPublicKey
dedent|''
name|'def'
name|'getPublicKey'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Return a L{Key} from the first blob in C{self.blobs}, if any, or\n        return C{None}.\n        """'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'blobs'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'keys'
op|'.'
name|'Key'
op|'.'
name|'fromString'
op|'('
name|'self'
op|'.'
name|'blobs'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'None'
newline|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
DECL|class|SSHAgentForwardingChannel
dedent|''
dedent|''
name|'class'
name|'SSHAgentForwardingChannel'
op|'('
name|'channel'
op|'.'
name|'SSHChannel'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|channelOpen
indent|'    '
name|'def'
name|'channelOpen'
op|'('
name|'self'
op|','
name|'specificData'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cc'
op|'='
name|'protocol'
op|'.'
name|'ClientCreator'
op|'('
name|'reactor'
op|','
name|'SSHAgentForwardingLocal'
op|')'
newline|'\n'
name|'d'
op|'='
name|'cc'
op|'.'
name|'connectUNIX'
op|'('
name|'os'
op|'.'
name|'environ'
op|'['
string|"'SSH_AUTH_SOCK'"
op|']'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbGotLocal'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addErrback'
op|'('
name|'lambda'
name|'x'
op|':'
name|'self'
op|'.'
name|'loseConnection'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'buf'
op|'='
string|"''"
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|_cbGotLocal
dedent|''
name|'def'
name|'_cbGotLocal'
op|'('
name|'self'
op|','
name|'local'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'local'
op|'='
name|'local'
newline|'\n'
name|'self'
op|'.'
name|'dataReceived'
op|'='
name|'self'
op|'.'
name|'local'
op|'.'
name|'transport'
op|'.'
name|'write'
newline|'\n'
name|'self'
op|'.'
name|'local'
op|'.'
name|'dataReceived'
op|'='
name|'self'
op|'.'
name|'write'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|dataReceived
dedent|''
name|'def'
name|'dataReceived'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'buf'
op|'+='
name|'data'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|closed
dedent|''
name|'def'
name|'closed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'local'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'local'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'local'
op|'='
name|'None'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SSHAgentForwardingLocal
dedent|''
dedent|''
dedent|''
name|'class'
name|'SSHAgentForwardingLocal'
op|'('
name|'protocol'
op|'.'
name|'Protocol'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'pass'
newline|'\n'
dedent|''
endmarker|''
end_unit
