begin_unit
comment|'# Copyright (c) 2001-2007 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'cred'
name|'import'
name|'portal'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'components'
op|','
name|'log'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
op|'.'
name|'error'
name|'import'
name|'ProcessExitedAlready'
newline|'\n'
name|'from'
name|'zope'
name|'import'
name|'interface'
newline|'\n'
name|'from'
name|'ssh'
name|'import'
name|'session'
op|','
name|'forwarding'
op|','
name|'filetransfer'
newline|'\n'
name|'from'
name|'ssh'
op|'.'
name|'filetransfer'
name|'import'
name|'FXF_READ'
op|','
name|'FXF_WRITE'
op|','
name|'FXF_APPEND'
op|','
name|'FXF_CREAT'
op|','
name|'FXF_TRUNC'
op|','
name|'FXF_EXCL'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'conch'
op|'.'
name|'ls'
name|'import'
name|'lsLine'
newline|'\n'
nl|'\n'
name|'from'
name|'avatar'
name|'import'
name|'ConchUser'
newline|'\n'
name|'from'
name|'error'
name|'import'
name|'ConchError'
newline|'\n'
name|'from'
name|'interfaces'
name|'import'
name|'ISession'
op|','
name|'ISFTPServer'
op|','
name|'ISFTPFile'
newline|'\n'
nl|'\n'
name|'import'
name|'struct'
op|','
name|'os'
op|','
name|'time'
op|','
name|'socket'
newline|'\n'
name|'import'
name|'fcntl'
op|','
name|'tty'
newline|'\n'
name|'import'
name|'pwd'
op|','
name|'grp'
newline|'\n'
name|'import'
name|'pty'
newline|'\n'
name|'import'
name|'ttymodes'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'import'
name|'utmp'
newline|'\n'
dedent|''
name|'except'
name|'ImportError'
op|':'
newline|'\n'
DECL|variable|utmp
indent|'    '
name|'utmp'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|class|UnixSSHRealm
dedent|''
name|'class'
name|'UnixSSHRealm'
op|':'
newline|'\n'
indent|'    '
name|'interface'
op|'.'
name|'implements'
op|'('
name|'portal'
op|'.'
name|'IRealm'
op|')'
newline|'\n'
nl|'\n'
DECL|member|requestAvatar
name|'def'
name|'requestAvatar'
op|'('
name|'self'
op|','
name|'username'
op|','
name|'mind'
op|','
op|'*'
name|'interfaces'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|'='
name|'UnixConchUser'
op|'('
name|'username'
op|')'
newline|'\n'
name|'return'
name|'interfaces'
op|'['
number|'0'
op|']'
op|','
name|'user'
op|','
name|'user'
op|'.'
name|'logout'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|UnixConchUser
dedent|''
dedent|''
name|'class'
name|'UnixConchUser'
op|'('
name|'ConchUser'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'username'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ConchUser'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'username'
op|'='
name|'username'
newline|'\n'
name|'self'
op|'.'
name|'pwdData'
op|'='
name|'pwd'
op|'.'
name|'getpwnam'
op|'('
name|'self'
op|'.'
name|'username'
op|')'
newline|'\n'
name|'l'
op|'='
op|'['
name|'self'
op|'.'
name|'pwdData'
op|'['
number|'3'
op|']'
op|']'
newline|'\n'
name|'for'
name|'groupname'
op|','
name|'password'
op|','
name|'gid'
op|','
name|'userlist'
name|'in'
name|'grp'
op|'.'
name|'getgrall'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'username'
name|'in'
name|'userlist'
op|':'
newline|'\n'
indent|'                '
name|'l'
op|'.'
name|'append'
op|'('
name|'gid'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'otherGroups'
op|'='
name|'l'
newline|'\n'
name|'self'
op|'.'
name|'listeners'
op|'='
op|'{'
op|'}'
comment|'# dict mapping (interface, port) -> listener'
newline|'\n'
name|'self'
op|'.'
name|'channelLookup'
op|'.'
name|'update'
op|'('
nl|'\n'
op|'{'
string|'"session"'
op|':'
name|'session'
op|'.'
name|'SSHSession'
op|','
nl|'\n'
string|'"direct-tcpip"'
op|':'
name|'forwarding'
op|'.'
name|'openConnectForwardingClient'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'subsystemLookup'
op|'.'
name|'update'
op|'('
nl|'\n'
op|'{'
string|'"sftp"'
op|':'
name|'filetransfer'
op|'.'
name|'FileTransferServer'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getUserGroupId
dedent|''
name|'def'
name|'getUserGroupId'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'pwdData'
op|'['
number|'2'
op|':'
number|'4'
op|']'
newline|'\n'
nl|'\n'
DECL|member|getOtherGroups
dedent|''
name|'def'
name|'getOtherGroups'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'otherGroups'
newline|'\n'
nl|'\n'
DECL|member|getHomeDir
dedent|''
name|'def'
name|'getHomeDir'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'pwdData'
op|'['
number|'5'
op|']'
newline|'\n'
nl|'\n'
DECL|member|getShell
dedent|''
name|'def'
name|'getShell'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'pwdData'
op|'['
number|'6'
op|']'
newline|'\n'
nl|'\n'
DECL|member|global_tcpip_forward
dedent|''
name|'def'
name|'global_tcpip_forward'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'hostToBind'
op|','
name|'portToBind'
op|'='
name|'forwarding'
op|'.'
name|'unpackGlobal_tcpip_forward'
op|'('
name|'data'
op|')'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
name|'try'
op|':'
name|'listener'
op|'='
name|'self'
op|'.'
name|'_runAsUser'
op|'('
nl|'\n'
name|'reactor'
op|'.'
name|'listenTCP'
op|','
name|'portToBind'
op|','
nl|'\n'
name|'forwarding'
op|'.'
name|'SSHListenForwardingFactory'
op|'('
name|'self'
op|'.'
name|'conn'
op|','
nl|'\n'
op|'('
name|'hostToBind'
op|','
name|'portToBind'
op|')'
op|','
nl|'\n'
name|'forwarding'
op|'.'
name|'SSHListenServerForwardingChannel'
op|')'
op|','
nl|'\n'
name|'interface'
op|'='
name|'hostToBind'
op|')'
newline|'\n'
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'return'
number|'0'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'listeners'
op|'['
op|'('
name|'hostToBind'
op|','
name|'portToBind'
op|')'
op|']'
op|'='
name|'listener'
newline|'\n'
name|'if'
name|'portToBind'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'portToBind'
op|'='
name|'listener'
op|'.'
name|'getHost'
op|'('
op|')'
op|'['
number|'2'
op|']'
comment|'# the port'
newline|'\n'
name|'return'
number|'1'
op|','
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'>L'"
op|','
name|'portToBind'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'return'
number|'1'
newline|'\n'
nl|'\n'
DECL|member|global_cancel_tcpip_forward
dedent|''
dedent|''
dedent|''
name|'def'
name|'global_cancel_tcpip_forward'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'hostToBind'
op|','
name|'portToBind'
op|'='
name|'forwarding'
op|'.'
name|'unpackGlobal_tcpip_forward'
op|'('
name|'data'
op|')'
newline|'\n'
name|'listener'
op|'='
name|'self'
op|'.'
name|'listeners'
op|'.'
name|'get'
op|'('
op|'('
name|'hostToBind'
op|','
name|'portToBind'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'listener'
op|':'
newline|'\n'
indent|'            '
name|'return'
number|'0'
newline|'\n'
dedent|''
name|'del'
name|'self'
op|'.'
name|'listeners'
op|'['
op|'('
name|'hostToBind'
op|','
name|'portToBind'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_runAsUser'
op|'('
name|'listener'
op|'.'
name|'stopListening'
op|')'
newline|'\n'
name|'return'
number|'1'
newline|'\n'
nl|'\n'
DECL|member|logout
dedent|''
name|'def'
name|'logout'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# remove all listeners'
nl|'\n'
indent|'        '
name|'for'
name|'listener'
name|'in'
name|'self'
op|'.'
name|'listeners'
op|'.'
name|'itervalues'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_runAsUser'
op|'('
name|'listener'
op|'.'
name|'stopListening'
op|')'
newline|'\n'
dedent|''
name|'log'
op|'.'
name|'msg'
op|'('
string|"'avatar %s logging out (%i)'"
op|'%'
op|'('
name|'self'
op|'.'
name|'username'
op|','
name|'len'
op|'('
name|'self'
op|'.'
name|'listeners'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_runAsUser
dedent|''
name|'def'
name|'_runAsUser'
op|'('
name|'self'
op|','
name|'f'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'euid'
op|'='
name|'os'
op|'.'
name|'geteuid'
op|'('
op|')'
newline|'\n'
name|'egid'
op|'='
name|'os'
op|'.'
name|'getegid'
op|'('
op|')'
newline|'\n'
name|'groups'
op|'='
name|'os'
op|'.'
name|'getgroups'
op|'('
op|')'
newline|'\n'
name|'uid'
op|','
name|'gid'
op|'='
name|'self'
op|'.'
name|'getUserGroupId'
op|'('
op|')'
newline|'\n'
name|'os'
op|'.'
name|'setegid'
op|'('
number|'0'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'seteuid'
op|'('
number|'0'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'setgroups'
op|'('
name|'self'
op|'.'
name|'getOtherGroups'
op|'('
op|')'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'setegid'
op|'('
name|'gid'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'seteuid'
op|'('
name|'uid'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'f'
op|'='
name|'iter'
op|'('
name|'f'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'TypeError'
op|':'
newline|'\n'
indent|'            '
name|'f'
op|'='
op|'['
op|'('
name|'f'
op|','
name|'args'
op|','
name|'kw'
op|')'
op|']'
newline|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'i'
name|'in'
name|'f'
op|':'
newline|'\n'
indent|'                '
name|'func'
op|'='
name|'i'
op|'['
number|'0'
op|']'
newline|'\n'
name|'args'
op|'='
name|'len'
op|'('
name|'i'
op|')'
op|'>'
number|'1'
name|'and'
name|'i'
op|'['
number|'1'
op|']'
name|'or'
op|'('
op|')'
newline|'\n'
name|'kw'
op|'='
name|'len'
op|'('
name|'i'
op|')'
op|'>'
number|'2'
name|'and'
name|'i'
op|'['
number|'2'
op|']'
name|'or'
op|'{'
op|'}'
newline|'\n'
name|'r'
op|'='
name|'func'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kw'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'setegid'
op|'('
number|'0'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'seteuid'
op|'('
number|'0'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'setgroups'
op|'('
name|'groups'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'setegid'
op|'('
name|'egid'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'seteuid'
op|'('
name|'euid'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'r'
newline|'\n'
nl|'\n'
DECL|class|SSHSessionForUnixConchUser
dedent|''
dedent|''
name|'class'
name|'SSHSessionForUnixConchUser'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'interface'
op|'.'
name|'implements'
op|'('
name|'ISession'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'avatar'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'avatar'
op|'='
name|'avatar'
newline|'\n'
name|'self'
op|'.'
name|'environ'
op|'='
op|'{'
string|"'PATH'"
op|':'
string|"'/bin:/usr/bin:/usr/local/bin'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'pty'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'ptyTuple'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|addUTMPEntry
dedent|''
name|'def'
name|'addUTMPEntry'
op|'('
name|'self'
op|','
name|'loggedIn'
op|'='
number|'1'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'utmp'
op|':'
newline|'\n'
indent|'            '
name|'return'
newline|'\n'
dedent|''
name|'ipAddress'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'conn'
op|'.'
name|'transport'
op|'.'
name|'transport'
op|'.'
name|'getPeer'
op|'('
op|')'
op|'.'
name|'host'
newline|'\n'
name|'packedIp'
op|','
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'L'"
op|','
name|'socket'
op|'.'
name|'inet_aton'
op|'('
name|'ipAddress'
op|')'
op|')'
newline|'\n'
name|'ttyName'
op|'='
name|'self'
op|'.'
name|'ptyTuple'
op|'['
number|'2'
op|']'
op|'['
number|'5'
op|':'
op|']'
newline|'\n'
name|'t'
op|'='
name|'time'
op|'.'
name|'time'
op|'('
op|')'
newline|'\n'
name|'t1'
op|'='
name|'int'
op|'('
name|'t'
op|')'
newline|'\n'
name|'t2'
op|'='
name|'int'
op|'('
op|'('
name|'t'
op|'-'
name|'t1'
op|')'
op|'*'
number|'1e6'
op|')'
newline|'\n'
name|'entry'
op|'='
name|'utmp'
op|'.'
name|'UtmpEntry'
op|'('
op|')'
newline|'\n'
name|'entry'
op|'.'
name|'ut_type'
op|'='
name|'loggedIn'
name|'and'
name|'utmp'
op|'.'
name|'USER_PROCESS'
name|'or'
name|'utmp'
op|'.'
name|'DEAD_PROCESS'
newline|'\n'
name|'entry'
op|'.'
name|'ut_pid'
op|'='
name|'self'
op|'.'
name|'pty'
op|'.'
name|'pid'
newline|'\n'
name|'entry'
op|'.'
name|'ut_line'
op|'='
name|'ttyName'
newline|'\n'
name|'entry'
op|'.'
name|'ut_id'
op|'='
name|'ttyName'
op|'['
op|'-'
number|'4'
op|':'
op|']'
newline|'\n'
name|'entry'
op|'.'
name|'ut_tv'
op|'='
op|'('
name|'t1'
op|','
name|'t2'
op|')'
newline|'\n'
name|'if'
name|'loggedIn'
op|':'
newline|'\n'
indent|'            '
name|'entry'
op|'.'
name|'ut_user'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'username'
newline|'\n'
name|'entry'
op|'.'
name|'ut_host'
op|'='
name|'socket'
op|'.'
name|'gethostbyaddr'
op|'('
name|'ipAddress'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'entry'
op|'.'
name|'ut_addr_v6'
op|'='
op|'('
name|'packedIp'
op|','
number|'0'
op|','
number|'0'
op|','
number|'0'
op|')'
newline|'\n'
dedent|''
name|'a'
op|'='
name|'utmp'
op|'.'
name|'UtmpRecord'
op|'('
name|'utmp'
op|'.'
name|'UTMP_FILE'
op|')'
newline|'\n'
name|'a'
op|'.'
name|'pututline'
op|'('
name|'entry'
op|')'
newline|'\n'
name|'a'
op|'.'
name|'endutent'
op|'('
op|')'
newline|'\n'
name|'b'
op|'='
name|'utmp'
op|'.'
name|'UtmpRecord'
op|'('
name|'utmp'
op|'.'
name|'WTMP_FILE'
op|')'
newline|'\n'
name|'b'
op|'.'
name|'pututline'
op|'('
name|'entry'
op|')'
newline|'\n'
name|'b'
op|'.'
name|'endutent'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|getPty
dedent|''
name|'def'
name|'getPty'
op|'('
name|'self'
op|','
name|'term'
op|','
name|'windowSize'
op|','
name|'modes'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'environ'
op|'['
string|"'TERM'"
op|']'
op|'='
name|'term'
newline|'\n'
name|'self'
op|'.'
name|'winSize'
op|'='
name|'windowSize'
newline|'\n'
name|'self'
op|'.'
name|'modes'
op|'='
name|'modes'
newline|'\n'
name|'master'
op|','
name|'slave'
op|'='
name|'pty'
op|'.'
name|'openpty'
op|'('
op|')'
newline|'\n'
name|'ttyname'
op|'='
name|'os'
op|'.'
name|'ttyname'
op|'('
name|'slave'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'environ'
op|'['
string|"'SSH_TTY'"
op|']'
op|'='
name|'ttyname'
newline|'\n'
name|'self'
op|'.'
name|'ptyTuple'
op|'='
op|'('
name|'master'
op|','
name|'slave'
op|','
name|'ttyname'
op|')'
newline|'\n'
nl|'\n'
DECL|member|openShell
dedent|''
name|'def'
name|'openShell'
op|'('
name|'self'
op|','
name|'proto'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'ptyTuple'
op|':'
comment|"# we didn't get a pty-req"
newline|'\n'
indent|'            '
name|'log'
op|'.'
name|'msg'
op|'('
string|"'tried to get shell without pty, failing'"
op|')'
newline|'\n'
name|'raise'
name|'ConchError'
op|'('
string|'"no pty"'
op|')'
newline|'\n'
dedent|''
name|'uid'
op|','
name|'gid'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'getUserGroupId'
op|'('
op|')'
newline|'\n'
name|'homeDir'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'getHomeDir'
op|'('
op|')'
newline|'\n'
name|'shell'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'getShell'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'environ'
op|'['
string|"'USER'"
op|']'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'username'
newline|'\n'
name|'self'
op|'.'
name|'environ'
op|'['
string|"'HOME'"
op|']'
op|'='
name|'homeDir'
newline|'\n'
name|'self'
op|'.'
name|'environ'
op|'['
string|"'SHELL'"
op|']'
op|'='
name|'shell'
newline|'\n'
name|'shellExec'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'shell'
op|')'
newline|'\n'
name|'peer'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'conn'
op|'.'
name|'transport'
op|'.'
name|'transport'
op|'.'
name|'getPeer'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'conn'
op|'.'
name|'transport'
op|'.'
name|'transport'
op|'.'
name|'getHost'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'environ'
op|'['
string|"'SSH_CLIENT'"
op|']'
op|'='
string|"'%s %s %s'"
op|'%'
op|'('
name|'peer'
op|'.'
name|'host'
op|','
name|'peer'
op|'.'
name|'port'
op|','
name|'host'
op|'.'
name|'port'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'getPtyOwnership'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'pty'
op|'='
name|'reactor'
op|'.'
name|'spawnProcess'
op|'('
name|'proto'
op|','
name|'shell'
op|','
op|'['
string|"'-%s'"
op|'%'
name|'shellExec'
op|']'
op|','
name|'self'
op|'.'
name|'environ'
op|','
name|'homeDir'
op|','
name|'uid'
op|','
name|'gid'
op|','
nl|'\n'
name|'usePTY'
op|'='
name|'self'
op|'.'
name|'ptyTuple'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'addUTMPEntry'
op|'('
op|')'
newline|'\n'
name|'fcntl'
op|'.'
name|'ioctl'
op|'('
name|'self'
op|'.'
name|'pty'
op|'.'
name|'fileno'
op|'('
op|')'
op|','
name|'tty'
op|'.'
name|'TIOCSWINSZ'
op|','
nl|'\n'
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'4H'"
op|','
op|'*'
name|'self'
op|'.'
name|'winSize'
op|')'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'modes'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'setModes'
op|'('
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'oldWrite'
op|'='
name|'proto'
op|'.'
name|'transport'
op|'.'
name|'write'
newline|'\n'
name|'proto'
op|'.'
name|'transport'
op|'.'
name|'write'
op|'='
name|'self'
op|'.'
name|'_writeHack'
newline|'\n'
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'conn'
op|'.'
name|'transport'
op|'.'
name|'transport'
op|'.'
name|'setTcpNoDelay'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|execCommand
dedent|''
name|'def'
name|'execCommand'
op|'('
name|'self'
op|','
name|'proto'
op|','
name|'cmd'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
name|'uid'
op|','
name|'gid'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'getUserGroupId'
op|'('
op|')'
newline|'\n'
name|'homeDir'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'getHomeDir'
op|'('
op|')'
newline|'\n'
name|'shell'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'getShell'
op|'('
op|')'
name|'or'
string|"'/bin/sh'"
newline|'\n'
name|'command'
op|'='
op|'('
name|'shell'
op|','
string|"'-c'"
op|','
name|'cmd'
op|')'
newline|'\n'
name|'peer'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'conn'
op|'.'
name|'transport'
op|'.'
name|'transport'
op|'.'
name|'getPeer'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'conn'
op|'.'
name|'transport'
op|'.'
name|'transport'
op|'.'
name|'getHost'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'environ'
op|'['
string|"'SSH_CLIENT'"
op|']'
op|'='
string|"'%s %s %s'"
op|'%'
op|'('
name|'peer'
op|'.'
name|'host'
op|','
name|'peer'
op|'.'
name|'port'
op|','
name|'host'
op|'.'
name|'port'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'ptyTuple'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'getPtyOwnership'
op|'('
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'pty'
op|'='
name|'reactor'
op|'.'
name|'spawnProcess'
op|'('
name|'proto'
op|','
name|'shell'
op|','
name|'command'
op|','
name|'self'
op|'.'
name|'environ'
op|','
name|'homeDir'
op|','
nl|'\n'
name|'uid'
op|','
name|'gid'
op|','
name|'usePTY'
op|'='
name|'self'
op|'.'
name|'ptyTuple'
name|'or'
number|'0'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'ptyTuple'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'addUTMPEntry'
op|'('
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'modes'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'setModes'
op|'('
op|')'
newline|'\n'
comment|'#        else:'
nl|'\n'
comment|'#            tty.setraw(self.pty.pipes[0].fileno(), tty.TCSANOW)'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'conn'
op|'.'
name|'transport'
op|'.'
name|'transport'
op|'.'
name|'setTcpNoDelay'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getPtyOwnership
dedent|''
name|'def'
name|'getPtyOwnership'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ttyGid'
op|'='
name|'os'
op|'.'
name|'stat'
op|'('
name|'self'
op|'.'
name|'ptyTuple'
op|'['
number|'2'
op|']'
op|')'
op|'['
number|'5'
op|']'
newline|'\n'
name|'uid'
op|','
name|'gid'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'getUserGroupId'
op|'('
op|')'
newline|'\n'
name|'euid'
op|','
name|'egid'
op|'='
name|'os'
op|'.'
name|'geteuid'
op|'('
op|')'
op|','
name|'os'
op|'.'
name|'getegid'
op|'('
op|')'
newline|'\n'
name|'os'
op|'.'
name|'setegid'
op|'('
number|'0'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'seteuid'
op|'('
number|'0'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'chown'
op|'('
name|'self'
op|'.'
name|'ptyTuple'
op|'['
number|'2'
op|']'
op|','
name|'uid'
op|','
name|'ttyGid'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'setegid'
op|'('
name|'egid'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'seteuid'
op|'('
name|'euid'
op|')'
newline|'\n'
nl|'\n'
DECL|member|setModes
dedent|''
dedent|''
name|'def'
name|'setModes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pty'
op|'='
name|'self'
op|'.'
name|'pty'
newline|'\n'
name|'attr'
op|'='
name|'tty'
op|'.'
name|'tcgetattr'
op|'('
name|'pty'
op|'.'
name|'fileno'
op|'('
op|')'
op|')'
newline|'\n'
name|'for'
name|'mode'
op|','
name|'modeValue'
name|'in'
name|'self'
op|'.'
name|'modes'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'ttymodes'
op|'.'
name|'TTYMODES'
op|'.'
name|'has_key'
op|'('
name|'mode'
op|')'
op|':'
name|'continue'
newline|'\n'
name|'ttyMode'
op|'='
name|'ttymodes'
op|'.'
name|'TTYMODES'
op|'['
name|'mode'
op|']'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'ttyMode'
op|')'
op|'=='
number|'2'
op|':'
comment|'# flag'
newline|'\n'
indent|'                '
name|'flag'
op|','
name|'ttyAttr'
op|'='
name|'ttyMode'
newline|'\n'
name|'if'
name|'not'
name|'hasattr'
op|'('
name|'tty'
op|','
name|'ttyAttr'
op|')'
op|':'
name|'continue'
newline|'\n'
name|'ttyval'
op|'='
name|'getattr'
op|'('
name|'tty'
op|','
name|'ttyAttr'
op|')'
newline|'\n'
name|'if'
name|'modeValue'
op|':'
newline|'\n'
indent|'                    '
name|'attr'
op|'['
name|'flag'
op|']'
op|'='
name|'attr'
op|'['
name|'flag'
op|']'
op|'|'
name|'ttyval'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'attr'
op|'['
name|'flag'
op|']'
op|'='
name|'attr'
op|'['
name|'flag'
op|']'
op|'&'
op|'~'
name|'ttyval'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'ttyMode'
op|'=='
string|"'OSPEED'"
op|':'
newline|'\n'
indent|'                '
name|'attr'
op|'['
name|'tty'
op|'.'
name|'OSPEED'
op|']'
op|'='
name|'getattr'
op|'('
name|'tty'
op|','
string|"'B%s'"
op|'%'
name|'modeValue'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'ttyMode'
op|'=='
string|"'ISPEED'"
op|':'
newline|'\n'
indent|'                '
name|'attr'
op|'['
name|'tty'
op|'.'
name|'ISPEED'
op|']'
op|'='
name|'getattr'
op|'('
name|'tty'
op|','
string|"'B%s'"
op|'%'
name|'modeValue'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'not'
name|'hasattr'
op|'('
name|'tty'
op|','
name|'ttyMode'
op|')'
op|':'
name|'continue'
newline|'\n'
name|'ttyval'
op|'='
name|'getattr'
op|'('
name|'tty'
op|','
name|'ttyMode'
op|')'
newline|'\n'
name|'attr'
op|'['
name|'tty'
op|'.'
name|'CC'
op|']'
op|'['
name|'ttyval'
op|']'
op|'='
name|'chr'
op|'('
name|'modeValue'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'tty'
op|'.'
name|'tcsetattr'
op|'('
name|'pty'
op|'.'
name|'fileno'
op|'('
op|')'
op|','
name|'tty'
op|'.'
name|'TCSANOW'
op|','
name|'attr'
op|')'
newline|'\n'
nl|'\n'
DECL|member|eofReceived
dedent|''
name|'def'
name|'eofReceived'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'pty'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'pty'
op|'.'
name|'closeStdin'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|closed
dedent|''
dedent|''
name|'def'
name|'closed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'ptyTuple'
name|'and'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'self'
op|'.'
name|'ptyTuple'
op|'['
number|'2'
op|']'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'ttyGID'
op|'='
name|'os'
op|'.'
name|'stat'
op|'('
name|'self'
op|'.'
name|'ptyTuple'
op|'['
number|'2'
op|']'
op|')'
op|'['
number|'5'
op|']'
newline|'\n'
name|'os'
op|'.'
name|'chown'
op|'('
name|'self'
op|'.'
name|'ptyTuple'
op|'['
number|'2'
op|']'
op|','
number|'0'
op|','
name|'ttyGID'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'pty'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'pty'
op|'.'
name|'signalProcess'
op|'('
string|"'HUP'"
op|')'
newline|'\n'
dedent|''
name|'except'
op|'('
name|'OSError'
op|','
name|'ProcessExitedAlready'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'pty'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'addUTMPEntry'
op|'('
number|'0'
op|')'
newline|'\n'
dedent|''
name|'log'
op|'.'
name|'msg'
op|'('
string|"'shell closed'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|windowChanged
dedent|''
name|'def'
name|'windowChanged'
op|'('
name|'self'
op|','
name|'winSize'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'winSize'
op|'='
name|'winSize'
newline|'\n'
name|'fcntl'
op|'.'
name|'ioctl'
op|'('
name|'self'
op|'.'
name|'pty'
op|'.'
name|'fileno'
op|'('
op|')'
op|','
name|'tty'
op|'.'
name|'TIOCSWINSZ'
op|','
nl|'\n'
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'4H'"
op|','
op|'*'
name|'self'
op|'.'
name|'winSize'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_writeHack
dedent|''
name|'def'
name|'_writeHack'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Hack to send ignore messages when we aren\'t echoing.\n        """'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'pty'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'attr'
op|'='
name|'tty'
op|'.'
name|'tcgetattr'
op|'('
name|'self'
op|'.'
name|'pty'
op|'.'
name|'fileno'
op|'('
op|')'
op|')'
op|'['
number|'3'
op|']'
newline|'\n'
name|'if'
name|'not'
name|'attr'
op|'&'
name|'tty'
op|'.'
name|'ECHO'
name|'and'
name|'attr'
op|'&'
name|'tty'
op|'.'
name|'ICANON'
op|':'
comment|'# no echo'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'conn'
op|'.'
name|'transport'
op|'.'
name|'sendIgnore'
op|'('
string|"'\\x00'"
op|'*'
op|'('
number|'8'
op|'+'
name|'len'
op|'('
name|'data'
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'oldWrite'
op|'('
name|'data'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SFTPServerForUnixConchUser
dedent|''
dedent|''
name|'class'
name|'SFTPServerForUnixConchUser'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'interface'
op|'.'
name|'implements'
op|'('
name|'ISFTPServer'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'avatar'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'avatar'
op|'='
name|'avatar'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|_setAttrs
dedent|''
name|'def'
name|'_setAttrs'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'attrs'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        NOTE: this function assumes it runs as the logged-in user:\n        i.e. under _runAsUser()\n        """'
newline|'\n'
name|'if'
name|'attrs'
op|'.'
name|'has_key'
op|'('
string|'"uid"'
op|')'
name|'and'
name|'attrs'
op|'.'
name|'has_key'
op|'('
string|'"gid"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'chown'
op|'('
name|'path'
op|','
name|'attrs'
op|'['
string|'"uid"'
op|']'
op|','
name|'attrs'
op|'['
string|'"gid"'
op|']'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'attrs'
op|'.'
name|'has_key'
op|'('
string|'"permissions"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'chmod'
op|'('
name|'path'
op|','
name|'attrs'
op|'['
string|'"permissions"'
op|']'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'attrs'
op|'.'
name|'has_key'
op|'('
string|'"atime"'
op|')'
name|'and'
name|'attrs'
op|'.'
name|'has_key'
op|'('
string|'"mtime"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'utime'
op|'('
name|'path'
op|','
op|'('
name|'attrs'
op|'['
string|'"atime"'
op|']'
op|','
name|'attrs'
op|'['
string|'"mtime"'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_getAttrs
dedent|''
dedent|''
name|'def'
name|'_getAttrs'
op|'('
name|'self'
op|','
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
op|'{'
nl|'\n'
string|'"size"'
op|':'
name|'s'
op|'.'
name|'st_size'
op|','
nl|'\n'
string|'"uid"'
op|':'
name|'s'
op|'.'
name|'st_uid'
op|','
nl|'\n'
string|'"gid"'
op|':'
name|'s'
op|'.'
name|'st_gid'
op|','
nl|'\n'
string|'"permissions"'
op|':'
name|'s'
op|'.'
name|'st_mode'
op|','
nl|'\n'
string|'"atime"'
op|':'
name|'int'
op|'('
name|'s'
op|'.'
name|'st_atime'
op|')'
op|','
nl|'\n'
string|'"mtime"'
op|':'
name|'int'
op|'('
name|'s'
op|'.'
name|'st_mtime'
op|')'
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|_absPath
dedent|''
name|'def'
name|'_absPath'
op|'('
name|'self'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'home'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'getHomeDir'
op|'('
op|')'
newline|'\n'
name|'return'
name|'os'
op|'.'
name|'path'
op|'.'
name|'abspath'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'home'
op|','
name|'path'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|gotVersion
dedent|''
name|'def'
name|'gotVersion'
op|'('
name|'self'
op|','
name|'otherVersion'
op|','
name|'extData'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|openFile
dedent|''
name|'def'
name|'openFile'
op|'('
name|'self'
op|','
name|'filename'
op|','
name|'flags'
op|','
name|'attrs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'UnixSFTPFile'
op|'('
name|'self'
op|','
name|'self'
op|'.'
name|'_absPath'
op|'('
name|'filename'
op|')'
op|','
name|'flags'
op|','
name|'attrs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|removeFile
dedent|''
name|'def'
name|'removeFile'
op|'('
name|'self'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filename'
op|'='
name|'self'
op|'.'
name|'_absPath'
op|'('
name|'filename'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
name|'os'
op|'.'
name|'remove'
op|','
name|'filename'
op|')'
newline|'\n'
nl|'\n'
DECL|member|renameFile
dedent|''
name|'def'
name|'renameFile'
op|'('
name|'self'
op|','
name|'oldpath'
op|','
name|'newpath'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'oldpath'
op|'='
name|'self'
op|'.'
name|'_absPath'
op|'('
name|'oldpath'
op|')'
newline|'\n'
name|'newpath'
op|'='
name|'self'
op|'.'
name|'_absPath'
op|'('
name|'newpath'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
name|'os'
op|'.'
name|'rename'
op|','
name|'oldpath'
op|','
name|'newpath'
op|')'
newline|'\n'
nl|'\n'
DECL|member|makeDirectory
dedent|''
name|'def'
name|'makeDirectory'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'attrs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'path'
op|'='
name|'self'
op|'.'
name|'_absPath'
op|'('
name|'path'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
op|'['
op|'('
name|'os'
op|'.'
name|'mkdir'
op|','
op|'('
name|'path'
op|','
op|')'
op|')'
op|','
nl|'\n'
op|'('
name|'self'
op|'.'
name|'_setAttrs'
op|','
op|'('
name|'path'
op|','
name|'attrs'
op|')'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|removeDirectory
dedent|''
name|'def'
name|'removeDirectory'
op|'('
name|'self'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'path'
op|'='
name|'self'
op|'.'
name|'_absPath'
op|'('
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
name|'os'
op|'.'
name|'rmdir'
op|','
name|'path'
op|')'
newline|'\n'
nl|'\n'
DECL|member|openDirectory
dedent|''
name|'def'
name|'openDirectory'
op|'('
name|'self'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'UnixSFTPDirectory'
op|'('
name|'self'
op|','
name|'self'
op|'.'
name|'_absPath'
op|'('
name|'path'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getAttrs
dedent|''
name|'def'
name|'getAttrs'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'followLinks'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'path'
op|'='
name|'self'
op|'.'
name|'_absPath'
op|'('
name|'path'
op|')'
newline|'\n'
name|'if'
name|'followLinks'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
name|'os'
op|'.'
name|'stat'
op|','
name|'path'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'='
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
name|'os'
op|'.'
name|'lstat'
op|','
name|'path'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'_getAttrs'
op|'('
name|'s'
op|')'
newline|'\n'
nl|'\n'
DECL|member|setAttrs
dedent|''
name|'def'
name|'setAttrs'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'attrs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'path'
op|'='
name|'self'
op|'.'
name|'_absPath'
op|'('
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
name|'self'
op|'.'
name|'_setAttrs'
op|','
name|'path'
op|','
name|'attrs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|readLink
dedent|''
name|'def'
name|'readLink'
op|'('
name|'self'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'path'
op|'='
name|'self'
op|'.'
name|'_absPath'
op|'('
name|'path'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
name|'os'
op|'.'
name|'readlink'
op|','
name|'path'
op|')'
newline|'\n'
nl|'\n'
DECL|member|makeLink
dedent|''
name|'def'
name|'makeLink'
op|'('
name|'self'
op|','
name|'linkPath'
op|','
name|'targetPath'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'linkPath'
op|'='
name|'self'
op|'.'
name|'_absPath'
op|'('
name|'linkPath'
op|')'
newline|'\n'
name|'targetPath'
op|'='
name|'self'
op|'.'
name|'_absPath'
op|'('
name|'targetPath'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
name|'os'
op|'.'
name|'symlink'
op|','
name|'targetPath'
op|','
name|'linkPath'
op|')'
newline|'\n'
nl|'\n'
DECL|member|realPath
dedent|''
name|'def'
name|'realPath'
op|'('
name|'self'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'os'
op|'.'
name|'path'
op|'.'
name|'realpath'
op|'('
name|'self'
op|'.'
name|'_absPath'
op|'('
name|'path'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|extendedRequest
dedent|''
name|'def'
name|'extendedRequest'
op|'('
name|'self'
op|','
name|'extName'
op|','
name|'extData'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'NotImplementedError'
newline|'\n'
nl|'\n'
DECL|class|UnixSFTPFile
dedent|''
dedent|''
name|'class'
name|'UnixSFTPFile'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'interface'
op|'.'
name|'implements'
op|'('
name|'ISFTPFile'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'server'
op|','
name|'filename'
op|','
name|'flags'
op|','
name|'attrs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'server'
op|'='
name|'server'
newline|'\n'
name|'openFlags'
op|'='
number|'0'
newline|'\n'
name|'if'
name|'flags'
op|'&'
name|'FXF_READ'
op|'=='
name|'FXF_READ'
name|'and'
name|'flags'
op|'&'
name|'FXF_WRITE'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'openFlags'
op|'='
name|'os'
op|'.'
name|'O_RDONLY'
newline|'\n'
dedent|''
name|'if'
name|'flags'
op|'&'
name|'FXF_WRITE'
op|'=='
name|'FXF_WRITE'
name|'and'
name|'flags'
op|'&'
name|'FXF_READ'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'openFlags'
op|'='
name|'os'
op|'.'
name|'O_WRONLY'
newline|'\n'
dedent|''
name|'if'
name|'flags'
op|'&'
name|'FXF_WRITE'
op|'=='
name|'FXF_WRITE'
name|'and'
name|'flags'
op|'&'
name|'FXF_READ'
op|'=='
name|'FXF_READ'
op|':'
newline|'\n'
indent|'            '
name|'openFlags'
op|'='
name|'os'
op|'.'
name|'O_RDWR'
newline|'\n'
dedent|''
name|'if'
name|'flags'
op|'&'
name|'FXF_APPEND'
op|'=='
name|'FXF_APPEND'
op|':'
newline|'\n'
indent|'            '
name|'openFlags'
op|'|='
name|'os'
op|'.'
name|'O_APPEND'
newline|'\n'
dedent|''
name|'if'
name|'flags'
op|'&'
name|'FXF_CREAT'
op|'=='
name|'FXF_CREAT'
op|':'
newline|'\n'
indent|'            '
name|'openFlags'
op|'|='
name|'os'
op|'.'
name|'O_CREAT'
newline|'\n'
dedent|''
name|'if'
name|'flags'
op|'&'
name|'FXF_TRUNC'
op|'=='
name|'FXF_TRUNC'
op|':'
newline|'\n'
indent|'            '
name|'openFlags'
op|'|='
name|'os'
op|'.'
name|'O_TRUNC'
newline|'\n'
dedent|''
name|'if'
name|'flags'
op|'&'
name|'FXF_EXCL'
op|'=='
name|'FXF_EXCL'
op|':'
newline|'\n'
indent|'            '
name|'openFlags'
op|'|='
name|'os'
op|'.'
name|'O_EXCL'
newline|'\n'
dedent|''
name|'if'
name|'attrs'
op|'.'
name|'has_key'
op|'('
string|'"permissions"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'mode'
op|'='
name|'attrs'
op|'['
string|'"permissions"'
op|']'
newline|'\n'
name|'del'
name|'attrs'
op|'['
string|'"permissions"'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'mode'
op|'='
number|'0777'
newline|'\n'
dedent|''
name|'fd'
op|'='
name|'server'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
name|'os'
op|'.'
name|'open'
op|','
name|'filename'
op|','
name|'openFlags'
op|','
name|'mode'
op|')'
newline|'\n'
name|'if'
name|'attrs'
op|':'
newline|'\n'
indent|'            '
name|'server'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
name|'server'
op|'.'
name|'_setAttrs'
op|','
name|'filename'
op|','
name|'attrs'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'fd'
op|'='
name|'fd'
newline|'\n'
nl|'\n'
DECL|member|close
dedent|''
name|'def'
name|'close'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'server'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
name|'os'
op|'.'
name|'close'
op|','
name|'self'
op|'.'
name|'fd'
op|')'
newline|'\n'
nl|'\n'
DECL|member|readChunk
dedent|''
name|'def'
name|'readChunk'
op|'('
name|'self'
op|','
name|'offset'
op|','
name|'length'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'server'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
op|'['
op|'('
name|'os'
op|'.'
name|'lseek'
op|','
op|'('
name|'self'
op|'.'
name|'fd'
op|','
name|'offset'
op|','
number|'0'
op|')'
op|')'
op|','
nl|'\n'
op|'('
name|'os'
op|'.'
name|'read'
op|','
op|'('
name|'self'
op|'.'
name|'fd'
op|','
name|'length'
op|')'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|writeChunk
dedent|''
name|'def'
name|'writeChunk'
op|'('
name|'self'
op|','
name|'offset'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'server'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
op|'['
op|'('
name|'os'
op|'.'
name|'lseek'
op|','
op|'('
name|'self'
op|'.'
name|'fd'
op|','
name|'offset'
op|','
number|'0'
op|')'
op|')'
op|','
nl|'\n'
op|'('
name|'os'
op|'.'
name|'write'
op|','
op|'('
name|'self'
op|'.'
name|'fd'
op|','
name|'data'
op|')'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getAttrs
dedent|''
name|'def'
name|'getAttrs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'s'
op|'='
name|'self'
op|'.'
name|'server'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
name|'os'
op|'.'
name|'fstat'
op|','
name|'self'
op|'.'
name|'fd'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'server'
op|'.'
name|'_getAttrs'
op|'('
name|'s'
op|')'
newline|'\n'
nl|'\n'
DECL|member|setAttrs
dedent|''
name|'def'
name|'setAttrs'
op|'('
name|'self'
op|','
name|'attrs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'NotImplementedError'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|UnixSFTPDirectory
dedent|''
dedent|''
name|'class'
name|'UnixSFTPDirectory'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'server'
op|','
name|'directory'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'server'
op|'='
name|'server'
newline|'\n'
name|'self'
op|'.'
name|'files'
op|'='
name|'server'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
name|'os'
op|'.'
name|'listdir'
op|','
name|'directory'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'dir'
op|'='
name|'directory'
newline|'\n'
nl|'\n'
DECL|member|__iter__
dedent|''
name|'def'
name|'__iter__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
newline|'\n'
nl|'\n'
DECL|member|next
dedent|''
name|'def'
name|'next'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'f'
op|'='
name|'self'
op|'.'
name|'files'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'IndexError'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'StopIteration'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'='
name|'self'
op|'.'
name|'server'
op|'.'
name|'avatar'
op|'.'
name|'_runAsUser'
op|'('
name|'os'
op|'.'
name|'lstat'
op|','
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'dir'
op|','
name|'f'
op|')'
op|')'
newline|'\n'
name|'longname'
op|'='
name|'lsLine'
op|'('
name|'f'
op|','
name|'s'
op|')'
newline|'\n'
name|'attrs'
op|'='
name|'self'
op|'.'
name|'server'
op|'.'
name|'_getAttrs'
op|'('
name|'s'
op|')'
newline|'\n'
name|'return'
op|'('
name|'f'
op|','
name|'longname'
op|','
name|'attrs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|close
dedent|''
dedent|''
name|'def'
name|'close'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'files'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'components'
op|'.'
name|'registerAdapter'
op|'('
name|'SFTPServerForUnixConchUser'
op|','
name|'UnixConchUser'
op|','
name|'filetransfer'
op|'.'
name|'ISFTPServer'
op|')'
newline|'\n'
name|'components'
op|'.'
name|'registerAdapter'
op|'('
name|'SSHSessionForUnixConchUser'
op|','
name|'UnixConchUser'
op|','
name|'session'
op|'.'
name|'ISession'
op|')'
newline|'\n'
endmarker|''
end_unit
