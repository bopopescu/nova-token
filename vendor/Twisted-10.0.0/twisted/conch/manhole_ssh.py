begin_unit
comment|'# -*- test-case-name: twisted.conch.test.test_manhole -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
string|'"""\ninsults/SSH integration support.\n\n@author: Jp Calderone\n"""'
newline|'\n'
nl|'\n'
name|'from'
name|'zope'
op|'.'
name|'interface'
name|'import'
name|'implements'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'conch'
name|'import'
name|'avatar'
op|','
name|'interfaces'
name|'as'
name|'iconch'
op|','
name|'error'
name|'as'
name|'econch'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'conch'
op|'.'
name|'ssh'
name|'import'
name|'factory'
op|','
name|'keys'
op|','
name|'session'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'cred'
name|'import'
name|'credentials'
op|','
name|'checkers'
op|','
name|'portal'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'components'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'conch'
op|'.'
name|'insults'
name|'import'
name|'insults'
newline|'\n'
nl|'\n'
DECL|class|_Glue
name|'class'
name|'_Glue'
op|':'
newline|'\n'
indent|'    '
string|'"""A feeble class for making one attribute look like another.\n\n    This should be replaced with a real class at some point, probably.\n    Try not to write new code that uses it.\n    """'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'__dict__'
op|'.'
name|'update'
op|'('
name|'kw'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__getattr__
dedent|''
name|'def'
name|'__getattr__'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'AttributeError'
op|'('
name|'self'
op|'.'
name|'name'
op|','
string|'"has no attribute"'
op|','
name|'name'
op|')'
newline|'\n'
nl|'\n'
DECL|class|TerminalSessionTransport
dedent|''
dedent|''
name|'class'
name|'TerminalSessionTransport'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'proto'
op|','
name|'chainedProtocol'
op|','
name|'avatar'
op|','
name|'width'
op|','
name|'height'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'proto'
op|'='
name|'proto'
newline|'\n'
name|'self'
op|'.'
name|'avatar'
op|'='
name|'avatar'
newline|'\n'
name|'self'
op|'.'
name|'chainedProtocol'
op|'='
name|'chainedProtocol'
newline|'\n'
nl|'\n'
name|'session'
op|'='
name|'self'
op|'.'
name|'proto'
op|'.'
name|'session'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'proto'
op|'.'
name|'makeConnection'
op|'('
nl|'\n'
name|'_Glue'
op|'('
name|'write'
op|'='
name|'self'
op|'.'
name|'chainedProtocol'
op|'.'
name|'dataReceived'
op|','
nl|'\n'
name|'loseConnection'
op|'='
name|'lambda'
op|':'
name|'avatar'
op|'.'
name|'conn'
op|'.'
name|'sendClose'
op|'('
name|'session'
op|')'
op|','
nl|'\n'
name|'name'
op|'='
string|'"SSH Proto Transport"'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|loseConnection
name|'def'
name|'loseConnection'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'proto'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'chainedProtocol'
op|'.'
name|'makeConnection'
op|'('
nl|'\n'
name|'_Glue'
op|'('
name|'write'
op|'='
name|'self'
op|'.'
name|'proto'
op|'.'
name|'write'
op|','
nl|'\n'
name|'loseConnection'
op|'='
name|'loseConnection'
op|','
nl|'\n'
name|'name'
op|'='
string|'"Chained Proto Transport"'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# XXX TODO'
nl|'\n'
comment|'# chainedProtocol is supposed to be an ITerminalTransport,'
nl|'\n'
comment|'# maybe.  That means perhaps its terminalProtocol attribute is'
nl|'\n'
comment|'# an ITerminalProtocol, it could be.  So calling terminalSize'
nl|'\n'
comment|"# on that should do the right thing But it'd be nice to clean"
nl|'\n'
comment|'# this bit up.'
nl|'\n'
name|'self'
op|'.'
name|'chainedProtocol'
op|'.'
name|'terminalProtocol'
op|'.'
name|'terminalSize'
op|'('
name|'width'
op|','
name|'height'
op|')'
newline|'\n'
nl|'\n'
DECL|class|TerminalSession
dedent|''
dedent|''
name|'class'
name|'TerminalSession'
op|'('
name|'components'
op|'.'
name|'Adapter'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'implements'
op|'('
name|'iconch'
op|'.'
name|'ISession'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|transportFactory
name|'transportFactory'
op|'='
name|'TerminalSessionTransport'
newline|'\n'
DECL|variable|chainedProtocolFactory
name|'chainedProtocolFactory'
op|'='
name|'insults'
op|'.'
name|'ServerProtocol'
newline|'\n'
nl|'\n'
DECL|member|getPty
name|'def'
name|'getPty'
op|'('
name|'self'
op|','
name|'term'
op|','
name|'windowSize'
op|','
name|'attrs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'height'
op|','
name|'self'
op|'.'
name|'width'
op|'='
name|'windowSize'
op|'['
op|':'
number|'2'
op|']'
newline|'\n'
nl|'\n'
DECL|member|openShell
dedent|''
name|'def'
name|'openShell'
op|'('
name|'self'
op|','
name|'proto'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'transportFactory'
op|'('
nl|'\n'
name|'proto'
op|','
name|'self'
op|'.'
name|'chainedProtocolFactory'
op|'('
op|')'
op|','
nl|'\n'
name|'iconch'
op|'.'
name|'IConchUser'
op|'('
name|'self'
op|'.'
name|'original'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'width'
op|','
name|'self'
op|'.'
name|'height'
op|')'
newline|'\n'
nl|'\n'
DECL|member|execCommand
dedent|''
name|'def'
name|'execCommand'
op|'('
name|'self'
op|','
name|'proto'
op|','
name|'cmd'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'econch'
op|'.'
name|'ConchError'
op|'('
string|'"Cannot execute commands"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|closed
dedent|''
name|'def'
name|'closed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|class|TerminalUser
dedent|''
dedent|''
name|'class'
name|'TerminalUser'
op|'('
name|'avatar'
op|'.'
name|'ConchUser'
op|','
name|'components'
op|'.'
name|'Adapter'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'original'
op|','
name|'avatarId'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'components'
op|'.'
name|'Adapter'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
name|'original'
op|')'
newline|'\n'
name|'avatar'
op|'.'
name|'ConchUser'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'channelLookup'
op|'['
string|"'session'"
op|']'
op|'='
name|'session'
op|'.'
name|'SSHSession'
newline|'\n'
nl|'\n'
DECL|class|TerminalRealm
dedent|''
dedent|''
name|'class'
name|'TerminalRealm'
op|':'
newline|'\n'
DECL|variable|userFactory
indent|'    '
name|'userFactory'
op|'='
name|'TerminalUser'
newline|'\n'
DECL|variable|sessionFactory
name|'sessionFactory'
op|'='
name|'TerminalSession'
newline|'\n'
nl|'\n'
DECL|variable|transportFactory
name|'transportFactory'
op|'='
name|'TerminalSessionTransport'
newline|'\n'
DECL|variable|chainedProtocolFactory
name|'chainedProtocolFactory'
op|'='
name|'insults'
op|'.'
name|'ServerProtocol'
newline|'\n'
nl|'\n'
DECL|member|_getAvatar
name|'def'
name|'_getAvatar'
op|'('
name|'self'
op|','
name|'avatarId'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'comp'
op|'='
name|'components'
op|'.'
name|'Componentized'
op|'('
op|')'
newline|'\n'
name|'user'
op|'='
name|'self'
op|'.'
name|'userFactory'
op|'('
name|'comp'
op|','
name|'avatarId'
op|')'
newline|'\n'
name|'sess'
op|'='
name|'self'
op|'.'
name|'sessionFactory'
op|'('
name|'comp'
op|')'
newline|'\n'
nl|'\n'
name|'sess'
op|'.'
name|'transportFactory'
op|'='
name|'self'
op|'.'
name|'transportFactory'
newline|'\n'
name|'sess'
op|'.'
name|'chainedProtocolFactory'
op|'='
name|'self'
op|'.'
name|'chainedProtocolFactory'
newline|'\n'
nl|'\n'
name|'comp'
op|'.'
name|'setComponent'
op|'('
name|'iconch'
op|'.'
name|'IConchUser'
op|','
name|'user'
op|')'
newline|'\n'
name|'comp'
op|'.'
name|'setComponent'
op|'('
name|'iconch'
op|'.'
name|'ISession'
op|','
name|'sess'
op|')'
newline|'\n'
nl|'\n'
name|'return'
name|'user'
newline|'\n'
nl|'\n'
DECL|member|__init__
dedent|''
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'transportFactory'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'transportFactory'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'transportFactory'
op|'='
name|'transportFactory'
newline|'\n'
nl|'\n'
DECL|member|requestAvatar
dedent|''
dedent|''
name|'def'
name|'requestAvatar'
op|'('
name|'self'
op|','
name|'avatarId'
op|','
name|'mind'
op|','
op|'*'
name|'interfaces'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'i'
name|'in'
name|'interfaces'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'i'
name|'is'
name|'iconch'
op|'.'
name|'IConchUser'
op|':'
newline|'\n'
indent|'                '
name|'return'
op|'('
name|'iconch'
op|'.'
name|'IConchUser'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_getAvatar'
op|'('
name|'avatarId'
op|')'
op|','
nl|'\n'
name|'lambda'
op|':'
name|'None'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'raise'
name|'NotImplementedError'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|class|ConchFactory
dedent|''
dedent|''
name|'class'
name|'ConchFactory'
op|'('
name|'factory'
op|'.'
name|'SSHFactory'
op|')'
op|':'
newline|'\n'
DECL|variable|publicKey
indent|'    '
name|'publicKey'
op|'='
string|"'ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAGEArzJx8OYOnJmzf4tfBEvLi8DVPrJ3/c9k2I/Az64fxjHf9imyRJbixtQhlH9lfNjUIx+4LmrJH5QNRsFporcHDKOTwTTYLh5KmRpslkYHRivcJSkbh/C+BR3utDS555mV'"
newline|'\n'
nl|'\n'
DECL|variable|publicKeys
name|'publicKeys'
op|'='
op|'{'
nl|'\n'
string|"'ssh-rsa'"
op|':'
name|'keys'
op|'.'
name|'Key'
op|'.'
name|'fromString'
op|'('
name|'publicKey'
op|')'
nl|'\n'
op|'}'
newline|'\n'
name|'del'
name|'publicKey'
newline|'\n'
nl|'\n'
name|'privateKey'
op|'='
string|'"""-----BEGIN RSA PRIVATE KEY-----\nMIIByAIBAAJhAK8ycfDmDpyZs3+LXwRLy4vA1T6yd/3PZNiPwM+uH8Yx3/YpskSW\n4sbUIZR/ZXzY1CMfuC5qyR+UDUbBaaK3Bwyjk8E02C4eSpkabJZGB0Yr3CUpG4fw\nvgUd7rQ0ueeZlQIBIwJgbh+1VZfr7WftK5lu7MHtqE1S1vPWZQYE3+VUn8yJADyb\nZ4fsZaCrzW9lkIqXkE3GIY+ojdhZhkO1gbG0118sIgphwSWKRxK0mvh6ERxKqIt1\nxJEJO74EykXZV4oNJ8sjAjEA3J9r2ZghVhGN6V8DnQrTk24Td0E8hU8AcP0FVP+8\nPQm/g/aXf2QQkQT+omdHVEJrAjEAy0pL0EBH6EVS98evDCBtQw22OZT52qXlAwZ2\ngyTriKFVoqjeEjt3SZKKqXHSApP/AjBLpF99zcJJZRq2abgYlf9lv1chkrWqDHUu\nDZttmYJeEfiFBBavVYIF1dOlZT0G8jMCMBc7sOSZodFnAiryP+Qg9otSBjJ3bQML\npSTqy7c3a2AScC/YyOwkDaICHnnD3XyjMwIxALRzl0tQEKMXs6hH8ToUdlLROCrP\nEhQ0wahUTCk1gKA4uPD6TMTChavbh4K63OvbKg==\n-----END RSA PRIVATE KEY-----"""'
newline|'\n'
DECL|variable|privateKeys
name|'privateKeys'
op|'='
op|'{'
nl|'\n'
string|"'ssh-rsa'"
op|':'
name|'keys'
op|'.'
name|'Key'
op|'.'
name|'fromString'
op|'('
name|'privateKey'
op|')'
nl|'\n'
op|'}'
newline|'\n'
name|'del'
name|'privateKey'
newline|'\n'
nl|'\n'
DECL|function|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'portal'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'portal'
op|'='
name|'portal'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
