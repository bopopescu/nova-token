begin_unit
comment|'# -*- test-case-name: twisted.conch.test.test_mixin -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
string|'"""\nExperimental optimization\n\nThis module provides a single mixin class which allows protocols to\ncollapse numerous small writes into a single larger one.\n\n@author: Jp Calderone\n"""'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
nl|'\n'
DECL|class|BufferingMixin
name|'class'
name|'BufferingMixin'
op|':'
newline|'\n'
indent|'    '
string|'"""Mixin which adds write buffering.\n    """'
newline|'\n'
DECL|variable|_delayedWriteCall
name|'_delayedWriteCall'
op|'='
name|'None'
newline|'\n'
DECL|variable|bytes
name|'bytes'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|variable|DELAY
name|'DELAY'
op|'='
number|'0.0'
newline|'\n'
nl|'\n'
DECL|member|schedule
name|'def'
name|'schedule'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'reactor'
op|'.'
name|'callLater'
op|'('
name|'self'
op|'.'
name|'DELAY'
op|','
name|'self'
op|'.'
name|'flush'
op|')'
newline|'\n'
nl|'\n'
DECL|member|reschedule
dedent|''
name|'def'
name|'reschedule'
op|'('
name|'self'
op|','
name|'token'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'token'
op|'.'
name|'reset'
op|'('
name|'self'
op|'.'
name|'DELAY'
op|')'
newline|'\n'
nl|'\n'
DECL|member|write
dedent|''
name|'def'
name|'write'
op|'('
name|'self'
op|','
name|'bytes'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Buffer some bytes to be written soon.\n\n        Every call to this function delays the real write by C{self.DELAY}\n        seconds.  When the delay expires, all collected bytes are written\n        to the underlying transport using L{ITransport.writeSequence}.\n        """'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_delayedWriteCall'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'bytes'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_delayedWriteCall'
op|'='
name|'self'
op|'.'
name|'schedule'
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'reschedule'
op|'('
name|'self'
op|'.'
name|'_delayedWriteCall'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'bytes'
op|'.'
name|'append'
op|'('
name|'bytes'
op|')'
newline|'\n'
nl|'\n'
DECL|member|flush
dedent|''
name|'def'
name|'flush'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Flush the buffer immediately.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'_delayedWriteCall'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'writeSequence'
op|'('
name|'self'
op|'.'
name|'bytes'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'bytes'
op|'='
name|'None'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
