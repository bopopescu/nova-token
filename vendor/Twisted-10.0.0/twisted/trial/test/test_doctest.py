begin_unit
comment|'# Copyright (c) 2001-2008 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
string|'"""\nTest twisted\'s doctest support.\n"""'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'trial'
name|'import'
name|'itrial'
op|','
name|'runner'
op|','
name|'unittest'
op|','
name|'reporter'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'trial'
op|'.'
name|'test'
name|'import'
name|'mockdoctest'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestRunners
name|'class'
name|'TestRunners'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    Tests for Twisted\'s doctest support.\n    """'
newline|'\n'
nl|'\n'
DECL|member|test_id
name|'def'
name|'test_id'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Check that the id() of the doctests\' case object contains the FQPN of\n        the actual tests. We need this because id() has weird behaviour w/\n        doctest in Python 2.3.\n        """'
newline|'\n'
name|'loader'
op|'='
name|'runner'
op|'.'
name|'TestLoader'
op|'('
op|')'
newline|'\n'
name|'suite'
op|'='
name|'loader'
op|'.'
name|'loadDoctests'
op|'('
name|'mockdoctest'
op|')'
newline|'\n'
name|'idPrefix'
op|'='
string|"'twisted.trial.test.mockdoctest.Counter'"
newline|'\n'
name|'for'
name|'test'
name|'in'
name|'suite'
op|'.'
name|'_tests'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'idPrefix'
op|','
name|'itrial'
op|'.'
name|'ITestCase'
op|'('
name|'test'
op|')'
op|'.'
name|'id'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|makeDocSuite
dedent|''
dedent|''
name|'def'
name|'makeDocSuite'
op|'('
name|'self'
op|','
name|'module'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Return a L{runner.DocTestSuite} for the doctests in C{module}.\n        """'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'assertWarns'
op|'('
nl|'\n'
name|'DeprecationWarning'
op|','
string|'"DocTestSuite is deprecated in Twisted 8.0."'
op|','
nl|'\n'
name|'__file__'
op|','
name|'lambda'
op|':'
name|'runner'
op|'.'
name|'DocTestSuite'
op|'('
name|'mockdoctest'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_correctCount
dedent|''
name|'def'
name|'test_correctCount'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        L{countTestCases} returns the number of doctests in the module.\n        """'
newline|'\n'
name|'suite'
op|'='
name|'self'
op|'.'
name|'makeDocSuite'
op|'('
name|'mockdoctest'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'7'
op|','
name|'suite'
op|'.'
name|'countTestCases'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_basicTrialIntegration
dedent|''
name|'def'
name|'test_basicTrialIntegration'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        L{loadDoctests} loads all of the doctests in the given module.\n        """'
newline|'\n'
name|'loader'
op|'='
name|'runner'
op|'.'
name|'TestLoader'
op|'('
op|')'
newline|'\n'
name|'suite'
op|'='
name|'loader'
op|'.'
name|'loadDoctests'
op|'('
name|'mockdoctest'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'7'
op|','
name|'suite'
op|'.'
name|'countTestCases'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|_testRun
dedent|''
name|'def'
name|'_testRun'
op|'('
name|'self'
op|','
name|'suite'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Run C{suite} and check the result.\n        """'
newline|'\n'
name|'result'
op|'='
name|'reporter'
op|'.'
name|'TestResult'
op|'('
op|')'
newline|'\n'
name|'suite'
op|'.'
name|'run'
op|'('
name|'result'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'5'
op|','
name|'result'
op|'.'
name|'successes'
op|')'
newline|'\n'
comment|'# doctest reports failures as errors in 2.3'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'2'
op|','
name|'len'
op|'('
name|'result'
op|'.'
name|'errors'
op|')'
op|'+'
name|'len'
op|'('
name|'result'
op|'.'
name|'failures'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_expectedResults
dedent|''
name|'def'
name|'test_expectedResults'
op|'('
name|'self'
op|','
name|'count'
op|'='
number|'1'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Trial can correctly run doctests with its xUnit test APIs.\n        """'
newline|'\n'
name|'suite'
op|'='
name|'runner'
op|'.'
name|'TestLoader'
op|'('
op|')'
op|'.'
name|'loadDoctests'
op|'('
name|'mockdoctest'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_testRun'
op|'('
name|'suite'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_repeatable
dedent|''
name|'def'
name|'test_repeatable'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Doctests should be runnable repeatably.\n        """'
newline|'\n'
name|'suite'
op|'='
name|'runner'
op|'.'
name|'TestLoader'
op|'('
op|')'
op|'.'
name|'loadDoctests'
op|'('
name|'mockdoctest'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_testRun'
op|'('
name|'suite'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_testRun'
op|'('
name|'suite'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
