begin_unit
comment|'# Copyright (c) 2008 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
string|'"""\nTests for the output generated by trial.\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'os'
op|','
name|'StringIO'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'scripts'
name|'import'
name|'trial'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'trial'
name|'import'
name|'runner'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'trial'
op|'.'
name|'test'
name|'import'
name|'packages'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|runTrial
name|'def'
name|'runTrial'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'from'
name|'twisted'
op|'.'
name|'trial'
name|'import'
name|'reporter'
newline|'\n'
name|'config'
op|'='
name|'trial'
op|'.'
name|'Options'
op|'('
op|')'
newline|'\n'
name|'config'
op|'.'
name|'parseOptions'
op|'('
name|'args'
op|')'
newline|'\n'
name|'output'
op|'='
name|'StringIO'
op|'.'
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'myRunner'
op|'='
name|'runner'
op|'.'
name|'TrialRunner'
op|'('
nl|'\n'
name|'reporter'
op|'.'
name|'VerboseTextReporter'
op|','
nl|'\n'
name|'stream'
op|'='
name|'output'
op|','
nl|'\n'
name|'workingDirectory'
op|'='
name|'config'
op|'['
string|"'temp-directory'"
op|']'
op|')'
newline|'\n'
name|'suite'
op|'='
name|'trial'
op|'.'
name|'_getSuite'
op|'('
name|'config'
op|')'
newline|'\n'
name|'result'
op|'='
name|'myRunner'
op|'.'
name|'run'
op|'('
name|'suite'
op|')'
newline|'\n'
name|'return'
name|'output'
op|'.'
name|'getvalue'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestImportErrors
dedent|''
name|'class'
name|'TestImportErrors'
op|'('
name|'packages'
op|'.'
name|'SysPathManglingTest'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Actually run trial as if on the command line and check that the output\n    is what we expect.\n    """'
newline|'\n'
nl|'\n'
DECL|variable|debug
name|'debug'
op|'='
name|'False'
newline|'\n'
DECL|variable|parent
name|'parent'
op|'='
string|'"_testImportErrors"'
newline|'\n'
DECL|member|runTrial
name|'def'
name|'runTrial'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'runTrial'
op|'('
string|"'--temp-directory'"
op|','
name|'self'
op|'.'
name|'mktemp'
op|'('
op|')'
op|','
op|'*'
name|'args'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_print
dedent|''
name|'def'
name|'_print'
op|'('
name|'self'
op|','
name|'stuff'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
name|'stuff'
newline|'\n'
name|'return'
name|'stuff'
newline|'\n'
nl|'\n'
DECL|member|failUnlessIn
dedent|''
name|'def'
name|'failUnlessIn'
op|'('
name|'self'
op|','
name|'container'
op|','
name|'containee'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
comment|'# redefined to be useful in callbacks'
nl|'\n'
indent|'        '
name|'super'
op|'('
name|'TestImportErrors'
op|','
name|'self'
op|')'
op|'.'
name|'failUnlessIn'
op|'('
nl|'\n'
name|'containee'
op|','
name|'container'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
name|'return'
name|'container'
newline|'\n'
nl|'\n'
DECL|member|failIfIn
dedent|''
name|'def'
name|'failIfIn'
op|'('
name|'self'
op|','
name|'container'
op|','
name|'containee'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
comment|'# redefined to be useful in callbacks'
nl|'\n'
indent|'        '
name|'super'
op|'('
name|'TestImportErrors'
op|','
name|'self'
op|')'
op|'.'
name|'failIfIn'
op|'('
nl|'\n'
name|'containee'
op|','
name|'container'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
name|'return'
name|'container'
newline|'\n'
nl|'\n'
DECL|member|test_trialRun
dedent|''
name|'def'
name|'test_trialRun'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'runTrial'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_nonexistentModule
dedent|''
name|'def'
name|'test_nonexistentModule'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'runTrial'
op|'('
string|"'twisted.doesntexist'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'[ERROR]'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'twisted.doesntexist'"
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|test_nonexistentPackage
dedent|''
name|'def'
name|'test_nonexistentPackage'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'runTrial'
op|'('
string|"'doesntexist'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'doesntexist'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'ModuleNotFound'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'[ERROR]'"
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|test_nonexistentPackageWithModule
dedent|''
name|'def'
name|'test_nonexistentPackageWithModule'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'runTrial'
op|'('
string|"'doesntexist.barney'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'doesntexist.barney'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'ObjectNotFound'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'[ERROR]'"
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|test_badpackage
dedent|''
name|'def'
name|'test_badpackage'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'runTrial'
op|'('
string|"'badpackage'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'[ERROR]'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'badpackage'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'IOError'"
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|test_moduleInBadpackage
dedent|''
name|'def'
name|'test_moduleInBadpackage'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'runTrial'
op|'('
string|"'badpackage.test_module'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|'"[ERROR]"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|'"badpackage.test_module"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'IOError'"
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|test_badmodule
dedent|''
name|'def'
name|'test_badmodule'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'runTrial'
op|'('
string|"'package.test_bad_module'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'[ERROR]'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'package.test_bad_module'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'IOError'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'<module '"
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|test_badimport
dedent|''
name|'def'
name|'test_badimport'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'runTrial'
op|'('
string|"'package.test_import_module'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'[ERROR]'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'package.test_import_module'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'IOError'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'<module '"
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|test_recurseImport
dedent|''
name|'def'
name|'test_recurseImport'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'runTrial'
op|'('
string|"'package'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'[ERROR]'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'test_bad_module'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'test_import_module'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'<module '"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'IOError'"
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|test_recurseImportErrors
dedent|''
name|'def'
name|'test_recurseImportErrors'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'runTrial'
op|'('
string|"'package2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'[ERROR]'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'package2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'test_module'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|'"No module named frotz"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'<module '"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'IOError'"
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|test_nonRecurseImportErrors
dedent|''
name|'def'
name|'test_nonRecurseImportErrors'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'runTrial'
op|'('
string|"'-N'"
op|','
string|"'package2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'[ERROR]'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|'"No module named frotz"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'<module '"
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|test_regularRun
dedent|''
name|'def'
name|'test_regularRun'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'runTrial'
op|'('
string|"'package.test_module'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'[ERROR]'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'IOError'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'OK'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'PASSED (successes=1)'"
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|test_filename
dedent|''
name|'def'
name|'test_filename'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mangleSysPath'
op|'('
name|'self'
op|'.'
name|'oldPath'
op|')'
newline|'\n'
name|'d'
op|'='
name|'self'
op|'.'
name|'runTrial'
op|'('
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'parent'
op|','
string|"'package'"
op|','
string|"'test_module.py'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'[ERROR]'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'IOError'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'OK'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'PASSED (successes=1)'"
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|test_dosFile
dedent|''
name|'def'
name|'test_dosFile'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'## XXX -- not really an output test, more of a script test'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'mangleSysPath'
op|'('
name|'self'
op|'.'
name|'oldPath'
op|')'
newline|'\n'
name|'d'
op|'='
name|'self'
op|'.'
name|'runTrial'
op|'('
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'parent'
op|','
nl|'\n'
string|"'package'"
op|','
string|"'test_dos_module.py'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'[ERROR]'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failIfIn'
op|'('
name|'d'
op|','
string|"'IOError'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'OK'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessIn'
op|'('
name|'d'
op|','
string|"'PASSED (successes=1)'"
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
