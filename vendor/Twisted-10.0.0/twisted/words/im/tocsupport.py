begin_unit
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
string|'"""TOC (i.e. AIM) support for Instance Messenger."""'
newline|'\n'
nl|'\n'
comment|'# System Imports'
nl|'\n'
name|'import'
name|'string'
op|','
name|'re'
newline|'\n'
name|'from'
name|'zope'
op|'.'
name|'interface'
name|'import'
name|'implements'
newline|'\n'
nl|'\n'
comment|'# Twisted Imports'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'words'
op|'.'
name|'protocols'
name|'import'
name|'toc'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'words'
op|'.'
name|'im'
op|'.'
name|'locals'
name|'import'
name|'ONLINE'
op|','
name|'OFFLINE'
op|','
name|'AWAY'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'defer'
op|','
name|'reactor'
op|','
name|'protocol'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
op|'.'
name|'defer'
name|'import'
name|'succeed'
newline|'\n'
nl|'\n'
comment|'# Sibling Imports'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'words'
op|'.'
name|'im'
name|'import'
name|'basesupport'
op|','
name|'interfaces'
op|','
name|'locals'
newline|'\n'
nl|'\n'
DECL|function|dehtml
name|'def'
name|'dehtml'
op|'('
name|'text'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|'"<br>"'
op|','
string|'"\\n"'
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|'"<BR>"'
op|','
string|'"\\n"'
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|'"<Br>"'
op|','
string|'"\\n"'
op|')'
comment|'# XXX make this a regexp'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|'"<bR>"'
op|','
string|'"\\n"'
op|')'
newline|'\n'
name|'text'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"'<.*?>'"
op|','
string|"''"
op|','
name|'text'
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'&gt;'"
op|','
string|"'>'"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'&lt;'"
op|','
string|"'<'"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'&amp;'"
op|','
string|"'&'"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'&nbsp;'"
op|','
string|"' '"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'&#34;'"
op|','
string|'\'"\''
op|')'
newline|'\n'
name|'return'
name|'text'
newline|'\n'
nl|'\n'
DECL|function|html
dedent|''
name|'def'
name|'html'
op|'('
name|'text'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|'\'"\''
op|','
string|"'&#34;'"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'&amp;'"
op|','
string|"'&'"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'&lt;'"
op|','
string|"'<'"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'&gt;'"
op|','
string|"'>'"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|'"\\n"'
op|','
string|'"<br>"'
op|')'
newline|'\n'
name|'return'
string|'\'<font color="#000000" back="#ffffff" size=3>%s</font>\''
op|'%'
name|'text'
newline|'\n'
nl|'\n'
DECL|class|TOCPerson
dedent|''
name|'class'
name|'TOCPerson'
op|'('
name|'basesupport'
op|'.'
name|'AbstractPerson'
op|')'
op|':'
newline|'\n'
DECL|member|isOnline
indent|'    '
name|'def'
name|'isOnline'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'status'
op|'!='
name|'OFFLINE'
newline|'\n'
nl|'\n'
DECL|member|getStatus
dedent|''
name|'def'
name|'getStatus'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'status'
newline|'\n'
nl|'\n'
DECL|member|getIdleTime
dedent|''
name|'def'
name|'getIdleTime'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'str'
op|'('
name|'self'
op|'.'
name|'idletime'
op|')'
newline|'\n'
nl|'\n'
DECL|member|setStatusAndIdle
dedent|''
name|'def'
name|'setStatusAndIdle'
op|'('
name|'self'
op|','
name|'status'
op|','
name|'idletime'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'account'
op|'.'
name|'client'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'locals'
op|'.'
name|'OfflineError'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'status'
op|'='
name|'status'
newline|'\n'
name|'self'
op|'.'
name|'idletime'
op|'='
name|'idletime'
newline|'\n'
name|'self'
op|'.'
name|'account'
op|'.'
name|'client'
op|'.'
name|'chat'
op|'.'
name|'getContactsList'
op|'('
op|')'
op|'.'
name|'setContactStatus'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|sendMessage
dedent|''
name|'def'
name|'sendMessage'
op|'('
name|'self'
op|','
name|'text'
op|','
name|'meta'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'account'
op|'.'
name|'client'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'locals'
op|'.'
name|'OfflineError'
newline|'\n'
dedent|''
name|'if'
name|'meta'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'meta'
op|'.'
name|'get'
op|'('
string|'"style"'
op|','
name|'None'
op|')'
op|'=='
string|'"emote"'
op|':'
newline|'\n'
indent|'                '
name|'text'
op|'='
string|'"* "'
op|'+'
name|'text'
op|'+'
string|'"* "'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'account'
op|'.'
name|'client'
op|'.'
name|'say'
op|'('
name|'self'
op|'.'
name|'name'
op|','
name|'html'
op|'('
name|'text'
op|')'
op|')'
newline|'\n'
name|'return'
name|'succeed'
op|'('
name|'text'
op|')'
newline|'\n'
nl|'\n'
DECL|class|TOCGroup
dedent|''
dedent|''
name|'class'
name|'TOCGroup'
op|'('
name|'basesupport'
op|'.'
name|'AbstractGroup'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'implements'
op|'('
name|'interfaces'
op|'.'
name|'IGroup'
op|')'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'tocAccount'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'basesupport'
op|'.'
name|'AbstractGroup'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'tocAccount'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'roomID'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'roomID'
op|'['
name|'self'
op|'.'
name|'name'
op|']'
newline|'\n'
nl|'\n'
DECL|member|sendGroupMessage
dedent|''
name|'def'
name|'sendGroupMessage'
op|'('
name|'self'
op|','
name|'text'
op|','
name|'meta'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'account'
op|'.'
name|'client'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'locals'
op|'.'
name|'OfflineError'
newline|'\n'
dedent|''
name|'if'
name|'meta'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'meta'
op|'.'
name|'get'
op|'('
string|'"style"'
op|','
name|'None'
op|')'
op|'=='
string|'"emote"'
op|':'
newline|'\n'
indent|'                '
name|'text'
op|'='
string|'"* "'
op|'+'
name|'text'
op|'+'
string|'"* "'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'account'
op|'.'
name|'client'
op|'.'
name|'chat_say'
op|'('
name|'self'
op|'.'
name|'roomID'
op|','
name|'html'
op|'('
name|'text'
op|')'
op|')'
newline|'\n'
name|'return'
name|'succeed'
op|'('
name|'text'
op|')'
newline|'\n'
nl|'\n'
DECL|member|leave
dedent|''
name|'def'
name|'leave'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'account'
op|'.'
name|'client'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'locals'
op|'.'
name|'OfflineError'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'account'
op|'.'
name|'client'
op|'.'
name|'chat_leave'
op|'('
name|'self'
op|'.'
name|'roomID'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TOCProto
dedent|''
dedent|''
name|'class'
name|'TOCProto'
op|'('
name|'basesupport'
op|'.'
name|'AbstractClientMixin'
op|','
name|'toc'
op|'.'
name|'TOCClient'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'account'
op|','
name|'chatui'
op|','
name|'logonDeferred'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'toc'
op|'.'
name|'TOCClient'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
name|'account'
op|'.'
name|'username'
op|','
name|'account'
op|'.'
name|'password'
op|')'
newline|'\n'
name|'basesupport'
op|'.'
name|'AbstractClientMixin'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
name|'account'
op|','
name|'chatui'
op|','
nl|'\n'
name|'logonDeferred'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'roomID'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'roomIDreverse'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|_debug
dedent|''
name|'def'
name|'_debug'
op|'('
name|'self'
op|','
name|'m'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
comment|"#print '<toc debug>', repr(m)"
newline|'\n'
nl|'\n'
DECL|member|getGroupConversation
dedent|''
name|'def'
name|'getGroupConversation'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'hide'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'chat'
op|'.'
name|'getGroupConversation'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'chat'
op|'.'
name|'getGroup'
op|'('
name|'name'
op|','
name|'self'
op|')'
op|','
name|'hide'
op|')'
newline|'\n'
nl|'\n'
DECL|member|addContact
dedent|''
name|'def'
name|'addContact'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'add_buddy'
op|'('
op|'['
name|'name'
op|']'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'_buddylist'
op|'.'
name|'has_key'
op|'('
string|"'TwistedIM'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_buddylist'
op|'['
string|"'TwistedIM'"
op|']'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'if'
name|'name'
name|'in'
name|'self'
op|'.'
name|'_buddylist'
op|'['
string|"'TwistedIM'"
op|']'
op|':'
newline|'\n'
comment|"# whoops, don't add again"
nl|'\n'
indent|'            '
name|'return'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'_buddylist'
op|'['
string|"'TwistedIM'"
op|']'
op|'.'
name|'append'
op|'('
name|'name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'set_config'
op|'('
name|'self'
op|'.'
name|'_config_mode'
op|','
name|'self'
op|'.'
name|'_buddylist'
op|','
name|'self'
op|'.'
name|'_permit'
op|','
name|'self'
op|'.'
name|'_deny'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getPerson
dedent|''
name|'def'
name|'getPerson'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'chat'
op|'.'
name|'getPerson'
op|'('
name|'name'
op|','
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|onLine
dedent|''
name|'def'
name|'onLine'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'account'
op|'.'
name|'_isOnline'
op|'='
number|'1'
newline|'\n'
comment|"#print '$$!&*$&!(@$*& TOC ONLINE *!#@&$(!*%&'"
nl|'\n'
nl|'\n'
DECL|member|gotConfig
dedent|''
name|'def'
name|'gotConfig'
op|'('
name|'self'
op|','
name|'mode'
op|','
name|'buddylist'
op|','
name|'permit'
op|','
name|'deny'
op|')'
op|':'
newline|'\n'
comment|"#print 'got toc config', repr(mode), repr(buddylist), repr(permit), repr(deny)"
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'_config_mode'
op|'='
name|'mode'
newline|'\n'
name|'self'
op|'.'
name|'_buddylist'
op|'='
name|'buddylist'
newline|'\n'
name|'self'
op|'.'
name|'_permit'
op|'='
name|'permit'
newline|'\n'
name|'self'
op|'.'
name|'_deny'
op|'='
name|'deny'
newline|'\n'
name|'if'
name|'permit'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_debug'
op|'('
string|"'adding permit'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'add_permit'
op|'('
name|'permit'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'deny'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_debug'
op|'('
string|"'adding deny'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'add_deny'
op|'('
name|'deny'
op|')'
newline|'\n'
dedent|''
name|'clist'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'k'
name|'in'
name|'buddylist'
op|'.'
name|'keys'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'add_buddy'
op|'('
name|'buddylist'
op|'['
name|'k'
op|']'
op|')'
newline|'\n'
name|'for'
name|'name'
name|'in'
name|'buddylist'
op|'['
name|'k'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'getPerson'
op|'('
name|'name'
op|')'
op|'.'
name|'setStatusAndIdle'
op|'('
name|'OFFLINE'
op|','
string|"'--'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'signon'
op|'('
op|')'
newline|'\n'
DECL|variable|name
dedent|''
name|'name'
op|'='
name|'None'
newline|'\n'
DECL|member|tocNICK
name|'def'
name|'tocNICK'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'name'
op|':'
newline|'\n'
indent|'            '
name|'print'
string|"'Waiting for second NICK'"
op|','
name|'data'
newline|'\n'
name|'self'
op|'.'
name|'name'
op|'='
name|'data'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'accountName'
op|'='
string|"'%s (TOC)'"
op|'%'
name|'self'
op|'.'
name|'name'
newline|'\n'
name|'self'
op|'.'
name|'chat'
op|'.'
name|'getContactsList'
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'print'
string|"'reregistering...?'"
op|','
name|'data'
newline|'\n'
name|'self'
op|'.'
name|'name'
op|'='
name|'data'
op|'['
number|'0'
op|']'
newline|'\n'
comment|'# self.accountName = "%s (TOC)"%data[0]'
nl|'\n'
name|'if'
name|'self'
op|'.'
name|'_logonDeferred'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'_logonDeferred'
op|'.'
name|'callback'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_logonDeferred'
op|'='
name|'None'
newline|'\n'
nl|'\n'
comment|'### Error Messages'
nl|'\n'
DECL|member|hearError
dedent|''
dedent|''
dedent|''
name|'def'
name|'hearError'
op|'('
name|'self'
op|','
name|'code'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'*** TOC ERROR ***'"
op|','
name|'repr'
op|'('
name|'code'
op|')'
op|','
name|'repr'
op|'('
name|'args'
op|')'
newline|'\n'
DECL|member|hearWarning
dedent|''
name|'def'
name|'hearWarning'
op|'('
name|'self'
op|','
name|'newamount'
op|','
name|'username'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'*** TOC WARNING ***'"
op|','
name|'repr'
op|'('
name|'newamount'
op|')'
op|','
name|'repr'
op|'('
name|'username'
op|')'
newline|'\n'
comment|'### Buddy Messages'
nl|'\n'
DECL|member|hearMessage
dedent|''
name|'def'
name|'hearMessage'
op|'('
name|'self'
op|','
name|'username'
op|','
name|'message'
op|','
name|'autoreply'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'autoreply'
op|':'
newline|'\n'
indent|'            '
name|'message'
op|'='
string|"'<AUTO-REPLY>: '"
op|'+'
name|'message'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'chat'
op|'.'
name|'getConversation'
op|'('
name|'self'
op|'.'
name|'getPerson'
op|'('
name|'username'
op|')'
nl|'\n'
op|')'
op|'.'
name|'showMessage'
op|'('
name|'dehtml'
op|'('
name|'message'
op|')'
op|')'
newline|'\n'
DECL|member|updateBuddy
dedent|''
name|'def'
name|'updateBuddy'
op|'('
name|'self'
op|','
name|'username'
op|','
name|'online'
op|','
name|'evilness'
op|','
name|'signontime'
op|','
name|'idletime'
op|','
name|'userclass'
op|','
name|'away'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'away'
op|':'
newline|'\n'
indent|'            '
name|'status'
op|'='
name|'AWAY'
newline|'\n'
dedent|''
name|'elif'
name|'online'
op|':'
newline|'\n'
indent|'            '
name|'status'
op|'='
name|'ONLINE'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'status'
op|'='
name|'OFFLINE'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'getPerson'
op|'('
name|'username'
op|')'
op|'.'
name|'setStatusAndIdle'
op|'('
name|'status'
op|','
name|'idletime'
op|')'
newline|'\n'
nl|'\n'
comment|'### Group Chat'
nl|'\n'
DECL|member|chatJoined
dedent|''
name|'def'
name|'chatJoined'
op|'('
name|'self'
op|','
name|'roomid'
op|','
name|'roomname'
op|','
name|'users'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'roomID'
op|'['
name|'roomname'
op|']'
op|'='
name|'roomid'
newline|'\n'
name|'self'
op|'.'
name|'roomIDreverse'
op|'['
name|'roomid'
op|']'
op|'='
name|'roomname'
newline|'\n'
name|'self'
op|'.'
name|'getGroupConversation'
op|'('
name|'roomname'
op|')'
op|'.'
name|'setGroupMembers'
op|'('
name|'users'
op|')'
newline|'\n'
DECL|member|chatUpdate
dedent|''
name|'def'
name|'chatUpdate'
op|'('
name|'self'
op|','
name|'roomid'
op|','
name|'member'
op|','
name|'inroom'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'group'
op|'='
name|'self'
op|'.'
name|'roomIDreverse'
op|'['
name|'roomid'
op|']'
newline|'\n'
name|'if'
name|'inroom'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'getGroupConversation'
op|'('
name|'group'
op|')'
op|'.'
name|'memberJoined'
op|'('
name|'member'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'getGroupConversation'
op|'('
name|'group'
op|')'
op|'.'
name|'memberLeft'
op|'('
name|'member'
op|')'
newline|'\n'
DECL|member|chatHearMessage
dedent|''
dedent|''
name|'def'
name|'chatHearMessage'
op|'('
name|'self'
op|','
name|'roomid'
op|','
name|'username'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'toc'
op|'.'
name|'normalize'
op|'('
name|'username'
op|')'
op|'=='
name|'toc'
op|'.'
name|'normalize'
op|'('
name|'self'
op|'.'
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
comment|'# ignore the message'
newline|'\n'
dedent|''
name|'group'
op|'='
name|'self'
op|'.'
name|'roomIDreverse'
op|'['
name|'roomid'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'getGroupConversation'
op|'('
name|'group'
op|')'
op|'.'
name|'showGroupMessage'
op|'('
name|'username'
op|','
name|'dehtml'
op|'('
name|'message'
op|')'
op|')'
newline|'\n'
DECL|member|chatHearWhisper
dedent|''
name|'def'
name|'chatHearWhisper'
op|'('
name|'self'
op|','
name|'roomid'
op|','
name|'username'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'*** user whispered *** '"
op|','
name|'roomid'
op|','
name|'username'
op|','
name|'message'
newline|'\n'
DECL|member|chatInvited
dedent|''
name|'def'
name|'chatInvited'
op|'('
name|'self'
op|','
name|'roomid'
op|','
name|'roomname'
op|','
name|'username'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'*** user invited us to chat *** '"
op|','
name|'roomid'
op|','
name|'roomname'
op|','
name|'username'
op|','
name|'message'
newline|'\n'
DECL|member|chatLeft
dedent|''
name|'def'
name|'chatLeft'
op|'('
name|'self'
op|','
name|'roomid'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'group'
op|'='
name|'self'
op|'.'
name|'roomIDreverse'
op|'['
name|'roomid'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'getGroupConversation'
op|'('
name|'group'
op|','
number|'1'
op|')'
newline|'\n'
name|'del'
name|'self'
op|'.'
name|'roomID'
op|'['
name|'group'
op|']'
newline|'\n'
name|'del'
name|'self'
op|'.'
name|'roomIDreverse'
op|'['
name|'roomid'
op|']'
newline|'\n'
DECL|member|rvousProposal
dedent|''
name|'def'
name|'rvousProposal'
op|'('
name|'self'
op|','
name|'type'
op|','
name|'cookie'
op|','
name|'user'
op|','
name|'vip'
op|','
name|'port'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'*** rendezvous. ***'"
op|','
name|'type'
op|','
name|'cookie'
op|','
name|'user'
op|','
name|'vip'
op|','
name|'port'
op|','
name|'kw'
newline|'\n'
DECL|member|receiveBytes
dedent|''
name|'def'
name|'receiveBytes'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'file'
op|','
name|'chunk'
op|','
name|'sofar'
op|','
name|'total'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'*** File transfer! ***'"
op|','
name|'user'
op|','
name|'file'
op|','
name|'chunk'
op|','
name|'sofar'
op|','
name|'total'
newline|'\n'
nl|'\n'
DECL|member|joinGroup
dedent|''
name|'def'
name|'joinGroup'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'chat_join'
op|'('
number|'4'
op|','
name|'toc'
op|'.'
name|'normalize'
op|'('
name|'name'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|class|TOCAccount
dedent|''
dedent|''
name|'class'
name|'TOCAccount'
op|'('
name|'basesupport'
op|'.'
name|'AbstractAccount'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'implements'
op|'('
name|'interfaces'
op|'.'
name|'IAccount'
op|')'
newline|'\n'
DECL|variable|gatewayType
name|'gatewayType'
op|'='
string|'"AIM (TOC)"'
newline|'\n'
nl|'\n'
DECL|variable|_groupFactory
name|'_groupFactory'
op|'='
name|'TOCGroup'
newline|'\n'
DECL|variable|_personFactory
name|'_personFactory'
op|'='
name|'TOCPerson'
newline|'\n'
nl|'\n'
DECL|member|_startLogOn
name|'def'
name|'_startLogOn'
op|'('
name|'self'
op|','
name|'chatui'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'logonDeferred'
op|'='
name|'defer'
op|'.'
name|'Deferred'
op|'('
op|')'
newline|'\n'
name|'cc'
op|'='
name|'protocol'
op|'.'
name|'ClientCreator'
op|'('
name|'reactor'
op|','
name|'TOCProto'
op|','
name|'self'
op|','
name|'chatui'
op|','
nl|'\n'
name|'logonDeferred'
op|')'
newline|'\n'
name|'d'
op|'='
name|'cc'
op|'.'
name|'connectTCP'
op|'('
name|'self'
op|'.'
name|'host'
op|','
name|'self'
op|'.'
name|'port'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addErrback'
op|'('
name|'logonDeferred'
op|'.'
name|'errback'
op|')'
newline|'\n'
name|'return'
name|'logonDeferred'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
