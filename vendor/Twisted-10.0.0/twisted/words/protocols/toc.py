begin_unit
comment|'# -*- test-case-name: twisted.words.test -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2005 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
string|'"""\nImplements a AOL Instant Messenger TOC server and client, using the Twisted\nframework.\n\nTODO:\ninfo,dir: see how gaim connects for this...it may never work if it tries to\nconnect to the aim server automatically\n\nThis module is deprecated.\n\nMaintainer: Paul Swartz\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'warnings'
newline|'\n'
name|'warnings'
op|'.'
name|'warn'
op|'('
nl|'\n'
string|'"twisted.words.protocols.toc is deprecated since Twisted 9.0.  "'
nl|'\n'
string|'"Use twisted.words.protocols.oscar instead."'
op|','
nl|'\n'
DECL|variable|category
name|'category'
op|'='
name|'DeprecationWarning'
op|','
nl|'\n'
DECL|variable|stacklevel
name|'stacklevel'
op|'='
number|'2'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
comment|'# twisted imports'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
op|','
name|'protocol'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'log'
newline|'\n'
nl|'\n'
comment|'# base imports'
nl|'\n'
name|'import'
name|'struct'
newline|'\n'
name|'import'
name|'string'
newline|'\n'
name|'import'
name|'time'
newline|'\n'
name|'import'
name|'base64'
newline|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'StringIO'
newline|'\n'
nl|'\n'
name|'SIGNON'
op|','
name|'DATA'
op|','
name|'ERROR'
op|','
name|'SIGNOFF'
op|','
name|'KEEP_ALIVE'
op|'='
name|'range'
op|'('
number|'1'
op|','
number|'6'
op|')'
newline|'\n'
name|'PERMITALL'
op|','
name|'DENYALL'
op|','
name|'PERMITSOME'
op|','
name|'DENYSOME'
op|'='
name|'range'
op|'('
number|'1'
op|','
number|'5'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|DUMMY_CHECKSUM
name|'DUMMY_CHECKSUM'
op|'='
op|'-'
number|'559038737'
comment|'# 0xdeadbeef'
newline|'\n'
nl|'\n'
DECL|function|quote
name|'def'
name|'quote'
op|'('
name|'s'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'rep'
op|'='
op|'['
string|"'\\\\'"
op|','
string|"'$'"
op|','
string|"'{'"
op|','
string|"'}'"
op|','
string|"'['"
op|','
string|"']'"
op|','
string|"'('"
op|','
string|"')'"
op|','
string|'\'"\''
op|']'
newline|'\n'
name|'for'
name|'r'
name|'in'
name|'rep'
op|':'
newline|'\n'
indent|'        '
name|'s'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'s'
op|','
name|'r'
op|','
string|'"\\\\"'
op|'+'
name|'r'
op|')'
newline|'\n'
dedent|''
name|'return'
string|'"\\""'
op|'+'
name|'s'
op|'+'
string|'"\\""'
newline|'\n'
nl|'\n'
DECL|function|unquote
dedent|''
name|'def'
name|'unquote'
op|'('
name|'s'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'s'
op|'=='
string|'""'
op|':'
name|'return'
string|'""'
newline|'\n'
name|'if'
name|'s'
op|'['
number|'0'
op|']'
op|'!='
string|'\'"\''
op|':'
name|'return'
name|'s'
newline|'\n'
name|'r'
op|'='
name|'string'
op|'.'
name|'replace'
newline|'\n'
name|'s'
op|'='
name|'s'
op|'['
number|'1'
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
name|'s'
op|'='
name|'r'
op|'('
name|'s'
op|','
string|'"\\\\\\\\"'
op|','
string|'"\\\\"'
op|')'
newline|'\n'
name|'s'
op|'='
name|'r'
op|'('
name|'s'
op|','
string|'"\\\\$"'
op|','
string|'"$"'
op|')'
newline|'\n'
name|'s'
op|'='
name|'r'
op|'('
name|'s'
op|','
string|'"\\\\{"'
op|','
string|'"{"'
op|')'
newline|'\n'
name|'s'
op|'='
name|'r'
op|'('
name|'s'
op|','
string|'"\\\\}"'
op|','
string|'"}"'
op|')'
newline|'\n'
name|'s'
op|'='
name|'r'
op|'('
name|'s'
op|','
string|'"\\\\["'
op|','
string|'"["'
op|')'
newline|'\n'
name|'s'
op|'='
name|'r'
op|'('
name|'s'
op|','
string|'"\\\\]"'
op|','
string|'"]"'
op|')'
newline|'\n'
name|'s'
op|'='
name|'r'
op|'('
name|'s'
op|','
string|'"\\\\("'
op|','
string|'"("'
op|')'
newline|'\n'
name|'s'
op|'='
name|'r'
op|'('
name|'s'
op|','
string|'"\\\\)"'
op|','
string|'")"'
op|')'
newline|'\n'
name|'s'
op|'='
name|'r'
op|'('
name|'s'
op|','
string|'"\\\\\\""'
op|','
string|'"\\""'
op|')'
newline|'\n'
name|'return'
name|'s'
newline|'\n'
nl|'\n'
DECL|function|unquotebeg
dedent|''
name|'def'
name|'unquotebeg'
op|'('
name|'s'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'s'
op|')'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'s'
op|'['
name|'i'
op|']'
op|'=='
string|'\'"\''
name|'and'
name|'s'
op|'['
name|'i'
op|'-'
number|'1'
op|']'
op|'!='
string|"'\\\\'"
op|':'
newline|'\n'
indent|'            '
name|'q'
op|'='
name|'unquote'
op|'('
name|'s'
op|'['
op|':'
name|'i'
op|'+'
number|'1'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
name|'q'
op|','
name|'s'
op|'['
name|'i'
op|'+'
number|'2'
op|':'
op|']'
op|']'
newline|'\n'
nl|'\n'
DECL|function|unroast
dedent|''
dedent|''
dedent|''
name|'def'
name|'unroast'
op|'('
name|'pw'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'roaststring'
op|'='
string|'"Tic/Toc"'
newline|'\n'
name|'pw'
op|'='
name|'string'
op|'.'
name|'lower'
op|'('
name|'pw'
op|'['
number|'2'
op|':'
op|']'
op|')'
newline|'\n'
name|'r'
op|'='
string|'""'
newline|'\n'
name|'count'
op|'='
number|'0'
newline|'\n'
name|'hex'
op|'='
op|'['
string|'"0"'
op|','
string|'"1"'
op|','
string|'"2"'
op|','
string|'"3"'
op|','
string|'"4"'
op|','
string|'"5"'
op|','
string|'"6"'
op|','
string|'"7"'
op|','
string|'"8"'
op|','
string|'"9"'
op|','
string|'"a"'
op|','
string|'"b"'
op|','
string|'"c"'
op|','
string|'"d"'
op|','
string|'"e"'
op|','
string|'"f"'
op|']'
newline|'\n'
name|'while'
name|'pw'
op|':'
newline|'\n'
indent|'        '
name|'st'
op|','
name|'pw'
op|'='
name|'pw'
op|'['
op|':'
number|'2'
op|']'
op|','
name|'pw'
op|'['
number|'2'
op|':'
op|']'
newline|'\n'
name|'value'
op|'='
op|'('
number|'16'
op|'*'
name|'hex'
op|'.'
name|'index'
op|'('
name|'st'
op|'['
number|'0'
op|']'
op|')'
op|')'
op|'+'
name|'hex'
op|'.'
name|'index'
op|'('
name|'st'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
name|'xor'
op|'='
name|'ord'
op|'('
name|'roaststring'
op|'['
name|'count'
op|']'
op|')'
newline|'\n'
name|'count'
op|'='
op|'('
name|'count'
op|'+'
number|'1'
op|')'
op|'%'
name|'len'
op|'('
name|'roaststring'
op|')'
newline|'\n'
name|'r'
op|'='
name|'r'
op|'+'
name|'chr'
op|'('
name|'value'
op|'^'
name|'xor'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'r'
newline|'\n'
nl|'\n'
DECL|function|roast
dedent|''
name|'def'
name|'roast'
op|'('
name|'pw'
op|')'
op|':'
newline|'\n'
comment|'# contributed by jemfinch on #python'
nl|'\n'
indent|'    '
name|'key'
op|'='
string|'"Tic/Toc"'
newline|'\n'
name|'ro'
op|'='
string|'"0x"'
newline|'\n'
name|'i'
op|'='
number|'0'
newline|'\n'
name|'ascii'
op|'='
name|'map'
op|'('
name|'ord'
op|','
name|'pw'
op|')'
newline|'\n'
name|'for'
name|'c'
name|'in'
name|'ascii'
op|':'
newline|'\n'
indent|'        '
name|'ro'
op|'='
name|'ro'
op|'+'
string|"'%02x'"
op|'%'
op|'('
name|'c'
op|'^'
name|'ord'
op|'('
name|'key'
op|'['
name|'i'
op|'%'
name|'len'
op|'('
name|'key'
op|')'
op|']'
op|')'
op|')'
newline|'\n'
name|'i'
op|'='
name|'i'
op|'+'
number|'1'
newline|'\n'
dedent|''
name|'return'
name|'string'
op|'.'
name|'lower'
op|'('
name|'ro'
op|')'
newline|'\n'
nl|'\n'
DECL|function|checksum
dedent|''
name|'def'
name|'checksum'
op|'('
name|'b'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'DUMMY_CHECKSUM'
comment|'# do it like gaim does, since the checksum'
newline|'\n'
comment|"# formula doesn't work"
nl|'\n'
comment|'##    # used in file transfers'
nl|'\n'
comment|'##    check0 = check1 = 0x00ff'
nl|'\n'
comment|'##    for i in range(len(b)):'
nl|'\n'
comment|'##        if i%2:'
nl|'\n'
comment|'##            if ord(b[i])>check1:'
nl|'\n'
comment|'##                check1=check1+0x100 # wrap'
nl|'\n'
comment|'##                if check0==0:'
nl|'\n'
comment|'##                    check0=0x00ff'
nl|'\n'
comment|'##                    if check1==0x100:'
nl|'\n'
comment|'##                        check1=check1-1'
nl|'\n'
comment|'##                else:'
nl|'\n'
comment|'##                    check0=check0-1'
nl|'\n'
comment|'##            check1=check1-ord(b[i])'
nl|'\n'
comment|'##        else:'
nl|'\n'
comment|'##            if ord(b[i])>check0: # wrap'
nl|'\n'
comment|'##                check0=check0+0x100'
nl|'\n'
comment|'##                if check1==0:'
nl|'\n'
comment|'##                    check1=0x00ff'
nl|'\n'
comment|'##                    if check0==0x100:'
nl|'\n'
comment|'##                        check0=check0-1'
nl|'\n'
comment|'##                else:'
nl|'\n'
comment|'##                    check1=check1-1'
nl|'\n'
comment|'##            check0=check0-ord(b[i])'
nl|'\n'
comment|'##    check0=check0 & 0xff'
nl|'\n'
comment|'##    check1=check1 & 0xff'
nl|'\n'
comment|'##    checksum=(long(check0)*0x1000000)+(long(check1)*0x10000)'
nl|'\n'
comment|'##    return checksum'
nl|'\n'
nl|'\n'
DECL|function|checksum_file
dedent|''
name|'def'
name|'checksum_file'
op|'('
name|'f'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'DUMMY_CHECKSUM'
comment|'# do it like gaim does, since the checksum'
newline|'\n'
comment|"# formula doesn't work"
nl|'\n'
comment|'##    check0=check1=0x00ff'
nl|'\n'
comment|'##    i=0'
nl|'\n'
comment|'##    while 1:'
nl|'\n'
comment|'##        b=f.read()'
nl|'\n'
comment|'##        if not b: break'
nl|'\n'
comment|'##        for char in b:'
nl|'\n'
comment|'##            i=not i'
nl|'\n'
comment|'##            if i:'
nl|'\n'
comment|'##                if ord(char)>check1:'
nl|'\n'
comment|'##                    check1=check1+0x100 # wrap'
nl|'\n'
comment|'##                    if check0==0:'
nl|'\n'
comment|'##                        check0=0x00ff'
nl|'\n'
comment|'##                        if check1==0x100:'
nl|'\n'
comment|'##                            check1=check1-1'
nl|'\n'
comment|'##                    else:'
nl|'\n'
comment|'##                        check0=check0-1'
nl|'\n'
comment|'##                check1=check1-ord(char)'
nl|'\n'
comment|'##            else:'
nl|'\n'
comment|'##                if ord(char)>check0: # wrap'
nl|'\n'
comment|'##                    check0=check0+0x100'
nl|'\n'
comment|'##                    if check1==0:'
nl|'\n'
comment|'##                        check1=0x00ff'
nl|'\n'
comment|'##                        if check0==0x100:'
nl|'\n'
comment|'##                            check0=check0-1'
nl|'\n'
comment|'##                    else:'
nl|'\n'
comment|'##                        check1=check1-1'
nl|'\n'
comment|'##                check0=check0-ord(char)'
nl|'\n'
comment|'##    check0=check0 & 0xff'
nl|'\n'
comment|'##    check1=check1 & 0xff'
nl|'\n'
comment|'##    checksum=(long(check0)*0x1000000)+(long(check1)*0x10000)'
nl|'\n'
comment|'##    return checksum'
nl|'\n'
nl|'\n'
DECL|function|normalize
dedent|''
name|'def'
name|'normalize'
op|'('
name|'s'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'s'
op|'='
name|'string'
op|'.'
name|'lower'
op|'('
name|'s'
op|')'
newline|'\n'
name|'s'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'s'
op|','
string|'" "'
op|','
string|'""'
op|')'
newline|'\n'
name|'return'
name|'s'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TOCParseError
dedent|''
name|'class'
name|'TOCParseError'
op|'('
name|'ValueError'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TOC
dedent|''
name|'class'
name|'TOC'
op|'('
name|'protocol'
op|'.'
name|'Protocol'
op|')'
op|':'
newline|'\n'
DECL|variable|users
indent|'    '
name|'users'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|connectionMade
name|'def'
name|'connectionMade'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# initialization of protocol'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'_buf'
op|'='
string|'""'
newline|'\n'
name|'self'
op|'.'
name|'_ourseqnum'
op|'='
number|'0L'
newline|'\n'
name|'self'
op|'.'
name|'_theirseqnum'
op|'='
number|'0L'
newline|'\n'
name|'self'
op|'.'
name|'_mode'
op|'='
string|'"Flapon"'
newline|'\n'
name|'self'
op|'.'
name|'_onlyflaps'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'_laststatus'
op|'='
op|'{'
op|'}'
comment|'# the last status for a user'
newline|'\n'
name|'self'
op|'.'
name|'username'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'permitmode'
op|'='
name|'PERMITALL'
newline|'\n'
name|'self'
op|'.'
name|'permitlist'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'denylist'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'buddylist'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'signontime'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'idletime'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'userinfo'
op|'='
string|'"<br>"'
newline|'\n'
name|'self'
op|'.'
name|'userclass'
op|'='
string|'" O"'
newline|'\n'
name|'self'
op|'.'
name|'away'
op|'='
string|'""'
newline|'\n'
name|'self'
op|'.'
name|'saved'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|_debug
dedent|''
name|'def'
name|'_debug'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'log'
op|'.'
name|'msg'
op|'('
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|connectionLost
dedent|''
name|'def'
name|'connectionLost'
op|'('
name|'self'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_debug'
op|'('
string|'"dropped connection from %s"'
op|'%'
name|'self'
op|'.'
name|'username'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'del'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'users'
op|'['
name|'self'
op|'.'
name|'username'
op|']'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'for'
name|'k'
name|'in'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'chatroom'
op|'.'
name|'keys'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'factory'
op|'.'
name|'chatroom'
op|'['
name|'k'
op|']'
op|'.'
name|'leave'
op|'('
name|'self'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'TOCParseError'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'self'
op|'.'
name|'saved'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'factory'
op|'.'
name|'savedusers'
op|'['
name|'self'
op|'.'
name|'username'
op|']'
op|'='
name|'self'
op|'.'
name|'saved'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'updateUsers'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|sendFlap
dedent|''
name|'def'
name|'sendFlap'
op|'('
name|'self'
op|','
name|'type'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        send a FLAP to the client\n        """'
newline|'\n'
name|'send'
op|'='
string|'"*"'
newline|'\n'
name|'self'
op|'.'
name|'_debug'
op|'('
name|'data'
op|')'
newline|'\n'
name|'if'
name|'type'
op|'=='
name|'DATA'
op|':'
newline|'\n'
indent|'            '
name|'data'
op|'='
name|'data'
op|'+'
string|'"\\000"'
newline|'\n'
dedent|''
name|'length'
op|'='
name|'len'
op|'('
name|'data'
op|')'
newline|'\n'
name|'send'
op|'='
name|'send'
op|'+'
name|'struct'
op|'.'
name|'pack'
op|'('
string|'"!BHH"'
op|','
name|'type'
op|','
name|'self'
op|'.'
name|'_ourseqnum'
op|','
name|'length'
op|')'
newline|'\n'
name|'send'
op|'='
name|'send'
op|'+'
name|'data'
newline|'\n'
name|'self'
op|'.'
name|'_ourseqnum'
op|'='
name|'self'
op|'.'
name|'_ourseqnum'
op|'+'
number|'1'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_ourseqnum'
op|'>'
op|'('
number|'256L'
op|'**'
number|'4'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_ourseqnum'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'transport'
op|'.'
name|'write'
op|'('
name|'send'
op|')'
newline|'\n'
nl|'\n'
DECL|member|dataReceived
dedent|''
name|'def'
name|'dataReceived'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_buf'
op|'='
name|'self'
op|'.'
name|'_buf'
op|'+'
name|'data'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'func'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
string|'"mode%s"'
op|'%'
name|'self'
op|'.'
name|'_mode'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'return'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'_mode'
op|'='
name|'func'
op|'('
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_onlyflaps'
name|'and'
name|'self'
op|'.'
name|'isFlap'
op|'('
op|')'
op|':'
name|'self'
op|'.'
name|'dataReceived'
op|'('
string|'""'
op|')'
newline|'\n'
nl|'\n'
DECL|member|isFlap
dedent|''
name|'def'
name|'isFlap'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        tests to see if a flap is actually on the buffer\n        """'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_buf'
op|'=='
string|"''"
op|':'
name|'return'
number|'0'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_buf'
op|'['
number|'0'
op|']'
op|'!='
string|'"*"'
op|':'
name|'return'
number|'0'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'_buf'
op|')'
op|'<'
number|'6'
op|':'
name|'return'
number|'0'
newline|'\n'
name|'foo'
op|','
name|'type'
op|','
name|'seqnum'
op|','
name|'length'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|'"!BBHH"'
op|','
name|'self'
op|'.'
name|'_buf'
op|'['
op|':'
number|'6'
op|']'
op|')'
newline|'\n'
name|'if'
name|'type'
name|'not'
name|'in'
name|'range'
op|'('
number|'1'
op|','
number|'6'
op|')'
op|':'
name|'return'
number|'0'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'_buf'
op|')'
op|'<'
number|'6'
op|'+'
name|'length'
op|':'
name|'return'
number|'0'
newline|'\n'
name|'return'
number|'1'
newline|'\n'
nl|'\n'
DECL|member|readFlap
dedent|''
name|'def'
name|'readFlap'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        read the first FLAP off self._buf, raising errors if it isn\'t in the right form.\n        the FLAP is the basic TOC message format, and is logically equivilant to a packet in TCP\n        """'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_buf'
op|'=='
string|"''"
op|':'
name|'return'
name|'None'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_buf'
op|'['
number|'0'
op|']'
op|'!='
string|'"*"'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'TOCParseError'
newline|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'_buf'
op|')'
op|'<'
number|'6'
op|':'
name|'return'
name|'None'
newline|'\n'
name|'foo'
op|','
name|'type'
op|','
name|'seqnum'
op|','
name|'length'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|'"!BBHH"'
op|','
name|'self'
op|'.'
name|'_buf'
op|'['
op|':'
number|'6'
op|']'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'_buf'
op|')'
op|'<'
number|'6'
op|'+'
name|'length'
op|':'
name|'return'
name|'None'
newline|'\n'
name|'data'
op|'='
name|'self'
op|'.'
name|'_buf'
op|'['
number|'6'
op|':'
number|'6'
op|'+'
name|'length'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_buf'
op|'='
name|'self'
op|'.'
name|'_buf'
op|'['
number|'6'
op|'+'
name|'length'
op|':'
op|']'
newline|'\n'
name|'if'
name|'data'
name|'and'
name|'data'
op|'['
op|'-'
number|'1'
op|']'
op|'=='
string|'"\\000"'
op|':'
newline|'\n'
indent|'            '
name|'data'
op|'='
name|'data'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'_debug'
op|'('
op|'['
name|'type'
op|','
name|'data'
op|']'
op|')'
newline|'\n'
name|'return'
op|'['
name|'type'
op|','
name|'data'
op|']'
newline|'\n'
nl|'\n'
comment|'#def modeWeb(self):'
nl|'\n'
comment|'#    try:'
nl|'\n'
comment|'#        line,rest=string.split(self._buf,"\\n",1)'
nl|'\n'
comment|'#        get,username,http=string.split(line," ",2)'
nl|'\n'
comment|'#    except:'
nl|'\n'
comment|'#        return "Web" # not enough data'
nl|'\n'
comment|'#    foo,type,username=string.split(username,"/")'
nl|'\n'
comment|'#    if type=="info":'
nl|'\n'
comment|'#        user=self.factory.users[username]'
nl|'\n'
comment|'#        text="<HTML><HEAD><TITLE>User Information for %s</TITLE></HEAD><BODY>Username: <B>%s</B><br>\\nWarning Level: <B>%s%</B><br>\\n Online Since: <B>%s</B><br>\\nIdle Minutes: <B>%s</B><br>\\n<hr><br>\\n%s\\n<hr><br>\\n"%(user.saved.nick, user.saved.nick, user.saved.evilness, time.asctime(user.signontime), int((time.time()-user.idletime)/60), user.userinfo)'
nl|'\n'
comment|'#        self.transport.write("HTTP/1.1 200 OK\\n")'
nl|'\n'
comment|'#        self.transport.write("Content-Type: text/html\\n")'
nl|'\n'
comment|'#        self.transport.write("Content-Length: %s\\n\\n"%len(text))'
nl|'\n'
comment|'#        self.transport.write(text)'
nl|'\n'
comment|'#        self.loseConnection()'
nl|'\n'
nl|'\n'
DECL|member|modeFlapon
dedent|''
name|'def'
name|'modeFlapon'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'#if self._buf[:3]=="GET": self.modeWeb() # TODO: get this working'
nl|'\n'
indent|'        '
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'_buf'
op|')'
op|'<'
number|'10'
op|':'
name|'return'
string|'"Flapon"'
comment|'# not enough bytes'
newline|'\n'
name|'flapon'
op|','
name|'self'
op|'.'
name|'_buf'
op|'='
name|'self'
op|'.'
name|'_buf'
op|'['
op|':'
number|'10'
op|']'
op|','
name|'self'
op|'.'
name|'_buf'
op|'['
number|'10'
op|':'
op|']'
newline|'\n'
name|'if'
name|'flapon'
op|'!='
string|'"FLAPON\\r\\n\\r\\n"'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'TOCParseError'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendFlap'
op|'('
name|'SIGNON'
op|','
string|'"\\000\\000\\000\\001"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_onlyflaps'
op|'='
number|'1'
newline|'\n'
name|'return'
string|'"Signon"'
newline|'\n'
nl|'\n'
DECL|member|modeSignon
dedent|''
name|'def'
name|'modeSignon'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'flap'
op|'='
name|'self'
op|'.'
name|'readFlap'
op|'('
op|')'
newline|'\n'
name|'if'
name|'flap'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|'"Signon"'
newline|'\n'
dedent|''
name|'if'
name|'flap'
op|'['
number|'0'
op|']'
op|'!='
name|'SIGNON'
op|':'
name|'raise'
name|'TOCParseError'
newline|'\n'
name|'version'
op|','
name|'tlv'
op|','
name|'unlength'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|'"!LHH"'
op|','
name|'flap'
op|'['
number|'1'
op|']'
op|'['
op|':'
number|'8'
op|']'
op|')'
newline|'\n'
name|'if'
name|'version'
op|'!='
number|'1'
name|'or'
name|'tlv'
op|'!='
number|'1'
name|'or'
name|'unlength'
op|'+'
number|'8'
op|'!='
name|'len'
op|'('
name|'flap'
op|'['
number|'1'
op|']'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'TOCParseError'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'username'
op|'='
name|'normalize'
op|'('
name|'flap'
op|'['
number|'1'
op|']'
op|'['
number|'8'
op|':'
op|']'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'username'
name|'in'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'savedusers'
op|'.'
name|'keys'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'saved'
op|'='
name|'self'
op|'.'
name|'factory'
op|'.'
name|'savedusers'
op|'['
name|'self'
op|'.'
name|'username'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'saved'
op|'='
name|'SavedUser'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'saved'
op|'.'
name|'nick'
op|'='
name|'self'
op|'.'
name|'username'
newline|'\n'
dedent|''
name|'return'
string|'"TocSignon"'
newline|'\n'
nl|'\n'
DECL|member|modeTocSignon
dedent|''
name|'def'
name|'modeTocSignon'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'flap'
op|'='
name|'self'
op|'.'
name|'readFlap'
op|'('
op|')'
newline|'\n'
name|'if'
name|'flap'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|'"TocSignon"'
newline|'\n'
dedent|''
name|'if'
name|'flap'
op|'['
number|'0'
op|']'
op|'!='
name|'DATA'
op|':'
name|'raise'
name|'TOCParseError'
newline|'\n'
name|'data'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'flap'
op|'['
number|'1'
op|']'
op|','
string|'" "'
op|')'
newline|'\n'
name|'if'
name|'data'
op|'['
number|'0'
op|']'
op|'!='
string|'"toc_signon"'
op|':'
name|'raise'
name|'TOCParseError'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'data'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'i'
op|':'
name|'data'
op|'.'
name|'remove'
op|'('
name|'i'
op|')'
newline|'\n'
dedent|''
name|'password'
op|'='
name|'unroast'
op|'('
name|'data'
op|'['
number|'4'
op|']'
op|')'
newline|'\n'
name|'if'
name|'not'
op|'('
name|'self'
op|'.'
name|'authorize'
op|'('
name|'data'
op|'['
number|'1'
op|']'
op|','
name|'int'
op|'('
name|'data'
op|'['
number|'2'
op|']'
op|')'
op|','
name|'data'
op|'['
number|'3'
op|']'
op|','
name|'password'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendError'
op|'('
name|'BAD_NICKNAME'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendFlap'
op|'('
name|'DATA'
op|','
string|'"SIGN_ON:TOC1.0"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
name|'DATA'
op|','
string|'"NICK:%s"'
op|'%'
name|'self'
op|'.'
name|'saved'
op|'.'
name|'nick'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
name|'DATA'
op|','
string|'"CONFIG:%s"'
op|'%'
name|'self'
op|'.'
name|'saved'
op|'.'
name|'config'
op|')'
newline|'\n'
comment|'# sending user configuration goes here'
nl|'\n'
name|'return'
string|'"Connected"'
newline|'\n'
nl|'\n'
DECL|member|authorize
dedent|''
name|'def'
name|'authorize'
op|'('
name|'self'
op|','
name|'server'
op|','
name|'port'
op|','
name|'username'
op|','
name|'password'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'saved'
op|'.'
name|'password'
op|'=='
string|'""'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'saved'
op|'.'
name|'password'
op|'='
name|'password'
newline|'\n'
name|'return'
number|'1'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'saved'
op|'.'
name|'password'
op|'=='
name|'password'
newline|'\n'
nl|'\n'
DECL|member|modeConnected
dedent|''
dedent|''
name|'def'
name|'modeConnected'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'flap'
op|'='
name|'self'
op|'.'
name|'readFlap'
op|'('
op|')'
newline|'\n'
name|'while'
name|'flap'
op|'!='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'flap'
op|'['
number|'0'
op|']'
name|'not'
name|'in'
op|'['
name|'DATA'
op|','
name|'KEEP_ALIVE'
op|']'
op|':'
name|'raise'
name|'TOCParseError'
newline|'\n'
name|'flapdata'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'flap'
op|'['
number|'1'
op|']'
op|','
string|'" "'
op|','
number|'1'
op|')'
newline|'\n'
name|'tocname'
op|'='
name|'flapdata'
op|'['
number|'0'
op|']'
op|'['
number|'4'
op|':'
op|']'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'flapdata'
op|')'
op|'=='
number|'2'
op|':'
newline|'\n'
indent|'                '
name|'data'
op|'='
name|'flapdata'
op|'['
number|'1'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'data'
op|'='
string|'""'
newline|'\n'
dedent|''
name|'func'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
string|'"toc_"'
op|'+'
name|'tocname'
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'func'
op|'!='
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'func'
op|'('
name|'data'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'toc_unknown'
op|'('
name|'tocname'
op|','
name|'data'
op|')'
newline|'\n'
dedent|''
name|'flap'
op|'='
name|'self'
op|'.'
name|'readFlap'
op|'('
op|')'
newline|'\n'
dedent|''
name|'return'
string|'"Connected"'
newline|'\n'
nl|'\n'
DECL|member|toc_unknown
dedent|''
name|'def'
name|'toc_unknown'
op|'('
name|'self'
op|','
name|'tocname'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_debug'
op|'('
string|'"unknown! %s %s"'
op|'%'
op|'('
name|'tocname'
op|','
name|'data'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_init_done
dedent|''
name|'def'
name|'toc_init_done'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when all the setup is done.\n\n        toc_init_done\n        """'
newline|'\n'
name|'self'
op|'.'
name|'signontime'
op|'='
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'users'
op|'['
name|'self'
op|'.'
name|'username'
op|']'
op|'='
name|'self'
newline|'\n'
name|'self'
op|'.'
name|'updateUsers'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_add_permit
dedent|''
name|'def'
name|'toc_add_permit'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        adds users to the permit list.  if the list is null, then set the mode to DENYALL\n        """'
newline|'\n'
name|'if'
name|'data'
op|'=='
string|'""'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'permitmode'
op|'='
name|'DENYALL'
newline|'\n'
name|'self'
op|'.'
name|'permitlist'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'denylist'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'permitmode'
op|'='
name|'PERMITSOME'
newline|'\n'
name|'self'
op|'.'
name|'denylist'
op|'='
op|'['
op|']'
newline|'\n'
name|'users'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'data'
op|','
string|'" "'
op|')'
newline|'\n'
name|'map'
op|'('
name|'self'
op|'.'
name|'permitlist'
op|'.'
name|'append'
op|','
name|'users'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'updateUsers'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_add_deny
dedent|''
name|'def'
name|'toc_add_deny'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        adds users to the deny list.  if the list is null, then set the mode to PERMITALL\n        """'
newline|'\n'
name|'if'
name|'data'
op|'=='
string|'""'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'permitmode'
op|'='
name|'PERMITALL'
newline|'\n'
name|'self'
op|'.'
name|'permitlist'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'denylist'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'permitmode'
op|'='
name|'DENYSOME'
newline|'\n'
name|'self'
op|'.'
name|'permitlist'
op|'='
op|'['
op|']'
newline|'\n'
name|'users'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'data'
op|','
string|'" "'
op|')'
newline|'\n'
name|'map'
op|'('
name|'self'
op|'.'
name|'denylist'
op|'.'
name|'append'
op|','
name|'users'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'updateUsers'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_evil
dedent|''
name|'def'
name|'toc_evil'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        warns a user.\n\n        toc_evil <username> <anon|norm>\n        """'
newline|'\n'
name|'username'
op|','
name|'nora'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'data'
op|','
string|'" "'
op|')'
newline|'\n'
name|'if'
name|'nora'
op|'=='
string|'"anon"'
op|':'
newline|'\n'
indent|'            '
name|'user'
op|'='
string|'""'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'user'
op|'='
name|'self'
op|'.'
name|'saved'
op|'.'
name|'nick'
newline|'\n'
dedent|''
name|'if'
name|'not'
op|'('
name|'self'
op|'.'
name|'factory'
op|'.'
name|'users'
op|'.'
name|'has_key'
op|'('
name|'username'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendError'
op|'('
name|'CANT_WARN'
op|','
name|'username'
op|')'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'users'
op|'['
name|'username'
op|']'
op|'.'
name|'saved'
op|'.'
name|'evilness'
op|'>='
number|'100'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendError'
op|'('
name|'CANT_WARN'
op|','
name|'username'
op|')'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'factory'
op|'.'
name|'users'
op|'['
name|'username'
op|']'
op|'.'
name|'evilFrom'
op|'('
name|'user'
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_add_buddy
dedent|''
name|'def'
name|'toc_add_buddy'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        adds users to the buddy list\n\n        toc_add_buddy <buddyname1> [<buddyname2>] [<buddyname3>]...\n        """'
newline|'\n'
name|'buddies'
op|'='
name|'map'
op|'('
name|'normalize'
op|','
name|'string'
op|'.'
name|'split'
op|'('
name|'data'
op|','
string|'" "'
op|')'
op|')'
newline|'\n'
name|'for'
name|'b'
name|'in'
name|'buddies'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'b'
name|'not'
name|'in'
name|'self'
op|'.'
name|'buddylist'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'buddylist'
op|'.'
name|'append'
op|'('
name|'b'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'for'
name|'buddy'
name|'in'
name|'buddies'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'buddy'
op|'='
name|'self'
op|'.'
name|'factory'
op|'.'
name|'users'
op|'['
name|'buddy'
op|']'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'buddyUpdate'
op|'('
name|'buddy'
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_remove_buddy
dedent|''
dedent|''
dedent|''
name|'def'
name|'toc_remove_buddy'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        removes users from the buddy list\n\n        toc_remove_buddy <buddyname1> [<buddyname2>] [<buddyname3>]...\n        """'
newline|'\n'
name|'buddies'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'data'
op|','
string|'" "'
op|')'
newline|'\n'
name|'for'
name|'buddy'
name|'in'
name|'buddies'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'buddylist'
op|'.'
name|'remove'
op|'('
name|'normalize'
op|'('
name|'buddy'
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|toc_send_im
dedent|''
dedent|''
name|'def'
name|'toc_send_im'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        incoming instant message\n\n        toc_send_im <screenname> <quoted message> [auto]\n        """'
newline|'\n'
name|'username'
op|','
name|'data'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'data'
op|','
string|'" "'
op|','
number|'1'
op|')'
newline|'\n'
name|'auto'
op|'='
number|'0'
newline|'\n'
name|'if'
name|'data'
op|'['
op|'-'
number|'4'
op|':'
op|']'
op|'=='
string|'"auto"'
op|':'
newline|'\n'
indent|'            '
name|'auto'
op|'='
number|'1'
newline|'\n'
name|'data'
op|'='
name|'data'
op|'['
op|':'
op|'-'
number|'5'
op|']'
newline|'\n'
dedent|''
name|'data'
op|'='
name|'unquote'
op|'('
name|'data'
op|')'
newline|'\n'
name|'if'
name|'not'
op|'('
name|'self'
op|'.'
name|'factory'
op|'.'
name|'users'
op|'.'
name|'has_key'
op|'('
name|'username'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendError'
op|'('
name|'NOT_AVAILABLE'
op|','
name|'username'
op|')'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'user'
op|'='
name|'self'
op|'.'
name|'factory'
op|'.'
name|'users'
op|'['
name|'username'
op|']'
newline|'\n'
name|'if'
name|'not'
op|'('
name|'self'
op|'.'
name|'canContact'
op|'('
name|'user'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendError'
op|'('
name|'NOT_AVAILABLE'
op|','
name|'username'
op|')'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'user'
op|'.'
name|'hearWhisper'
op|'('
name|'self'
op|','
name|'data'
op|','
name|'auto'
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_set_info
dedent|''
name|'def'
name|'toc_set_info'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        set the users information, retrivable with toc_get_info\n\n        toc_set_info <user info (quoted)>\n        """'
newline|'\n'
name|'info'
op|'='
name|'unquote'
op|'('
name|'data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_userinfo'
op|'='
name|'info'
newline|'\n'
nl|'\n'
DECL|member|toc_set_idle
dedent|''
name|'def'
name|'toc_set_idle'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        set/unset idle\n\n        toc_set_idle <seconds>\n        """'
newline|'\n'
name|'seconds'
op|'='
name|'int'
op|'('
name|'data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'idletime'
op|'='
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|'-'
name|'seconds'
comment|'# time when they started being idle'
newline|'\n'
name|'self'
op|'.'
name|'updateUsers'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_set_away
dedent|''
name|'def'
name|'toc_set_away'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        set/unset away message\n\n        toc_set_away [<away message>]\n        """'
newline|'\n'
name|'away'
op|'='
name|'unquote'
op|'('
name|'data'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'away'
name|'and'
name|'away'
op|':'
comment|'# setting an away message'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'away'
op|'='
name|'away'
newline|'\n'
name|'self'
op|'.'
name|'userclass'
op|'='
name|'self'
op|'.'
name|'userclass'
op|'+'
string|"'U'"
newline|'\n'
name|'self'
op|'.'
name|'updateUsers'
op|'('
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'away'
name|'and'
name|'not'
name|'away'
op|':'
comment|'# coming back'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'away'
op|'='
string|'""'
newline|'\n'
name|'self'
op|'.'
name|'userclass'
op|'='
name|'self'
op|'.'
name|'userclass'
op|'['
op|':'
number|'2'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'updateUsers'
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'TOCParseError'
newline|'\n'
nl|'\n'
DECL|member|toc_chat_join
dedent|''
dedent|''
name|'def'
name|'toc_chat_join'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        joins the chat room.\n\n        toc_chat_join <exchange> <room name>\n        """'
newline|'\n'
name|'exchange'
op|','
name|'name'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'data'
op|','
string|'" "'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'getChatroom'
op|'('
name|'int'
op|'('
name|'exchange'
op|')'
op|','
name|'unquote'
op|'('
name|'name'
op|')'
op|')'
op|'.'
name|'join'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_chat_invite
dedent|''
name|'def'
name|'toc_chat_invite'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        invite others to the room.\n\n        toc_chat_invite <room id> <invite message> <buddy 1> [<buddy2>]...\n        """'
newline|'\n'
name|'id'
op|','
name|'data'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'data'
op|','
string|'" "'
op|','
number|'1'
op|')'
newline|'\n'
name|'id'
op|'='
name|'int'
op|'('
name|'id'
op|')'
newline|'\n'
name|'message'
op|','
name|'data'
op|'='
name|'unquotebeg'
op|'('
name|'data'
op|')'
newline|'\n'
name|'buddies'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'data'
op|','
string|'" "'
op|')'
newline|'\n'
name|'for'
name|'b'
name|'in'
name|'buddies'
op|':'
newline|'\n'
indent|'            '
name|'room'
op|'='
name|'self'
op|'.'
name|'factory'
op|'.'
name|'chatroom'
op|'['
name|'id'
op|']'
newline|'\n'
name|'bud'
op|'='
name|'self'
op|'.'
name|'factory'
op|'.'
name|'users'
op|'['
name|'b'
op|']'
newline|'\n'
name|'bud'
op|'.'
name|'chatInvite'
op|'('
name|'room'
op|','
name|'self'
op|','
name|'message'
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_chat_accept
dedent|''
dedent|''
name|'def'
name|'toc_chat_accept'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        accept an invitation.\n\n        toc_chat_accept <room id>\n        """'
newline|'\n'
name|'id'
op|'='
name|'int'
op|'('
name|'data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'chatroom'
op|'['
name|'id'
op|']'
op|'.'
name|'join'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_chat_send
dedent|''
name|'def'
name|'toc_chat_send'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        send a message to the chat room.\n\n        toc_chat_send <room id> <message>\n        """'
newline|'\n'
name|'id'
op|','
name|'message'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'data'
op|','
string|'" "'
op|','
number|'1'
op|')'
newline|'\n'
name|'id'
op|'='
name|'int'
op|'('
name|'id'
op|')'
newline|'\n'
name|'message'
op|'='
name|'unquote'
op|'('
name|'message'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'chatroom'
op|'['
name|'id'
op|']'
op|'.'
name|'say'
op|'('
name|'self'
op|','
name|'message'
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_chat_whisper
dedent|''
name|'def'
name|'toc_chat_whisper'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'id'
op|','
name|'user'
op|','
name|'message'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'data'
op|','
string|'" "'
op|','
number|'2'
op|')'
newline|'\n'
name|'id'
op|'='
name|'int'
op|'('
name|'id'
op|')'
newline|'\n'
name|'room'
op|'='
name|'self'
op|'.'
name|'factory'
op|'.'
name|'chatroom'
op|'['
name|'id'
op|']'
newline|'\n'
name|'message'
op|'='
name|'unquote'
op|'('
name|'message'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'users'
op|'['
name|'user'
op|']'
op|'.'
name|'chatWhisper'
op|'('
name|'room'
op|','
name|'self'
op|','
name|'message'
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_chat_leave
dedent|''
name|'def'
name|'toc_chat_leave'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        leave the room.\n\n        toc_chat_leave <room id>\n        """'
newline|'\n'
name|'id'
op|'='
name|'int'
op|'('
name|'data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'chatroom'
op|'['
name|'id'
op|']'
op|'.'
name|'leave'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_set_config
dedent|''
name|'def'
name|'toc_set_config'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        set the saved config.  this gets send when you log in.\n\n        toc_set_config <config>\n        """'
newline|'\n'
name|'self'
op|'.'
name|'saved'
op|'.'
name|'config'
op|'='
name|'unquote'
op|'('
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_get_info
dedent|''
name|'def'
name|'toc_get_info'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        get the user info for a user\n\n        toc_get_info <username>\n        """'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'users'
op|'.'
name|'has_key'
op|'('
name|'data'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendError'
op|'('
number|'901'
op|','
name|'data'
op|')'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"GOTO_URL:TIC:info/%s"'
op|'%'
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_format_nickname
dedent|''
name|'def'
name|'toc_format_nickname'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        change the format of your nickname.\n\n        toc_format_nickname <new format>\n        """'
newline|'\n'
comment|'# XXX may not work'
nl|'\n'
name|'nick'
op|'='
name|'unquote'
op|'('
name|'data'
op|')'
newline|'\n'
name|'if'
name|'normalize'
op|'('
name|'nick'
op|')'
op|'=='
name|'self'
op|'.'
name|'username'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'saved'
op|'.'
name|'nick'
op|'='
name|'nick'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"ADMIN_NICK_STATUS:0"'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendError'
op|'('
name|'BAD_INPUT'
op|')'
newline|'\n'
nl|'\n'
DECL|member|toc_change_passwd
dedent|''
dedent|''
name|'def'
name|'toc_change_passwd'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'orig'
op|','
name|'data'
op|'='
name|'unquotebeg'
op|'('
name|'data'
op|')'
newline|'\n'
name|'new'
op|'='
name|'unquote'
op|'('
name|'data'
op|')'
newline|'\n'
name|'if'
name|'orig'
op|'=='
name|'self'
op|'.'
name|'saved'
op|'.'
name|'password'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'saved'
op|'.'
name|'password'
op|'='
name|'new'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"ADMIN_PASSWD_STATUS:0"'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendError'
op|'('
name|'BAD_INPUT'
op|')'
newline|'\n'
nl|'\n'
DECL|member|sendError
dedent|''
dedent|''
name|'def'
name|'sendError'
op|'('
name|'self'
op|','
name|'code'
op|','
op|'*'
name|'varargs'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        send an error to the user.  listing of error messages is below.\n        """'
newline|'\n'
name|'send'
op|'='
string|'"ERROR:%s"'
op|'%'
name|'code'
newline|'\n'
name|'for'
name|'v'
name|'in'
name|'varargs'
op|':'
newline|'\n'
indent|'            '
name|'send'
op|'='
name|'send'
op|'+'
string|'":"'
op|'+'
name|'v'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendFlap'
op|'('
name|'DATA'
op|','
name|'send'
op|')'
newline|'\n'
nl|'\n'
DECL|member|updateUsers
dedent|''
name|'def'
name|'updateUsers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Update the users who have us on their buddylist.\n        Called when the user changes anything (idle,away) so people can get updates.\n        """'
newline|'\n'
name|'for'
name|'user'
name|'in'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'users'
op|'.'
name|'values'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'username'
name|'in'
name|'user'
op|'.'
name|'buddylist'
name|'and'
name|'self'
op|'.'
name|'canContact'
op|'('
name|'user'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'user'
op|'.'
name|'buddyUpdate'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getStatus
dedent|''
dedent|''
dedent|''
name|'def'
name|'getStatus'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'canContact'
op|'('
name|'user'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
name|'in'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'users'
op|'.'
name|'values'
op|'('
op|')'
op|':'
name|'ol'
op|'='
string|"'T'"
newline|'\n'
name|'else'
op|':'
name|'ol'
op|'='
string|"'F'"
newline|'\n'
name|'idle'
op|'='
number|'0'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'idletime'
op|':'
newline|'\n'
indent|'                '
name|'idle'
op|'='
name|'int'
op|'('
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|'-'
name|'self'
op|'.'
name|'idletime'
op|')'
op|'/'
number|'60'
op|')'
newline|'\n'
dedent|''
name|'return'
op|'('
name|'self'
op|'.'
name|'saved'
op|'.'
name|'nick'
op|','
name|'ol'
op|','
name|'self'
op|'.'
name|'saved'
op|'.'
name|'evilness'
op|','
name|'self'
op|'.'
name|'signontime'
op|','
name|'idle'
op|','
name|'self'
op|'.'
name|'userclass'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'('
name|'self'
op|'.'
name|'saved'
op|'.'
name|'nick'
op|','
string|"'F'"
op|','
number|'0'
op|','
number|'0'
op|','
number|'0'
op|','
name|'self'
op|'.'
name|'userclass'
op|')'
newline|'\n'
nl|'\n'
DECL|member|canContact
dedent|''
dedent|''
name|'def'
name|'canContact'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'permitmode'
op|'=='
name|'PERMITALL'
op|':'
name|'return'
number|'1'
newline|'\n'
name|'elif'
name|'self'
op|'.'
name|'permitmode'
op|'=='
name|'DENYALL'
op|':'
name|'return'
number|'0'
newline|'\n'
name|'elif'
name|'self'
op|'.'
name|'permitmode'
op|'=='
name|'PERMITSOME'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'user'
op|'.'
name|'username'
name|'in'
name|'self'
op|'.'
name|'permitlist'
op|':'
name|'return'
number|'1'
newline|'\n'
name|'else'
op|':'
name|'return'
number|'0'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'permitmode'
op|'=='
name|'DENYSOME'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'user'
op|'.'
name|'username'
name|'in'
name|'self'
op|'.'
name|'denylist'
op|':'
name|'return'
number|'0'
newline|'\n'
name|'else'
op|':'
name|'return'
number|'1'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'assert'
number|'0'
op|','
string|'"bad permitmode %s"'
op|'%'
name|'self'
op|'.'
name|'permitmode'
newline|'\n'
nl|'\n'
DECL|member|buddyUpdate
dedent|''
dedent|''
name|'def'
name|'buddyUpdate'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Update the buddy.  Called from updateUsers()\n        """'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'canContact'
op|'('
name|'user'
op|')'
op|':'
name|'return'
newline|'\n'
name|'status'
op|'='
name|'user'
op|'.'
name|'getStatus'
op|'('
name|'self'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'_laststatus'
op|'.'
name|'has_key'
op|'('
name|'user'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_laststatus'
op|'['
name|'user'
op|']'
op|'='
op|'('
op|')'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'_laststatus'
op|'['
name|'user'
op|']'
op|'!='
name|'status'
op|':'
newline|'\n'
indent|'            '
name|'send'
op|'='
string|'"UPDATE_BUDDY:%s:%s:%s:%s:%s:%s"'
op|'%'
name|'status'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
name|'DATA'
op|','
name|'send'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_laststatus'
op|'['
name|'user'
op|']'
op|'='
name|'status'
newline|'\n'
nl|'\n'
DECL|member|hearWhisper
dedent|''
dedent|''
name|'def'
name|'hearWhisper'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'data'
op|','
name|'auto'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Called when you get an IM.  If auto=1, it\'s an autoreply from an away message.\n        """'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'canContact'
op|'('
name|'user'
op|')'
op|':'
name|'return'
newline|'\n'
name|'if'
name|'auto'
op|':'
name|'auto'
op|'='
string|"'T'"
newline|'\n'
name|'else'
op|':'
name|'auto'
op|'='
string|"'F'"
newline|'\n'
name|'send'
op|'='
string|'"IM_IN:%s:%s:%s"'
op|'%'
op|'('
name|'user'
op|'.'
name|'saved'
op|'.'
name|'nick'
op|','
name|'auto'
op|','
name|'data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
name|'DATA'
op|','
name|'send'
op|')'
newline|'\n'
nl|'\n'
DECL|member|evilFrom
dedent|''
name|'def'
name|'evilFrom'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'user'
op|'=='
string|'""'
op|':'
newline|'\n'
indent|'            '
name|'percent'
op|'='
number|'0.03'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'percent'
op|'='
number|'0.1'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'saved'
op|'.'
name|'evilness'
op|'='
name|'self'
op|'.'
name|'saved'
op|'.'
name|'evilness'
op|'+'
name|'int'
op|'('
op|'('
number|'100'
op|'-'
name|'self'
op|'.'
name|'saved'
op|'.'
name|'evilness'
op|')'
op|'*'
name|'percent'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"EVILED:%s:%s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'saved'
op|'.'
name|'evilness'
op|','
name|'user'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'updateUsers'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|chatJoin
dedent|''
name|'def'
name|'chatJoin'
op|'('
name|'self'
op|','
name|'room'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"CHAT_JOIN:%s:%s"'
op|'%'
op|'('
name|'room'
op|'.'
name|'id'
op|','
name|'room'
op|'.'
name|'name'
op|')'
op|')'
newline|'\n'
name|'f'
op|'='
string|'"CHAT_UPDATE_BUDDY:%s:T"'
op|'%'
name|'room'
op|'.'
name|'id'
newline|'\n'
name|'for'
name|'u'
name|'in'
name|'room'
op|'.'
name|'users'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'u'
op|'!='
name|'self'
op|':'
newline|'\n'
indent|'                '
name|'u'
op|'.'
name|'chatUserUpdate'
op|'('
name|'room'
op|','
name|'self'
op|')'
newline|'\n'
dedent|''
name|'f'
op|'='
name|'f'
op|'+'
string|'":"'
op|'+'
name|'u'
op|'.'
name|'saved'
op|'.'
name|'nick'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
name|'f'
op|')'
newline|'\n'
nl|'\n'
DECL|member|chatInvite
dedent|''
name|'def'
name|'chatInvite'
op|'('
name|'self'
op|','
name|'room'
op|','
name|'user'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'canContact'
op|'('
name|'user'
op|')'
op|':'
name|'return'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"CHAT_INVITE:%s:%s:%s:%s"'
op|'%'
op|'('
name|'room'
op|'.'
name|'name'
op|','
name|'room'
op|'.'
name|'id'
op|','
name|'user'
op|'.'
name|'saved'
op|'.'
name|'nick'
op|','
name|'message'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|chatUserUpdate
dedent|''
name|'def'
name|'chatUserUpdate'
op|'('
name|'self'
op|','
name|'room'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'user'
name|'in'
name|'room'
op|'.'
name|'users'
op|':'
newline|'\n'
indent|'            '
name|'inroom'
op|'='
string|"'T'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'inroom'
op|'='
string|"'F'"
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"CHAT_UPDATE_BUDDY:%s:%s:%s"'
op|'%'
op|'('
name|'room'
op|'.'
name|'id'
op|','
name|'inroom'
op|','
name|'user'
op|'.'
name|'saved'
op|'.'
name|'nick'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|chatMessage
dedent|''
name|'def'
name|'chatMessage'
op|'('
name|'self'
op|','
name|'room'
op|','
name|'user'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'canContact'
op|'('
name|'user'
op|')'
op|':'
name|'return'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"CHAT_IN:%s:%s:F:%s"'
op|'%'
op|'('
name|'room'
op|'.'
name|'id'
op|','
name|'user'
op|'.'
name|'saved'
op|'.'
name|'nick'
op|','
name|'message'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|chatWhisper
dedent|''
name|'def'
name|'chatWhisper'
op|'('
name|'self'
op|','
name|'room'
op|','
name|'user'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'canContact'
op|'('
name|'user'
op|')'
op|':'
name|'return'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"CHAT_IN:%s:%s:T:%s"'
op|'%'
op|'('
name|'room'
op|'.'
name|'id'
op|','
name|'user'
op|'.'
name|'saved'
op|'.'
name|'nick'
op|','
name|'message'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|chatLeave
dedent|''
name|'def'
name|'chatLeave'
op|'('
name|'self'
op|','
name|'room'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"CHAT_LEFT:%s"'
op|'%'
op|'('
name|'room'
op|'.'
name|'id'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|Chatroom
dedent|''
dedent|''
name|'class'
name|'Chatroom'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'fac'
op|','
name|'exchange'
op|','
name|'name'
op|','
name|'id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'exchange'
op|'='
name|'exchange'
newline|'\n'
name|'self'
op|'.'
name|'name'
op|'='
name|'name'
newline|'\n'
name|'self'
op|'.'
name|'id'
op|'='
name|'id'
newline|'\n'
name|'self'
op|'.'
name|'factory'
op|'='
name|'fac'
newline|'\n'
name|'self'
op|'.'
name|'users'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|member|join
dedent|''
name|'def'
name|'join'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'user'
name|'in'
name|'self'
op|'.'
name|'users'
op|':'
newline|'\n'
indent|'            '
name|'return'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'users'
op|'.'
name|'append'
op|'('
name|'user'
op|')'
newline|'\n'
name|'user'
op|'.'
name|'chatJoin'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|leave
dedent|''
name|'def'
name|'leave'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'user'
name|'not'
name|'in'
name|'self'
op|'.'
name|'users'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'TOCParseError'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'users'
op|'.'
name|'remove'
op|'('
name|'user'
op|')'
newline|'\n'
name|'user'
op|'.'
name|'chatLeave'
op|'('
name|'self'
op|')'
newline|'\n'
name|'for'
name|'u'
name|'in'
name|'self'
op|'.'
name|'users'
op|':'
newline|'\n'
indent|'            '
name|'u'
op|'.'
name|'chatUserUpdate'
op|'('
name|'self'
op|','
name|'user'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'users'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'factory'
op|'.'
name|'remChatroom'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|say
dedent|''
dedent|''
name|'def'
name|'say'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'u'
name|'in'
name|'self'
op|'.'
name|'users'
op|':'
newline|'\n'
indent|'            '
name|'u'
op|'.'
name|'chatMessage'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'message'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SavedUser
dedent|''
dedent|''
dedent|''
name|'class'
name|'SavedUser'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'config'
op|'='
string|'""'
newline|'\n'
name|'self'
op|'.'
name|'nick'
op|'='
string|'""'
newline|'\n'
name|'self'
op|'.'
name|'password'
op|'='
string|'""'
newline|'\n'
name|'self'
op|'.'
name|'evilness'
op|'='
number|'0'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TOCFactory
dedent|''
dedent|''
name|'class'
name|'TOCFactory'
op|'('
name|'protocol'
op|'.'
name|'Factory'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'users'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'savedusers'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'chatroom'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'chatroomid'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|buildProtocol
dedent|''
name|'def'
name|'buildProtocol'
op|'('
name|'self'
op|','
name|'addr'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'p'
op|'='
name|'TOC'
op|'('
op|')'
newline|'\n'
name|'p'
op|'.'
name|'factory'
op|'='
name|'self'
newline|'\n'
name|'return'
name|'p'
newline|'\n'
nl|'\n'
DECL|member|getChatroom
dedent|''
name|'def'
name|'getChatroom'
op|'('
name|'self'
op|','
name|'exchange'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'i'
name|'in'
name|'self'
op|'.'
name|'chatroom'
op|'.'
name|'values'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'normalize'
op|'('
name|'i'
op|'.'
name|'name'
op|')'
op|'=='
name|'normalize'
op|'('
name|'name'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'i'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'chatroom'
op|'['
name|'self'
op|'.'
name|'chatroomid'
op|']'
op|'='
name|'Chatroom'
op|'('
name|'self'
op|','
name|'exchange'
op|','
name|'name'
op|','
name|'self'
op|'.'
name|'chatroomid'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'chatroomid'
op|'='
name|'self'
op|'.'
name|'chatroomid'
op|'+'
number|'1'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'chatroom'
op|'['
name|'self'
op|'.'
name|'chatroomid'
op|'-'
number|'1'
op|']'
newline|'\n'
nl|'\n'
DECL|member|remChatroom
dedent|''
name|'def'
name|'remChatroom'
op|'('
name|'self'
op|','
name|'room'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'id'
op|'='
name|'room'
op|'.'
name|'id'
newline|'\n'
name|'del'
name|'self'
op|'.'
name|'chatroom'
op|'['
name|'id'
op|']'
newline|'\n'
nl|'\n'
DECL|variable|MAXARGS
dedent|''
dedent|''
name|'MAXARGS'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'MAXARGS'
op|'['
string|'"CONFIG"'
op|']'
op|'='
number|'0'
newline|'\n'
name|'MAXARGS'
op|'['
string|'"NICK"'
op|']'
op|'='
number|'0'
newline|'\n'
name|'MAXARGS'
op|'['
string|'"IM_IN"'
op|']'
op|'='
number|'2'
newline|'\n'
name|'MAXARGS'
op|'['
string|'"UPDATE_BUDDY"'
op|']'
op|'='
number|'5'
newline|'\n'
name|'MAXARGS'
op|'['
string|'"ERROR"'
op|']'
op|'='
op|'-'
number|'1'
newline|'\n'
name|'MAXARGS'
op|'['
string|'"EVILED"'
op|']'
op|'='
number|'1'
newline|'\n'
name|'MAXARGS'
op|'['
string|'"CHAT_JOIN"'
op|']'
op|'='
number|'1'
newline|'\n'
name|'MAXARGS'
op|'['
string|'"CHAT_IN"'
op|']'
op|'='
number|'3'
newline|'\n'
name|'MAXARGS'
op|'['
string|'"CHAT_UPDATE_BUDDY"'
op|']'
op|'='
op|'-'
number|'1'
newline|'\n'
name|'MAXARGS'
op|'['
string|'"CHAT_INVITE"'
op|']'
op|'='
number|'3'
newline|'\n'
name|'MAXARGS'
op|'['
string|'"CHAT_LEFT"'
op|']'
op|'='
number|'0'
newline|'\n'
name|'MAXARGS'
op|'['
string|'"ADMIN_NICK_STATUS"'
op|']'
op|'='
number|'0'
newline|'\n'
name|'MAXARGS'
op|'['
string|'"ADMIN_PASSWD_STATUS"'
op|']'
op|'='
number|'0'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TOCClient
name|'class'
name|'TOCClient'
op|'('
name|'protocol'
op|'.'
name|'Protocol'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'username'
op|','
name|'password'
op|','
name|'authhost'
op|'='
string|'"login.oscar.aol.com"'
op|','
name|'authport'
op|'='
number|'5190'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'username'
op|'='
name|'normalize'
op|'('
name|'username'
op|')'
comment|'# our username'
newline|'\n'
name|'self'
op|'.'
name|'_password'
op|'='
name|'password'
comment|'# our password'
newline|'\n'
name|'self'
op|'.'
name|'_mode'
op|'='
string|'"SendNick"'
comment|'# current mode'
newline|'\n'
name|'self'
op|'.'
name|'_ourseqnum'
op|'='
number|'19071'
comment|'# current sequence number (for sendFlap)'
newline|'\n'
name|'self'
op|'.'
name|'_authhost'
op|'='
name|'authhost'
comment|'# authorization host'
newline|'\n'
name|'self'
op|'.'
name|'_authport'
op|'='
name|'authport'
comment|'# authorization port'
newline|'\n'
name|'self'
op|'.'
name|'_online'
op|'='
number|'0'
comment|'# are we online?'
newline|'\n'
name|'self'
op|'.'
name|'_buddies'
op|'='
op|'['
op|']'
comment|'# the current buddy list'
newline|'\n'
name|'self'
op|'.'
name|'_privacymode'
op|'='
name|'PERMITALL'
comment|'# current privacy mode'
newline|'\n'
name|'self'
op|'.'
name|'_permitlist'
op|'='
op|'['
op|']'
comment|'# list of users on the permit list'
newline|'\n'
name|'self'
op|'.'
name|'_roomnames'
op|'='
op|'{'
op|'}'
comment|"# the names for each of the rooms we're in"
newline|'\n'
name|'self'
op|'.'
name|'_receivedchatmembers'
op|'='
op|'{'
op|'}'
comment|"# have we gotten who's in our room yet?"
newline|'\n'
name|'self'
op|'.'
name|'_denylist'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_cookies'
op|'='
op|'{'
op|'}'
comment|'# for file transfers'
newline|'\n'
name|'self'
op|'.'
name|'_buf'
op|'='
string|"''"
comment|'# current data buffer'
newline|'\n'
name|'self'
op|'.'
name|'_awaymessage'
op|'='
string|"''"
newline|'\n'
nl|'\n'
DECL|member|_debug
dedent|''
name|'def'
name|'_debug'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'log'
op|'.'
name|'msg'
op|'('
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|sendFlap
dedent|''
name|'def'
name|'sendFlap'
op|'('
name|'self'
op|','
name|'type'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'type'
op|'=='
name|'DATA'
op|':'
newline|'\n'
indent|'            '
name|'data'
op|'='
name|'data'
op|'+'
string|'"\\000"'
newline|'\n'
dedent|''
name|'length'
op|'='
name|'len'
op|'('
name|'data'
op|')'
newline|'\n'
name|'s'
op|'='
string|'"*"'
newline|'\n'
name|'s'
op|'='
name|'s'
op|'+'
name|'struct'
op|'.'
name|'pack'
op|'('
string|'"!BHH"'
op|','
name|'type'
op|','
name|'self'
op|'.'
name|'_ourseqnum'
op|','
name|'length'
op|')'
newline|'\n'
name|'s'
op|'='
name|'s'
op|'+'
name|'data'
newline|'\n'
name|'self'
op|'.'
name|'_ourseqnum'
op|'='
name|'self'
op|'.'
name|'_ourseqnum'
op|'+'
number|'1'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_ourseqnum'
op|'>'
op|'('
number|'256'
op|'*'
number|'256'
op|'+'
number|'256'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_ourseqnum'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'_debug'
op|'('
name|'data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'write'
op|'('
name|'s'
op|')'
newline|'\n'
nl|'\n'
DECL|member|isFlap
dedent|''
name|'def'
name|'isFlap'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        tests to see if a flap is actually on the buffer\n        """'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_buf'
op|'=='
string|"''"
op|':'
name|'return'
number|'0'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_buf'
op|'['
number|'0'
op|']'
op|'!='
string|'"*"'
op|':'
name|'return'
number|'0'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'_buf'
op|')'
op|'<'
number|'6'
op|':'
name|'return'
number|'0'
newline|'\n'
name|'foo'
op|','
name|'type'
op|','
name|'seqnum'
op|','
name|'length'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|'"!BBHH"'
op|','
name|'self'
op|'.'
name|'_buf'
op|'['
op|':'
number|'6'
op|']'
op|')'
newline|'\n'
name|'if'
name|'type'
name|'not'
name|'in'
name|'range'
op|'('
number|'1'
op|','
number|'6'
op|')'
op|':'
name|'return'
number|'0'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'_buf'
op|')'
op|'<'
number|'6'
op|'+'
name|'length'
op|':'
name|'return'
number|'0'
newline|'\n'
name|'return'
number|'1'
newline|'\n'
nl|'\n'
DECL|member|readFlap
dedent|''
name|'def'
name|'readFlap'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'_buf'
op|'=='
string|"''"
op|':'
name|'return'
name|'None'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_buf'
op|'['
number|'0'
op|']'
op|'!='
string|'"*"'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'TOCParseError'
newline|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'_buf'
op|')'
op|'<'
number|'6'
op|':'
name|'return'
name|'None'
newline|'\n'
name|'foo'
op|','
name|'type'
op|','
name|'seqnum'
op|','
name|'length'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|'"!BBHH"'
op|','
name|'self'
op|'.'
name|'_buf'
op|'['
op|':'
number|'6'
op|']'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'_buf'
op|')'
op|'<'
number|'6'
op|'+'
name|'length'
op|':'
name|'return'
name|'None'
newline|'\n'
name|'data'
op|'='
name|'self'
op|'.'
name|'_buf'
op|'['
number|'6'
op|':'
number|'6'
op|'+'
name|'length'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_buf'
op|'='
name|'self'
op|'.'
name|'_buf'
op|'['
number|'6'
op|'+'
name|'length'
op|':'
op|']'
newline|'\n'
name|'if'
name|'data'
name|'and'
name|'data'
op|'['
op|'-'
number|'1'
op|']'
op|'=='
string|'"\\000"'
op|':'
newline|'\n'
indent|'            '
name|'data'
op|'='
name|'data'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
dedent|''
name|'return'
op|'['
name|'type'
op|','
name|'data'
op|']'
newline|'\n'
nl|'\n'
DECL|member|connectionMade
dedent|''
name|'def'
name|'connectionMade'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_debug'
op|'('
string|'"connection made! %s"'
op|'%'
name|'self'
op|'.'
name|'transport'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'write'
op|'('
string|'"FLAPON\\r\\n\\r\\n"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|connectionLost
dedent|''
name|'def'
name|'connectionLost'
op|'('
name|'self'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_debug'
op|'('
string|'"connection lost!"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_online'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|dataReceived
dedent|''
name|'def'
name|'dataReceived'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_buf'
op|'='
name|'self'
op|'.'
name|'_buf'
op|'+'
name|'data'
newline|'\n'
name|'while'
name|'self'
op|'.'
name|'isFlap'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'flap'
op|'='
name|'self'
op|'.'
name|'readFlap'
op|'('
op|')'
newline|'\n'
name|'func'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
string|'"mode%s"'
op|'%'
name|'self'
op|'.'
name|'_mode'
op|')'
newline|'\n'
name|'func'
op|'('
name|'flap'
op|')'
newline|'\n'
nl|'\n'
DECL|member|modeSendNick
dedent|''
dedent|''
name|'def'
name|'modeSendNick'
op|'('
name|'self'
op|','
name|'flap'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'flap'
op|'!='
op|'['
number|'1'
op|','
string|'"\\000\\000\\000\\001"'
op|']'
op|':'
name|'raise'
name|'TOCParseError'
newline|'\n'
name|'s'
op|'='
string|'"\\000\\000\\000\\001\\000\\001"'
op|'+'
name|'struct'
op|'.'
name|'pack'
op|'('
string|'"!H"'
op|','
name|'len'
op|'('
name|'self'
op|'.'
name|'username'
op|')'
op|')'
op|'+'
name|'self'
op|'.'
name|'username'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'1'
op|','
name|'s'
op|')'
newline|'\n'
name|'s'
op|'='
string|'"toc_signon %s %s  %s %s english \\"penguin\\""'
op|'%'
op|'('
name|'self'
op|'.'
name|'_authhost'
op|','
name|'self'
op|'.'
name|'_authport'
op|','
name|'self'
op|'.'
name|'username'
op|','
name|'roast'
op|'('
name|'self'
op|'.'
name|'_password'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
name|'s'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_mode'
op|'='
string|'"Data"'
newline|'\n'
nl|'\n'
DECL|member|modeData
dedent|''
name|'def'
name|'modeData'
op|'('
name|'self'
op|','
name|'flap'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'flap'
op|'['
number|'1'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'return'
newline|'\n'
dedent|''
name|'if'
name|'not'
string|"':'"
name|'in'
name|'flap'
op|'['
number|'1'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_debug'
op|'('
string|'"bad SNAC:%s"'
op|'%'
op|'('
name|'flap'
op|'['
number|'1'
op|']'
op|')'
op|')'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'command'
op|','
name|'rest'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'flap'
op|'['
number|'1'
op|']'
op|','
string|'":"'
op|','
number|'1'
op|')'
newline|'\n'
name|'if'
name|'MAXARGS'
op|'.'
name|'has_key'
op|'('
name|'command'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'maxsplit'
op|'='
name|'MAXARGS'
op|'['
name|'command'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'maxsplit'
op|'='
op|'-'
number|'1'
newline|'\n'
dedent|''
name|'if'
name|'maxsplit'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'l'
op|'='
name|'tuple'
op|'('
name|'string'
op|'.'
name|'split'
op|'('
name|'rest'
op|','
string|'":"'
op|')'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'maxsplit'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'l'
op|'='
op|'('
name|'rest'
op|','
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'l'
op|'='
name|'tuple'
op|'('
name|'string'
op|'.'
name|'split'
op|'('
name|'rest'
op|','
string|'":"'
op|','
name|'maxsplit'
op|')'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'_debug'
op|'('
string|'"%s %s"'
op|'%'
op|'('
name|'command'
op|','
name|'l'
op|')'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'func'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
string|'"toc%s"'
op|'%'
name|'command'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_debug'
op|'('
string|'"calling %s"'
op|'%'
name|'func'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_debug'
op|'('
string|'"calling %s"'
op|'%'
name|'self'
op|'.'
name|'tocUNKNOWN'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'tocUNKNOWN'
op|'('
name|'command'
op|','
name|'l'
op|')'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'func'
op|'('
name|'l'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tocUNKNOWN
dedent|''
name|'def'
name|'tocUNKNOWN'
op|'('
name|'self'
op|','
name|'command'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|tocSIGN_ON
dedent|''
name|'def'
name|'tocSIGN_ON'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'data'
op|'!='
op|'('
string|'"TOC1.0"'
op|','
op|')'
op|':'
name|'raise'
name|'TOCParseError'
newline|'\n'
name|'self'
op|'.'
name|'_debug'
op|'('
string|'"Whee, signed on!"'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_buddies'
op|':'
name|'self'
op|'.'
name|'add_buddy'
op|'('
name|'self'
op|'.'
name|'_buddies'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_online'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'onLine'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|tocNICK
dedent|''
name|'def'
name|'tocNICK'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Handle a message that looks like::\n\n            NICK:<format of nickname>\n        """'
newline|'\n'
name|'self'
op|'.'
name|'username'
op|'='
name|'data'
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
DECL|member|tocCONFIG
dedent|''
name|'def'
name|'tocCONFIG'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Handle a message that looks like::\n\n            CONFIG:<config>\n\n        Format of config data:\n\n            - g: group.  all users until next g or end of config are in this group\n            - b: buddy\n            - p: person on the permit list\n            - d: person on the deny list\n            - m: permit/deny mode (1: permit all, 2: deny all, 3: permit some, 4: deny some)\n        """'
newline|'\n'
name|'data'
op|'='
name|'data'
op|'['
number|'0'
op|']'
newline|'\n'
name|'if'
name|'data'
name|'and'
name|'data'
op|'['
number|'0'
op|']'
op|'=='
string|'"{"'
op|':'
name|'data'
op|'='
name|'data'
op|'['
number|'1'
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
name|'lines'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'data'
op|','
string|'"\\n"'
op|')'
newline|'\n'
name|'buddylist'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'currentgroup'
op|'='
string|'""'
newline|'\n'
name|'permit'
op|'='
op|'['
op|']'
newline|'\n'
name|'deny'
op|'='
op|'['
op|']'
newline|'\n'
name|'mode'
op|'='
number|'1'
newline|'\n'
name|'for'
name|'l'
name|'in'
name|'lines'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'l'
op|':'
newline|'\n'
indent|'                '
name|'code'
op|','
name|'data'
op|'='
name|'l'
op|'['
number|'0'
op|']'
op|','
name|'l'
op|'['
number|'2'
op|':'
op|']'
newline|'\n'
name|'if'
name|'code'
op|'=='
string|"'g'"
op|':'
comment|'# group'
newline|'\n'
indent|'                    '
name|'currentgroup'
op|'='
name|'data'
newline|'\n'
name|'buddylist'
op|'['
name|'currentgroup'
op|']'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'code'
op|'=='
string|"'b'"
op|':'
newline|'\n'
indent|'                    '
name|'buddylist'
op|'['
name|'currentgroup'
op|']'
op|'.'
name|'append'
op|'('
name|'data'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'code'
op|'=='
string|"'p'"
op|':'
newline|'\n'
indent|'                    '
name|'permit'
op|'.'
name|'append'
op|'('
name|'data'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'code'
op|'=='
string|"'d'"
op|':'
newline|'\n'
indent|'                    '
name|'deny'
op|'.'
name|'append'
op|'('
name|'data'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'code'
op|'=='
string|"'m'"
op|':'
newline|'\n'
indent|'                    '
name|'mode'
op|'='
name|'int'
op|'('
name|'data'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'self'
op|'.'
name|'gotConfig'
op|'('
name|'mode'
op|','
name|'buddylist'
op|','
name|'permit'
op|','
name|'deny'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tocIM_IN
dedent|''
name|'def'
name|'tocIM_IN'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Handle a message that looks like::\n\n            IM_IN:<user>:<autoreply T|F>:message\n        """'
newline|'\n'
name|'user'
op|'='
name|'data'
op|'['
number|'0'
op|']'
newline|'\n'
name|'autoreply'
op|'='
op|'('
name|'data'
op|'['
number|'1'
op|']'
op|'=='
string|"'T'"
op|')'
newline|'\n'
name|'message'
op|'='
name|'data'
op|'['
number|'2'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'hearMessage'
op|'('
name|'user'
op|','
name|'message'
op|','
name|'autoreply'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tocUPDATE_BUDDY
dedent|''
name|'def'
name|'tocUPDATE_BUDDY'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Handle a message that looks like::\n\n            UPDATE_BUDDY:<username>:<online T|F>:<warning level>:<signon time>:<idle time (minutes)>:<user class>\n        """'
newline|'\n'
name|'data'
op|'='
name|'list'
op|'('
name|'data'
op|')'
newline|'\n'
name|'online'
op|'='
op|'('
name|'data'
op|'['
number|'1'
op|']'
op|'=='
string|"'T'"
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'data'
op|'['
number|'5'
op|']'
op|')'
op|'=='
number|'2'
op|':'
newline|'\n'
indent|'            '
name|'data'
op|'['
number|'5'
op|']'
op|'='
name|'data'
op|'['
number|'5'
op|']'
op|'+'
string|'" "'
newline|'\n'
dedent|''
name|'away'
op|'='
op|'('
name|'data'
op|'['
number|'5'
op|']'
op|'['
op|'-'
number|'1'
op|']'
op|'=='
string|"'U'"
op|')'
newline|'\n'
name|'if'
name|'data'
op|'['
number|'5'
op|']'
op|'['
op|'-'
number|'1'
op|']'
op|'=='
string|"'U'"
op|':'
newline|'\n'
indent|'            '
name|'data'
op|'['
number|'5'
op|']'
op|'='
name|'data'
op|'['
number|'5'
op|']'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'updateBuddy'
op|'('
name|'data'
op|'['
number|'0'
op|']'
op|','
name|'online'
op|','
name|'int'
op|'('
name|'data'
op|'['
number|'2'
op|']'
op|')'
op|','
name|'int'
op|'('
name|'data'
op|'['
number|'3'
op|']'
op|')'
op|','
name|'int'
op|'('
name|'data'
op|'['
number|'4'
op|']'
op|')'
op|','
name|'data'
op|'['
number|'5'
op|']'
op|','
name|'away'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tocERROR
dedent|''
name|'def'
name|'tocERROR'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Handle a message that looks like::\n\n            ERROR:<error code>:<misc. data>\n        """'
newline|'\n'
name|'code'
op|','
name|'args'
op|'='
name|'data'
op|'['
number|'0'
op|']'
op|','
name|'data'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'hearError'
op|'('
name|'int'
op|'('
name|'code'
op|')'
op|','
name|'args'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tocEVILED
dedent|''
name|'def'
name|'tocEVILED'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Handle a message that looks like::\n\n            EVILED:<current warning level>:<user who warned us>\n        """'
newline|'\n'
name|'self'
op|'.'
name|'hearWarning'
op|'('
name|'data'
op|'['
number|'0'
op|']'
op|','
name|'data'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tocCHAT_JOIN
dedent|''
name|'def'
name|'tocCHAT_JOIN'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Handle a message that looks like::\n\n            CHAT_JOIN:<room id>:<room name>\n        """'
newline|'\n'
comment|'#self.chatJoined(int(data[0]),data[1])'
nl|'\n'
name|'self'
op|'.'
name|'_roomnames'
op|'['
name|'int'
op|'('
name|'data'
op|'['
number|'0'
op|']'
op|')'
op|']'
op|'='
name|'data'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_receivedchatmembers'
op|'['
name|'int'
op|'('
name|'data'
op|'['
number|'0'
op|']'
op|')'
op|']'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|tocCHAT_UPDATE_BUDDY
dedent|''
name|'def'
name|'tocCHAT_UPDATE_BUDDY'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Handle a message that looks like::\n\n            CHAT_UPDATE_BUDDY:<room id>:<in room? T/F>:<user 1>:<user 2>...\n        """'
newline|'\n'
name|'roomid'
op|'='
name|'int'
op|'('
name|'data'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'inroom'
op|'='
op|'('
name|'data'
op|'['
number|'1'
op|']'
op|'=='
string|"'T'"
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_receivedchatmembers'
op|'['
name|'roomid'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'u'
name|'in'
name|'data'
op|'['
number|'2'
op|':'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'chatUpdate'
op|'('
name|'roomid'
op|','
name|'u'
op|','
name|'inroom'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_receivedchatmembers'
op|'['
name|'roomid'
op|']'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'chatJoined'
op|'('
name|'roomid'
op|','
name|'self'
op|'.'
name|'_roomnames'
op|'['
name|'roomid'
op|']'
op|','
name|'list'
op|'('
name|'data'
op|'['
number|'2'
op|':'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tocCHAT_IN
dedent|''
dedent|''
name|'def'
name|'tocCHAT_IN'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Handle a message that looks like::\n\n            CHAT_IN:<room id>:<username>:<whisper T/F>:<message>\n\n        whisper isn\'t used\n        """'
newline|'\n'
name|'whisper'
op|'='
op|'('
name|'data'
op|'['
number|'2'
op|']'
op|'=='
string|"'T'"
op|')'
newline|'\n'
name|'if'
name|'whisper'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'chatHearWhisper'
op|'('
name|'int'
op|'('
name|'data'
op|'['
number|'0'
op|']'
op|')'
op|','
name|'data'
op|'['
number|'1'
op|']'
op|','
name|'data'
op|'['
number|'3'
op|']'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'chatHearMessage'
op|'('
name|'int'
op|'('
name|'data'
op|'['
number|'0'
op|']'
op|')'
op|','
name|'data'
op|'['
number|'1'
op|']'
op|','
name|'data'
op|'['
number|'3'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tocCHAT_INVITE
dedent|''
dedent|''
name|'def'
name|'tocCHAT_INVITE'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Handle a message that looks like::\n\n            CHAT_INVITE:<room name>:<room id>:<username>:<message>\n        """'
newline|'\n'
name|'self'
op|'.'
name|'chatInvited'
op|'('
name|'int'
op|'('
name|'data'
op|'['
number|'1'
op|']'
op|')'
op|','
name|'data'
op|'['
number|'0'
op|']'
op|','
name|'data'
op|'['
number|'2'
op|']'
op|','
name|'data'
op|'['
number|'3'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tocCHAT_LEFT
dedent|''
name|'def'
name|'tocCHAT_LEFT'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Handle a message that looks like::\n\n            CHAT_LEFT:<room id>\n        """'
newline|'\n'
name|'self'
op|'.'
name|'chatLeft'
op|'('
name|'int'
op|'('
name|'data'
op|'['
number|'0'
op|']'
op|')'
op|')'
newline|'\n'
name|'del'
name|'self'
op|'.'
name|'_receivedchatmembers'
op|'['
name|'int'
op|'('
name|'data'
op|'['
number|'0'
op|']'
op|')'
op|']'
newline|'\n'
name|'del'
name|'self'
op|'.'
name|'_roomnames'
op|'['
name|'int'
op|'('
name|'data'
op|'['
number|'0'
op|']'
op|')'
op|']'
newline|'\n'
nl|'\n'
DECL|member|tocRVOUS_PROPOSE
dedent|''
name|'def'
name|'tocRVOUS_PROPOSE'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Handle a message that looks like::\n\n            RVOUS_PROPOSE:<user>:<uuid>:<cookie>:<seq>:<rip>:<pip>:<vip>:<port>\n                  [:tlv tag1:tlv value1[:tlv tag2:tlv value2[:...]]]\n        """'
newline|'\n'
name|'user'
op|','
name|'uid'
op|','
name|'cookie'
op|','
name|'seq'
op|','
name|'rip'
op|','
name|'pip'
op|','
name|'vip'
op|','
name|'port'
op|'='
name|'data'
op|'['
op|':'
number|'8'
op|']'
newline|'\n'
name|'cookie'
op|'='
name|'base64'
op|'.'
name|'decodestring'
op|'('
name|'cookie'
op|')'
newline|'\n'
name|'port'
op|'='
name|'int'
op|'('
name|'port'
op|')'
newline|'\n'
name|'tlvs'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'8'
op|','
name|'len'
op|'('
name|'data'
op|')'
op|','
number|'2'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'key'
op|'='
name|'data'
op|'['
name|'i'
op|']'
newline|'\n'
name|'value'
op|'='
name|'base64'
op|'.'
name|'decodestring'
op|'('
name|'data'
op|'['
name|'i'
op|'+'
number|'1'
op|']'
op|')'
newline|'\n'
name|'tlvs'
op|'['
name|'key'
op|']'
op|'='
name|'value'
newline|'\n'
dedent|''
name|'name'
op|'='
name|'UUIDS'
op|'['
name|'uid'
op|']'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'func'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
string|'"toc%s"'
op|'%'
name|'name'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_debug'
op|'('
string|'"no function for UID %s"'
op|'%'
name|'uid'
op|')'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'func'
op|'('
name|'user'
op|','
name|'cookie'
op|','
name|'seq'
op|','
name|'pip'
op|','
name|'vip'
op|','
name|'port'
op|','
name|'tlvs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tocSEND_FILE
dedent|''
name|'def'
name|'tocSEND_FILE'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'cookie'
op|','
name|'seq'
op|','
name|'pip'
op|','
name|'vip'
op|','
name|'port'
op|','
name|'tlvs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'tlvs'
op|'.'
name|'has_key'
op|'('
string|"'12'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'description'
op|'='
name|'tlvs'
op|'['
string|"'12'"
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'description'
op|'='
string|'""'
newline|'\n'
dedent|''
name|'subtype'
op|','
name|'numfiles'
op|','
name|'size'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|'"!HHI"'
op|','
name|'tlvs'
op|'['
string|"'10001'"
op|']'
op|'['
op|':'
number|'8'
op|']'
op|')'
newline|'\n'
name|'name'
op|'='
name|'tlvs'
op|'['
string|"'10001'"
op|']'
op|'['
number|'8'
op|':'
op|'-'
number|'4'
op|']'
newline|'\n'
name|'while'
name|'name'
op|'['
op|'-'
number|'1'
op|']'
op|'=='
string|"'\\000'"
op|':'
newline|'\n'
indent|'            '
name|'name'
op|'='
name|'name'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'_cookies'
op|'['
name|'cookie'
op|']'
op|'='
op|'['
name|'user'
op|','
name|'SEND_FILE_UID'
op|','
name|'pip'
op|','
name|'port'
op|','
op|'{'
string|"'name'"
op|':'
name|'name'
op|'}'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'rvousProposal'
op|'('
string|'"send"'
op|','
name|'cookie'
op|','
name|'user'
op|','
name|'vip'
op|','
name|'port'
op|','
name|'description'
op|'='
name|'description'
op|','
nl|'\n'
name|'name'
op|'='
name|'name'
op|','
name|'files'
op|'='
name|'numfiles'
op|','
name|'size'
op|'='
name|'size'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tocGET_FILE
dedent|''
name|'def'
name|'tocGET_FILE'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'cookie'
op|','
name|'seq'
op|','
name|'pip'
op|','
name|'vip'
op|','
name|'port'
op|','
name|'tlvs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
newline|'\n'
comment|'# XXX add this back in'
nl|'\n'
comment|'#reactor.clientTCP(pip,port,GetFileTransfer(self,cookie,os.path.expanduser("~")))'
nl|'\n'
comment|'#self.rvous_accept(user,cookie,GET_FILE_UID)'
nl|'\n'
nl|'\n'
DECL|member|onLine
dedent|''
name|'def'
name|'onLine'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when we are first online\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|gotConfig
dedent|''
name|'def'
name|'gotConfig'
op|'('
name|'self'
op|','
name|'mode'
op|','
name|'buddylist'
op|','
name|'permit'
op|','
name|'deny'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when we get a configuration from the server\n        mode := permit/deny mode\n        buddylist := current buddylist\n        permit := permit list\n        deny := deny list\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|hearError
dedent|''
name|'def'
name|'hearError'
op|'('
name|'self'
op|','
name|'code'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when an error is received\n        code := error code\n        args := misc. arguments (username, etc.)\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|hearWarning
dedent|''
name|'def'
name|'hearWarning'
op|'('
name|'self'
op|','
name|'newamount'
op|','
name|'username'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when we get warned\n        newamount := the current warning level\n        username := the user who warned us, or \'\' if it\'s anonymous\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|hearMessage
dedent|''
name|'def'
name|'hearMessage'
op|'('
name|'self'
op|','
name|'username'
op|','
name|'message'
op|','
name|'autoreply'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when you receive an IM\n        username := the user who the IM is from\n        message := the message\n        autoreply := true if the message is an autoreply from an away message\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|updateBuddy
dedent|''
name|'def'
name|'updateBuddy'
op|'('
name|'self'
op|','
name|'username'
op|','
name|'online'
op|','
name|'evilness'
op|','
name|'signontime'
op|','
name|'idletime'
op|','
name|'userclass'
op|','
name|'away'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when a buddy changes state\n        username := the user whos state changed\n        online := true if the user is online\n        evilness := the users current warning level\n        signontime := the time the user signed on (UNIX epoch)\n        idletime := the time the user has been idle (minutes)\n        away := true if the user is away\n        userclass := the class of the user (generally " O")\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|chatJoined
dedent|''
name|'def'
name|'chatJoined'
op|'('
name|'self'
op|','
name|'roomid'
op|','
name|'roomname'
op|','
name|'users'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        we just joined a chat room\n        roomid := the AIM id for the room\n        roomname := the name for the room\n        users := a list of the users already in the room\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|chatUpdate
dedent|''
name|'def'
name|'chatUpdate'
op|'('
name|'self'
op|','
name|'roomid'
op|','
name|'username'
op|','
name|'inroom'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        a user has joined the room\n        roomid := the AIM id for the room\n        username := the username\n        inroom := true if the user is in the room\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|chatHearMessage
dedent|''
name|'def'
name|'chatHearMessage'
op|'('
name|'self'
op|','
name|'roomid'
op|','
name|'username'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        a message was sent to the room\n        roomid := the AIM id for the room\n        username := the user who sent the message\n        message := the message\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|chatHearWhisper
dedent|''
name|'def'
name|'chatHearWhisper'
op|'('
name|'self'
op|','
name|'roomid'
op|','
name|'username'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        someone whispered to us in a chatroom\n        roomid := the AIM for the room\n        username := the user who whispered to us\n        message := the message\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|chatInvited
dedent|''
name|'def'
name|'chatInvited'
op|'('
name|'self'
op|','
name|'roomid'
op|','
name|'roomname'
op|','
name|'username'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        we were invited to a chat room\n        roomid := the AIM id for the room\n        roomname := the name of the room\n        username := the user who invited us\n        message := the invite message\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|chatLeft
dedent|''
name|'def'
name|'chatLeft'
op|'('
name|'self'
op|','
name|'roomid'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        we left the room\n        roomid := the AIM id for the room\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|rvousProposal
dedent|''
name|'def'
name|'rvousProposal'
op|'('
name|'self'
op|','
name|'type'
op|','
name|'cookie'
op|','
name|'user'
op|','
name|'vip'
op|','
name|'port'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        we were asked for a rondevouz\n        type := the type of rondevous.  currently, one of ["send"]\n        cookie := the cookie. pass this to rvous_accept()\n        user := the user who asked us\n        vip := their verified_ip\n        port := the port they want us to conenct to\n        kw := misc. args\n        """'
newline|'\n'
name|'pass'
comment|'#self.rvous_accept(cookie)'
newline|'\n'
nl|'\n'
DECL|member|receiveBytes
dedent|''
name|'def'
name|'receiveBytes'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'file'
op|','
name|'chunk'
op|','
name|'sofar'
op|','
name|'total'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        we received part of a file from a file transfer\n        file := the name of the file\n        chunk := the chunk of data\n        sofar := how much data we\'ve gotten so far\n        total := the total amount of data\n        """'
newline|'\n'
name|'pass'
comment|'#print user,file,sofar,total'
newline|'\n'
nl|'\n'
DECL|member|isaway
dedent|''
name|'def'
name|'isaway'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        return our away status\n        """'
newline|'\n'
name|'return'
name|'len'
op|'('
name|'self'
op|'.'
name|'_awaymessage'
op|')'
op|'>'
number|'0'
newline|'\n'
nl|'\n'
DECL|member|set_config
dedent|''
name|'def'
name|'set_config'
op|'('
name|'self'
op|','
name|'mode'
op|','
name|'buddylist'
op|','
name|'permit'
op|','
name|'deny'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        set the server configuration\n        mode := permit mode\n        buddylist := buddy list\n        permit := permit list\n        deny := deny list\n        """'
newline|'\n'
name|'s'
op|'='
string|'"m %s\\n"'
op|'%'
name|'mode'
newline|'\n'
name|'for'
name|'g'
name|'in'
name|'buddylist'
op|'.'
name|'keys'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'='
name|'s'
op|'+'
string|'"g %s\\n"'
op|'%'
name|'g'
newline|'\n'
name|'for'
name|'u'
name|'in'
name|'buddylist'
op|'['
name|'g'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'s'
op|'='
name|'s'
op|'+'
string|'"b %s\\n"'
op|'%'
name|'u'
newline|'\n'
dedent|''
dedent|''
name|'for'
name|'p'
name|'in'
name|'permit'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'='
name|'s'
op|'+'
string|'"p %s\\n"'
op|'%'
name|'p'
newline|'\n'
dedent|''
name|'for'
name|'d'
name|'in'
name|'deny'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'='
name|'s'
op|'+'
string|'"d %s\\n"'
op|'%'
name|'d'
newline|'\n'
comment|'#s="{\\n"+s+"\\n}"'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_set_config %s"'
op|'%'
name|'quote'
op|'('
name|'s'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|add_buddy
dedent|''
name|'def'
name|'add_buddy'
op|'('
name|'self'
op|','
name|'buddies'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'s'
op|'='
string|'""'
newline|'\n'
name|'if'
name|'type'
op|'('
name|'buddies'
op|')'
op|'=='
name|'type'
op|'('
string|'""'
op|')'
op|':'
name|'buddies'
op|'='
op|'['
name|'buddies'
op|']'
newline|'\n'
name|'for'
name|'b'
name|'in'
name|'buddies'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'='
name|'s'
op|'+'
string|'" "'
op|'+'
name|'normalize'
op|'('
name|'b'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_add_buddy%s"'
op|'%'
name|'s'
op|')'
newline|'\n'
nl|'\n'
DECL|member|del_buddy
dedent|''
name|'def'
name|'del_buddy'
op|'('
name|'self'
op|','
name|'buddies'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'s'
op|'='
string|'""'
newline|'\n'
name|'if'
name|'type'
op|'('
name|'buddies'
op|')'
op|'=='
name|'type'
op|'('
string|'""'
op|')'
op|':'
name|'buddies'
op|'='
op|'['
name|'buddies'
op|']'
newline|'\n'
name|'for'
name|'b'
name|'in'
name|'buddies'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'='
name|'s'
op|'+'
string|'" "'
op|'+'
name|'b'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_remove_buddy%s"'
op|'%'
name|'s'
op|')'
newline|'\n'
nl|'\n'
DECL|member|add_permit
dedent|''
name|'def'
name|'add_permit'
op|'('
name|'self'
op|','
name|'users'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'type'
op|'('
name|'users'
op|')'
op|'=='
name|'type'
op|'('
string|'""'
op|')'
op|':'
name|'users'
op|'='
op|'['
name|'users'
op|']'
newline|'\n'
name|'s'
op|'='
string|'""'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_privacymode'
op|'!='
name|'PERMITSOME'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_privacymode'
op|'='
name|'PERMITSOME'
newline|'\n'
name|'self'
op|'.'
name|'_permitlist'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'for'
name|'u'
name|'in'
name|'users'
op|':'
newline|'\n'
indent|'            '
name|'u'
op|'='
name|'normalize'
op|'('
name|'u'
op|')'
newline|'\n'
name|'if'
name|'u'
name|'not'
name|'in'
name|'self'
op|'.'
name|'_permitlist'
op|':'
name|'self'
op|'.'
name|'_permitlist'
op|'.'
name|'append'
op|'('
name|'u'
op|')'
newline|'\n'
name|'s'
op|'='
name|'s'
op|'+'
string|'" "'
op|'+'
name|'u'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'s'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_privacymode'
op|'='
name|'DENYALL'
newline|'\n'
name|'self'
op|'.'
name|'_permitlist'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_denylist'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_add_permit"'
op|'+'
name|'s'
op|')'
newline|'\n'
nl|'\n'
DECL|member|del_permit
dedent|''
name|'def'
name|'del_permit'
op|'('
name|'self'
op|','
name|'users'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'type'
op|'('
name|'users'
op|')'
op|'=='
name|'type'
op|'('
string|'""'
op|')'
op|':'
name|'users'
op|'='
op|'['
name|'users'
op|']'
newline|'\n'
name|'p'
op|'='
name|'self'
op|'.'
name|'_permitlist'
op|'['
op|':'
op|']'
newline|'\n'
name|'for'
name|'u'
name|'in'
name|'users'
op|':'
newline|'\n'
indent|'            '
name|'u'
op|'='
name|'normalize'
op|'('
name|'u'
op|')'
newline|'\n'
name|'if'
name|'u'
name|'in'
name|'p'
op|':'
newline|'\n'
indent|'                '
name|'p'
op|'.'
name|'remove'
op|'('
name|'u'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'add_permit'
op|'('
op|'['
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'add_permit'
op|'('
name|'p'
op|')'
newline|'\n'
nl|'\n'
DECL|member|add_deny
dedent|''
name|'def'
name|'add_deny'
op|'('
name|'self'
op|','
name|'users'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'type'
op|'('
name|'users'
op|')'
op|'=='
name|'type'
op|'('
string|'""'
op|')'
op|':'
name|'users'
op|'='
op|'['
name|'users'
op|']'
newline|'\n'
name|'s'
op|'='
string|'""'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_privacymode'
op|'!='
name|'DENYSOME'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_privacymode'
op|'='
name|'DENYSOME'
newline|'\n'
name|'self'
op|'.'
name|'_denylist'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'for'
name|'u'
name|'in'
name|'users'
op|':'
newline|'\n'
indent|'            '
name|'u'
op|'='
name|'normalize'
op|'('
name|'u'
op|')'
newline|'\n'
name|'if'
name|'u'
name|'not'
name|'in'
name|'self'
op|'.'
name|'_denylist'
op|':'
name|'self'
op|'.'
name|'_denylist'
op|'.'
name|'append'
op|'('
name|'u'
op|')'
newline|'\n'
name|'s'
op|'='
name|'s'
op|'+'
string|'" "'
op|'+'
name|'u'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'s'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_privacymode'
op|'='
name|'PERMITALL'
newline|'\n'
name|'self'
op|'.'
name|'_permitlist'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_denylist'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_add_deny"'
op|'+'
name|'s'
op|')'
newline|'\n'
nl|'\n'
DECL|member|del_deny
dedent|''
name|'def'
name|'del_deny'
op|'('
name|'self'
op|','
name|'users'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'type'
op|'('
name|'users'
op|')'
op|'=='
name|'type'
op|'('
string|'""'
op|')'
op|':'
name|'users'
op|'='
op|'['
name|'users'
op|']'
newline|'\n'
name|'d'
op|'='
name|'self'
op|'.'
name|'_denylist'
op|'['
op|':'
op|']'
newline|'\n'
name|'for'
name|'u'
name|'in'
name|'users'
op|':'
newline|'\n'
indent|'            '
name|'u'
op|'='
name|'normalize'
op|'('
name|'u'
op|')'
newline|'\n'
name|'if'
name|'u'
name|'in'
name|'d'
op|':'
newline|'\n'
indent|'                '
name|'d'
op|'.'
name|'remove'
op|'('
name|'u'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'add_deny'
op|'('
op|'['
op|']'
op|')'
newline|'\n'
name|'if'
name|'d'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'add_deny'
op|'('
name|'d'
op|')'
newline|'\n'
nl|'\n'
DECL|member|signon
dedent|''
dedent|''
name|'def'
name|'signon'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called to finish the setup, and signon to the network\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_init_done"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_set_caps %s"'
op|'%'
op|'('
name|'SEND_FILE_UID'
op|','
op|')'
op|')'
comment|'# GET_FILE_UID)'
newline|'\n'
nl|'\n'
DECL|member|say
dedent|''
name|'def'
name|'say'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'message'
op|','
name|'autoreply'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        send a message\n        user := the user to send to\n        message := the message\n        autoreply := true if the message is an autoreply (good for away messages)\n        """'
newline|'\n'
name|'if'
name|'autoreply'
op|':'
name|'a'
op|'='
string|'" auto"'
newline|'\n'
name|'else'
op|':'
name|'a'
op|'='
string|"''"
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_send_im %s %s%s"'
op|'%'
op|'('
name|'normalize'
op|'('
name|'user'
op|')'
op|','
name|'quote'
op|'('
name|'message'
op|')'
op|','
name|'a'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|idle
dedent|''
name|'def'
name|'idle'
op|'('
name|'self'
op|','
name|'idletime'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        change idle state\n        idletime := the seconds that the user has been away, or 0 if they\'re back\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_set_idle %s"'
op|'%'
name|'int'
op|'('
name|'idletime'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|evil
dedent|''
name|'def'
name|'evil'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'anon'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        warn a user\n        user := the user to warn\n        anon := if true, an anonymous warning\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_evil %s %s"'
op|'%'
op|'('
name|'normalize'
op|'('
name|'user'
op|')'
op|','
op|'('
name|'not'
name|'anon'
name|'and'
string|'"anon"'
op|')'
name|'or'
string|'"norm"'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|away
dedent|''
name|'def'
name|'away'
op|'('
name|'self'
op|','
name|'message'
op|'='
string|"''"
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        change away state\n        message := the message, or \'\' to come back from awayness\n        """'
newline|'\n'
name|'self'
op|'.'
name|'_awaymessage'
op|'='
name|'message'
newline|'\n'
name|'if'
name|'message'
op|':'
newline|'\n'
indent|'            '
name|'message'
op|'='
string|"' '"
op|'+'
name|'quote'
op|'('
name|'message'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_set_away%s"'
op|'%'
name|'message'
op|')'
newline|'\n'
nl|'\n'
DECL|member|chat_join
dedent|''
name|'def'
name|'chat_join'
op|'('
name|'self'
op|','
name|'exchange'
op|','
name|'roomname'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        join a chat room\n        exchange := should almost always be 4\n        roomname := room name\n        """'
newline|'\n'
name|'roomname'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'roomname'
op|','
string|'" "'
op|','
string|'""'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_chat_join %s %s"'
op|'%'
op|'('
name|'int'
op|'('
name|'exchange'
op|')'
op|','
name|'roomname'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|chat_say
dedent|''
name|'def'
name|'chat_say'
op|'('
name|'self'
op|','
name|'roomid'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        send a message to a chatroom\n        roomid := the AIM id for the room\n        message := the message to send\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_chat_send %s %s"'
op|'%'
op|'('
name|'int'
op|'('
name|'roomid'
op|')'
op|','
name|'quote'
op|'('
name|'message'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|chat_whisper
dedent|''
name|'def'
name|'chat_whisper'
op|'('
name|'self'
op|','
name|'roomid'
op|','
name|'user'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        whisper to another user in a chatroom\n        roomid := the AIM id for the room\n        user := the user to whisper to\n        message := the message to send\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_chat_whisper %s %s %s"'
op|'%'
op|'('
name|'int'
op|'('
name|'roomid'
op|')'
op|','
name|'normalize'
op|'('
name|'user'
op|')'
op|','
name|'quote'
op|'('
name|'message'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|chat_leave
dedent|''
name|'def'
name|'chat_leave'
op|'('
name|'self'
op|','
name|'roomid'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        leave a chat room.\n        roomid := the AIM id for the room\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_chat_leave %s"'
op|'%'
name|'int'
op|'('
name|'roomid'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|chat_invite
dedent|''
name|'def'
name|'chat_invite'
op|'('
name|'self'
op|','
name|'roomid'
op|','
name|'usernames'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        invite a user[s] to the chat room\n        roomid := the AIM id for the room\n        usernames := either a string (one username) or a list (more than one)\n        message := the message to invite them with\n        """'
newline|'\n'
name|'if'
name|'type'
op|'('
name|'usernames'
op|')'
op|'=='
name|'type'
op|'('
string|'""'
op|')'
op|':'
comment|'# a string, one username'
newline|'\n'
indent|'            '
name|'users'
op|'='
name|'usernames'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'users'
op|'='
string|'""'
newline|'\n'
name|'for'
name|'u'
name|'in'
name|'usernames'
op|':'
newline|'\n'
indent|'                '
name|'users'
op|'='
name|'users'
op|'+'
name|'u'
op|'+'
string|'" "'
newline|'\n'
dedent|''
name|'users'
op|'='
name|'users'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_chat_invite %s %s %s"'
op|'%'
op|'('
name|'int'
op|'('
name|'roomid'
op|')'
op|','
name|'quote'
op|'('
name|'message'
op|')'
op|','
name|'users'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|chat_accept
dedent|''
name|'def'
name|'chat_accept'
op|'('
name|'self'
op|','
name|'roomid'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        accept an invite to a chat room\n        roomid := the AIM id for the room\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_chat_accept %s"'
op|'%'
name|'int'
op|'('
name|'roomid'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|rvous_accept
dedent|''
name|'def'
name|'rvous_accept'
op|'('
name|'self'
op|','
name|'cookie'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|','
name|'uuid'
op|','
name|'pip'
op|','
name|'port'
op|','
name|'d'
op|'='
name|'self'
op|'.'
name|'_cookies'
op|'['
name|'cookie'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_rvous_accept %s %s %s"'
op|'%'
op|'('
name|'normalize'
op|'('
name|'user'
op|')'
op|','
nl|'\n'
name|'cookie'
op|','
name|'uuid'
op|')'
op|')'
newline|'\n'
name|'if'
name|'uuid'
op|'=='
name|'SEND_FILE_UID'
op|':'
newline|'\n'
indent|'            '
name|'protocol'
op|'.'
name|'ClientCreator'
op|'('
name|'reactor'
op|','
name|'SendFileTransfer'
op|','
name|'self'
op|','
name|'cookie'
op|','
name|'user'
op|','
name|'d'
op|'['
string|'"name"'
op|']'
op|')'
op|'.'
name|'connectTCP'
op|'('
name|'pip'
op|','
name|'port'
op|')'
newline|'\n'
nl|'\n'
DECL|member|rvous_cancel
dedent|''
dedent|''
name|'def'
name|'rvous_cancel'
op|'('
name|'self'
op|','
name|'cookie'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|','
name|'uuid'
op|','
name|'pip'
op|','
name|'port'
op|','
name|'d'
op|'='
name|'self'
op|'.'
name|'_cookies'
op|'['
name|'cookie'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'sendFlap'
op|'('
number|'2'
op|','
string|'"toc_rvous_accept %s %s %s"'
op|'%'
op|'('
name|'normalize'
op|'('
name|'user'
op|')'
op|','
nl|'\n'
name|'cookie'
op|','
name|'uuid'
op|')'
op|')'
newline|'\n'
name|'del'
name|'self'
op|'.'
name|'_cookies'
op|'['
name|'cookie'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SendFileTransfer
dedent|''
dedent|''
name|'class'
name|'SendFileTransfer'
op|'('
name|'protocol'
op|'.'
name|'Protocol'
op|')'
op|':'
newline|'\n'
DECL|variable|header_fmt
indent|'    '
name|'header_fmt'
op|'='
string|'"!4s2H8s6H10I32s3c69s16s2H64s"'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'client'
op|','
name|'cookie'
op|','
name|'user'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'client'
op|'='
name|'client'
newline|'\n'
name|'self'
op|'.'
name|'cookie'
op|'='
name|'cookie'
newline|'\n'
name|'self'
op|'.'
name|'user'
op|'='
name|'user'
newline|'\n'
name|'self'
op|'.'
name|'filename'
op|'='
name|'filename'
newline|'\n'
name|'self'
op|'.'
name|'hdr'
op|'='
op|'['
number|'0'
op|','
number|'0'
op|','
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'sofar'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|dataReceived
dedent|''
name|'def'
name|'dataReceived'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'hdr'
op|'['
number|'2'
op|']'
op|'=='
number|'0x202'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'hdr'
op|'='
name|'list'
op|'('
name|'struct'
op|'.'
name|'unpack'
op|'('
name|'self'
op|'.'
name|'header_fmt'
op|','
name|'data'
op|'['
op|':'
number|'256'
op|']'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'hdr'
op|'['
number|'2'
op|']'
op|'='
number|'0x202'
newline|'\n'
name|'self'
op|'.'
name|'hdr'
op|'['
number|'3'
op|']'
op|'='
name|'self'
op|'.'
name|'cookie'
newline|'\n'
name|'self'
op|'.'
name|'hdr'
op|'['
number|'4'
op|']'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'hdr'
op|'['
number|'5'
op|']'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'write'
op|'('
name|'apply'
op|'('
name|'struct'
op|'.'
name|'pack'
op|','
op|'['
name|'self'
op|'.'
name|'header_fmt'
op|']'
op|'+'
name|'self'
op|'.'
name|'hdr'
op|')'
op|')'
newline|'\n'
name|'data'
op|'='
name|'data'
op|'['
number|'256'
op|':'
op|']'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'hdr'
op|'['
number|'6'
op|']'
op|'=='
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'name'
op|'='
name|'self'
op|'.'
name|'filename'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'name'
op|'='
name|'self'
op|'.'
name|'filename'
op|'+'
name|'self'
op|'.'
name|'hdr'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'while'
name|'self'
op|'.'
name|'name'
op|'['
op|'-'
number|'1'
op|']'
op|'=='
string|'"\\000"'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'name'
op|'='
name|'self'
op|'.'
name|'name'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'not'
name|'data'
op|':'
name|'return'
newline|'\n'
name|'self'
op|'.'
name|'sofar'
op|'='
name|'self'
op|'.'
name|'sofar'
op|'+'
name|'len'
op|'('
name|'data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'receiveBytes'
op|'('
name|'self'
op|'.'
name|'user'
op|','
name|'self'
op|'.'
name|'name'
op|','
name|'data'
op|','
name|'self'
op|'.'
name|'sofar'
op|','
name|'self'
op|'.'
name|'hdr'
op|'['
number|'11'
op|']'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'sofar'
op|'=='
name|'self'
op|'.'
name|'hdr'
op|'['
number|'11'
op|']'
op|':'
comment|'# end of this file'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'hdr'
op|'['
number|'2'
op|']'
op|'='
number|'0x204'
newline|'\n'
name|'self'
op|'.'
name|'hdr'
op|'['
number|'7'
op|']'
op|'='
name|'self'
op|'.'
name|'hdr'
op|'['
number|'7'
op|']'
op|'-'
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'hdr'
op|'['
number|'9'
op|']'
op|'='
name|'self'
op|'.'
name|'hdr'
op|'['
number|'9'
op|']'
op|'-'
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'hdr'
op|'['
number|'19'
op|']'
op|'='
name|'DUMMY_CHECKSUM'
comment|'# XXX really calculate this'
newline|'\n'
name|'self'
op|'.'
name|'hdr'
op|'['
number|'18'
op|']'
op|'='
name|'self'
op|'.'
name|'hdr'
op|'['
number|'18'
op|']'
op|'+'
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'hdr'
op|'['
number|'21'
op|']'
op|'='
string|'"\\000"'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'write'
op|'('
name|'apply'
op|'('
name|'struct'
op|'.'
name|'pack'
op|','
op|'['
name|'self'
op|'.'
name|'header_fmt'
op|']'
op|'+'
name|'self'
op|'.'
name|'hdr'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sofar'
op|'='
number|'0'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'hdr'
op|'['
number|'7'
op|']'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'transport'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|GetFileTransfer
dedent|''
dedent|''
dedent|''
dedent|''
name|'class'
name|'GetFileTransfer'
op|'('
name|'protocol'
op|'.'
name|'Protocol'
op|')'
op|':'
newline|'\n'
DECL|variable|header_fmt
indent|'    '
name|'header_fmt'
op|'='
string|'"!4s 2H 8s 6H 10I 32s 3c 69s 16s 2H 64s"'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'client'
op|','
name|'cookie'
op|','
name|'dir'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'client'
op|'='
name|'client'
newline|'\n'
name|'self'
op|'.'
name|'cookie'
op|'='
name|'cookie'
newline|'\n'
name|'self'
op|'.'
name|'dir'
op|'='
name|'dir'
newline|'\n'
name|'self'
op|'.'
name|'buf'
op|'='
string|'""'
newline|'\n'
nl|'\n'
DECL|member|connectionMade
dedent|''
name|'def'
name|'connectionMade'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|func
indent|'        '
name|'def'
name|'func'
op|'('
name|'f'
op|','
name|'path'
op|','
name|'names'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'names'
op|'.'
name|'sort'
op|'('
name|'lambda'
name|'x'
op|','
name|'y'
op|':'
name|'cmp'
op|'('
name|'string'
op|'.'
name|'lower'
op|'('
name|'x'
op|')'
op|','
name|'string'
op|'.'
name|'lower'
op|'('
name|'y'
op|')'
op|')'
op|')'
newline|'\n'
name|'for'
name|'n'
name|'in'
name|'names'
op|':'
newline|'\n'
indent|'                '
name|'name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'path'
op|','
name|'n'
op|')'
newline|'\n'
name|'lt'
op|'='
name|'time'
op|'.'
name|'localtime'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'getmtime'
op|'('
name|'name'
op|')'
op|')'
newline|'\n'
name|'size'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'getsize'
op|'('
name|'name'
op|')'
newline|'\n'
name|'f'
op|'['
number|'1'
op|']'
op|'='
name|'f'
op|'['
number|'1'
op|']'
op|'+'
name|'size'
newline|'\n'
name|'f'
op|'.'
name|'append'
op|'('
string|'"%02d/%02d/%4d %02d:%02d %8d %s"'
op|'%'
nl|'\n'
op|'('
name|'lt'
op|'['
number|'1'
op|']'
op|','
name|'lt'
op|'['
number|'2'
op|']'
op|','
name|'lt'
op|'['
number|'0'
op|']'
op|','
name|'lt'
op|'['
number|'3'
op|']'
op|','
name|'lt'
op|'['
number|'4'
op|']'
op|','
name|'size'
op|','
name|'name'
op|'['
name|'f'
op|'['
number|'0'
op|']'
op|':'
op|']'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'f'
op|'='
op|'['
name|'len'
op|'('
name|'self'
op|'.'
name|'dir'
op|')'
op|'+'
number|'1'
op|','
number|'0'
op|']'
newline|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'walk'
op|'('
name|'self'
op|'.'
name|'dir'
op|','
name|'func'
op|','
name|'f'
op|')'
newline|'\n'
name|'size'
op|'='
name|'f'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'listing'
op|'='
name|'string'
op|'.'
name|'join'
op|'('
name|'f'
op|'['
number|'2'
op|':'
op|']'
op|','
string|'"\\r\\n"'
op|')'
op|'+'
string|'"\\r\\n"'
newline|'\n'
name|'open'
op|'('
string|'"\\\\listing.txt"'
op|','
string|'"w"'
op|')'
op|'.'
name|'write'
op|'('
name|'self'
op|'.'
name|'listing'
op|')'
newline|'\n'
name|'hdr'
op|'='
op|'['
string|'"OFT2"'
op|','
number|'256'
op|','
number|'0x1108'
op|','
name|'self'
op|'.'
name|'cookie'
op|','
number|'0'
op|','
number|'0'
op|','
name|'len'
op|'('
name|'f'
op|')'
op|'-'
number|'2'
op|','
name|'len'
op|'('
name|'f'
op|')'
op|'-'
number|'2'
op|','
number|'1'
op|','
number|'1'
op|','
name|'size'
op|','
nl|'\n'
name|'len'
op|'('
name|'self'
op|'.'
name|'listing'
op|')'
op|','
name|'os'
op|'.'
name|'path'
op|'.'
name|'getmtime'
op|'('
name|'self'
op|'.'
name|'dir'
op|')'
op|','
nl|'\n'
name|'checksum'
op|'('
name|'self'
op|'.'
name|'listing'
op|')'
op|','
number|'0'
op|','
number|'0'
op|','
number|'0'
op|','
number|'0'
op|','
number|'0'
op|','
number|'0'
op|','
string|'"OFT_Windows ICBMFT V1.1 32"'
op|','
nl|'\n'
string|'"\\002"'
op|','
name|'chr'
op|'('
number|'0x1a'
op|')'
op|','
name|'chr'
op|'('
number|'0x10'
op|')'
op|','
string|'""'
op|','
string|'""'
op|','
number|'0'
op|','
number|'0'
op|','
string|'""'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'write'
op|'('
name|'apply'
op|'('
name|'struct'
op|'.'
name|'pack'
op|','
op|'['
name|'self'
op|'.'
name|'header_fmt'
op|']'
op|'+'
name|'hdr'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|dataReceived
dedent|''
name|'def'
name|'dataReceived'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'buf'
op|'='
name|'self'
op|'.'
name|'buf'
op|'+'
name|'data'
newline|'\n'
name|'while'
name|'len'
op|'('
name|'self'
op|'.'
name|'buf'
op|')'
op|'>='
number|'256'
op|':'
newline|'\n'
indent|'            '
name|'hdr'
op|'='
name|'list'
op|'('
name|'struct'
op|'.'
name|'unpack'
op|'('
name|'self'
op|'.'
name|'header_fmt'
op|','
name|'self'
op|'.'
name|'buf'
op|'['
op|':'
number|'256'
op|']'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'buf'
op|'='
name|'self'
op|'.'
name|'buf'
op|'['
number|'256'
op|':'
op|']'
newline|'\n'
name|'if'
name|'hdr'
op|'['
number|'2'
op|']'
op|'=='
number|'0x1209'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'file'
op|'='
name|'StringIO'
op|'.'
name|'StringIO'
op|'('
name|'self'
op|'.'
name|'listing'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'registerProducer'
op|'('
name|'self'
op|','
number|'0'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'hdr'
op|'['
number|'2'
op|']'
op|'=='
number|'0x120b'
op|':'
name|'pass'
newline|'\n'
name|'elif'
name|'hdr'
op|'['
number|'2'
op|']'
op|'=='
number|'0x120c'
op|':'
comment|'# file request'
newline|'\n'
indent|'                '
name|'file'
op|'='
name|'hdr'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
op|'['
op|'['
string|'"\\000"'
op|','
string|'""'
op|']'
op|','
op|'['
string|'"\\001"'
op|','
name|'os'
op|'.'
name|'sep'
op|']'
op|']'
op|':'
newline|'\n'
indent|'                    '
name|'file'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'file'
op|','
name|'k'
op|','
name|'v'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'dir'
op|','
name|'file'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'file'
op|'='
name|'open'
op|'('
name|'self'
op|'.'
name|'name'
op|','
string|"'rb'"
op|')'
newline|'\n'
name|'hdr'
op|'['
number|'2'
op|']'
op|'='
number|'0x0101'
newline|'\n'
name|'hdr'
op|'['
number|'6'
op|']'
op|'='
name|'hdr'
op|'['
number|'7'
op|']'
op|'='
number|'1'
newline|'\n'
name|'hdr'
op|'['
number|'10'
op|']'
op|'='
name|'hdr'
op|'['
number|'11'
op|']'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'getsize'
op|'('
name|'self'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'hdr'
op|'['
number|'12'
op|']'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'getmtime'
op|'('
name|'self'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'hdr'
op|'['
number|'13'
op|']'
op|'='
name|'checksum_file'
op|'('
name|'self'
op|'.'
name|'file'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'file'
op|'.'
name|'seek'
op|'('
number|'0'
op|')'
newline|'\n'
name|'hdr'
op|'['
number|'18'
op|']'
op|'='
name|'hdr'
op|'['
number|'19'
op|']'
op|'='
number|'0'
newline|'\n'
name|'hdr'
op|'['
number|'21'
op|']'
op|'='
name|'chr'
op|'('
number|'0x20'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'write'
op|'('
name|'apply'
op|'('
name|'struct'
op|'.'
name|'pack'
op|','
op|'['
name|'self'
op|'.'
name|'header_fmt'
op|']'
op|'+'
name|'hdr'
op|')'
op|')'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
string|'"got file request for %s"'
op|'%'
name|'file'
op|','
name|'hex'
op|'('
name|'hdr'
op|'['
number|'13'
op|']'
op|')'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'hdr'
op|'['
number|'2'
op|']'
op|'=='
number|'0x0202'
op|':'
newline|'\n'
indent|'                '
name|'log'
op|'.'
name|'msg'
op|'('
string|'"sending file"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'registerProducer'
op|'('
name|'self'
op|','
number|'0'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'hdr'
op|'['
number|'2'
op|']'
op|'=='
number|'0x0204'
op|':'
newline|'\n'
indent|'                '
name|'log'
op|'.'
name|'msg'
op|'('
string|'"real checksum: %s"'
op|'%'
name|'hex'
op|'('
name|'hdr'
op|'['
number|'19'
op|']'
op|')'
op|')'
newline|'\n'
name|'del'
name|'self'
op|'.'
name|'file'
newline|'\n'
dedent|''
name|'elif'
name|'hdr'
op|'['
number|'2'
op|']'
op|'=='
number|'0x0205'
op|':'
comment|'# resume'
newline|'\n'
indent|'                '
name|'already'
op|'='
name|'hdr'
op|'['
number|'18'
op|']'
newline|'\n'
name|'if'
name|'already'
op|':'
newline|'\n'
indent|'                    '
name|'data'
op|'='
name|'self'
op|'.'
name|'file'
op|'.'
name|'read'
op|'('
name|'already'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'data'
op|'='
string|'""'
newline|'\n'
dedent|''
name|'log'
op|'.'
name|'msg'
op|'('
string|'"restarting at %s"'
op|'%'
name|'already'
op|')'
newline|'\n'
name|'hdr'
op|'['
number|'2'
op|']'
op|'='
number|'0x0106'
newline|'\n'
name|'hdr'
op|'['
number|'19'
op|']'
op|'='
name|'checksum'
op|'('
name|'data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'write'
op|'('
name|'apply'
op|'('
name|'struct'
op|'.'
name|'pack'
op|','
op|'['
name|'self'
op|'.'
name|'header_fmt'
op|']'
op|'+'
name|'hdr'
op|')'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'hdr'
op|'['
number|'2'
op|']'
op|'=='
number|'0x0207'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'transport'
op|'.'
name|'registerProducer'
op|'('
name|'self'
op|','
number|'0'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'log'
op|'.'
name|'msg'
op|'('
string|'"don\'t understand 0x%04x"'
op|'%'
name|'hdr'
op|'['
number|'2'
op|']'
op|')'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
name|'hdr'
op|')'
newline|'\n'
nl|'\n'
DECL|member|resumeProducing
dedent|''
dedent|''
dedent|''
name|'def'
name|'resumeProducing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'data'
op|'='
name|'self'
op|'.'
name|'file'
op|'.'
name|'read'
op|'('
number|'4096'
op|')'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
name|'len'
op|'('
name|'data'
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'data'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'transport'
op|'.'
name|'unregisterProducer'
op|'('
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'transport'
op|'.'
name|'write'
op|'('
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|pauseProducing
dedent|''
name|'def'
name|'pauseProducing'
op|'('
name|'self'
op|')'
op|':'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|stopProducing
name|'def'
name|'stopProducing'
op|'('
name|'self'
op|')'
op|':'
name|'del'
name|'self'
op|'.'
name|'file'
newline|'\n'
nl|'\n'
comment|'# UUIDs'
nl|'\n'
DECL|variable|SEND_FILE_UID
dedent|''
name|'SEND_FILE_UID'
op|'='
string|'"09461343-4C7F-11D1-8222-444553540000"'
newline|'\n'
DECL|variable|GET_FILE_UID
name|'GET_FILE_UID'
op|'='
string|'"09461348-4C7F-11D1-8222-444553540000"'
newline|'\n'
DECL|variable|UUIDS
name|'UUIDS'
op|'='
op|'{'
nl|'\n'
name|'SEND_FILE_UID'
op|':'
string|'"SEND_FILE"'
op|','
nl|'\n'
name|'GET_FILE_UID'
op|':'
string|'"GET_FILE"'
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
comment|'# ERRORS'
nl|'\n'
comment|'# general'
nl|'\n'
DECL|variable|NOT_AVAILABLE
name|'NOT_AVAILABLE'
op|'='
number|'901'
newline|'\n'
DECL|variable|CANT_WARN
name|'CANT_WARN'
op|'='
number|'902'
newline|'\n'
DECL|variable|MESSAGES_TOO_FAST
name|'MESSAGES_TOO_FAST'
op|'='
number|'903'
newline|'\n'
comment|'# admin'
nl|'\n'
DECL|variable|BAD_INPUT
name|'BAD_INPUT'
op|'='
number|'911'
newline|'\n'
DECL|variable|BAD_ACCOUNT
name|'BAD_ACCOUNT'
op|'='
number|'912'
newline|'\n'
DECL|variable|REQUEST_ERROR
name|'REQUEST_ERROR'
op|'='
number|'913'
newline|'\n'
DECL|variable|SERVICE_UNAVAILABLE
name|'SERVICE_UNAVAILABLE'
op|'='
number|'914'
newline|'\n'
comment|'# chat'
nl|'\n'
DECL|variable|NO_CHAT_IN
name|'NO_CHAT_IN'
op|'='
number|'950'
newline|'\n'
comment|'# im and info'
nl|'\n'
DECL|variable|SEND_TOO_FAST
name|'SEND_TOO_FAST'
op|'='
number|'960'
newline|'\n'
DECL|variable|MISSED_BIG_IM
name|'MISSED_BIG_IM'
op|'='
number|'961'
newline|'\n'
DECL|variable|MISSED_FAST_IM
name|'MISSED_FAST_IM'
op|'='
number|'962'
newline|'\n'
comment|'# directory'
nl|'\n'
DECL|variable|DIR_FAILURE
name|'DIR_FAILURE'
op|'='
number|'970'
newline|'\n'
DECL|variable|TOO_MANY_MATCHES
name|'TOO_MANY_MATCHES'
op|'='
number|'971'
newline|'\n'
DECL|variable|NEED_MORE_QUALIFIERS
name|'NEED_MORE_QUALIFIERS'
op|'='
number|'972'
newline|'\n'
DECL|variable|DIR_UNAVAILABLE
name|'DIR_UNAVAILABLE'
op|'='
number|'973'
newline|'\n'
DECL|variable|NO_EMAIL_LOOKUP
name|'NO_EMAIL_LOOKUP'
op|'='
number|'974'
newline|'\n'
DECL|variable|KEYWORD_IGNORED
name|'KEYWORD_IGNORED'
op|'='
number|'975'
newline|'\n'
DECL|variable|NO_KEYWORDS
name|'NO_KEYWORDS'
op|'='
number|'976'
newline|'\n'
DECL|variable|BAD_LANGUAGE
name|'BAD_LANGUAGE'
op|'='
number|'977'
newline|'\n'
DECL|variable|BAD_COUNTRY
name|'BAD_COUNTRY'
op|'='
number|'978'
newline|'\n'
DECL|variable|DIR_FAIL_UNKNOWN
name|'DIR_FAIL_UNKNOWN'
op|'='
number|'979'
newline|'\n'
comment|'# authorization'
nl|'\n'
DECL|variable|BAD_NICKNAME
name|'BAD_NICKNAME'
op|'='
number|'980'
newline|'\n'
DECL|variable|SERVICE_TEMP_UNAVAILABLE
name|'SERVICE_TEMP_UNAVAILABLE'
op|'='
number|'981'
newline|'\n'
DECL|variable|WARNING_TOO_HIGH
name|'WARNING_TOO_HIGH'
op|'='
number|'982'
newline|'\n'
DECL|variable|CONNECTING_TOO_QUICK
name|'CONNECTING_TOO_QUICK'
op|'='
number|'983'
newline|'\n'
DECL|variable|UNKNOWN_SIGNON
name|'UNKNOWN_SIGNON'
op|'='
number|'989'
newline|'\n'
nl|'\n'
DECL|variable|STD_MESSAGE
name|'STD_MESSAGE'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'NOT_AVAILABLE'
op|']'
op|'='
string|'"%s not currently available"'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'CANT_WARN'
op|']'
op|'='
string|'"Warning of %s not currently available"'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'MESSAGES_TOO_FAST'
op|']'
op|'='
string|'"A message has been dropped, you are exceeding the server speed limit"'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'BAD_INPUT'
op|']'
op|'='
string|'"Error validating input"'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'BAD_ACCOUNT'
op|']'
op|'='
string|'"Invalid account"'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'REQUEST_ERROR'
op|']'
op|'='
string|'"Error encountered while processing request"'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'SERVICE_UNAVAILABLE'
op|']'
op|'='
string|'"Service unavailable"'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'NO_CHAT_IN'
op|']'
op|'='
string|'"Chat in %s is unavailable"'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'SEND_TOO_FAST'
op|']'
op|'='
string|'"You are sending messages too fast to %s"'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'MISSED_BIG_IM'
op|']'
op|'='
string|'"You missed an IM from %s because it was too big"'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'MISSED_FAST_IM'
op|']'
op|'='
string|'"You missed an IM from %s because it was sent too fast"'
newline|'\n'
comment|'# skipping directory for now'
nl|'\n'
name|'STD_MESSAGE'
op|'['
name|'BAD_NICKNAME'
op|']'
op|'='
string|'"Incorrect nickname or password"'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'SERVICE_TEMP_UNAVAILABLE'
op|']'
op|'='
string|'"The service is temporarily unavailable"'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'WARNING_TOO_HIGH'
op|']'
op|'='
string|'"Your warning level is currently too high to sign on"'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'CONNECTING_TOO_QUICK'
op|']'
op|'='
string|'"You have been connecting and disconnecting too frequently.  Wait 10 minutes and try again.  If you continue to try, you will need to wait even longer."'
newline|'\n'
name|'STD_MESSAGE'
op|'['
name|'UNKNOWN_SIGNON'
op|']'
op|'='
string|'"An unknown signon error has occurred %s"'
newline|'\n'
endmarker|''
end_unit
