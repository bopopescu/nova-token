begin_unit
comment|'# -*- test-case-name: twisted.words.test -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2008 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
string|'"""\nAn implementation of the OSCAR protocol, which AIM and ICQ use to communcate.\n\nMaintainer: Paul Swartz\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'struct'
newline|'\n'
name|'import'
name|'string'
newline|'\n'
name|'import'
name|'socket'
newline|'\n'
name|'import'
name|'random'
newline|'\n'
name|'import'
name|'types'
newline|'\n'
name|'import'
name|'re'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
op|','
name|'defer'
op|','
name|'protocol'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'log'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
op|'.'
name|'hashlib'
name|'import'
name|'md5'
newline|'\n'
nl|'\n'
DECL|function|logPacketData
name|'def'
name|'logPacketData'
op|'('
name|'data'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'lines'
op|'='
name|'len'
op|'('
name|'data'
op|')'
op|'/'
number|'16'
newline|'\n'
name|'if'
name|'lines'
op|'*'
number|'16'
op|'!='
name|'len'
op|'('
name|'data'
op|')'
op|':'
name|'lines'
op|'='
name|'lines'
op|'+'
number|'1'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'lines'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'tuple'
op|'('
name|'data'
op|'['
number|'16'
op|'*'
name|'i'
op|':'
number|'16'
op|'*'
name|'i'
op|'+'
number|'16'
op|']'
op|')'
newline|'\n'
name|'hex'
op|'='
name|'map'
op|'('
name|'lambda'
name|'x'
op|':'
string|'"%02X"'
op|'%'
name|'ord'
op|'('
name|'x'
op|')'
op|','
name|'d'
op|')'
newline|'\n'
name|'text'
op|'='
name|'map'
op|'('
name|'lambda'
name|'x'
op|':'
op|'('
name|'len'
op|'('
name|'repr'
op|'('
name|'x'
op|')'
op|')'
op|'>'
number|'3'
name|'and'
string|"'.'"
op|')'
name|'or'
name|'x'
op|','
name|'d'
op|')'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
string|"' '"
op|'.'
name|'join'
op|'('
name|'hex'
op|')'
op|'+'
string|"' '"
op|'*'
number|'3'
op|'*'
op|'('
number|'16'
op|'-'
name|'len'
op|'('
name|'d'
op|')'
op|')'
op|'+'
string|"''"
op|'.'
name|'join'
op|'('
name|'text'
op|')'
op|')'
newline|'\n'
dedent|''
name|'log'
op|'.'
name|'msg'
op|'('
string|"''"
op|')'
newline|'\n'
nl|'\n'
DECL|function|SNAC
dedent|''
name|'def'
name|'SNAC'
op|'('
name|'fam'
op|','
name|'sub'
op|','
name|'id'
op|','
name|'data'
op|','
name|'flags'
op|'='
op|'['
number|'0'
op|','
number|'0'
op|']'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'header'
op|'='
string|'"!HHBBL"'
newline|'\n'
name|'head'
op|'='
name|'struct'
op|'.'
name|'pack'
op|'('
name|'header'
op|','
name|'fam'
op|','
name|'sub'
op|','
nl|'\n'
name|'flags'
op|'['
number|'0'
op|']'
op|','
name|'flags'
op|'['
number|'1'
op|']'
op|','
nl|'\n'
name|'id'
op|')'
newline|'\n'
name|'return'
name|'head'
op|'+'
name|'str'
op|'('
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|function|readSNAC
dedent|''
name|'def'
name|'readSNAC'
op|'('
name|'data'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'header'
op|'='
string|'"!HHBBL"'
newline|'\n'
name|'head'
op|'='
name|'list'
op|'('
name|'struct'
op|'.'
name|'unpack'
op|'('
name|'header'
op|','
name|'data'
op|'['
op|':'
number|'10'
op|']'
op|')'
op|')'
newline|'\n'
name|'return'
name|'head'
op|'+'
op|'['
name|'data'
op|'['
number|'10'
op|':'
op|']'
op|']'
newline|'\n'
nl|'\n'
DECL|function|TLV
dedent|''
name|'def'
name|'TLV'
op|'('
name|'type'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'header'
op|'='
string|'"!HH"'
newline|'\n'
name|'head'
op|'='
name|'struct'
op|'.'
name|'pack'
op|'('
name|'header'
op|','
name|'type'
op|','
name|'len'
op|'('
name|'value'
op|')'
op|')'
newline|'\n'
name|'return'
name|'head'
op|'+'
name|'str'
op|'('
name|'value'
op|')'
newline|'\n'
nl|'\n'
DECL|function|readTLVs
dedent|''
name|'def'
name|'readTLVs'
op|'('
name|'data'
op|','
name|'count'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'header'
op|'='
string|'"!HH"'
newline|'\n'
name|'dict'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'while'
name|'data'
name|'and'
name|'len'
op|'('
name|'dict'
op|')'
op|'!='
name|'count'
op|':'
newline|'\n'
indent|'        '
name|'head'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
name|'header'
op|','
name|'data'
op|'['
op|':'
number|'4'
op|']'
op|')'
newline|'\n'
name|'dict'
op|'['
name|'head'
op|'['
number|'0'
op|']'
op|']'
op|'='
name|'data'
op|'['
number|'4'
op|':'
number|'4'
op|'+'
name|'head'
op|'['
number|'1'
op|']'
op|']'
newline|'\n'
name|'data'
op|'='
name|'data'
op|'['
number|'4'
op|'+'
name|'head'
op|'['
number|'1'
op|']'
op|':'
op|']'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'count'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'dict'
newline|'\n'
dedent|''
name|'return'
name|'dict'
op|','
name|'data'
newline|'\n'
nl|'\n'
DECL|function|encryptPasswordMD5
dedent|''
name|'def'
name|'encryptPasswordMD5'
op|'('
name|'password'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'m'
op|'='
name|'md5'
op|'('
op|')'
newline|'\n'
name|'m'
op|'.'
name|'update'
op|'('
name|'key'
op|')'
newline|'\n'
name|'m'
op|'.'
name|'update'
op|'('
name|'md5'
op|'('
name|'password'
op|')'
op|'.'
name|'digest'
op|'('
op|')'
op|')'
newline|'\n'
name|'m'
op|'.'
name|'update'
op|'('
string|'"AOL Instant Messenger (SM)"'
op|')'
newline|'\n'
name|'return'
name|'m'
op|'.'
name|'digest'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|encryptPasswordICQ
dedent|''
name|'def'
name|'encryptPasswordICQ'
op|'('
name|'password'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'key'
op|'='
op|'['
number|'0xF3'
op|','
number|'0x26'
op|','
number|'0x81'
op|','
number|'0xC4'
op|','
number|'0x39'
op|','
number|'0x86'
op|','
number|'0xDB'
op|','
number|'0x92'
op|','
number|'0x71'
op|','
number|'0xA3'
op|','
number|'0xB9'
op|','
number|'0xE6'
op|','
number|'0x53'
op|','
number|'0x7A'
op|','
number|'0x95'
op|','
number|'0x7C'
op|']'
newline|'\n'
name|'bytes'
op|'='
name|'map'
op|'('
name|'ord'
op|','
name|'password'
op|')'
newline|'\n'
name|'r'
op|'='
string|'""'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'len'
op|'('
name|'bytes'
op|')'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'r'
op|'='
name|'r'
op|'+'
name|'chr'
op|'('
name|'bytes'
op|'['
name|'i'
op|']'
op|'^'
name|'key'
op|'['
name|'i'
op|'%'
name|'len'
op|'('
name|'key'
op|')'
op|']'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'r'
newline|'\n'
nl|'\n'
DECL|function|dehtml
dedent|''
name|'def'
name|'dehtml'
op|'('
name|'text'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|'"<br>"'
op|','
string|'"\\n"'
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|'"<BR>"'
op|','
string|'"\\n"'
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|'"<Br>"'
op|','
string|'"\\n"'
op|')'
comment|'# XXX make this a regexp'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|'"<bR>"'
op|','
string|'"\\n"'
op|')'
newline|'\n'
name|'text'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"'<.*?>'"
op|','
string|"''"
op|','
name|'text'
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'&gt;'"
op|','
string|"'>'"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'&lt;'"
op|','
string|"'<'"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'&nbsp;'"
op|','
string|"' '"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'&#34;'"
op|','
string|'\'"\''
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'&amp;'"
op|','
string|"'&'"
op|')'
newline|'\n'
name|'return'
name|'text'
newline|'\n'
nl|'\n'
DECL|function|html
dedent|''
name|'def'
name|'html'
op|'('
name|'text'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|'\'"\''
op|','
string|"'&#34;'"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'&'"
op|','
string|"'&amp;'"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'<'"
op|','
string|"'&lt;'"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|"'>'"
op|','
string|"'&gt;'"
op|')'
newline|'\n'
name|'text'
op|'='
name|'string'
op|'.'
name|'replace'
op|'('
name|'text'
op|','
string|'"\\n"'
op|','
string|'"<br>"'
op|')'
newline|'\n'
name|'return'
string|'\'<html><body bgcolor="white"><font color="black">%s</font></body></html>\''
op|'%'
name|'text'
newline|'\n'
nl|'\n'
DECL|class|OSCARUser
dedent|''
name|'class'
name|'OSCARUser'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'warn'
op|','
name|'tlvs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'name'
op|'='
name|'name'
newline|'\n'
name|'self'
op|'.'
name|'warning'
op|'='
name|'warn'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'caps'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'tlvs'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'k'
op|'=='
number|'1'
op|':'
comment|'# user flags'
newline|'\n'
indent|'                '
name|'v'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!H'"
op|','
name|'v'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'for'
name|'o'
op|','
name|'f'
name|'in'
op|'['
op|'('
number|'1'
op|','
string|"'trial'"
op|')'
op|','
nl|'\n'
op|'('
number|'2'
op|','
string|"'unknown bit 2'"
op|')'
op|','
nl|'\n'
op|'('
number|'4'
op|','
string|"'aol'"
op|')'
op|','
nl|'\n'
op|'('
number|'8'
op|','
string|"'unknown bit 4'"
op|')'
op|','
nl|'\n'
op|'('
number|'16'
op|','
string|"'aim'"
op|')'
op|','
nl|'\n'
op|'('
number|'32'
op|','
string|"'away'"
op|')'
op|','
nl|'\n'
op|'('
number|'1024'
op|','
string|"'activebuddy'"
op|')'
op|']'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'v'
op|'&'
name|'o'
op|':'
name|'self'
op|'.'
name|'flags'
op|'.'
name|'append'
op|'('
name|'f'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'k'
op|'=='
number|'2'
op|':'
comment|'# member since date'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'memberSince'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!L'"
op|','
name|'v'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'3'
op|':'
comment|'# on-since'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'onSince'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!L'"
op|','
name|'v'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'4'
op|':'
comment|'# idle time'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'idleTime'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!H'"
op|','
name|'v'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'5'
op|':'
comment|'# unknown'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'6'
op|':'
comment|'# icq online status'
newline|'\n'
indent|'                '
name|'if'
name|'v'
op|'['
number|'2'
op|']'
op|'=='
string|"'\\x00'"
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'icqStatus'
op|'='
string|"'online'"
newline|'\n'
dedent|''
name|'elif'
name|'v'
op|'['
number|'2'
op|']'
op|'=='
string|"'\\x01'"
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'icqStatus'
op|'='
string|"'away'"
newline|'\n'
dedent|''
name|'elif'
name|'v'
op|'['
number|'2'
op|']'
op|'=='
string|"'\\x02'"
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'icqStatus'
op|'='
string|"'dnd'"
newline|'\n'
dedent|''
name|'elif'
name|'v'
op|'['
number|'2'
op|']'
op|'=='
string|"'\\x04'"
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'icqStatus'
op|'='
string|"'out'"
newline|'\n'
dedent|''
name|'elif'
name|'v'
op|'['
number|'2'
op|']'
op|'=='
string|"'\\x10'"
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'icqStatus'
op|'='
string|"'busy'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'icqStatus'
op|'='
string|"'unknown'"
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'k'
op|'=='
number|'10'
op|':'
comment|'# icq ip address'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'icqIPaddy'
op|'='
name|'socket'
op|'.'
name|'inet_ntoa'
op|'('
name|'v'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'12'
op|':'
comment|'# icq random stuff'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'icqRandom'
op|'='
name|'v'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'13'
op|':'
comment|'# capabilities'
newline|'\n'
indent|'                '
name|'caps'
op|'='
op|'['
op|']'
newline|'\n'
name|'while'
name|'v'
op|':'
newline|'\n'
indent|'                    '
name|'c'
op|'='
name|'v'
op|'['
op|':'
number|'16'
op|']'
newline|'\n'
name|'if'
name|'c'
op|'=='
name|'CAP_ICON'
op|':'
name|'caps'
op|'.'
name|'append'
op|'('
string|'"icon"'
op|')'
newline|'\n'
name|'elif'
name|'c'
op|'=='
name|'CAP_IMAGE'
op|':'
name|'caps'
op|'.'
name|'append'
op|'('
string|'"image"'
op|')'
newline|'\n'
name|'elif'
name|'c'
op|'=='
name|'CAP_VOICE'
op|':'
name|'caps'
op|'.'
name|'append'
op|'('
string|'"voice"'
op|')'
newline|'\n'
name|'elif'
name|'c'
op|'=='
name|'CAP_CHAT'
op|':'
name|'caps'
op|'.'
name|'append'
op|'('
string|'"chat"'
op|')'
newline|'\n'
name|'elif'
name|'c'
op|'=='
name|'CAP_GET_FILE'
op|':'
name|'caps'
op|'.'
name|'append'
op|'('
string|'"getfile"'
op|')'
newline|'\n'
name|'elif'
name|'c'
op|'=='
name|'CAP_SEND_FILE'
op|':'
name|'caps'
op|'.'
name|'append'
op|'('
string|'"sendfile"'
op|')'
newline|'\n'
name|'elif'
name|'c'
op|'=='
name|'CAP_SEND_LIST'
op|':'
name|'caps'
op|'.'
name|'append'
op|'('
string|'"sendlist"'
op|')'
newline|'\n'
name|'elif'
name|'c'
op|'=='
name|'CAP_GAMES'
op|':'
name|'caps'
op|'.'
name|'append'
op|'('
string|'"games"'
op|')'
newline|'\n'
name|'else'
op|':'
name|'caps'
op|'.'
name|'append'
op|'('
op|'('
string|'"unknown"'
op|','
name|'c'
op|')'
op|')'
newline|'\n'
name|'v'
op|'='
name|'v'
op|'['
number|'16'
op|':'
op|']'
newline|'\n'
dedent|''
name|'caps'
op|'.'
name|'sort'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'caps'
op|'='
name|'caps'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'14'
op|':'
name|'pass'
newline|'\n'
name|'elif'
name|'k'
op|'=='
number|'15'
op|':'
comment|'# session length (aim)'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sessionLength'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!L'"
op|','
name|'v'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'16'
op|':'
comment|'# session length (aol)'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sessionLength'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!L'"
op|','
name|'v'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'30'
op|':'
comment|'# no idea'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'log'
op|'.'
name|'msg'
op|'('
string|'"unknown tlv for user %s\\nt: %s\\nv: %s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'name'
op|','
name|'k'
op|','
name|'repr'
op|'('
name|'v'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__str__
dedent|''
dedent|''
dedent|''
name|'def'
name|'__str__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'s'
op|'='
string|"'<OSCARUser %s'"
op|'%'
name|'self'
op|'.'
name|'name'
newline|'\n'
name|'o'
op|'='
op|'['
op|']'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'warning'
op|'!='
number|'0'
op|':'
name|'o'
op|'.'
name|'append'
op|'('
string|"'warning level %s'"
op|'%'
name|'self'
op|'.'
name|'warning'
op|')'
newline|'\n'
name|'if'
name|'hasattr'
op|'('
name|'self'
op|','
string|"'flags'"
op|')'
op|':'
name|'o'
op|'.'
name|'append'
op|'('
string|"'flags %s'"
op|'%'
name|'self'
op|'.'
name|'flags'
op|')'
newline|'\n'
name|'if'
name|'hasattr'
op|'('
name|'self'
op|','
string|"'sessionLength'"
op|')'
op|':'
name|'o'
op|'.'
name|'append'
op|'('
string|"'online for %i minutes'"
op|'%'
op|'('
name|'self'
op|'.'
name|'sessionLength'
op|'/'
number|'60'
op|','
op|')'
op|')'
newline|'\n'
name|'if'
name|'hasattr'
op|'('
name|'self'
op|','
string|"'idleTime'"
op|')'
op|':'
name|'o'
op|'.'
name|'append'
op|'('
string|"'idle for %i minutes'"
op|'%'
name|'self'
op|'.'
name|'idleTime'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'caps'
op|':'
name|'o'
op|'.'
name|'append'
op|'('
string|"'caps %s'"
op|'%'
name|'self'
op|'.'
name|'caps'
op|')'
newline|'\n'
name|'if'
name|'o'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'='
name|'s'
op|'+'
string|"', '"
op|'+'
string|"', '"
op|'.'
name|'join'
op|'('
name|'o'
op|')'
newline|'\n'
dedent|''
name|'s'
op|'='
name|'s'
op|'+'
string|"'>'"
newline|'\n'
name|'return'
name|'s'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SSIGroup
dedent|''
dedent|''
name|'class'
name|'SSIGroup'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'tlvs'
op|'='
op|'{'
op|'}'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'name'
op|'='
name|'name'
newline|'\n'
comment|'#self.tlvs = []'
nl|'\n'
comment|'#self.userIDs = []'
nl|'\n'
name|'self'
op|'.'
name|'usersToID'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'users'
op|'='
op|'['
op|']'
newline|'\n'
comment|'#if not tlvs.has_key(0xC8): return'
nl|'\n'
comment|'#buddyIDs = tlvs[0xC8]'
nl|'\n'
comment|'#while buddyIDs:'
nl|'\n'
comment|"#    bid = struct.unpack('!H',buddyIDs[:2])[0]"
nl|'\n'
comment|'#    buddyIDs = buddyIDs[2:]'
nl|'\n'
comment|'#    self.users.append(bid)'
nl|'\n'
nl|'\n'
DECL|member|findIDFor
dedent|''
name|'def'
name|'findIDFor'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'usersToID'
op|'['
name|'user'
op|']'
newline|'\n'
nl|'\n'
DECL|member|addUser
dedent|''
name|'def'
name|'addUser'
op|'('
name|'self'
op|','
name|'buddyID'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'usersToID'
op|'['
name|'user'
op|']'
op|'='
name|'buddyID'
newline|'\n'
name|'self'
op|'.'
name|'users'
op|'.'
name|'append'
op|'('
name|'user'
op|')'
newline|'\n'
name|'user'
op|'.'
name|'group'
op|'='
name|'self'
newline|'\n'
nl|'\n'
DECL|member|oscarRep
dedent|''
name|'def'
name|'oscarRep'
op|'('
name|'self'
op|','
name|'groupID'
op|','
name|'buddyID'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'tlvData'
op|'='
name|'TLV'
op|'('
number|'0xc8'
op|','
name|'reduce'
op|'('
name|'lambda'
name|'x'
op|','
name|'y'
op|':'
name|'x'
op|'+'
name|'y'
op|','
op|'['
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!H'"
op|','
name|'self'
op|'.'
name|'usersToID'
op|'['
name|'x'
op|']'
op|')'
name|'for'
name|'x'
name|'in'
name|'self'
op|'.'
name|'users'
op|']'
op|')'
op|')'
newline|'\n'
name|'return'
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!H'"
op|','
name|'len'
op|'('
name|'self'
op|'.'
name|'name'
op|')'
op|')'
op|'+'
name|'self'
op|'.'
name|'name'
op|'+'
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!HH'"
op|','
name|'groupID'
op|','
name|'buddyID'
op|')'
op|'+'
string|"'\\000\\001'"
op|'+'
name|'tlvData'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SSIBuddy
dedent|''
dedent|''
name|'class'
name|'SSIBuddy'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'tlvs'
op|'='
op|'{'
op|'}'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'name'
op|'='
name|'name'
newline|'\n'
name|'self'
op|'.'
name|'tlvs'
op|'='
name|'tlvs'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'tlvs'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'k'
op|'=='
number|'0x013c'
op|':'
comment|'# buddy comment'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'buddyComment'
op|'='
name|'v'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'0x013d'
op|':'
comment|'# buddy alerts'
newline|'\n'
indent|'                '
name|'actionFlag'
op|'='
name|'ord'
op|'('
name|'v'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'whenFlag'
op|'='
name|'ord'
op|'('
name|'v'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'alertActions'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'alertWhen'
op|'='
op|'['
op|']'
newline|'\n'
name|'if'
name|'actionFlag'
op|'&'
number|'1'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'alertActions'
op|'.'
name|'append'
op|'('
string|"'popup'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'actionFlag'
op|'&'
number|'2'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'alertActions'
op|'.'
name|'append'
op|'('
string|"'sound'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'whenFlag'
op|'&'
number|'1'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'alertWhen'
op|'.'
name|'append'
op|'('
string|"'online'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'whenFlag'
op|'&'
number|'2'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'alertWhen'
op|'.'
name|'append'
op|'('
string|"'unidle'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'whenFlag'
op|'&'
number|'4'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'alertWhen'
op|'.'
name|'append'
op|'('
string|"'unaway'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'k'
op|'=='
number|'0x013e'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'alertSound'
op|'='
name|'v'
newline|'\n'
nl|'\n'
DECL|member|oscarRep
dedent|''
dedent|''
dedent|''
name|'def'
name|'oscarRep'
op|'('
name|'self'
op|','
name|'groupID'
op|','
name|'buddyID'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'tlvData'
op|'='
name|'reduce'
op|'('
name|'lambda'
name|'x'
op|','
name|'y'
op|':'
name|'x'
op|'+'
name|'y'
op|','
name|'map'
op|'('
name|'lambda'
op|'('
name|'k'
op|','
name|'v'
op|')'
op|':'
name|'TLV'
op|'('
name|'k'
op|','
name|'v'
op|')'
op|','
name|'self'
op|'.'
name|'tlvs'
op|'.'
name|'items'
op|'('
op|')'
op|')'
op|','
string|"'\\000\\000'"
op|')'
newline|'\n'
name|'return'
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!H'"
op|','
name|'len'
op|'('
name|'self'
op|'.'
name|'name'
op|')'
op|')'
op|'+'
name|'self'
op|'.'
name|'name'
op|'+'
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!HH'"
op|','
name|'groupID'
op|','
name|'buddyID'
op|')'
op|'+'
string|"'\\000\\000'"
op|'+'
name|'tlvData'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|OscarConnection
dedent|''
dedent|''
name|'class'
name|'OscarConnection'
op|'('
name|'protocol'
op|'.'
name|'Protocol'
op|')'
op|':'
newline|'\n'
DECL|member|connectionMade
indent|'    '
name|'def'
name|'connectionMade'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'state'
op|'='
string|'""'
newline|'\n'
name|'self'
op|'.'
name|'seqnum'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'buf'
op|'='
string|"''"
newline|'\n'
name|'self'
op|'.'
name|'stopKeepAliveID'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'setKeepAlive'
op|'('
number|'4'
op|'*'
number|'60'
op|')'
comment|'# 4 minutes'
newline|'\n'
nl|'\n'
DECL|member|connectionLost
dedent|''
name|'def'
name|'connectionLost'
op|'('
name|'self'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'log'
op|'.'
name|'msg'
op|'('
string|'"Connection Lost! %s"'
op|'%'
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stopKeepAlive'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'#    def connectionFailed(self):'
nl|'\n'
comment|'#        log.msg("Connection Failed! %s" % self)'
nl|'\n'
comment|'#        self.stopKeepAlive()'
nl|'\n'
nl|'\n'
DECL|member|sendFLAP
dedent|''
name|'def'
name|'sendFLAP'
op|'('
name|'self'
op|','
name|'data'
op|','
name|'channel'
op|'='
number|'0x02'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'header'
op|'='
string|'"!cBHH"'
newline|'\n'
name|'self'
op|'.'
name|'seqnum'
op|'='
op|'('
name|'self'
op|'.'
name|'seqnum'
op|'+'
number|'1'
op|')'
op|'%'
number|'0xFFFF'
newline|'\n'
name|'seqnum'
op|'='
name|'self'
op|'.'
name|'seqnum'
newline|'\n'
name|'head'
op|'='
name|'struct'
op|'.'
name|'pack'
op|'('
name|'header'
op|','
string|"'*'"
op|','
name|'channel'
op|','
nl|'\n'
name|'seqnum'
op|','
name|'len'
op|'('
name|'data'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'write'
op|'('
name|'head'
op|'+'
name|'str'
op|'('
name|'data'
op|')'
op|')'
newline|'\n'
comment|'#        if isinstance(self, ChatService):'
nl|'\n'
comment|'#            logPacketData(head+str(data))'
nl|'\n'
nl|'\n'
DECL|member|readFlap
dedent|''
name|'def'
name|'readFlap'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'header'
op|'='
string|'"!cBHH"'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'buf'
op|')'
op|'<'
number|'6'
op|':'
name|'return'
newline|'\n'
name|'flap'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
name|'header'
op|','
name|'self'
op|'.'
name|'buf'
op|'['
op|':'
number|'6'
op|']'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'buf'
op|')'
op|'<'
number|'6'
op|'+'
name|'flap'
op|'['
number|'3'
op|']'
op|':'
name|'return'
newline|'\n'
name|'data'
op|','
name|'self'
op|'.'
name|'buf'
op|'='
name|'self'
op|'.'
name|'buf'
op|'['
number|'6'
op|':'
number|'6'
op|'+'
name|'flap'
op|'['
number|'3'
op|']'
op|']'
op|','
name|'self'
op|'.'
name|'buf'
op|'['
number|'6'
op|'+'
name|'flap'
op|'['
number|'3'
op|']'
op|':'
op|']'
newline|'\n'
name|'return'
op|'['
name|'flap'
op|'['
number|'1'
op|']'
op|','
name|'data'
op|']'
newline|'\n'
nl|'\n'
DECL|member|dataReceived
dedent|''
name|'def'
name|'dataReceived'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
comment|'#        if isinstance(self, ChatService):'
nl|'\n'
comment|'#            logPacketData(data)'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'buf'
op|'='
name|'self'
op|'.'
name|'buf'
op|'+'
name|'data'
newline|'\n'
name|'flap'
op|'='
name|'self'
op|'.'
name|'readFlap'
op|'('
op|')'
newline|'\n'
name|'while'
name|'flap'
op|':'
newline|'\n'
indent|'            '
name|'func'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
string|'"oscar_%s"'
op|'%'
name|'self'
op|'.'
name|'state'
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'func'
op|':'
newline|'\n'
indent|'                '
name|'log'
op|'.'
name|'msg'
op|'('
string|'"no func for state: %s"'
op|'%'
name|'self'
op|'.'
name|'state'
op|')'
newline|'\n'
dedent|''
name|'state'
op|'='
name|'func'
op|'('
name|'flap'
op|')'
newline|'\n'
name|'if'
name|'state'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'state'
op|'='
name|'state'
newline|'\n'
dedent|''
name|'flap'
op|'='
name|'self'
op|'.'
name|'readFlap'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|setKeepAlive
dedent|''
dedent|''
name|'def'
name|'setKeepAlive'
op|'('
name|'self'
op|','
name|'t'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'keepAliveDelay'
op|'='
name|'t'
newline|'\n'
name|'self'
op|'.'
name|'stopKeepAlive'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stopKeepAliveID'
op|'='
name|'reactor'
op|'.'
name|'callLater'
op|'('
name|'t'
op|','
name|'self'
op|'.'
name|'sendKeepAlive'
op|')'
newline|'\n'
nl|'\n'
DECL|member|sendKeepAlive
dedent|''
name|'def'
name|'sendKeepAlive'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'sendFLAP'
op|'('
string|'""'
op|','
number|'0x05'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stopKeepAliveID'
op|'='
name|'reactor'
op|'.'
name|'callLater'
op|'('
name|'self'
op|'.'
name|'keepAliveDelay'
op|','
name|'self'
op|'.'
name|'sendKeepAlive'
op|')'
newline|'\n'
nl|'\n'
DECL|member|stopKeepAlive
dedent|''
name|'def'
name|'stopKeepAlive'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'stopKeepAliveID'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'stopKeepAliveID'
op|'.'
name|'cancel'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stopKeepAliveID'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|disconnect
dedent|''
dedent|''
name|'def'
name|'disconnect'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        send the disconnect flap, and sever the connection\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendFLAP'
op|'('
string|"''"
op|','
number|'0x04'
op|')'
newline|'\n'
DECL|function|f
name|'def'
name|'f'
op|'('
name|'reason'
op|')'
op|':'
name|'pass'
newline|'\n'
name|'self'
op|'.'
name|'connectionLost'
op|'='
name|'f'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SNACBased
dedent|''
dedent|''
name|'class'
name|'SNACBased'
op|'('
name|'OscarConnection'
op|')'
op|':'
newline|'\n'
DECL|variable|snacFamilies
indent|'    '
name|'snacFamilies'
op|'='
op|'{'
nl|'\n'
comment|'# family : (version, toolID, toolVersion)'
nl|'\n'
op|'}'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'cookie'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cookie'
op|'='
name|'cookie'
newline|'\n'
name|'self'
op|'.'
name|'lastID'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'supportedFamilies'
op|'='
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'requestCallbacks'
op|'='
op|'{'
op|'}'
comment|'# request id:Deferred'
newline|'\n'
nl|'\n'
DECL|member|sendSNAC
dedent|''
name|'def'
name|'sendSNAC'
op|'('
name|'self'
op|','
name|'fam'
op|','
name|'sub'
op|','
name|'data'
op|','
name|'flags'
op|'='
op|'['
number|'0'
op|','
number|'0'
op|']'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        send a snac and wait for the response by returning a Deferred.\n        """'
newline|'\n'
name|'reqid'
op|'='
name|'self'
op|'.'
name|'lastID'
newline|'\n'
name|'self'
op|'.'
name|'lastID'
op|'='
name|'reqid'
op|'+'
number|'1'
newline|'\n'
name|'d'
op|'='
name|'defer'
op|'.'
name|'Deferred'
op|'('
op|')'
newline|'\n'
name|'d'
op|'.'
name|'reqid'
op|'='
name|'reqid'
newline|'\n'
nl|'\n'
comment|'#d.addErrback(self._ebDeferredError,fam,sub,data) # XXX for testing'
nl|'\n'
nl|'\n'
name|'self'
op|'.'
name|'requestCallbacks'
op|'['
name|'reqid'
op|']'
op|'='
name|'d'
newline|'\n'
name|'self'
op|'.'
name|'sendFLAP'
op|'('
name|'SNAC'
op|'('
name|'fam'
op|','
name|'sub'
op|','
name|'reqid'
op|','
name|'data'
op|')'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|_ebDeferredError
dedent|''
name|'def'
name|'_ebDeferredError'
op|'('
name|'self'
op|','
name|'error'
op|','
name|'fam'
op|','
name|'sub'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'log'
op|'.'
name|'msg'
op|'('
string|"'ERROR IN DEFERRED %s'"
op|'%'
name|'error'
op|')'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
string|"'on sending of message, family 0x%02x, subtype 0x%02x'"
op|'%'
op|'('
name|'fam'
op|','
name|'sub'
op|')'
op|')'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
string|"'data: %s'"
op|'%'
name|'repr'
op|'('
name|'data'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|sendSNACnr
dedent|''
name|'def'
name|'sendSNACnr'
op|'('
name|'self'
op|','
name|'fam'
op|','
name|'sub'
op|','
name|'data'
op|','
name|'flags'
op|'='
op|'['
number|'0'
op|','
number|'0'
op|']'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        send a snac, but don\'t bother adding a deferred, we don\'t care.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendFLAP'
op|'('
name|'SNAC'
op|'('
name|'fam'
op|','
name|'sub'
op|','
number|'0x10000'
op|'*'
name|'fam'
op|'+'
name|'sub'
op|','
name|'data'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|oscar_
dedent|''
name|'def'
name|'oscar_'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'sendFLAP'
op|'('
string|'"\\000\\000\\000\\001"'
op|'+'
name|'TLV'
op|'('
number|'6'
op|','
name|'self'
op|'.'
name|'cookie'
op|')'
op|','
number|'0x01'
op|')'
newline|'\n'
name|'return'
string|'"Data"'
newline|'\n'
nl|'\n'
DECL|member|oscar_Data
dedent|''
name|'def'
name|'oscar_Data'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'snac'
op|'='
name|'readSNAC'
op|'('
name|'data'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'requestCallbacks'
op|'.'
name|'has_key'
op|'('
name|'snac'
op|'['
number|'4'
op|']'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'d'
op|'='
name|'self'
op|'.'
name|'requestCallbacks'
op|'['
name|'snac'
op|'['
number|'4'
op|']'
op|']'
newline|'\n'
name|'del'
name|'self'
op|'.'
name|'requestCallbacks'
op|'['
name|'snac'
op|'['
number|'4'
op|']'
op|']'
newline|'\n'
name|'if'
name|'snac'
op|'['
number|'1'
op|']'
op|'!='
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'d'
op|'.'
name|'callback'
op|'('
name|'snac'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'d'
op|'.'
name|'errback'
op|'('
name|'snac'
op|')'
newline|'\n'
dedent|''
name|'return'
newline|'\n'
dedent|''
name|'func'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
string|"'oscar_%02X_%02X'"
op|'%'
op|'('
name|'snac'
op|'['
number|'0'
op|']'
op|','
name|'snac'
op|'['
number|'1'
op|']'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'func'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'oscar_unknown'
op|'('
name|'snac'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'func'
op|'('
name|'snac'
op|'['
number|'2'
op|':'
op|']'
op|')'
newline|'\n'
dedent|''
name|'return'
string|'"Data"'
newline|'\n'
nl|'\n'
DECL|member|oscar_unknown
dedent|''
name|'def'
name|'oscar_unknown'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'log'
op|'.'
name|'msg'
op|'('
string|'"unknown for %s"'
op|'%'
name|'self'
op|')'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
name|'snac'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|oscar_01_03
dedent|''
name|'def'
name|'oscar_01_03'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'numFamilies'
op|'='
name|'len'
op|'('
name|'snac'
op|'['
number|'3'
op|']'
op|')'
op|'/'
number|'2'
newline|'\n'
name|'self'
op|'.'
name|'supportedFamilies'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|'"!"'
op|'+'
name|'str'
op|'('
name|'numFamilies'
op|')'
op|'+'
string|"'H'"
op|','
name|'snac'
op|'['
number|'3'
op|']'
op|')'
newline|'\n'
name|'d'
op|'='
string|"''"
newline|'\n'
name|'for'
name|'fam'
name|'in'
name|'self'
op|'.'
name|'supportedFamilies'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'snacFamilies'
op|'.'
name|'has_key'
op|'('
name|'fam'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'d'
op|'='
name|'d'
op|'+'
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!2H'"
op|','
name|'fam'
op|','
name|'self'
op|'.'
name|'snacFamilies'
op|'['
name|'fam'
op|']'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x01'
op|','
number|'0x17'
op|','
name|'d'
op|')'
newline|'\n'
nl|'\n'
DECL|member|oscar_01_0A
dedent|''
name|'def'
name|'oscar_01_0A'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        change of rate information.\n        """'
newline|'\n'
comment|'# this can be parsed, maybe we can even work it in'
nl|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|oscar_01_18
dedent|''
name|'def'
name|'oscar_01_18'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        host versions, in the same format as we sent\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x01'
op|','
number|'0x06'
op|','
string|'""'
op|')'
comment|'#pass'
newline|'\n'
nl|'\n'
DECL|member|clientReady
dedent|''
name|'def'
name|'clientReady'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when the client is ready to be online\n        """'
newline|'\n'
name|'d'
op|'='
string|"''"
newline|'\n'
name|'for'
name|'fam'
name|'in'
name|'self'
op|'.'
name|'supportedFamilies'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'snacFamilies'
op|'.'
name|'has_key'
op|'('
name|'fam'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'version'
op|','
name|'toolID'
op|','
name|'toolVersion'
op|'='
name|'self'
op|'.'
name|'snacFamilies'
op|'['
name|'fam'
op|']'
newline|'\n'
name|'d'
op|'='
name|'d'
op|'+'
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!4H'"
op|','
name|'fam'
op|','
name|'version'
op|','
name|'toolID'
op|','
name|'toolVersion'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x01'
op|','
number|'0x02'
op|','
name|'d'
op|')'
newline|'\n'
nl|'\n'
DECL|class|BOSConnection
dedent|''
dedent|''
name|'class'
name|'BOSConnection'
op|'('
name|'SNACBased'
op|')'
op|':'
newline|'\n'
DECL|variable|snacFamilies
indent|'    '
name|'snacFamilies'
op|'='
op|'{'
nl|'\n'
number|'0x01'
op|':'
op|'('
number|'3'
op|','
number|'0x0110'
op|','
number|'0x059b'
op|')'
op|','
nl|'\n'
number|'0x13'
op|':'
op|'('
number|'3'
op|','
number|'0x0110'
op|','
number|'0x059b'
op|')'
op|','
nl|'\n'
number|'0x02'
op|':'
op|'('
number|'1'
op|','
number|'0x0110'
op|','
number|'0x059b'
op|')'
op|','
nl|'\n'
number|'0x03'
op|':'
op|'('
number|'1'
op|','
number|'0x0110'
op|','
number|'0x059b'
op|')'
op|','
nl|'\n'
number|'0x04'
op|':'
op|'('
number|'1'
op|','
number|'0x0110'
op|','
number|'0x059b'
op|')'
op|','
nl|'\n'
number|'0x06'
op|':'
op|'('
number|'1'
op|','
number|'0x0110'
op|','
number|'0x059b'
op|')'
op|','
nl|'\n'
number|'0x08'
op|':'
op|'('
number|'1'
op|','
number|'0x0104'
op|','
number|'0x0001'
op|')'
op|','
nl|'\n'
number|'0x09'
op|':'
op|'('
number|'1'
op|','
number|'0x0110'
op|','
number|'0x059b'
op|')'
op|','
nl|'\n'
number|'0x0a'
op|':'
op|'('
number|'1'
op|','
number|'0x0110'
op|','
number|'0x059b'
op|')'
op|','
nl|'\n'
number|'0x0b'
op|':'
op|'('
number|'1'
op|','
number|'0x0104'
op|','
number|'0x0001'
op|')'
op|','
nl|'\n'
number|'0x0c'
op|':'
op|'('
number|'1'
op|','
number|'0x0104'
op|','
number|'0x0001'
op|')'
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
DECL|variable|capabilities
name|'capabilities'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'username'
op|','
name|'cookie'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'SNACBased'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
name|'cookie'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'username'
op|'='
name|'username'
newline|'\n'
name|'self'
op|'.'
name|'profile'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'awayMessage'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'services'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'capabilities'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'capabilities'
op|'='
op|'['
name|'CAP_CHAT'
op|']'
newline|'\n'
nl|'\n'
DECL|member|parseUser
dedent|''
dedent|''
name|'def'
name|'parseUser'
op|'('
name|'self'
op|','
name|'data'
op|','
name|'count'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'l'
op|'='
name|'ord'
op|'('
name|'data'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'name'
op|'='
name|'data'
op|'['
number|'1'
op|':'
number|'1'
op|'+'
name|'l'
op|']'
newline|'\n'
name|'warn'
op|','
name|'foo'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|'"!HH"'
op|','
name|'data'
op|'['
number|'1'
op|'+'
name|'l'
op|':'
number|'5'
op|'+'
name|'l'
op|']'
op|')'
newline|'\n'
name|'warn'
op|'='
name|'int'
op|'('
name|'warn'
op|'/'
number|'10'
op|')'
newline|'\n'
name|'tlvs'
op|'='
name|'data'
op|'['
number|'5'
op|'+'
name|'l'
op|':'
op|']'
newline|'\n'
name|'if'
name|'count'
op|':'
newline|'\n'
indent|'            '
name|'tlvs'
op|','
name|'rest'
op|'='
name|'readTLVs'
op|'('
name|'tlvs'
op|','
name|'foo'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'tlvs'
op|','
name|'rest'
op|'='
name|'readTLVs'
op|'('
name|'tlvs'
op|')'
op|','
name|'None'
newline|'\n'
dedent|''
name|'u'
op|'='
name|'OSCARUser'
op|'('
name|'name'
op|','
name|'warn'
op|','
name|'tlvs'
op|')'
newline|'\n'
name|'if'
name|'rest'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'u'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'u'
op|','
name|'rest'
newline|'\n'
nl|'\n'
DECL|member|oscar_01_05
dedent|''
dedent|''
name|'def'
name|'oscar_01_05'
op|'('
name|'self'
op|','
name|'snac'
op|','
name|'d'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        data for a new service connection\n        d might be a deferred to be called back when the service is ready\n        """'
newline|'\n'
name|'tlvs'
op|'='
name|'readTLVs'
op|'('
name|'snac'
op|'['
number|'3'
op|']'
op|'['
number|'2'
op|':'
op|']'
op|')'
newline|'\n'
name|'service'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!H'"
op|','
name|'tlvs'
op|'['
number|'0x0d'
op|']'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'ip'
op|'='
name|'tlvs'
op|'['
number|'5'
op|']'
newline|'\n'
name|'cookie'
op|'='
name|'tlvs'
op|'['
number|'6'
op|']'
newline|'\n'
comment|'#c = serviceClasses[service](self, cookie, d)'
nl|'\n'
name|'c'
op|'='
name|'protocol'
op|'.'
name|'ClientCreator'
op|'('
name|'reactor'
op|','
name|'serviceClasses'
op|'['
name|'service'
op|']'
op|','
name|'self'
op|','
name|'cookie'
op|','
name|'d'
op|')'
newline|'\n'
DECL|function|addService
name|'def'
name|'addService'
op|'('
name|'x'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'services'
op|'['
name|'service'
op|']'
op|'='
name|'x'
newline|'\n'
dedent|''
name|'c'
op|'.'
name|'connectTCP'
op|'('
name|'ip'
op|','
number|'5190'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'addService'
op|')'
newline|'\n'
comment|'#self.services[service] = c'
nl|'\n'
nl|'\n'
DECL|member|oscar_01_07
dedent|''
name|'def'
name|'oscar_01_07'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        rate paramaters\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x01'
op|','
number|'0x08'
op|','
string|'"\\x00\\x01\\x00\\x02\\x00\\x03\\x00\\x04\\x00\\x05"'
op|')'
comment|'# ack'
newline|'\n'
name|'self'
op|'.'
name|'initDone'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x13'
op|','
number|'0x02'
op|','
string|"''"
op|')'
comment|'# SSI rights info'
newline|'\n'
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x02'
op|','
number|'0x02'
op|','
string|"''"
op|')'
comment|'# location rights info'
newline|'\n'
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x03'
op|','
number|'0x02'
op|','
string|"''"
op|')'
comment|'# buddy list rights'
newline|'\n'
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x04'
op|','
number|'0x04'
op|','
string|"''"
op|')'
comment|'# ICBM parms'
newline|'\n'
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x09'
op|','
number|'0x02'
op|','
string|"''"
op|')'
comment|'# BOS rights'
newline|'\n'
nl|'\n'
DECL|member|oscar_01_10
dedent|''
name|'def'
name|'oscar_01_10'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        we\'ve been warned\n        """'
newline|'\n'
name|'skip'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!H'"
op|','
name|'snac'
op|'['
number|'3'
op|']'
op|'['
op|':'
number|'2'
op|']'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'newLevel'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!H'"
op|','
name|'snac'
op|'['
number|'3'
op|']'
op|'['
number|'2'
op|'+'
name|'skip'
op|':'
number|'4'
op|'+'
name|'skip'
op|']'
op|')'
op|'['
number|'0'
op|']'
op|'/'
number|'10'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'snac'
op|'['
number|'3'
op|']'
op|')'
op|'>'
number|'4'
op|'+'
name|'skip'
op|':'
newline|'\n'
indent|'            '
name|'by'
op|'='
name|'self'
op|'.'
name|'parseUser'
op|'('
name|'snac'
op|'['
number|'3'
op|']'
op|'['
number|'4'
op|'+'
name|'skip'
op|':'
op|']'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'by'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'receiveWarning'
op|'('
name|'newLevel'
op|','
name|'by'
op|')'
newline|'\n'
nl|'\n'
DECL|member|oscar_01_13
dedent|''
name|'def'
name|'oscar_01_13'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        MOTD\n        """'
newline|'\n'
name|'pass'
comment|"# we don't care for now"
newline|'\n'
nl|'\n'
DECL|member|oscar_02_03
dedent|''
name|'def'
name|'oscar_02_03'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        location rights response\n        """'
newline|'\n'
name|'tlvs'
op|'='
name|'readTLVs'
op|'('
name|'snac'
op|'['
number|'3'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'maxProfileLength'
op|'='
name|'tlvs'
op|'['
number|'1'
op|']'
newline|'\n'
nl|'\n'
DECL|member|oscar_03_03
dedent|''
name|'def'
name|'oscar_03_03'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        buddy list rights response\n        """'
newline|'\n'
name|'tlvs'
op|'='
name|'readTLVs'
op|'('
name|'snac'
op|'['
number|'3'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'maxBuddies'
op|'='
name|'tlvs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'maxWatchers'
op|'='
name|'tlvs'
op|'['
number|'2'
op|']'
newline|'\n'
nl|'\n'
DECL|member|oscar_03_0B
dedent|''
name|'def'
name|'oscar_03_0B'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        buddy update\n        """'
newline|'\n'
name|'self'
op|'.'
name|'updateBuddy'
op|'('
name|'self'
op|'.'
name|'parseUser'
op|'('
name|'snac'
op|'['
number|'3'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|oscar_03_0C
dedent|''
name|'def'
name|'oscar_03_0C'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        buddy offline\n        """'
newline|'\n'
name|'self'
op|'.'
name|'offlineBuddy'
op|'('
name|'self'
op|'.'
name|'parseUser'
op|'('
name|'snac'
op|'['
number|'3'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'#    def oscar_04_03(self, snac):'
nl|'\n'
nl|'\n'
DECL|member|oscar_04_05
dedent|''
name|'def'
name|'oscar_04_05'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        ICBM parms response\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x04'
op|','
number|'0x02'
op|','
string|"'\\x00\\x00\\x00\\x00\\x00\\x0b\\x1f@\\x03\\xe7\\x03\\xe7\\x00\\x00\\x00\\x00'"
op|')'
comment|'# IM rights'
newline|'\n'
nl|'\n'
DECL|member|oscar_04_07
dedent|''
name|'def'
name|'oscar_04_07'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        ICBM message (instant message)\n        """'
newline|'\n'
name|'data'
op|'='
name|'snac'
op|'['
number|'3'
op|']'
newline|'\n'
name|'cookie'
op|','
name|'data'
op|'='
name|'data'
op|'['
op|':'
number|'8'
op|']'
op|','
name|'data'
op|'['
number|'8'
op|':'
op|']'
newline|'\n'
name|'channel'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!H'"
op|','
name|'data'
op|'['
op|':'
number|'2'
op|']'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'data'
op|'='
name|'data'
op|'['
number|'2'
op|':'
op|']'
newline|'\n'
name|'user'
op|','
name|'data'
op|'='
name|'self'
op|'.'
name|'parseUser'
op|'('
name|'data'
op|','
number|'1'
op|')'
newline|'\n'
name|'tlvs'
op|'='
name|'readTLVs'
op|'('
name|'data'
op|')'
newline|'\n'
name|'if'
name|'channel'
op|'=='
number|'1'
op|':'
comment|'# message'
newline|'\n'
indent|'            '
name|'flags'
op|'='
op|'['
op|']'
newline|'\n'
name|'multiparts'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'tlvs'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'k'
op|'=='
number|'2'
op|':'
newline|'\n'
indent|'                    '
name|'while'
name|'v'
op|':'
newline|'\n'
indent|'                        '
name|'v'
op|'='
name|'v'
op|'['
number|'2'
op|':'
op|']'
comment|'# skip bad data'
newline|'\n'
name|'messageLength'
op|','
name|'charSet'
op|','
name|'charSubSet'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!3H'"
op|','
name|'v'
op|'['
op|':'
number|'6'
op|']'
op|')'
newline|'\n'
name|'messageLength'
op|'-='
number|'4'
newline|'\n'
name|'message'
op|'='
op|'['
name|'v'
op|'['
number|'6'
op|':'
number|'6'
op|'+'
name|'messageLength'
op|']'
op|']'
newline|'\n'
name|'if'
name|'charSet'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'                            '
name|'pass'
comment|"# don't add anything special"
newline|'\n'
dedent|''
name|'elif'
name|'charSet'
op|'=='
number|'2'
op|':'
newline|'\n'
indent|'                            '
name|'message'
op|'.'
name|'append'
op|'('
string|"'unicode'"
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'charSet'
op|'=='
number|'3'
op|':'
newline|'\n'
indent|'                            '
name|'message'
op|'.'
name|'append'
op|'('
string|"'iso-8859-1'"
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'charSet'
op|'=='
number|'0xffff'
op|':'
newline|'\n'
indent|'                            '
name|'message'
op|'.'
name|'append'
op|'('
string|"'none'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'charSubSet'
op|'=='
number|'0xb'
op|':'
newline|'\n'
indent|'                            '
name|'message'
op|'.'
name|'append'
op|'('
string|"'macintosh'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'messageLength'
op|'>'
number|'0'
op|':'
name|'multiparts'
op|'.'
name|'append'
op|'('
name|'tuple'
op|'('
name|'message'
op|')'
op|')'
newline|'\n'
name|'v'
op|'='
name|'v'
op|'['
number|'6'
op|'+'
name|'messageLength'
op|':'
op|']'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'k'
op|'=='
number|'3'
op|':'
newline|'\n'
indent|'                    '
name|'flags'
op|'.'
name|'append'
op|'('
string|"'acknowledge'"
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'4'
op|':'
newline|'\n'
indent|'                    '
name|'flags'
op|'.'
name|'append'
op|'('
string|"'auto'"
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'6'
op|':'
newline|'\n'
indent|'                    '
name|'flags'
op|'.'
name|'append'
op|'('
string|"'offline'"
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'8'
op|':'
newline|'\n'
indent|'                    '
name|'iconLength'
op|','
name|'foo'
op|','
name|'iconSum'
op|','
name|'iconStamp'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!LHHL'"
op|','
name|'v'
op|')'
newline|'\n'
name|'if'
name|'iconLength'
op|':'
newline|'\n'
indent|'                        '
name|'flags'
op|'.'
name|'append'
op|'('
string|"'icon'"
op|')'
newline|'\n'
name|'flags'
op|'.'
name|'append'
op|'('
op|'('
name|'iconLength'
op|','
name|'iconSum'
op|','
name|'iconStamp'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'k'
op|'=='
number|'9'
op|':'
newline|'\n'
indent|'                    '
name|'flags'
op|'.'
name|'append'
op|'('
string|"'buddyrequest'"
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'0xb'
op|':'
comment|'# unknown'
newline|'\n'
indent|'                    '
name|'pass'
newline|'\n'
dedent|''
name|'elif'
name|'k'
op|'=='
number|'0x17'
op|':'
newline|'\n'
indent|'                    '
name|'flags'
op|'.'
name|'append'
op|'('
string|"'extradata'"
op|')'
newline|'\n'
name|'flags'
op|'.'
name|'append'
op|'('
name|'v'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'log'
op|'.'
name|'msg'
op|'('
string|"'unknown TLV for incoming IM, %04x, %s'"
op|'%'
op|'('
name|'k'
op|','
name|'repr'
op|'('
name|'v'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'#  unknown tlv for user SNewdorf'
nl|'\n'
comment|'#  t: 29'
nl|'\n'
comment|"#  v: '\\x00\\x00\\x00\\x05\\x02\\x01\\xd2\\x04r\\x00\\x01\\x01\\x10/\\x8c\\x8b\\x8a\\x1e\\x94*\\xbc\\x80}\\x8d\\xc4;\\x1dEM'"
nl|'\n'
comment|'# XXX what is this?'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'receiveMessage'
op|'('
name|'user'
op|','
name|'multiparts'
op|','
name|'flags'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'channel'
op|'=='
number|'2'
op|':'
comment|'# rondevouz'
newline|'\n'
indent|'            '
name|'status'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!H'"
op|','
name|'tlvs'
op|'['
number|'5'
op|']'
op|'['
op|':'
number|'2'
op|']'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'requestClass'
op|'='
name|'tlvs'
op|'['
number|'5'
op|']'
op|'['
number|'10'
op|':'
number|'26'
op|']'
newline|'\n'
name|'moreTLVs'
op|'='
name|'readTLVs'
op|'('
name|'tlvs'
op|'['
number|'5'
op|']'
op|'['
number|'26'
op|':'
op|']'
op|')'
newline|'\n'
name|'if'
name|'requestClass'
op|'=='
name|'CAP_CHAT'
op|':'
comment|'# a chat request'
newline|'\n'
indent|'                '
name|'exchange'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!H'"
op|','
name|'moreTLVs'
op|'['
number|'10001'
op|']'
op|'['
op|':'
number|'2'
op|']'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'name'
op|'='
name|'moreTLVs'
op|'['
number|'10001'
op|']'
op|'['
number|'3'
op|':'
op|'-'
number|'2'
op|']'
newline|'\n'
name|'instance'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!H'"
op|','
name|'moreTLVs'
op|'['
number|'10001'
op|']'
op|'['
op|'-'
number|'2'
op|':'
op|']'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'services'
op|'.'
name|'has_key'
op|'('
name|'SERVICE_CHATNAV'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'connectService'
op|'('
name|'SERVICE_CHATNAV'
op|','
number|'1'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'lambda'
name|'x'
op|':'
name|'self'
op|'.'
name|'services'
op|'['
name|'SERVICE_CHATNAV'
op|']'
op|'.'
name|'getChatInfo'
op|'('
name|'exchange'
op|','
name|'name'
op|','
name|'instance'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbGetChatInfoForInvite'
op|','
name|'user'
op|','
name|'moreTLVs'
op|'['
number|'12'
op|']'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'services'
op|'['
name|'SERVICE_CHATNAV'
op|']'
op|'.'
name|'getChatInfo'
op|'('
name|'exchange'
op|','
name|'name'
op|','
name|'instance'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbGetChatInfoForInvite'
op|','
name|'user'
op|','
name|'moreTLVs'
op|'['
number|'12'
op|']'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'requestClass'
op|'=='
name|'CAP_SEND_FILE'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'moreTLVs'
op|'.'
name|'has_key'
op|'('
number|'11'
op|')'
op|':'
comment|'# cancel'
newline|'\n'
indent|'                    '
name|'log'
op|'.'
name|'msg'
op|'('
string|"'cancelled file request'"
op|')'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
name|'status'
op|')'
newline|'\n'
name|'return'
comment|'# handle this later'
newline|'\n'
dedent|''
name|'name'
op|'='
name|'moreTLVs'
op|'['
number|'10001'
op|']'
op|'['
number|'9'
op|':'
op|'-'
number|'7'
op|']'
newline|'\n'
name|'desc'
op|'='
name|'moreTLVs'
op|'['
number|'12'
op|']'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
string|"'file request from %s, %s, %s'"
op|'%'
op|'('
name|'user'
op|','
name|'name'
op|','
name|'desc'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'receiveSendFileRequest'
op|'('
name|'user'
op|','
name|'name'
op|','
name|'desc'
op|','
name|'cookie'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'log'
op|'.'
name|'msg'
op|'('
string|"'unsupported rondevouz: %s'"
op|'%'
name|'requestClass'
op|')'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
name|'repr'
op|'('
name|'moreTLVs'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'log'
op|'.'
name|'msg'
op|'('
string|"'unknown channel %02x'"
op|'%'
name|'channel'
op|')'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
name|'tlvs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_cbGetChatInfoForInvite
dedent|''
dedent|''
name|'def'
name|'_cbGetChatInfoForInvite'
op|'('
name|'self'
op|','
name|'info'
op|','
name|'user'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'apply'
op|'('
name|'self'
op|'.'
name|'receiveChatInvite'
op|','
op|'('
name|'user'
op|','
name|'message'
op|')'
op|'+'
name|'info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|oscar_09_03
dedent|''
name|'def'
name|'oscar_09_03'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        BOS rights response\n        """'
newline|'\n'
name|'tlvs'
op|'='
name|'readTLVs'
op|'('
name|'snac'
op|'['
number|'3'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'maxPermitList'
op|'='
name|'tlvs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'maxDenyList'
op|'='
name|'tlvs'
op|'['
number|'2'
op|']'
newline|'\n'
nl|'\n'
DECL|member|oscar_0B_02
dedent|''
name|'def'
name|'oscar_0B_02'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        stats reporting interval\n        """'
newline|'\n'
name|'self'
op|'.'
name|'reportingInterval'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!H'"
op|','
name|'snac'
op|'['
number|'3'
op|']'
op|'['
op|':'
number|'2'
op|']'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
DECL|member|oscar_13_03
dedent|''
name|'def'
name|'oscar_13_03'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        SSI rights response\n        """'
newline|'\n'
comment|'#tlvs = readTLVs(snac[3])'
nl|'\n'
name|'pass'
comment|"# we don't know how to parse this"
newline|'\n'
nl|'\n'
comment|'# methods to be called by the client, and their support methods'
nl|'\n'
DECL|member|requestSelfInfo
dedent|''
name|'def'
name|'requestSelfInfo'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        ask for the OSCARUser for ourselves\n        """'
newline|'\n'
name|'d'
op|'='
name|'defer'
op|'.'
name|'Deferred'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x01'
op|','
number|'0x0E'
op|','
string|"''"
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbRequestSelfInfo'
op|','
name|'d'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|_cbRequestSelfInfo
dedent|''
name|'def'
name|'_cbRequestSelfInfo'
op|'('
name|'self'
op|','
name|'snac'
op|','
name|'d'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'.'
name|'callback'
op|'('
name|'self'
op|'.'
name|'parseUser'
op|'('
name|'snac'
op|'['
number|'5'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|initSSI
dedent|''
name|'def'
name|'initSSI'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        this sends the rate request for family 0x13 (Server Side Information)\n        so we can then use it\n        """'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x13'
op|','
number|'0x02'
op|','
string|"''"
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbInitSSI'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_cbInitSSI
dedent|''
name|'def'
name|'_cbInitSSI'
op|'('
name|'self'
op|','
name|'snac'
op|','
name|'d'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
op|'{'
op|'}'
comment|"# don't even bother parsing this"
newline|'\n'
nl|'\n'
DECL|member|requestSSI
dedent|''
name|'def'
name|'requestSSI'
op|'('
name|'self'
op|','
name|'timestamp'
op|'='
number|'0'
op|','
name|'revision'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        request the server side information\n        if the deferred gets None, it means the SSI is the same\n        """'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x13'
op|','
number|'0x05'
op|','
nl|'\n'
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!LH'"
op|','
name|'timestamp'
op|','
name|'revision'
op|')'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbRequestSSI'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_cbRequestSSI
dedent|''
name|'def'
name|'_cbRequestSSI'
op|'('
name|'self'
op|','
name|'snac'
op|','
name|'args'
op|'='
op|'('
op|')'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'snac'
op|'['
number|'1'
op|']'
op|'=='
number|'0x0f'
op|':'
comment|'# same SSI as we have'
newline|'\n'
indent|'            '
name|'return'
newline|'\n'
dedent|''
name|'itemdata'
op|'='
name|'snac'
op|'['
number|'5'
op|']'
op|'['
number|'3'
op|':'
op|']'
newline|'\n'
name|'if'
name|'args'
op|':'
newline|'\n'
indent|'            '
name|'revision'
op|','
name|'groups'
op|','
name|'permit'
op|','
name|'deny'
op|','
name|'permitMode'
op|','
name|'visibility'
op|'='
name|'args'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|','
name|'revision'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!BH'"
op|','
name|'snac'
op|'['
number|'5'
op|']'
op|'['
op|':'
number|'3'
op|']'
op|')'
newline|'\n'
name|'groups'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'permit'
op|'='
op|'['
op|']'
newline|'\n'
name|'deny'
op|'='
op|'['
op|']'
newline|'\n'
name|'permitMode'
op|'='
name|'None'
newline|'\n'
name|'visibility'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'while'
name|'len'
op|'('
name|'itemdata'
op|')'
op|'>'
number|'4'
op|':'
newline|'\n'
indent|'            '
name|'nameLength'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!H'"
op|','
name|'itemdata'
op|'['
op|':'
number|'2'
op|']'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'name'
op|'='
name|'itemdata'
op|'['
number|'2'
op|':'
number|'2'
op|'+'
name|'nameLength'
op|']'
newline|'\n'
name|'groupID'
op|','
name|'buddyID'
op|','
name|'itemType'
op|','
name|'restLength'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!4H'"
op|','
name|'itemdata'
op|'['
number|'2'
op|'+'
name|'nameLength'
op|':'
number|'10'
op|'+'
name|'nameLength'
op|']'
op|')'
newline|'\n'
name|'tlvs'
op|'='
name|'readTLVs'
op|'('
name|'itemdata'
op|'['
number|'10'
op|'+'
name|'nameLength'
op|':'
number|'10'
op|'+'
name|'nameLength'
op|'+'
name|'restLength'
op|']'
op|')'
newline|'\n'
name|'itemdata'
op|'='
name|'itemdata'
op|'['
number|'10'
op|'+'
name|'nameLength'
op|'+'
name|'restLength'
op|':'
op|']'
newline|'\n'
name|'if'
name|'itemType'
op|'=='
number|'0'
op|':'
comment|'# buddies'
newline|'\n'
indent|'                '
name|'groups'
op|'['
name|'groupID'
op|']'
op|'.'
name|'addUser'
op|'('
name|'buddyID'
op|','
name|'SSIBuddy'
op|'('
name|'name'
op|','
name|'tlvs'
op|')'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'itemType'
op|'=='
number|'1'
op|':'
comment|'# group'
newline|'\n'
indent|'                '
name|'g'
op|'='
name|'SSIGroup'
op|'('
name|'name'
op|','
name|'tlvs'
op|')'
newline|'\n'
name|'if'
name|'groups'
op|'.'
name|'has_key'
op|'('
number|'0'
op|')'
op|':'
name|'groups'
op|'['
number|'0'
op|']'
op|'.'
name|'addUser'
op|'('
name|'groupID'
op|','
name|'g'
op|')'
newline|'\n'
name|'groups'
op|'['
name|'groupID'
op|']'
op|'='
name|'g'
newline|'\n'
dedent|''
name|'elif'
name|'itemType'
op|'=='
number|'2'
op|':'
comment|'# permit'
newline|'\n'
indent|'                '
name|'permit'
op|'.'
name|'append'
op|'('
name|'name'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'itemType'
op|'=='
number|'3'
op|':'
comment|'# deny'
newline|'\n'
indent|'                '
name|'deny'
op|'.'
name|'append'
op|'('
name|'name'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'itemType'
op|'=='
number|'4'
op|':'
comment|'# permit deny info'
newline|'\n'
indent|'                '
name|'if'
name|'not'
name|'tlvs'
op|'.'
name|'has_key'
op|'('
number|'0xcb'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'continue'
comment|'# this happens with ICQ'
newline|'\n'
dedent|''
name|'permitMode'
op|'='
op|'{'
number|'1'
op|':'
string|"'permitall'"
op|','
number|'2'
op|':'
string|"'denyall'"
op|','
number|'3'
op|':'
string|"'permitsome'"
op|','
number|'4'
op|':'
string|"'denysome'"
op|','
number|'5'
op|':'
string|"'permitbuddies'"
op|'}'
op|'['
name|'ord'
op|'('
name|'tlvs'
op|'['
number|'0xca'
op|']'
op|')'
op|']'
newline|'\n'
name|'visibility'
op|'='
op|'{'
string|"'\\xff\\xff\\xff\\xff'"
op|':'
string|"'all'"
op|','
string|"'\\x00\\x00\\x00\\x04'"
op|':'
string|"'notaim'"
op|'}'
op|'['
name|'tlvs'
op|'['
number|'0xcb'
op|']'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'itemType'
op|'=='
number|'5'
op|':'
comment|'# unknown (perhaps idle data)?'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'log'
op|'.'
name|'msg'
op|'('
string|"'%s %s %s %s %s'"
op|'%'
op|'('
name|'name'
op|','
name|'groupID'
op|','
name|'buddyID'
op|','
name|'itemType'
op|','
name|'tlvs'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'timestamp'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!L'"
op|','
name|'itemdata'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'if'
name|'not'
name|'timestamp'
op|':'
comment|"# we've got more packets coming"
newline|'\n'
comment|'# which means add some deferred stuff'
nl|'\n'
indent|'            '
name|'d'
op|'='
name|'defer'
op|'.'
name|'Deferred'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'requestCallbacks'
op|'['
name|'snac'
op|'['
number|'4'
op|']'
op|']'
op|'='
name|'d'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbRequestSSI'
op|','
op|'('
name|'revision'
op|','
name|'groups'
op|','
name|'permit'
op|','
name|'deny'
op|','
name|'permitMode'
op|','
name|'visibility'
op|')'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
dedent|''
name|'return'
op|'('
name|'groups'
op|'['
number|'0'
op|']'
op|'.'
name|'users'
op|','
name|'permit'
op|','
name|'deny'
op|','
name|'permitMode'
op|','
name|'visibility'
op|','
name|'timestamp'
op|','
name|'revision'
op|')'
newline|'\n'
nl|'\n'
DECL|member|activateSSI
dedent|''
name|'def'
name|'activateSSI'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        active the data stored on the server (use buddy list, permit deny settings, etc.)\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x13'
op|','
number|'0x07'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
DECL|member|startModifySSI
dedent|''
name|'def'
name|'startModifySSI'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        tell the OSCAR server to be on the lookout for SSI modifications\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x13'
op|','
number|'0x11'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
DECL|member|addItemSSI
dedent|''
name|'def'
name|'addItemSSI'
op|'('
name|'self'
op|','
name|'item'
op|','
name|'groupID'
op|'='
name|'None'
op|','
name|'buddyID'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        add an item to the SSI server.  if buddyID == 0, then this should be a group.\n        this gets a callback when it\'s finished, but you can probably ignore it.\n        """'
newline|'\n'
name|'if'
name|'groupID'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'isinstance'
op|'('
name|'item'
op|','
name|'SSIGroup'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'groupID'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'groupID'
op|'='
name|'item'
op|'.'
name|'group'
op|'.'
name|'group'
op|'.'
name|'findIDFor'
op|'('
name|'item'
op|'.'
name|'group'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'buddyID'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'buddyID'
op|'='
name|'item'
op|'.'
name|'group'
op|'.'
name|'findIDFor'
op|'('
name|'item'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x13'
op|','
number|'0x08'
op|','
name|'item'
op|'.'
name|'oscarRep'
op|'('
name|'groupID'
op|','
name|'buddyID'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|modifyItemSSI
dedent|''
name|'def'
name|'modifyItemSSI'
op|'('
name|'self'
op|','
name|'item'
op|','
name|'groupID'
op|'='
name|'None'
op|','
name|'buddyID'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'groupID'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'isinstance'
op|'('
name|'item'
op|','
name|'SSIGroup'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'groupID'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'groupID'
op|'='
name|'item'
op|'.'
name|'group'
op|'.'
name|'group'
op|'.'
name|'findIDFor'
op|'('
name|'item'
op|'.'
name|'group'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'buddyID'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'buddyID'
op|'='
name|'item'
op|'.'
name|'group'
op|'.'
name|'findIDFor'
op|'('
name|'item'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x13'
op|','
number|'0x09'
op|','
name|'item'
op|'.'
name|'oscarRep'
op|'('
name|'groupID'
op|','
name|'buddyID'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|delItemSSI
dedent|''
name|'def'
name|'delItemSSI'
op|'('
name|'self'
op|','
name|'item'
op|','
name|'groupID'
op|'='
name|'None'
op|','
name|'buddyID'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'groupID'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'isinstance'
op|'('
name|'item'
op|','
name|'SSIGroup'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'groupID'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'groupID'
op|'='
name|'item'
op|'.'
name|'group'
op|'.'
name|'group'
op|'.'
name|'findIDFor'
op|'('
name|'item'
op|'.'
name|'group'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'buddyID'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'buddyID'
op|'='
name|'item'
op|'.'
name|'group'
op|'.'
name|'findIDFor'
op|'('
name|'item'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x13'
op|','
number|'0x0A'
op|','
name|'item'
op|'.'
name|'oscarRep'
op|'('
name|'groupID'
op|','
name|'buddyID'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|endModifySSI
dedent|''
name|'def'
name|'endModifySSI'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x13'
op|','
number|'0x12'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
DECL|member|setProfile
dedent|''
name|'def'
name|'setProfile'
op|'('
name|'self'
op|','
name|'profile'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        set the profile.\n        send None to not set a profile (different from \'\' for a blank one)\n        """'
newline|'\n'
name|'self'
op|'.'
name|'profile'
op|'='
name|'profile'
newline|'\n'
name|'tlvs'
op|'='
string|"''"
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'profile'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'tlvs'
op|'='
name|'TLV'
op|'('
number|'1'
op|','
string|'\'text/aolrtf; charset="us-ascii"\''
op|')'
op|'+'
name|'TLV'
op|'('
number|'2'
op|','
name|'self'
op|'.'
name|'profile'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'tlvs'
op|'='
name|'tlvs'
op|'+'
name|'TLV'
op|'('
number|'5'
op|','
string|"''"
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'capabilities'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x02'
op|','
number|'0x04'
op|','
name|'tlvs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|setAway
dedent|''
name|'def'
name|'setAway'
op|'('
name|'self'
op|','
name|'away'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        set the away message, or return (if away == None)\n        """'
newline|'\n'
name|'self'
op|'.'
name|'awayMessage'
op|'='
name|'away'
newline|'\n'
name|'tlvs'
op|'='
name|'TLV'
op|'('
number|'3'
op|','
string|'\'text/aolrtf; charset="us-ascii"\''
op|')'
op|'+'
name|'TLV'
op|'('
number|'4'
op|','
name|'away'
name|'or'
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x02'
op|','
number|'0x04'
op|','
name|'tlvs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|setIdleTime
dedent|''
name|'def'
name|'setIdleTime'
op|'('
name|'self'
op|','
name|'idleTime'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        set our idle time.  don\'t call more than once with a non-0 idle time.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x01'
op|','
number|'0x11'
op|','
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!L'"
op|','
name|'idleTime'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'def'
name|'sendMessage'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'message'
op|','
name|'wantAck'
op|'='
number|'0'
op|','
name|'autoResponse'
op|'='
number|'0'
op|','
name|'offline'
op|'='
number|'0'
op|')'
op|':'
comment|'#haveIcon = 0, ):'
newline|'\n'
indent|'        '
string|'"""\n        send a message to user (not an OSCARUseR).\n        message can be a string, or a multipart tuple.\n        if wantAck, we return a Deferred that gets a callback when the message is sent.\n        if autoResponse, this message is an autoResponse, as if from an away message.\n        if offline, this is an offline message (ICQ only, I think)\n        """'
newline|'\n'
name|'data'
op|'='
string|"''"
op|'.'
name|'join'
op|'('
op|'['
name|'chr'
op|'('
name|'random'
op|'.'
name|'randrange'
op|'('
number|'0'
op|','
number|'127'
op|')'
op|')'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'8'
op|')'
op|']'
op|')'
comment|'# cookie'
newline|'\n'
name|'data'
op|'='
name|'data'
op|'+'
string|"'\\x00\\x01'"
op|'+'
name|'chr'
op|'('
name|'len'
op|'('
name|'user'
op|')'
op|')'
op|'+'
name|'user'
newline|'\n'
name|'if'
name|'not'
name|'type'
op|'('
name|'message'
op|')'
name|'in'
op|'('
name|'types'
op|'.'
name|'TupleType'
op|','
name|'types'
op|'.'
name|'ListType'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'message'
op|'='
op|'['
op|'['
name|'message'
op|','
op|']'
op|']'
newline|'\n'
name|'if'
name|'type'
op|'('
name|'message'
op|'['
number|'0'
op|']'
op|'['
number|'0'
op|']'
op|')'
op|'=='
name|'types'
op|'.'
name|'UnicodeType'
op|':'
newline|'\n'
indent|'                '
name|'message'
op|'['
number|'0'
op|']'
op|'.'
name|'append'
op|'('
string|"'unicode'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'messageData'
op|'='
string|"''"
newline|'\n'
name|'for'
name|'part'
name|'in'
name|'message'
op|':'
newline|'\n'
indent|'            '
name|'charSet'
op|'='
number|'0'
newline|'\n'
name|'if'
string|"'unicode'"
name|'in'
name|'part'
op|'['
number|'1'
op|':'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'charSet'
op|'='
number|'2'
newline|'\n'
name|'part'
op|'['
number|'0'
op|']'
op|'='
name|'part'
op|'['
number|'0'
op|']'
op|'.'
name|'encode'
op|'('
string|"'utf-8'"
op|')'
newline|'\n'
dedent|''
name|'elif'
string|"'iso-8859-1'"
name|'in'
name|'part'
op|'['
number|'1'
op|':'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'charSet'
op|'='
number|'3'
newline|'\n'
name|'part'
op|'['
number|'0'
op|']'
op|'='
name|'part'
op|'['
number|'0'
op|']'
op|'.'
name|'encode'
op|'('
string|"'iso-8859-1'"
op|')'
newline|'\n'
dedent|''
name|'elif'
string|"'none'"
name|'in'
name|'part'
op|'['
number|'1'
op|':'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'charSet'
op|'='
number|'0xffff'
newline|'\n'
dedent|''
name|'if'
string|"'macintosh'"
name|'in'
name|'part'
op|'['
number|'1'
op|':'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'charSubSet'
op|'='
number|'0xb'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'charSubSet'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'messageData'
op|'='
name|'messageData'
op|'+'
string|"'\\x01\\x01'"
op|'+'
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!3H'"
op|','
name|'len'
op|'('
name|'part'
op|'['
number|'0'
op|']'
op|')'
op|'+'
number|'4'
op|','
name|'charSet'
op|','
name|'charSubSet'
op|')'
newline|'\n'
name|'messageData'
op|'='
name|'messageData'
op|'+'
name|'part'
op|'['
number|'0'
op|']'
newline|'\n'
dedent|''
name|'data'
op|'='
name|'data'
op|'+'
name|'TLV'
op|'('
number|'2'
op|','
string|"'\\x05\\x01\\x00\\x03\\x01\\x01\\x02'"
op|'+'
name|'messageData'
op|')'
newline|'\n'
name|'if'
name|'wantAck'
op|':'
newline|'\n'
indent|'            '
name|'data'
op|'='
name|'data'
op|'+'
name|'TLV'
op|'('
number|'3'
op|','
string|"''"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'autoResponse'
op|':'
newline|'\n'
indent|'            '
name|'data'
op|'='
name|'data'
op|'+'
name|'TLV'
op|'('
number|'4'
op|','
string|"''"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'offline'
op|':'
newline|'\n'
indent|'            '
name|'data'
op|'='
name|'data'
op|'+'
name|'TLV'
op|'('
number|'6'
op|','
string|"''"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'wantAck'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x04'
op|','
number|'0x06'
op|','
name|'data'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbSendMessageAck'
op|','
name|'user'
op|','
name|'message'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x04'
op|','
number|'0x06'
op|','
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_cbSendMessageAck
dedent|''
name|'def'
name|'_cbSendMessageAck'
op|'('
name|'self'
op|','
name|'snac'
op|','
name|'user'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'user'
op|','
name|'message'
newline|'\n'
nl|'\n'
DECL|member|connectService
dedent|''
name|'def'
name|'connectService'
op|'('
name|'self'
op|','
name|'service'
op|','
name|'wantCallback'
op|'='
number|'0'
op|','
name|'extraData'
op|'='
string|"''"
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        connect to another service\n        if wantCallback, we return a Deferred that gets called back when the service is online.\n        if extraData, append that to our request.\n        """'
newline|'\n'
name|'if'
name|'wantCallback'
op|':'
newline|'\n'
indent|'            '
name|'d'
op|'='
name|'defer'
op|'.'
name|'Deferred'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x01'
op|','
number|'0x04'
op|','
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!H'"
op|','
name|'service'
op|')'
op|'+'
name|'extraData'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbConnectService'
op|','
name|'d'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x01'
op|','
number|'0x04'
op|','
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!H'"
op|','
name|'service'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_cbConnectService
dedent|''
dedent|''
name|'def'
name|'_cbConnectService'
op|'('
name|'self'
op|','
name|'snac'
op|','
name|'d'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'oscar_01_05'
op|'('
name|'snac'
op|'['
number|'2'
op|':'
op|']'
op|','
name|'d'
op|')'
newline|'\n'
nl|'\n'
DECL|member|createChat
dedent|''
name|'def'
name|'createChat'
op|'('
name|'self'
op|','
name|'shortName'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        create a chat room\n        """'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'services'
op|'.'
name|'has_key'
op|'('
name|'SERVICE_CHATNAV'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'services'
op|'['
name|'SERVICE_CHATNAV'
op|']'
op|'.'
name|'createChat'
op|'('
name|'shortName'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'connectService'
op|'('
name|'SERVICE_CHATNAV'
op|','
number|'1'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'lambda'
name|'s'
op|':'
name|'s'
op|'.'
name|'createChat'
op|'('
name|'shortName'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|joinChat
dedent|''
dedent|''
name|'def'
name|'joinChat'
op|'('
name|'self'
op|','
name|'exchange'
op|','
name|'fullName'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        join a chat room\n        """'
newline|'\n'
comment|'#d = defer.Deferred()'
nl|'\n'
name|'return'
name|'self'
op|'.'
name|'connectService'
op|'('
number|'0x0e'
op|','
number|'1'
op|','
name|'TLV'
op|'('
number|'0x01'
op|','
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!HB'"
op|','
name|'exchange'
op|','
name|'len'
op|'('
name|'fullName'
op|')'
op|')'
op|'+'
name|'fullName'
op|'+'
nl|'\n'
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!H'"
op|','
name|'instance'
op|')'
op|')'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbJoinChat'
op|')'
comment|'#, d)'
newline|'\n'
comment|'#return d'
nl|'\n'
nl|'\n'
DECL|member|_cbJoinChat
dedent|''
name|'def'
name|'_cbJoinChat'
op|'('
name|'self'
op|','
name|'chat'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'del'
name|'self'
op|'.'
name|'services'
op|'['
name|'SERVICE_CHAT'
op|']'
newline|'\n'
name|'return'
name|'chat'
newline|'\n'
nl|'\n'
DECL|member|warnUser
dedent|''
name|'def'
name|'warnUser'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'anon'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x04'
op|','
number|'0x08'
op|','
string|"'\\x00'"
op|'+'
name|'chr'
op|'('
name|'anon'
op|')'
op|'+'
name|'chr'
op|'('
name|'len'
op|'('
name|'user'
op|')'
op|')'
op|'+'
name|'user'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbWarnUser'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_cbWarnUser
dedent|''
name|'def'
name|'_cbWarnUser'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'oldLevel'
op|','
name|'newLevel'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!2H'"
op|','
name|'snac'
op|'['
number|'5'
op|']'
op|')'
newline|'\n'
name|'return'
name|'oldLevel'
op|','
name|'newLevel'
newline|'\n'
nl|'\n'
DECL|member|getInfo
dedent|''
name|'def'
name|'getInfo'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
comment|'#if user.'
nl|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x02'
op|','
number|'0x05'
op|','
string|"'\\x00\\x01'"
op|'+'
name|'chr'
op|'('
name|'len'
op|'('
name|'user'
op|')'
op|')'
op|'+'
name|'user'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbGetInfo'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_cbGetInfo
dedent|''
name|'def'
name|'_cbGetInfo'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|','
name|'rest'
op|'='
name|'self'
op|'.'
name|'parseUser'
op|'('
name|'snac'
op|'['
number|'5'
op|']'
op|','
number|'1'
op|')'
newline|'\n'
name|'tlvs'
op|'='
name|'readTLVs'
op|'('
name|'rest'
op|')'
newline|'\n'
name|'return'
name|'tlvs'
op|'.'
name|'get'
op|'('
number|'0x02'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getAway
dedent|''
name|'def'
name|'getAway'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x02'
op|','
number|'0x05'
op|','
string|"'\\x00\\x03'"
op|'+'
name|'chr'
op|'('
name|'len'
op|'('
name|'user'
op|')'
op|')'
op|'+'
name|'user'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbGetAway'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_cbGetAway
dedent|''
name|'def'
name|'_cbGetAway'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|','
name|'rest'
op|'='
name|'self'
op|'.'
name|'parseUser'
op|'('
name|'snac'
op|'['
number|'5'
op|']'
op|','
number|'1'
op|')'
newline|'\n'
name|'tlvs'
op|'='
name|'readTLVs'
op|'('
name|'rest'
op|')'
newline|'\n'
name|'return'
name|'tlvs'
op|'.'
name|'get'
op|'('
number|'0x04'
op|','
name|'None'
op|')'
comment|'# return None if there is no away message'
newline|'\n'
nl|'\n'
comment|'#def acceptSendFileRequest(self,'
nl|'\n'
nl|'\n'
comment|'# methods to be overriden by the client'
nl|'\n'
DECL|member|initDone
dedent|''
name|'def'
name|'initDone'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when we get the rate information, which means we should do other init. stuff.\n        """'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
string|"'%s initDone'"
op|'%'
name|'self'
op|')'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|updateBuddy
dedent|''
name|'def'
name|'updateBuddy'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when a buddy changes status, with the OSCARUser for that buddy.\n        """'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
string|"'%s updateBuddy %s'"
op|'%'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|')'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|offlineBuddy
dedent|''
name|'def'
name|'offlineBuddy'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when a buddy goes offline\n        """'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
string|"'%s offlineBuddy %s'"
op|'%'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|')'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|receiveMessage
dedent|''
name|'def'
name|'receiveMessage'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'multiparts'
op|','
name|'flags'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when someone sends us a message\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|receiveWarning
dedent|''
name|'def'
name|'receiveWarning'
op|'('
name|'self'
op|','
name|'newLevel'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when someone warns us.\n        user is either None (if it was anonymous) or an OSCARUser\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|receiveChatInvite
dedent|''
name|'def'
name|'receiveChatInvite'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'message'
op|','
name|'exchange'
op|','
name|'fullName'
op|','
name|'instance'
op|','
name|'shortName'
op|','
name|'inviteTime'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when someone invites us to a chat room\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|chatReceiveMessage
dedent|''
name|'def'
name|'chatReceiveMessage'
op|'('
name|'self'
op|','
name|'chat'
op|','
name|'user'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when someone in a chatroom sends us a message in the chat\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|chatMemberJoined
dedent|''
name|'def'
name|'chatMemberJoined'
op|'('
name|'self'
op|','
name|'chat'
op|','
name|'member'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when a member joins the chat\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|chatMemberLeft
dedent|''
name|'def'
name|'chatMemberLeft'
op|'('
name|'self'
op|','
name|'chat'
op|','
name|'member'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when a member leaves the chat\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|receiveSendFileRequest
dedent|''
name|'def'
name|'receiveSendFileRequest'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'file'
op|','
name|'description'
op|','
name|'cookie'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        called when someone tries to send a file to us\n        """'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|class|OSCARService
dedent|''
dedent|''
name|'class'
name|'OSCARService'
op|'('
name|'SNACBased'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'bos'
op|','
name|'cookie'
op|','
name|'d'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'SNACBased'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
name|'cookie'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'bos'
op|'='
name|'bos'
newline|'\n'
name|'self'
op|'.'
name|'d'
op|'='
name|'d'
newline|'\n'
nl|'\n'
DECL|member|connectionLost
dedent|''
name|'def'
name|'connectionLost'
op|'('
name|'self'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'self'
op|'.'
name|'bos'
op|'.'
name|'services'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'v'
op|'=='
name|'self'
op|':'
newline|'\n'
indent|'                '
name|'del'
name|'self'
op|'.'
name|'bos'
op|'.'
name|'services'
op|'['
name|'k'
op|']'
newline|'\n'
name|'return'
newline|'\n'
nl|'\n'
DECL|member|clientReady
dedent|''
dedent|''
dedent|''
name|'def'
name|'clientReady'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'SNACBased'
op|'.'
name|'clientReady'
op|'('
name|'self'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'d'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'d'
op|'.'
name|'callback'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'d'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|class|ChatNavService
dedent|''
dedent|''
dedent|''
name|'class'
name|'ChatNavService'
op|'('
name|'OSCARService'
op|')'
op|':'
newline|'\n'
DECL|variable|snacFamilies
indent|'    '
name|'snacFamilies'
op|'='
op|'{'
nl|'\n'
number|'0x01'
op|':'
op|'('
number|'3'
op|','
number|'0x0010'
op|','
number|'0x059b'
op|')'
op|','
nl|'\n'
number|'0x0d'
op|':'
op|'('
number|'1'
op|','
number|'0x0010'
op|','
number|'0x059b'
op|')'
nl|'\n'
op|'}'
newline|'\n'
DECL|member|oscar_01_07
name|'def'
name|'oscar_01_07'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
comment|'# rate info'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x01'
op|','
number|'0x08'
op|','
string|"'\\000\\001\\000\\002\\000\\003\\000\\004\\000\\005'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendSNACnr'
op|'('
number|'0x0d'
op|','
number|'0x02'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
DECL|member|oscar_0D_09
dedent|''
name|'def'
name|'oscar_0D_09'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'clientReady'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|getChatInfo
dedent|''
name|'def'
name|'getChatInfo'
op|'('
name|'self'
op|','
name|'exchange'
op|','
name|'name'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'defer'
op|'.'
name|'Deferred'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x0d'
op|','
number|'0x04'
op|','
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!HB'"
op|','
name|'exchange'
op|','
name|'len'
op|'('
name|'name'
op|')'
op|')'
op|'+'
name|'name'
op|'+'
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'!HB'"
op|','
name|'instance'
op|','
number|'2'
op|')'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbGetChatInfo'
op|','
name|'d'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|_cbGetChatInfo
dedent|''
name|'def'
name|'_cbGetChatInfo'
op|'('
name|'self'
op|','
name|'snac'
op|','
name|'d'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'data'
op|'='
name|'snac'
op|'['
number|'5'
op|']'
op|'['
number|'4'
op|':'
op|']'
newline|'\n'
name|'exchange'
op|','
name|'length'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!HB'"
op|','
name|'data'
op|'['
op|':'
number|'3'
op|']'
op|')'
newline|'\n'
name|'fullName'
op|'='
name|'data'
op|'['
number|'3'
op|':'
number|'3'
op|'+'
name|'length'
op|']'
newline|'\n'
name|'instance'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!H'"
op|','
name|'data'
op|'['
number|'3'
op|'+'
name|'length'
op|':'
number|'5'
op|'+'
name|'length'
op|']'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'tlvs'
op|'='
name|'readTLVs'
op|'('
name|'data'
op|'['
number|'8'
op|'+'
name|'length'
op|':'
op|']'
op|')'
newline|'\n'
name|'shortName'
op|'='
name|'tlvs'
op|'['
number|'0x6a'
op|']'
newline|'\n'
name|'inviteTime'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!L'"
op|','
name|'tlvs'
op|'['
number|'0xca'
op|']'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'info'
op|'='
op|'('
name|'exchange'
op|','
name|'fullName'
op|','
name|'instance'
op|','
name|'shortName'
op|','
name|'inviteTime'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'callback'
op|'('
name|'info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|createChat
dedent|''
name|'def'
name|'createChat'
op|'('
name|'self'
op|','
name|'shortName'
op|')'
op|':'
newline|'\n'
comment|'#d = defer.Deferred()'
nl|'\n'
indent|'        '
name|'data'
op|'='
string|"'\\x00\\x04\\x06create\\xff\\xff\\x01\\x00\\x03'"
newline|'\n'
name|'data'
op|'='
name|'data'
op|'+'
name|'TLV'
op|'('
number|'0xd7'
op|','
string|"'en'"
op|')'
newline|'\n'
name|'data'
op|'='
name|'data'
op|'+'
name|'TLV'
op|'('
number|'0xd6'
op|','
string|"'us-ascii'"
op|')'
newline|'\n'
name|'data'
op|'='
name|'data'
op|'+'
name|'TLV'
op|'('
number|'0xd3'
op|','
name|'shortName'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x0d'
op|','
number|'0x08'
op|','
name|'data'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbCreateChat'
op|')'
newline|'\n'
comment|'#return d'
nl|'\n'
nl|'\n'
DECL|member|_cbCreateChat
dedent|''
name|'def'
name|'_cbCreateChat'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
comment|'#d):'
newline|'\n'
indent|'        '
name|'exchange'
op|','
name|'length'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!HB'"
op|','
name|'snac'
op|'['
number|'5'
op|']'
op|'['
number|'4'
op|':'
number|'7'
op|']'
op|')'
newline|'\n'
name|'fullName'
op|'='
name|'snac'
op|'['
number|'5'
op|']'
op|'['
number|'7'
op|':'
number|'7'
op|'+'
name|'length'
op|']'
newline|'\n'
name|'instance'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!H'"
op|','
name|'snac'
op|'['
number|'5'
op|']'
op|'['
number|'7'
op|'+'
name|'length'
op|':'
number|'9'
op|'+'
name|'length'
op|']'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
comment|'#d.callback((exchange, fullName, instance))'
nl|'\n'
name|'return'
name|'exchange'
op|','
name|'fullName'
op|','
name|'instance'
newline|'\n'
nl|'\n'
DECL|class|ChatService
dedent|''
dedent|''
name|'class'
name|'ChatService'
op|'('
name|'OSCARService'
op|')'
op|':'
newline|'\n'
DECL|variable|snacFamilies
indent|'    '
name|'snacFamilies'
op|'='
op|'{'
nl|'\n'
number|'0x01'
op|':'
op|'('
number|'3'
op|','
number|'0x0010'
op|','
number|'0x059b'
op|')'
op|','
nl|'\n'
number|'0x0E'
op|':'
op|'('
number|'1'
op|','
number|'0x0010'
op|','
number|'0x059b'
op|')'
nl|'\n'
op|'}'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'bos'
op|','
name|'cookie'
op|','
name|'d'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'OSCARService'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
name|'bos'
op|','
name|'cookie'
op|','
name|'d'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'exchange'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'fullName'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'instance'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'name'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'members'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|variable|clientReady
dedent|''
name|'clientReady'
op|'='
name|'SNACBased'
op|'.'
name|'clientReady'
comment|"# we'll do our own callback"
newline|'\n'
nl|'\n'
DECL|member|oscar_01_07
name|'def'
name|'oscar_01_07'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x01'
op|','
number|'0x08'
op|','
string|'"\\000\\001\\000\\002\\000\\003\\000\\004\\000\\005"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'clientReady'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|oscar_0E_02
dedent|''
name|'def'
name|'oscar_0E_02'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
comment|'#        try: # this is EVIL'
nl|'\n'
comment|'#            data = snac[3][4:]'
nl|'\n'
comment|"#            self.exchange, length = struct.unpack('!HB',data[:3])"
nl|'\n'
comment|'#            self.fullName = data[3:3+length]'
nl|'\n'
comment|"#            self.instance = struct.unpack('!H',data[3+length:5+length])[0]"
nl|'\n'
comment|'#            tlvs = readTLVs(data[8+length:])'
nl|'\n'
comment|'#            self.name = tlvs[0xd3]'
nl|'\n'
comment|'#            self.d.callback(self)'
nl|'\n'
comment|'#        except KeyError:'
nl|'\n'
indent|'        '
name|'data'
op|'='
name|'snac'
op|'['
number|'3'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'exchange'
op|','
name|'length'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!HB'"
op|','
name|'data'
op|'['
op|':'
number|'3'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'fullName'
op|'='
name|'data'
op|'['
number|'3'
op|':'
number|'3'
op|'+'
name|'length'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'instance'
op|'='
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'!H'"
op|','
name|'data'
op|'['
number|'3'
op|'+'
name|'length'
op|':'
number|'5'
op|'+'
name|'length'
op|']'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'tlvs'
op|'='
name|'readTLVs'
op|'('
name|'data'
op|'['
number|'8'
op|'+'
name|'length'
op|':'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'name'
op|'='
name|'tlvs'
op|'['
number|'0xd3'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'d'
op|'.'
name|'callback'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|oscar_0E_03
dedent|''
name|'def'
name|'oscar_0E_03'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'users'
op|'='
op|'['
op|']'
newline|'\n'
name|'rest'
op|'='
name|'snac'
op|'['
number|'3'
op|']'
newline|'\n'
name|'while'
name|'rest'
op|':'
newline|'\n'
indent|'            '
name|'user'
op|','
name|'rest'
op|'='
name|'self'
op|'.'
name|'bos'
op|'.'
name|'parseUser'
op|'('
name|'rest'
op|','
number|'1'
op|')'
newline|'\n'
name|'users'
op|'.'
name|'append'
op|'('
name|'user'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'self'
op|'.'
name|'fullName'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'members'
op|'='
name|'users'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'members'
op|'.'
name|'append'
op|'('
name|'users'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'bos'
op|'.'
name|'chatMemberJoined'
op|'('
name|'self'
op|','
name|'users'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|oscar_0E_04
dedent|''
dedent|''
name|'def'
name|'oscar_0E_04'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|'='
name|'self'
op|'.'
name|'bos'
op|'.'
name|'parseUser'
op|'('
name|'snac'
op|'['
number|'3'
op|']'
op|')'
newline|'\n'
name|'for'
name|'u'
name|'in'
name|'self'
op|'.'
name|'members'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'u'
op|'.'
name|'name'
op|'=='
name|'user'
op|'.'
name|'name'
op|':'
comment|'# same person!'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'members'
op|'.'
name|'remove'
op|'('
name|'u'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'bos'
op|'.'
name|'chatMemberLeft'
op|'('
name|'self'
op|','
name|'user'
op|')'
newline|'\n'
nl|'\n'
DECL|member|oscar_0E_06
dedent|''
name|'def'
name|'oscar_0E_06'
op|'('
name|'self'
op|','
name|'snac'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'data'
op|'='
name|'snac'
op|'['
number|'3'
op|']'
newline|'\n'
name|'user'
op|','
name|'rest'
op|'='
name|'self'
op|'.'
name|'bos'
op|'.'
name|'parseUser'
op|'('
name|'snac'
op|'['
number|'3'
op|']'
op|'['
number|'14'
op|':'
op|']'
op|','
number|'1'
op|')'
newline|'\n'
name|'tlvs'
op|'='
name|'readTLVs'
op|'('
name|'rest'
op|'['
number|'8'
op|':'
op|']'
op|')'
newline|'\n'
name|'message'
op|'='
name|'tlvs'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'bos'
op|'.'
name|'chatReceiveMessage'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'message'
op|')'
newline|'\n'
nl|'\n'
DECL|member|sendMessage
dedent|''
name|'def'
name|'sendMessage'
op|'('
name|'self'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'tlvs'
op|'='
name|'TLV'
op|'('
number|'0x02'
op|','
string|'"us-ascii"'
op|')'
op|'+'
name|'TLV'
op|'('
number|'0x03'
op|','
string|'"en"'
op|')'
op|'+'
name|'TLV'
op|'('
number|'0x01'
op|','
name|'message'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendSNAC'
op|'('
number|'0x0e'
op|','
number|'0x05'
op|','
nl|'\n'
string|'"\\x46\\x30\\x38\\x30\\x44\\x00\\x63\\x00\\x00\\x03\\x00\\x01\\x00\\x00\\x00\\x06\\x00\\x00\\x00\\x05"'
op|'+'
nl|'\n'
name|'struct'
op|'.'
name|'pack'
op|'('
string|'"!H"'
op|','
name|'len'
op|'('
name|'tlvs'
op|')'
op|')'
op|'+'
nl|'\n'
name|'tlvs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|leaveChat
dedent|''
name|'def'
name|'leaveChat'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'disconnect'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|class|OscarAuthenticator
dedent|''
dedent|''
name|'class'
name|'OscarAuthenticator'
op|'('
name|'OscarConnection'
op|')'
op|':'
newline|'\n'
DECL|variable|BOSClass
indent|'    '
name|'BOSClass'
op|'='
name|'BOSConnection'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'username'
op|','
name|'password'
op|','
name|'deferred'
op|'='
name|'None'
op|','
name|'icq'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'username'
op|'='
name|'username'
newline|'\n'
name|'self'
op|'.'
name|'password'
op|'='
name|'password'
newline|'\n'
name|'self'
op|'.'
name|'deferred'
op|'='
name|'deferred'
newline|'\n'
name|'self'
op|'.'
name|'icq'
op|'='
name|'icq'
comment|'# icq mode is disabled'
newline|'\n'
comment|'#if icq and self.BOSClass==BOSConnection:'
nl|'\n'
comment|'#    self.BOSClass=ICQConnection'
nl|'\n'
nl|'\n'
DECL|member|oscar_
dedent|''
name|'def'
name|'oscar_'
op|'('
name|'self'
op|','
name|'flap'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'icq'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendFLAP'
op|'('
string|'"\\000\\000\\000\\001"'
op|','
number|'0x01'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendFLAP'
op|'('
name|'SNAC'
op|'('
number|'0x17'
op|','
number|'0x06'
op|','
number|'0'
op|','
nl|'\n'
name|'TLV'
op|'('
name|'TLV_USERNAME'
op|','
name|'self'
op|'.'
name|'username'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x004B'
op|','
string|"''"
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'state'
op|'='
string|'"Key"'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'encpass'
op|'='
name|'encryptPasswordICQ'
op|'('
name|'self'
op|'.'
name|'password'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendFLAP'
op|'('
string|"'\\000\\000\\000\\001'"
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x01'
op|','
name|'self'
op|'.'
name|'username'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x02'
op|','
name|'encpass'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x03'
op|','
string|"'ICQ Inc. - Product of ICQ (TM).2001b.5.18.1.3659.85'"
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x16'
op|','
string|'"\\x01\\x0a"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x17'
op|','
string|'"\\x00\\x05"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x18'
op|','
string|'"\\x00\\x12"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x19'
op|','
string|'"\\000\\001"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x1a'
op|','
string|'"\\x0eK"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x14'
op|','
string|'"\\x00\\x00\\x00U"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x0f'
op|','
string|'"en"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x0e'
op|','
string|'"us"'
op|')'
op|','
number|'0x01'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'state'
op|'='
string|'"Cookie"'
newline|'\n'
nl|'\n'
DECL|member|oscar_Key
dedent|''
dedent|''
name|'def'
name|'oscar_Key'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'snac'
op|'='
name|'readSNAC'
op|'('
name|'data'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
name|'key'
op|'='
name|'snac'
op|'['
number|'5'
op|']'
op|'['
number|'2'
op|':'
op|']'
newline|'\n'
name|'encpass'
op|'='
name|'encryptPasswordMD5'
op|'('
name|'self'
op|'.'
name|'password'
op|','
name|'key'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sendFLAP'
op|'('
name|'SNAC'
op|'('
number|'0x17'
op|','
number|'0x02'
op|','
number|'0'
op|','
nl|'\n'
name|'TLV'
op|'('
name|'TLV_USERNAME'
op|','
name|'self'
op|'.'
name|'username'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
name|'TLV_PASSWORD'
op|','
name|'encpass'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x004C'
op|','
string|"''"
op|')'
op|'+'
comment|'# unknown'
nl|'\n'
name|'TLV'
op|'('
name|'TLV_CLIENTNAME'
op|','
string|'"AOL Instant Messenger (SM), version 4.8.2790/WIN32"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x0016'
op|','
string|'"\\x01\\x09"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
name|'TLV_CLIENTMAJOR'
op|','
string|'"\\000\\004"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
name|'TLV_CLIENTMINOR'
op|','
string|'"\\000\\010"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x0019'
op|','
string|'"\\000\\000"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
name|'TLV_CLIENTSUB'
op|','
string|'"\\x0A\\xE6"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
number|'0x0014'
op|','
string|'"\\x00\\x00\\x00\\xBB"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
name|'TLV_LANG'
op|','
string|'"en"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
name|'TLV_COUNTRY'
op|','
string|'"us"'
op|')'
op|'+'
nl|'\n'
name|'TLV'
op|'('
name|'TLV_USESSI'
op|','
string|'"\\001"'
op|')'
op|')'
op|')'
newline|'\n'
name|'return'
string|'"Cookie"'
newline|'\n'
nl|'\n'
DECL|member|oscar_Cookie
dedent|''
name|'def'
name|'oscar_Cookie'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'snac'
op|'='
name|'readSNAC'
op|'('
name|'data'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'icq'
op|':'
newline|'\n'
indent|'            '
name|'i'
op|'='
name|'snac'
op|'['
number|'5'
op|']'
op|'.'
name|'find'
op|'('
string|'"\\000"'
op|')'
newline|'\n'
name|'snac'
op|'['
number|'5'
op|']'
op|'='
name|'snac'
op|'['
number|'5'
op|']'
op|'['
name|'i'
op|':'
op|']'
newline|'\n'
dedent|''
name|'tlvs'
op|'='
name|'readTLVs'
op|'('
name|'snac'
op|'['
number|'5'
op|']'
op|')'
newline|'\n'
name|'if'
name|'tlvs'
op|'.'
name|'has_key'
op|'('
number|'6'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'cookie'
op|'='
name|'tlvs'
op|'['
number|'6'
op|']'
newline|'\n'
name|'server'
op|','
name|'port'
op|'='
name|'string'
op|'.'
name|'split'
op|'('
name|'tlvs'
op|'['
number|'5'
op|']'
op|','
string|'":"'
op|')'
newline|'\n'
name|'d'
op|'='
name|'self'
op|'.'
name|'connectToBOS'
op|'('
name|'server'
op|','
name|'int'
op|'('
name|'port'
op|')'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addErrback'
op|'('
name|'lambda'
name|'x'
op|':'
name|'log'
op|'.'
name|'msg'
op|'('
string|'"Connection Failed! Reason: %s"'
op|'%'
name|'x'
op|')'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'deferred'
op|':'
newline|'\n'
indent|'                '
name|'d'
op|'.'
name|'chainDeferred'
op|'('
name|'self'
op|'.'
name|'deferred'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'disconnect'
op|'('
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'tlvs'
op|'.'
name|'has_key'
op|'('
number|'8'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'errorcode'
op|'='
name|'tlvs'
op|'['
number|'8'
op|']'
newline|'\n'
name|'errorurl'
op|'='
name|'tlvs'
op|'['
number|'4'
op|']'
newline|'\n'
name|'if'
name|'errorcode'
op|'=='
string|"'\\000\\030'"
op|':'
newline|'\n'
indent|'                '
name|'error'
op|'='
string|'"You are attempting to sign on again too soon.  Please try again later."'
newline|'\n'
dedent|''
name|'elif'
name|'errorcode'
op|'=='
string|"'\\000\\005'"
op|':'
newline|'\n'
indent|'                '
name|'error'
op|'='
string|'"Invalid Username or Password."'
newline|'\n'
dedent|''
name|'else'
op|':'
name|'error'
op|'='
name|'repr'
op|'('
name|'errorcode'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'error'
op|'('
name|'error'
op|','
name|'errorurl'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'log'
op|'.'
name|'msg'
op|'('
string|"'hmm, weird tlvs for %s cookie packet'"
op|'%'
name|'str'
op|'('
name|'self'
op|')'
op|')'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
name|'tlvs'
op|')'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
string|"'snac'"
op|')'
newline|'\n'
name|'log'
op|'.'
name|'msg'
op|'('
name|'str'
op|'('
name|'snac'
op|')'
op|')'
newline|'\n'
dedent|''
name|'return'
string|'"None"'
newline|'\n'
nl|'\n'
DECL|member|oscar_None
dedent|''
name|'def'
name|'oscar_None'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|connectToBOS
name|'def'
name|'connectToBOS'
op|'('
name|'self'
op|','
name|'server'
op|','
name|'port'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'c'
op|'='
name|'protocol'
op|'.'
name|'ClientCreator'
op|'('
name|'reactor'
op|','
name|'self'
op|'.'
name|'BOSClass'
op|','
name|'self'
op|'.'
name|'username'
op|','
name|'self'
op|'.'
name|'cookie'
op|')'
newline|'\n'
name|'return'
name|'c'
op|'.'
name|'connectTCP'
op|'('
name|'server'
op|','
name|'int'
op|'('
name|'port'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|error
dedent|''
name|'def'
name|'error'
op|'('
name|'self'
op|','
name|'error'
op|','
name|'url'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'log'
op|'.'
name|'msg'
op|'('
string|'"ERROR! %s %s"'
op|'%'
op|'('
name|'error'
op|','
name|'url'
op|')'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'deferred'
op|':'
name|'self'
op|'.'
name|'deferred'
op|'.'
name|'errback'
op|'('
op|'('
name|'error'
op|','
name|'url'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|variable|FLAP_CHANNEL_NEW_CONNECTION
dedent|''
dedent|''
name|'FLAP_CHANNEL_NEW_CONNECTION'
op|'='
number|'0x01'
newline|'\n'
DECL|variable|FLAP_CHANNEL_DATA
name|'FLAP_CHANNEL_DATA'
op|'='
number|'0x02'
newline|'\n'
DECL|variable|FLAP_CHANNEL_ERROR
name|'FLAP_CHANNEL_ERROR'
op|'='
number|'0x03'
newline|'\n'
DECL|variable|FLAP_CHANNEL_CLOSE_CONNECTION
name|'FLAP_CHANNEL_CLOSE_CONNECTION'
op|'='
number|'0x04'
newline|'\n'
nl|'\n'
DECL|variable|SERVICE_CHATNAV
name|'SERVICE_CHATNAV'
op|'='
number|'0x0d'
newline|'\n'
DECL|variable|SERVICE_CHAT
name|'SERVICE_CHAT'
op|'='
number|'0x0e'
newline|'\n'
DECL|variable|serviceClasses
name|'serviceClasses'
op|'='
op|'{'
nl|'\n'
name|'SERVICE_CHATNAV'
op|':'
name|'ChatNavService'
op|','
nl|'\n'
name|'SERVICE_CHAT'
op|':'
name|'ChatService'
nl|'\n'
op|'}'
newline|'\n'
DECL|variable|TLV_USERNAME
name|'TLV_USERNAME'
op|'='
number|'0x0001'
newline|'\n'
DECL|variable|TLV_CLIENTNAME
name|'TLV_CLIENTNAME'
op|'='
number|'0x0003'
newline|'\n'
DECL|variable|TLV_COUNTRY
name|'TLV_COUNTRY'
op|'='
number|'0x000E'
newline|'\n'
DECL|variable|TLV_LANG
name|'TLV_LANG'
op|'='
number|'0x000F'
newline|'\n'
DECL|variable|TLV_CLIENTMAJOR
name|'TLV_CLIENTMAJOR'
op|'='
number|'0x0017'
newline|'\n'
DECL|variable|TLV_CLIENTMINOR
name|'TLV_CLIENTMINOR'
op|'='
number|'0x0018'
newline|'\n'
DECL|variable|TLV_CLIENTSUB
name|'TLV_CLIENTSUB'
op|'='
number|'0x001A'
newline|'\n'
DECL|variable|TLV_PASSWORD
name|'TLV_PASSWORD'
op|'='
number|'0x0025'
newline|'\n'
DECL|variable|TLV_USESSI
name|'TLV_USESSI'
op|'='
number|'0x004A'
newline|'\n'
nl|'\n'
DECL|variable|CAP_ICON
name|'CAP_ICON'
op|'='
string|'\'\\011F\\023FL\\177\\021\\321\\202"DEST\\000\\000\''
newline|'\n'
DECL|variable|CAP_VOICE
name|'CAP_VOICE'
op|'='
string|'\'\\011F\\023AL\\177\\021\\321\\202"DEST\\000\\000\''
newline|'\n'
DECL|variable|CAP_IMAGE
name|'CAP_IMAGE'
op|'='
string|'\'\\011F\\023EL\\177\\021\\321\\202"DEST\\000\\000\''
newline|'\n'
DECL|variable|CAP_CHAT
name|'CAP_CHAT'
op|'='
string|'\'t\\217$ b\\207\\021\\321\\202"DEST\\000\\000\''
newline|'\n'
DECL|variable|CAP_GET_FILE
name|'CAP_GET_FILE'
op|'='
string|'\'\\011F\\023HL\\177\\021\\321\\202"DEST\\000\\000\''
newline|'\n'
DECL|variable|CAP_SEND_FILE
name|'CAP_SEND_FILE'
op|'='
string|'\'\\011F\\023CL\\177\\021\\321\\202"DEST\\000\\000\''
newline|'\n'
DECL|variable|CAP_GAMES
name|'CAP_GAMES'
op|'='
string|'\'\\011F\\023GL\\177\\021\\321\\202"DEST\\000\\000\''
newline|'\n'
DECL|variable|CAP_SEND_LIST
name|'CAP_SEND_LIST'
op|'='
string|'\'\\011F\\023KL\\177\\021\\321\\202"DEST\\000\\000\''
newline|'\n'
DECL|variable|CAP_SERV_REL
name|'CAP_SERV_REL'
op|'='
string|'\'\\011F\\023IL\\177\\021\\321\\202"DEST\\000\\000\''
newline|'\n'
endmarker|''
end_unit
