begin_unit
comment|'# Copyright (c) 2001-2009 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
string|'"""\nTest cases for L{twisted.words.protocols.msn}.\n"""'
newline|'\n'
nl|'\n'
comment|'# System imports'
nl|'\n'
name|'import'
name|'StringIO'
newline|'\n'
nl|'\n'
comment|'# Twisted imports'
nl|'\n'
nl|'\n'
comment|'# t.w.p.msn requires an HTTP client'
nl|'\n'
name|'try'
op|':'
newline|'\n'
comment|'# So try to get one - do it directly instead of catching an ImportError'
nl|'\n'
comment|'# from t.w.p.msn so that other problems which cause that module to fail'
nl|'\n'
comment|"# to import don't cause the tests to be skipped."
nl|'\n'
indent|'    '
name|'from'
name|'twisted'
op|'.'
name|'web'
name|'import'
name|'client'
newline|'\n'
dedent|''
name|'except'
name|'ImportError'
op|':'
newline|'\n'
comment|"# If there isn't one, we're going to skip all the tests."
nl|'\n'
DECL|variable|msn
indent|'    '
name|'msn'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# Otherwise importing it should work, so do it.'
nl|'\n'
indent|'    '
name|'from'
name|'twisted'
op|'.'
name|'words'
op|'.'
name|'protocols'
name|'import'
name|'msn'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
name|'from'
name|'twisted'
op|'.'
name|'python'
op|'.'
name|'hashlib'
name|'import'
name|'md5'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'protocols'
name|'import'
name|'loopback'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
op|'.'
name|'defer'
name|'import'
name|'Deferred'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'trial'
name|'import'
name|'unittest'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'test'
op|'.'
name|'proto_helpers'
name|'import'
name|'StringTransport'
op|','
name|'StringIOWithoutClosing'
newline|'\n'
nl|'\n'
DECL|function|printError
name|'def'
name|'printError'
op|'('
name|'f'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'print'
name|'f'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|PassportTests
dedent|''
name|'class'
name|'PassportTests'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'result'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'deferred'
op|'='
name|'Deferred'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'deferred'
op|'.'
name|'addCallback'
op|'('
name|'lambda'
name|'r'
op|':'
name|'self'
op|'.'
name|'result'
op|'.'
name|'append'
op|'('
name|'r'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'deferred'
op|'.'
name|'addErrback'
op|'('
name|'printError'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_nexus
dedent|''
name|'def'
name|'test_nexus'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        When L{msn.PassportNexus} receives enough information to identify the\n        address of the login server, it fires the L{Deferred} passed to its\n        initializer with that address.\n        """'
newline|'\n'
name|'protocol'
op|'='
name|'msn'
op|'.'
name|'PassportNexus'
op|'('
name|'self'
op|'.'
name|'deferred'
op|','
string|"'https://foobar.com/somepage.quux'"
op|')'
newline|'\n'
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/html'"
op|','
nl|'\n'
string|"'PassportURLs'"
op|':'
string|"'DARealm=Passport.Net,DALogin=login.myserver.com/,DAReg=reg.myserver.com'"
nl|'\n'
op|'}'
newline|'\n'
name|'transport'
op|'='
name|'StringTransport'
op|'('
op|')'
newline|'\n'
name|'protocol'
op|'.'
name|'makeConnection'
op|'('
name|'transport'
op|')'
newline|'\n'
name|'protocol'
op|'.'
name|'dataReceived'
op|'('
string|"'HTTP/1.0 200 OK\\r\\n'"
op|')'
newline|'\n'
name|'for'
op|'('
name|'h'
op|','
name|'v'
op|')'
name|'in'
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'protocol'
op|'.'
name|'dataReceived'
op|'('
string|"'%s: %s\\r\\n'"
op|'%'
op|'('
name|'h'
op|','
name|'v'
op|')'
op|')'
newline|'\n'
dedent|''
name|'protocol'
op|'.'
name|'dataReceived'
op|'('
string|"'\\r\\n'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'result'
op|'['
number|'0'
op|']'
op|','
string|'"https://login.myserver.com/"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|_doLoginTest
dedent|''
name|'def'
name|'_doLoginTest'
op|'('
name|'self'
op|','
name|'response'
op|','
name|'headers'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'protocol'
op|'='
name|'msn'
op|'.'
name|'PassportLogin'
op|'('
name|'self'
op|'.'
name|'deferred'
op|','
string|"'foo@foo.com'"
op|','
string|"'testpass'"
op|','
string|"'https://foo.com/'"
op|','
string|"'a'"
op|')'
newline|'\n'
name|'protocol'
op|'.'
name|'makeConnection'
op|'('
name|'StringTransport'
op|'('
op|')'
op|')'
newline|'\n'
name|'protocol'
op|'.'
name|'dataReceived'
op|'('
name|'response'
op|')'
newline|'\n'
name|'for'
op|'('
name|'h'
op|','
name|'v'
op|')'
name|'in'
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|':'
name|'protocol'
op|'.'
name|'dataReceived'
op|'('
string|"'%s: %s\\r\\n'"
op|'%'
op|'('
name|'h'
op|','
name|'v'
op|')'
op|')'
newline|'\n'
name|'protocol'
op|'.'
name|'dataReceived'
op|'('
string|"'\\r\\n'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testPassportLoginSuccess
dedent|''
name|'def'
name|'testPassportLoginSuccess'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'Content-Length'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/html'"
op|','
nl|'\n'
string|"'Authentication-Info'"
op|':'
string|'"Passport1.4 da-status=success,tname=MSPAuth,"'
op|'+'
nl|'\n'
string|'"tname=MSPProf,tname=MSPSec,from-PP=\'somekey\',"'
op|'+'
nl|'\n'
string|'"ru=http://messenger.msn.com"'
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_doLoginTest'
op|'('
string|"'HTTP/1.1 200 OK\\r\\n'"
op|','
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'self'
op|'.'
name|'result'
op|'['
number|'0'
op|']'
op|'=='
op|'('
name|'msn'
op|'.'
name|'LOGIN_SUCCESS'
op|','
string|"'somekey'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testPassportLoginFailure
dedent|''
name|'def'
name|'testPassportLoginFailure'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/html'"
op|','
nl|'\n'
string|"'WWW-Authenticate'"
op|':'
string|"'Passport1.4 da-status=failed,'"
op|'+'
nl|'\n'
string|"'srealm=Passport.NET,ts=-3,prompt,cburl=http://host.com,'"
op|'+'
nl|'\n'
string|"'cbtxt=the%20error%20message'"
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_doLoginTest'
op|'('
string|"'HTTP/1.1 401 Unauthorized\\r\\n'"
op|','
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'self'
op|'.'
name|'result'
op|'['
number|'0'
op|']'
op|'=='
op|'('
name|'msn'
op|'.'
name|'LOGIN_FAILURE'
op|','
string|"'the error message'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testPassportLoginRedirect
dedent|''
name|'def'
name|'testPassportLoginRedirect'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'headers'
op|'='
op|'{'
nl|'\n'
string|"'Content-Type'"
op|':'
string|"'text/html'"
op|','
nl|'\n'
string|"'Authentication-Info'"
op|':'
string|"'Passport1.4 da-status=redir'"
op|','
nl|'\n'
string|"'Location'"
op|':'
string|"'https://newlogin.host.com/'"
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_doLoginTest'
op|'('
string|"'HTTP/1.1 302 Found\\r\\n'"
op|','
name|'headers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'self'
op|'.'
name|'result'
op|'['
number|'0'
op|']'
op|'=='
op|'('
name|'msn'
op|'.'
name|'LOGIN_REDIRECT'
op|','
string|"'https://newlogin.host.com/'"
op|','
string|"'a'"
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'msn'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
DECL|class|DummySwitchboardClient
indent|'    '
name|'class'
name|'DummySwitchboardClient'
op|'('
name|'msn'
op|'.'
name|'SwitchboardClient'
op|')'
op|':'
newline|'\n'
DECL|member|userTyping
indent|'        '
name|'def'
name|'userTyping'
op|'('
name|'self'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'state'
op|'='
string|"'TYPING'"
newline|'\n'
nl|'\n'
DECL|member|gotSendRequest
dedent|''
name|'def'
name|'gotSendRequest'
op|'('
name|'self'
op|','
name|'fileName'
op|','
name|'fileSize'
op|','
name|'cookie'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'fileName'
op|'=='
string|"'foobar.ext'"
name|'and'
name|'fileSize'
op|'=='
number|'31337'
name|'and'
name|'cookie'
op|'=='
number|'1234'
op|':'
name|'self'
op|'.'
name|'state'
op|'='
string|"'INVITATION'"
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|DummyNotificationClient
dedent|''
dedent|''
name|'class'
name|'DummyNotificationClient'
op|'('
name|'msn'
op|'.'
name|'NotificationClient'
op|')'
op|':'
newline|'\n'
DECL|member|loggedIn
indent|'        '
name|'def'
name|'loggedIn'
op|'('
name|'self'
op|','
name|'userHandle'
op|','
name|'screenName'
op|','
name|'verified'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'userHandle'
op|'=='
string|"'foo@bar.com'"
name|'and'
name|'screenName'
op|'=='
string|"'Test Screen Name'"
name|'and'
name|'verified'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'state'
op|'='
string|"'LOGIN'"
newline|'\n'
nl|'\n'
DECL|member|gotProfile
dedent|''
dedent|''
name|'def'
name|'gotProfile'
op|'('
name|'self'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'state'
op|'='
string|"'PROFILE'"
newline|'\n'
nl|'\n'
DECL|member|gotContactStatus
dedent|''
name|'def'
name|'gotContactStatus'
op|'('
name|'self'
op|','
name|'code'
op|','
name|'userHandle'
op|','
name|'screenName'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'code'
op|'=='
name|'msn'
op|'.'
name|'STATUS_AWAY'
name|'and'
name|'userHandle'
op|'=='
string|'"foo@bar.com"'
name|'and'
name|'screenName'
op|'=='
string|'"Test Screen Name"'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'state'
op|'='
string|"'INITSTATUS'"
newline|'\n'
nl|'\n'
DECL|member|contactStatusChanged
dedent|''
dedent|''
name|'def'
name|'contactStatusChanged'
op|'('
name|'self'
op|','
name|'code'
op|','
name|'userHandle'
op|','
name|'screenName'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'code'
op|'=='
name|'msn'
op|'.'
name|'STATUS_LUNCH'
name|'and'
name|'userHandle'
op|'=='
string|'"foo@bar.com"'
name|'and'
name|'screenName'
op|'=='
string|'"Test Name"'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'state'
op|'='
string|"'NEWSTATUS'"
newline|'\n'
nl|'\n'
DECL|member|contactOffline
dedent|''
dedent|''
name|'def'
name|'contactOffline'
op|'('
name|'self'
op|','
name|'userHandle'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'userHandle'
op|'=='
string|'"foo@bar.com"'
op|':'
name|'self'
op|'.'
name|'state'
op|'='
string|"'OFFLINE'"
newline|'\n'
nl|'\n'
DECL|member|statusChanged
dedent|''
name|'def'
name|'statusChanged'
op|'('
name|'self'
op|','
name|'code'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'code'
op|'=='
name|'msn'
op|'.'
name|'STATUS_HIDDEN'
op|':'
name|'self'
op|'.'
name|'state'
op|'='
string|"'MYSTATUS'"
newline|'\n'
nl|'\n'
DECL|member|listSynchronized
dedent|''
name|'def'
name|'listSynchronized'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'state'
op|'='
string|"'GOTLIST'"
newline|'\n'
nl|'\n'
DECL|member|gotPhoneNumber
dedent|''
name|'def'
name|'gotPhoneNumber'
op|'('
name|'self'
op|','
name|'listVersion'
op|','
name|'userHandle'
op|','
name|'phoneType'
op|','
name|'number'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'msn'
op|'.'
name|'NotificationClient'
op|'.'
name|'gotPhoneNumber'
op|'('
name|'self'
op|','
name|'listVersion'
op|','
name|'userHandle'
op|','
name|'phoneType'
op|','
name|'number'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'state'
op|'='
string|"'GOTPHONE'"
newline|'\n'
nl|'\n'
DECL|member|userRemovedMe
dedent|''
name|'def'
name|'userRemovedMe'
op|'('
name|'self'
op|','
name|'userHandle'
op|','
name|'listVersion'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'msn'
op|'.'
name|'NotificationClient'
op|'.'
name|'userRemovedMe'
op|'('
name|'self'
op|','
name|'userHandle'
op|','
name|'listVersion'
op|')'
newline|'\n'
name|'c'
op|'='
name|'self'
op|'.'
name|'factory'
op|'.'
name|'contacts'
op|'.'
name|'getContact'
op|'('
name|'userHandle'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'c'
name|'and'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'contacts'
op|'.'
name|'version'
op|'=='
name|'listVersion'
op|':'
name|'self'
op|'.'
name|'state'
op|'='
string|"'USERREMOVEDME'"
newline|'\n'
nl|'\n'
DECL|member|userAddedMe
dedent|''
name|'def'
name|'userAddedMe'
op|'('
name|'self'
op|','
name|'userHandle'
op|','
name|'screenName'
op|','
name|'listVersion'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'msn'
op|'.'
name|'NotificationClient'
op|'.'
name|'userAddedMe'
op|'('
name|'self'
op|','
name|'userHandle'
op|','
name|'screenName'
op|','
name|'listVersion'
op|')'
newline|'\n'
name|'c'
op|'='
name|'self'
op|'.'
name|'factory'
op|'.'
name|'contacts'
op|'.'
name|'getContact'
op|'('
name|'userHandle'
op|')'
newline|'\n'
name|'if'
name|'c'
name|'and'
op|'('
name|'c'
op|'.'
name|'lists'
op|'|'
name|'msn'
op|'.'
name|'REVERSE_LIST'
op|')'
name|'and'
op|'('
name|'self'
op|'.'
name|'factory'
op|'.'
name|'contacts'
op|'.'
name|'version'
op|'=='
name|'listVersion'
op|')'
name|'and'
op|'('
name|'screenName'
op|'=='
string|"'Screen Name'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'state'
op|'='
string|"'USERADDEDME'"
newline|'\n'
nl|'\n'
DECL|member|gotSwitchboardInvitation
dedent|''
dedent|''
name|'def'
name|'gotSwitchboardInvitation'
op|'('
name|'self'
op|','
name|'sessionID'
op|','
name|'host'
op|','
name|'port'
op|','
name|'key'
op|','
name|'userHandle'
op|','
name|'screenName'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'sessionID'
op|'=='
number|'1234'
name|'and'
name|'host'
op|'=='
string|"'192.168.1.1'"
name|'and'
name|'port'
op|'=='
number|'1863'
name|'and'
name|'key'
op|'=='
string|"'123.456'"
name|'and'
name|'userHandle'
op|'=='
string|"'foo@foo.com'"
name|'and'
name|'screenName'
op|'=='
string|"'Screen Name'"
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'state'
op|'='
string|"'SBINVITED'"
newline|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
DECL|class|DispatchTests
dedent|''
dedent|''
dedent|''
dedent|''
name|'class'
name|'DispatchTests'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    Tests for L{DispatchClient}.\n    """'
newline|'\n'
DECL|member|_versionTest
name|'def'
name|'_versionTest'
op|'('
name|'self'
op|','
name|'serverVersionResponse'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Test L{DispatchClient} version negotiation.\n        """'
newline|'\n'
name|'client'
op|'='
name|'msn'
op|'.'
name|'DispatchClient'
op|'('
op|')'
newline|'\n'
name|'client'
op|'.'
name|'userHandle'
op|'='
string|'"foo"'
newline|'\n'
nl|'\n'
name|'transport'
op|'='
name|'StringTransport'
op|'('
op|')'
newline|'\n'
name|'client'
op|'.'
name|'makeConnection'
op|'('
name|'transport'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
nl|'\n'
name|'transport'
op|'.'
name|'value'
op|'('
op|')'
op|','
string|'"VER 1 MSNP8 CVR0\\r\\n"'
op|')'
newline|'\n'
name|'transport'
op|'.'
name|'clear'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'client'
op|'.'
name|'dataReceived'
op|'('
name|'serverVersionResponse'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
nl|'\n'
name|'transport'
op|'.'
name|'value'
op|'('
op|')'
op|','
nl|'\n'
string|'"CVR 2 0x0409 win 4.10 i386 MSNMSGR 5.0.0544 MSMSGS foo\\r\\n"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_version
dedent|''
name|'def'
name|'test_version'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        L{DispatchClient.connectionMade} greets the server with a I{VER}\n        (version) message and then L{NotificationClient.dataReceived}\n        handles the server\'s I{VER} response by sending a I{CVR} (client\n        version) message.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'_versionTest'
op|'('
string|'"VER 1 MSNP8 CVR0\\r\\n"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_versionWithoutCVR0
dedent|''
name|'def'
name|'test_versionWithoutCVR0'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        If the server responds to a I{VER} command without including the\n        I{CVR0} protocol, L{DispatchClient} behaves in the same way as if\n        that protocol were included.\n\n        Starting in August 2008, CVR0 disappeared from the I{VER} response.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'_versionTest'
op|'('
string|'"VER 1 MSNP8\\r\\n"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
DECL|class|NotificationTests
dedent|''
dedent|''
name|'class'
name|'NotificationTests'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'""" testing the various events in NotificationClient """'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'client'
op|'='
name|'DummyNotificationClient'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'factory'
op|'='
name|'msn'
op|'.'
name|'NotificationFactory'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'='
string|"'START'"
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'client'
op|'='
name|'None'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|_versionTest
dedent|''
name|'def'
name|'_versionTest'
op|'('
name|'self'
op|','
name|'serverVersionResponse'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Test L{NotificationClient} version negotiation.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'factory'
op|'.'
name|'userHandle'
op|'='
string|'"foo"'
newline|'\n'
nl|'\n'
name|'transport'
op|'='
name|'StringTransport'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'makeConnection'
op|'('
name|'transport'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
nl|'\n'
name|'transport'
op|'.'
name|'value'
op|'('
op|')'
op|','
string|'"VER 1 MSNP8 CVR0\\r\\n"'
op|')'
newline|'\n'
name|'transport'
op|'.'
name|'clear'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'dataReceived'
op|'('
name|'serverVersionResponse'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
nl|'\n'
name|'transport'
op|'.'
name|'value'
op|'('
op|')'
op|','
nl|'\n'
string|'"CVR 2 0x0409 win 4.10 i386 MSNMSGR 5.0.0544 MSMSGS foo\\r\\n"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_version
dedent|''
name|'def'
name|'test_version'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        L{NotificationClient.connectionMade} greets the server with a I{VER}\n        (version) message and then L{NotificationClient.dataReceived}\n        handles the server\'s I{VER} response by sending a I{CVR} (client\n        version) message.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'_versionTest'
op|'('
string|'"VER 1 MSNP8 CVR0\\r\\n"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_versionWithoutCVR0
dedent|''
name|'def'
name|'test_versionWithoutCVR0'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        If the server responds to a I{VER} command without including the\n        I{CVR0} protocol, L{NotificationClient} behaves in the same way as\n        if that protocol were included.\n\n        Starting in August 2008, CVR0 disappeared from the I{VER} response.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'_versionTest'
op|'('
string|'"VER 1 MSNP8\\r\\n"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_challenge
dedent|''
name|'def'
name|'test_challenge'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        L{NotificationClient} responds to a I{CHL} message by sending a I{QRY}\n        back which included a hash based on the parameters of the I{CHL}.\n        """'
newline|'\n'
name|'transport'
op|'='
name|'StringTransport'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'makeConnection'
op|'('
name|'transport'
op|')'
newline|'\n'
name|'transport'
op|'.'
name|'clear'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'challenge'
op|'='
string|'"15570131571988941333"'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'dataReceived'
op|'('
string|"'CHL 0 '"
op|'+'
name|'challenge'
op|'+'
string|"'\\r\\n'"
op|')'
newline|'\n'
comment|'# md5 of the challenge and a magic string defined by the protocol'
nl|'\n'
name|'response'
op|'='
string|'"8f2f5a91b72102cd28355e9fc9000d6e"'
newline|'\n'
comment|'# Sanity check - the response is what the comment above says it is.'
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
nl|'\n'
name|'response'
op|','
name|'md5'
op|'('
name|'challenge'
op|'+'
string|'"Q1P7W2E4J9R8U3S5"'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
nl|'\n'
name|'transport'
op|'.'
name|'value'
op|'('
op|')'
op|','
nl|'\n'
comment|'# 2 is the next transaction identifier.  32 is the length of the'
nl|'\n'
comment|'# response.'
nl|'\n'
string|'"QRY 2 msmsgs@msnmsgr.com 32\\r\\n"'
op|'+'
name|'response'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testLogin
dedent|''
name|'def'
name|'testLogin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'client'
op|'.'
name|'lineReceived'
op|'('
string|"'USR 1 OK foo@bar.com Test%20Screen%20Name 1 0'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'=='
string|"'LOGIN'"
op|')'
op|','
name|'msg'
op|'='
string|"'Failed to detect successful login'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testProfile
dedent|''
name|'def'
name|'testProfile'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'m'
op|'='
string|"'MSG Hotmail Hotmail 353\\r\\nMIME-Version: 1.0\\r\\nContent-Type: text/x-msmsgsprofile; charset=UTF-8\\r\\n'"
newline|'\n'
name|'m'
op|'+='
string|"'LoginTime: 1016941010\\r\\nEmailEnabled: 1\\r\\nMemberIdHigh: 40000\\r\\nMemberIdLow: -600000000\\r\\nlang_preference: 1033\\r\\n'"
newline|'\n'
name|'m'
op|'+='
string|"'preferredEmail: foo@bar.com\\r\\ncountry: AU\\r\\nPostalCode: 90210\\r\\nGender: M\\r\\nKid: 0\\r\\nAge:\\r\\nsid: 400\\r\\n'"
newline|'\n'
name|'m'
op|'+='
string|"'kv: 2\\r\\nMSPAuth: 2CACCBCCADMoV8ORoz64BVwmjtksIg!kmR!Rj5tBBqEaW9hc4YnPHSOQ$$\\r\\n\\r\\n'"
newline|'\n'
name|'map'
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'lineReceived'
op|','
name|'m'
op|'.'
name|'split'
op|'('
string|"'\\r\\n'"
op|')'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'=='
string|"'PROFILE'"
op|')'
op|','
name|'msg'
op|'='
string|"'Failed to detect initial profile'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testStatus
dedent|''
name|'def'
name|'testStatus'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'t'
op|'='
op|'['
op|'('
string|"'ILN 1 AWY foo@bar.com Test%20Screen%20Name 0'"
op|','
string|"'INITSTATUS'"
op|','
string|"'Failed to detect initial status report'"
op|')'
op|','
nl|'\n'
op|'('
string|"'NLN LUN foo@bar.com Test%20Name 0'"
op|','
string|"'NEWSTATUS'"
op|','
string|"'Failed to detect contact status change'"
op|')'
op|','
nl|'\n'
op|'('
string|"'FLN foo@bar.com'"
op|','
string|"'OFFLINE'"
op|','
string|"'Failed to detect contact signing off'"
op|')'
op|','
nl|'\n'
op|'('
string|"'CHG 1 HDN 0'"
op|','
string|"'MYSTATUS'"
op|','
string|"'Failed to detect my status changing'"
op|')'
op|']'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'t'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'client'
op|'.'
name|'lineReceived'
op|'('
name|'i'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'=='
name|'i'
op|'['
number|'1'
op|']'
op|')'
op|','
name|'msg'
op|'='
name|'i'
op|'['
number|'2'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testListSync
dedent|''
dedent|''
name|'def'
name|'testListSync'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# currently this test does not take into account the fact'
nl|'\n'
comment|'# that BPRs sent as part of the SYN reply may not be interpreted'
nl|'\n'
comment|'# as such if they are for the last LST -- maybe I should'
nl|'\n'
comment|'# factor this in later.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'client'
op|'.'
name|'makeConnection'
op|'('
name|'StringTransport'
op|'('
op|')'
op|')'
newline|'\n'
name|'msn'
op|'.'
name|'NotificationClient'
op|'.'
name|'loggedIn'
op|'('
name|'self'
op|'.'
name|'client'
op|','
string|"'foo@foo.com'"
op|','
string|"'foobar'"
op|','
number|'1'
op|')'
newline|'\n'
name|'lines'
op|'='
op|'['
nl|'\n'
string|'"SYN %s 100 1 1"'
op|'%'
name|'self'
op|'.'
name|'client'
op|'.'
name|'currentID'
op|','
nl|'\n'
string|'"GTC A"'
op|','
nl|'\n'
string|'"BLP AL"'
op|','
nl|'\n'
string|'"LSG 0 Other%20Contacts 0"'
op|','
nl|'\n'
string|'"LST userHandle@email.com Some%20Name 11 0"'
nl|'\n'
op|']'
newline|'\n'
name|'map'
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'lineReceived'
op|','
name|'lines'
op|')'
newline|'\n'
name|'contacts'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'factory'
op|'.'
name|'contacts'
newline|'\n'
name|'contact'
op|'='
name|'contacts'
op|'.'
name|'getContact'
op|'('
string|"'userHandle@email.com'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'contacts'
op|'.'
name|'version'
op|'=='
number|'100'
op|','
string|'"Invalid contact list version"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'contact'
op|'.'
name|'screenName'
op|'=='
string|"'Some Name'"
op|','
string|'"Invalid screen-name for user"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'contacts'
op|'.'
name|'groups'
op|'=='
op|'{'
number|'0'
op|':'
string|"'Other Contacts'"
op|'}'
op|','
string|'"Did not get proper group list"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'contact'
op|'.'
name|'groups'
op|'=='
op|'['
number|'0'
op|']'
name|'and'
name|'contact'
op|'.'
name|'lists'
op|'=='
number|'11'
op|','
string|'"Invalid contact list/group info"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'=='
string|"'GOTLIST'"
op|','
string|'"Failed to call list sync handler"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testAsyncPhoneChange
dedent|''
name|'def'
name|'testAsyncPhoneChange'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'c'
op|'='
name|'msn'
op|'.'
name|'MSNContact'
op|'('
name|'userHandle'
op|'='
string|"'userHandle@email.com'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'factory'
op|'.'
name|'contacts'
op|'='
name|'msn'
op|'.'
name|'MSNContactList'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'factory'
op|'.'
name|'contacts'
op|'.'
name|'addContact'
op|'('
name|'c'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'makeConnection'
op|'('
name|'StringTransport'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'lineReceived'
op|'('
string|'"BPR 101 userHandle@email.com PHH 123%20456"'
op|')'
newline|'\n'
name|'c'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'factory'
op|'.'
name|'contacts'
op|'.'
name|'getContact'
op|'('
string|"'userHandle@email.com'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'=='
string|"'GOTPHONE'"
op|','
string|'"Did not fire phone change callback"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'c'
op|'.'
name|'homePhone'
op|'=='
string|"'123 456'"
op|','
string|'"Did not update the contact\'s phone number"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'factory'
op|'.'
name|'contacts'
op|'.'
name|'version'
op|'=='
number|'101'
op|','
string|'"Did not update list version"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testLateBPR
dedent|''
name|'def'
name|'testLateBPR'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        This test makes sure that if a BPR response that was meant\n        to be part of a SYN response (but came after the last LST)\n        is received, the correct contact is updated and all is well\n        """'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'makeConnection'
op|'('
name|'StringTransport'
op|'('
op|')'
op|')'
newline|'\n'
name|'msn'
op|'.'
name|'NotificationClient'
op|'.'
name|'loggedIn'
op|'('
name|'self'
op|'.'
name|'client'
op|','
string|"'foo@foo.com'"
op|','
string|"'foo'"
op|','
number|'1'
op|')'
newline|'\n'
name|'lines'
op|'='
op|'['
nl|'\n'
string|'"SYN %s 100 1 1"'
op|'%'
name|'self'
op|'.'
name|'client'
op|'.'
name|'currentID'
op|','
nl|'\n'
string|'"GTC A"'
op|','
nl|'\n'
string|'"BLP AL"'
op|','
nl|'\n'
string|'"LSG 0 Other%20Contacts 0"'
op|','
nl|'\n'
string|'"LST userHandle@email.com Some%20Name 11 0"'
op|','
nl|'\n'
string|'"BPR PHH 123%20456"'
nl|'\n'
op|']'
newline|'\n'
name|'map'
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'lineReceived'
op|','
name|'lines'
op|')'
newline|'\n'
name|'contact'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'factory'
op|'.'
name|'contacts'
op|'.'
name|'getContact'
op|'('
string|"'userHandle@email.com'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'contact'
op|'.'
name|'homePhone'
op|'=='
string|"'123 456'"
op|','
string|'"Did not update contact\'s phone number"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testUserRemovedMe
dedent|''
name|'def'
name|'testUserRemovedMe'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'client'
op|'.'
name|'factory'
op|'.'
name|'contacts'
op|'='
name|'msn'
op|'.'
name|'MSNContactList'
op|'('
op|')'
newline|'\n'
name|'contact'
op|'='
name|'msn'
op|'.'
name|'MSNContact'
op|'('
name|'userHandle'
op|'='
string|"'foo@foo.com'"
op|')'
newline|'\n'
name|'contact'
op|'.'
name|'addToList'
op|'('
name|'msn'
op|'.'
name|'REVERSE_LIST'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'factory'
op|'.'
name|'contacts'
op|'.'
name|'addContact'
op|'('
name|'contact'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'lineReceived'
op|'('
string|'"REM 0 RL 100 foo@foo.com"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'=='
string|"'USERREMOVEDME'"
op|','
string|'"Failed to remove user from reverse list"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testUserAddedMe
dedent|''
name|'def'
name|'testUserAddedMe'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'client'
op|'.'
name|'factory'
op|'.'
name|'contacts'
op|'='
name|'msn'
op|'.'
name|'MSNContactList'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'lineReceived'
op|'('
string|'"ADD 0 RL 100 foo@foo.com Screen%20Name"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'=='
string|"'USERADDEDME'"
op|','
string|'"Failed to add user to reverse lise"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testAsyncSwitchboardInvitation
dedent|''
name|'def'
name|'testAsyncSwitchboardInvitation'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'client'
op|'.'
name|'lineReceived'
op|'('
string|'"RNG 1234 192.168.1.1:1863 CKI 123.456 foo@foo.com Screen%20Name"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'=='
string|'"SBINVITED"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testCommandFailed
dedent|''
name|'def'
name|'testCommandFailed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Ensures that error responses from the server fires an errback with\n        MSNCommandFailed.\n        """'
newline|'\n'
name|'id'
op|','
name|'d'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'_createIDMapping'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'lineReceived'
op|'('
string|'"201 %s"'
op|'%'
name|'id'
op|')'
newline|'\n'
name|'d'
op|'='
name|'self'
op|'.'
name|'assertFailure'
op|'('
name|'d'
op|','
name|'msn'
op|'.'
name|'MSNCommandFailed'
op|')'
newline|'\n'
DECL|function|assertErrorCode
name|'def'
name|'assertErrorCode'
op|'('
name|'exception'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'201'
op|','
name|'exception'
op|'.'
name|'errorCode'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'assertErrorCode'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|MessageHandlingTests
dedent|''
dedent|''
name|'class'
name|'MessageHandlingTests'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'""" testing various message handling methods from SwichboardClient """'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'client'
op|'='
name|'DummySwitchboardClient'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'='
string|"'START'"
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'client'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|testClientCapabilitiesCheck
dedent|''
name|'def'
name|'testClientCapabilitiesCheck'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'m'
op|'='
name|'msn'
op|'.'
name|'MSNMessage'
op|'('
op|')'
newline|'\n'
name|'m'
op|'.'
name|'setHeader'
op|'('
string|"'Content-Type'"
op|','
string|"'text/x-clientcaps'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'checkMessage'
op|'('
name|'m'
op|')'
op|','
number|'0'
op|','
string|"'Failed to detect client capability message'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testTypingCheck
dedent|''
name|'def'
name|'testTypingCheck'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'m'
op|'='
name|'msn'
op|'.'
name|'MSNMessage'
op|'('
op|')'
newline|'\n'
name|'m'
op|'.'
name|'setHeader'
op|'('
string|"'Content-Type'"
op|','
string|"'text/x-msmsgscontrol'"
op|')'
newline|'\n'
name|'m'
op|'.'
name|'setHeader'
op|'('
string|"'TypingUser'"
op|','
string|"'foo@bar'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'checkMessage'
op|'('
name|'m'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'=='
string|"'TYPING'"
op|')'
op|','
name|'msg'
op|'='
string|"'Failed to detect typing notification'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testFileInvitation
dedent|''
name|'def'
name|'testFileInvitation'
op|'('
name|'self'
op|','
name|'lazyClient'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'m'
op|'='
name|'msn'
op|'.'
name|'MSNMessage'
op|'('
op|')'
newline|'\n'
name|'m'
op|'.'
name|'setHeader'
op|'('
string|"'Content-Type'"
op|','
string|"'text/x-msmsgsinvite; charset=UTF-8'"
op|')'
newline|'\n'
name|'m'
op|'.'
name|'message'
op|'+='
string|"'Application-Name: File Transfer\\r\\n'"
newline|'\n'
name|'if'
name|'not'
name|'lazyClient'
op|':'
newline|'\n'
indent|'            '
name|'m'
op|'.'
name|'message'
op|'+='
string|"'Application-GUID: {5D3E02AB-6190-11d3-BBBB-00C04F795683}\\r\\n'"
newline|'\n'
dedent|''
name|'m'
op|'.'
name|'message'
op|'+='
string|"'Invitation-Command: Invite\\r\\n'"
newline|'\n'
name|'m'
op|'.'
name|'message'
op|'+='
string|"'Invitation-Cookie: 1234\\r\\n'"
newline|'\n'
name|'m'
op|'.'
name|'message'
op|'+='
string|"'Application-File: foobar.ext\\r\\n'"
newline|'\n'
name|'m'
op|'.'
name|'message'
op|'+='
string|"'Application-FileSize: 31337\\r\\n\\r\\n'"
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'checkMessage'
op|'('
name|'m'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'=='
string|"'INVITATION'"
op|')'
op|','
name|'msg'
op|'='
string|"'Failed to detect file transfer invitation'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testFileInvitationMissingGUID
dedent|''
name|'def'
name|'testFileInvitationMissingGUID'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'testFileInvitation'
op|'('
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testFileResponse
dedent|''
name|'def'
name|'testFileResponse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'Deferred'
op|'('
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'fileResponse'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'cookies'
op|'['
string|"'iCookies'"
op|']'
op|'['
number|'1234'
op|']'
op|'='
op|'('
name|'d'
op|','
name|'None'
op|')'
newline|'\n'
name|'m'
op|'='
name|'msn'
op|'.'
name|'MSNMessage'
op|'('
op|')'
newline|'\n'
name|'m'
op|'.'
name|'setHeader'
op|'('
string|"'Content-Type'"
op|','
string|"'text/x-msmsgsinvite; charset=UTF-8'"
op|')'
newline|'\n'
name|'m'
op|'.'
name|'message'
op|'+='
string|"'Invitation-Command: ACCEPT\\r\\n'"
newline|'\n'
name|'m'
op|'.'
name|'message'
op|'+='
string|"'Invitation-Cookie: 1234\\r\\n\\r\\n'"
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'checkMessage'
op|'('
name|'m'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'=='
string|"'RESPONSE'"
op|')'
op|','
name|'msg'
op|'='
string|"'Failed to detect file transfer response'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testFileInfo
dedent|''
name|'def'
name|'testFileInfo'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'Deferred'
op|'('
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'fileInfo'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'cookies'
op|'['
string|"'external'"
op|']'
op|'['
number|'1234'
op|']'
op|'='
op|'('
name|'d'
op|','
name|'None'
op|')'
newline|'\n'
name|'m'
op|'='
name|'msn'
op|'.'
name|'MSNMessage'
op|'('
op|')'
newline|'\n'
name|'m'
op|'.'
name|'setHeader'
op|'('
string|"'Content-Type'"
op|','
string|"'text/x-msmsgsinvite; charset=UTF-8'"
op|')'
newline|'\n'
name|'m'
op|'.'
name|'message'
op|'+='
string|"'Invitation-Command: ACCEPT\\r\\n'"
newline|'\n'
name|'m'
op|'.'
name|'message'
op|'+='
string|"'Invitation-Cookie: 1234\\r\\n'"
newline|'\n'
name|'m'
op|'.'
name|'message'
op|'+='
string|"'IP-Address: 192.168.0.1\\r\\n'"
newline|'\n'
name|'m'
op|'.'
name|'message'
op|'+='
string|"'Port: 6891\\r\\n'"
newline|'\n'
name|'m'
op|'.'
name|'message'
op|'+='
string|"'AuthCookie: 4321\\r\\n\\r\\n'"
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'checkMessage'
op|'('
name|'m'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
op|'('
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'=='
string|"'INFO'"
op|')'
op|','
name|'msg'
op|'='
string|"'Failed to detect file transfer info'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|fileResponse
dedent|''
name|'def'
name|'fileResponse'
op|'('
name|'self'
op|','
op|'('
name|'accept'
op|','
name|'cookie'
op|','
name|'info'
op|')'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'accept'
name|'and'
name|'cookie'
op|'=='
number|'1234'
op|':'
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'='
string|"'RESPONSE'"
newline|'\n'
nl|'\n'
DECL|member|fileInfo
dedent|''
name|'def'
name|'fileInfo'
op|'('
name|'self'
op|','
op|'('
name|'accept'
op|','
name|'ip'
op|','
name|'port'
op|','
name|'aCookie'
op|','
name|'info'
op|')'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'accept'
name|'and'
name|'ip'
op|'=='
string|"'192.168.0.1'"
name|'and'
name|'port'
op|'=='
number|'6891'
name|'and'
name|'aCookie'
op|'=='
number|'4321'
op|':'
name|'self'
op|'.'
name|'client'
op|'.'
name|'state'
op|'='
string|"'INFO'"
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FileTransferTestCase
dedent|''
dedent|''
name|'class'
name|'FileTransferTestCase'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    test FileSend against FileReceive\n    """'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'input'
op|'='
string|"'a'"
op|'*'
number|'7000'
newline|'\n'
name|'self'
op|'.'
name|'output'
op|'='
name|'StringIOWithoutClosing'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'input'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'output'
op|'='
name|'None'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_fileTransfer
dedent|''
name|'def'
name|'test_fileTransfer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Test L{FileSend} against L{FileReceive} using a loopback transport.\n        """'
newline|'\n'
name|'auth'
op|'='
number|'1234'
newline|'\n'
name|'sender'
op|'='
name|'msn'
op|'.'
name|'FileSend'
op|'('
name|'StringIO'
op|'.'
name|'StringIO'
op|'('
name|'self'
op|'.'
name|'input'
op|')'
op|')'
newline|'\n'
name|'sender'
op|'.'
name|'auth'
op|'='
name|'auth'
newline|'\n'
name|'sender'
op|'.'
name|'fileSize'
op|'='
number|'7000'
newline|'\n'
name|'client'
op|'='
name|'msn'
op|'.'
name|'FileReceive'
op|'('
name|'auth'
op|','
string|'"foo@bar.com"'
op|','
name|'self'
op|'.'
name|'output'
op|')'
newline|'\n'
name|'client'
op|'.'
name|'fileSize'
op|'='
number|'7000'
newline|'\n'
DECL|function|check
name|'def'
name|'check'
op|'('
name|'ignored'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
name|'client'
op|'.'
name|'completed'
name|'and'
name|'sender'
op|'.'
name|'completed'
op|','
nl|'\n'
name|'msg'
op|'='
string|'"send failed to complete"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'input'
op|','
name|'self'
op|'.'
name|'output'
op|'.'
name|'getvalue'
op|'('
op|')'
op|','
nl|'\n'
name|'msg'
op|'='
string|'"saved file does not match original"'
op|')'
newline|'\n'
dedent|''
name|'d'
op|'='
name|'loopback'
op|'.'
name|'loopbackAsync'
op|'('
name|'sender'
op|','
name|'client'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'check'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'msn'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'    '
name|'for'
name|'testClass'
name|'in'
op|'['
name|'PassportTests'
op|','
name|'NotificationTests'
op|','
nl|'\n'
name|'MessageHandlingTests'
op|','
name|'FileTransferTestCase'
op|']'
op|':'
newline|'\n'
indent|'        '
name|'testClass'
op|'.'
name|'skip'
op|'='
op|'('
nl|'\n'
string|'"MSN requires an HTTP client but none is available, "'
nl|'\n'
string|'"skipping tests."'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
