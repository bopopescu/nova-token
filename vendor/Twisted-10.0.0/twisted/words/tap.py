begin_unit
comment|'# -*- test-case-name: twisted.words.test.test_tap -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2005 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
string|'"""\nShiny new words service maker\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'sys'
op|','
name|'socket'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'application'
name|'import'
name|'strports'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'application'
op|'.'
name|'service'
name|'import'
name|'MultiService'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'usage'
newline|'\n'
name|'from'
name|'twisted'
name|'import'
name|'plugin'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'words'
name|'import'
name|'iwords'
op|','
name|'service'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'cred'
name|'import'
name|'checkers'
op|','
name|'credentials'
op|','
name|'portal'
op|','
name|'strcred'
newline|'\n'
nl|'\n'
DECL|class|Options
name|'class'
name|'Options'
op|'('
name|'usage'
op|'.'
name|'Options'
op|','
name|'strcred'
op|'.'
name|'AuthOptionMixin'
op|')'
op|':'
newline|'\n'
DECL|variable|supportedInterfaces
indent|'    '
name|'supportedInterfaces'
op|'='
op|'['
name|'credentials'
op|'.'
name|'IUsernamePassword'
op|']'
newline|'\n'
DECL|variable|optParameters
name|'optParameters'
op|'='
op|'['
nl|'\n'
op|'('
string|"'hostname'"
op|','
name|'None'
op|','
name|'socket'
op|'.'
name|'gethostname'
op|'('
op|')'
op|','
nl|'\n'
string|"'Name of this server; purely an informative'"
op|')'
op|']'
newline|'\n'
nl|'\n'
DECL|variable|interfacePlugins
name|'interfacePlugins'
op|'='
op|'{'
op|'}'
newline|'\n'
DECL|variable|plg
name|'plg'
op|'='
name|'None'
newline|'\n'
name|'for'
name|'plg'
name|'in'
name|'plugin'
op|'.'
name|'getPlugins'
op|'('
name|'iwords'
op|'.'
name|'IProtocolPlugin'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'assert'
name|'plg'
op|'.'
name|'name'
name|'not'
name|'in'
name|'interfacePlugins'
newline|'\n'
name|'interfacePlugins'
op|'['
name|'plg'
op|'.'
name|'name'
op|']'
op|'='
name|'plg'
newline|'\n'
name|'optParameters'
op|'.'
name|'append'
op|'('
op|'('
nl|'\n'
name|'plg'
op|'.'
name|'name'
op|'+'
string|"'-port'"
op|','
nl|'\n'
name|'None'
op|','
name|'None'
op|','
nl|'\n'
string|"'strports description of the port to bind for the  '"
op|'+'
name|'plg'
op|'.'
name|'name'
op|'+'
string|"' server'"
op|')'
op|')'
newline|'\n'
dedent|''
name|'del'
name|'plg'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'usage'
op|'.'
name|'Options'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'a'
op|','
op|'**'
name|'kw'
op|')'
newline|'\n'
name|'self'
op|'['
string|"'groups'"
op|']'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|member|opt_group
dedent|''
name|'def'
name|'opt_group'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Specify a group which should exist\n        """'
newline|'\n'
name|'self'
op|'['
string|"'groups'"
op|']'
op|'.'
name|'append'
op|'('
name|'name'
op|'.'
name|'decode'
op|'('
name|'sys'
op|'.'
name|'stdin'
op|'.'
name|'encoding'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|opt_passwd
dedent|''
name|'def'
name|'opt_passwd'
op|'('
name|'self'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Name of a passwd-style file. (This is for\n        backwards-compatibility only; you should use the --auth\n        command instead.)\n        """'
newline|'\n'
name|'self'
op|'.'
name|'addChecker'
op|'('
name|'checkers'
op|'.'
name|'FilePasswordDB'
op|'('
name|'filename'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|makeService
dedent|''
dedent|''
name|'def'
name|'makeService'
op|'('
name|'config'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'credCheckers'
op|'='
name|'config'
op|'.'
name|'get'
op|'('
string|"'credCheckers'"
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'wordsRealm'
op|'='
name|'service'
op|'.'
name|'InMemoryWordsRealm'
op|'('
name|'config'
op|'['
string|"'hostname'"
op|']'
op|')'
newline|'\n'
name|'wordsPortal'
op|'='
name|'portal'
op|'.'
name|'Portal'
op|'('
name|'wordsRealm'
op|','
name|'credCheckers'
op|')'
newline|'\n'
nl|'\n'
name|'msvc'
op|'='
name|'MultiService'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# XXX Attribute lookup on config is kind of bad - hrm.'
nl|'\n'
name|'for'
name|'plgName'
name|'in'
name|'config'
op|'.'
name|'interfacePlugins'
op|':'
newline|'\n'
indent|'        '
name|'port'
op|'='
name|'config'
op|'.'
name|'get'
op|'('
name|'plgName'
op|'+'
string|"'-port'"
op|')'
newline|'\n'
name|'if'
name|'port'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'factory'
op|'='
name|'config'
op|'.'
name|'interfacePlugins'
op|'['
name|'plgName'
op|']'
op|'.'
name|'getFactory'
op|'('
name|'wordsRealm'
op|','
name|'wordsPortal'
op|')'
newline|'\n'
name|'svc'
op|'='
name|'strports'
op|'.'
name|'service'
op|'('
name|'port'
op|','
name|'factory'
op|')'
newline|'\n'
name|'svc'
op|'.'
name|'setServiceParent'
op|'('
name|'msvc'
op|')'
newline|'\n'
nl|'\n'
comment|'# This is bogus.  createGroup is async.  makeService must be'
nl|'\n'
comment|'# allowed to return a Deferred or some crap.'
nl|'\n'
dedent|''
dedent|''
name|'for'
name|'g'
name|'in'
name|'config'
op|'['
string|"'groups'"
op|']'
op|':'
newline|'\n'
indent|'        '
name|'wordsRealm'
op|'.'
name|'createGroup'
op|'('
name|'g'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'msvc'
newline|'\n'
dedent|''
endmarker|''
end_unit
