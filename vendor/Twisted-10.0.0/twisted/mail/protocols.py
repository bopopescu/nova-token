begin_unit
comment|'# -*- test-case-name: twisted.mail.test.test_mail -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
string|'"""Protocol support for twisted.mail."""'
newline|'\n'
nl|'\n'
comment|'# twisted imports'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'mail'
name|'import'
name|'pop3'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'mail'
name|'import'
name|'smtp'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'protocol'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'defer'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'copyright'
name|'import'
name|'longversion'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'log'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
name|'import'
name|'cred'
newline|'\n'
name|'import'
name|'twisted'
op|'.'
name|'cred'
op|'.'
name|'error'
newline|'\n'
name|'import'
name|'twisted'
op|'.'
name|'cred'
op|'.'
name|'credentials'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'mail'
name|'import'
name|'relay'
newline|'\n'
nl|'\n'
name|'from'
name|'zope'
op|'.'
name|'interface'
name|'import'
name|'implements'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|DomainDeliveryBase
name|'class'
name|'DomainDeliveryBase'
op|':'
newline|'\n'
indent|'    '
string|'"""A server that uses twisted.mail service\'s domains."""'
newline|'\n'
nl|'\n'
name|'implements'
op|'('
name|'smtp'
op|'.'
name|'IMessageDelivery'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|service
name|'service'
op|'='
name|'None'
newline|'\n'
DECL|variable|protocolName
name|'protocolName'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'service'
op|','
name|'user'
op|','
name|'host'
op|'='
name|'smtp'
op|'.'
name|'DNSNAME'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'service'
op|'='
name|'service'
newline|'\n'
name|'self'
op|'.'
name|'user'
op|'='
name|'user'
newline|'\n'
name|'self'
op|'.'
name|'host'
op|'='
name|'host'
newline|'\n'
nl|'\n'
DECL|member|receivedHeader
dedent|''
name|'def'
name|'receivedHeader'
op|'('
name|'self'
op|','
name|'helo'
op|','
name|'origin'
op|','
name|'recipients'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'authStr'
op|'='
name|'heloStr'
op|'='
string|'""'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'user'
op|':'
newline|'\n'
indent|'            '
name|'authStr'
op|'='
string|'" auth=%s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'user'
op|'.'
name|'encode'
op|'('
string|"'xtext'"
op|')'
op|','
op|')'
newline|'\n'
dedent|''
name|'if'
name|'helo'
op|'['
number|'0'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'heloStr'
op|'='
string|'" helo=%s"'
op|'%'
op|'('
name|'helo'
op|'['
number|'0'
op|']'
op|','
op|')'
newline|'\n'
dedent|''
name|'from_'
op|'='
string|'"from %s ([%s]%s%s)"'
op|'%'
op|'('
name|'helo'
op|'['
number|'0'
op|']'
op|','
name|'helo'
op|'['
number|'1'
op|']'
op|','
name|'heloStr'
op|','
name|'authStr'
op|')'
newline|'\n'
name|'by'
op|'='
string|'"by %s with %s (%s)"'
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'host'
op|','
name|'self'
op|'.'
name|'protocolName'
op|','
name|'longversion'
nl|'\n'
op|')'
newline|'\n'
name|'for_'
op|'='
string|'"for <%s>; %s"'
op|'%'
op|'('
string|"' '"
op|'.'
name|'join'
op|'('
name|'map'
op|'('
name|'str'
op|','
name|'recipients'
op|')'
op|')'
op|','
name|'smtp'
op|'.'
name|'rfc822date'
op|'('
op|')'
op|')'
newline|'\n'
name|'return'
string|'"Received: %s\\n\\t%s\\n\\t%s"'
op|'%'
op|'('
name|'from_'
op|','
name|'by'
op|','
name|'for_'
op|')'
newline|'\n'
nl|'\n'
DECL|member|validateTo
dedent|''
name|'def'
name|'validateTo'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
comment|'# XXX - Yick.  This needs cleaning up.'
nl|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'user'
name|'and'
name|'self'
op|'.'
name|'service'
op|'.'
name|'queue'
op|':'
newline|'\n'
indent|'            '
name|'d'
op|'='
name|'self'
op|'.'
name|'service'
op|'.'
name|'domains'
op|'.'
name|'get'
op|'('
name|'user'
op|'.'
name|'dest'
op|'.'
name|'domain'
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'d'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'d'
op|'='
name|'relay'
op|'.'
name|'DomainQueuer'
op|'('
name|'self'
op|'.'
name|'service'
op|','
name|'True'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'d'
op|'='
name|'self'
op|'.'
name|'service'
op|'.'
name|'domains'
op|'['
name|'user'
op|'.'
name|'dest'
op|'.'
name|'domain'
op|']'
newline|'\n'
dedent|''
name|'return'
name|'defer'
op|'.'
name|'maybeDeferred'
op|'('
name|'d'
op|'.'
name|'exists'
op|','
name|'user'
op|')'
newline|'\n'
nl|'\n'
DECL|member|validateFrom
dedent|''
name|'def'
name|'validateFrom'
op|'('
name|'self'
op|','
name|'helo'
op|','
name|'origin'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'helo'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'smtp'
op|'.'
name|'SMTPBadSender'
op|'('
name|'origin'
op|','
number|'503'
op|','
string|'"Who are you?  Say HELO first."'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'origin'
op|'.'
name|'local'
op|'!='
string|"''"
name|'and'
name|'origin'
op|'.'
name|'domain'
op|'=='
string|"''"
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'smtp'
op|'.'
name|'SMTPBadSender'
op|'('
name|'origin'
op|','
number|'501'
op|','
string|'"Sender address must contain domain."'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'origin'
newline|'\n'
nl|'\n'
DECL|member|startMessage
dedent|''
name|'def'
name|'startMessage'
op|'('
name|'self'
op|','
name|'users'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ret'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'user'
name|'in'
name|'users'
op|':'
newline|'\n'
indent|'            '
name|'ret'
op|'.'
name|'append'
op|'('
name|'self'
op|'.'
name|'service'
op|'.'
name|'domains'
op|'['
name|'user'
op|'.'
name|'dest'
op|'.'
name|'domain'
op|']'
op|'.'
name|'startMessage'
op|'('
name|'user'
op|')'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'ret'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SMTPDomainDelivery
dedent|''
dedent|''
name|'class'
name|'SMTPDomainDelivery'
op|'('
name|'DomainDeliveryBase'
op|')'
op|':'
newline|'\n'
DECL|variable|protocolName
indent|'    '
name|'protocolName'
op|'='
string|"'smtp'"
newline|'\n'
nl|'\n'
DECL|class|ESMTPDomainDelivery
dedent|''
name|'class'
name|'ESMTPDomainDelivery'
op|'('
name|'DomainDeliveryBase'
op|')'
op|':'
newline|'\n'
DECL|variable|protocolName
indent|'    '
name|'protocolName'
op|'='
string|"'esmtp'"
newline|'\n'
nl|'\n'
DECL|class|DomainSMTP
dedent|''
name|'class'
name|'DomainSMTP'
op|'('
name|'SMTPDomainDelivery'
op|','
name|'smtp'
op|'.'
name|'SMTP'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'service'
op|'='
name|'user'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'import'
name|'warnings'
newline|'\n'
name|'warnings'
op|'.'
name|'warn'
op|'('
nl|'\n'
string|'"DomainSMTP is deprecated.  Use IMessageDelivery objects instead."'
op|','
nl|'\n'
name|'DeprecationWarning'
op|','
name|'stacklevel'
op|'='
number|'2'
op|','
nl|'\n'
op|')'
newline|'\n'
name|'smtp'
op|'.'
name|'SMTP'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kw'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'delivery'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'delivery'
op|'='
name|'self'
newline|'\n'
nl|'\n'
DECL|class|DomainESMTP
dedent|''
dedent|''
dedent|''
name|'class'
name|'DomainESMTP'
op|'('
name|'ESMTPDomainDelivery'
op|','
name|'smtp'
op|'.'
name|'ESMTP'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'service'
op|'='
name|'user'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'import'
name|'warnings'
newline|'\n'
name|'warnings'
op|'.'
name|'warn'
op|'('
nl|'\n'
string|'"DomainESMTP is deprecated.  Use IMessageDelivery objects instead."'
op|','
nl|'\n'
name|'DeprecationWarning'
op|','
name|'stacklevel'
op|'='
number|'2'
op|','
nl|'\n'
op|')'
newline|'\n'
name|'smtp'
op|'.'
name|'ESMTP'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kw'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'delivery'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'delivery'
op|'='
name|'self'
newline|'\n'
nl|'\n'
DECL|class|SMTPFactory
dedent|''
dedent|''
dedent|''
name|'class'
name|'SMTPFactory'
op|'('
name|'smtp'
op|'.'
name|'SMTPFactory'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""A protocol factory for SMTP."""'
newline|'\n'
nl|'\n'
DECL|variable|protocol
name|'protocol'
op|'='
name|'smtp'
op|'.'
name|'SMTP'
newline|'\n'
DECL|variable|portal
name|'portal'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'service'
op|','
name|'portal'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'smtp'
op|'.'
name|'SMTPFactory'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'service'
op|'='
name|'service'
newline|'\n'
name|'self'
op|'.'
name|'portal'
op|'='
name|'portal'
newline|'\n'
nl|'\n'
DECL|member|buildProtocol
dedent|''
name|'def'
name|'buildProtocol'
op|'('
name|'self'
op|','
name|'addr'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'log'
op|'.'
name|'msg'
op|'('
string|"'Connection from %s'"
op|'%'
op|'('
name|'addr'
op|','
op|')'
op|')'
newline|'\n'
name|'p'
op|'='
name|'smtp'
op|'.'
name|'SMTPFactory'
op|'.'
name|'buildProtocol'
op|'('
name|'self'
op|','
name|'addr'
op|')'
newline|'\n'
name|'p'
op|'.'
name|'service'
op|'='
name|'self'
op|'.'
name|'service'
newline|'\n'
name|'p'
op|'.'
name|'portal'
op|'='
name|'self'
op|'.'
name|'portal'
newline|'\n'
name|'return'
name|'p'
newline|'\n'
nl|'\n'
DECL|class|ESMTPFactory
dedent|''
dedent|''
name|'class'
name|'ESMTPFactory'
op|'('
name|'SMTPFactory'
op|')'
op|':'
newline|'\n'
DECL|variable|protocol
indent|'    '
name|'protocol'
op|'='
name|'smtp'
op|'.'
name|'ESMTP'
newline|'\n'
DECL|variable|context
name|'context'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'SMTPFactory'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'challengers'
op|'='
op|'{'
nl|'\n'
string|"'CRAM-MD5'"
op|':'
name|'cred'
op|'.'
name|'credentials'
op|'.'
name|'CramMD5Credentials'
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|buildProtocol
dedent|''
name|'def'
name|'buildProtocol'
op|'('
name|'self'
op|','
name|'addr'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'p'
op|'='
name|'SMTPFactory'
op|'.'
name|'buildProtocol'
op|'('
name|'self'
op|','
name|'addr'
op|')'
newline|'\n'
name|'p'
op|'.'
name|'challengers'
op|'='
name|'self'
op|'.'
name|'challengers'
newline|'\n'
name|'p'
op|'.'
name|'ctx'
op|'='
name|'self'
op|'.'
name|'context'
newline|'\n'
name|'return'
name|'p'
newline|'\n'
nl|'\n'
DECL|class|VirtualPOP3
dedent|''
dedent|''
name|'class'
name|'VirtualPOP3'
op|'('
name|'pop3'
op|'.'
name|'POP3'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Virtual hosting POP3."""'
newline|'\n'
nl|'\n'
DECL|variable|service
name|'service'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|variable|domainSpecifier
name|'domainSpecifier'
op|'='
string|"'@'"
comment|'# Gaagh! I hate POP3. No standardized way'
newline|'\n'
comment|"# to indicate user@host. '@' doesn't work"
nl|'\n'
comment|'# with NS, e.g.'
nl|'\n'
nl|'\n'
DECL|member|authenticateUserAPOP
name|'def'
name|'authenticateUserAPOP'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'digest'
op|')'
op|':'
newline|'\n'
comment|'# Override the default lookup scheme to allow virtual domains'
nl|'\n'
indent|'        '
name|'user'
op|','
name|'domain'
op|'='
name|'self'
op|'.'
name|'lookupDomain'
op|'('
name|'user'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'portal'
op|'='
name|'self'
op|'.'
name|'service'
op|'.'
name|'lookupPortal'
op|'('
name|'domain'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'KeyError'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'defer'
op|'.'
name|'fail'
op|'('
name|'cred'
op|'.'
name|'error'
op|'.'
name|'UnauthorizedLogin'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'portal'
op|'.'
name|'login'
op|'('
nl|'\n'
name|'pop3'
op|'.'
name|'APOPCredentials'
op|'('
name|'self'
op|'.'
name|'magic'
op|','
name|'user'
op|','
name|'digest'
op|')'
op|','
nl|'\n'
name|'None'
op|','
nl|'\n'
name|'pop3'
op|'.'
name|'IMailbox'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|member|authenticateUserPASS
dedent|''
dedent|''
name|'def'
name|'authenticateUserPASS'
op|'('
name|'self'
op|','
name|'user'
op|','
name|'password'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|','
name|'domain'
op|'='
name|'self'
op|'.'
name|'lookupDomain'
op|'('
name|'user'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'portal'
op|'='
name|'self'
op|'.'
name|'service'
op|'.'
name|'lookupPortal'
op|'('
name|'domain'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'KeyError'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'defer'
op|'.'
name|'fail'
op|'('
name|'cred'
op|'.'
name|'error'
op|'.'
name|'UnauthorizedLogin'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'portal'
op|'.'
name|'login'
op|'('
nl|'\n'
name|'cred'
op|'.'
name|'credentials'
op|'.'
name|'UsernamePassword'
op|'('
name|'user'
op|','
name|'password'
op|')'
op|','
nl|'\n'
name|'None'
op|','
nl|'\n'
name|'pop3'
op|'.'
name|'IMailbox'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|member|lookupDomain
dedent|''
dedent|''
name|'def'
name|'lookupDomain'
op|'('
name|'self'
op|','
name|'user'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'user'
op|','
name|'domain'
op|'='
name|'user'
op|'.'
name|'split'
op|'('
name|'self'
op|'.'
name|'domainSpecifier'
op|','
number|'1'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'            '
name|'domain'
op|'='
string|"''"
newline|'\n'
dedent|''
name|'if'
name|'domain'
name|'not'
name|'in'
name|'self'
op|'.'
name|'service'
op|'.'
name|'domains'
op|':'
newline|'\n'
indent|'             '
name|'raise'
name|'pop3'
op|'.'
name|'POP3Error'
op|'('
string|'"no such domain %s"'
op|'%'
name|'domain'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'user'
op|','
name|'domain'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|POP3Factory
dedent|''
dedent|''
name|'class'
name|'POP3Factory'
op|'('
name|'protocol'
op|'.'
name|'ServerFactory'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""POP3 protocol factory."""'
newline|'\n'
nl|'\n'
DECL|variable|protocol
name|'protocol'
op|'='
name|'VirtualPOP3'
newline|'\n'
DECL|variable|service
name|'service'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'service'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'service'
op|'='
name|'service'
newline|'\n'
nl|'\n'
DECL|member|buildProtocol
dedent|''
name|'def'
name|'buildProtocol'
op|'('
name|'self'
op|','
name|'addr'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'p'
op|'='
name|'protocol'
op|'.'
name|'ServerFactory'
op|'.'
name|'buildProtocol'
op|'('
name|'self'
op|','
name|'addr'
op|')'
newline|'\n'
name|'p'
op|'.'
name|'service'
op|'='
name|'self'
op|'.'
name|'service'
newline|'\n'
name|'return'
name|'p'
newline|'\n'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# It is useful to know, perhaps, that the required file for this to work can'
nl|'\n'
comment|'# be created thusly:'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# openssl req -x509 -newkey rsa:2048 -keyout file.key -out file.crt \\'
nl|'\n'
comment|'# -days 365 -nodes'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# And then cat file.key and file.crt together.  The number of days and bits'
nl|'\n'
comment|'# can be changed, of course.'
nl|'\n'
comment|'#'
nl|'\n'
DECL|class|SSLContextFactory
dedent|''
dedent|''
name|'class'
name|'SSLContextFactory'
op|':'
newline|'\n'
indent|'    '
string|'"""An SSL Context Factory\n    \n    This loads a certificate and private key from a specified file.\n    """'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'filename'
op|'='
name|'filename'
newline|'\n'
nl|'\n'
DECL|member|getContext
dedent|''
name|'def'
name|'getContext'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Create an SSL context."""'
newline|'\n'
name|'from'
name|'OpenSSL'
name|'import'
name|'SSL'
newline|'\n'
name|'ctx'
op|'='
name|'SSL'
op|'.'
name|'Context'
op|'('
name|'SSL'
op|'.'
name|'SSLv23_METHOD'
op|')'
newline|'\n'
name|'ctx'
op|'.'
name|'use_certificate_file'
op|'('
name|'self'
op|'.'
name|'filename'
op|')'
newline|'\n'
name|'ctx'
op|'.'
name|'use_privatekey_file'
op|'('
name|'self'
op|'.'
name|'filename'
op|')'
newline|'\n'
name|'return'
name|'ctx'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
