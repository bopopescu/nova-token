begin_unit
comment|'# -*- test-case-name: twisted.mail.test.test_options -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
string|'"""I am the support module for creating mail servers with twistd\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'sys'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'mail'
name|'import'
name|'mail'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'mail'
name|'import'
name|'maildir'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'mail'
name|'import'
name|'relay'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'mail'
name|'import'
name|'relaymanager'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'mail'
name|'import'
name|'alias'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'usage'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'cred'
name|'import'
name|'checkers'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'application'
name|'import'
name|'internet'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|Options
name|'class'
name|'Options'
op|'('
name|'usage'
op|'.'
name|'Options'
op|')'
op|':'
newline|'\n'
DECL|variable|synopsis
indent|'    '
name|'synopsis'
op|'='
string|'"[options]"'
newline|'\n'
nl|'\n'
DECL|variable|optParameters
name|'optParameters'
op|'='
op|'['
nl|'\n'
op|'['
string|'"pop3"'
op|','
string|'"p"'
op|','
number|'8110'
op|','
string|'"Port to start the POP3 server on (0 to disable)."'
op|','
name|'usage'
op|'.'
name|'portCoerce'
op|']'
op|','
nl|'\n'
op|'['
string|'"pop3s"'
op|','
string|'"S"'
op|','
number|'0'
op|','
string|'"Port to start the POP3-over-SSL server on (0 to disable)."'
op|','
name|'usage'
op|'.'
name|'portCoerce'
op|']'
op|','
nl|'\n'
op|'['
string|'"smtp"'
op|','
string|'"s"'
op|','
number|'8025'
op|','
string|'"Port to start the SMTP server on (0 to disable)."'
op|','
name|'usage'
op|'.'
name|'portCoerce'
op|']'
op|','
nl|'\n'
op|'['
string|'"certificate"'
op|','
string|'"c"'
op|','
name|'None'
op|','
string|'"Certificate file to use for SSL connections"'
op|']'
op|','
nl|'\n'
op|'['
string|'"relay"'
op|','
string|'"R"'
op|','
name|'None'
op|','
nl|'\n'
string|'"Relay messages according to their envelope \'To\', using the given"'
nl|'\n'
string|'"path as a queue directory."'
op|']'
op|','
nl|'\n'
op|'['
string|'"hostname"'
op|','
string|'"H"'
op|','
name|'None'
op|','
string|'"The hostname by which to identify this server."'
op|']'
op|','
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
DECL|variable|optFlags
name|'optFlags'
op|'='
op|'['
nl|'\n'
op|'['
string|'"esmtp"'
op|','
string|'"E"'
op|','
string|'"Use RFC 1425/1869 SMTP extensions"'
op|']'
op|','
nl|'\n'
op|'['
string|'"disable-anonymous"'
op|','
name|'None'
op|','
string|'"Disallow non-authenticated SMTP connections"'
op|']'
op|','
nl|'\n'
op|']'
newline|'\n'
DECL|variable|zsh_actions
name|'zsh_actions'
op|'='
op|'{'
string|'"hostname"'
op|':'
string|'"_hosts"'
op|'}'
newline|'\n'
nl|'\n'
DECL|variable|longdesc
name|'longdesc'
op|'='
string|'"This creates a mail.tap file that can be used by twistd."'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'usage'
op|'.'
name|'Options'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'service'
op|'='
name|'mail'
op|'.'
name|'MailService'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'last_domain'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|opt_passwordfile
dedent|''
name|'def'
name|'opt_passwordfile'
op|'('
name|'self'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Specify a file containing username:password login info for authenticated ESMTP connections."""'
newline|'\n'
name|'ch'
op|'='
name|'checkers'
op|'.'
name|'OnDiskUsernamePasswordDatabase'
op|'('
name|'filename'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'service'
op|'.'
name|'smtpPortal'
op|'.'
name|'registerChecker'
op|'('
name|'ch'
op|')'
newline|'\n'
DECL|variable|opt_P
dedent|''
name|'opt_P'
op|'='
name|'opt_passwordfile'
newline|'\n'
nl|'\n'
DECL|member|opt_default
name|'def'
name|'opt_default'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Make the most recently specified domain the default domain."""'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'last_domain'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'service'
op|'.'
name|'addDomain'
op|'('
string|"''"
op|','
name|'self'
op|'.'
name|'last_domain'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
string|'"Specify a domain before specifying using --default"'
op|')'
newline|'\n'
DECL|variable|opt_D
dedent|''
dedent|''
name|'opt_D'
op|'='
name|'opt_default'
newline|'\n'
nl|'\n'
DECL|member|opt_maildirdbmdomain
name|'def'
name|'opt_maildirdbmdomain'
op|'('
name|'self'
op|','
name|'domain'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""generate an SMTP/POP3 virtual domain which saves to \\"path\\"\n        """'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'name'
op|','
name|'path'
op|'='
name|'domain'
op|'.'
name|'split'
op|'('
string|"'='"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
string|'"Argument to --maildirdbmdomain must be of the form \'name=path\'"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'last_domain'
op|'='
name|'maildir'
op|'.'
name|'MaildirDirdbmDomain'
op|'('
name|'self'
op|'.'
name|'service'
op|','
name|'os'
op|'.'
name|'path'
op|'.'
name|'abspath'
op|'('
name|'path'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'service'
op|'.'
name|'addDomain'
op|'('
name|'name'
op|','
name|'self'
op|'.'
name|'last_domain'
op|')'
newline|'\n'
DECL|variable|opt_d
dedent|''
name|'opt_d'
op|'='
name|'opt_maildirdbmdomain'
newline|'\n'
nl|'\n'
DECL|member|opt_user
name|'def'
name|'opt_user'
op|'('
name|'self'
op|','
name|'user_pass'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""add a user/password to the last specified domains\n        """'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'user'
op|','
name|'password'
op|'='
name|'user_pass'
op|'.'
name|'split'
op|'('
string|"'='"
op|','
number|'1'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
string|'"Argument to --user must be of the form \'user=password\'"'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'last_domain'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'last_domain'
op|'.'
name|'addUser'
op|'('
name|'user'
op|','
name|'password'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
string|'"Specify a domain before specifying users"'
op|')'
newline|'\n'
DECL|variable|opt_u
dedent|''
dedent|''
name|'opt_u'
op|'='
name|'opt_user'
newline|'\n'
nl|'\n'
DECL|member|opt_bounce_to_postmaster
name|'def'
name|'opt_bounce_to_postmaster'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""undelivered mails are sent to the postmaster\n        """'
newline|'\n'
name|'self'
op|'.'
name|'last_domain'
op|'.'
name|'postmaster'
op|'='
number|'1'
newline|'\n'
DECL|variable|opt_b
dedent|''
name|'opt_b'
op|'='
name|'opt_bounce_to_postmaster'
newline|'\n'
nl|'\n'
DECL|member|opt_aliases
name|'def'
name|'opt_aliases'
op|'('
name|'self'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Specify an aliases(5) file to use for this domain"""'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'last_domain'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'mail'
op|'.'
name|'IAliasableDomain'
op|'.'
name|'providedBy'
op|'('
name|'self'
op|'.'
name|'last_domain'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'aliases'
op|'='
name|'alias'
op|'.'
name|'loadAliasFile'
op|'('
name|'self'
op|'.'
name|'service'
op|'.'
name|'domains'
op|','
name|'filename'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'last_domain'
op|'.'
name|'setAliasGroup'
op|'('
name|'aliases'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'service'
op|'.'
name|'monitor'
op|'.'
name|'monitorFile'
op|'('
nl|'\n'
name|'filename'
op|','
nl|'\n'
name|'AliasUpdater'
op|'('
name|'self'
op|'.'
name|'service'
op|'.'
name|'domains'
op|','
name|'self'
op|'.'
name|'last_domain'
op|')'
nl|'\n'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
nl|'\n'
string|'"%s does not support alias files"'
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'last_domain'
op|'.'
name|'__class__'
op|'.'
name|'__name__'
op|','
nl|'\n'
op|')'
nl|'\n'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
string|'"Specify a domain before specifying aliases"'
op|')'
newline|'\n'
DECL|variable|opt_A
dedent|''
dedent|''
name|'opt_A'
op|'='
name|'opt_aliases'
newline|'\n'
nl|'\n'
DECL|member|postOptions
name|'def'
name|'postOptions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'['
string|"'pop3s'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'self'
op|'['
string|"'certificate'"
op|']'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
string|'"Cannot specify --pop3s without "'
nl|'\n'
string|'"--certificate"'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'self'
op|'['
string|"'certificate'"
op|']'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
string|'"Certificate file %r does not exist."'
nl|'\n'
op|'%'
name|'self'
op|'['
string|"'certificate'"
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'not'
name|'self'
op|'['
string|"'disable-anonymous'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'service'
op|'.'
name|'smtpPortal'
op|'.'
name|'registerChecker'
op|'('
name|'checkers'
op|'.'
name|'AllowAnonymousAccess'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'not'
op|'('
name|'self'
op|'['
string|"'pop3'"
op|']'
name|'or'
name|'self'
op|'['
string|"'smtp'"
op|']'
name|'or'
name|'self'
op|'['
string|"'pop3s'"
op|']'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
string|'"You cannot disable all protocols"'
op|')'
newline|'\n'
nl|'\n'
DECL|class|AliasUpdater
dedent|''
dedent|''
dedent|''
name|'class'
name|'AliasUpdater'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'domains'
op|','
name|'domain'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'domains'
op|'='
name|'domains'
newline|'\n'
name|'self'
op|'.'
name|'domain'
op|'='
name|'domain'
newline|'\n'
DECL|member|__call__
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'new'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'domain'
op|'.'
name|'setAliasGroup'
op|'('
name|'alias'
op|'.'
name|'loadAliasFile'
op|'('
name|'self'
op|'.'
name|'domains'
op|','
name|'new'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|makeService
dedent|''
dedent|''
name|'def'
name|'makeService'
op|'('
name|'config'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'config'
op|'['
string|"'esmtp'"
op|']'
op|':'
newline|'\n'
indent|'        '
name|'rmType'
op|'='
name|'relaymanager'
op|'.'
name|'SmartHostESMTPRelayingManager'
newline|'\n'
name|'smtpFactory'
op|'='
name|'config'
op|'.'
name|'service'
op|'.'
name|'getESMTPFactory'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'rmType'
op|'='
name|'relaymanager'
op|'.'
name|'SmartHostSMTPRelayingManager'
newline|'\n'
name|'smtpFactory'
op|'='
name|'config'
op|'.'
name|'service'
op|'.'
name|'getSMTPFactory'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'config'
op|'['
string|"'relay'"
op|']'
op|':'
newline|'\n'
indent|'        '
name|'dir'
op|'='
name|'config'
op|'['
string|"'relay'"
op|']'
newline|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'dir'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'mkdir'
op|'('
name|'dir'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'config'
op|'.'
name|'service'
op|'.'
name|'setQueue'
op|'('
name|'relaymanager'
op|'.'
name|'Queue'
op|'('
name|'dir'
op|')'
op|')'
newline|'\n'
name|'default'
op|'='
name|'relay'
op|'.'
name|'DomainQueuer'
op|'('
name|'config'
op|'.'
name|'service'
op|')'
newline|'\n'
nl|'\n'
name|'manager'
op|'='
name|'rmType'
op|'('
name|'config'
op|'.'
name|'service'
op|'.'
name|'queue'
op|')'
newline|'\n'
name|'if'
name|'config'
op|'['
string|"'esmtp'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'manager'
op|'.'
name|'fArgs'
op|'+='
op|'('
name|'None'
op|','
name|'None'
op|')'
newline|'\n'
dedent|''
name|'manager'
op|'.'
name|'fArgs'
op|'+='
op|'('
name|'config'
op|'['
string|"'hostname'"
op|']'
op|','
op|')'
newline|'\n'
nl|'\n'
name|'helper'
op|'='
name|'relaymanager'
op|'.'
name|'RelayStateHelper'
op|'('
name|'manager'
op|','
number|'1'
op|')'
newline|'\n'
name|'helper'
op|'.'
name|'setServiceParent'
op|'('
name|'config'
op|'.'
name|'service'
op|')'
newline|'\n'
name|'config'
op|'.'
name|'service'
op|'.'
name|'domains'
op|'.'
name|'setDefaultDomain'
op|'('
name|'default'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'ctx'
op|'='
name|'None'
newline|'\n'
name|'if'
name|'config'
op|'['
string|"'certificate'"
op|']'
op|':'
newline|'\n'
indent|'        '
name|'from'
name|'twisted'
op|'.'
name|'mail'
op|'.'
name|'protocols'
name|'import'
name|'SSLContextFactory'
newline|'\n'
name|'ctx'
op|'='
name|'SSLContextFactory'
op|'('
name|'config'
op|'['
string|"'certificate'"
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'config'
op|'['
string|"'pop3'"
op|']'
op|':'
newline|'\n'
indent|'        '
name|'s'
op|'='
name|'internet'
op|'.'
name|'TCPServer'
op|'('
name|'config'
op|'['
string|"'pop3'"
op|']'
op|','
name|'config'
op|'.'
name|'service'
op|'.'
name|'getPOP3Factory'
op|'('
op|')'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'setServiceParent'
op|'('
name|'config'
op|'.'
name|'service'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'config'
op|'['
string|"'pop3s'"
op|']'
op|':'
newline|'\n'
indent|'        '
name|'s'
op|'='
name|'internet'
op|'.'
name|'SSLServer'
op|'('
name|'config'
op|'['
string|"'pop3s'"
op|']'
op|','
nl|'\n'
name|'config'
op|'.'
name|'service'
op|'.'
name|'getPOP3Factory'
op|'('
op|')'
op|','
name|'ctx'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'setServiceParent'
op|'('
name|'config'
op|'.'
name|'service'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'config'
op|'['
string|"'smtp'"
op|']'
op|':'
newline|'\n'
indent|'        '
name|'f'
op|'='
name|'smtpFactory'
op|'('
op|')'
newline|'\n'
name|'f'
op|'.'
name|'context'
op|'='
name|'ctx'
newline|'\n'
name|'if'
name|'config'
op|'['
string|"'hostname'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'f'
op|'.'
name|'domain'
op|'='
name|'config'
op|'['
string|"'hostname'"
op|']'
newline|'\n'
name|'f'
op|'.'
name|'fArgs'
op|'='
op|'('
name|'f'
op|'.'
name|'domain'
op|','
op|')'
newline|'\n'
dedent|''
name|'if'
name|'config'
op|'['
string|"'esmtp'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'f'
op|'.'
name|'fArgs'
op|'='
op|'('
name|'None'
op|','
name|'None'
op|')'
op|'+'
name|'f'
op|'.'
name|'fArgs'
newline|'\n'
dedent|''
name|'s'
op|'='
name|'internet'
op|'.'
name|'TCPServer'
op|'('
name|'config'
op|'['
string|"'smtp'"
op|']'
op|','
name|'f'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'setServiceParent'
op|'('
name|'config'
op|'.'
name|'service'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'config'
op|'.'
name|'service'
newline|'\n'
dedent|''
endmarker|''
end_unit
