begin_unit
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'spread'
name|'import'
name|'pb'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'spread'
name|'import'
name|'banana'
newline|'\n'
nl|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'types'
newline|'\n'
nl|'\n'
DECL|class|Maildir
name|'class'
name|'Maildir'
op|'('
name|'pb'
op|'.'
name|'Referenceable'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'directory'
op|','
name|'rootDirectory'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'virtualDirectory'
op|'='
name|'directory'
newline|'\n'
name|'self'
op|'.'
name|'rootDirectory'
op|'='
name|'rootDirectory'
newline|'\n'
name|'self'
op|'.'
name|'directory'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'rootDirectory'
op|','
name|'directory'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getFolderMessage
dedent|''
name|'def'
name|'getFolderMessage'
op|'('
name|'self'
op|','
name|'folder'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
string|"'/'"
name|'in'
name|'name'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'IOError'
op|'('
string|'"can only open files in \'%s\' directory\'"'
op|'%'
name|'folder'
op|')'
newline|'\n'
dedent|''
name|'fp'
op|'='
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'directory'
op|','
string|"'new'"
op|','
name|'name'
op|')'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'fp'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'fp'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|deleteFolderMessage
dedent|''
dedent|''
name|'def'
name|'deleteFolderMessage'
op|'('
name|'self'
op|','
name|'folder'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
string|"'/'"
name|'in'
name|'name'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'IOError'
op|'('
string|'"can only delete files in \'%s\' directory\'"'
op|'%'
name|'folder'
op|')'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'rename'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'directory'
op|','
name|'folder'
op|','
name|'name'
op|')'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'rootDirectory'
op|','
string|"'.Trash'"
op|','
name|'folder'
op|','
name|'name'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|deleteNewMessage
dedent|''
name|'def'
name|'deleteNewMessage'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'deleteFolderMessage'
op|'('
string|"'new'"
op|','
name|'name'
op|')'
newline|'\n'
DECL|variable|remote_deleteNewMessage
dedent|''
name|'remote_deleteNewMessage'
op|'='
name|'deleteNewMessage'
newline|'\n'
nl|'\n'
DECL|member|deleteCurMessage
name|'def'
name|'deleteCurMessage'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'deleteFolderMessage'
op|'('
string|"'cur'"
op|','
name|'name'
op|')'
newline|'\n'
DECL|variable|remote_deleteCurMessage
dedent|''
name|'remote_deleteCurMessage'
op|'='
name|'deleteCurMessage'
newline|'\n'
nl|'\n'
DECL|member|getNewMessages
name|'def'
name|'getNewMessages'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'os'
op|'.'
name|'listdir'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'directory'
op|','
string|"'new'"
op|')'
op|')'
newline|'\n'
DECL|variable|remote_getNewMessages
dedent|''
name|'remote_getNewMessages'
op|'='
name|'getNewMessages'
newline|'\n'
nl|'\n'
DECL|member|getCurMessages
name|'def'
name|'getCurMessages'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'os'
op|'.'
name|'listdir'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'directory'
op|','
string|"'cur'"
op|')'
op|')'
newline|'\n'
DECL|variable|remote_getCurMessages
dedent|''
name|'remote_getCurMessages'
op|'='
name|'getCurMessages'
newline|'\n'
nl|'\n'
DECL|member|getNewMessage
name|'def'
name|'getNewMessage'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'getFolderMessage'
op|'('
string|"'new'"
op|','
name|'name'
op|')'
newline|'\n'
DECL|variable|remote_getNewMessage
dedent|''
name|'remote_getNewMessage'
op|'='
name|'getNewMessage'
newline|'\n'
nl|'\n'
DECL|member|getCurMessage
name|'def'
name|'getCurMessage'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'getFolderMessage'
op|'('
string|"'cur'"
op|','
name|'name'
op|')'
newline|'\n'
DECL|variable|remote_getCurMessage
dedent|''
name|'remote_getCurMessage'
op|'='
name|'getCurMessage'
newline|'\n'
nl|'\n'
DECL|member|getSubFolder
name|'def'
name|'getSubFolder'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'name'
op|'['
number|'0'
op|']'
op|'=='
string|"'.'"
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'IOError'
op|'('
string|'"subfolder name cannot begin with a \'.\'"'
op|')'
newline|'\n'
dedent|''
name|'name'
op|'='
name|'name'
op|'.'
name|'replace'
op|'('
string|"'/'"
op|','
string|"':'"
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'virtualDirectoy'
op|'=='
string|"'.'"
op|':'
newline|'\n'
indent|'            '
name|'name'
op|'='
string|"'.'"
op|'+'
name|'name'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'name'
op|'='
name|'self'
op|'.'
name|'virtualDirectory'
op|'+'
string|"':'"
op|'+'
name|'name'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'self'
op|'.'
name|'_isSubFolder'
op|'('
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'IOError'
op|'('
string|'"not a subfolder"'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'Maildir'
op|'('
name|'name'
op|','
name|'self'
op|'.'
name|'rootDirectory'
op|')'
newline|'\n'
DECL|variable|remote_getSubFolder
dedent|''
name|'remote_getSubFolder'
op|'='
name|'getSubFolder'
newline|'\n'
nl|'\n'
DECL|member|_isSubFolder
name|'def'
name|'_isSubFolder'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
op|'('
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'rootDirectory'
op|','
name|'name'
op|')'
op|')'
name|'or'
nl|'\n'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'rootDirectory'
op|','
name|'name'
op|','
nl|'\n'
string|"'maildirfolder'"
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|MaildirCollection
dedent|''
dedent|''
name|'class'
name|'MaildirCollection'
op|'('
name|'pb'
op|'.'
name|'Referenceable'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'root'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'root'
op|'='
name|'root'
newline|'\n'
nl|'\n'
DECL|member|getSubFolders
dedent|''
name|'def'
name|'getSubFolders'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'os'
op|'.'
name|'listdir'
op|'('
name|'self'
op|'.'
name|'getRoot'
op|'('
op|')'
op|')'
newline|'\n'
DECL|variable|remote_getSubFolders
dedent|''
name|'remote_getSubFolders'
op|'='
name|'getSubFolders'
newline|'\n'
nl|'\n'
DECL|member|getSubFolder
name|'def'
name|'getSubFolder'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
string|"'/'"
name|'in'
name|'name'
name|'or'
name|'name'
op|'['
number|'0'
op|']'
op|'=='
string|"'.'"
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'IOError'
op|'('
string|'"invalid name"'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'Maildir'
op|'('
string|"'.'"
op|','
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'getRoot'
op|'('
op|')'
op|','
name|'name'
op|')'
op|')'
newline|'\n'
DECL|variable|remote_getSubFolder
dedent|''
name|'remote_getSubFolder'
op|'='
name|'getSubFolder'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|MaildirBroker
dedent|''
name|'class'
name|'MaildirBroker'
op|'('
name|'pb'
op|'.'
name|'Broker'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|proto_getCollection
indent|'    '
name|'def'
name|'proto_getCollection'
op|'('
name|'self'
op|','
name|'requestID'
op|','
name|'name'
op|','
name|'domain'
op|','
name|'password'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'collection'
op|'='
name|'self'
op|'.'
name|'_getCollection'
op|'('
op|')'
newline|'\n'
name|'if'
name|'collection'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendError'
op|'('
name|'requestID'
op|','
string|'"permission denied"'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendAnswer'
op|'('
name|'requestID'
op|','
name|'collection'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getCollection
dedent|''
dedent|''
name|'def'
name|'getCollection'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'domain'
op|','
name|'password'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'domains'
op|'.'
name|'has_key'
op|'('
name|'domain'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
newline|'\n'
dedent|''
name|'domain'
op|'='
name|'self'
op|'.'
name|'domains'
op|'['
name|'domain'
op|']'
newline|'\n'
name|'if'
op|'('
name|'domain'
op|'.'
name|'dbm'
op|'.'
name|'has_key'
op|'('
name|'name'
op|')'
name|'and'
nl|'\n'
name|'domain'
op|'.'
name|'dbm'
op|'['
name|'name'
op|']'
op|'=='
name|'password'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'MaildirCollection'
op|'('
name|'domain'
op|'.'
name|'userDirectory'
op|'('
name|'name'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|MaildirClient
dedent|''
dedent|''
dedent|''
name|'class'
name|'MaildirClient'
op|'('
name|'pb'
op|'.'
name|'Broker'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|getCollection
indent|'    '
name|'def'
name|'getCollection'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'domain'
op|','
name|'password'
op|','
name|'callback'
op|','
name|'errback'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'requestID'
op|'='
name|'self'
op|'.'
name|'newRequestID'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'waitingForAnswers'
op|'['
name|'requestID'
op|']'
op|'='
name|'callback'
op|','
name|'errback'
newline|'\n'
name|'self'
op|'.'
name|'sendCall'
op|'('
string|'"getCollection"'
op|','
name|'requestID'
op|','
name|'name'
op|','
name|'domain'
op|','
name|'password'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
