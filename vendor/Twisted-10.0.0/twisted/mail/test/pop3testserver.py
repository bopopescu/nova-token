begin_unit
comment|'#!/usr/bin/env python'
nl|'\n'
comment|'# -*- test-case-name: twisted.mail.test.test_pop3client -*-'
nl|'\n'
nl|'\n'
comment|'# Copyright (c) 2009 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
op|'.'
name|'protocol'
name|'import'
name|'Factory'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'protocols'
name|'import'
name|'basic'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
name|'import'
name|'sys'
op|','
name|'time'
newline|'\n'
nl|'\n'
DECL|variable|USER
name|'USER'
op|'='
string|'"test"'
newline|'\n'
DECL|variable|PASS
name|'PASS'
op|'='
string|'"twisted"'
newline|'\n'
nl|'\n'
DECL|variable|PORT
name|'PORT'
op|'='
number|'1100'
newline|'\n'
nl|'\n'
DECL|variable|SSL_SUPPORT
name|'SSL_SUPPORT'
op|'='
name|'True'
newline|'\n'
DECL|variable|UIDL_SUPPORT
name|'UIDL_SUPPORT'
op|'='
name|'True'
newline|'\n'
DECL|variable|INVALID_SERVER_RESPONSE
name|'INVALID_SERVER_RESPONSE'
op|'='
name|'False'
newline|'\n'
DECL|variable|INVALID_CAPABILITY_RESPONSE
name|'INVALID_CAPABILITY_RESPONSE'
op|'='
name|'False'
newline|'\n'
DECL|variable|INVALID_LOGIN_RESPONSE
name|'INVALID_LOGIN_RESPONSE'
op|'='
name|'False'
newline|'\n'
DECL|variable|DENY_CONNECTION
name|'DENY_CONNECTION'
op|'='
name|'False'
newline|'\n'
DECL|variable|DROP_CONNECTION
name|'DROP_CONNECTION'
op|'='
name|'False'
newline|'\n'
DECL|variable|BAD_TLS_RESPONSE
name|'BAD_TLS_RESPONSE'
op|'='
name|'False'
newline|'\n'
DECL|variable|TIMEOUT_RESPONSE
name|'TIMEOUT_RESPONSE'
op|'='
name|'False'
newline|'\n'
DECL|variable|TIMEOUT_DEFERRED
name|'TIMEOUT_DEFERRED'
op|'='
name|'False'
newline|'\n'
DECL|variable|SLOW_GREETING
name|'SLOW_GREETING'
op|'='
name|'False'
newline|'\n'
nl|'\n'
string|'"""Commands"""'
newline|'\n'
DECL|variable|CONNECTION_MADE
name|'CONNECTION_MADE'
op|'='
string|'"+OK POP3 localhost v2003.83 server ready"'
newline|'\n'
nl|'\n'
DECL|variable|CAPABILITIES
name|'CAPABILITIES'
op|'='
op|'['
nl|'\n'
string|'"TOP"'
op|','
nl|'\n'
string|'"LOGIN-DELAY 180"'
op|','
nl|'\n'
string|'"USER"'
op|','
nl|'\n'
string|'"SASL LOGIN"'
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
DECL|variable|CAPABILITIES_SSL
name|'CAPABILITIES_SSL'
op|'='
string|'"STLS"'
newline|'\n'
DECL|variable|CAPABILITIES_UIDL
name|'CAPABILITIES_UIDL'
op|'='
string|'"UIDL"'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|INVALID_RESPONSE
name|'INVALID_RESPONSE'
op|'='
string|'"-ERR Unknown request"'
newline|'\n'
DECL|variable|VALID_RESPONSE
name|'VALID_RESPONSE'
op|'='
string|'"+OK Command Completed"'
newline|'\n'
DECL|variable|AUTH_DECLINED
name|'AUTH_DECLINED'
op|'='
string|'"-ERR LOGIN failed"'
newline|'\n'
DECL|variable|AUTH_ACCEPTED
name|'AUTH_ACCEPTED'
op|'='
string|'"+OK Mailbox open, 0 messages"'
newline|'\n'
DECL|variable|TLS_ERROR
name|'TLS_ERROR'
op|'='
string|'"-ERR server side error start TLS handshake"'
newline|'\n'
DECL|variable|LOGOUT_COMPLETE
name|'LOGOUT_COMPLETE'
op|'='
string|'"+OK quit completed"'
newline|'\n'
DECL|variable|NOT_LOGGED_IN
name|'NOT_LOGGED_IN'
op|'='
string|'"-ERR Unknown AUHORIZATION state command"'
newline|'\n'
DECL|variable|STAT
name|'STAT'
op|'='
string|'"+OK 0 0"'
newline|'\n'
DECL|variable|UIDL
name|'UIDL'
op|'='
string|'"+OK Unique-ID listing follows\\r\\n."'
newline|'\n'
DECL|variable|LIST
name|'LIST'
op|'='
string|'"+OK Mailbox scan listing follows\\r\\n."'
newline|'\n'
DECL|variable|CAP_START
name|'CAP_START'
op|'='
string|'"+OK Capability list follows:"'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|POP3TestServer
name|'class'
name|'POP3TestServer'
op|'('
name|'basic'
op|'.'
name|'LineReceiver'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'contextFactory'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'loggedIn'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'caps'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'tmpUser'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'ctx'
op|'='
name|'contextFactory'
newline|'\n'
nl|'\n'
DECL|member|sendSTATResp
dedent|''
name|'def'
name|'sendSTATResp'
op|'('
name|'self'
op|','
name|'req'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'STAT'
op|')'
newline|'\n'
nl|'\n'
DECL|member|sendUIDLResp
dedent|''
name|'def'
name|'sendUIDLResp'
op|'('
name|'self'
op|','
name|'req'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'UIDL'
op|')'
newline|'\n'
nl|'\n'
DECL|member|sendLISTResp
dedent|''
name|'def'
name|'sendLISTResp'
op|'('
name|'self'
op|','
name|'req'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'LIST'
op|')'
newline|'\n'
nl|'\n'
DECL|member|sendCapabilities
dedent|''
name|'def'
name|'sendCapabilities'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'caps'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'caps'
op|'='
op|'['
name|'CAP_START'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'UIDL_SUPPORT'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'caps'
op|'.'
name|'append'
op|'('
name|'CAPABILITIES_UIDL'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'SSL_SUPPORT'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'caps'
op|'.'
name|'append'
op|'('
name|'CAPABILITIES_SSL'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'cap'
name|'in'
name|'CAPABILITIES'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'caps'
op|'.'
name|'append'
op|'('
name|'cap'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
string|"'\\r\\n'"
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'caps'
op|')'
newline|'\n'
name|'resp'
op|'+='
string|'"\\r\\n."'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'resp'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|connectionMade
dedent|''
name|'def'
name|'connectionMade'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'DENY_CONNECTION'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'disconnect'
op|'('
op|')'
newline|'\n'
name|'return'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'SLOW_GREETING'
op|':'
newline|'\n'
indent|'            '
name|'reactor'
op|'.'
name|'callLater'
op|'('
number|'20'
op|','
name|'self'
op|'.'
name|'sendGreeting'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendGreeting'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|sendGreeting
dedent|''
dedent|''
name|'def'
name|'sendGreeting'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'CONNECTION_MADE'
op|')'
newline|'\n'
nl|'\n'
DECL|member|lineReceived
dedent|''
name|'def'
name|'lineReceived'
op|'('
name|'self'
op|','
name|'line'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Error Conditions"""'
newline|'\n'
nl|'\n'
name|'uline'
op|'='
name|'line'
op|'.'
name|'upper'
op|'('
op|')'
newline|'\n'
name|'find'
op|'='
name|'lambda'
name|'s'
op|':'
name|'uline'
op|'.'
name|'find'
op|'('
name|'s'
op|')'
op|'!='
op|'-'
number|'1'
newline|'\n'
nl|'\n'
name|'if'
name|'TIMEOUT_RESPONSE'
op|':'
newline|'\n'
comment|'# Do not respond to clients request'
nl|'\n'
indent|'            '
name|'return'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'DROP_CONNECTION'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'disconnect'
op|'('
op|')'
newline|'\n'
name|'return'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'find'
op|'('
string|'"CAPA"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'INVALID_CAPABILITY_RESPONSE'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'INVALID_RESPONSE'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sendCapabilities'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'elif'
name|'find'
op|'('
string|'"STLS"'
op|')'
name|'and'
name|'SSL_SUPPORT'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'startTLS'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'find'
op|'('
string|'"USER"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'INVALID_LOGIN_RESPONSE'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'INVALID_RESPONSE'
op|')'
newline|'\n'
name|'return'
newline|'\n'
nl|'\n'
dedent|''
name|'resp'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'tmpUser'
op|'='
name|'line'
op|'.'
name|'split'
op|'('
string|'" "'
op|')'
op|'['
number|'1'
op|']'
newline|'\n'
name|'resp'
op|'='
name|'VALID_RESPONSE'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'                '
name|'resp'
op|'='
name|'AUTH_DECLINED'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'resp'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'find'
op|'('
string|'"PASS"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'resp'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'pwd'
op|'='
name|'line'
op|'.'
name|'split'
op|'('
string|'" "'
op|')'
op|'['
number|'1'
op|']'
newline|'\n'
nl|'\n'
name|'if'
name|'self'
op|'.'
name|'tmpUser'
name|'is'
name|'None'
name|'or'
name|'pwd'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'                    '
name|'resp'
op|'='
name|'AUTH_DECLINED'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'tmpUser'
op|'=='
name|'USER'
name|'and'
name|'pwd'
op|'=='
name|'PASS'
op|':'
newline|'\n'
indent|'                    '
name|'resp'
op|'='
name|'AUTH_ACCEPTED'
newline|'\n'
name|'self'
op|'.'
name|'loggedIn'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'resp'
op|'='
name|'AUTH_DECLINED'
newline|'\n'
dedent|''
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'                '
name|'resp'
op|'='
name|'AUTH_DECLINED'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'resp'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'find'
op|'('
string|'"QUIT"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'loggedIn'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'LOGOUT_COMPLETE'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'disconnect'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'INVALID_SERVER_RESPONSE'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'INVALID_RESPONSE'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'not'
name|'self'
op|'.'
name|'loggedIn'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'NOT_LOGGED_IN'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'find'
op|'('
string|'"NOOP"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'VALID_RESPONSE'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'find'
op|'('
string|'"STAT"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'TIMEOUT_DEFERRED'
op|':'
newline|'\n'
indent|'                '
name|'return'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'STAT'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'find'
op|'('
string|'"LIST"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'TIMEOUT_DEFERRED'
op|':'
newline|'\n'
indent|'                '
name|'return'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'LIST'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'find'
op|'('
string|'"UIDL"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'TIMEOUT_DEFERRED'
op|':'
newline|'\n'
indent|'                '
name|'return'
newline|'\n'
dedent|''
name|'elif'
name|'not'
name|'UIDL_SUPPORT'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'INVALID_RESPONSE'
op|')'
newline|'\n'
name|'return'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'sendLine'
op|'('
name|'UIDL'
op|')'
newline|'\n'
nl|'\n'
DECL|member|startTLS
dedent|''
dedent|''
name|'def'
name|'startTLS'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'ctx'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'getContext'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'SSL_SUPPORT'
name|'and'
name|'self'
op|'.'
name|'ctx'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendLine'
op|'('
string|"'+OK Begin TLS negotiation now'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'.'
name|'startTLS'
op|'('
name|'self'
op|'.'
name|'ctx'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sendLine'
op|'('
string|"'-ERR TLS not available'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|disconnect
dedent|''
dedent|''
name|'def'
name|'disconnect'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'transport'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|getContext
dedent|''
name|'def'
name|'getContext'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'ssl'
newline|'\n'
dedent|''
name|'except'
name|'ImportError'
op|':'
newline|'\n'
indent|'           '
name|'self'
op|'.'
name|'ctx'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'ctx'
op|'='
name|'ssl'
op|'.'
name|'ClientContextFactory'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'ctx'
op|'.'
name|'method'
op|'='
name|'ssl'
op|'.'
name|'SSL'
op|'.'
name|'TLSv1_METHOD'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'usage'
op|'='
string|'"""popServer.py [arg] (default is Standard POP Server with no messages)\nno_ssl  - Start with no SSL support\nno_uidl - Start with no UIDL support\nbad_resp - Send a non-RFC compliant response to the Client\nbad_cap_resp - send a non-RFC compliant response when the Client sends a \'CAPABILITY\' request\nbad_login_resp - send a non-RFC compliant response when the Client sends a \'LOGIN\' request\ndeny - Deny the connection\ndrop - Drop the connection after sending the greeting\nbad_tls - Send a bad response to a STARTTLS\ntimeout - Do not return a response to a Client request\nto_deferred - Do not return a response on a \'Select\' request. This\n              will test Deferred callback handling\nslow - Wait 20 seconds after the connection is made to return a Server Greeting\n"""'
newline|'\n'
nl|'\n'
DECL|function|printMessage
name|'def'
name|'printMessage'
op|'('
name|'msg'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'print'
string|'"Server Starting in %s mode"'
op|'%'
name|'msg'
newline|'\n'
nl|'\n'
DECL|function|processArg
dedent|''
name|'def'
name|'processArg'
op|'('
name|'arg'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'if'
name|'arg'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'no_ssl'"
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'SSL_SUPPORT'
newline|'\n'
name|'SSL_SUPPORT'
op|'='
name|'False'
newline|'\n'
name|'printMessage'
op|'('
string|'"NON-SSL"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'arg'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'no_uidl'"
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'UIDL_SUPPORT'
newline|'\n'
name|'UIDL_SUPPORT'
op|'='
name|'False'
newline|'\n'
name|'printMessage'
op|'('
string|'"NON-UIDL"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'arg'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'bad_resp'"
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'INVALID_SERVER_RESPONSE'
newline|'\n'
name|'INVALID_SERVER_RESPONSE'
op|'='
name|'True'
newline|'\n'
name|'printMessage'
op|'('
string|'"Invalid Server Response"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'arg'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'bad_cap_resp'"
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'INVALID_CAPABILITY_RESPONSE'
newline|'\n'
name|'INVALID_CAPABILITY_RESPONSE'
op|'='
name|'True'
newline|'\n'
name|'printMessage'
op|'('
string|'"Invalid Capability Response"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'arg'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'bad_login_resp'"
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'INVALID_LOGIN_RESPONSE'
newline|'\n'
name|'INVALID_LOGIN_RESPONSE'
op|'='
name|'True'
newline|'\n'
name|'printMessage'
op|'('
string|'"Invalid Capability Response"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'arg'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'deny'"
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'DENY_CONNECTION'
newline|'\n'
name|'DENY_CONNECTION'
op|'='
name|'True'
newline|'\n'
name|'printMessage'
op|'('
string|'"Deny Connection"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'arg'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'drop'"
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'DROP_CONNECTION'
newline|'\n'
name|'DROP_CONNECTION'
op|'='
name|'True'
newline|'\n'
name|'printMessage'
op|'('
string|'"Drop Connection"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'arg'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'bad_tls'"
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'BAD_TLS_RESPONSE'
newline|'\n'
name|'BAD_TLS_RESPONSE'
op|'='
name|'True'
newline|'\n'
name|'printMessage'
op|'('
string|'"Bad TLS Response"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'arg'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'timeout'"
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'TIMEOUT_RESPONSE'
newline|'\n'
name|'TIMEOUT_RESPONSE'
op|'='
name|'True'
newline|'\n'
name|'printMessage'
op|'('
string|'"Timeout Response"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'arg'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'to_deferred'"
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'TIMEOUT_DEFERRED'
newline|'\n'
name|'TIMEOUT_DEFERRED'
op|'='
name|'True'
newline|'\n'
name|'printMessage'
op|'('
string|'"Timeout Deferred Response"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'arg'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'slow'"
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'SLOW_GREETING'
newline|'\n'
name|'SLOW_GREETING'
op|'='
name|'True'
newline|'\n'
name|'printMessage'
op|'('
string|'"Slow Greeting"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'elif'
name|'arg'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'--help'"
op|':'
newline|'\n'
indent|'        '
name|'print'
name|'usage'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'print'
name|'usage'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|main
dedent|''
dedent|''
name|'def'
name|'main'
op|'('
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'if'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|')'
op|'<'
number|'2'
op|':'
newline|'\n'
indent|'        '
name|'printMessage'
op|'('
string|'"POP3 with no messages"'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'args'
op|'='
name|'sys'
op|'.'
name|'argv'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
nl|'\n'
name|'for'
name|'arg'
name|'in'
name|'args'
op|':'
newline|'\n'
indent|'            '
name|'processArg'
op|'('
name|'arg'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'f'
op|'='
name|'Factory'
op|'('
op|')'
newline|'\n'
name|'f'
op|'.'
name|'protocol'
op|'='
name|'POP3TestServer'
newline|'\n'
name|'reactor'
op|'.'
name|'listenTCP'
op|'('
name|'PORT'
op|','
name|'f'
op|')'
newline|'\n'
name|'reactor'
op|'.'
name|'run'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
