begin_unit
comment|'# Copyright (c) 2008 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
string|'"""\nTests for implementations of L{IReactorUNIX}.\n"""'
newline|'\n'
nl|'\n'
name|'from'
name|'stat'
name|'import'
name|'S_IMODE'
newline|'\n'
name|'from'
name|'os'
name|'import'
name|'stat'
newline|'\n'
name|'from'
name|'socket'
name|'import'
name|'socket'
op|','
name|'SOCK_DGRAM'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'from'
name|'socket'
name|'import'
name|'AF_UNIX'
newline|'\n'
dedent|''
name|'except'
name|'ImportError'
op|':'
newline|'\n'
DECL|variable|AF_UNIX
indent|'    '
name|'AF_UNIX'
op|'='
name|'None'
newline|'\n'
nl|'\n'
dedent|''
name|'from'
name|'twisted'
op|'.'
name|'trial'
name|'import'
name|'util'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
op|'.'
name|'protocol'
name|'import'
name|'ServerFactory'
op|','
name|'DatagramProtocol'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
op|'.'
name|'protocol'
name|'import'
name|'ConnectedDatagramProtocol'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
op|'.'
name|'test'
op|'.'
name|'reactormixins'
name|'import'
name|'ReactorBuilder'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|_deprecatedModeMessage
name|'_deprecatedModeMessage'
op|'='
op|'('
nl|'\n'
string|"'The mode parameter of %(interface)s.%(method)s will be removed.  Do '"
nl|'\n'
string|"'not pass a value for it.  Set permissions on the containing directory '"
nl|'\n'
string|"'before calling %(interface)s.%(method)s, instead.'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|UNIXFamilyMixin
name|'class'
name|'UNIXFamilyMixin'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    Test-helper defining mixin for things related to AF_UNIX sockets.\n    """'
newline|'\n'
name|'if'
name|'AF_UNIX'
name|'is'
name|'None'
op|':'
newline|'\n'
DECL|variable|skip
indent|'        '
name|'skip'
op|'='
string|'"Platform does not support AF_UNIX sockets"'
newline|'\n'
nl|'\n'
DECL|member|_modeTest
dedent|''
name|'def'
name|'_modeTest'
op|'('
name|'self'
op|','
name|'methodName'
op|','
name|'path'
op|','
name|'factory'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Assert that the mode of the created unix socket is set to the mode\n        specified to the reactor method.\n        """'
newline|'\n'
name|'mode'
op|'='
number|'0600'
newline|'\n'
name|'reactor'
op|'='
name|'self'
op|'.'
name|'buildReactor'
op|'('
op|')'
newline|'\n'
name|'unixPort'
op|'='
name|'getattr'
op|'('
name|'reactor'
op|','
name|'methodName'
op|')'
op|'('
name|'path'
op|','
name|'factory'
op|','
name|'mode'
op|'='
name|'mode'
op|')'
newline|'\n'
name|'unixPort'
op|'.'
name|'stopListening'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'S_IMODE'
op|'('
name|'stat'
op|'('
name|'path'
op|')'
op|'.'
name|'st_mode'
op|')'
op|','
name|'mode'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|_deprecatedModeTest
dedent|''
name|'def'
name|'_deprecatedModeTest'
op|'('
name|'self'
op|','
name|'interfaceName'
op|','
name|'methodName'
op|','
name|'path'
op|','
name|'factory'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Assert that a deprecation warning is emitted when a value is specified\n        for the mode parameter to the indicated reactor method.\n        """'
newline|'\n'
name|'reactor'
op|'='
name|'self'
op|'.'
name|'buildReactor'
op|'('
op|')'
newline|'\n'
name|'method'
op|'='
name|'getattr'
op|'('
name|'reactor'
op|','
name|'methodName'
op|')'
newline|'\n'
name|'port'
op|'='
name|'self'
op|'.'
name|'assertWarns'
op|'('
nl|'\n'
name|'DeprecationWarning'
op|','
nl|'\n'
name|'_deprecatedModeMessage'
op|'%'
name|'dict'
op|'('
nl|'\n'
name|'interface'
op|'='
name|'interfaceName'
op|','
name|'method'
op|'='
name|'methodName'
op|')'
op|','
nl|'\n'
name|'__file__'
op|','
nl|'\n'
name|'lambda'
op|':'
name|'method'
op|'('
name|'path'
op|','
name|'factory'
op|','
name|'mode'
op|'='
number|'0246'
op|')'
op|')'
newline|'\n'
name|'port'
op|'.'
name|'stopListening'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
DECL|class|UNIXTestsBuilder
dedent|''
dedent|''
name|'class'
name|'UNIXTestsBuilder'
op|'('
name|'UNIXFamilyMixin'
op|','
name|'ReactorBuilder'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    Builder defining tests relating to L{IReactorUNIX}.\n    """'
newline|'\n'
DECL|member|test_mode
name|'def'
name|'test_mode'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        The UNIX socket created by L{IReactorUNIX.listenUNIX} is created with\n        the mode specified.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'_modeTest'
op|'('
string|"'listenUNIX'"
op|','
name|'self'
op|'.'
name|'mktemp'
op|'('
op|')'
op|','
name|'ServerFactory'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'test_mode'
op|'.'
name|'suppress'
op|'='
op|'['
nl|'\n'
name|'util'
op|'.'
name|'suppress'
op|'('
name|'category'
op|'='
name|'DeprecationWarning'
op|','
nl|'\n'
name|'message'
op|'='
name|'_deprecatedModeMessage'
op|'%'
name|'dict'
op|'('
nl|'\n'
name|'interface'
op|'='
string|"'IReactorUNIX'"
op|','
nl|'\n'
name|'method'
op|'='
string|"'listenUNIX'"
op|')'
op|')'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_deprecatedMode
name|'def'
name|'test_deprecatedMode'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Passing any value for the C{mode} parameter of L{listenUNIX} causes a\n        deprecation warning to be emitted.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'_deprecatedModeTest'
op|'('
nl|'\n'
string|"'IReactorUNIX'"
op|','
string|"'listenUNIX'"
op|','
name|'self'
op|'.'
name|'mktemp'
op|'('
op|')'
op|','
name|'ServerFactory'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
DECL|class|UNIXDatagramTestsBuilder
dedent|''
dedent|''
name|'class'
name|'UNIXDatagramTestsBuilder'
op|'('
name|'UNIXFamilyMixin'
op|','
name|'ReactorBuilder'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    Builder defining tests relating to L{IReactorUNIXDatagram}.\n    """'
newline|'\n'
comment|"# There's no corresponding test_connectMode because the mode parameter to"
nl|'\n'
comment|'# connectUNIXDatagram has been completely ignored since that API was first'
nl|'\n'
comment|'# introduced.'
nl|'\n'
DECL|member|test_listenMode
name|'def'
name|'test_listenMode'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        The UNIX socket created by L{IReactorUNIXDatagram.listenUNIXDatagram}\n        is created with the mode specified.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'_modeTest'
op|'('
string|"'listenUNIXDatagram'"
op|','
name|'self'
op|'.'
name|'mktemp'
op|'('
op|')'
op|','
name|'DatagramProtocol'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'test_listenMode'
op|'.'
name|'suppress'
op|'='
op|'['
nl|'\n'
name|'util'
op|'.'
name|'suppress'
op|'('
name|'category'
op|'='
name|'DeprecationWarning'
op|','
nl|'\n'
name|'message'
op|'='
name|'_deprecatedModeMessage'
op|'%'
name|'dict'
op|'('
nl|'\n'
name|'interface'
op|'='
string|"'IReactorUNIXDatagram'"
op|','
nl|'\n'
name|'method'
op|'='
string|"'listenUNIXDatagram'"
op|')'
op|')'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_deprecatedListenMode
name|'def'
name|'test_deprecatedListenMode'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Passing any value for the C{mode} parameter of L{listenUNIXDatagram}\n        causes a deprecation warning to be emitted.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'_deprecatedModeTest'
op|'('
nl|'\n'
string|"'IReactorUNIXDatagram'"
op|','
string|"'listenUNIXDatagram'"
op|','
name|'self'
op|'.'
name|'mktemp'
op|'('
op|')'
op|','
nl|'\n'
name|'DatagramProtocol'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_deprecatedConnectMode
dedent|''
name|'def'
name|'test_deprecatedConnectMode'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Passing any value for the C{mode} parameter of L{connectUNIXDatagram}\n        causes a deprecation warning to be emitted.\n        """'
newline|'\n'
name|'path'
op|'='
name|'self'
op|'.'
name|'mktemp'
op|'('
op|')'
newline|'\n'
name|'server'
op|'='
name|'socket'
op|'('
name|'AF_UNIX'
op|','
name|'SOCK_DGRAM'
op|')'
newline|'\n'
name|'server'
op|'.'
name|'bind'
op|'('
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'addCleanup'
op|'('
name|'server'
op|'.'
name|'close'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_deprecatedModeTest'
op|'('
nl|'\n'
string|"'IReactorUNIXDatagram'"
op|','
string|"'connectUNIXDatagram'"
op|','
nl|'\n'
name|'path'
op|','
name|'ConnectedDatagramProtocol'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'globals'
op|'('
op|')'
op|'.'
name|'update'
op|'('
name|'UNIXTestsBuilder'
op|'.'
name|'makeTestCaseClasses'
op|'('
op|')'
op|')'
newline|'\n'
name|'globals'
op|'('
op|')'
op|'.'
name|'update'
op|'('
name|'UNIXDatagramTestsBuilder'
op|'.'
name|'makeTestCaseClasses'
op|'('
op|')'
op|')'
newline|'\n'
endmarker|''
end_unit
