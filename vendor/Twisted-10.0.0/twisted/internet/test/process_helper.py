begin_unit
nl|'\n'
comment|'# A program which exits after starting a child which inherits its'
nl|'\n'
comment|'# stdin/stdout/stderr and keeps them open until stdin is closed.'
nl|'\n'
nl|'\n'
name|'import'
name|'sys'
op|','
name|'os'
newline|'\n'
nl|'\n'
DECL|function|grandchild
name|'def'
name|'grandchild'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'sys'
op|'.'
name|'stdout'
op|'.'
name|'write'
op|'('
string|"'grandchild started'"
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'stdout'
op|'.'
name|'flush'
op|'('
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'stdin'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|main
dedent|''
name|'def'
name|'main'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'sys'
op|'.'
name|'argv'
op|'['
number|'1'
op|']'
op|'=='
string|"'child'"
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'sys'
op|'.'
name|'argv'
op|'['
number|'2'
op|']'
op|'=='
string|"'windows'"
op|':'
newline|'\n'
indent|'            '
name|'import'
name|'win32api'
name|'as'
name|'api'
op|','
name|'win32process'
name|'as'
name|'proc'
newline|'\n'
name|'info'
op|'='
name|'proc'
op|'.'
name|'STARTUPINFO'
op|'('
op|')'
newline|'\n'
name|'info'
op|'.'
name|'hStdInput'
op|'='
name|'api'
op|'.'
name|'GetStdHandle'
op|'('
name|'api'
op|'.'
name|'STD_INPUT_HANDLE'
op|')'
newline|'\n'
name|'info'
op|'.'
name|'hStdOutput'
op|'='
name|'api'
op|'.'
name|'GetStdHandle'
op|'('
name|'api'
op|'.'
name|'STD_OUTPUT_HANDLE'
op|')'
newline|'\n'
name|'info'
op|'.'
name|'hStdError'
op|'='
name|'api'
op|'.'
name|'GetStdHandle'
op|'('
name|'api'
op|'.'
name|'STD_ERROR_HANDLE'
op|')'
newline|'\n'
name|'python'
op|'='
name|'sys'
op|'.'
name|'executable'
newline|'\n'
name|'scriptDir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'__file__'
op|')'
newline|'\n'
name|'scriptName'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'__file__'
op|')'
newline|'\n'
name|'proc'
op|'.'
name|'CreateProcess'
op|'('
nl|'\n'
name|'None'
op|','
string|'" "'
op|'.'
name|'join'
op|'('
op|'('
name|'python'
op|','
name|'scriptName'
op|','
string|'"grandchild"'
op|')'
op|')'
op|','
name|'None'
op|','
nl|'\n'
name|'None'
op|','
number|'1'
op|','
number|'0'
op|','
name|'os'
op|'.'
name|'environ'
op|','
name|'scriptDir'
op|','
name|'info'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'os'
op|'.'
name|'fork'
op|'('
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'grandchild'
op|'('
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'grandchild'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
