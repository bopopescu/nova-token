begin_unit
nl|'\n'
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
string|'"""\nA simple port forwarder.\n"""'
newline|'\n'
nl|'\n'
comment|'# Twisted imports'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'protocol'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'log'
newline|'\n'
nl|'\n'
DECL|class|Proxy
name|'class'
name|'Proxy'
op|'('
name|'protocol'
op|'.'
name|'Protocol'
op|')'
op|':'
newline|'\n'
DECL|variable|noisy
indent|'    '
name|'noisy'
op|'='
name|'True'
newline|'\n'
nl|'\n'
DECL|variable|peer
name|'peer'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|setPeer
name|'def'
name|'setPeer'
op|'('
name|'self'
op|','
name|'peer'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'peer'
op|'='
name|'peer'
newline|'\n'
nl|'\n'
DECL|member|connectionLost
dedent|''
name|'def'
name|'connectionLost'
op|'('
name|'self'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'peer'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'peer'
op|'.'
name|'transport'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'peer'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'noisy'
op|':'
newline|'\n'
indent|'            '
name|'log'
op|'.'
name|'msg'
op|'('
string|'"Unable to connect to peer: %s"'
op|'%'
op|'('
name|'reason'
op|','
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|dataReceived
dedent|''
dedent|''
name|'def'
name|'dataReceived'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'peer'
op|'.'
name|'transport'
op|'.'
name|'write'
op|'('
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|class|ProxyClient
dedent|''
dedent|''
name|'class'
name|'ProxyClient'
op|'('
name|'Proxy'
op|')'
op|':'
newline|'\n'
DECL|member|connectionMade
indent|'    '
name|'def'
name|'connectionMade'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'peer'
op|'.'
name|'setPeer'
op|'('
name|'self'
op|')'
newline|'\n'
comment|"# We're connected, everybody can read to their hearts content."
nl|'\n'
name|'self'
op|'.'
name|'peer'
op|'.'
name|'transport'
op|'.'
name|'resumeProducing'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|class|ProxyClientFactory
dedent|''
dedent|''
name|'class'
name|'ProxyClientFactory'
op|'('
name|'protocol'
op|'.'
name|'ClientFactory'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|protocol
indent|'    '
name|'protocol'
op|'='
name|'ProxyClient'
newline|'\n'
nl|'\n'
DECL|member|setServer
name|'def'
name|'setServer'
op|'('
name|'self'
op|','
name|'server'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'server'
op|'='
name|'server'
newline|'\n'
nl|'\n'
DECL|member|buildProtocol
dedent|''
name|'def'
name|'buildProtocol'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'prot'
op|'='
name|'protocol'
op|'.'
name|'ClientFactory'
op|'.'
name|'buildProtocol'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kw'
op|')'
newline|'\n'
name|'prot'
op|'.'
name|'setPeer'
op|'('
name|'self'
op|'.'
name|'server'
op|')'
newline|'\n'
name|'return'
name|'prot'
newline|'\n'
nl|'\n'
DECL|member|clientConnectionFailed
dedent|''
name|'def'
name|'clientConnectionFailed'
op|'('
name|'self'
op|','
name|'connector'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'server'
op|'.'
name|'transport'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ProxyServer
dedent|''
dedent|''
name|'class'
name|'ProxyServer'
op|'('
name|'Proxy'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|clientProtocolFactory
indent|'    '
name|'clientProtocolFactory'
op|'='
name|'ProxyClientFactory'
newline|'\n'
nl|'\n'
DECL|member|connectionMade
name|'def'
name|'connectionMade'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|"# Don't read anything from the connecting client until we have"
nl|'\n'
comment|'# somewhere to send it to.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'transport'
op|'.'
name|'pauseProducing'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'client'
op|'='
name|'self'
op|'.'
name|'clientProtocolFactory'
op|'('
op|')'
newline|'\n'
name|'client'
op|'.'
name|'setServer'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
name|'reactor'
op|'.'
name|'connectTCP'
op|'('
name|'self'
op|'.'
name|'factory'
op|'.'
name|'host'
op|','
name|'self'
op|'.'
name|'factory'
op|'.'
name|'port'
op|','
name|'client'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ProxyFactory
dedent|''
dedent|''
name|'class'
name|'ProxyFactory'
op|'('
name|'protocol'
op|'.'
name|'Factory'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Factory for port forwarder."""'
newline|'\n'
nl|'\n'
DECL|variable|protocol
name|'protocol'
op|'='
name|'ProxyServer'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'host'
op|','
name|'port'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'host'
op|'='
name|'host'
newline|'\n'
name|'self'
op|'.'
name|'port'
op|'='
name|'port'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
