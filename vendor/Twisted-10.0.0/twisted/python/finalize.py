begin_unit
nl|'\n'
string|'"""\nA module for externalized finalizers.\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'weakref'
newline|'\n'
nl|'\n'
DECL|variable|garbageKey
name|'garbageKey'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|function|callbackFactory
name|'def'
name|'callbackFactory'
op|'('
name|'num'
op|','
name|'fins'
op|')'
op|':'
newline|'\n'
DECL|function|_cb
indent|'    '
name|'def'
name|'_cb'
op|'('
name|'w'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'del'
name|'refs'
op|'['
name|'num'
op|']'
newline|'\n'
name|'for'
name|'fx'
name|'in'
name|'fins'
op|':'
newline|'\n'
indent|'            '
name|'fx'
op|'('
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'_cb'
newline|'\n'
nl|'\n'
DECL|variable|refs
dedent|''
name|'refs'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|register
name|'def'
name|'register'
op|'('
name|'inst'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'global'
name|'garbageKey'
newline|'\n'
name|'garbageKey'
op|'+='
number|'1'
newline|'\n'
name|'r'
op|'='
name|'weakref'
op|'.'
name|'ref'
op|'('
name|'inst'
op|','
name|'callbackFactory'
op|'('
name|'garbageKey'
op|','
name|'inst'
op|'.'
name|'__finalizers__'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'refs'
op|'['
name|'garbageKey'
op|']'
op|'='
name|'r'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
DECL|function|fin
indent|'    '
name|'def'
name|'fin'
op|'('
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'I am _so_ dead.'"
newline|'\n'
nl|'\n'
DECL|class|Finalizeable
dedent|''
name|'class'
name|'Finalizeable'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        An un-sucky __del__\n        """'
newline|'\n'
nl|'\n'
DECL|member|__finalizers__
name|'def'
name|'__finalizers__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'            '
string|'"""\n            I\'m going away.\n            """'
newline|'\n'
name|'return'
op|'['
name|'fin'
op|']'
newline|'\n'
nl|'\n'
DECL|variable|f
dedent|''
dedent|''
name|'f'
op|'='
name|'Finalizeable'
op|'('
op|')'
newline|'\n'
name|'f'
op|'.'
name|'f2'
op|'='
name|'f'
newline|'\n'
name|'register'
op|'('
name|'f'
op|')'
newline|'\n'
name|'del'
name|'f'
newline|'\n'
name|'import'
name|'gc'
newline|'\n'
name|'gc'
op|'.'
name|'collect'
op|'('
op|')'
newline|'\n'
name|'print'
string|"'deled'"
newline|'\n'
dedent|''
endmarker|''
end_unit
