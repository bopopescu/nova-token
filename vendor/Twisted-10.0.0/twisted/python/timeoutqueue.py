begin_unit
comment|'# -*- test-case-name: twisted.test.test_timeoutqueue -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2007 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
string|'"""\nA Queue subclass that supports timeouts.\n"""'
newline|'\n'
nl|'\n'
comment|'# System Imports'
nl|'\n'
name|'import'
name|'Queue'
op|','
name|'time'
op|','
name|'warnings'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|_time
name|'_time'
op|'='
name|'time'
op|'.'
name|'time'
newline|'\n'
DECL|variable|_sleep
name|'_sleep'
op|'='
name|'time'
op|'.'
name|'sleep'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TimedOut
name|'class'
name|'TimedOut'
op|'('
name|'Exception'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TimeoutQueue
dedent|''
name|'class'
name|'TimeoutQueue'
op|'('
name|'Queue'
op|'.'
name|'Queue'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    A thread-safe queue that supports timeouts.\n    """'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'max'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'warnings'
op|'.'
name|'warn'
op|'('
string|'"timeoutqueue is deprecated since Twisted 8.0"'
op|','
nl|'\n'
name|'category'
op|'='
name|'DeprecationWarning'
op|','
name|'stacklevel'
op|'='
number|'2'
op|')'
newline|'\n'
name|'Queue'
op|'.'
name|'Queue'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
name|'max'
op|')'
newline|'\n'
nl|'\n'
DECL|member|wait
dedent|''
name|'def'
name|'wait'
op|'('
name|'self'
op|','
name|'timeout'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Wait until the queue isn\'t empty. Raises TimedOut if still empty.\n        """'
newline|'\n'
name|'endtime'
op|'='
name|'_time'
op|'('
op|')'
op|'+'
name|'timeout'
newline|'\n'
name|'delay'
op|'='
number|'0.0005'
comment|'# 500 us -> initial delay of 1 ms'
newline|'\n'
name|'while'
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'gotit'
op|'='
name|'not'
name|'self'
op|'.'
name|'empty'
op|'('
op|')'
newline|'\n'
name|'if'
name|'gotit'
op|':'
newline|'\n'
indent|'                '
name|'break'
newline|'\n'
dedent|''
name|'remaining'
op|'='
name|'endtime'
op|'-'
name|'_time'
op|'('
op|')'
newline|'\n'
name|'if'
name|'remaining'
op|'<='
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'TimedOut'
op|','
string|'"timed out."'
newline|'\n'
dedent|''
name|'delay'
op|'='
name|'min'
op|'('
name|'delay'
op|'*'
number|'2'
op|','
name|'remaining'
op|','
number|'.05'
op|')'
newline|'\n'
name|'_sleep'
op|'('
name|'delay'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|__all__
dedent|''
dedent|''
dedent|''
name|'__all__'
op|'='
op|'['
string|'"TimeoutQueue"'
op|','
string|'"TimedOut"'
op|']'
newline|'\n'
nl|'\n'
endmarker|''
end_unit
