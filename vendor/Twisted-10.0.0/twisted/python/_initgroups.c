begin_unit
begin_comment
comment|/*****************************************************************************    Copyright (c) 2002 Zope Corporation and Contributors. All Rights Reserved.      This software is subject to the provisions of the Zope Public License,   Version 2.1 (ZPL).  A copy of the ZPL should accompany this distribution.   THIS SOFTWARE IS PROVIDED "AS IS" AND ANY AND ALL EXPRESS OR IMPLIED   WARRANTIES ARE DISCLAIMED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED   WARRANTIES OF TITLE, MERCHANTABILITY, AGAINST INFRINGEMENT, AND FITNESS   FOR A PARTICULAR PURPOSE     ****************************************************************************/
end_comment
begin_comment
comment|/*   * This has been reported for inclusion in Python here: http://bugs.python.org/issue7333  * Hopefully we may be able to remove this file in some years.  */
end_comment
begin_include
include|#
directive|include
file|"Python.h"
end_include
begin_if
if|#
directive|if
name|defined
argument_list|(
name|__unix__
argument_list|)
operator|||
name|defined
argument_list|(
name|unix
argument_list|)
operator|||
name|defined
argument_list|(
name|__NetBSD__
argument_list|)
operator|||
name|defined
argument_list|(
name|__MACH__
argument_list|)
end_if
begin_comment
comment|/* Mac OS X */
end_comment
begin_include
include|#
directive|include
file|<grp.h>
end_include
begin_include
include|#
directive|include
file|<sys/types.h>
end_include
begin_include
include|#
directive|include
file|<unistd.h>
end_include
begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|initgroups_initgroups
name|initgroups_initgroups
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|username
decl_stmt|;
name|unsigned
name|int
name|igid
decl_stmt|;
name|gid_t
name|gid
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"sI:initgroups"
argument_list|,
operator|&
name|username
argument_list|,
operator|&
name|igid
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gid
operator|=
name|igid
expr_stmt|;
if|if
condition|(
name|initgroups
argument_list|(
name|username
argument_list|,
name|gid
argument_list|)
operator|==
operator|-
literal|1
condition|)
return|return
name|PyErr_SetFromErrno
argument_list|(
name|PyExc_OSError
argument_list|)
return|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function
begin_decl_stmt
DECL|variable|InitgroupsMethods
specifier|static
name|PyMethodDef
name|InitgroupsMethods
index|[]
init|=
block|{
block|{
literal|"initgroups"
block|,
name|initgroups_initgroups
block|,
name|METH_VARARGS
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* This module is empty on non-UNIX systems. */
end_comment
begin_decl_stmt
DECL|variable|InitgroupsMethods
specifier|static
name|PyMethodDef
name|InitgroupsMethods
index|[]
init|=
block|{
block|{
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* defined(__unix__) || defined(unix) */
end_comment
begin_function
name|void
DECL|function|init_initgroups
name|init_initgroups
parameter_list|(
name|void
parameter_list|)
block|{
name|Py_InitModule
argument_list|(
literal|"_initgroups"
argument_list|,
name|InitgroupsMethods
argument_list|)
expr_stmt|;
block|}
end_function
end_unit
