begin_unit
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
comment|'#'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'trial'
name|'import'
name|'unittest'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'protocol'
op|','
name|'reactor'
op|','
name|'error'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'failure'
op|','
name|'components'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'pair'
name|'import'
name|'ip'
op|','
name|'raw'
newline|'\n'
name|'from'
name|'zope'
name|'import'
name|'interface'
newline|'\n'
nl|'\n'
DECL|class|MyProtocol
name|'class'
name|'MyProtocol'
op|':'
newline|'\n'
indent|'    '
name|'interface'
op|'.'
name|'implements'
op|'('
name|'raw'
op|'.'
name|'IRawDatagramProtocol'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'expecting'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'expecting'
op|'='
name|'list'
op|'('
name|'expecting'
op|')'
newline|'\n'
nl|'\n'
DECL|member|datagramReceived
dedent|''
name|'def'
name|'datagramReceived'
op|'('
name|'self'
op|','
name|'data'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'assert'
name|'self'
op|'.'
name|'expecting'
op|','
string|"'Got a packet when not expecting anymore.'"
newline|'\n'
name|'expectData'
op|','
name|'expectKw'
op|'='
name|'self'
op|'.'
name|'expecting'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
newline|'\n'
nl|'\n'
name|'expectKwKeys'
op|'='
name|'expectKw'
op|'.'
name|'keys'
op|'('
op|')'
op|';'
name|'expectKwKeys'
op|'.'
name|'sort'
op|'('
op|')'
newline|'\n'
name|'kwKeys'
op|'='
name|'kw'
op|'.'
name|'keys'
op|'('
op|')'
op|';'
name|'kwKeys'
op|'.'
name|'sort'
op|'('
op|')'
newline|'\n'
name|'assert'
name|'expectKwKeys'
op|'=='
name|'kwKeys'
op|','
string|'"Expected %r, got %r"'
op|'%'
op|'('
name|'expectKwKeys'
op|','
name|'kwKeys'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'k'
name|'in'
name|'expectKwKeys'
op|':'
newline|'\n'
indent|'            '
name|'assert'
name|'expectKw'
op|'['
name|'k'
op|']'
op|'=='
name|'kw'
op|'['
name|'k'
op|']'
op|','
string|'"Expected %s=%r, got %r"'
op|'%'
op|'('
name|'k'
op|','
name|'expectKw'
op|'['
name|'k'
op|']'
op|','
name|'kw'
op|'['
name|'k'
op|']'
op|')'
newline|'\n'
dedent|''
name|'assert'
name|'expectKw'
op|'=='
name|'kw'
op|','
string|'"Expected %r, got %r"'
op|'%'
op|'('
name|'expectKw'
op|','
name|'kw'
op|')'
newline|'\n'
name|'assert'
name|'expectData'
op|'=='
name|'data'
op|','
string|'"Expected %r, got %r"'
op|'%'
op|'('
name|'expectData'
op|','
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|class|IPTestCase
dedent|''
dedent|''
name|'class'
name|'IPTestCase'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|testPacketParsing
indent|'    '
name|'def'
name|'testPacketParsing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'proto'
op|'='
name|'ip'
op|'.'
name|'IPProtocol'
op|'('
op|')'
newline|'\n'
name|'p1'
op|'='
name|'MyProtocol'
op|'('
op|'['
nl|'\n'
nl|'\n'
op|'('
string|"'foobar'"
op|','
op|'{'
nl|'\n'
string|"'partial'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'dest'"
op|':'
string|"'1.2.3.4'"
op|','
nl|'\n'
string|"'source'"
op|':'
string|"'5.6.7.8'"
op|','
nl|'\n'
string|"'protocol'"
op|':'
number|'0x0F'
op|','
nl|'\n'
string|"'version'"
op|':'
number|'4'
op|','
nl|'\n'
string|"'ihl'"
op|':'
number|'20'
op|','
nl|'\n'
string|"'tos'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'tot_len'"
op|':'
number|'20'
op|'+'
number|'6'
op|','
nl|'\n'
string|"'fragment_id'"
op|':'
number|'0xDEAD'
op|','
nl|'\n'
string|"'fragment_offset'"
op|':'
number|'0x1EEF'
op|','
nl|'\n'
string|"'dont_fragment'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'more_fragments'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'ttl'"
op|':'
number|'0xC0'
op|','
nl|'\n'
op|'}'
op|')'
op|','
nl|'\n'
nl|'\n'
op|']'
op|')'
newline|'\n'
name|'proto'
op|'.'
name|'addProto'
op|'('
number|'0x0F'
op|','
name|'p1'
op|')'
newline|'\n'
nl|'\n'
name|'proto'
op|'.'
name|'datagramReceived'
op|'('
string|'"\\x54"'
comment|'#ihl version'
nl|'\n'
op|'+'
string|'"\\x07"'
comment|'#tos'
nl|'\n'
op|'+'
string|'"\\x00\\x1a"'
comment|'#tot_len'
nl|'\n'
op|'+'
string|'"\\xDE\\xAD"'
comment|'#id'
nl|'\n'
op|'+'
string|'"\\xBE\\xEF"'
comment|'#frag_off'
nl|'\n'
op|'+'
string|'"\\xC0"'
comment|'#ttl'
nl|'\n'
op|'+'
string|'"\\x0F"'
comment|'#protocol'
nl|'\n'
op|'+'
string|'"FE"'
comment|'#checksum'
nl|'\n'
op|'+'
string|'"\\x05\\x06\\x07\\x08"'
op|'+'
string|'"\\x01\\x02\\x03\\x04"'
op|'+'
string|'"foobar"'
op|','
nl|'\n'
name|'partial'
op|'='
number|'0'
op|','
nl|'\n'
name|'dest'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'source'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'protocol'
op|'='
string|"'dummy'"
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
name|'assert'
name|'not'
name|'p1'
op|'.'
name|'expecting'
op|','
string|"'Should not expect any more packets, but still want %r'"
op|'%'
name|'p1'
op|'.'
name|'expecting'
newline|'\n'
nl|'\n'
DECL|member|testMultiplePackets
dedent|''
name|'def'
name|'testMultiplePackets'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'proto'
op|'='
name|'ip'
op|'.'
name|'IPProtocol'
op|'('
op|')'
newline|'\n'
name|'p1'
op|'='
name|'MyProtocol'
op|'('
op|'['
nl|'\n'
nl|'\n'
op|'('
string|"'foobar'"
op|','
op|'{'
nl|'\n'
string|"'partial'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'dest'"
op|':'
string|"'1.2.3.4'"
op|','
nl|'\n'
string|"'source'"
op|':'
string|"'5.6.7.8'"
op|','
nl|'\n'
string|"'protocol'"
op|':'
number|'0x0F'
op|','
nl|'\n'
string|"'version'"
op|':'
number|'4'
op|','
nl|'\n'
string|"'ihl'"
op|':'
number|'20'
op|','
nl|'\n'
string|"'tos'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'tot_len'"
op|':'
number|'20'
op|'+'
number|'6'
op|','
nl|'\n'
string|"'fragment_id'"
op|':'
number|'0xDEAD'
op|','
nl|'\n'
string|"'fragment_offset'"
op|':'
number|'0x1EEF'
op|','
nl|'\n'
string|"'dont_fragment'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'more_fragments'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'ttl'"
op|':'
number|'0xC0'
op|','
nl|'\n'
op|'}'
op|')'
op|','
nl|'\n'
nl|'\n'
op|'('
string|"'quux'"
op|','
op|'{'
nl|'\n'
string|"'partial'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'dest'"
op|':'
string|"'5.4.3.2'"
op|','
nl|'\n'
string|"'source'"
op|':'
string|"'6.7.8.9'"
op|','
nl|'\n'
string|"'protocol'"
op|':'
number|'0x0F'
op|','
nl|'\n'
string|"'version'"
op|':'
number|'4'
op|','
nl|'\n'
string|"'ihl'"
op|':'
number|'20'
op|','
nl|'\n'
string|"'tos'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'tot_len'"
op|':'
number|'20'
op|'+'
number|'6'
op|','
nl|'\n'
string|"'fragment_id'"
op|':'
number|'0xDEAD'
op|','
nl|'\n'
string|"'fragment_offset'"
op|':'
number|'0x1EEF'
op|','
nl|'\n'
string|"'dont_fragment'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'more_fragments'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'ttl'"
op|':'
number|'0xC0'
op|','
nl|'\n'
op|'}'
op|')'
op|','
nl|'\n'
nl|'\n'
op|']'
op|')'
newline|'\n'
name|'proto'
op|'.'
name|'addProto'
op|'('
number|'0x0F'
op|','
name|'p1'
op|')'
newline|'\n'
name|'proto'
op|'.'
name|'datagramReceived'
op|'('
string|'"\\x54"'
comment|'#ihl version'
nl|'\n'
op|'+'
string|'"\\x07"'
comment|'#tos'
nl|'\n'
op|'+'
string|'"\\x00\\x1a"'
comment|'#tot_len'
nl|'\n'
op|'+'
string|'"\\xDE\\xAD"'
comment|'#id'
nl|'\n'
op|'+'
string|'"\\xBE\\xEF"'
comment|'#frag_off'
nl|'\n'
op|'+'
string|'"\\xC0"'
comment|'#ttl'
nl|'\n'
op|'+'
string|'"\\x0F"'
comment|'#protocol'
nl|'\n'
op|'+'
string|'"FE"'
comment|'#checksum'
nl|'\n'
op|'+'
string|'"\\x05\\x06\\x07\\x08"'
op|'+'
string|'"\\x01\\x02\\x03\\x04"'
op|'+'
string|'"foobar"'
op|','
nl|'\n'
name|'partial'
op|'='
number|'0'
op|','
nl|'\n'
name|'dest'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'source'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'protocol'
op|'='
string|"'dummy'"
op|','
nl|'\n'
op|')'
newline|'\n'
name|'proto'
op|'.'
name|'datagramReceived'
op|'('
string|'"\\x54"'
comment|'#ihl version'
nl|'\n'
op|'+'
string|'"\\x07"'
comment|'#tos'
nl|'\n'
op|'+'
string|'"\\x00\\x1a"'
comment|'#tot_len'
nl|'\n'
op|'+'
string|'"\\xDE\\xAD"'
comment|'#id'
nl|'\n'
op|'+'
string|'"\\xBE\\xEF"'
comment|'#frag_off'
nl|'\n'
op|'+'
string|'"\\xC0"'
comment|'#ttl'
nl|'\n'
op|'+'
string|'"\\x0F"'
comment|'#protocol'
nl|'\n'
op|'+'
string|'"FE"'
comment|'#checksum'
nl|'\n'
op|'+'
string|'"\\x06\\x07\\x08\\x09"'
op|'+'
string|'"\\x05\\x04\\x03\\x02"'
op|'+'
string|'"quux"'
op|','
nl|'\n'
name|'partial'
op|'='
number|'1'
op|','
nl|'\n'
name|'dest'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'source'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'protocol'
op|'='
string|"'dummy'"
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
name|'assert'
name|'not'
name|'p1'
op|'.'
name|'expecting'
op|','
string|"'Should not expect any more packets, but still want %r'"
op|'%'
name|'p1'
op|'.'
name|'expecting'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testMultipleSameProtos
dedent|''
name|'def'
name|'testMultipleSameProtos'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'proto'
op|'='
name|'ip'
op|'.'
name|'IPProtocol'
op|'('
op|')'
newline|'\n'
name|'p1'
op|'='
name|'MyProtocol'
op|'('
op|'['
nl|'\n'
nl|'\n'
op|'('
string|"'foobar'"
op|','
op|'{'
nl|'\n'
string|"'partial'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'dest'"
op|':'
string|"'1.2.3.4'"
op|','
nl|'\n'
string|"'source'"
op|':'
string|"'5.6.7.8'"
op|','
nl|'\n'
string|"'protocol'"
op|':'
number|'0x0F'
op|','
nl|'\n'
string|"'version'"
op|':'
number|'4'
op|','
nl|'\n'
string|"'ihl'"
op|':'
number|'20'
op|','
nl|'\n'
string|"'tos'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'tot_len'"
op|':'
number|'20'
op|'+'
number|'6'
op|','
nl|'\n'
string|"'fragment_id'"
op|':'
number|'0xDEAD'
op|','
nl|'\n'
string|"'fragment_offset'"
op|':'
number|'0x1EEF'
op|','
nl|'\n'
string|"'dont_fragment'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'more_fragments'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'ttl'"
op|':'
number|'0xC0'
op|','
nl|'\n'
op|'}'
op|')'
op|','
nl|'\n'
nl|'\n'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'p2'
op|'='
name|'MyProtocol'
op|'('
op|'['
nl|'\n'
nl|'\n'
op|'('
string|"'foobar'"
op|','
op|'{'
nl|'\n'
string|"'partial'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'dest'"
op|':'
string|"'1.2.3.4'"
op|','
nl|'\n'
string|"'source'"
op|':'
string|"'5.6.7.8'"
op|','
nl|'\n'
string|"'protocol'"
op|':'
number|'0x0F'
op|','
nl|'\n'
string|"'version'"
op|':'
number|'4'
op|','
nl|'\n'
string|"'ihl'"
op|':'
number|'20'
op|','
nl|'\n'
string|"'tos'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'tot_len'"
op|':'
number|'20'
op|'+'
number|'6'
op|','
nl|'\n'
string|"'fragment_id'"
op|':'
number|'0xDEAD'
op|','
nl|'\n'
string|"'fragment_offset'"
op|':'
number|'0x1EEF'
op|','
nl|'\n'
string|"'dont_fragment'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'more_fragments'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'ttl'"
op|':'
number|'0xC0'
op|','
nl|'\n'
op|'}'
op|')'
op|','
nl|'\n'
nl|'\n'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'proto'
op|'.'
name|'addProto'
op|'('
number|'0x0F'
op|','
name|'p1'
op|')'
newline|'\n'
name|'proto'
op|'.'
name|'addProto'
op|'('
number|'0x0F'
op|','
name|'p2'
op|')'
newline|'\n'
nl|'\n'
name|'proto'
op|'.'
name|'datagramReceived'
op|'('
string|'"\\x54"'
comment|'#ihl version'
nl|'\n'
op|'+'
string|'"\\x07"'
comment|'#tos'
nl|'\n'
op|'+'
string|'"\\x00\\x1a"'
comment|'#tot_len'
nl|'\n'
op|'+'
string|'"\\xDE\\xAD"'
comment|'#id'
nl|'\n'
op|'+'
string|'"\\xBE\\xEF"'
comment|'#frag_off'
nl|'\n'
op|'+'
string|'"\\xC0"'
comment|'#ttl'
nl|'\n'
op|'+'
string|'"\\x0F"'
comment|'#protocol'
nl|'\n'
op|'+'
string|'"FE"'
comment|'#checksum'
nl|'\n'
op|'+'
string|'"\\x05\\x06\\x07\\x08"'
op|'+'
string|'"\\x01\\x02\\x03\\x04"'
op|'+'
string|'"foobar"'
op|','
nl|'\n'
name|'partial'
op|'='
number|'0'
op|','
nl|'\n'
name|'dest'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'source'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'protocol'
op|'='
string|"'dummy'"
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
name|'assert'
name|'not'
name|'p1'
op|'.'
name|'expecting'
op|','
string|"'Should not expect any more packets, but still want %r'"
op|'%'
name|'p1'
op|'.'
name|'expecting'
newline|'\n'
name|'assert'
name|'not'
name|'p2'
op|'.'
name|'expecting'
op|','
string|"'Should not expect any more packets, but still want %r'"
op|'%'
name|'p2'
op|'.'
name|'expecting'
newline|'\n'
nl|'\n'
DECL|member|testWrongProtoNotSeen
dedent|''
name|'def'
name|'testWrongProtoNotSeen'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'proto'
op|'='
name|'ip'
op|'.'
name|'IPProtocol'
op|'('
op|')'
newline|'\n'
name|'p1'
op|'='
name|'MyProtocol'
op|'('
op|'['
op|']'
op|')'
newline|'\n'
name|'proto'
op|'.'
name|'addProto'
op|'('
number|'1'
op|','
name|'p1'
op|')'
newline|'\n'
nl|'\n'
name|'proto'
op|'.'
name|'datagramReceived'
op|'('
string|'"\\x54"'
comment|'#ihl version'
nl|'\n'
op|'+'
string|'"\\x07"'
comment|'#tos'
nl|'\n'
op|'+'
string|'"\\x00\\x1a"'
comment|'#tot_len'
nl|'\n'
op|'+'
string|'"\\xDE\\xAD"'
comment|'#id'
nl|'\n'
op|'+'
string|'"\\xBE\\xEF"'
comment|'#frag_off'
nl|'\n'
op|'+'
string|'"\\xC0"'
comment|'#ttl'
nl|'\n'
op|'+'
string|'"\\x0F"'
comment|'#protocol'
nl|'\n'
op|'+'
string|'"FE"'
comment|'#checksum'
nl|'\n'
op|'+'
string|'"\\x05\\x06\\x07\\x08"'
op|'+'
string|'"\\x01\\x02\\x03\\x04"'
op|'+'
string|'"foobar"'
op|','
nl|'\n'
name|'partial'
op|'='
number|'0'
op|','
nl|'\n'
name|'dest'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'source'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'protocol'
op|'='
string|"'dummy'"
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testDemuxing
dedent|''
name|'def'
name|'testDemuxing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'proto'
op|'='
name|'ip'
op|'.'
name|'IPProtocol'
op|'('
op|')'
newline|'\n'
name|'p1'
op|'='
name|'MyProtocol'
op|'('
op|'['
nl|'\n'
nl|'\n'
op|'('
string|"'foobar'"
op|','
op|'{'
nl|'\n'
string|"'partial'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'dest'"
op|':'
string|"'1.2.3.4'"
op|','
nl|'\n'
string|"'source'"
op|':'
string|"'5.6.7.8'"
op|','
nl|'\n'
string|"'protocol'"
op|':'
number|'0x0F'
op|','
nl|'\n'
string|"'version'"
op|':'
number|'4'
op|','
nl|'\n'
string|"'ihl'"
op|':'
number|'20'
op|','
nl|'\n'
string|"'tos'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'tot_len'"
op|':'
number|'20'
op|'+'
number|'6'
op|','
nl|'\n'
string|"'fragment_id'"
op|':'
number|'0xDEAD'
op|','
nl|'\n'
string|"'fragment_offset'"
op|':'
number|'0x1EEF'
op|','
nl|'\n'
string|"'dont_fragment'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'more_fragments'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'ttl'"
op|':'
number|'0xC0'
op|','
nl|'\n'
op|'}'
op|')'
op|','
nl|'\n'
nl|'\n'
op|'('
string|"'quux'"
op|','
op|'{'
nl|'\n'
string|"'partial'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'dest'"
op|':'
string|"'5.4.3.2'"
op|','
nl|'\n'
string|"'source'"
op|':'
string|"'6.7.8.9'"
op|','
nl|'\n'
string|"'protocol'"
op|':'
number|'0x0F'
op|','
nl|'\n'
string|"'version'"
op|':'
number|'4'
op|','
nl|'\n'
string|"'ihl'"
op|':'
number|'20'
op|','
nl|'\n'
string|"'tos'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'tot_len'"
op|':'
number|'20'
op|'+'
number|'6'
op|','
nl|'\n'
string|"'fragment_id'"
op|':'
number|'0xDEAD'
op|','
nl|'\n'
string|"'fragment_offset'"
op|':'
number|'0x1EEF'
op|','
nl|'\n'
string|"'dont_fragment'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'more_fragments'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'ttl'"
op|':'
number|'0xC0'
op|','
nl|'\n'
op|'}'
op|')'
op|','
nl|'\n'
nl|'\n'
op|']'
op|')'
newline|'\n'
name|'proto'
op|'.'
name|'addProto'
op|'('
number|'0x0F'
op|','
name|'p1'
op|')'
newline|'\n'
nl|'\n'
name|'p2'
op|'='
name|'MyProtocol'
op|'('
op|'['
nl|'\n'
nl|'\n'
op|'('
string|"'quux'"
op|','
op|'{'
nl|'\n'
string|"'partial'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'dest'"
op|':'
string|"'5.4.3.2'"
op|','
nl|'\n'
string|"'source'"
op|':'
string|"'6.7.8.9'"
op|','
nl|'\n'
string|"'protocol'"
op|':'
number|'0x0A'
op|','
nl|'\n'
string|"'version'"
op|':'
number|'4'
op|','
nl|'\n'
string|"'ihl'"
op|':'
number|'20'
op|','
nl|'\n'
string|"'tos'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'tot_len'"
op|':'
number|'20'
op|'+'
number|'6'
op|','
nl|'\n'
string|"'fragment_id'"
op|':'
number|'0xDEAD'
op|','
nl|'\n'
string|"'fragment_offset'"
op|':'
number|'0x1EEF'
op|','
nl|'\n'
string|"'dont_fragment'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'more_fragments'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'ttl'"
op|':'
number|'0xC0'
op|','
nl|'\n'
op|'}'
op|')'
op|','
nl|'\n'
nl|'\n'
op|'('
string|"'foobar'"
op|','
op|'{'
nl|'\n'
string|"'partial'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'dest'"
op|':'
string|"'1.2.3.4'"
op|','
nl|'\n'
string|"'source'"
op|':'
string|"'5.6.7.8'"
op|','
nl|'\n'
string|"'protocol'"
op|':'
number|'0x0A'
op|','
nl|'\n'
string|"'version'"
op|':'
number|'4'
op|','
nl|'\n'
string|"'ihl'"
op|':'
number|'20'
op|','
nl|'\n'
string|"'tos'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'tot_len'"
op|':'
number|'20'
op|'+'
number|'6'
op|','
nl|'\n'
string|"'fragment_id'"
op|':'
number|'0xDEAD'
op|','
nl|'\n'
string|"'fragment_offset'"
op|':'
number|'0x1EEF'
op|','
nl|'\n'
string|"'dont_fragment'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'more_fragments'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'ttl'"
op|':'
number|'0xC0'
op|','
nl|'\n'
op|'}'
op|')'
op|','
nl|'\n'
nl|'\n'
nl|'\n'
op|']'
op|')'
newline|'\n'
name|'proto'
op|'.'
name|'addProto'
op|'('
number|'0x0A'
op|','
name|'p2'
op|')'
newline|'\n'
nl|'\n'
name|'proto'
op|'.'
name|'datagramReceived'
op|'('
string|'"\\x54"'
comment|'#ihl version'
nl|'\n'
op|'+'
string|'"\\x07"'
comment|'#tos'
nl|'\n'
op|'+'
string|'"\\x00\\x1a"'
comment|'#tot_len'
nl|'\n'
op|'+'
string|'"\\xDE\\xAD"'
comment|'#id'
nl|'\n'
op|'+'
string|'"\\xBE\\xEF"'
comment|'#frag_off'
nl|'\n'
op|'+'
string|'"\\xC0"'
comment|'#ttl'
nl|'\n'
op|'+'
string|'"\\x0A"'
comment|'#protocol'
nl|'\n'
op|'+'
string|'"FE"'
comment|'#checksum'
nl|'\n'
op|'+'
string|'"\\x06\\x07\\x08\\x09"'
op|'+'
string|'"\\x05\\x04\\x03\\x02"'
op|'+'
string|'"quux"'
op|','
nl|'\n'
name|'partial'
op|'='
number|'1'
op|','
nl|'\n'
name|'dest'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'source'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'protocol'
op|'='
string|"'dummy'"
op|','
nl|'\n'
op|')'
newline|'\n'
name|'proto'
op|'.'
name|'datagramReceived'
op|'('
string|'"\\x54"'
comment|'#ihl version'
nl|'\n'
op|'+'
string|'"\\x07"'
comment|'#tos'
nl|'\n'
op|'+'
string|'"\\x00\\x1a"'
comment|'#tot_len'
nl|'\n'
op|'+'
string|'"\\xDE\\xAD"'
comment|'#id'
nl|'\n'
op|'+'
string|'"\\xBE\\xEF"'
comment|'#frag_off'
nl|'\n'
op|'+'
string|'"\\xC0"'
comment|'#ttl'
nl|'\n'
op|'+'
string|'"\\x0F"'
comment|'#protocol'
nl|'\n'
op|'+'
string|'"FE"'
comment|'#checksum'
nl|'\n'
op|'+'
string|'"\\x05\\x06\\x07\\x08"'
op|'+'
string|'"\\x01\\x02\\x03\\x04"'
op|'+'
string|'"foobar"'
op|','
nl|'\n'
name|'partial'
op|'='
number|'0'
op|','
nl|'\n'
name|'dest'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'source'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'protocol'
op|'='
string|"'dummy'"
op|','
nl|'\n'
op|')'
newline|'\n'
name|'proto'
op|'.'
name|'datagramReceived'
op|'('
string|'"\\x54"'
comment|'#ihl version'
nl|'\n'
op|'+'
string|'"\\x07"'
comment|'#tos'
nl|'\n'
op|'+'
string|'"\\x00\\x1a"'
comment|'#tot_len'
nl|'\n'
op|'+'
string|'"\\xDE\\xAD"'
comment|'#id'
nl|'\n'
op|'+'
string|'"\\xBE\\xEF"'
comment|'#frag_off'
nl|'\n'
op|'+'
string|'"\\xC0"'
comment|'#ttl'
nl|'\n'
op|'+'
string|'"\\x0F"'
comment|'#protocol'
nl|'\n'
op|'+'
string|'"FE"'
comment|'#checksum'
nl|'\n'
op|'+'
string|'"\\x06\\x07\\x08\\x09"'
op|'+'
string|'"\\x05\\x04\\x03\\x02"'
op|'+'
string|'"quux"'
op|','
nl|'\n'
name|'partial'
op|'='
number|'1'
op|','
nl|'\n'
name|'dest'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'source'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'protocol'
op|'='
string|"'dummy'"
op|','
nl|'\n'
op|')'
newline|'\n'
name|'proto'
op|'.'
name|'datagramReceived'
op|'('
string|'"\\x54"'
comment|'#ihl version'
nl|'\n'
op|'+'
string|'"\\x07"'
comment|'#tos'
nl|'\n'
op|'+'
string|'"\\x00\\x1a"'
comment|'#tot_len'
nl|'\n'
op|'+'
string|'"\\xDE\\xAD"'
comment|'#id'
nl|'\n'
op|'+'
string|'"\\xBE\\xEF"'
comment|'#frag_off'
nl|'\n'
op|'+'
string|'"\\xC0"'
comment|'#ttl'
nl|'\n'
op|'+'
string|'"\\x0A"'
comment|'#protocol'
nl|'\n'
op|'+'
string|'"FE"'
comment|'#checksum'
nl|'\n'
op|'+'
string|'"\\x05\\x06\\x07\\x08"'
op|'+'
string|'"\\x01\\x02\\x03\\x04"'
op|'+'
string|'"foobar"'
op|','
nl|'\n'
name|'partial'
op|'='
number|'0'
op|','
nl|'\n'
name|'dest'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'source'
op|'='
string|"'dummy'"
op|','
nl|'\n'
name|'protocol'
op|'='
string|"'dummy'"
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
name|'assert'
name|'not'
name|'p1'
op|'.'
name|'expecting'
op|','
string|"'Should not expect any more packets, but still want %r'"
op|'%'
name|'p1'
op|'.'
name|'expecting'
newline|'\n'
name|'assert'
name|'not'
name|'p2'
op|'.'
name|'expecting'
op|','
string|"'Should not expect any more packets, but still want %r'"
op|'%'
name|'p2'
op|'.'
name|'expecting'
newline|'\n'
nl|'\n'
DECL|member|testAddingBadProtos_WrongLevel
dedent|''
name|'def'
name|'testAddingBadProtos_WrongLevel'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Adding a wrong level protocol raises an exception."""'
newline|'\n'
name|'e'
op|'='
name|'ip'
op|'.'
name|'IPProtocol'
op|'('
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'e'
op|'.'
name|'addProto'
op|'('
number|'42'
op|','
string|'"silliness"'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'components'
op|'.'
name|'CannotAdapt'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'AssertionError'
op|','
string|"'addProto must raise an exception for bad protocols'"
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testAddingBadProtos_TooSmall
dedent|''
dedent|''
name|'def'
name|'testAddingBadProtos_TooSmall'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Adding a protocol with a negative number raises an exception."""'
newline|'\n'
name|'e'
op|'='
name|'ip'
op|'.'
name|'IPProtocol'
op|'('
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'e'
op|'.'
name|'addProto'
op|'('
op|'-'
number|'1'
op|','
name|'MyProtocol'
op|'('
op|'['
op|']'
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'TypeError'
op|','
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'e'
op|'.'
name|'args'
op|'=='
op|'('
string|"'Added protocol must be positive or zero'"
op|','
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'raise'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'AssertionError'
op|','
string|"'addProto must raise an exception for bad protocols'"
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testAddingBadProtos_TooBig
dedent|''
dedent|''
name|'def'
name|'testAddingBadProtos_TooBig'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Adding a protocol with a number >=2**32 raises an exception."""'
newline|'\n'
name|'e'
op|'='
name|'ip'
op|'.'
name|'IPProtocol'
op|'('
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'e'
op|'.'
name|'addProto'
op|'('
number|'2L'
op|'**'
number|'32'
op|','
name|'MyProtocol'
op|'('
op|'['
op|']'
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'TypeError'
op|','
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'e'
op|'.'
name|'args'
op|'=='
op|'('
string|"'Added protocol must fit in 32 bits'"
op|','
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'raise'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'AssertionError'
op|','
string|"'addProto must raise an exception for bad protocols'"
newline|'\n'
nl|'\n'
DECL|member|testAddingBadProtos_TooBig2
dedent|''
dedent|''
name|'def'
name|'testAddingBadProtos_TooBig2'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Adding a protocol with a number >=2**32 raises an exception."""'
newline|'\n'
name|'e'
op|'='
name|'ip'
op|'.'
name|'IPProtocol'
op|'('
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'e'
op|'.'
name|'addProto'
op|'('
number|'2L'
op|'**'
number|'32'
op|'+'
number|'1'
op|','
name|'MyProtocol'
op|'('
op|'['
op|']'
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'TypeError'
op|','
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'e'
op|'.'
name|'args'
op|'=='
op|'('
string|"'Added protocol must fit in 32 bits'"
op|','
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'raise'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'AssertionError'
op|','
string|"'addProto must raise an exception for bad protocols'"
newline|'\n'
dedent|''
dedent|''
dedent|''
endmarker|''
end_unit
