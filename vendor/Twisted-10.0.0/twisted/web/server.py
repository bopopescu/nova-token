begin_unit
comment|'# -*- test-case-name: twisted.web.test.test_web -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2009 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
string|'"""\nThis is a web-server which integrates with the twisted.internet\ninfrastructure.\n"""'
newline|'\n'
nl|'\n'
comment|'# System Imports'
nl|'\n'
nl|'\n'
name|'import'
name|'warnings'
newline|'\n'
name|'import'
name|'string'
newline|'\n'
name|'import'
name|'types'
newline|'\n'
name|'import'
name|'copy'
newline|'\n'
name|'import'
name|'os'
newline|'\n'
name|'from'
name|'urllib'
name|'import'
name|'quote'
newline|'\n'
nl|'\n'
name|'from'
name|'zope'
op|'.'
name|'interface'
name|'import'
name|'implements'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'from'
name|'twisted'
op|'.'
name|'protocols'
op|'.'
name|'_c_urlarg'
name|'import'
name|'unquote'
newline|'\n'
dedent|''
name|'except'
name|'ImportError'
op|':'
newline|'\n'
indent|'    '
name|'from'
name|'urllib'
name|'import'
name|'unquote'
newline|'\n'
nl|'\n'
comment|'#some useful constants'
nl|'\n'
DECL|variable|NOT_DONE_YET
dedent|''
name|'NOT_DONE_YET'
op|'='
number|'1'
newline|'\n'
nl|'\n'
comment|'# Twisted Imports'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'spread'
name|'import'
name|'pb'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'defer'
op|','
name|'address'
op|','
name|'task'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'web'
name|'import'
name|'iweb'
op|','
name|'http'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'log'
op|','
name|'reflect'
op|','
name|'failure'
op|','
name|'components'
newline|'\n'
name|'from'
name|'twisted'
name|'import'
name|'copyright'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'web'
name|'import'
name|'util'
name|'as'
name|'webutil'
op|','
name|'resource'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'web'
op|'.'
name|'error'
name|'import'
name|'UnsupportedMethod'
newline|'\n'
nl|'\n'
comment|'# backwards compatability'
nl|'\n'
DECL|variable|date_time_string
name|'date_time_string'
op|'='
name|'http'
op|'.'
name|'datetimeToString'
newline|'\n'
DECL|variable|string_date_time
name|'string_date_time'
op|'='
name|'http'
op|'.'
name|'stringToDatetime'
newline|'\n'
nl|'\n'
comment|'# Support for other methods may be implemented on a per-resource basis.'
nl|'\n'
DECL|variable|supportedMethods
name|'supportedMethods'
op|'='
op|'('
string|"'GET'"
op|','
string|"'HEAD'"
op|','
string|"'POST'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_addressToTuple
name|'def'
name|'_addressToTuple'
op|'('
name|'addr'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'isinstance'
op|'('
name|'addr'
op|','
name|'address'
op|'.'
name|'IPv4Address'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
op|'('
string|"'INET'"
op|','
name|'addr'
op|'.'
name|'host'
op|','
name|'addr'
op|'.'
name|'port'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'isinstance'
op|'('
name|'addr'
op|','
name|'address'
op|'.'
name|'UNIXAddress'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
op|'('
string|"'UNIX'"
op|','
name|'addr'
op|'.'
name|'name'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'tuple'
op|'('
name|'addr'
op|')'
newline|'\n'
nl|'\n'
DECL|class|Request
dedent|''
dedent|''
name|'class'
name|'Request'
op|'('
name|'pb'
op|'.'
name|'Copyable'
op|','
name|'http'
op|'.'
name|'Request'
op|','
name|'components'
op|'.'
name|'Componentized'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'implements'
op|'('
name|'iweb'
op|'.'
name|'IRequest'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|site
name|'site'
op|'='
name|'None'
newline|'\n'
DECL|variable|appRootURL
name|'appRootURL'
op|'='
name|'None'
newline|'\n'
name|'__pychecker__'
op|'='
string|"'unusednames=issuer'"
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'http'
op|'.'
name|'Request'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kw'
op|')'
newline|'\n'
name|'components'
op|'.'
name|'Componentized'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getStateToCopyFor
dedent|''
name|'def'
name|'getStateToCopyFor'
op|'('
name|'self'
op|','
name|'issuer'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'x'
op|'='
name|'self'
op|'.'
name|'__dict__'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'del'
name|'x'
op|'['
string|"'transport'"
op|']'
newline|'\n'
comment|"# XXX refactor this attribute out; it's from protocol"
nl|'\n'
comment|"# del x['server']"
nl|'\n'
name|'del'
name|'x'
op|'['
string|"'channel'"
op|']'
newline|'\n'
name|'del'
name|'x'
op|'['
string|"'content'"
op|']'
newline|'\n'
name|'del'
name|'x'
op|'['
string|"'site'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'content'
op|'.'
name|'seek'
op|'('
number|'0'
op|','
number|'0'
op|')'
newline|'\n'
name|'x'
op|'['
string|"'content_data'"
op|']'
op|'='
name|'self'
op|'.'
name|'content'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'x'
op|'['
string|"'remote'"
op|']'
op|'='
name|'pb'
op|'.'
name|'ViewPoint'
op|'('
name|'issuer'
op|','
name|'self'
op|')'
newline|'\n'
nl|'\n'
comment|"# Address objects aren't jellyable"
nl|'\n'
name|'x'
op|'['
string|"'host'"
op|']'
op|'='
name|'_addressToTuple'
op|'('
name|'x'
op|'['
string|"'host'"
op|']'
op|')'
newline|'\n'
name|'x'
op|'['
string|"'client'"
op|']'
op|'='
name|'_addressToTuple'
op|'('
name|'x'
op|'['
string|"'client'"
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|"# Header objects also aren't jellyable."
nl|'\n'
name|'x'
op|'['
string|"'requestHeaders'"
op|']'
op|'='
name|'list'
op|'('
name|'x'
op|'['
string|"'requestHeaders'"
op|']'
op|'.'
name|'getAllRawHeaders'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'return'
name|'x'
newline|'\n'
nl|'\n'
comment|'# HTML generation helpers'
nl|'\n'
nl|'\n'
DECL|member|sibLink
dedent|''
name|'def'
name|'sibLink'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"Return the text that links to a sibling of the requested resource."'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'postpath'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'('
name|'len'
op|'('
name|'self'
op|'.'
name|'postpath'
op|')'
op|'*'
string|'"../"'
op|')'
op|'+'
name|'name'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'name'
newline|'\n'
nl|'\n'
DECL|member|childLink
dedent|''
dedent|''
name|'def'
name|'childLink'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"Return the text that links to a child of the requested resource."'
newline|'\n'
name|'lpp'
op|'='
name|'len'
op|'('
name|'self'
op|'.'
name|'postpath'
op|')'
newline|'\n'
name|'if'
name|'lpp'
op|'>'
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'('
op|'('
name|'lpp'
op|'-'
number|'1'
op|')'
op|'*'
string|'"../"'
op|')'
op|'+'
name|'name'
newline|'\n'
dedent|''
name|'elif'
name|'lpp'
op|'=='
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'name'
newline|'\n'
dedent|''
name|'else'
op|':'
comment|'# lpp == 0'
newline|'\n'
indent|'            '
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'prepath'
op|')'
name|'and'
name|'self'
op|'.'
name|'prepath'
op|'['
op|'-'
number|'1'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'self'
op|'.'
name|'prepath'
op|'['
op|'-'
number|'1'
op|']'
op|'+'
string|"'/'"
op|'+'
name|'name'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'name'
newline|'\n'
nl|'\n'
DECL|member|process
dedent|''
dedent|''
dedent|''
name|'def'
name|'process'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"Process a request."'
newline|'\n'
nl|'\n'
comment|'# get site from channel'
nl|'\n'
name|'self'
op|'.'
name|'site'
op|'='
name|'self'
op|'.'
name|'channel'
op|'.'
name|'site'
newline|'\n'
nl|'\n'
comment|'# set various default headers'
nl|'\n'
name|'self'
op|'.'
name|'setHeader'
op|'('
string|"'server'"
op|','
name|'version'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'setHeader'
op|'('
string|"'date'"
op|','
name|'http'
op|'.'
name|'datetimeToString'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'setHeader'
op|'('
string|"'content-type'"
op|','
string|'"text/html"'
op|')'
newline|'\n'
nl|'\n'
comment|'# Resource Identification'
nl|'\n'
name|'self'
op|'.'
name|'prepath'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'postpath'
op|'='
name|'map'
op|'('
name|'unquote'
op|','
name|'string'
op|'.'
name|'split'
op|'('
name|'self'
op|'.'
name|'path'
op|'['
number|'1'
op|':'
op|']'
op|','
string|"'/'"
op|')'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'resrc'
op|'='
name|'self'
op|'.'
name|'site'
op|'.'
name|'getResourceFor'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'render'
op|'('
name|'resrc'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'processingFailed'
op|'('
name|'failure'
op|'.'
name|'Failure'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|render
dedent|''
dedent|''
name|'def'
name|'render'
op|'('
name|'self'
op|','
name|'resrc'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
name|'resrc'
op|'.'
name|'render'
op|'('
name|'self'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'UnsupportedMethod'
op|','
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'allowedMethods'
op|'='
name|'e'
op|'.'
name|'allowedMethods'
newline|'\n'
name|'if'
op|'('
name|'self'
op|'.'
name|'method'
op|'=='
string|'"HEAD"'
op|')'
name|'and'
op|'('
string|'"GET"'
name|'in'
name|'allowedMethods'
op|')'
op|':'
newline|'\n'
comment|'# We must support HEAD (RFC 2616, 5.1.1).  If the'
nl|'\n'
comment|"# resource doesn't, fake it by giving the resource"
nl|'\n'
comment|"# a 'GET' request and then return only the headers,"
nl|'\n'
comment|'# not the body.'
nl|'\n'
indent|'                '
name|'log'
op|'.'
name|'msg'
op|'('
string|'"Using GET to fake a HEAD request for %s"'
op|'%'
nl|'\n'
op|'('
name|'resrc'
op|','
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'method'
op|'='
string|'"GET"'
newline|'\n'
name|'body'
op|'='
name|'resrc'
op|'.'
name|'render'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'body'
name|'is'
name|'NOT_DONE_YET'
op|':'
newline|'\n'
indent|'                    '
name|'log'
op|'.'
name|'msg'
op|'('
string|'"Tried to fake a HEAD request for %s, but "'
nl|'\n'
string|'"it got away from me."'
op|'%'
name|'resrc'
op|')'
newline|'\n'
comment|"# Oh well, I guess we won't include the content length."
nl|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'setHeader'
op|'('
string|"'content-length'"
op|','
name|'str'
op|'('
name|'len'
op|'('
name|'body'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'write'
op|'('
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'finish'
op|'('
op|')'
newline|'\n'
name|'return'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'method'
name|'in'
op|'('
name|'supportedMethods'
op|')'
op|':'
newline|'\n'
comment|'# We MUST include an Allow header'
nl|'\n'
comment|'# (RFC 2616, 10.4.6 and 14.7)'
nl|'\n'
indent|'                '
name|'self'
op|'.'
name|'setHeader'
op|'('
string|"'Allow'"
op|','
name|'allowedMethods'
op|')'
newline|'\n'
name|'s'
op|'='
op|'('
string|"'''Your browser approached me (at %(URI)s) with'''"
nl|'\n'
string|'\'\'\' the method "%(method)s".  I only allow\'\'\''
nl|'\n'
string|"''' the method%(plural)s %(allowed)s here.'''"
op|'%'
op|'{'
nl|'\n'
string|"'URI'"
op|':'
name|'self'
op|'.'
name|'uri'
op|','
nl|'\n'
string|"'method'"
op|':'
name|'self'
op|'.'
name|'method'
op|','
nl|'\n'
string|"'plural'"
op|':'
op|'('
op|'('
name|'len'
op|'('
name|'allowedMethods'
op|')'
op|'>'
number|'1'
op|')'
name|'and'
string|"'s'"
op|')'
name|'or'
string|"''"
op|','
nl|'\n'
string|"'allowed'"
op|':'
name|'string'
op|'.'
name|'join'
op|'('
name|'allowedMethods'
op|','
string|"', '"
op|')'
nl|'\n'
op|'}'
op|')'
newline|'\n'
name|'epage'
op|'='
name|'resource'
op|'.'
name|'ErrorPage'
op|'('
name|'http'
op|'.'
name|'NOT_ALLOWED'
op|','
nl|'\n'
string|'"Method Not Allowed"'
op|','
name|'s'
op|')'
newline|'\n'
name|'body'
op|'='
name|'epage'
op|'.'
name|'render'
op|'('
name|'self'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'epage'
op|'='
name|'resource'
op|'.'
name|'ErrorPage'
op|'('
name|'http'
op|'.'
name|'NOT_IMPLEMENTED'
op|','
string|'"Huh?"'
op|','
nl|'\n'
string|'"I don\'t know how to treat a"'
nl|'\n'
string|'" %s request."'
op|'%'
op|'('
name|'self'
op|'.'
name|'method'
op|','
op|')'
op|')'
newline|'\n'
name|'body'
op|'='
name|'epage'
op|'.'
name|'render'
op|'('
name|'self'
op|')'
newline|'\n'
comment|'# end except UnsupportedMethod'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'body'
op|'=='
name|'NOT_DONE_YET'
op|':'
newline|'\n'
indent|'            '
name|'return'
newline|'\n'
dedent|''
name|'if'
name|'type'
op|'('
name|'body'
op|')'
name|'is'
name|'not'
name|'types'
op|'.'
name|'StringType'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
name|'resource'
op|'.'
name|'ErrorPage'
op|'('
nl|'\n'
name|'http'
op|'.'
name|'INTERNAL_SERVER_ERROR'
op|','
nl|'\n'
string|'"Request did not return a string"'
op|','
nl|'\n'
string|'"Request: "'
op|'+'
name|'html'
op|'.'
name|'PRE'
op|'('
name|'reflect'
op|'.'
name|'safe_repr'
op|'('
name|'self'
op|')'
op|')'
op|'+'
string|'"<br />"'
op|'+'
nl|'\n'
string|'"Resource: "'
op|'+'
name|'html'
op|'.'
name|'PRE'
op|'('
name|'reflect'
op|'.'
name|'safe_repr'
op|'('
name|'resrc'
op|')'
op|')'
op|'+'
string|'"<br />"'
op|'+'
nl|'\n'
string|'"Value: "'
op|'+'
name|'html'
op|'.'
name|'PRE'
op|'('
name|'reflect'
op|'.'
name|'safe_repr'
op|'('
name|'body'
op|')'
op|')'
op|')'
op|'.'
name|'render'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'method'
op|'=='
string|'"HEAD"'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'len'
op|'('
name|'body'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
comment|'# This is a Bad Thing (RFC 2616, 9.4)'
nl|'\n'
indent|'                '
name|'log'
op|'.'
name|'msg'
op|'('
string|'"Warning: HEAD request %s for resource %s is"'
nl|'\n'
string|'" returning a message body."'
nl|'\n'
string|'"  I think I\'ll eat it."'
nl|'\n'
op|'%'
op|'('
name|'self'
op|','
name|'resrc'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'setHeader'
op|'('
string|"'content-length'"
op|','
name|'str'
op|'('
name|'len'
op|'('
name|'body'
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'write'
op|'('
string|"''"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'setHeader'
op|'('
string|"'content-length'"
op|','
name|'str'
op|'('
name|'len'
op|'('
name|'body'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'write'
op|'('
name|'body'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'finish'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|processingFailed
dedent|''
name|'def'
name|'processingFailed'
op|'('
name|'self'
op|','
name|'reason'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'log'
op|'.'
name|'err'
op|'('
name|'reason'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'site'
op|'.'
name|'displayTracebacks'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
op|'('
string|'"<html><head><title>web.Server Traceback (most recent call last)</title></head>"'
nl|'\n'
string|'"<body><b>web.Server Traceback (most recent call last):</b>\\n\\n"'
nl|'\n'
string|'"%s\\n\\n</body></html>\\n"'
nl|'\n'
op|'%'
name|'webutil'
op|'.'
name|'formatFailure'
op|'('
name|'reason'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
op|'('
string|'"<html><head><title>Processing Failed</title></head><body>"'
nl|'\n'
string|'"<b>Processing Failed</b></body></html>"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'setResponseCode'
op|'('
name|'http'
op|'.'
name|'INTERNAL_SERVER_ERROR'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'setHeader'
op|'('
string|"'content-type'"
op|','
string|'"text/html"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'setHeader'
op|'('
string|"'content-length'"
op|','
name|'str'
op|'('
name|'len'
op|'('
name|'body'
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'write'
op|'('
name|'body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'finish'
op|'('
op|')'
newline|'\n'
name|'return'
name|'reason'
newline|'\n'
nl|'\n'
DECL|member|view_write
dedent|''
name|'def'
name|'view_write'
op|'('
name|'self'
op|','
name|'issuer'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Remote version of write; same interface.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'write'
op|'('
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|view_finish
dedent|''
name|'def'
name|'view_finish'
op|'('
name|'self'
op|','
name|'issuer'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Remote version of finish; same interface.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'finish'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|view_addCookie
dedent|''
name|'def'
name|'view_addCookie'
op|'('
name|'self'
op|','
name|'issuer'
op|','
name|'k'
op|','
name|'v'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Remote version of addCookie; same interface.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'addCookie'
op|'('
name|'k'
op|','
name|'v'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|view_setHeader
dedent|''
name|'def'
name|'view_setHeader'
op|'('
name|'self'
op|','
name|'issuer'
op|','
name|'k'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Remote version of setHeader; same interface.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'setHeader'
op|'('
name|'k'
op|','
name|'v'
op|')'
newline|'\n'
nl|'\n'
DECL|member|view_setLastModified
dedent|''
name|'def'
name|'view_setLastModified'
op|'('
name|'self'
op|','
name|'issuer'
op|','
name|'when'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Remote version of setLastModified; same interface.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'setLastModified'
op|'('
name|'when'
op|')'
newline|'\n'
nl|'\n'
DECL|member|view_setETag
dedent|''
name|'def'
name|'view_setETag'
op|'('
name|'self'
op|','
name|'issuer'
op|','
name|'tag'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Remote version of setETag; same interface.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'setETag'
op|'('
name|'tag'
op|')'
newline|'\n'
nl|'\n'
DECL|member|view_setResponseCode
dedent|''
name|'def'
name|'view_setResponseCode'
op|'('
name|'self'
op|','
name|'issuer'
op|','
name|'code'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Remote version of setResponseCode; same interface.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'setResponseCode'
op|'('
name|'code'
op|')'
newline|'\n'
nl|'\n'
DECL|member|view_registerProducer
dedent|''
name|'def'
name|'view_registerProducer'
op|'('
name|'self'
op|','
name|'issuer'
op|','
name|'producer'
op|','
name|'streaming'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Remote version of registerProducer; same interface.\n        (requires a remote producer.)\n        """'
newline|'\n'
name|'self'
op|'.'
name|'registerProducer'
op|'('
name|'_RemoteProducerWrapper'
op|'('
name|'producer'
op|')'
op|','
name|'streaming'
op|')'
newline|'\n'
nl|'\n'
DECL|member|view_unregisterProducer
dedent|''
name|'def'
name|'view_unregisterProducer'
op|'('
name|'self'
op|','
name|'issuer'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'unregisterProducer'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'### these calls remain local'
nl|'\n'
nl|'\n'
DECL|variable|session
dedent|''
name|'session'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|getSession
name|'def'
name|'getSession'
op|'('
name|'self'
op|','
name|'sessionInterface'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# Session management'
nl|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'session'
op|':'
newline|'\n'
indent|'            '
name|'cookiename'
op|'='
name|'string'
op|'.'
name|'join'
op|'('
op|'['
string|"'TWISTED_SESSION'"
op|']'
op|'+'
name|'self'
op|'.'
name|'sitepath'
op|','
string|'"_"'
op|')'
newline|'\n'
name|'sessionCookie'
op|'='
name|'self'
op|'.'
name|'getCookie'
op|'('
name|'cookiename'
op|')'
newline|'\n'
name|'if'
name|'sessionCookie'
op|':'
newline|'\n'
indent|'                '
name|'try'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'session'
op|'='
name|'self'
op|'.'
name|'site'
op|'.'
name|'getSession'
op|'('
name|'sessionCookie'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'KeyError'
op|':'
newline|'\n'
indent|'                    '
name|'pass'
newline|'\n'
comment|"# if it still hasn't been set, fix it up."
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'not'
name|'self'
op|'.'
name|'session'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'session'
op|'='
name|'self'
op|'.'
name|'site'
op|'.'
name|'makeSession'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'addCookie'
op|'('
name|'cookiename'
op|','
name|'self'
op|'.'
name|'session'
op|'.'
name|'uid'
op|','
name|'path'
op|'='
string|"'/'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'session'
op|'.'
name|'touch'
op|'('
op|')'
newline|'\n'
name|'if'
name|'sessionInterface'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'session'
op|'.'
name|'getComponent'
op|'('
name|'sessionInterface'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'session'
newline|'\n'
nl|'\n'
DECL|member|_prePathURL
dedent|''
name|'def'
name|'_prePathURL'
op|'('
name|'self'
op|','
name|'prepath'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'port'
op|'='
name|'self'
op|'.'
name|'getHost'
op|'('
op|')'
op|'.'
name|'port'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'isSecure'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'default'
op|'='
number|'443'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'default'
op|'='
number|'80'
newline|'\n'
dedent|''
name|'if'
name|'port'
op|'=='
name|'default'
op|':'
newline|'\n'
indent|'            '
name|'hostport'
op|'='
string|"''"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'hostport'
op|'='
string|"':%d'"
op|'%'
name|'port'
newline|'\n'
dedent|''
name|'return'
string|"'http%s://%s%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'isSecure'
op|'('
op|')'
name|'and'
string|"'s'"
name|'or'
string|"''"
op|','
nl|'\n'
name|'self'
op|'.'
name|'getRequestHostname'
op|'('
op|')'
op|','
nl|'\n'
name|'hostport'
op|','
nl|'\n'
string|"'/'"
op|'.'
name|'join'
op|'('
op|'['
name|'quote'
op|'('
name|'segment'
op|','
name|'safe'
op|'='
string|"''"
op|')'
name|'for'
name|'segment'
name|'in'
name|'prepath'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|prePathURL
dedent|''
name|'def'
name|'prePathURL'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'_prePathURL'
op|'('
name|'self'
op|'.'
name|'prepath'
op|')'
newline|'\n'
nl|'\n'
DECL|member|URLPath
dedent|''
name|'def'
name|'URLPath'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'urlpath'
newline|'\n'
name|'return'
name|'urlpath'
op|'.'
name|'URLPath'
op|'.'
name|'fromRequest'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|rememberRootURL
dedent|''
name|'def'
name|'rememberRootURL'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Remember the currently-processed part of the URL for later\n        recalling.\n        """'
newline|'\n'
name|'url'
op|'='
name|'self'
op|'.'
name|'_prePathURL'
op|'('
name|'self'
op|'.'
name|'prepath'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'appRootURL'
op|'='
name|'url'
newline|'\n'
nl|'\n'
DECL|member|getRootURL
dedent|''
name|'def'
name|'getRootURL'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Get a previously-remembered URL.\n        """'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'appRootURL'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|_RemoteProducerWrapper
dedent|''
dedent|''
name|'class'
name|'_RemoteProducerWrapper'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'remote'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'resumeProducing'
op|'='
name|'remote'
op|'.'
name|'remoteMethod'
op|'('
string|'"resumeProducing"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'pauseProducing'
op|'='
name|'remote'
op|'.'
name|'remoteMethod'
op|'('
string|'"pauseProducing"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stopProducing'
op|'='
name|'remote'
op|'.'
name|'remoteMethod'
op|'('
string|'"stopProducing"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|Session
dedent|''
dedent|''
name|'class'
name|'Session'
op|'('
name|'components'
op|'.'
name|'Componentized'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    A user\'s session with a system.\n\n    This utility class contains no functionality, but is used to\n    represent a session.\n\n    @ivar _reactor: An object providing L{IReactorTime} to use for scheduling\n        expiration.\n    @ivar sessionTimeout: timeout of a session, in seconds.\n    @ivar loopFactory: Deprecated in Twisted 9.0.  Does nothing.  Do not use.\n    """'
newline|'\n'
DECL|variable|sessionTimeout
name|'sessionTimeout'
op|'='
number|'900'
newline|'\n'
DECL|variable|loopFactory
name|'loopFactory'
op|'='
name|'task'
op|'.'
name|'LoopingCall'
newline|'\n'
nl|'\n'
DECL|variable|_expireCall
name|'_expireCall'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'site'
op|','
name|'uid'
op|','
name|'reactor'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Initialize a session with a unique ID for that session.\n        """'
newline|'\n'
name|'components'
op|'.'
name|'Componentized'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'reactor'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'_reactor'
op|'='
name|'reactor'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'site'
op|'='
name|'site'
newline|'\n'
name|'self'
op|'.'
name|'uid'
op|'='
name|'uid'
newline|'\n'
name|'self'
op|'.'
name|'expireCallbacks'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'touch'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sessionNamespaces'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|startCheckingExpiration
dedent|''
name|'def'
name|'startCheckingExpiration'
op|'('
name|'self'
op|','
name|'lifetime'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Start expiration tracking.\n\n        @param lifetime: Ignored; deprecated.\n\n        @return: C{None}\n        """'
newline|'\n'
name|'if'
name|'lifetime'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'warnings'
op|'.'
name|'warn'
op|'('
nl|'\n'
string|'"The lifetime parameter to startCheckingExpiration is "'
nl|'\n'
string|'"deprecated since Twisted 9.0.  See Session.sessionTimeout "'
nl|'\n'
string|'"instead."'
op|','
name|'DeprecationWarning'
op|','
name|'stacklevel'
op|'='
number|'2'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'_expireCall'
op|'='
name|'self'
op|'.'
name|'_reactor'
op|'.'
name|'callLater'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'sessionTimeout'
op|','
name|'self'
op|'.'
name|'expire'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|notifyOnExpire
dedent|''
name|'def'
name|'notifyOnExpire'
op|'('
name|'self'
op|','
name|'callback'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Call this callback when the session expires or logs out.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'expireCallbacks'
op|'.'
name|'append'
op|'('
name|'callback'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|expire
dedent|''
name|'def'
name|'expire'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Expire/logout of the session.\n        """'
newline|'\n'
name|'del'
name|'self'
op|'.'
name|'site'
op|'.'
name|'sessions'
op|'['
name|'self'
op|'.'
name|'uid'
op|']'
newline|'\n'
name|'for'
name|'c'
name|'in'
name|'self'
op|'.'
name|'expireCallbacks'
op|':'
newline|'\n'
indent|'            '
name|'c'
op|'('
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'expireCallbacks'
op|'='
op|'['
op|']'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_expireCall'
name|'and'
name|'self'
op|'.'
name|'_expireCall'
op|'.'
name|'active'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_expireCall'
op|'.'
name|'cancel'
op|'('
op|')'
newline|'\n'
comment|'# Break reference cycle.'
nl|'\n'
name|'self'
op|'.'
name|'_expireCall'
op|'='
name|'None'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|touch
dedent|''
dedent|''
name|'def'
name|'touch'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Notify session modification.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'lastModified'
op|'='
name|'self'
op|'.'
name|'_reactor'
op|'.'
name|'seconds'
op|'('
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_expireCall'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_expireCall'
op|'.'
name|'reset'
op|'('
name|'self'
op|'.'
name|'sessionTimeout'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|checkExpired
dedent|''
dedent|''
name|'def'
name|'checkExpired'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Deprecated; does nothing.\n        """'
newline|'\n'
name|'warnings'
op|'.'
name|'warn'
op|'('
nl|'\n'
string|'"Session.checkExpired is deprecated since Twisted 9.0; sessions "'
nl|'\n'
string|'"check themselves now, you don\'t need to."'
op|','
nl|'\n'
name|'stacklevel'
op|'='
number|'2'
op|','
name|'category'
op|'='
name|'DeprecationWarning'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|version
dedent|''
dedent|''
name|'version'
op|'='
string|'"TwistedWeb/%s"'
op|'%'
name|'copyright'
op|'.'
name|'version'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|Site
name|'class'
name|'Site'
op|'('
name|'http'
op|'.'
name|'HTTPFactory'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    A web site: manage log, sessions, and resources.\n\n    @ivar counter: increment value used for generating unique sessions ID.\n    @ivar requestFactory: factory creating requests objects. Default to\n        L{Request}.\n    @ivar displayTracebacks: if set, Twisted internal errors are displayed on\n        rendered pages. Default to C{True}.\n    @ivar sessionFactory: factory for sessions objects. Default to L{Session}.\n    @ivar sessionCheckTime: Deprecated.  See L{Session.sessionTimeout} instead.\n    """'
newline|'\n'
DECL|variable|counter
name|'counter'
op|'='
number|'0'
newline|'\n'
DECL|variable|requestFactory
name|'requestFactory'
op|'='
name|'Request'
newline|'\n'
DECL|variable|displayTracebacks
name|'displayTracebacks'
op|'='
name|'True'
newline|'\n'
DECL|variable|sessionFactory
name|'sessionFactory'
op|'='
name|'Session'
newline|'\n'
DECL|variable|sessionCheckTime
name|'sessionCheckTime'
op|'='
number|'1800'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'resource'
op|','
name|'logPath'
op|'='
name|'None'
op|','
name|'timeout'
op|'='
number|'60'
op|'*'
number|'60'
op|'*'
number|'12'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Initialize.\n        """'
newline|'\n'
name|'http'
op|'.'
name|'HTTPFactory'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
name|'logPath'
op|'='
name|'logPath'
op|','
name|'timeout'
op|'='
name|'timeout'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sessions'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'resource'
op|'='
name|'resource'
newline|'\n'
nl|'\n'
DECL|member|_openLogFile
dedent|''
name|'def'
name|'_openLogFile'
op|'('
name|'self'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'logfile'
newline|'\n'
name|'return'
name|'logfile'
op|'.'
name|'LogFile'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'path'
op|')'
op|','
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'path'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__getstate__
dedent|''
name|'def'
name|'__getstate__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'__dict__'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'d'
op|'['
string|"'sessions'"
op|']'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|_mkuid
dedent|''
name|'def'
name|'_mkuid'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        (internal) Generate an opaque, unique ID for a user\'s session.\n        """'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
op|'.'
name|'hashlib'
name|'import'
name|'md5'
newline|'\n'
name|'import'
name|'random'
newline|'\n'
name|'self'
op|'.'
name|'counter'
op|'='
name|'self'
op|'.'
name|'counter'
op|'+'
number|'1'
newline|'\n'
name|'return'
name|'md5'
op|'('
string|'"%s_%s"'
op|'%'
op|'('
name|'str'
op|'('
name|'random'
op|'.'
name|'random'
op|'('
op|')'
op|')'
op|','
name|'str'
op|'('
name|'self'
op|'.'
name|'counter'
op|')'
op|')'
op|')'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|makeSession
dedent|''
name|'def'
name|'makeSession'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Generate a new Session instance, and store it for future reference.\n        """'
newline|'\n'
name|'uid'
op|'='
name|'self'
op|'.'
name|'_mkuid'
op|'('
op|')'
newline|'\n'
name|'session'
op|'='
name|'self'
op|'.'
name|'sessions'
op|'['
name|'uid'
op|']'
op|'='
name|'self'
op|'.'
name|'sessionFactory'
op|'('
name|'self'
op|','
name|'uid'
op|')'
newline|'\n'
name|'session'
op|'.'
name|'startCheckingExpiration'
op|'('
op|')'
newline|'\n'
name|'return'
name|'session'
newline|'\n'
nl|'\n'
DECL|member|getSession
dedent|''
name|'def'
name|'getSession'
op|'('
name|'self'
op|','
name|'uid'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Get a previously generated session, by its unique ID.\n        This raises a KeyError if the session is not found.\n        """'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'sessions'
op|'['
name|'uid'
op|']'
newline|'\n'
nl|'\n'
DECL|member|buildProtocol
dedent|''
name|'def'
name|'buildProtocol'
op|'('
name|'self'
op|','
name|'addr'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Generate a channel attached to this site.\n        """'
newline|'\n'
name|'channel'
op|'='
name|'http'
op|'.'
name|'HTTPFactory'
op|'.'
name|'buildProtocol'
op|'('
name|'self'
op|','
name|'addr'
op|')'
newline|'\n'
name|'channel'
op|'.'
name|'requestFactory'
op|'='
name|'self'
op|'.'
name|'requestFactory'
newline|'\n'
name|'channel'
op|'.'
name|'site'
op|'='
name|'self'
newline|'\n'
name|'return'
name|'channel'
newline|'\n'
nl|'\n'
DECL|variable|isLeaf
dedent|''
name|'isLeaf'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|render
name|'def'
name|'render'
op|'('
name|'self'
op|','
name|'request'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Redirect because a Site is always a directory.\n        """'
newline|'\n'
name|'request'
op|'.'
name|'redirect'
op|'('
name|'request'
op|'.'
name|'prePathURL'
op|'('
op|')'
op|'+'
string|"'/'"
op|')'
newline|'\n'
name|'request'
op|'.'
name|'finish'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|getChildWithDefault
dedent|''
name|'def'
name|'getChildWithDefault'
op|'('
name|'self'
op|','
name|'pathEl'
op|','
name|'request'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Emulate a resource\'s getChild method.\n        """'
newline|'\n'
name|'request'
op|'.'
name|'site'
op|'='
name|'self'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'resource'
op|'.'
name|'getChildWithDefault'
op|'('
name|'pathEl'
op|','
name|'request'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getResourceFor
dedent|''
name|'def'
name|'getResourceFor'
op|'('
name|'self'
op|','
name|'request'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Get a resource for a request.\n\n        This iterates through the resource heirarchy, calling\n        getChildWithDefault on each resource it finds for a path element,\n        stopping when it hits an element where isLeaf is true.\n        """'
newline|'\n'
name|'request'
op|'.'
name|'site'
op|'='
name|'self'
newline|'\n'
comment|'# Sitepath is used to determine cookie names between distributed'
nl|'\n'
comment|'# servers and disconnected sites.'
nl|'\n'
name|'request'
op|'.'
name|'sitepath'
op|'='
name|'copy'
op|'.'
name|'copy'
op|'('
name|'request'
op|'.'
name|'prepath'
op|')'
newline|'\n'
name|'return'
name|'resource'
op|'.'
name|'getChildForRequest'
op|'('
name|'self'
op|'.'
name|'resource'
op|','
name|'request'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'import'
name|'html'
newline|'\n'
nl|'\n'
endmarker|''
end_unit
