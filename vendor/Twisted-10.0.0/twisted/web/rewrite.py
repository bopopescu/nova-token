begin_unit
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
comment|'#'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'web'
name|'import'
name|'resource'
newline|'\n'
nl|'\n'
DECL|class|RewriterResource
name|'class'
name|'RewriterResource'
op|'('
name|'resource'
op|'.'
name|'Resource'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'orig'
op|','
op|'*'
name|'rewriteRules'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resource'
op|'.'
name|'Resource'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'resource'
op|'='
name|'orig'
newline|'\n'
name|'self'
op|'.'
name|'rewriteRules'
op|'='
name|'list'
op|'('
name|'rewriteRules'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_rewrite
dedent|''
name|'def'
name|'_rewrite'
op|'('
name|'self'
op|','
name|'request'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'rewriteRule'
name|'in'
name|'self'
op|'.'
name|'rewriteRules'
op|':'
newline|'\n'
indent|'            '
name|'rewriteRule'
op|'('
name|'request'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getChild
dedent|''
dedent|''
name|'def'
name|'getChild'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'request'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'request'
op|'.'
name|'postpath'
op|'.'
name|'insert'
op|'('
number|'0'
op|','
name|'path'
op|')'
newline|'\n'
name|'request'
op|'.'
name|'prepath'
op|'.'
name|'pop'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_rewrite'
op|'('
name|'request'
op|')'
newline|'\n'
name|'path'
op|'='
name|'request'
op|'.'
name|'postpath'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
newline|'\n'
name|'request'
op|'.'
name|'prepath'
op|'.'
name|'append'
op|'('
name|'path'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'resource'
op|'.'
name|'getChildWithDefault'
op|'('
name|'path'
op|','
name|'request'
op|')'
newline|'\n'
nl|'\n'
DECL|member|render
dedent|''
name|'def'
name|'render'
op|'('
name|'self'
op|','
name|'request'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_rewrite'
op|'('
name|'request'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'resource'
op|'.'
name|'render'
op|'('
name|'request'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|tildeToUsers
dedent|''
dedent|''
name|'def'
name|'tildeToUsers'
op|'('
name|'request'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'request'
op|'.'
name|'postpath'
name|'and'
name|'request'
op|'.'
name|'postpath'
op|'['
number|'0'
op|']'
op|'['
op|':'
number|'1'
op|']'
op|'=='
string|"'~'"
op|':'
newline|'\n'
indent|'        '
name|'request'
op|'.'
name|'postpath'
op|'['
op|':'
number|'1'
op|']'
op|'='
op|'['
string|"'users'"
op|','
name|'request'
op|'.'
name|'postpath'
op|'['
number|'0'
op|']'
op|'['
number|'1'
op|':'
op|']'
op|']'
newline|'\n'
name|'request'
op|'.'
name|'path'
op|'='
string|"'/'"
op|'+'
string|"'/'"
op|'.'
name|'join'
op|'('
name|'request'
op|'.'
name|'prepath'
op|'+'
name|'request'
op|'.'
name|'postpath'
op|')'
newline|'\n'
nl|'\n'
DECL|function|alias
dedent|''
dedent|''
name|'def'
name|'alias'
op|'('
name|'aliasPath'
op|','
name|'sourcePath'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    I am not a very good aliaser. But I\'m the best I can be. If I\'m\n    aliasing to a Resource that generates links, and it uses any parts\n    of request.prepath to do so, the links will not be relative to the\n    aliased path, but rather to the aliased-to path. That I can\'t\n    alias static.File directory listings that nicely. However, I can\n    still be useful, as many resources will play nice.\n    """'
newline|'\n'
name|'sourcePath'
op|'='
name|'sourcePath'
op|'.'
name|'split'
op|'('
string|"'/'"
op|')'
newline|'\n'
name|'aliasPath'
op|'='
name|'aliasPath'
op|'.'
name|'split'
op|'('
string|"'/'"
op|')'
newline|'\n'
DECL|function|rewriter
name|'def'
name|'rewriter'
op|'('
name|'request'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'request'
op|'.'
name|'postpath'
op|'['
op|':'
name|'len'
op|'('
name|'aliasPath'
op|')'
op|']'
op|'=='
name|'aliasPath'
op|':'
newline|'\n'
indent|'            '
name|'after'
op|'='
name|'request'
op|'.'
name|'postpath'
op|'['
name|'len'
op|'('
name|'aliasPath'
op|')'
op|':'
op|']'
newline|'\n'
name|'request'
op|'.'
name|'postpath'
op|'='
name|'sourcePath'
op|'+'
name|'after'
newline|'\n'
name|'request'
op|'.'
name|'path'
op|'='
string|"'/'"
op|'+'
string|"'/'"
op|'.'
name|'join'
op|'('
name|'request'
op|'.'
name|'prepath'
op|'+'
name|'request'
op|'.'
name|'postpath'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'rewriter'
newline|'\n'
dedent|''
endmarker|''
end_unit
