begin_unit
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
string|'"""\nDomain Name Server\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'os'
op|','
name|'traceback'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'usage'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
name|'import'
name|'dns'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'application'
name|'import'
name|'internet'
op|','
name|'service'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
name|'import'
name|'server'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
name|'import'
name|'authority'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
name|'import'
name|'secondary'
newline|'\n'
nl|'\n'
DECL|class|Options
name|'class'
name|'Options'
op|'('
name|'usage'
op|'.'
name|'Options'
op|')'
op|':'
newline|'\n'
DECL|variable|optParameters
indent|'    '
name|'optParameters'
op|'='
op|'['
nl|'\n'
op|'['
string|'"interface"'
op|','
string|'"i"'
op|','
string|'""'
op|','
string|'"The interface to which to bind"'
op|']'
op|','
nl|'\n'
op|'['
string|'"port"'
op|','
string|'"p"'
op|','
string|'"53"'
op|','
string|'"The port on which to listen"'
op|']'
op|','
nl|'\n'
op|'['
string|'"resolv-conf"'
op|','
name|'None'
op|','
name|'None'
op|','
nl|'\n'
string|'"Override location of resolv.conf (implies --recursive)"'
op|']'
op|','
nl|'\n'
op|'['
string|'"hosts-file"'
op|','
name|'None'
op|','
name|'None'
op|','
string|'"Perform lookups with a hosts file"'
op|']'
op|','
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
DECL|variable|optFlags
name|'optFlags'
op|'='
op|'['
nl|'\n'
op|'['
string|'"cache"'
op|','
string|'"c"'
op|','
string|'"Enable record caching"'
op|']'
op|','
nl|'\n'
op|'['
string|'"recursive"'
op|','
string|'"r"'
op|','
string|'"Perform recursive lookups"'
op|']'
op|','
nl|'\n'
op|'['
string|'"verbose"'
op|','
string|'"v"'
op|','
string|'"Log verbosely"'
op|']'
op|','
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
DECL|variable|zones
name|'zones'
op|'='
name|'None'
newline|'\n'
DECL|variable|zonefiles
name|'zonefiles'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'usage'
op|'.'
name|'Options'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'['
string|"'verbose'"
op|']'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'bindfiles'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'zonefiles'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'secondaries'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|opt_pyzone
dedent|''
name|'def'
name|'opt_pyzone'
op|'('
name|'self'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Specify the filename of a Python syntax zone definition"""'
newline|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
name|'filename'
op|'+'
string|'": No such file"'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'zonefiles'
op|'.'
name|'append'
op|'('
name|'filename'
op|')'
newline|'\n'
nl|'\n'
DECL|member|opt_bindzone
dedent|''
name|'def'
name|'opt_bindzone'
op|'('
name|'self'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Specify the filename of a BIND9 syntax zone definition"""'
newline|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
name|'filename'
op|'+'
string|'": No such file"'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'bindfiles'
op|'.'
name|'append'
op|'('
name|'filename'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|opt_secondary
dedent|''
name|'def'
name|'opt_secondary'
op|'('
name|'self'
op|','
name|'ip_domain'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Act as secondary for the specified domain, performing\n        zone transfers from the specified IP (IP/domain)\n        """'
newline|'\n'
name|'args'
op|'='
name|'ip_domain'
op|'.'
name|'split'
op|'('
string|"'/'"
op|','
number|'1'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'args'
op|')'
op|'!='
number|'2'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
string|'"Argument must be of the form IP/domain"'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'secondaries'
op|'.'
name|'append'
op|'('
op|'('
name|'args'
op|'['
number|'0'
op|']'
op|','
op|'['
name|'args'
op|'['
number|'1'
op|']'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|opt_verbose
dedent|''
name|'def'
name|'opt_verbose'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Increment verbosity level"""'
newline|'\n'
name|'self'
op|'['
string|"'verbose'"
op|']'
op|'+='
number|'1'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|postOptions
dedent|''
name|'def'
name|'postOptions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'['
string|"'resolv-conf'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'['
string|"'recursive'"
op|']'
op|'='
name|'True'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'svcs'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'zones'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'f'
name|'in'
name|'self'
op|'.'
name|'zonefiles'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'zones'
op|'.'
name|'append'
op|'('
name|'authority'
op|'.'
name|'PySourceAuthority'
op|'('
name|'f'
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
op|','
name|'e'
op|':'
newline|'\n'
indent|'                '
name|'traceback'
op|'.'
name|'print_exc'
op|'('
op|')'
newline|'\n'
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
string|'"Invalid syntax in "'
op|'+'
name|'f'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'for'
name|'f'
name|'in'
name|'self'
op|'.'
name|'bindfiles'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'zones'
op|'.'
name|'append'
op|'('
name|'authority'
op|'.'
name|'BindAuthority'
op|'('
name|'f'
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
op|','
name|'e'
op|':'
newline|'\n'
indent|'                '
name|'traceback'
op|'.'
name|'print_exc'
op|'('
op|')'
newline|'\n'
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
string|'"Invalid syntax in "'
op|'+'
name|'f'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'for'
name|'f'
name|'in'
name|'self'
op|'.'
name|'secondaries'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'svcs'
op|'.'
name|'append'
op|'('
name|'secondary'
op|'.'
name|'SecondaryAuthorityService'
op|'('
op|'*'
name|'f'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'zones'
op|'.'
name|'append'
op|'('
name|'self'
op|'.'
name|'svcs'
op|'['
op|'-'
number|'1'
op|']'
op|'.'
name|'getAuthority'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'['
string|"'port'"
op|']'
op|'='
name|'int'
op|'('
name|'self'
op|'['
string|"'port'"
op|']'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|'('
string|'"Invalid port: %r"'
op|'%'
op|'('
name|'self'
op|'['
string|"'port'"
op|']'
op|','
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|makeService
dedent|''
dedent|''
dedent|''
name|'def'
name|'makeService'
op|'('
name|'config'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'import'
name|'client'
op|','
name|'cache'
op|','
name|'hosts'
newline|'\n'
nl|'\n'
name|'ca'
op|','
name|'cl'
op|'='
op|'['
op|']'
op|','
op|'['
op|']'
newline|'\n'
name|'if'
name|'config'
op|'['
string|"'cache'"
op|']'
op|':'
newline|'\n'
indent|'        '
name|'ca'
op|'.'
name|'append'
op|'('
name|'cache'
op|'.'
name|'CacheResolver'
op|'('
name|'verbose'
op|'='
name|'config'
op|'['
string|"'verbose'"
op|']'
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'config'
op|'['
string|"'recursive'"
op|']'
op|':'
newline|'\n'
indent|'        '
name|'cl'
op|'.'
name|'append'
op|'('
name|'client'
op|'.'
name|'createResolver'
op|'('
name|'resolvconf'
op|'='
name|'config'
op|'['
string|"'resolv-conf'"
op|']'
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'config'
op|'['
string|"'hosts-file'"
op|']'
op|':'
newline|'\n'
indent|'        '
name|'cl'
op|'.'
name|'append'
op|'('
name|'hosts'
op|'.'
name|'Resolver'
op|'('
name|'file'
op|'='
name|'config'
op|'['
string|"'hosts-file'"
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'f'
op|'='
name|'server'
op|'.'
name|'DNSServerFactory'
op|'('
name|'config'
op|'.'
name|'zones'
op|','
name|'ca'
op|','
name|'cl'
op|','
name|'config'
op|'['
string|"'verbose'"
op|']'
op|')'
newline|'\n'
name|'p'
op|'='
name|'dns'
op|'.'
name|'DNSDatagramProtocol'
op|'('
name|'f'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'noisy'
op|'='
number|'0'
newline|'\n'
name|'ret'
op|'='
name|'service'
op|'.'
name|'MultiService'
op|'('
op|')'
newline|'\n'
name|'for'
op|'('
name|'klass'
op|','
name|'arg'
op|')'
name|'in'
op|'['
op|'('
name|'internet'
op|'.'
name|'TCPServer'
op|','
name|'f'
op|')'
op|','
op|'('
name|'internet'
op|'.'
name|'UDPServer'
op|','
name|'p'
op|')'
op|']'
op|':'
newline|'\n'
indent|'        '
name|'s'
op|'='
name|'klass'
op|'('
name|'config'
op|'['
string|"'port'"
op|']'
op|','
name|'arg'
op|','
name|'interface'
op|'='
name|'config'
op|'['
string|"'interface'"
op|']'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'setServiceParent'
op|'('
name|'ret'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'svc'
name|'in'
name|'config'
op|'.'
name|'svcs'
op|':'
newline|'\n'
indent|'        '
name|'svc'
op|'.'
name|'setServiceParent'
op|'('
name|'ret'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'ret'
newline|'\n'
dedent|''
endmarker|''
end_unit
