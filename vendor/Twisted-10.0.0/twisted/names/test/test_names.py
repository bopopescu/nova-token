begin_unit
comment|'# -*- test-case-name: twisted.names.test.test_names -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2009 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
string|'"""\nTest cases for twisted.names.\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'socket'
op|','
name|'operator'
op|','
name|'copy'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'trial'
name|'import'
name|'unittest'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
op|','
name|'defer'
op|','
name|'error'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
op|'.'
name|'defer'
name|'import'
name|'succeed'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
name|'import'
name|'client'
op|','
name|'server'
op|','
name|'common'
op|','
name|'authority'
op|','
name|'hosts'
op|','
name|'dns'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'failure'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
op|'.'
name|'error'
name|'import'
name|'DNSFormatError'
op|','
name|'DNSServerError'
op|','
name|'DNSNameError'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
op|'.'
name|'error'
name|'import'
name|'DNSNotImplementedError'
op|','
name|'DNSQueryRefusedError'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
op|'.'
name|'error'
name|'import'
name|'DNSUnknownError'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
op|'.'
name|'dns'
name|'import'
name|'EFORMAT'
op|','
name|'ESERVER'
op|','
name|'ENAME'
op|','
name|'ENOTIMP'
op|','
name|'EREFUSED'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
op|'.'
name|'dns'
name|'import'
name|'Message'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
op|'.'
name|'client'
name|'import'
name|'Resolver'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
op|'.'
name|'test'
op|'.'
name|'test_client'
name|'import'
name|'StubPort'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
op|'.'
name|'compat'
name|'import'
name|'reduce'
newline|'\n'
nl|'\n'
DECL|function|justPayload
name|'def'
name|'justPayload'
op|'('
name|'results'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
op|'['
name|'r'
op|'.'
name|'payload'
name|'for'
name|'r'
name|'in'
name|'results'
op|'['
number|'0'
op|']'
op|']'
newline|'\n'
nl|'\n'
DECL|class|NoFileAuthority
dedent|''
name|'class'
name|'NoFileAuthority'
op|'('
name|'authority'
op|'.'
name|'FileAuthority'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'soa'
op|','
name|'records'
op|')'
op|':'
newline|'\n'
comment|'# Yes, skip FileAuthority'
nl|'\n'
indent|'        '
name|'common'
op|'.'
name|'ResolverBase'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'soa'
op|','
name|'self'
op|'.'
name|'records'
op|'='
name|'soa'
op|','
name|'records'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|soa_record
dedent|''
dedent|''
name|'soa_record'
op|'='
name|'dns'
op|'.'
name|'Record_SOA'
op|'('
nl|'\n'
name|'mname'
op|'='
string|"'test-domain.com'"
op|','
nl|'\n'
name|'rname'
op|'='
string|"'root.test-domain.com'"
op|','
nl|'\n'
name|'serial'
op|'='
number|'100'
op|','
nl|'\n'
name|'refresh'
op|'='
number|'1234'
op|','
nl|'\n'
name|'minimum'
op|'='
number|'7654'
op|','
nl|'\n'
name|'expire'
op|'='
number|'19283784'
op|','
nl|'\n'
name|'retry'
op|'='
number|'15'
op|','
nl|'\n'
name|'ttl'
op|'='
number|'1'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|reverse_soa
name|'reverse_soa'
op|'='
name|'dns'
op|'.'
name|'Record_SOA'
op|'('
nl|'\n'
name|'mname'
op|'='
string|"'93.84.28.in-addr.arpa'"
op|','
nl|'\n'
name|'rname'
op|'='
string|"'93.84.28.in-addr.arpa'"
op|','
nl|'\n'
name|'serial'
op|'='
number|'120'
op|','
nl|'\n'
name|'refresh'
op|'='
number|'54321'
op|','
nl|'\n'
name|'minimum'
op|'='
number|'382'
op|','
nl|'\n'
name|'expire'
op|'='
number|'11193983'
op|','
nl|'\n'
name|'retry'
op|'='
number|'30'
op|','
nl|'\n'
name|'ttl'
op|'='
number|'3'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|my_soa
name|'my_soa'
op|'='
name|'dns'
op|'.'
name|'Record_SOA'
op|'('
nl|'\n'
DECL|variable|mname
name|'mname'
op|'='
string|"'my-domain.com'"
op|','
nl|'\n'
DECL|variable|rname
name|'rname'
op|'='
string|"'postmaster.test-domain.com'"
op|','
nl|'\n'
DECL|variable|serial
name|'serial'
op|'='
number|'130'
op|','
nl|'\n'
DECL|variable|refresh
name|'refresh'
op|'='
number|'12345'
op|','
nl|'\n'
DECL|variable|minimum
name|'minimum'
op|'='
number|'1'
op|','
nl|'\n'
DECL|variable|expire
name|'expire'
op|'='
number|'999999'
op|','
nl|'\n'
DECL|variable|retry
name|'retry'
op|'='
number|'100'
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|test_domain_com
name|'test_domain_com'
op|'='
name|'NoFileAuthority'
op|'('
nl|'\n'
DECL|variable|soa
name|'soa'
op|'='
op|'('
string|"'test-domain.com'"
op|','
name|'soa_record'
op|')'
op|','
nl|'\n'
DECL|variable|records
name|'records'
op|'='
op|'{'
nl|'\n'
string|"'test-domain.com'"
op|':'
op|'['
nl|'\n'
name|'soa_record'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'127.0.0.1'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_NS'
op|'('
string|"'39.28.189.39'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_MX'
op|'('
number|'10'
op|','
string|"'host.test-domain.com'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_HINFO'
op|'('
name|'os'
op|'='
string|"'Linux'"
op|','
name|'cpu'
op|'='
string|"'A Fast One, Dontcha know'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_CNAME'
op|'('
string|"'canonical.name.com'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_MB'
op|'('
string|"'mailbox.test-domain.com'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_MG'
op|'('
string|"'mail.group.someplace'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_TXT'
op|'('
string|"'A First piece of Text'"
op|','
string|"'a SecoNd piece'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_A6'
op|'('
number|'0'
op|','
string|"'ABCD::4321'"
op|','
string|"''"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_A6'
op|'('
number|'12'
op|','
string|"'0:0069::0'"
op|','
string|"'some.network.tld'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_A6'
op|'('
number|'8'
op|','
string|"'0:5634:1294:AFCB:56AC:48EF:34C3:01FF'"
op|','
string|"'tra.la.la.net'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_TXT'
op|'('
string|"'Some more text, haha!  Yes.  \\0  Still here?'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_MR'
op|'('
string|"'mail.redirect.or.whatever'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_MINFO'
op|'('
name|'rmailbx'
op|'='
string|"'r mail box'"
op|','
name|'emailbx'
op|'='
string|"'e mail box'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_AFSDB'
op|'('
name|'subtype'
op|'='
number|'1'
op|','
name|'hostname'
op|'='
string|"'afsdb.test-domain.com'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_RP'
op|'('
name|'mbox'
op|'='
string|"'whatever.i.dunno'"
op|','
name|'txt'
op|'='
string|"'some.more.text'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_WKS'
op|'('
string|"'12.54.78.12'"
op|','
name|'socket'
op|'.'
name|'IPPROTO_TCP'
op|','
nl|'\n'
string|"'\\x12\\x01\\x16\\xfe\\xc1\\x00\\x01'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_NAPTR'
op|'('
number|'100'
op|','
number|'10'
op|','
string|'"u"'
op|','
string|'"sip+E2U"'
op|','
nl|'\n'
string|'"!^.*$!sip:information@domain.tld!"'
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_AAAA'
op|'('
string|"'AF43:5634:1294:AFCB:56AC:48EF:34C3:01FF'"
op|')'
op|']'
op|','
nl|'\n'
string|"'http.tcp.test-domain.com'"
op|':'
op|'['
nl|'\n'
name|'dns'
op|'.'
name|'Record_SRV'
op|'('
number|'257'
op|','
number|'16383'
op|','
number|'43690'
op|','
string|"'some.other.place.fool'"
op|')'
nl|'\n'
op|']'
op|','
nl|'\n'
string|"'host.test-domain.com'"
op|':'
op|'['
nl|'\n'
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'123.242.1.5'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'0.255.0.255'"
op|')'
op|','
nl|'\n'
op|']'
op|','
nl|'\n'
string|"'host-two.test-domain.com'"
op|':'
op|'['
nl|'\n'
comment|'#'
nl|'\n'
comment|'#  Python bug'
nl|'\n'
comment|"#           dns.Record_A('255.255.255.255'),"
nl|'\n'
comment|'#'
nl|'\n'
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'255.255.255.254'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'0.0.0.0'"
op|')'
nl|'\n'
op|']'
op|','
nl|'\n'
string|"'cname.test-domain.com'"
op|':'
op|'['
nl|'\n'
name|'dns'
op|'.'
name|'Record_CNAME'
op|'('
string|"'test-domain.com'"
op|')'
nl|'\n'
op|']'
op|','
nl|'\n'
string|"'anothertest-domain.com'"
op|':'
op|'['
nl|'\n'
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'1.2.3.4'"
op|')'
op|']'
op|','
nl|'\n'
op|'}'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|reverse_domain
name|'reverse_domain'
op|'='
name|'NoFileAuthority'
op|'('
nl|'\n'
DECL|variable|soa
name|'soa'
op|'='
op|'('
string|"'93.84.28.in-addr.arpa'"
op|','
name|'reverse_soa'
op|')'
op|','
nl|'\n'
DECL|variable|records
name|'records'
op|'='
op|'{'
nl|'\n'
string|"'123.93.84.28.in-addr.arpa'"
op|':'
op|'['
nl|'\n'
name|'dns'
op|'.'
name|'Record_PTR'
op|'('
string|"'test.host-reverse.lookup.com'"
op|')'
op|','
nl|'\n'
name|'reverse_soa'
nl|'\n'
op|']'
nl|'\n'
op|'}'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|my_domain_com
name|'my_domain_com'
op|'='
name|'NoFileAuthority'
op|'('
nl|'\n'
DECL|variable|soa
name|'soa'
op|'='
op|'('
string|"'my-domain.com'"
op|','
name|'my_soa'
op|')'
op|','
nl|'\n'
DECL|variable|records
name|'records'
op|'='
op|'{'
nl|'\n'
string|"'my-domain.com'"
op|':'
op|'['
nl|'\n'
name|'my_soa'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'1.2.3.4'"
op|','
name|'ttl'
op|'='
string|"'1S'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_NS'
op|'('
string|"'ns1.domain'"
op|','
name|'ttl'
op|'='
string|"'2M'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_NS'
op|'('
string|"'ns2.domain'"
op|','
name|'ttl'
op|'='
string|"'3H'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_SRV'
op|'('
number|'257'
op|','
number|'16383'
op|','
number|'43690'
op|','
string|"'some.other.place.fool'"
op|','
name|'ttl'
op|'='
string|"'4D'"
op|')'
nl|'\n'
op|']'
nl|'\n'
op|'}'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ServerDNSTestCase
name|'class'
name|'ServerDNSTestCase'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    Test cases for DNS server and client.\n    """'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'factory'
op|'='
name|'server'
op|'.'
name|'DNSServerFactory'
op|'('
op|'['
nl|'\n'
name|'test_domain_com'
op|','
name|'reverse_domain'
op|','
name|'my_domain_com'
nl|'\n'
op|']'
op|','
name|'verbose'
op|'='
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'p'
op|'='
name|'dns'
op|'.'
name|'DNSDatagramProtocol'
op|'('
name|'self'
op|'.'
name|'factory'
op|')'
newline|'\n'
nl|'\n'
name|'while'
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'listenerTCP'
op|'='
name|'reactor'
op|'.'
name|'listenTCP'
op|'('
number|'0'
op|','
name|'self'
op|'.'
name|'factory'
op|','
name|'interface'
op|'='
string|'"127.0.0.1"'
op|')'
newline|'\n'
comment|"# It's simpler to do the stop listening with addCleanup,"
nl|'\n'
comment|'# even though we might not end up using this TCP port in'
nl|'\n'
comment|'# the test (if the listenUDP below fails).  Cleaning up'
nl|'\n'
comment|'# this TCP port sooner than "cleanup time" would mean'
nl|'\n'
comment|'# adding more code to keep track of the Deferred returned'
nl|'\n'
comment|'# by stopListening.'
nl|'\n'
name|'self'
op|'.'
name|'addCleanup'
op|'('
name|'listenerTCP'
op|'.'
name|'stopListening'
op|')'
newline|'\n'
name|'port'
op|'='
name|'listenerTCP'
op|'.'
name|'getHost'
op|'('
op|')'
op|'.'
name|'port'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'listenerUDP'
op|'='
name|'reactor'
op|'.'
name|'listenUDP'
op|'('
name|'port'
op|','
name|'p'
op|','
name|'interface'
op|'='
string|'"127.0.0.1"'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'error'
op|'.'
name|'CannotListenError'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'addCleanup'
op|'('
name|'listenerUDP'
op|'.'
name|'stopListening'
op|')'
newline|'\n'
name|'break'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'listenerTCP'
op|'='
name|'listenerTCP'
newline|'\n'
name|'self'
op|'.'
name|'listenerUDP'
op|'='
name|'listenerUDP'
newline|'\n'
name|'self'
op|'.'
name|'resolver'
op|'='
name|'client'
op|'.'
name|'Resolver'
op|'('
name|'servers'
op|'='
op|'['
op|'('
string|"'127.0.0.1'"
op|','
name|'port'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Clean up any server connections associated with the\n        L{DNSServerFactory} created in L{setUp}\n        """'
newline|'\n'
comment|"# It'd be great if DNSServerFactory had a method that"
nl|'\n'
comment|'# encapsulated this task.  At least the necessary data is'
nl|'\n'
comment|'# available, though.'
nl|'\n'
name|'for'
name|'conn'
name|'in'
name|'self'
op|'.'
name|'factory'
op|'.'
name|'connections'
op|'['
op|':'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'conn'
op|'.'
name|'transport'
op|'.'
name|'loseConnection'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|namesTest
dedent|''
dedent|''
name|'def'
name|'namesTest'
op|'('
name|'self'
op|','
name|'d'
op|','
name|'r'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'response'
op|'='
name|'None'
newline|'\n'
DECL|function|setDone
name|'def'
name|'setDone'
op|'('
name|'response'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'response'
op|'='
name|'response'
newline|'\n'
nl|'\n'
DECL|function|checkResults
dedent|''
name|'def'
name|'checkResults'
op|'('
name|'ignored'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'isinstance'
op|'('
name|'self'
op|'.'
name|'response'
op|','
name|'failure'
op|'.'
name|'Failure'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'self'
op|'.'
name|'response'
newline|'\n'
dedent|''
name|'results'
op|'='
name|'justPayload'
op|'('
name|'self'
op|'.'
name|'response'
op|')'
newline|'\n'
name|'assert'
name|'len'
op|'('
name|'results'
op|')'
op|'=='
name|'len'
op|'('
name|'r'
op|')'
op|','
string|'"%s != %s"'
op|'%'
op|'('
name|'map'
op|'('
name|'str'
op|','
name|'results'
op|')'
op|','
name|'map'
op|'('
name|'str'
op|','
name|'r'
op|')'
op|')'
newline|'\n'
name|'for'
name|'rec'
name|'in'
name|'results'
op|':'
newline|'\n'
indent|'                '
name|'assert'
name|'rec'
name|'in'
name|'r'
op|','
string|'"%s not in %s"'
op|'%'
op|'('
name|'rec'
op|','
name|'map'
op|'('
name|'str'
op|','
name|'r'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'d'
op|'.'
name|'addBoth'
op|'('
name|'setDone'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'checkResults'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|testAddressRecord1
dedent|''
name|'def'
name|'testAddressRecord1'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test simple DNS \'A\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupAddress'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'127.0.0.1'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testAddressRecord2
dedent|''
name|'def'
name|'testAddressRecord2'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'A\' record queries with multiple answers"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupAddress'
op|'('
string|"'host.test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'123.242.1.5'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|','
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'0.255.0.255'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testAdressRecord3
dedent|''
name|'def'
name|'testAdressRecord3'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'A\' record queries with edge cases"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupAddress'
op|'('
string|"'host-two.test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'255.255.255.254'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|','
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'0.0.0.0'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testAuthority
dedent|''
name|'def'
name|'testAuthority'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'SOA\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupAuthority'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'soa_record'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testMailExchangeRecord
dedent|''
name|'def'
name|'testMailExchangeRecord'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'MX\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupMailExchange'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_MX'
op|'('
number|'10'
op|','
string|"'host.test-domain.com'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testNameserver
dedent|''
name|'def'
name|'testNameserver'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'NS\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupNameservers'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_NS'
op|'('
string|"'39.28.189.39'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testHINFO
dedent|''
name|'def'
name|'testHINFO'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'HINFO\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupHostInfo'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_HINFO'
op|'('
name|'os'
op|'='
string|"'Linux'"
op|','
name|'cpu'
op|'='
string|"'A Fast One, Dontcha know'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testPTR
dedent|''
name|'def'
name|'testPTR'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'PTR\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupPointer'
op|'('
string|"'123.93.84.28.in-addr.arpa'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_PTR'
op|'('
string|"'test.host-reverse.lookup.com'"
op|','
name|'ttl'
op|'='
number|'11193983'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testCNAME
dedent|''
name|'def'
name|'testCNAME'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'CNAME\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupCanonicalName'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_CNAME'
op|'('
string|"'canonical.name.com'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testCNAMEAdditional
dedent|''
name|'def'
name|'testCNAMEAdditional'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test additional processing for CNAME records"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupAddress'
op|'('
string|"'cname.test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_CNAME'
op|'('
string|"'test-domain.com'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|','
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'127.0.0.1'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testMB
dedent|''
name|'def'
name|'testMB'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'MB\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupMailBox'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_MB'
op|'('
string|"'mailbox.test-domain.com'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testMG
dedent|''
name|'def'
name|'testMG'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'MG\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupMailGroup'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_MG'
op|'('
string|"'mail.group.someplace'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testMR
dedent|''
name|'def'
name|'testMR'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'MR\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupMailRename'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_MR'
op|'('
string|"'mail.redirect.or.whatever'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testMINFO
dedent|''
name|'def'
name|'testMINFO'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'MINFO\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupMailboxInfo'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_MINFO'
op|'('
name|'rmailbx'
op|'='
string|"'r mail box'"
op|','
name|'emailbx'
op|'='
string|"'e mail box'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testSRV
dedent|''
name|'def'
name|'testSRV'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'SRV\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupService'
op|'('
string|"'http.tcp.test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_SRV'
op|'('
number|'257'
op|','
number|'16383'
op|','
number|'43690'
op|','
string|"'some.other.place.fool'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testAFSDB
dedent|''
name|'def'
name|'testAFSDB'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'AFSDB\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupAFSDatabase'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_AFSDB'
op|'('
name|'subtype'
op|'='
number|'1'
op|','
name|'hostname'
op|'='
string|"'afsdb.test-domain.com'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testRP
dedent|''
name|'def'
name|'testRP'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'RP\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupResponsibility'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_RP'
op|'('
name|'mbox'
op|'='
string|"'whatever.i.dunno'"
op|','
name|'txt'
op|'='
string|"'some.more.text'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testTXT
dedent|''
name|'def'
name|'testTXT'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'TXT\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupText'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_TXT'
op|'('
string|"'A First piece of Text'"
op|','
string|"'a SecoNd piece'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_TXT'
op|'('
string|"'Some more text, haha!  Yes.  \\0  Still here?'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testWKS
dedent|''
name|'def'
name|'testWKS'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'WKS\' record queries"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupWellKnownServices'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_WKS'
op|'('
string|"'12.54.78.12'"
op|','
name|'socket'
op|'.'
name|'IPPROTO_TCP'
op|','
string|"'\\x12\\x01\\x16\\xfe\\xc1\\x00\\x01'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testSomeRecordsWithTTLs
dedent|''
name|'def'
name|'testSomeRecordsWithTTLs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'result_soa'
op|'='
name|'copy'
op|'.'
name|'copy'
op|'('
name|'my_soa'
op|')'
newline|'\n'
name|'result_soa'
op|'.'
name|'ttl'
op|'='
name|'my_soa'
op|'.'
name|'expire'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupAllRecords'
op|'('
string|"'my-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'result_soa'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'1.2.3.4'"
op|','
name|'ttl'
op|'='
string|"'1S'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_NS'
op|'('
string|"'ns1.domain'"
op|','
name|'ttl'
op|'='
string|"'2M'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_NS'
op|'('
string|"'ns2.domain'"
op|','
name|'ttl'
op|'='
string|"'3H'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_SRV'
op|'('
number|'257'
op|','
number|'16383'
op|','
number|'43690'
op|','
string|"'some.other.place.fool'"
op|','
name|'ttl'
op|'='
string|"'4D'"
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testAAAA
dedent|''
name|'def'
name|'testAAAA'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'AAAA\' record queries (IPv6)"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupIPV6Address'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_AAAA'
op|'('
string|"'AF43:5634:1294:AFCB:56AC:48EF:34C3:01FF'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testA6
dedent|''
name|'def'
name|'testA6'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Test DNS \'A6\' record queries (IPv6)"""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupAddress6'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_A6'
op|'('
number|'0'
op|','
string|"'ABCD::4321'"
op|','
string|"''"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_A6'
op|'('
number|'12'
op|','
string|"'0:0069::0'"
op|','
string|"'some.network.tld'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'Record_A6'
op|'('
number|'8'
op|','
string|"'0:5634:1294:AFCB:56AC:48EF:34C3:01FF'"
op|','
string|"'tra.la.la.net'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_zoneTransfer
dedent|''
name|'def'
name|'test_zoneTransfer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Test DNS \'AXFR\' queries (Zone transfer)\n        """'
newline|'\n'
name|'default_ttl'
op|'='
name|'soa_record'
op|'.'
name|'expire'
newline|'\n'
name|'results'
op|'='
op|'['
name|'copy'
op|'.'
name|'copy'
op|'('
name|'r'
op|')'
name|'for'
name|'r'
name|'in'
name|'reduce'
op|'('
name|'operator'
op|'.'
name|'add'
op|','
name|'test_domain_com'
op|'.'
name|'records'
op|'.'
name|'values'
op|'('
op|')'
op|')'
op|']'
newline|'\n'
name|'for'
name|'r'
name|'in'
name|'results'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'r'
op|'.'
name|'ttl'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'r'
op|'.'
name|'ttl'
op|'='
name|'default_ttl'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupZone'
op|'('
string|"'test-domain.com'"
op|')'
op|'.'
name|'addCallback'
op|'('
name|'lambda'
name|'r'
op|':'
op|'('
name|'r'
op|'['
number|'0'
op|']'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|','
op|')'
op|')'
op|','
nl|'\n'
name|'results'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|testSimilarZonesDontInterfere
dedent|''
name|'def'
name|'testSimilarZonesDontInterfere'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Tests that unrelated zones don\'t mess with each other."""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupAddress'
op|'('
string|'"anothertest-domain.com"'
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_A'
op|'('
string|"'1.2.3.4'"
op|','
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_NAPTR
dedent|''
name|'def'
name|'test_NAPTR'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Test DNS \'NAPTR\' record queries.\n        """'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'namesTest'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupNamingAuthorityPointer'
op|'('
string|"'test-domain.com'"
op|')'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'Record_NAPTR'
op|'('
number|'100'
op|','
number|'10'
op|','
string|'"u"'
op|','
string|'"sip+E2U"'
op|','
nl|'\n'
string|'"!^.*$!sip:information@domain.tld!"'
op|','
nl|'\n'
name|'ttl'
op|'='
number|'19283784'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
DECL|class|DNSServerFactoryTests
dedent|''
dedent|''
name|'class'
name|'DNSServerFactoryTests'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    Tests for L{server.DNSServerFactory}.\n    """'
newline|'\n'
DECL|member|_messageReceivedTest
name|'def'
name|'_messageReceivedTest'
op|'('
name|'self'
op|','
name|'methodName'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Assert that the named method is called with the given message when\n        it is passed to L{DNSServerFactory.messageReceived}.\n        """'
newline|'\n'
comment|'# Make it appear to have some queries so that'
nl|'\n'
comment|'# DNSServerFactory.allowQuery allows it.'
nl|'\n'
name|'message'
op|'.'
name|'queries'
op|'='
op|'['
name|'None'
op|']'
newline|'\n'
nl|'\n'
name|'receivedMessages'
op|'='
op|'['
op|']'
newline|'\n'
DECL|function|fakeHandler
name|'def'
name|'fakeHandler'
op|'('
name|'message'
op|','
name|'protocol'
op|','
name|'address'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'receivedMessages'
op|'.'
name|'append'
op|'('
op|'('
name|'message'
op|','
name|'protocol'
op|','
name|'address'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|class|FakeProtocol
dedent|''
name|'class'
name|'FakeProtocol'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|writeMessage
indent|'            '
name|'def'
name|'writeMessage'
op|'('
name|'self'
op|','
name|'message'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'protocol'
op|'='
name|'FakeProtocol'
op|'('
op|')'
newline|'\n'
name|'factory'
op|'='
name|'server'
op|'.'
name|'DNSServerFactory'
op|'('
name|'None'
op|')'
newline|'\n'
name|'setattr'
op|'('
name|'factory'
op|','
name|'methodName'
op|','
name|'fakeHandler'
op|')'
newline|'\n'
name|'factory'
op|'.'
name|'messageReceived'
op|'('
name|'message'
op|','
name|'protocol'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'receivedMessages'
op|','
op|'['
op|'('
name|'message'
op|','
name|'protocol'
op|','
name|'None'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_notifyMessageReceived
dedent|''
name|'def'
name|'test_notifyMessageReceived'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        L{DNSServerFactory.messageReceived} passes messages with an opcode\n        of C{OP_NOTIFY} on to L{DNSServerFactory.handleNotify}.\n        """'
newline|'\n'
comment|'# RFC 1996, section 4.5'
nl|'\n'
name|'opCode'
op|'='
number|'4'
newline|'\n'
name|'self'
op|'.'
name|'_messageReceivedTest'
op|'('
string|"'handleNotify'"
op|','
name|'Message'
op|'('
name|'opCode'
op|'='
name|'opCode'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_updateMessageReceived
dedent|''
name|'def'
name|'test_updateMessageReceived'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        L{DNSServerFactory.messageReceived} passes messages with an opcode\n        of C{OP_UPDATE} on to L{DNSServerFactory.handleOther}.\n\n        This may change if the implementation ever covers update messages.\n        """'
newline|'\n'
comment|'# RFC 2136, section 1.3'
nl|'\n'
name|'opCode'
op|'='
number|'5'
newline|'\n'
name|'self'
op|'.'
name|'_messageReceivedTest'
op|'('
string|"'handleOther'"
op|','
name|'Message'
op|'('
name|'opCode'
op|'='
name|'opCode'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_connectionTracking
dedent|''
name|'def'
name|'test_connectionTracking'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        The C{connectionMade} and C{connectionLost} methods of\n        L{DNSServerFactory} cooperate to keep track of all\n        L{DNSProtocol} objects created by a factory which are\n        connected.\n        """'
newline|'\n'
name|'protoA'
op|','
name|'protoB'
op|'='
name|'object'
op|'('
op|')'
op|','
name|'object'
op|'('
op|')'
newline|'\n'
name|'factory'
op|'='
name|'server'
op|'.'
name|'DNSServerFactory'
op|'('
op|')'
newline|'\n'
name|'factory'
op|'.'
name|'connectionMade'
op|'('
name|'protoA'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'factory'
op|'.'
name|'connections'
op|','
op|'['
name|'protoA'
op|']'
op|')'
newline|'\n'
name|'factory'
op|'.'
name|'connectionMade'
op|'('
name|'protoB'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'factory'
op|'.'
name|'connections'
op|','
op|'['
name|'protoA'
op|','
name|'protoB'
op|']'
op|')'
newline|'\n'
name|'factory'
op|'.'
name|'connectionLost'
op|'('
name|'protoA'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'factory'
op|'.'
name|'connections'
op|','
op|'['
name|'protoB'
op|']'
op|')'
newline|'\n'
name|'factory'
op|'.'
name|'connectionLost'
op|'('
name|'protoB'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'factory'
op|'.'
name|'connections'
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|HelperTestCase
dedent|''
dedent|''
name|'class'
name|'HelperTestCase'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|testSerialGenerator
indent|'    '
name|'def'
name|'testSerialGenerator'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'f'
op|'='
name|'self'
op|'.'
name|'mktemp'
op|'('
op|')'
newline|'\n'
name|'a'
op|'='
name|'authority'
op|'.'
name|'getSerial'
op|'('
name|'f'
op|')'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'20'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'b'
op|'='
name|'authority'
op|'.'
name|'getSerial'
op|'('
name|'f'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnless'
op|'('
name|'a'
op|'<'
name|'b'
op|')'
newline|'\n'
name|'a'
op|'='
name|'b'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|AXFRTest
dedent|''
dedent|''
dedent|''
name|'class'
name|'AXFRTest'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'results'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'d'
op|'='
name|'defer'
op|'.'
name|'Deferred'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_gotResults'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'controller'
op|'='
name|'client'
op|'.'
name|'AXFRController'
op|'('
string|"'fooby.com'"
op|','
name|'self'
op|'.'
name|'d'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'soa'
op|'='
name|'dns'
op|'.'
name|'RRHeader'
op|'('
name|'name'
op|'='
string|"'fooby.com'"
op|','
name|'type'
op|'='
name|'dns'
op|'.'
name|'SOA'
op|','
name|'cls'
op|'='
name|'dns'
op|'.'
name|'IN'
op|','
name|'ttl'
op|'='
number|'86400'
op|','
name|'auth'
op|'='
name|'False'
op|','
nl|'\n'
name|'payload'
op|'='
name|'dns'
op|'.'
name|'Record_SOA'
op|'('
name|'mname'
op|'='
string|"'fooby.com'"
op|','
nl|'\n'
name|'rname'
op|'='
string|"'hooj.fooby.com'"
op|','
nl|'\n'
name|'serial'
op|'='
number|'100'
op|','
nl|'\n'
name|'refresh'
op|'='
number|'200'
op|','
nl|'\n'
name|'retry'
op|'='
number|'300'
op|','
nl|'\n'
name|'expire'
op|'='
number|'400'
op|','
nl|'\n'
name|'minimum'
op|'='
number|'500'
op|','
nl|'\n'
name|'ttl'
op|'='
number|'600'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'records'
op|'='
op|'['
nl|'\n'
name|'self'
op|'.'
name|'soa'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'RRHeader'
op|'('
name|'name'
op|'='
string|"'fooby.com'"
op|','
name|'type'
op|'='
name|'dns'
op|'.'
name|'NS'
op|','
name|'cls'
op|'='
name|'dns'
op|'.'
name|'IN'
op|','
name|'ttl'
op|'='
number|'700'
op|','
name|'auth'
op|'='
name|'False'
op|','
nl|'\n'
name|'payload'
op|'='
name|'dns'
op|'.'
name|'Record_NS'
op|'('
name|'name'
op|'='
string|"'ns.twistedmatrix.com'"
op|','
name|'ttl'
op|'='
number|'700'
op|')'
op|')'
op|','
nl|'\n'
nl|'\n'
name|'dns'
op|'.'
name|'RRHeader'
op|'('
name|'name'
op|'='
string|"'fooby.com'"
op|','
name|'type'
op|'='
name|'dns'
op|'.'
name|'MX'
op|','
name|'cls'
op|'='
name|'dns'
op|'.'
name|'IN'
op|','
name|'ttl'
op|'='
number|'700'
op|','
name|'auth'
op|'='
name|'False'
op|','
nl|'\n'
name|'payload'
op|'='
name|'dns'
op|'.'
name|'Record_MX'
op|'('
name|'preference'
op|'='
number|'10'
op|','
name|'exchange'
op|'='
string|"'mail.mv3d.com'"
op|','
name|'ttl'
op|'='
number|'700'
op|')'
op|')'
op|','
nl|'\n'
nl|'\n'
name|'dns'
op|'.'
name|'RRHeader'
op|'('
name|'name'
op|'='
string|"'fooby.com'"
op|','
name|'type'
op|'='
name|'dns'
op|'.'
name|'A'
op|','
name|'cls'
op|'='
name|'dns'
op|'.'
name|'IN'
op|','
name|'ttl'
op|'='
number|'700'
op|','
name|'auth'
op|'='
name|'False'
op|','
nl|'\n'
name|'payload'
op|'='
name|'dns'
op|'.'
name|'Record_A'
op|'('
name|'address'
op|'='
string|"'64.123.27.105'"
op|','
name|'ttl'
op|'='
number|'700'
op|')'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'soa'
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
DECL|member|_makeMessage
dedent|''
name|'def'
name|'_makeMessage'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# hooray they all have the same message format'
nl|'\n'
indent|'        '
name|'return'
name|'dns'
op|'.'
name|'Message'
op|'('
name|'id'
op|'='
number|'999'
op|','
name|'answer'
op|'='
number|'1'
op|','
name|'opCode'
op|'='
number|'0'
op|','
name|'recDes'
op|'='
number|'0'
op|','
name|'recAv'
op|'='
number|'1'
op|','
name|'auth'
op|'='
number|'1'
op|','
name|'rCode'
op|'='
number|'0'
op|','
name|'trunc'
op|'='
number|'0'
op|','
name|'maxSize'
op|'='
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testBindAndTNamesStyle
dedent|''
name|'def'
name|'testBindAndTNamesStyle'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Bind style = One big single message'
nl|'\n'
indent|'        '
name|'m'
op|'='
name|'self'
op|'.'
name|'_makeMessage'
op|'('
op|')'
newline|'\n'
name|'m'
op|'.'
name|'queries'
op|'='
op|'['
name|'dns'
op|'.'
name|'Query'
op|'('
string|"'fooby.com'"
op|','
name|'dns'
op|'.'
name|'AXFR'
op|','
name|'dns'
op|'.'
name|'IN'
op|')'
op|']'
newline|'\n'
name|'m'
op|'.'
name|'answers'
op|'='
name|'self'
op|'.'
name|'records'
newline|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'messageReceived'
op|'('
name|'m'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'results'
op|','
name|'self'
op|'.'
name|'records'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_gotResults
dedent|''
name|'def'
name|'_gotResults'
op|'('
name|'self'
op|','
name|'result'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'results'
op|'='
name|'result'
newline|'\n'
nl|'\n'
DECL|member|testDJBStyle
dedent|''
name|'def'
name|'testDJBStyle'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# DJB style = message per record'
nl|'\n'
indent|'        '
name|'records'
op|'='
name|'self'
op|'.'
name|'records'
op|'['
op|':'
op|']'
newline|'\n'
name|'while'
name|'records'
op|':'
newline|'\n'
indent|'            '
name|'m'
op|'='
name|'self'
op|'.'
name|'_makeMessage'
op|'('
op|')'
newline|'\n'
name|'m'
op|'.'
name|'queries'
op|'='
op|'['
op|']'
comment|"# DJB *doesn't* specify any queries.. hmm.."
newline|'\n'
name|'m'
op|'.'
name|'answers'
op|'='
op|'['
name|'records'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'messageReceived'
op|'('
name|'m'
op|','
name|'None'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'results'
op|','
name|'self'
op|'.'
name|'records'
op|')'
newline|'\n'
nl|'\n'
DECL|class|HostsTestCase
dedent|''
dedent|''
name|'class'
name|'HostsTestCase'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'f'
op|'='
name|'open'
op|'('
string|"'EtcHosts'"
op|','
string|"'w'"
op|')'
newline|'\n'
name|'f'
op|'.'
name|'write'
op|'('
string|"'''\n1.1.1.1    EXAMPLE EXAMPLE.EXAMPLETHING\n1.1.1.2    HOOJY\n::1        ip6thingy\n'''"
op|')'
newline|'\n'
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'resolver'
op|'='
name|'hosts'
op|'.'
name|'Resolver'
op|'('
string|"'EtcHosts'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|testGetHostByName
dedent|''
name|'def'
name|'testGetHostByName'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'data'
op|'='
op|'['
op|'('
string|"'EXAMPLE'"
op|','
string|"'1.1.1.1'"
op|')'
op|','
nl|'\n'
op|'('
string|"'EXAMPLE.EXAMPLETHING'"
op|','
string|"'1.1.1.1'"
op|')'
op|','
nl|'\n'
op|'('
string|"'HOOJY'"
op|','
string|"'1.1.1.2'"
op|')'
op|','
nl|'\n'
op|']'
newline|'\n'
name|'ds'
op|'='
op|'['
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'getHostByName'
op|'('
name|'n'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'assertEqual'
op|','
name|'ip'
op|')'
nl|'\n'
name|'for'
name|'n'
op|','
name|'ip'
name|'in'
name|'data'
op|']'
newline|'\n'
name|'return'
name|'defer'
op|'.'
name|'gatherResults'
op|'('
name|'ds'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testLookupAddress
dedent|''
name|'def'
name|'testLookupAddress'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupAddress'
op|'('
string|"'HOOJY'"
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'lambda'
name|'x'
op|':'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'['
number|'0'
op|']'
op|'['
number|'0'
op|']'
op|'.'
name|'payload'
op|'.'
name|'dottedQuad'
op|'('
op|')'
op|','
nl|'\n'
string|"'1.1.1.2'"
op|')'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|testIPv6
dedent|''
name|'def'
name|'testIPv6'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupIPV6Address'
op|'('
string|"'ip6thingy'"
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'assertEqual'
op|','
string|"'::1'"
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
dedent|''
name|'testIPv6'
op|'.'
name|'skip'
op|'='
string|"'IPv6 support is not in our hosts resolver yet'"
newline|'\n'
nl|'\n'
DECL|member|testNotImplemented
name|'def'
name|'testNotImplemented'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'assertFailure'
op|'('
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupMailExchange'
op|'('
string|"'EXAMPLE'"
op|')'
op|','
nl|'\n'
name|'NotImplementedError'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testQuery
dedent|''
name|'def'
name|'testQuery'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'query'
op|'('
name|'dns'
op|'.'
name|'Query'
op|'('
string|"'EXAMPLE'"
op|')'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
name|'lambda'
name|'x'
op|':'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'x'
op|'['
number|'0'
op|']'
op|'['
number|'0'
op|']'
op|'.'
name|'payload'
op|'.'
name|'dottedQuad'
op|'('
op|')'
op|','
nl|'\n'
string|"'1.1.1.1'"
op|')'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
DECL|member|testNotFound
dedent|''
name|'def'
name|'testNotFound'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'assertFailure'
op|'('
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'lookupAddress'
op|'('
string|"'foueoa'"
op|')'
op|','
nl|'\n'
name|'dns'
op|'.'
name|'DomainError'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeDNSDatagramProtocol
dedent|''
dedent|''
name|'class'
name|'FakeDNSDatagramProtocol'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'queries'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'transport'
op|'='
name|'StubPort'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|query
dedent|''
name|'def'
name|'query'
op|'('
name|'self'
op|','
name|'address'
op|','
name|'queries'
op|','
name|'timeout'
op|'='
number|'10'
op|','
name|'id'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'queries'
op|'.'
name|'append'
op|'('
op|'('
name|'address'
op|','
name|'queries'
op|','
name|'timeout'
op|','
name|'id'
op|')'
op|')'
newline|'\n'
name|'return'
name|'defer'
op|'.'
name|'fail'
op|'('
name|'dns'
op|'.'
name|'DNSQueryTimeoutError'
op|'('
name|'queries'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|removeResend
dedent|''
name|'def'
name|'removeResend'
op|'('
name|'self'
op|','
name|'id'
op|')'
op|':'
newline|'\n'
comment|'# Ignore this for the time being.'
nl|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|class|RetryLogic
dedent|''
dedent|''
name|'class'
name|'RetryLogic'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|variable|testServers
indent|'    '
name|'testServers'
op|'='
op|'['
nl|'\n'
string|"'1.2.3.4'"
op|','
nl|'\n'
string|"'4.3.2.1'"
op|','
nl|'\n'
string|"'a.b.c.d'"
op|','
nl|'\n'
string|"'z.y.x.w'"
op|']'
newline|'\n'
nl|'\n'
DECL|member|testRoundRobinBackoff
name|'def'
name|'testRoundRobinBackoff'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'addrs'
op|'='
op|'['
op|'('
name|'x'
op|','
number|'53'
op|')'
name|'for'
name|'x'
name|'in'
name|'self'
op|'.'
name|'testServers'
op|']'
newline|'\n'
name|'r'
op|'='
name|'client'
op|'.'
name|'Resolver'
op|'('
name|'resolv'
op|'='
name|'None'
op|','
name|'servers'
op|'='
name|'addrs'
op|')'
newline|'\n'
name|'r'
op|'.'
name|'protocol'
op|'='
name|'proto'
op|'='
name|'FakeDNSDatagramProtocol'
op|'('
op|')'
newline|'\n'
name|'return'
name|'r'
op|'.'
name|'lookupAddress'
op|'('
string|'"foo.example.com"'
nl|'\n'
op|')'
op|'.'
name|'addCallback'
op|'('
name|'self'
op|'.'
name|'_cbRoundRobinBackoff'
nl|'\n'
op|')'
op|'.'
name|'addErrback'
op|'('
name|'self'
op|'.'
name|'_ebRoundRobinBackoff'
op|','
name|'proto'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_cbRoundRobinBackoff
dedent|''
name|'def'
name|'_cbRoundRobinBackoff'
op|'('
name|'self'
op|','
name|'result'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'unittest'
op|'.'
name|'FailTest'
op|'('
string|'"Lookup address succeeded, should have timed out"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_ebRoundRobinBackoff
dedent|''
name|'def'
name|'_ebRoundRobinBackoff'
op|'('
name|'self'
op|','
name|'failure'
op|','
name|'fakeProto'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'failure'
op|'.'
name|'trap'
op|'('
name|'defer'
op|'.'
name|'TimeoutError'
op|')'
newline|'\n'
nl|'\n'
comment|'# Assert that each server is tried with a particular timeout'
nl|'\n'
comment|'# before the timeout is increased and the attempts are repeated.'
nl|'\n'
nl|'\n'
name|'for'
name|'t'
name|'in'
op|'('
number|'1'
op|','
number|'3'
op|','
number|'11'
op|','
number|'45'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'tries'
op|'='
name|'fakeProto'
op|'.'
name|'queries'
op|'['
op|':'
name|'len'
op|'('
name|'self'
op|'.'
name|'testServers'
op|')'
op|']'
newline|'\n'
name|'del'
name|'fakeProto'
op|'.'
name|'queries'
op|'['
op|':'
name|'len'
op|'('
name|'self'
op|'.'
name|'testServers'
op|')'
op|']'
newline|'\n'
nl|'\n'
name|'tries'
op|'.'
name|'sort'
op|'('
op|')'
newline|'\n'
name|'expected'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'testServers'
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'sort'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'for'
op|'('
op|'('
name|'addr'
op|','
name|'query'
op|','
name|'timeout'
op|','
name|'id'
op|')'
op|','
name|'expectedAddr'
op|')'
name|'in'
name|'zip'
op|'('
name|'tries'
op|','
name|'expected'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'addr'
op|','
op|'('
name|'expectedAddr'
op|','
number|'53'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'timeout'
op|','
name|'t'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'failIf'
op|'('
name|'fakeProto'
op|'.'
name|'queries'
op|')'
newline|'\n'
nl|'\n'
DECL|class|ResolvConfHandling
dedent|''
dedent|''
name|'class'
name|'ResolvConfHandling'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|testMissing
indent|'    '
name|'def'
name|'testMissing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resolvConf'
op|'='
name|'self'
op|'.'
name|'mktemp'
op|'('
op|')'
newline|'\n'
name|'r'
op|'='
name|'client'
op|'.'
name|'Resolver'
op|'('
name|'resolv'
op|'='
name|'resolvConf'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'r'
op|'.'
name|'dynServers'
op|','
op|'['
op|'('
string|"'127.0.0.1'"
op|','
number|'53'
op|')'
op|']'
op|')'
newline|'\n'
name|'r'
op|'.'
name|'_parseCall'
op|'.'
name|'cancel'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|testEmpty
dedent|''
name|'def'
name|'testEmpty'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'resolvConf'
op|'='
name|'self'
op|'.'
name|'mktemp'
op|'('
op|')'
newline|'\n'
name|'fObj'
op|'='
name|'file'
op|'('
name|'resolvConf'
op|','
string|"'w'"
op|')'
newline|'\n'
name|'fObj'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'r'
op|'='
name|'client'
op|'.'
name|'Resolver'
op|'('
name|'resolv'
op|'='
name|'resolvConf'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'r'
op|'.'
name|'dynServers'
op|','
op|'['
op|'('
string|"'127.0.0.1'"
op|','
number|'53'
op|')'
op|']'
op|')'
newline|'\n'
name|'r'
op|'.'
name|'_parseCall'
op|'.'
name|'cancel'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
DECL|class|FilterAnswersTests
dedent|''
dedent|''
name|'class'
name|'FilterAnswersTests'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    Test L{twisted.names.client.Resolver.filterAnswers}\'s handling of various\n    error conditions it might encounter.\n    """'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|"# Create a resolver pointed at an invalid server - we won't be hitting"
nl|'\n'
comment|'# the network in any of these tests.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'resolver'
op|'='
name|'Resolver'
op|'('
name|'servers'
op|'='
op|'['
op|'('
string|"'0.0.0.0'"
op|','
number|'0'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_truncatedMessage
dedent|''
name|'def'
name|'test_truncatedMessage'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Test that a truncated message results in an equivalent request made via\n        TCP.\n        """'
newline|'\n'
name|'m'
op|'='
name|'Message'
op|'('
name|'trunc'
op|'='
name|'True'
op|')'
newline|'\n'
name|'m'
op|'.'
name|'addQuery'
op|'('
string|"'example.com'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|queryTCP
name|'def'
name|'queryTCP'
op|'('
name|'queries'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'queries'
op|','
name|'m'
op|'.'
name|'queries'
op|')'
newline|'\n'
name|'response'
op|'='
name|'Message'
op|'('
op|')'
newline|'\n'
name|'response'
op|'.'
name|'answers'
op|'='
op|'['
string|"'answer'"
op|']'
newline|'\n'
name|'response'
op|'.'
name|'authority'
op|'='
op|'['
string|"'authority'"
op|']'
newline|'\n'
name|'response'
op|'.'
name|'additional'
op|'='
op|'['
string|"'additional'"
op|']'
newline|'\n'
name|'return'
name|'succeed'
op|'('
name|'response'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'queryTCP'
op|'='
name|'queryTCP'
newline|'\n'
name|'d'
op|'='
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'filterAnswers'
op|'('
name|'m'
op|')'
newline|'\n'
name|'d'
op|'.'
name|'addCallback'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|','
op|'('
op|'['
string|"'answer'"
op|']'
op|','
op|'['
string|"'authority'"
op|']'
op|','
op|'['
string|"'additional'"
op|']'
op|')'
op|')'
newline|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|_rcodeTest
dedent|''
name|'def'
name|'_rcodeTest'
op|'('
name|'self'
op|','
name|'rcode'
op|','
name|'exc'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'m'
op|'='
name|'Message'
op|'('
name|'rCode'
op|'='
name|'rcode'
op|')'
newline|'\n'
name|'err'
op|'='
name|'self'
op|'.'
name|'resolver'
op|'.'
name|'filterAnswers'
op|'('
name|'m'
op|')'
newline|'\n'
name|'err'
op|'.'
name|'trap'
op|'('
name|'exc'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_formatError
dedent|''
name|'def'
name|'test_formatError'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Test that a message with a result code of C{EFORMAT} results in a\n        failure wrapped around L{DNSFormatError}.\n        """'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'_rcodeTest'
op|'('
name|'EFORMAT'
op|','
name|'DNSFormatError'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_serverError
dedent|''
name|'def'
name|'test_serverError'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Like L{test_formatError} but for C{ESERVER}/L{DNSServerError}.\n        """'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'_rcodeTest'
op|'('
name|'ESERVER'
op|','
name|'DNSServerError'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_nameError
dedent|''
name|'def'
name|'test_nameError'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Like L{test_formatError} but for C{ENAME}/L{DNSNameError}.\n        """'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'_rcodeTest'
op|'('
name|'ENAME'
op|','
name|'DNSNameError'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_notImplementedError
dedent|''
name|'def'
name|'test_notImplementedError'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Like L{test_formatError} but for C{ENOTIMP}/L{DNSNotImplementedError}.\n        """'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'_rcodeTest'
op|'('
name|'ENOTIMP'
op|','
name|'DNSNotImplementedError'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_refusedError
dedent|''
name|'def'
name|'test_refusedError'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Like L{test_formatError} but for C{EREFUSED}/L{DNSQueryRefusedError}.\n        """'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'_rcodeTest'
op|'('
name|'EREFUSED'
op|','
name|'DNSQueryRefusedError'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_refusedErrorUnknown
dedent|''
name|'def'
name|'test_refusedErrorUnknown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Like L{test_formatError} but for an unrecognized error code and\n        L{DNSUnknownError}.\n        """'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'_rcodeTest'
op|'('
name|'EREFUSED'
op|'+'
number|'1'
op|','
name|'DNSUnknownError'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
