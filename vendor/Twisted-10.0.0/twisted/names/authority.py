begin_unit
comment|'# -*- test-case-name: twisted.names.test.test_names -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
name|'from'
name|'__future__'
name|'import'
name|'nested_scopes'
newline|'\n'
nl|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'time'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
name|'import'
name|'dns'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'defer'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'failure'
newline|'\n'
nl|'\n'
name|'import'
name|'common'
newline|'\n'
nl|'\n'
DECL|function|getSerial
name|'def'
name|'getSerial'
op|'('
name|'filename'
op|'='
string|"'/tmp/twisted-names.serial'"
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Return a monotonically increasing (across program runs) integer.\n\n    State is stored in the given file.  If it does not exist, it is\n    created with rw-/---/--- permissions.\n    """'
newline|'\n'
name|'serial'
op|'='
name|'time'
op|'.'
name|'strftime'
op|'('
string|"'%Y%m%d'"
op|')'
newline|'\n'
nl|'\n'
name|'o'
op|'='
name|'os'
op|'.'
name|'umask'
op|'('
number|'0177'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'f'
op|'='
name|'file'
op|'('
name|'filename'
op|','
string|"'w'"
op|')'
newline|'\n'
name|'f'
op|'.'
name|'write'
op|'('
name|'serial'
op|'+'
string|"' 0'"
op|')'
newline|'\n'
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'        '
name|'os'
op|'.'
name|'umask'
op|'('
name|'o'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'serialFile'
op|'='
name|'file'
op|'('
name|'filename'
op|','
string|"'r'"
op|')'
newline|'\n'
name|'lastSerial'
op|','
name|'ID'
op|'='
name|'serialFile'
op|'.'
name|'readline'
op|'('
op|')'
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'ID'
op|'='
op|'('
name|'lastSerial'
op|'=='
name|'serial'
op|')'
name|'and'
op|'('
name|'int'
op|'('
name|'ID'
op|')'
op|'+'
number|'1'
op|')'
name|'or'
number|'0'
newline|'\n'
name|'serialFile'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'serialFile'
op|'='
name|'file'
op|'('
name|'filename'
op|','
string|"'w'"
op|')'
newline|'\n'
name|'serialFile'
op|'.'
name|'write'
op|'('
string|"'%s %d'"
op|'%'
op|'('
name|'serial'
op|','
name|'ID'
op|')'
op|')'
newline|'\n'
name|'serialFile'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'serial'
op|'='
name|'serial'
op|'+'
op|'('
string|"'%02d'"
op|'%'
op|'('
name|'ID'
op|','
op|')'
op|')'
newline|'\n'
name|'return'
name|'serial'
newline|'\n'
nl|'\n'
nl|'\n'
comment|'#class LookupCacherMixin(object):'
nl|'\n'
comment|'#    _cache = None'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    def _lookup(self, name, cls, type, timeout = 10):'
nl|'\n'
comment|'#        if not self._cache:'
nl|'\n'
comment|'#            self._cache = {}'
nl|'\n'
comment|'#            self._meth = super(LookupCacherMixin, self)._lookup'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#        if self._cache.has_key((name, cls, type)):'
nl|'\n'
comment|'#            return self._cache[(name, cls, type)]'
nl|'\n'
comment|'#        else:'
nl|'\n'
comment|'#            r = self._meth(name, cls, type, timeout)'
nl|'\n'
comment|'#            self._cache[(name, cls, type)] = r'
nl|'\n'
comment|'#            return r'
nl|'\n'
nl|'\n'
nl|'\n'
DECL|class|FileAuthority
dedent|''
name|'class'
name|'FileAuthority'
op|'('
name|'common'
op|'.'
name|'ResolverBase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""An Authority that is loaded from a file."""'
newline|'\n'
nl|'\n'
DECL|variable|soa
name|'soa'
op|'='
name|'None'
newline|'\n'
DECL|variable|records
name|'records'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'common'
op|'.'
name|'ResolverBase'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'loadFile'
op|'('
name|'filename'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_cache'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|__setstate__
dedent|''
name|'def'
name|'__setstate__'
op|'('
name|'self'
op|','
name|'state'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'__dict__'
op|'='
name|'state'
newline|'\n'
comment|"#        print 'setstate ', self.soa"
nl|'\n'
nl|'\n'
DECL|member|_lookup
dedent|''
name|'def'
name|'_lookup'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'cls'
op|','
name|'type'
op|','
name|'timeout'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cnames'
op|'='
op|'['
op|']'
newline|'\n'
name|'results'
op|'='
op|'['
op|']'
newline|'\n'
name|'authority'
op|'='
op|'['
op|']'
newline|'\n'
name|'additional'
op|'='
op|'['
op|']'
newline|'\n'
name|'default_ttl'
op|'='
name|'max'
op|'('
name|'self'
op|'.'
name|'soa'
op|'['
number|'1'
op|']'
op|'.'
name|'minimum'
op|','
name|'self'
op|'.'
name|'soa'
op|'['
number|'1'
op|']'
op|'.'
name|'expire'
op|')'
newline|'\n'
nl|'\n'
name|'domain_records'
op|'='
name|'self'
op|'.'
name|'records'
op|'.'
name|'get'
op|'('
name|'name'
op|'.'
name|'lower'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'domain_records'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'record'
name|'in'
name|'domain_records'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'record'
op|'.'
name|'ttl'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'                    '
name|'ttl'
op|'='
name|'record'
op|'.'
name|'ttl'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'ttl'
op|'='
name|'default_ttl'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'record'
op|'.'
name|'TYPE'
op|'=='
name|'type'
name|'or'
name|'type'
op|'=='
name|'dns'
op|'.'
name|'ALL_RECORDS'
op|':'
newline|'\n'
indent|'                    '
name|'results'
op|'.'
name|'append'
op|'('
nl|'\n'
name|'dns'
op|'.'
name|'RRHeader'
op|'('
name|'name'
op|','
name|'record'
op|'.'
name|'TYPE'
op|','
name|'dns'
op|'.'
name|'IN'
op|','
name|'ttl'
op|','
name|'record'
op|','
name|'auth'
op|'='
name|'True'
op|')'
nl|'\n'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'record'
op|'.'
name|'TYPE'
op|'=='
name|'dns'
op|'.'
name|'NS'
name|'and'
name|'type'
op|'!='
name|'dns'
op|'.'
name|'ALL_RECORDS'
op|':'
newline|'\n'
indent|'                    '
name|'authority'
op|'.'
name|'append'
op|'('
nl|'\n'
name|'dns'
op|'.'
name|'RRHeader'
op|'('
name|'name'
op|','
name|'record'
op|'.'
name|'TYPE'
op|','
name|'dns'
op|'.'
name|'IN'
op|','
name|'ttl'
op|','
name|'record'
op|','
name|'auth'
op|'='
name|'True'
op|')'
nl|'\n'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'record'
op|'.'
name|'TYPE'
op|'=='
name|'dns'
op|'.'
name|'CNAME'
op|':'
newline|'\n'
indent|'                    '
name|'cnames'
op|'.'
name|'append'
op|'('
nl|'\n'
name|'dns'
op|'.'
name|'RRHeader'
op|'('
name|'name'
op|','
name|'record'
op|'.'
name|'TYPE'
op|','
name|'dns'
op|'.'
name|'IN'
op|','
name|'ttl'
op|','
name|'record'
op|','
name|'auth'
op|'='
name|'True'
op|')'
nl|'\n'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'not'
name|'results'
op|':'
newline|'\n'
indent|'                '
name|'results'
op|'='
name|'cnames'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'record'
name|'in'
name|'results'
op|'+'
name|'authority'
op|':'
newline|'\n'
indent|'                '
name|'section'
op|'='
op|'{'
name|'dns'
op|'.'
name|'NS'
op|':'
name|'additional'
op|','
name|'dns'
op|'.'
name|'CNAME'
op|':'
name|'results'
op|','
name|'dns'
op|'.'
name|'MX'
op|':'
name|'additional'
op|'}'
op|'.'
name|'get'
op|'('
name|'record'
op|'.'
name|'type'
op|')'
newline|'\n'
name|'if'
name|'section'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'                    '
name|'n'
op|'='
name|'str'
op|'('
name|'record'
op|'.'
name|'payload'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'for'
name|'rec'
name|'in'
name|'self'
op|'.'
name|'records'
op|'.'
name|'get'
op|'('
name|'n'
op|'.'
name|'lower'
op|'('
op|')'
op|','
op|'('
op|')'
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'if'
name|'rec'
op|'.'
name|'TYPE'
op|'=='
name|'dns'
op|'.'
name|'A'
op|':'
newline|'\n'
indent|'                            '
name|'section'
op|'.'
name|'append'
op|'('
nl|'\n'
name|'dns'
op|'.'
name|'RRHeader'
op|'('
name|'n'
op|','
name|'dns'
op|'.'
name|'A'
op|','
name|'dns'
op|'.'
name|'IN'
op|','
name|'rec'
op|'.'
name|'ttl'
name|'or'
name|'default_ttl'
op|','
name|'rec'
op|','
name|'auth'
op|'='
name|'True'
op|')'
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
dedent|''
name|'return'
name|'defer'
op|'.'
name|'succeed'
op|'('
op|'('
name|'results'
op|','
name|'authority'
op|','
name|'additional'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'name'
op|'.'
name|'lower'
op|'('
op|')'
op|'.'
name|'endswith'
op|'('
name|'self'
op|'.'
name|'soa'
op|'['
number|'0'
op|']'
op|'.'
name|'lower'
op|'('
op|')'
op|')'
op|':'
newline|'\n'
comment|"# We are the authority and we didn't find it.  Goodbye."
nl|'\n'
indent|'                '
name|'return'
name|'defer'
op|'.'
name|'fail'
op|'('
name|'failure'
op|'.'
name|'Failure'
op|'('
name|'dns'
op|'.'
name|'AuthoritativeDomainError'
op|'('
name|'name'
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'defer'
op|'.'
name|'fail'
op|'('
name|'failure'
op|'.'
name|'Failure'
op|'('
name|'dns'
op|'.'
name|'DomainError'
op|'('
name|'name'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|lookupZone
dedent|''
dedent|''
name|'def'
name|'lookupZone'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'timeout'
op|'='
number|'10'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'soa'
op|'['
number|'0'
op|']'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
name|'name'
op|'.'
name|'lower'
op|'('
op|')'
op|':'
newline|'\n'
comment|'# Wee hee hee hooo yea'
nl|'\n'
indent|'            '
name|'default_ttl'
op|'='
name|'max'
op|'('
name|'self'
op|'.'
name|'soa'
op|'['
number|'1'
op|']'
op|'.'
name|'minimum'
op|','
name|'self'
op|'.'
name|'soa'
op|'['
number|'1'
op|']'
op|'.'
name|'expire'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'soa'
op|'['
number|'1'
op|']'
op|'.'
name|'ttl'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'soa_ttl'
op|'='
name|'self'
op|'.'
name|'soa'
op|'['
number|'1'
op|']'
op|'.'
name|'ttl'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'soa_ttl'
op|'='
name|'default_ttl'
newline|'\n'
dedent|''
name|'results'
op|'='
op|'['
name|'dns'
op|'.'
name|'RRHeader'
op|'('
name|'self'
op|'.'
name|'soa'
op|'['
number|'0'
op|']'
op|','
name|'dns'
op|'.'
name|'SOA'
op|','
name|'dns'
op|'.'
name|'IN'
op|','
name|'soa_ttl'
op|','
name|'self'
op|'.'
name|'soa'
op|'['
number|'1'
op|']'
op|','
name|'auth'
op|'='
name|'True'
op|')'
op|']'
newline|'\n'
name|'for'
op|'('
name|'k'
op|','
name|'r'
op|')'
name|'in'
name|'self'
op|'.'
name|'records'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'for'
name|'rec'
name|'in'
name|'r'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'rec'
op|'.'
name|'ttl'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'                        '
name|'ttl'
op|'='
name|'rec'
op|'.'
name|'ttl'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'ttl'
op|'='
name|'default_ttl'
newline|'\n'
dedent|''
name|'if'
name|'rec'
op|'.'
name|'TYPE'
op|'!='
name|'dns'
op|'.'
name|'SOA'
op|':'
newline|'\n'
indent|'                        '
name|'results'
op|'.'
name|'append'
op|'('
name|'dns'
op|'.'
name|'RRHeader'
op|'('
name|'k'
op|','
name|'rec'
op|'.'
name|'TYPE'
op|','
name|'dns'
op|'.'
name|'IN'
op|','
name|'ttl'
op|','
name|'rec'
op|','
name|'auth'
op|'='
name|'True'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'results'
op|'.'
name|'append'
op|'('
name|'results'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'return'
name|'defer'
op|'.'
name|'succeed'
op|'('
op|'('
name|'results'
op|','
op|'('
op|')'
op|','
op|'('
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'defer'
op|'.'
name|'fail'
op|'('
name|'failure'
op|'.'
name|'Failure'
op|'('
name|'dns'
op|'.'
name|'DomainError'
op|'('
name|'name'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_cbAllRecords
dedent|''
name|'def'
name|'_cbAllRecords'
op|'('
name|'self'
op|','
name|'results'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ans'
op|','
name|'auth'
op|','
name|'add'
op|'='
op|'['
op|']'
op|','
op|'['
op|']'
op|','
op|'['
op|']'
newline|'\n'
name|'for'
name|'res'
name|'in'
name|'results'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'res'
op|'['
number|'0'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'ans'
op|'.'
name|'extend'
op|'('
name|'res'
op|'['
number|'1'
op|']'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'auth'
op|'.'
name|'extend'
op|'('
name|'res'
op|'['
number|'1'
op|']'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
name|'add'
op|'.'
name|'extend'
op|'('
name|'res'
op|'['
number|'1'
op|']'
op|'['
number|'2'
op|']'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'ans'
op|','
name|'auth'
op|','
name|'add'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|PySourceAuthority
dedent|''
dedent|''
name|'class'
name|'PySourceAuthority'
op|'('
name|'FileAuthority'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""A FileAuthority that is built up from Python source code."""'
newline|'\n'
nl|'\n'
DECL|member|loadFile
name|'def'
name|'loadFile'
op|'('
name|'self'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'g'
op|','
name|'l'
op|'='
name|'self'
op|'.'
name|'setupConfigNamespace'
op|'('
op|')'
op|','
op|'{'
op|'}'
newline|'\n'
name|'execfile'
op|'('
name|'filename'
op|','
name|'g'
op|','
name|'l'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'l'
op|'.'
name|'has_key'
op|'('
string|"'zone'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ValueError'
op|','
string|'"No zone defined in "'
op|'+'
name|'filename'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'records'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'rr'
name|'in'
name|'l'
op|'['
string|"'zone'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'isinstance'
op|'('
name|'rr'
op|'['
number|'1'
op|']'
op|','
name|'dns'
op|'.'
name|'Record_SOA'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'soa'
op|'='
name|'rr'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'records'
op|'.'
name|'setdefault'
op|'('
name|'rr'
op|'['
number|'0'
op|']'
op|'.'
name|'lower'
op|'('
op|')'
op|','
op|'['
op|']'
op|')'
op|'.'
name|'append'
op|'('
name|'rr'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|wrapRecord
dedent|''
dedent|''
name|'def'
name|'wrapRecord'
op|'('
name|'self'
op|','
name|'type'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'lambda'
name|'name'
op|','
op|'*'
name|'arg'
op|','
op|'**'
name|'kw'
op|':'
op|'('
name|'name'
op|','
name|'type'
op|'('
op|'*'
name|'arg'
op|','
op|'**'
name|'kw'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|setupConfigNamespace
dedent|''
name|'def'
name|'setupConfigNamespace'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'r'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'items'
op|'='
name|'dns'
op|'.'
name|'__dict__'
op|'.'
name|'iterkeys'
op|'('
op|')'
newline|'\n'
name|'for'
name|'record'
name|'in'
op|'['
name|'x'
name|'for'
name|'x'
name|'in'
name|'items'
name|'if'
name|'x'
op|'.'
name|'startswith'
op|'('
string|"'Record_'"
op|')'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'type'
op|'='
name|'getattr'
op|'('
name|'dns'
op|','
name|'record'
op|')'
newline|'\n'
name|'f'
op|'='
name|'self'
op|'.'
name|'wrapRecord'
op|'('
name|'type'
op|')'
newline|'\n'
name|'r'
op|'['
name|'record'
op|'['
name|'len'
op|'('
string|"'Record_'"
op|')'
op|':'
op|']'
op|']'
op|'='
name|'f'
newline|'\n'
dedent|''
name|'return'
name|'r'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|BindAuthority
dedent|''
dedent|''
name|'class'
name|'BindAuthority'
op|'('
name|'FileAuthority'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""An Authority that loads BIND configuration files"""'
newline|'\n'
nl|'\n'
DECL|member|loadFile
name|'def'
name|'loadFile'
op|'('
name|'self'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'origin'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'filename'
op|')'
op|'+'
string|"'.'"
comment|'# XXX - this might suck'
newline|'\n'
name|'lines'
op|'='
name|'open'
op|'('
name|'filename'
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
newline|'\n'
name|'lines'
op|'='
name|'self'
op|'.'
name|'stripComments'
op|'('
name|'lines'
op|')'
newline|'\n'
name|'lines'
op|'='
name|'self'
op|'.'
name|'collapseContinuations'
op|'('
name|'lines'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'parseLines'
op|'('
name|'lines'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|stripComments
dedent|''
name|'def'
name|'stripComments'
op|'('
name|'self'
op|','
name|'lines'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
op|'['
nl|'\n'
name|'a'
op|'.'
name|'find'
op|'('
string|"';'"
op|')'
op|'=='
op|'-'
number|'1'
name|'and'
name|'a'
name|'or'
name|'a'
op|'['
op|':'
name|'a'
op|'.'
name|'find'
op|'('
string|"';'"
op|')'
op|']'
name|'for'
name|'a'
name|'in'
op|'['
nl|'\n'
name|'b'
op|'.'
name|'strip'
op|'('
op|')'
name|'for'
name|'b'
name|'in'
name|'lines'
nl|'\n'
op|']'
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|collapseContinuations
dedent|''
name|'def'
name|'collapseContinuations'
op|'('
name|'self'
op|','
name|'lines'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'L'
op|'='
op|'['
op|']'
newline|'\n'
name|'state'
op|'='
number|'0'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'lines'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'state'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'line'
op|'.'
name|'find'
op|'('
string|"'('"
op|')'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'                    '
name|'L'
op|'.'
name|'append'
op|'('
name|'line'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'L'
op|'.'
name|'append'
op|'('
name|'line'
op|'['
op|':'
name|'line'
op|'.'
name|'find'
op|'('
string|"'('"
op|')'
op|']'
op|')'
newline|'\n'
name|'state'
op|'='
number|'1'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'line'
op|'.'
name|'find'
op|'('
string|"')'"
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'                    '
name|'L'
op|'['
op|'-'
number|'1'
op|']'
op|'+='
string|"' '"
op|'+'
name|'line'
op|'['
op|':'
name|'line'
op|'.'
name|'find'
op|'('
string|"')'"
op|')'
op|']'
newline|'\n'
name|'state'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'L'
op|'['
op|'-'
number|'1'
op|']'
op|'+='
string|"' '"
op|'+'
name|'line'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'lines'
op|'='
name|'L'
newline|'\n'
name|'L'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'lines'
op|':'
newline|'\n'
indent|'            '
name|'L'
op|'.'
name|'append'
op|'('
name|'line'
op|'.'
name|'split'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'filter'
op|'('
name|'None'
op|','
name|'L'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|parseLines
dedent|''
name|'def'
name|'parseLines'
op|'('
name|'self'
op|','
name|'lines'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'TTL'
op|'='
number|'60'
op|'*'
number|'60'
op|'*'
number|'3'
newline|'\n'
name|'ORIGIN'
op|'='
name|'self'
op|'.'
name|'origin'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'records'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
name|'for'
op|'('
name|'line'
op|','
name|'index'
op|')'
name|'in'
name|'zip'
op|'('
name|'lines'
op|','
name|'range'
op|'('
name|'len'
op|'('
name|'lines'
op|')'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'line'
op|'['
number|'0'
op|']'
op|'=='
string|"'$TTL'"
op|':'
newline|'\n'
indent|'                '
name|'TTL'
op|'='
name|'dns'
op|'.'
name|'str2time'
op|'('
name|'line'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'line'
op|'['
number|'0'
op|']'
op|'=='
string|"'$ORIGIN'"
op|':'
newline|'\n'
indent|'                '
name|'ORIGIN'
op|'='
name|'line'
op|'['
number|'1'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'line'
op|'['
number|'0'
op|']'
op|'=='
string|"'$INCLUDE'"
op|':'
comment|'# XXX - oh, fuck me'
newline|'\n'
indent|'                '
name|'raise'
name|'NotImplementedError'
op|'('
string|"'$INCLUDE directive not implemented'"
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'line'
op|'['
number|'0'
op|']'
op|'=='
string|"'$GENERATE'"
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'NotImplementedError'
op|'('
string|"'$GENERATE directive not implemented'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'parseRecordLine'
op|'('
name|'ORIGIN'
op|','
name|'TTL'
op|','
name|'line'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|addRecord
dedent|''
dedent|''
dedent|''
name|'def'
name|'addRecord'
op|'('
name|'self'
op|','
name|'owner'
op|','
name|'ttl'
op|','
name|'type'
op|','
name|'domain'
op|','
name|'cls'
op|','
name|'rdata'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'domain'
op|'.'
name|'endswith'
op|'('
string|"'.'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'domain'
op|'='
name|'domain'
op|'+'
string|"'.'"
op|'+'
name|'owner'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'domain'
op|'='
name|'domain'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
dedent|''
name|'f'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
string|"'class_%s'"
op|'%'
name|'cls'
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'f'
op|':'
newline|'\n'
indent|'            '
name|'f'
op|'('
name|'ttl'
op|','
name|'type'
op|','
name|'domain'
op|','
name|'rdata'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'NotImplementedError'
op|','
string|'"Record class %r not supported"'
op|'%'
name|'cls'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|class_IN
dedent|''
dedent|''
name|'def'
name|'class_IN'
op|'('
name|'self'
op|','
name|'ttl'
op|','
name|'type'
op|','
name|'domain'
op|','
name|'rdata'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'record'
op|'='
name|'getattr'
op|'('
name|'dns'
op|','
string|"'Record_%s'"
op|'%'
name|'type'
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'record'
op|':'
newline|'\n'
indent|'            '
name|'r'
op|'='
name|'record'
op|'('
op|'*'
name|'rdata'
op|')'
newline|'\n'
name|'r'
op|'.'
name|'ttl'
op|'='
name|'ttl'
newline|'\n'
name|'self'
op|'.'
name|'records'
op|'.'
name|'setdefault'
op|'('
name|'domain'
op|'.'
name|'lower'
op|'('
op|')'
op|','
op|'['
op|']'
op|')'
op|'.'
name|'append'
op|'('
name|'r'
op|')'
newline|'\n'
nl|'\n'
name|'print'
string|"'Adding IN Record'"
op|','
name|'domain'
op|','
name|'ttl'
op|','
name|'r'
newline|'\n'
name|'if'
name|'type'
op|'=='
string|"'SOA'"
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'soa'
op|'='
op|'('
name|'domain'
op|','
name|'r'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'NotImplementedError'
op|','
string|'"Record type %r not supported"'
op|'%'
name|'type'
newline|'\n'
nl|'\n'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# This file ends here.  Read no further.'
nl|'\n'
comment|'#'
nl|'\n'
DECL|member|parseRecordLine
dedent|''
dedent|''
name|'def'
name|'parseRecordLine'
op|'('
name|'self'
op|','
name|'origin'
op|','
name|'ttl'
op|','
name|'line'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'MARKERS'
op|'='
name|'dns'
op|'.'
name|'QUERY_CLASSES'
op|'.'
name|'values'
op|'('
op|')'
op|'+'
name|'dns'
op|'.'
name|'QUERY_TYPES'
op|'.'
name|'values'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'='
string|"'IN'"
newline|'\n'
name|'owner'
op|'='
name|'origin'
newline|'\n'
nl|'\n'
name|'if'
name|'line'
op|'['
number|'0'
op|']'
op|'=='
string|"'@'"
op|':'
newline|'\n'
indent|'            '
name|'line'
op|'='
name|'line'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
name|'owner'
op|'='
name|'origin'
newline|'\n'
comment|"#            print 'default owner'"
nl|'\n'
dedent|''
name|'elif'
name|'not'
name|'line'
op|'['
number|'0'
op|']'
op|'.'
name|'isdigit'
op|'('
op|')'
name|'and'
name|'line'
op|'['
number|'0'
op|']'
name|'not'
name|'in'
name|'MARKERS'
op|':'
newline|'\n'
indent|'            '
name|'owner'
op|'='
name|'line'
op|'['
number|'0'
op|']'
newline|'\n'
name|'line'
op|'='
name|'line'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
comment|"#            print 'owner is ', owner"
nl|'\n'
nl|'\n'
dedent|''
name|'if'
name|'line'
op|'['
number|'0'
op|']'
op|'.'
name|'isdigit'
op|'('
op|')'
name|'or'
name|'line'
op|'['
number|'0'
op|']'
name|'in'
name|'MARKERS'
op|':'
newline|'\n'
indent|'            '
name|'domain'
op|'='
name|'owner'
newline|'\n'
name|'owner'
op|'='
name|'origin'
newline|'\n'
comment|"#            print 'woops, owner is ', owner, ' domain is ', domain"
nl|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'domain'
op|'='
name|'line'
op|'['
number|'0'
op|']'
newline|'\n'
name|'line'
op|'='
name|'line'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
comment|"#            print 'domain is ', domain"
nl|'\n'
nl|'\n'
dedent|''
name|'if'
name|'line'
op|'['
number|'0'
op|']'
name|'in'
name|'dns'
op|'.'
name|'QUERY_CLASSES'
op|'.'
name|'values'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'cls'
op|'='
name|'line'
op|'['
number|'0'
op|']'
newline|'\n'
name|'line'
op|'='
name|'line'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
comment|"#            print 'cls is ', cls"
nl|'\n'
name|'if'
name|'line'
op|'['
number|'0'
op|']'
op|'.'
name|'isdigit'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'ttl'
op|'='
name|'int'
op|'('
name|'line'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'line'
op|'='
name|'line'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
comment|"#                print 'ttl is ', ttl"
nl|'\n'
dedent|''
dedent|''
name|'elif'
name|'line'
op|'['
number|'0'
op|']'
op|'.'
name|'isdigit'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'ttl'
op|'='
name|'int'
op|'('
name|'line'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'line'
op|'='
name|'line'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
comment|"#            print 'ttl is ', ttl"
nl|'\n'
name|'if'
name|'line'
op|'['
number|'0'
op|']'
name|'in'
name|'dns'
op|'.'
name|'QUERY_CLASSES'
op|'.'
name|'values'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'cls'
op|'='
name|'line'
op|'['
number|'0'
op|']'
newline|'\n'
name|'line'
op|'='
name|'line'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
comment|"#                print 'cls is ', cls"
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'type'
op|'='
name|'line'
op|'['
number|'0'
op|']'
newline|'\n'
comment|"#        print 'type is ', type"
nl|'\n'
name|'rdata'
op|'='
name|'line'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
comment|"#        print 'rdata is ', rdata"
nl|'\n'
nl|'\n'
name|'self'
op|'.'
name|'addRecord'
op|'('
name|'owner'
op|','
name|'ttl'
op|','
name|'type'
op|','
name|'domain'
op|','
name|'cls'
op|','
name|'rdata'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
