begin_unit
comment|'# -*- test-case-name: twisted.names.test -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
name|'import'
name|'time'
newline|'\n'
nl|'\n'
name|'from'
name|'zope'
op|'.'
name|'interface'
name|'import'
name|'implements'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
name|'import'
name|'dns'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'failure'
op|','
name|'log'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'interfaces'
op|','
name|'defer'
newline|'\n'
nl|'\n'
name|'import'
name|'common'
newline|'\n'
nl|'\n'
DECL|class|CacheResolver
name|'class'
name|'CacheResolver'
op|'('
name|'common'
op|'.'
name|'ResolverBase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""A resolver that serves records from a local, memory cache."""'
newline|'\n'
nl|'\n'
name|'implements'
op|'('
name|'interfaces'
op|'.'
name|'IResolver'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|cache
name|'cache'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'cache'
op|'='
name|'None'
op|','
name|'verbose'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'common'
op|'.'
name|'ResolverBase'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'cache'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'cache'
op|'='
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'cache'
op|'='
name|'cache'
newline|'\n'
name|'self'
op|'.'
name|'verbose'
op|'='
name|'verbose'
newline|'\n'
name|'self'
op|'.'
name|'cancel'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|__setstate__
dedent|''
name|'def'
name|'__setstate__'
op|'('
name|'self'
op|','
name|'state'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'__dict__'
op|'='
name|'state'
newline|'\n'
nl|'\n'
name|'now'
op|'='
name|'time'
op|'.'
name|'time'
op|'('
op|')'
newline|'\n'
name|'for'
op|'('
name|'k'
op|','
op|'('
name|'when'
op|','
op|'('
name|'ans'
op|','
name|'add'
op|','
name|'ns'
op|')'
op|')'
op|')'
name|'in'
name|'self'
op|'.'
name|'cache'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'diff'
op|'='
name|'now'
op|'-'
name|'when'
newline|'\n'
name|'for'
name|'rec'
name|'in'
name|'ans'
op|'+'
name|'add'
op|'+'
name|'ns'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'rec'
op|'.'
name|'ttl'
op|'<'
name|'diff'
op|':'
newline|'\n'
indent|'                    '
name|'del'
name|'self'
op|'.'
name|'cache'
op|'['
name|'k'
op|']'
newline|'\n'
name|'break'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|__getstate__
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'__getstate__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'c'
name|'in'
name|'self'
op|'.'
name|'cancel'
op|'.'
name|'values'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'c'
op|'.'
name|'cancel'
op|'('
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'cancel'
op|'.'
name|'clear'
op|'('
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'__dict__'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|_lookup
dedent|''
name|'def'
name|'_lookup'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'cls'
op|','
name|'type'
op|','
name|'timeout'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'now'
op|'='
name|'time'
op|'.'
name|'time'
op|'('
op|')'
newline|'\n'
name|'q'
op|'='
name|'dns'
op|'.'
name|'Query'
op|'('
name|'name'
op|','
name|'type'
op|','
name|'cls'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'when'
op|','
op|'('
name|'ans'
op|','
name|'auth'
op|','
name|'add'
op|')'
op|'='
name|'self'
op|'.'
name|'cache'
op|'['
name|'q'
op|']'
newline|'\n'
dedent|''
name|'except'
name|'KeyError'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'verbose'
op|'>'
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'log'
op|'.'
name|'msg'
op|'('
string|"'Cache miss for '"
op|'+'
name|'repr'
op|'('
name|'name'
op|')'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'defer'
op|'.'
name|'fail'
op|'('
name|'failure'
op|'.'
name|'Failure'
op|'('
name|'dns'
op|'.'
name|'DomainError'
op|'('
name|'name'
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'verbose'
op|':'
newline|'\n'
indent|'                '
name|'log'
op|'.'
name|'msg'
op|'('
string|"'Cache hit for '"
op|'+'
name|'repr'
op|'('
name|'name'
op|')'
op|')'
newline|'\n'
dedent|''
name|'diff'
op|'='
name|'now'
op|'-'
name|'when'
newline|'\n'
name|'return'
name|'defer'
op|'.'
name|'succeed'
op|'('
op|'('
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'RRHeader'
op|'('
name|'str'
op|'('
name|'r'
op|'.'
name|'name'
op|')'
op|','
name|'r'
op|'.'
name|'type'
op|','
name|'r'
op|'.'
name|'cls'
op|','
name|'r'
op|'.'
name|'ttl'
op|'-'
name|'diff'
op|','
name|'r'
op|'.'
name|'payload'
op|')'
name|'for'
name|'r'
name|'in'
name|'ans'
op|']'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'RRHeader'
op|'('
name|'str'
op|'('
name|'r'
op|'.'
name|'name'
op|')'
op|','
name|'r'
op|'.'
name|'type'
op|','
name|'r'
op|'.'
name|'cls'
op|','
name|'r'
op|'.'
name|'ttl'
op|'-'
name|'diff'
op|','
name|'r'
op|'.'
name|'payload'
op|')'
name|'for'
name|'r'
name|'in'
name|'auth'
op|']'
op|','
nl|'\n'
op|'['
name|'dns'
op|'.'
name|'RRHeader'
op|'('
name|'str'
op|'('
name|'r'
op|'.'
name|'name'
op|')'
op|','
name|'r'
op|'.'
name|'type'
op|','
name|'r'
op|'.'
name|'cls'
op|','
name|'r'
op|'.'
name|'ttl'
op|'-'
name|'diff'
op|','
name|'r'
op|'.'
name|'payload'
op|')'
name|'for'
name|'r'
name|'in'
name|'add'
op|']'
nl|'\n'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|lookupAllRecords
dedent|''
dedent|''
name|'def'
name|'lookupAllRecords'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'timeout'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'defer'
op|'.'
name|'fail'
op|'('
name|'failure'
op|'.'
name|'Failure'
op|'('
name|'dns'
op|'.'
name|'DomainError'
op|'('
name|'name'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|cacheResult
dedent|''
name|'def'
name|'cacheResult'
op|'('
name|'self'
op|','
name|'query'
op|','
name|'payload'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'verbose'
op|'>'
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'log'
op|'.'
name|'msg'
op|'('
string|"'Adding %r to cache'"
op|'%'
name|'query'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'cache'
op|'['
name|'query'
op|']'
op|'='
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|','
name|'payload'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'self'
op|'.'
name|'cancel'
op|'.'
name|'has_key'
op|'('
name|'query'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'cancel'
op|'['
name|'query'
op|']'
op|'.'
name|'cancel'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'s'
op|'='
name|'list'
op|'('
name|'payload'
op|'['
number|'0'
op|']'
op|')'
op|'+'
name|'list'
op|'('
name|'payload'
op|'['
number|'1'
op|']'
op|')'
op|'+'
name|'list'
op|'('
name|'payload'
op|'['
number|'2'
op|']'
op|')'
newline|'\n'
name|'m'
op|'='
name|'s'
op|'['
number|'0'
op|']'
op|'.'
name|'ttl'
newline|'\n'
name|'for'
name|'r'
name|'in'
name|'s'
op|':'
newline|'\n'
indent|'            '
name|'m'
op|'='
name|'min'
op|'('
name|'m'
op|','
name|'r'
op|'.'
name|'ttl'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'reactor'
newline|'\n'
name|'self'
op|'.'
name|'cancel'
op|'['
name|'query'
op|']'
op|'='
name|'reactor'
op|'.'
name|'callLater'
op|'('
name|'m'
op|','
name|'self'
op|'.'
name|'clearEntry'
op|','
name|'query'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|clearEntry
dedent|''
name|'def'
name|'clearEntry'
op|'('
name|'self'
op|','
name|'query'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'del'
name|'self'
op|'.'
name|'cache'
op|'['
name|'query'
op|']'
newline|'\n'
name|'del'
name|'self'
op|'.'
name|'cancel'
op|'['
name|'query'
op|']'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
