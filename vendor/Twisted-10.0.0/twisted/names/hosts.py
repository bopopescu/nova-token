begin_unit
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
name|'import'
name|'dns'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'persisted'
name|'import'
name|'styles'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'failure'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'internet'
name|'import'
name|'defer'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'names'
name|'import'
name|'common'
newline|'\n'
nl|'\n'
DECL|function|searchFileFor
name|'def'
name|'searchFileFor'
op|'('
name|'file'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'try'
op|':'
newline|'\n'
indent|'        '
name|'fp'
op|'='
name|'open'
op|'('
name|'file'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'None'
newline|'\n'
nl|'\n'
dedent|''
name|'lines'
op|'='
name|'fp'
op|'.'
name|'readlines'
op|'('
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'lines'
op|':'
newline|'\n'
indent|'        '
name|'idx'
op|'='
name|'line'
op|'.'
name|'find'
op|'('
string|"'#'"
op|')'
newline|'\n'
name|'if'
name|'idx'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'line'
op|'='
name|'line'
op|'['
op|':'
name|'idx'
op|']'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'line'
op|':'
newline|'\n'
indent|'            '
name|'continue'
newline|'\n'
dedent|''
name|'parts'
op|'='
name|'line'
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'if'
name|'name'
op|'.'
name|'lower'
op|'('
op|')'
name|'in'
op|'['
name|'s'
op|'.'
name|'lower'
op|'('
op|')'
name|'for'
name|'s'
name|'in'
name|'parts'
op|'['
number|'1'
op|':'
op|']'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'parts'
op|'['
number|'0'
op|']'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'None'
newline|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
DECL|class|Resolver
dedent|''
name|'class'
name|'Resolver'
op|'('
name|'common'
op|'.'
name|'ResolverBase'
op|','
name|'styles'
op|'.'
name|'Versioned'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""A resolver that services hosts(5) format files."""'
newline|'\n'
comment|'#TODO: IPv6 support'
nl|'\n'
nl|'\n'
DECL|variable|persistenceVersion
name|'persistenceVersion'
op|'='
number|'1'
newline|'\n'
nl|'\n'
DECL|member|upgradeToVersion1
name|'def'
name|'upgradeToVersion1'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# <3 exarkun'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'typeToMethod'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
op|'('
name|'k'
op|','
name|'v'
op|')'
name|'in'
name|'common'
op|'.'
name|'typeToMethod'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'typeToMethod'
op|'['
name|'k'
op|']'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
name|'v'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|__init__
dedent|''
dedent|''
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'file'
op|'='
string|"'/etc/hosts'"
op|','
name|'ttl'
op|'='
number|'60'
op|'*'
number|'60'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'common'
op|'.'
name|'ResolverBase'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'file'
op|'='
name|'file'
newline|'\n'
name|'self'
op|'.'
name|'ttl'
op|'='
name|'ttl'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|lookupAddress
dedent|''
name|'def'
name|'lookupAddress'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'timeout'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'res'
op|'='
name|'searchFileFor'
op|'('
name|'self'
op|'.'
name|'file'
op|','
name|'name'
op|')'
newline|'\n'
name|'if'
name|'res'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'defer'
op|'.'
name|'succeed'
op|'('
op|'['
nl|'\n'
op|'('
name|'dns'
op|'.'
name|'RRHeader'
op|'('
name|'name'
op|','
name|'dns'
op|'.'
name|'A'
op|','
name|'dns'
op|'.'
name|'IN'
op|','
name|'self'
op|'.'
name|'ttl'
op|','
name|'dns'
op|'.'
name|'Record_A'
op|'('
name|'res'
op|','
name|'self'
op|'.'
name|'ttl'
op|')'
op|')'
op|','
op|')'
op|','
op|'('
op|')'
op|','
op|'('
op|')'
nl|'\n'
op|']'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'defer'
op|'.'
name|'fail'
op|'('
name|'failure'
op|'.'
name|'Failure'
op|'('
name|'dns'
op|'.'
name|'DomainError'
op|'('
name|'name'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
comment|"# When we put IPv6 support in, this'll need a real impl"
nl|'\n'
DECL|variable|lookupAllRecords
dedent|''
name|'lookupAllRecords'
op|'='
name|'lookupAddress'
newline|'\n'
dedent|''
endmarker|''
end_unit
