begin_unit
comment|'# -*- Python -*-'
nl|'\n'
nl|'\n'
DECL|variable|__version__
name|'__version__'
op|'='
string|"'$Revision: 1.3 $'"
op|'['
number|'11'
op|':'
op|'-'
number|'2'
op|']'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'trial'
name|'import'
name|'unittest'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'protocols'
name|'import'
name|'htb'
newline|'\n'
nl|'\n'
DECL|class|DummyClock
name|'class'
name|'DummyClock'
op|':'
newline|'\n'
DECL|variable|time
indent|'    '
name|'time'
op|'='
number|'0'
newline|'\n'
DECL|member|set
name|'def'
name|'set'
op|'('
name|'self'
op|','
name|'when'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'time'
op|'='
name|'when'
newline|'\n'
nl|'\n'
DECL|member|__call__
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'time'
newline|'\n'
nl|'\n'
DECL|class|SomeBucket
dedent|''
dedent|''
name|'class'
name|'SomeBucket'
op|'('
name|'htb'
op|'.'
name|'Bucket'
op|')'
op|':'
newline|'\n'
DECL|variable|maxburst
indent|'    '
name|'maxburst'
op|'='
number|'100'
newline|'\n'
DECL|variable|rate
name|'rate'
op|'='
number|'2'
newline|'\n'
nl|'\n'
DECL|class|TestBucketBase
dedent|''
name|'class'
name|'TestBucketBase'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_realTimeFunc'
op|'='
name|'htb'
op|'.'
name|'time'
newline|'\n'
name|'self'
op|'.'
name|'clock'
op|'='
name|'DummyClock'
op|'('
op|')'
newline|'\n'
name|'htb'
op|'.'
name|'time'
op|'='
name|'self'
op|'.'
name|'clock'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'htb'
op|'.'
name|'time'
op|'='
name|'self'
op|'.'
name|'_realTimeFunc'
newline|'\n'
nl|'\n'
DECL|class|TestBucket
dedent|''
dedent|''
name|'class'
name|'TestBucket'
op|'('
name|'TestBucketBase'
op|')'
op|':'
newline|'\n'
DECL|member|testBucketSize
indent|'    '
name|'def'
name|'testBucketSize'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Testing the size of the bucket."""'
newline|'\n'
name|'b'
op|'='
name|'SomeBucket'
op|'('
op|')'
newline|'\n'
name|'fit'
op|'='
name|'b'
op|'.'
name|'add'
op|'('
number|'1000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessEqual'
op|'('
number|'100'
op|','
name|'fit'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testBucketDrian
dedent|''
name|'def'
name|'testBucketDrian'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Testing the bucket\'s drain rate."""'
newline|'\n'
name|'b'
op|'='
name|'SomeBucket'
op|'('
op|')'
newline|'\n'
name|'fit'
op|'='
name|'b'
op|'.'
name|'add'
op|'('
number|'1000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'clock'
op|'.'
name|'set'
op|'('
number|'10'
op|')'
newline|'\n'
name|'fit'
op|'='
name|'b'
op|'.'
name|'add'
op|'('
number|'1000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessEqual'
op|'('
number|'20'
op|','
name|'fit'
op|')'
newline|'\n'
nl|'\n'
DECL|class|TestBucketNesting
dedent|''
dedent|''
name|'class'
name|'TestBucketNesting'
op|'('
name|'TestBucketBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'TestBucketBase'
op|'.'
name|'setUp'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'parent'
op|'='
name|'SomeBucket'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'child1'
op|'='
name|'SomeBucket'
op|'('
name|'self'
op|'.'
name|'parent'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'child2'
op|'='
name|'SomeBucket'
op|'('
name|'self'
op|'.'
name|'parent'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testBucketParentSize
dedent|''
name|'def'
name|'testBucketParentSize'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Use up most of the parent bucket.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'child1'
op|'.'
name|'add'
op|'('
number|'90'
op|')'
newline|'\n'
name|'fit'
op|'='
name|'self'
op|'.'
name|'child2'
op|'.'
name|'add'
op|'('
number|'90'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessEqual'
op|'('
number|'10'
op|','
name|'fit'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testBucketParentRate
dedent|''
name|'def'
name|'testBucketParentRate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Make the parent bucket drain slower.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'parent'
op|'.'
name|'rate'
op|'='
number|'1'
newline|'\n'
comment|'# Fill both child1 and parent.'
nl|'\n'
name|'self'
op|'.'
name|'child1'
op|'.'
name|'add'
op|'('
number|'100'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'clock'
op|'.'
name|'set'
op|'('
number|'10'
op|')'
newline|'\n'
name|'fit'
op|'='
name|'self'
op|'.'
name|'child1'
op|'.'
name|'add'
op|'('
number|'100'
op|')'
newline|'\n'
comment|'# How much room was there?  The child bucket would have had 20,'
nl|'\n'
comment|"# but the parent bucket only ten (so no, it wouldn't make too much"
nl|'\n'
comment|'# sense to have a child bucket draining faster than its parent in a real'
nl|'\n'
comment|'# application.)'
nl|'\n'
name|'self'
op|'.'
name|'failUnlessEqual'
op|'('
number|'10'
op|','
name|'fit'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
comment|'# TODO: Test the Transport stuff?'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'from'
name|'test_pcp'
name|'import'
name|'DummyConsumer'
newline|'\n'
nl|'\n'
DECL|class|ConsumerShaperTest
name|'class'
name|'ConsumerShaperTest'
op|'('
name|'TestBucketBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'TestBucketBase'
op|'.'
name|'setUp'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'underlying'
op|'='
name|'DummyConsumer'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'bucket'
op|'='
name|'SomeBucket'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'shaped'
op|'='
name|'htb'
op|'.'
name|'ShapedConsumer'
op|'('
name|'self'
op|'.'
name|'underlying'
op|','
name|'self'
op|'.'
name|'bucket'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testRate
dedent|''
name|'def'
name|'testRate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|"# Start off with a full bucket, so the burst-size dosen't factor in"
nl|'\n'
comment|'# to the calculations.'
nl|'\n'
indent|'        '
name|'delta_t'
op|'='
number|'10'
newline|'\n'
name|'self'
op|'.'
name|'bucket'
op|'.'
name|'add'
op|'('
number|'100'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'shaped'
op|'.'
name|'write'
op|'('
string|'"x"'
op|'*'
number|'100'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'clock'
op|'.'
name|'set'
op|'('
name|'delta_t'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'shaped'
op|'.'
name|'resumeProducing'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessEqual'
op|'('
name|'len'
op|'('
name|'self'
op|'.'
name|'underlying'
op|'.'
name|'getvalue'
op|'('
op|')'
op|')'
op|','
nl|'\n'
name|'delta_t'
op|'*'
name|'self'
op|'.'
name|'bucket'
op|'.'
name|'rate'
op|')'
newline|'\n'
nl|'\n'
DECL|member|testBucketRefs
dedent|''
name|'def'
name|'testBucketRefs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'failUnlessEqual'
op|'('
name|'self'
op|'.'
name|'bucket'
op|'.'
name|'_refcount'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'shaped'
op|'.'
name|'stopProducing'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessEqual'
op|'('
name|'self'
op|'.'
name|'bucket'
op|'.'
name|'_refcount'
op|','
number|'0'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
