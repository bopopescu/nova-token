begin_unit
nl|'\n'
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'trial'
name|'import'
name|'unittest'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'manhole'
name|'import'
name|'service'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'spread'
op|'.'
name|'util'
name|'import'
name|'LocalAsRemote'
newline|'\n'
nl|'\n'
DECL|class|Dummy
name|'class'
name|'Dummy'
op|':'
newline|'\n'
indent|'    '
name|'pass'
newline|'\n'
nl|'\n'
DECL|class|DummyTransport
dedent|''
name|'class'
name|'DummyTransport'
op|':'
newline|'\n'
DECL|member|getHost
indent|'    '
name|'def'
name|'getHost'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
string|"'INET'"
op|','
string|"'127.0.0.1'"
op|','
number|'0'
newline|'\n'
nl|'\n'
DECL|class|DummyManholeClient
dedent|''
dedent|''
name|'class'
name|'DummyManholeClient'
op|'('
name|'LocalAsRemote'
op|')'
op|':'
newline|'\n'
DECL|variable|zero
indent|'    '
name|'zero'
op|'='
number|'0'
newline|'\n'
DECL|variable|broker
name|'broker'
op|'='
name|'Dummy'
op|'('
op|')'
newline|'\n'
name|'broker'
op|'.'
name|'transport'
op|'='
name|'DummyTransport'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'messages'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|member|console
dedent|''
name|'def'
name|'console'
op|'('
name|'self'
op|','
name|'messages'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'messages'
op|'.'
name|'extend'
op|'('
name|'messages'
op|')'
newline|'\n'
nl|'\n'
DECL|member|receiveExplorer
dedent|''
name|'def'
name|'receiveExplorer'
op|'('
name|'self'
op|','
name|'xplorer'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|setZero
dedent|''
name|'def'
name|'setZero'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'zero'
op|'='
name|'len'
op|'('
name|'self'
op|'.'
name|'messages'
op|')'
newline|'\n'
nl|'\n'
DECL|member|getMessages
dedent|''
name|'def'
name|'getMessages'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'messages'
op|'['
name|'self'
op|'.'
name|'zero'
op|':'
op|']'
newline|'\n'
nl|'\n'
comment|'# local interface'
nl|'\n'
DECL|variable|sync_console
dedent|''
name|'sync_console'
op|'='
name|'console'
newline|'\n'
DECL|variable|sync_receiveExplorer
name|'sync_receiveExplorer'
op|'='
name|'receiveExplorer'
newline|'\n'
DECL|variable|sync_setZero
name|'sync_setZero'
op|'='
name|'setZero'
newline|'\n'
DECL|variable|sync_getMessages
name|'sync_getMessages'
op|'='
name|'getMessages'
newline|'\n'
nl|'\n'
DECL|class|ManholeTest
dedent|''
name|'class'
name|'ManholeTest'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Various tests for the manhole service.\n\n    Both the the importIdentity and importMain tests are known to fail\n    when the __name__ in the manhole namespace is set to certain\n    values.\n    """'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'service'
op|'='
name|'service'
op|'.'
name|'Service'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'p'
op|'='
name|'service'
op|'.'
name|'Perspective'
op|'('
name|'self'
op|'.'
name|'service'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'='
name|'DummyManholeClient'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'p'
op|'.'
name|'attached'
op|'('
name|'self'
op|'.'
name|'client'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_importIdentity
dedent|''
name|'def'
name|'test_importIdentity'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Making sure imported module is the same as one previously loaded.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'p'
op|'.'
name|'perspective_do'
op|'('
string|'"from twisted.manhole import service"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'setZero'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'p'
op|'.'
name|'perspective_do'
op|'('
string|'"int(service is sys.modules[\'twisted.manhole.service\'])"'
op|')'
newline|'\n'
name|'msg'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'getMessages'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'failUnlessEqual'
op|'('
name|'msg'
op|','
op|'('
string|"'result'"
op|','
string|'"1\\n"'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_importMain
dedent|''
name|'def'
name|'test_importMain'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Trying to import __main__"""'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'.'
name|'setZero'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'p'
op|'.'
name|'perspective_do'
op|'('
string|'"import __main__"'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'getMessages'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'msg'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'getMessages'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'if'
name|'msg'
op|'['
number|'0'
op|']'
name|'in'
op|'('
string|'"exception"'
op|','
string|'"stderr"'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'fail'
op|'('
name|'msg'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|"#if __name__=='__main__':"
nl|'\n'
comment|'#    unittest.main()'
nl|'\n'
dedent|''
dedent|''
dedent|''
dedent|''
endmarker|''
end_unit
