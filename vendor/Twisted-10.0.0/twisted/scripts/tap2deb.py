begin_unit
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
name|'import'
name|'sys'
op|','
name|'os'
op|','
name|'string'
op|','
name|'shutil'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'usage'
newline|'\n'
nl|'\n'
DECL|class|MyOptions
name|'class'
name|'MyOptions'
op|'('
name|'usage'
op|'.'
name|'Options'
op|')'
op|':'
newline|'\n'
DECL|variable|optFlags
indent|'    '
name|'optFlags'
op|'='
op|'['
op|'['
string|'"unsigned"'
op|','
string|'"u"'
op|']'
op|']'
newline|'\n'
DECL|variable|optParameters
name|'optParameters'
op|'='
op|'['
op|'['
string|'"tapfile"'
op|','
string|'"t"'
op|','
string|'"twistd.tap"'
op|']'
op|','
nl|'\n'
op|'['
string|'"maintainer"'
op|','
string|'"m"'
op|','
string|'""'
op|','
string|'"The maintainer\'s name and email in a specific format: "'
nl|'\n'
string|'"\'John Doe <johndoe@example.com>\'"'
op|']'
op|','
nl|'\n'
op|'['
string|'"protocol"'
op|','
string|'"p"'
op|','
string|'""'
op|']'
op|','
nl|'\n'
op|'['
string|'"description"'
op|','
string|'"e"'
op|','
string|'""'
op|']'
op|','
nl|'\n'
op|'['
string|'"long_description"'
op|','
string|'"l"'
op|','
string|'""'
op|']'
op|','
nl|'\n'
op|'['
string|'"set-version"'
op|','
string|'"V"'
op|','
string|'"1.0"'
op|']'
op|','
nl|'\n'
op|'['
string|'"debfile"'
op|','
string|'"d"'
op|','
name|'None'
op|']'
op|','
nl|'\n'
op|'['
string|'"type"'
op|','
string|'"y"'
op|','
string|'"tap"'
op|','
string|'"type of configuration: \'tap\', \'xml, \'source\' or \'python\' for .tac files"'
op|']'
op|']'
newline|'\n'
nl|'\n'
comment|'#zsh_altArgDescr = {"foo":"use this description for foo instead"}'
nl|'\n'
comment|'#zsh_multiUse = ["foo", "bar"]'
nl|'\n'
comment|'#zsh_mutuallyExclusive = [("foo", "bar"), ("bar", "baz")]'
nl|'\n'
DECL|variable|zsh_actions
name|'zsh_actions'
op|'='
op|'{'
string|'"type"'
op|':'
string|'"(tap xml source python)"'
op|'}'
newline|'\n'
comment|'#zsh_actionDescr = {"logfile":"log file name", "random":"random seed"}'
nl|'\n'
nl|'\n'
DECL|member|postOptions
name|'def'
name|'postOptions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'['
string|'"maintainer"'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'usage'
op|'.'
name|'UsageError'
op|','
string|'"maintainer must be specified."'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|type_dict
dedent|''
dedent|''
dedent|''
name|'type_dict'
op|'='
op|'{'
nl|'\n'
string|"'tap'"
op|':'
string|"'file'"
op|','
nl|'\n'
string|"'python'"
op|':'
string|"'python'"
op|','
nl|'\n'
string|"'source'"
op|':'
string|"'source'"
op|','
nl|'\n'
string|"'xml'"
op|':'
string|"'xml'"
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|save_to_file
name|'def'
name|'save_to_file'
op|'('
name|'file'
op|','
name|'text'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'f'
op|'='
name|'open'
op|'('
name|'file'
op|','
string|"'w'"
op|')'
newline|'\n'
name|'f'
op|'.'
name|'write'
op|'('
name|'text'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|run
dedent|''
name|'def'
name|'run'
op|'('
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'try'
op|':'
newline|'\n'
indent|'        '
name|'config'
op|'='
name|'MyOptions'
op|'('
op|')'
newline|'\n'
name|'config'
op|'.'
name|'parseOptions'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'usage'
op|'.'
name|'error'
op|','
name|'ue'
op|':'
newline|'\n'
indent|'        '
name|'sys'
op|'.'
name|'exit'
op|'('
string|'"%s: %s"'
op|'%'
op|'('
name|'sys'
op|'.'
name|'argv'
op|'['
number|'0'
op|']'
op|','
name|'ue'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'tap_file'
op|'='
name|'config'
op|'['
string|"'tapfile'"
op|']'
newline|'\n'
name|'base_tap_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'config'
op|'['
string|"'tapfile'"
op|']'
op|')'
newline|'\n'
name|'protocol'
op|'='
op|'('
name|'config'
op|'['
string|"'protocol'"
op|']'
name|'or'
name|'os'
op|'.'
name|'path'
op|'.'
name|'splitext'
op|'('
name|'base_tap_file'
op|')'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'deb_file'
op|'='
name|'config'
op|'['
string|"'debfile'"
op|']'
name|'or'
string|"'twisted-'"
op|'+'
name|'protocol'
newline|'\n'
name|'version'
op|'='
name|'config'
op|'['
string|"'set-version'"
op|']'
newline|'\n'
name|'maintainer'
op|'='
name|'config'
op|'['
string|"'maintainer'"
op|']'
newline|'\n'
name|'description'
op|'='
name|'config'
op|'['
string|"'description'"
op|']'
name|'or'
op|'('
string|"'A Twisted-based server for %(protocol)s'"
op|'%'
nl|'\n'
name|'vars'
op|'('
op|')'
op|')'
newline|'\n'
name|'long_description'
op|'='
name|'config'
op|'['
string|"'long_description'"
op|']'
name|'or'
string|"'Automatically created by tap2deb'"
newline|'\n'
name|'twistd_option'
op|'='
name|'type_dict'
op|'['
name|'config'
op|'['
string|"'type'"
op|']'
op|']'
newline|'\n'
name|'date'
op|'='
name|'string'
op|'.'
name|'strip'
op|'('
name|'os'
op|'.'
name|'popen'
op|'('
string|"'822-date'"
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'directory'
op|'='
name|'deb_file'
op|'+'
string|"'-'"
op|'+'
name|'version'
newline|'\n'
name|'python_version'
op|'='
string|"'%s.%s'"
op|'%'
name|'sys'
op|'.'
name|'version_info'
op|'['
op|':'
number|'2'
op|']'
newline|'\n'
nl|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|')'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'os'
op|'.'
name|'system'
op|'('
string|"'rm -rf %s'"
op|'%'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|')'
op|')'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'shutil'
op|'.'
name|'copy'
op|'('
name|'tap_file'
op|','
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'save_to_file'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|','
string|"'README.Debian'"
op|')'
op|','
nl|'\n'
string|"'''This package was auto-generated by tap2deb\\n'''"
op|')'
newline|'\n'
nl|'\n'
name|'save_to_file'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|','
string|"'conffiles'"
op|')'
op|','
nl|'\n'
string|"'''\\\n/etc/init.d/%(deb_file)s\n/etc/default/%(deb_file)s\n/etc/%(base_tap_file)s\n'''"
op|'%'
name|'vars'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'save_to_file'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|','
string|"'default'"
op|')'
op|','
nl|'\n'
string|"'''\\\npidfile=/var/run/%(deb_file)s.pid\nrundir=/var/lib/%(deb_file)s/\nfile=/etc/%(tap_file)s\nlogfile=/var/log/%(deb_file)s.log\n '''"
op|'%'
name|'vars'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'save_to_file'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|','
string|"'init.d'"
op|')'
op|','
nl|'\n'
string|'\'\'\'\\\n#!/bin/sh\n\nPATH=/sbin:/bin:/usr/sbin:/usr/bin\n\npidfile=/var/run/%(deb_file)s.pid \\\nrundir=/var/lib/%(deb_file)s/ \\\nfile=/etc/%(tap_file)s \\\nlogfile=/var/log/%(deb_file)s.log\n\n[ -r /etc/default/%(deb_file)s ] && . /etc/default/%(deb_file)s\n\ntest -x /usr/bin/twistd%(python_version)s || exit 0\ntest -r $file || exit 0\ntest -r /usr/share/%(deb_file)s/package-installed || exit 0\n\n\ncase "$1" in\n    start)\n        echo -n "Starting %(deb_file)s: twistd"\n        start-stop-daemon --start --quiet --exec /usr/bin/twistd%(python_version)s -- \\\n                          --pidfile=$pidfile \\\n                          --rundir=$rundir \\\n                          --%(twistd_option)s=$file \\\n                          --logfile=$logfile\n        echo "."\t\n    ;;\n\n    stop)\n        echo -n "Stopping %(deb_file)s: twistd"\n        start-stop-daemon --stop --quiet  \\\n            --pidfile $pidfile\n        echo "."\t\n    ;;\n\n    restart)\n        $0 stop\n        $0 start\n    ;;\n\n    force-reload)\n        $0 restart\n    ;;\n\n    *)\n        echo "Usage: /etc/init.d/%(deb_file)s {start|stop|restart|force-reload}" >&2\n        exit 1\n    ;;\nesac\n\nexit 0\n\'\'\''
op|'%'
name|'vars'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'os'
op|'.'
name|'chmod'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|','
string|"'init.d'"
op|')'
op|','
number|'0755'
op|')'
newline|'\n'
nl|'\n'
name|'save_to_file'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|','
string|"'postinst'"
op|')'
op|','
nl|'\n'
string|"'''\\\n#!/bin/sh\nupdate-rc.d %(deb_file)s defaults >/dev/null\ninvoke-rc.d %(deb_file)s start\n'''"
op|'%'
name|'vars'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'save_to_file'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|','
string|"'prerm'"
op|')'
op|','
nl|'\n'
string|"'''\\\n#!/bin/sh\ninvoke-rc.d %(deb_file)s stop\n'''"
op|'%'
name|'vars'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'save_to_file'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|','
string|"'postrm'"
op|')'
op|','
nl|'\n'
string|'\'\'\'\\\n#!/bin/sh\nif [ "$1" = purge ]; then\n        update-rc.d %(deb_file)s remove >/dev/null\nfi\n\'\'\''
op|'%'
name|'vars'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'save_to_file'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|','
string|"'changelog'"
op|')'
op|','
nl|'\n'
string|"'''\\\n%(deb_file)s (%(version)s) unstable; urgency=low\n\n  * Created by tap2deb\n\n -- %(maintainer)s  %(date)s\n\n'''"
op|'%'
name|'vars'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'save_to_file'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|','
string|"'control'"
op|')'
op|','
nl|'\n'
string|"'''\\\nSource: %(deb_file)s\nSection: net\nPriority: extra\nMaintainer: %(maintainer)s\nBuild-Depends-Indep: debhelper\nStandards-Version: 3.5.6\n\nPackage: %(deb_file)s\nArchitecture: all\nDepends: python%(python_version)s-twisted\nDescription: %(description)s\n %(long_description)s\n'''"
op|'%'
name|'vars'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'save_to_file'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|','
string|"'copyright'"
op|')'
op|','
nl|'\n'
string|"'''\\\nThis package was auto-debianized by %(maintainer)s on\n%(date)s\n\nIt was auto-generated by tap2deb\n\nUpstream Author(s): \nMoshe Zadka <moshez@twistedmatrix.com> -- tap2deb author\n\nCopyright:\n\nInsert copyright here.\n'''"
op|'%'
name|'vars'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'save_to_file'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|','
string|"'dirs'"
op|')'
op|','
nl|'\n'
string|"'''\\\netc/init.d\netc/default\nvar/lib/%(deb_file)s\nusr/share/doc/%(deb_file)s\nusr/share/%(deb_file)s\n'''"
op|'%'
name|'vars'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'save_to_file'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|','
string|"'rules'"
op|')'
op|','
nl|'\n'
string|"'''\\\n#!/usr/bin/make -f\n\nexport DH_COMPAT=1\n\nbuild: build-stamp\nbuild-stamp:\n\tdh_testdir\n\ttouch build-stamp\n\nclean:\n\tdh_testdir\n\tdh_testroot\n\trm -f build-stamp install-stamp\n\tdh_clean\n\ninstall: install-stamp\ninstall-stamp: build-stamp\n\tdh_testdir\n\tdh_testroot\n\tdh_clean -k\n\tdh_installdirs\n\n\t# Add here commands to install the package into debian/tmp.\n\tcp %(base_tap_file)s debian/tmp/etc/\n\tcp debian/init.d debian/tmp/etc/init.d/%(deb_file)s\n\tcp debian/default debian/tmp/etc/default/%(deb_file)s\n\tcp debian/copyright debian/tmp/usr/share/doc/%(deb_file)s/\n\tcp debian/README.Debian debian/tmp/usr/share/doc/%(deb_file)s/\n\ttouch debian/tmp/usr/share/%(deb_file)s/package-installed\n\ttouch install-stamp\n\nbinary-arch: build install\n\nbinary-indep: build install\n\tdh_testdir\n\tdh_testroot\n\tdh_strip\n\tdh_compress\n\tdh_installchangelogs\n\tdh_fixperms\n\tdh_installdeb\n\tdh_shlibdeps\n\tdh_gencontrol\n\tdh_md5sums\n\tdh_builddeb\n\nsource diff:                                                                  \n\t@echo >&2 'source and diff are obsolete - use dpkg-source -b'; false\n\nbinary: binary-indep binary-arch\n.PHONY: build clean binary-indep binary-arch binary install\n'''"
op|'%'
name|'vars'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'os'
op|'.'
name|'chmod'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'.build'"
op|','
name|'directory'
op|','
string|"'debian'"
op|','
string|"'rules'"
op|')'
op|','
number|'0755'
op|')'
newline|'\n'
nl|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
string|"'.build/%(directory)s'"
op|'%'
name|'vars'
op|'('
op|')'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'system'
op|'('
string|"'dpkg-buildpackage -rfakeroot'"
op|'+'
op|'['
string|"''"
op|','
string|"' -uc -us'"
op|']'
op|'['
name|'config'
op|'['
string|"'unsigned'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'run'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
endmarker|''
end_unit
