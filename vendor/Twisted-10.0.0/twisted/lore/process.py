begin_unit
comment|'# -*- test-case-name: twisted.lore.test.test_lore -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2004 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
comment|'#'
nl|'\n'
name|'import'
name|'sys'
op|','
name|'os'
newline|'\n'
name|'import'
name|'tree'
comment|'#todo: get rid of this later'
newline|'\n'
name|'import'
name|'indexer'
newline|'\n'
nl|'\n'
DECL|class|NoProcessorError
name|'class'
name|'NoProcessorError'
op|'('
name|'Exception'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'pass'
newline|'\n'
nl|'\n'
DECL|class|ProcessingFailure
dedent|''
name|'class'
name|'ProcessingFailure'
op|'('
name|'Exception'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'pass'
newline|'\n'
nl|'\n'
DECL|variable|cols
dedent|''
name|'cols'
op|'='
number|'79'
newline|'\n'
nl|'\n'
DECL|function|dircount
name|'def'
name|'dircount'
op|'('
name|'d'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'len'
op|'('
op|'['
number|'1'
name|'for'
name|'el'
name|'in'
name|'d'
op|'.'
name|'split'
op|'('
string|'"/"'
op|')'
name|'if'
name|'el'
op|'!='
string|"'.'"
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|Walker
dedent|''
name|'class'
name|'Walker'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'df'
op|','
name|'fext'
op|','
name|'linkrel'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'df'
op|'='
name|'df'
newline|'\n'
name|'self'
op|'.'
name|'linkrel'
op|'='
name|'linkrel'
newline|'\n'
name|'self'
op|'.'
name|'fext'
op|'='
name|'fext'
newline|'\n'
name|'self'
op|'.'
name|'walked'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'failures'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|member|walkdir
dedent|''
name|'def'
name|'walkdir'
op|'('
name|'self'
op|','
name|'topdir'
op|','
name|'prefix'
op|'='
string|"''"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'basecount'
op|'='
name|'dircount'
op|'('
name|'topdir'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'walk'
op|'('
name|'topdir'
op|','
name|'self'
op|'.'
name|'walk'
op|','
name|'prefix'
op|')'
newline|'\n'
nl|'\n'
DECL|member|walk
dedent|''
name|'def'
name|'walk'
op|'('
name|'self'
op|','
name|'prefix'
op|','
name|'d'
op|','
name|'names'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'linkrel'
op|'='
name|'prefix'
op|'+'
string|"'../'"
op|'*'
op|'('
name|'dircount'
op|'('
name|'d'
op|')'
op|'-'
name|'self'
op|'.'
name|'basecount'
op|')'
newline|'\n'
name|'for'
name|'name'
name|'in'
name|'names'
op|':'
newline|'\n'
indent|'            '
name|'fullpath'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'d'
op|','
name|'name'
op|')'
newline|'\n'
name|'fext'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'splitext'
op|'('
name|'name'
op|')'
op|'['
number|'1'
op|']'
newline|'\n'
name|'if'
name|'fext'
op|'=='
name|'self'
op|'.'
name|'fext'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'walked'
op|'.'
name|'append'
op|'('
op|'('
name|'linkrel'
op|','
name|'fullpath'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|generate
dedent|''
dedent|''
dedent|''
name|'def'
name|'generate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'i'
op|'='
number|'0'
newline|'\n'
name|'indexer'
op|'.'
name|'clearEntries'
op|'('
op|')'
newline|'\n'
name|'tree'
op|'.'
name|'filenum'
op|'='
number|'0'
newline|'\n'
name|'for'
name|'linkrel'
op|','
name|'fullpath'
name|'in'
name|'self'
op|'.'
name|'walked'
op|':'
newline|'\n'
indent|'            '
name|'linkrel'
op|'='
name|'self'
op|'.'
name|'linkrel'
op|'+'
name|'linkrel'
newline|'\n'
name|'i'
op|'+='
number|'1'
newline|'\n'
name|'fname'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'splitext'
op|'('
name|'fullpath'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'percentdone'
op|'('
op|'('
name|'float'
op|'('
name|'i'
op|')'
op|'/'
name|'len'
op|'('
name|'self'
op|'.'
name|'walked'
op|')'
op|')'
op|','
name|'fname'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'df'
op|'('
name|'fullpath'
op|','
name|'linkrel'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ProcessingFailure'
op|','
name|'e'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'failures'
op|'.'
name|'append'
op|'('
op|'('
name|'fullpath'
op|','
name|'e'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'indexer'
op|'.'
name|'generateIndex'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'percentdone'
op|'('
number|'1.'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|percentdone
dedent|''
name|'def'
name|'percentdone'
op|'('
name|'self'
op|','
name|'percent'
op|','
name|'fname'
op|')'
op|':'
newline|'\n'
comment|'# override for neater progress bars'
nl|'\n'
indent|'        '
name|'proglen'
op|'='
number|'40'
newline|'\n'
name|'hashes'
op|'='
name|'int'
op|'('
name|'percent'
op|'*'
name|'proglen'
op|')'
newline|'\n'
name|'spaces'
op|'='
name|'proglen'
op|'-'
name|'hashes'
newline|'\n'
name|'progstat'
op|'='
string|'"[%s%s] (%s)"'
op|'%'
op|'('
string|"'#'"
op|'*'
name|'hashes'
op|','
string|"' '"
op|'*'
name|'spaces'
op|','
name|'fname'
name|'or'
string|'"*Done*"'
op|')'
newline|'\n'
name|'progstat'
op|'+='
op|'('
name|'cols'
op|'-'
name|'len'
op|'('
name|'progstat'
op|')'
op|')'
op|'*'
string|"' '"
newline|'\n'
name|'progstat'
op|'+='
string|"'\\r'"
newline|'\n'
name|'sys'
op|'.'
name|'stdout'
op|'.'
name|'write'
op|'('
name|'progstat'
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'stdout'
op|'.'
name|'flush'
op|'('
op|')'
newline|'\n'
name|'if'
name|'fname'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'print'
newline|'\n'
nl|'\n'
DECL|class|PlainReportingWalker
dedent|''
dedent|''
dedent|''
name|'class'
name|'PlainReportingWalker'
op|'('
name|'Walker'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|percentdone
indent|'    '
name|'def'
name|'percentdone'
op|'('
name|'self'
op|','
name|'percent'
op|','
name|'fname'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'fname'
op|':'
newline|'\n'
indent|'            '
name|'print'
name|'fname'
newline|'\n'
nl|'\n'
DECL|class|NullReportingWalker
dedent|''
dedent|''
dedent|''
name|'class'
name|'NullReportingWalker'
op|'('
name|'Walker'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|percentdone
indent|'    '
name|'def'
name|'percentdone'
op|'('
name|'self'
op|','
name|'percent'
op|','
name|'fname'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|function|parallelGenerator
dedent|''
dedent|''
name|'def'
name|'parallelGenerator'
op|'('
name|'originalFileName'
op|','
name|'outputExtension'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'os'
op|'.'
name|'path'
op|'.'
name|'splitext'
op|'('
name|'originalFileName'
op|')'
op|'['
number|'0'
op|']'
op|'+'
name|'outputExtension'
newline|'\n'
nl|'\n'
DECL|function|fooAddingGenerator
dedent|''
name|'def'
name|'fooAddingGenerator'
op|'('
name|'originalFileName'
op|','
name|'outputExtension'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'os'
op|'.'
name|'path'
op|'.'
name|'splitext'
op|'('
name|'originalFileName'
op|')'
op|'['
number|'0'
op|']'
op|'+'
string|'"foo"'
op|'+'
name|'outputExtension'
newline|'\n'
nl|'\n'
DECL|function|outputdirGenerator
dedent|''
name|'def'
name|'outputdirGenerator'
op|'('
name|'originalFileName'
op|','
name|'outputExtension'
op|','
name|'inputdir'
op|','
name|'outputdir'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'originalFileName'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'abspath'
op|'('
name|'originalFileName'
op|')'
newline|'\n'
name|'abs_inputdir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'abspath'
op|'('
name|'inputdir'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'commonprefix'
op|'('
op|'('
name|'originalFileName'
op|','
name|'abs_inputdir'
op|')'
op|')'
op|'!='
name|'abs_inputdir'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'ValueError'
op|'('
string|'"Original file name \'"'
op|'+'
name|'originalFileName'
op|'+'
nl|'\n'
string|'"\' not under input directory \'"'
op|'+'
name|'abs_inputdir'
op|'+'
string|'"\'"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'adjustedPath'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'outputdir'
op|','
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'originalFileName'
op|')'
op|')'
newline|'\n'
name|'return'
name|'tree'
op|'.'
name|'getOutputFileName'
op|'('
name|'adjustedPath'
op|','
name|'outputExtension'
op|')'
newline|'\n'
nl|'\n'
DECL|function|getFilenameGenerator
dedent|''
name|'def'
name|'getFilenameGenerator'
op|'('
name|'config'
op|','
name|'outputExt'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'config'
op|'.'
name|'get'
op|'('
string|"'outputdir'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
op|'('
name|'lambda'
name|'originalFileName'
op|','
name|'outputExtension'
op|':'
nl|'\n'
name|'outputdirGenerator'
op|'('
name|'originalFileName'
op|','
name|'outputExtension'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'abspath'
op|'('
name|'config'
op|'.'
name|'get'
op|'('
string|"'inputdir'"
op|')'
op|')'
op|','
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'abspath'
op|'('
name|'config'
op|'.'
name|'get'
op|'('
string|"'outputdir'"
op|')'
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'tree'
op|'.'
name|'getOutputFileName'
newline|'\n'
nl|'\n'
DECL|function|getProcessor
dedent|''
dedent|''
name|'def'
name|'getProcessor'
op|'('
name|'module'
op|','
name|'output'
op|','
name|'config'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'try'
op|':'
newline|'\n'
indent|'        '
name|'m'
op|'='
name|'getattr'
op|'('
name|'module'
op|'.'
name|'factory'
op|','
string|"'generate_'"
op|'+'
name|'output'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'AttributeError'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'NoProcessorError'
op|'('
string|'"cannot generate "'
op|'+'
name|'output'
op|'+'
string|'" output"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'config'
op|'.'
name|'get'
op|'('
string|"'ext'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ext'
op|'='
name|'config'
op|'['
string|"'ext'"
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'from'
name|'default'
name|'import'
name|'htmlDefault'
newline|'\n'
name|'ext'
op|'='
name|'htmlDefault'
op|'['
string|"'ext'"
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'m'
op|'('
name|'config'
op|','
name|'getFilenameGenerator'
op|'('
name|'config'
op|','
name|'ext'
op|')'
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
