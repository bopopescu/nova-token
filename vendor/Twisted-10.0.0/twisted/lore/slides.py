begin_unit
comment|'# -*- test-case-name: twisted.lore.test.test_slides -*-'
nl|'\n'
comment|'# Copyright (c) 2001-2009 Twisted Matrix Laboratories.'
nl|'\n'
comment|'# See LICENSE for details.'
nl|'\n'
nl|'\n'
string|'"""\nRudimentary slide support for Lore.\n\nTODO:\n    - Complete mgp output target\n        - syntax highlighting\n        - saner font handling\n        - probably lots more\n    - Add HTML output targets\n        - one slides per page (with navigation links)\n        - all in one page\n\nExample input file::\n    <html>\n\n    <head><title>Title of talk</title></head>\n\n    <body>\n    <h1>Title of talk</h1>\n\n    <h2>First Slide</h2>\n\n    <ul>\n      <li>Bullet point</li>\n      <li>Look ma, I\'m <strong>bold</strong>!</li>\n      <li>... etc ...</li>\n    </ul>\n\n\n    <h2>Second Slide</h2>\n\n    <pre class="python">\n    # Sample code sample.\n    print "Hello, World!"\n    </pre>\n\n    </body>\n\n    </html>\n"""'
newline|'\n'
nl|'\n'
name|'from'
name|'xml'
op|'.'
name|'dom'
name|'import'
name|'minidom'
name|'as'
name|'dom'
newline|'\n'
name|'import'
name|'os'
op|'.'
name|'path'
op|','
name|'re'
newline|'\n'
name|'from'
name|'cStringIO'
name|'import'
name|'StringIO'
newline|'\n'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'lore'
name|'import'
name|'default'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'web'
name|'import'
name|'domhelpers'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'python'
name|'import'
name|'text'
newline|'\n'
comment|'# These should be factored out'
nl|'\n'
name|'from'
name|'twisted'
op|'.'
name|'lore'
op|'.'
name|'latex'
name|'import'
name|'BaseLatexSpitter'
op|','
name|'LatexSpitter'
op|','
name|'processFile'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'lore'
op|'.'
name|'latex'
name|'import'
name|'getLatexText'
op|','
name|'HeadingLatexSpitter'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'lore'
op|'.'
name|'tree'
name|'import'
name|'getHeaders'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'lore'
op|'.'
name|'tree'
name|'import'
name|'removeH1'
op|','
name|'fixAPI'
op|','
name|'fontifyPython'
newline|'\n'
name|'from'
name|'twisted'
op|'.'
name|'lore'
op|'.'
name|'tree'
name|'import'
name|'addPyListings'
op|','
name|'addHTMLListings'
op|','
name|'setTitle'
newline|'\n'
nl|'\n'
DECL|variable|hacked_entities
name|'hacked_entities'
op|'='
op|'{'
string|"'amp'"
op|':'
string|"' &'"
op|','
string|"'gt'"
op|':'
string|"' >'"
op|','
string|"'lt'"
op|':'
string|"' <'"
op|','
string|"'quot'"
op|':'
string|'\' "\''
op|','
nl|'\n'
string|"'copy'"
op|':'
string|"' (c)'"
op|'}'
newline|'\n'
nl|'\n'
DECL|variable|entities
name|'entities'
op|'='
op|'{'
string|"'amp'"
op|':'
string|"'&'"
op|','
string|"'gt'"
op|':'
string|"'>'"
op|','
string|"'lt'"
op|':'
string|"'<'"
op|','
string|"'quot'"
op|':'
string|'\'"\''
op|','
nl|'\n'
string|"'copy'"
op|':'
string|"'(c)'"
op|'}'
newline|'\n'
nl|'\n'
DECL|class|MagicpointOutput
name|'class'
name|'MagicpointOutput'
op|'('
name|'BaseLatexSpitter'
op|')'
op|':'
newline|'\n'
DECL|variable|bulletDepth
indent|'    '
name|'bulletDepth'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|member|writeNodeData
name|'def'
name|'writeNodeData'
op|'('
name|'self'
op|','
name|'node'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'buf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'getLatexText'
op|'('
name|'node'
op|','
name|'buf'
op|'.'
name|'write'
op|','
name|'entities'
op|'='
name|'hacked_entities'
op|')'
newline|'\n'
name|'data'
op|'='
name|'buf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|'.'
name|'rstrip'
op|'('
op|')'
op|'.'
name|'replace'
op|'('
string|"'\\n'"
op|','
string|"' '"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
name|'re'
op|'.'
name|'sub'
op|'('
string|"' +'"
op|','
string|"' '"
op|','
name|'data'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|visitNode_title
dedent|''
name|'def'
name|'visitNode_title'
op|'('
name|'self'
op|','
name|'node'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'title'
op|'='
name|'domhelpers'
op|'.'
name|'getNodeText'
op|'('
name|'node'
op|')'
newline|'\n'
nl|'\n'
DECL|member|visitNode_body
dedent|''
name|'def'
name|'visitNode_body'
op|'('
name|'self'
op|','
name|'node'
op|')'
op|':'
newline|'\n'
comment|'# Adapted from tree.generateToC'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'fontStack'
op|'='
op|'['
op|'('
string|"'standard'"
op|','
name|'None'
op|')'
op|']'
newline|'\n'
nl|'\n'
comment|'# Title slide'
nl|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
name|'self'
op|'.'
name|'start_h2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
name|'self'
op|'.'
name|'title'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
name|'self'
op|'.'
name|'end_h2'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
string|"'%center\\n\\n\\n\\n\\n'"
op|')'
newline|'\n'
name|'for'
name|'authorNode'
name|'in'
name|'domhelpers'
op|'.'
name|'findElementsWithAttribute'
op|'('
name|'node'
op|','
string|"'class'"
op|','
string|"'author'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'getLatexText'
op|'('
name|'authorNode'
op|','
name|'self'
op|'.'
name|'writer'
op|','
name|'entities'
op|'='
name|'entities'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
string|"'\\n'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Table of contents'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'writer'
op|'('
name|'self'
op|'.'
name|'start_h2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
name|'self'
op|'.'
name|'title'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
name|'self'
op|'.'
name|'end_h2'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'element'
name|'in'
name|'getHeaders'
op|'('
name|'node'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'level'
op|'='
name|'int'
op|'('
name|'element'
op|'.'
name|'tagName'
op|'['
number|'1'
op|']'
op|')'
op|'-'
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
name|'level'
op|'*'
string|"'\\t'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
name|'domhelpers'
op|'.'
name|'getNodeText'
op|'('
name|'element'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
string|"'\\n'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'visitNodeDefault'
op|'('
name|'node'
op|')'
newline|'\n'
nl|'\n'
DECL|member|visitNode_div_author
dedent|''
name|'def'
name|'visitNode_div_author'
op|'('
name|'self'
op|','
name|'node'
op|')'
op|':'
newline|'\n'
comment|"# Skip this node; it's already been used by visitNode_body"
nl|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|visitNode_div_pause
dedent|''
name|'def'
name|'visitNode_div_pause'
op|'('
name|'self'
op|','
name|'node'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'writer'
op|'('
string|"'%pause\\n'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|visitNode_pre
dedent|''
name|'def'
name|'visitNode_pre'
op|'('
name|'self'
op|','
name|'node'
op|')'
op|':'
newline|'\n'
comment|'# TODO: Syntax highlighting'
nl|'\n'
indent|'        '
name|'buf'
op|'='
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'getLatexText'
op|'('
name|'node'
op|','
name|'buf'
op|'.'
name|'write'
op|','
name|'entities'
op|'='
name|'entities'
op|')'
newline|'\n'
name|'data'
op|'='
name|'buf'
op|'.'
name|'getvalue'
op|'('
op|')'
newline|'\n'
name|'data'
op|'='
name|'text'
op|'.'
name|'removeLeadingTrailingBlanks'
op|'('
name|'data'
op|')'
newline|'\n'
name|'lines'
op|'='
name|'data'
op|'.'
name|'split'
op|'('
string|"'\\n'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'fontStack'
op|'.'
name|'append'
op|'('
op|'('
string|"'typewriter'"
op|','
number|'4'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
string|"'%'"
op|'+'
name|'self'
op|'.'
name|'fontName'
op|'('
op|')'
op|'+'
string|"'\\n'"
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'lines'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'writer'
op|'('
string|"' '"
op|'+'
name|'line'
op|'+'
string|"'\\n'"
op|')'
newline|'\n'
dedent|''
name|'del'
name|'self'
op|'.'
name|'fontStack'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
string|"'%'"
op|'+'
name|'self'
op|'.'
name|'fontName'
op|'('
op|')'
op|'+'
string|"'\\n'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|visitNode_ul
dedent|''
name|'def'
name|'visitNode_ul'
op|'('
name|'self'
op|','
name|'node'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'bulletDepth'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'writer'
op|'('
name|'self'
op|'.'
name|'_start_ul'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'bulletDepth'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'start_li'
op|'='
name|'self'
op|'.'
name|'_start_li'
op|'*'
name|'self'
op|'.'
name|'bulletDepth'
newline|'\n'
name|'self'
op|'.'
name|'visitNodeDefault'
op|'('
name|'node'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'bulletDepth'
op|'-='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'start_li'
op|'='
name|'self'
op|'.'
name|'_start_li'
op|'*'
name|'self'
op|'.'
name|'bulletDepth'
newline|'\n'
nl|'\n'
DECL|member|visitNode_strong
dedent|''
name|'def'
name|'visitNode_strong'
op|'('
name|'self'
op|','
name|'node'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'doFont'
op|'('
name|'node'
op|','
string|"'bold'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|visitNode_em
dedent|''
name|'def'
name|'visitNode_em'
op|'('
name|'self'
op|','
name|'node'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'doFont'
op|'('
name|'node'
op|','
string|"'italic'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|visitNode_code
dedent|''
name|'def'
name|'visitNode_code'
op|'('
name|'self'
op|','
name|'node'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'doFont'
op|'('
name|'node'
op|','
string|"'typewriter'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|doFont
dedent|''
name|'def'
name|'doFont'
op|'('
name|'self'
op|','
name|'node'
op|','
name|'style'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'fontStack'
op|'.'
name|'append'
op|'('
op|'('
name|'style'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
string|"' \\n%cont, '"
op|'+'
name|'self'
op|'.'
name|'fontName'
op|'('
op|')'
op|'+'
string|"'\\n'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'visitNodeDefault'
op|'('
name|'node'
op|')'
newline|'\n'
name|'del'
name|'self'
op|'.'
name|'fontStack'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
string|"'\\n%cont, '"
op|'+'
name|'self'
op|'.'
name|'fontName'
op|'('
op|')'
op|'+'
string|"'\\n'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|fontName
dedent|''
name|'def'
name|'fontName'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'names'
op|'='
op|'['
name|'x'
op|'['
number|'0'
op|']'
name|'for'
name|'x'
name|'in'
name|'self'
op|'.'
name|'fontStack'
op|']'
newline|'\n'
name|'if'
string|"'typewriter'"
name|'in'
name|'names'
op|':'
newline|'\n'
indent|'            '
name|'name'
op|'='
string|"'typewriter'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'name'
op|'='
string|"''"
newline|'\n'
nl|'\n'
dedent|''
name|'if'
string|"'bold'"
name|'in'
name|'names'
op|':'
newline|'\n'
indent|'            '
name|'name'
op|'+='
string|"'bold'"
newline|'\n'
dedent|''
name|'if'
string|"'italic'"
name|'in'
name|'names'
op|':'
newline|'\n'
indent|'            '
name|'name'
op|'+='
string|"'italic'"
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'name'
op|'=='
string|"''"
op|':'
newline|'\n'
indent|'            '
name|'name'
op|'='
string|"'standard'"
newline|'\n'
nl|'\n'
dedent|''
name|'sizes'
op|'='
op|'['
name|'x'
op|'['
number|'1'
op|']'
name|'for'
name|'x'
name|'in'
name|'self'
op|'.'
name|'fontStack'
op|']'
newline|'\n'
name|'sizes'
op|'.'
name|'reverse'
op|'('
op|')'
newline|'\n'
name|'for'
name|'size'
name|'in'
name|'sizes'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'size'
op|':'
newline|'\n'
indent|'                '
name|'return'
string|'\'font "%s", size %d\''
op|'%'
op|'('
name|'name'
op|','
name|'size'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'return'
string|'\'font "%s"\''
op|'%'
name|'name'
newline|'\n'
nl|'\n'
DECL|variable|start_h2
dedent|''
name|'start_h2'
op|'='
string|'"%page\\n\\n"'
newline|'\n'
DECL|variable|end_h2
name|'end_h2'
op|'='
string|"'\\n\\n\\n'"
newline|'\n'
nl|'\n'
DECL|variable|_start_ul
name|'_start_ul'
op|'='
string|"'\\n'"
newline|'\n'
nl|'\n'
DECL|variable|_start_li
name|'_start_li'
op|'='
string|'"\\t"'
newline|'\n'
DECL|variable|end_li
name|'end_li'
op|'='
string|'"\\n"'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|convertFile
dedent|''
name|'def'
name|'convertFile'
op|'('
name|'filename'
op|','
name|'outputter'
op|','
name|'template'
op|','
name|'ext'
op|'='
string|'".mgp"'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'fout'
op|'='
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'splitext'
op|'('
name|'filename'
op|')'
op|'['
number|'0'
op|']'
op|'+'
name|'ext'
op|','
string|"'w'"
op|')'
newline|'\n'
name|'fout'
op|'.'
name|'write'
op|'('
name|'open'
op|'('
name|'template'
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'spitter'
op|'='
name|'outputter'
op|'('
name|'fout'
op|'.'
name|'write'
op|','
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'filename'
op|')'
op|','
name|'filename'
op|')'
newline|'\n'
name|'fin'
op|'='
name|'open'
op|'('
name|'filename'
op|')'
newline|'\n'
name|'processFile'
op|'('
name|'spitter'
op|','
name|'fin'
op|')'
newline|'\n'
name|'fin'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'fout'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
comment|'# HTML DOM tree stuff'
nl|'\n'
nl|'\n'
DECL|function|splitIntoSlides
dedent|''
name|'def'
name|'splitIntoSlides'
op|'('
name|'document'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'body'
op|'='
name|'domhelpers'
op|'.'
name|'findNodesNamed'
op|'('
name|'document'
op|','
string|"'body'"
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'slides'
op|'='
op|'['
op|']'
newline|'\n'
name|'slide'
op|'='
op|'['
op|']'
newline|'\n'
name|'title'
op|'='
string|"'(unset)'"
newline|'\n'
name|'for'
name|'child'
name|'in'
name|'body'
op|'.'
name|'childNodes'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'isinstance'
op|'('
name|'child'
op|','
name|'dom'
op|'.'
name|'Element'
op|')'
name|'and'
name|'child'
op|'.'
name|'tagName'
op|'=='
string|"'h2'"
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'slide'
op|':'
newline|'\n'
indent|'                '
name|'slides'
op|'.'
name|'append'
op|'('
op|'('
name|'title'
op|','
name|'slide'
op|')'
op|')'
newline|'\n'
name|'slide'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'title'
op|'='
name|'domhelpers'
op|'.'
name|'getNodeText'
op|'('
name|'child'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'slide'
op|'.'
name|'append'
op|'('
name|'child'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'slides'
op|'.'
name|'append'
op|'('
op|'('
name|'title'
op|','
name|'slide'
op|')'
op|')'
newline|'\n'
name|'return'
name|'slides'
newline|'\n'
nl|'\n'
DECL|function|insertPrevNextLinks
dedent|''
name|'def'
name|'insertPrevNextLinks'
op|'('
name|'slides'
op|','
name|'filename'
op|','
name|'ext'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'for'
name|'slide'
name|'in'
name|'slides'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'name'
op|','
name|'offset'
name|'in'
op|'('
op|'('
string|'"previous"'
op|','
op|'-'
number|'1'
op|')'
op|','
op|'('
string|'"next"'
op|','
op|'+'
number|'1'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
op|'('
name|'slide'
op|'.'
name|'pos'
op|'>'
number|'0'
name|'and'
name|'name'
op|'=='
string|'"previous"'
op|')'
name|'or'
op|'('
name|'slide'
op|'.'
name|'pos'
op|'<'
name|'len'
op|'('
name|'slides'
op|')'
op|'-'
number|'1'
name|'and'
name|'name'
op|'=='
string|'"next"'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'for'
name|'node'
name|'in'
name|'domhelpers'
op|'.'
name|'findElementsWithAttribute'
op|'('
name|'slide'
op|'.'
name|'dom'
op|','
string|'"class"'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'node'
op|'.'
name|'tagName'
op|'=='
string|"'a'"
op|':'
newline|'\n'
indent|'                        '
name|'node'
op|'.'
name|'setAttribute'
op|'('
string|"'href'"
op|','
string|"'%s-%d%s'"
nl|'\n'
op|'%'
op|'('
name|'filename'
op|'['
number|'0'
op|']'
op|','
name|'slide'
op|'.'
name|'pos'
op|'+'
name|'offset'
op|','
name|'ext'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'text'
op|'='
name|'dom'
op|'.'
name|'Text'
op|'('
op|')'
newline|'\n'
name|'text'
op|'.'
name|'data'
op|'='
name|'slides'
op|'['
name|'slide'
op|'.'
name|'pos'
op|'+'
name|'offset'
op|']'
op|'.'
name|'title'
newline|'\n'
name|'node'
op|'.'
name|'appendChild'
op|'('
name|'text'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'for'
name|'node'
name|'in'
name|'domhelpers'
op|'.'
name|'findElementsWithAttribute'
op|'('
name|'slide'
op|'.'
name|'dom'
op|','
string|'"class"'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'pos'
op|'='
number|'0'
newline|'\n'
name|'for'
name|'child'
name|'in'
name|'node'
op|'.'
name|'parentNode'
op|'.'
name|'childNodes'
op|':'
newline|'\n'
indent|'                        '
name|'if'
name|'child'
name|'is'
name|'node'
op|':'
newline|'\n'
indent|'                            '
name|'del'
name|'node'
op|'.'
name|'parentNode'
op|'.'
name|'childNodes'
op|'['
name|'pos'
op|']'
newline|'\n'
name|'break'
newline|'\n'
dedent|''
name|'pos'
op|'+='
number|'1'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|HTMLSlide
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
name|'class'
name|'HTMLSlide'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'dom'
op|','
name|'title'
op|','
name|'pos'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'dom'
op|'='
name|'dom'
newline|'\n'
name|'self'
op|'.'
name|'title'
op|'='
name|'title'
newline|'\n'
name|'self'
op|'.'
name|'pos'
op|'='
name|'pos'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|munge
dedent|''
dedent|''
name|'def'
name|'munge'
op|'('
name|'document'
op|','
name|'template'
op|','
name|'linkrel'
op|','
name|'d'
op|','
name|'fullpath'
op|','
name|'ext'
op|','
name|'url'
op|','
name|'config'
op|')'
op|':'
newline|'\n'
comment|'# FIXME: This has *way* to much duplicated crap in common with tree.munge'
nl|'\n'
comment|'#fixRelativeLinks(template, linkrel)'
nl|'\n'
indent|'    '
name|'removeH1'
op|'('
name|'document'
op|')'
newline|'\n'
name|'fixAPI'
op|'('
name|'document'
op|','
name|'url'
op|')'
newline|'\n'
name|'fontifyPython'
op|'('
name|'document'
op|')'
newline|'\n'
name|'addPyListings'
op|'('
name|'document'
op|','
name|'d'
op|')'
newline|'\n'
name|'addHTMLListings'
op|'('
name|'document'
op|','
name|'d'
op|')'
newline|'\n'
comment|'#fixLinks(document, ext)'
nl|'\n'
comment|'#putInToC(template, generateToC(document))'
nl|'\n'
name|'template'
op|'='
name|'template'
op|'.'
name|'cloneNode'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|'# Insert the slides into the template'
nl|'\n'
name|'slides'
op|'='
op|'['
op|']'
newline|'\n'
name|'pos'
op|'='
number|'0'
newline|'\n'
name|'for'
name|'title'
op|','
name|'slide'
name|'in'
name|'splitIntoSlides'
op|'('
name|'document'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'t'
op|'='
name|'template'
op|'.'
name|'cloneNode'
op|'('
number|'1'
op|')'
newline|'\n'
name|'text'
op|'='
name|'dom'
op|'.'
name|'Text'
op|'('
op|')'
newline|'\n'
name|'text'
op|'.'
name|'data'
op|'='
name|'title'
newline|'\n'
name|'setTitle'
op|'('
name|'t'
op|','
op|'['
name|'text'
op|']'
op|')'
newline|'\n'
name|'tmplbody'
op|'='
name|'domhelpers'
op|'.'
name|'findElementsWithAttribute'
op|'('
name|'t'
op|','
string|'"class"'
op|','
string|'"body"'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'tmplbody'
op|'.'
name|'childNodes'
op|'='
name|'slide'
newline|'\n'
name|'tmplbody'
op|'.'
name|'setAttribute'
op|'('
string|'"class"'
op|','
string|'"content"'
op|')'
newline|'\n'
comment|'# FIXME: Next/Prev links'
nl|'\n'
comment|'# FIXME: Perhaps there should be a "Template" class?  (setTitle/setBody'
nl|'\n'
comment|'#        could be methods...)'
nl|'\n'
name|'slides'
op|'.'
name|'append'
op|'('
name|'HTMLSlide'
op|'('
name|'t'
op|','
name|'title'
op|','
name|'pos'
op|')'
op|')'
newline|'\n'
name|'pos'
op|'+='
number|'1'
newline|'\n'
nl|'\n'
dedent|''
name|'insertPrevNextLinks'
op|'('
name|'slides'
op|','
name|'os'
op|'.'
name|'path'
op|'.'
name|'splitext'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'fullpath'
op|')'
op|')'
op|','
name|'ext'
op|')'
newline|'\n'
nl|'\n'
name|'return'
name|'slides'
newline|'\n'
nl|'\n'
dedent|''
name|'from'
name|'tree'
name|'import'
name|'makeSureDirectoryExists'
newline|'\n'
nl|'\n'
DECL|function|getOutputFileName
name|'def'
name|'getOutputFileName'
op|'('
name|'originalFileName'
op|','
name|'outputExtension'
op|','
name|'index'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'os'
op|'.'
name|'path'
op|'.'
name|'splitext'
op|'('
name|'originalFileName'
op|')'
op|'['
number|'0'
op|']'
op|'+'
string|"'-'"
op|'+'
name|'str'
op|'('
name|'index'
op|')'
op|'+'
name|'outputExtension'
newline|'\n'
nl|'\n'
DECL|function|doFile
dedent|''
name|'def'
name|'doFile'
op|'('
name|'filename'
op|','
name|'linkrel'
op|','
name|'ext'
op|','
name|'url'
op|','
name|'templ'
op|','
name|'options'
op|'='
op|'{'
op|'}'
op|','
name|'outfileGenerator'
op|'='
name|'getOutputFileName'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'from'
name|'tree'
name|'import'
name|'parseFileAndReport'
newline|'\n'
name|'doc'
op|'='
name|'parseFileAndReport'
op|'('
name|'filename'
op|')'
newline|'\n'
name|'slides'
op|'='
name|'munge'
op|'('
name|'doc'
op|','
name|'templ'
op|','
name|'linkrel'
op|','
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'filename'
op|')'
op|','
name|'filename'
op|','
name|'ext'
op|','
name|'url'
op|','
name|'options'
op|')'
newline|'\n'
name|'for'
name|'slide'
op|','
name|'index'
name|'in'
name|'zip'
op|'('
name|'slides'
op|','
name|'range'
op|'('
name|'len'
op|'('
name|'slides'
op|')'
op|')'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'newFilename'
op|'='
name|'outfileGenerator'
op|'('
name|'filename'
op|','
name|'ext'
op|','
name|'index'
op|')'
newline|'\n'
name|'makeSureDirectoryExists'
op|'('
name|'newFilename'
op|')'
newline|'\n'
name|'f'
op|'='
name|'open'
op|'('
name|'newFilename'
op|','
string|"'wb'"
op|')'
newline|'\n'
name|'slide'
op|'.'
name|'dom'
op|'.'
name|'writexml'
op|'('
name|'f'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# Prosper output'
nl|'\n'
nl|'\n'
DECL|class|ProsperSlides
dedent|''
dedent|''
name|'class'
name|'ProsperSlides'
op|'('
name|'LatexSpitter'
op|')'
op|':'
newline|'\n'
DECL|variable|firstSlide
indent|'    '
name|'firstSlide'
op|'='
number|'1'
newline|'\n'
DECL|variable|start_html
name|'start_html'
op|'='
string|"'\\\\documentclass[ps]{prosper}\\n'"
newline|'\n'
DECL|variable|start_body
name|'start_body'
op|'='
string|"'\\\\begin{document}\\n'"
newline|'\n'
DECL|variable|start_div_author
name|'start_div_author'
op|'='
string|"'\\\\author{'"
newline|'\n'
DECL|variable|end_div_author
name|'end_div_author'
op|'='
string|"'}'"
newline|'\n'
nl|'\n'
DECL|member|visitNode_h2
name|'def'
name|'visitNode_h2'
op|'('
name|'self'
op|','
name|'node'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'firstSlide'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'firstSlide'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'end_body'
op|'='
string|"'\\\\end{slide}\\n\\n'"
op|'+'
name|'self'
op|'.'
name|'end_body'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'writer'
op|'('
string|"'\\\\end{slide}\\n\\n'"
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'writer'
op|'('
string|"'\\\\begin{slide}{'"
op|')'
newline|'\n'
name|'spitter'
op|'='
name|'HeadingLatexSpitter'
op|'('
name|'self'
op|'.'
name|'writer'
op|','
name|'self'
op|'.'
name|'currDir'
op|','
name|'self'
op|'.'
name|'filename'
op|')'
newline|'\n'
name|'spitter'
op|'.'
name|'visitNodeDefault'
op|'('
name|'node'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
string|"'}'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_write_img
dedent|''
name|'def'
name|'_write_img'
op|'('
name|'self'
op|','
name|'target'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'writer'
op|'('
string|"'\\\\begin{center}\\\\includegraphics[%%\\nwidth=1.0\\n\\\\textwidth,'"
nl|'\n'
string|"'height=1.0\\\\textheight,\\nkeepaspectratio]{%s}\\\\end{center}\\n'"
op|'%'
name|'target'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|PagebreakLatex
dedent|''
dedent|''
name|'class'
name|'PagebreakLatex'
op|'('
name|'LatexSpitter'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|everyN
indent|'    '
name|'everyN'
op|'='
number|'1'
newline|'\n'
DECL|variable|currentN
name|'currentN'
op|'='
number|'0'
newline|'\n'
DECL|variable|seenH2
name|'seenH2'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|variable|start_html
name|'start_html'
op|'='
name|'LatexSpitter'
op|'.'
name|'start_html'
op|'+'
string|'"\\\\date{}\\n"'
newline|'\n'
DECL|variable|start_body
name|'start_body'
op|'='
string|"'\\\\begin{document}\\n\\n'"
newline|'\n'
nl|'\n'
DECL|member|visitNode_h2
name|'def'
name|'visitNode_h2'
op|'('
name|'self'
op|','
name|'node'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'seenH2'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'currentN'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'seenH2'
op|'='
number|'1'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'currentN'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'currentN'
op|'%='
name|'self'
op|'.'
name|'everyN'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'currentN'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'writer'
op|'('
string|"'\\\\clearpage\\n'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'level'
op|'='
op|'('
name|'int'
op|'('
name|'node'
op|'.'
name|'tagName'
op|'['
number|'1'
op|']'
op|')'
op|'-'
number|'2'
op|')'
op|'+'
name|'self'
op|'.'
name|'baseLevel'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
string|"'\\n\\n\\\\'"
op|'+'
name|'level'
op|'*'
string|"'sub'"
op|'+'
string|"'section*{'"
op|')'
newline|'\n'
name|'spitter'
op|'='
name|'HeadingLatexSpitter'
op|'('
name|'self'
op|'.'
name|'writer'
op|','
name|'self'
op|'.'
name|'currDir'
op|','
name|'self'
op|'.'
name|'filename'
op|')'
newline|'\n'
name|'spitter'
op|'.'
name|'visitNodeDefault'
op|'('
name|'node'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'writer'
op|'('
string|"'}\\n'"
op|')'
newline|'\n'
nl|'\n'
DECL|class|TwoPagebreakLatex
dedent|''
dedent|''
name|'class'
name|'TwoPagebreakLatex'
op|'('
name|'PagebreakLatex'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|everyN
indent|'    '
name|'everyN'
op|'='
number|'2'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SlidesProcessingFunctionFactory
dedent|''
name|'class'
name|'SlidesProcessingFunctionFactory'
op|'('
name|'default'
op|'.'
name|'ProcessingFunctionFactory'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|latexSpitters
indent|'    '
name|'latexSpitters'
op|'='
name|'default'
op|'.'
name|'ProcessingFunctionFactory'
op|'.'
name|'latexSpitters'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'latexSpitters'
op|'['
string|"'prosper'"
op|']'
op|'='
name|'ProsperSlides'
newline|'\n'
name|'latexSpitters'
op|'['
string|"'page'"
op|']'
op|'='
name|'PagebreakLatex'
newline|'\n'
name|'latexSpitters'
op|'['
string|"'twopage'"
op|']'
op|'='
name|'TwoPagebreakLatex'
newline|'\n'
nl|'\n'
DECL|member|getDoFile
name|'def'
name|'getDoFile'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'doFile'
newline|'\n'
nl|'\n'
DECL|member|generate_mgp
dedent|''
name|'def'
name|'generate_mgp'
op|'('
name|'self'
op|','
name|'d'
op|','
name|'fileNameGenerator'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'template'
op|'='
name|'d'
op|'.'
name|'get'
op|'('
string|"'template'"
op|','
string|"'template.mgp'"
op|')'
newline|'\n'
name|'df'
op|'='
name|'lambda'
name|'file'
op|','
name|'linkrel'
op|':'
name|'convertFile'
op|'('
name|'file'
op|','
name|'MagicpointOutput'
op|','
name|'template'
op|','
name|'ext'
op|'='
string|'".mgp"'
op|')'
newline|'\n'
name|'return'
name|'df'
newline|'\n'
nl|'\n'
DECL|variable|factory
dedent|''
dedent|''
name|'factory'
op|'='
name|'SlidesProcessingFunctionFactory'
op|'('
op|')'
newline|'\n'
endmarker|''
end_unit
