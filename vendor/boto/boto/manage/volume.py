begin_unit
comment|'# Copyright (c) 2006-2009 Mitch Garnaat http://garnaat.org/'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Permission is hereby granted, free of charge, to any person obtaining a'
nl|'\n'
comment|'# copy of this software and associated documentation files (the'
nl|'\n'
comment|'# "Software"), to deal in the Software without restriction, including'
nl|'\n'
comment|'# without limitation the rights to use, copy, modify, merge, publish, dis-'
nl|'\n'
comment|'# tribute, sublicense, and/or sell copies of the Software, and to permit'
nl|'\n'
comment|'# persons to whom the Software is furnished to do so, subject to the fol-'
nl|'\n'
comment|'# lowing conditions:'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# The above copyright notice and this permission notice shall be included'
nl|'\n'
comment|'# in all copies or substantial portions of the Software.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS'
nl|'\n'
comment|'# OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABIL-'
nl|'\n'
comment|'# ITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT'
nl|'\n'
comment|'# SHALL THE AUTHOR BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, '
nl|'\n'
comment|'# WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,'
nl|'\n'
comment|'# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS'
nl|'\n'
comment|'# IN THE SOFTWARE.'
nl|'\n'
nl|'\n'
name|'from'
name|'__future__'
name|'import'
name|'with_statement'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'sdb'
op|'.'
name|'db'
op|'.'
name|'model'
name|'import'
name|'Model'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'sdb'
op|'.'
name|'db'
op|'.'
name|'property'
name|'import'
name|'StringProperty'
op|','
name|'IntegerProperty'
op|','
name|'ListProperty'
op|','
name|'ReferenceProperty'
op|','
name|'CalculatedProperty'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'manage'
op|'.'
name|'server'
name|'import'
name|'Server'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'manage'
name|'import'
name|'propget'
newline|'\n'
name|'import'
name|'boto'
op|'.'
name|'ec2'
newline|'\n'
name|'import'
name|'time'
newline|'\n'
name|'import'
name|'traceback'
newline|'\n'
name|'from'
name|'contextlib'
name|'import'
name|'closing'
newline|'\n'
name|'import'
name|'dateutil'
op|'.'
name|'parser'
newline|'\n'
name|'import'
name|'datetime'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|CommandLineGetter
name|'class'
name|'CommandLineGetter'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|get_region
indent|'    '
name|'def'
name|'get_region'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'params'
op|'.'
name|'get'
op|'('
string|"'region'"
op|','
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'self'
op|'.'
name|'cls'
op|'.'
name|'find_property'
op|'('
string|"'region_name'"
op|')'
newline|'\n'
name|'params'
op|'['
string|"'region'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|','
name|'choices'
op|'='
name|'boto'
op|'.'
name|'ec2'
op|'.'
name|'regions'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_zone
dedent|''
dedent|''
name|'def'
name|'get_zone'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'params'
op|'.'
name|'get'
op|'('
string|"'zone'"
op|','
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'StringProperty'
op|'('
name|'name'
op|'='
string|"'zone'"
op|','
name|'verbose_name'
op|'='
string|"'EC2 Availability Zone'"
op|','
nl|'\n'
name|'choices'
op|'='
name|'self'
op|'.'
name|'ec2'
op|'.'
name|'get_all_zones'
op|')'
newline|'\n'
name|'params'
op|'['
string|"'zone'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_name
dedent|''
dedent|''
name|'def'
name|'get_name'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'params'
op|'.'
name|'get'
op|'('
string|"'name'"
op|','
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'self'
op|'.'
name|'cls'
op|'.'
name|'find_property'
op|'('
string|"'name'"
op|')'
newline|'\n'
name|'params'
op|'['
string|"'name'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_size
dedent|''
dedent|''
name|'def'
name|'get_size'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'params'
op|'.'
name|'get'
op|'('
string|"'size'"
op|','
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'IntegerProperty'
op|'('
name|'name'
op|'='
string|"'size'"
op|','
name|'verbose_name'
op|'='
string|"'Size (GB)'"
op|')'
newline|'\n'
name|'params'
op|'['
string|"'size'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_mount_point
dedent|''
dedent|''
name|'def'
name|'get_mount_point'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'params'
op|'.'
name|'get'
op|'('
string|"'mount_point'"
op|','
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'self'
op|'.'
name|'cls'
op|'.'
name|'find_property'
op|'('
string|"'mount_point'"
op|')'
newline|'\n'
name|'params'
op|'['
string|"'mount_point'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_device
dedent|''
dedent|''
name|'def'
name|'get_device'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'params'
op|'.'
name|'get'
op|'('
string|"'device'"
op|','
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'self'
op|'.'
name|'cls'
op|'.'
name|'find_property'
op|'('
string|"'device'"
op|')'
newline|'\n'
name|'params'
op|'['
string|"'device'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get
dedent|''
dedent|''
name|'def'
name|'get'
op|'('
name|'self'
op|','
name|'cls'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cls'
op|'='
name|'cls'
newline|'\n'
name|'self'
op|'.'
name|'get_region'
op|'('
name|'params'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'ec2'
op|'='
name|'params'
op|'['
string|"'region'"
op|']'
op|'.'
name|'connect'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'get_zone'
op|'('
name|'params'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'get_name'
op|'('
name|'params'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'get_size'
op|'('
name|'params'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'get_mount_point'
op|'('
name|'params'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'get_device'
op|'('
name|'params'
op|')'
newline|'\n'
nl|'\n'
DECL|class|Volume
dedent|''
dedent|''
name|'class'
name|'Volume'
op|'('
name|'Model'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|name
indent|'    '
name|'name'
op|'='
name|'StringProperty'
op|'('
name|'required'
op|'='
name|'True'
op|','
name|'unique'
op|'='
name|'True'
op|','
name|'verbose_name'
op|'='
string|"'Name'"
op|')'
newline|'\n'
DECL|variable|region_name
name|'region_name'
op|'='
name|'StringProperty'
op|'('
name|'required'
op|'='
name|'True'
op|','
name|'verbose_name'
op|'='
string|"'EC2 Region'"
op|')'
newline|'\n'
DECL|variable|zone_name
name|'zone_name'
op|'='
name|'StringProperty'
op|'('
name|'required'
op|'='
name|'True'
op|','
name|'verbose_name'
op|'='
string|"'EC2 Zone'"
op|')'
newline|'\n'
DECL|variable|mount_point
name|'mount_point'
op|'='
name|'StringProperty'
op|'('
name|'verbose_name'
op|'='
string|"'Mount Point'"
op|')'
newline|'\n'
DECL|variable|device
name|'device'
op|'='
name|'StringProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Device Name"'
op|','
name|'default'
op|'='
string|"'/dev/sdp'"
op|')'
newline|'\n'
DECL|variable|volume_id
name|'volume_id'
op|'='
name|'StringProperty'
op|'('
name|'required'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|past_volume_ids
name|'past_volume_ids'
op|'='
name|'ListProperty'
op|'('
name|'item_type'
op|'='
name|'str'
op|')'
newline|'\n'
DECL|variable|server
name|'server'
op|'='
name|'ReferenceProperty'
op|'('
name|'Server'
op|','
name|'collection_name'
op|'='
string|"'volumes'"
op|','
nl|'\n'
DECL|variable|verbose_name
name|'verbose_name'
op|'='
string|"'Server Attached To'"
op|')'
newline|'\n'
DECL|variable|volume_state
name|'volume_state'
op|'='
name|'CalculatedProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Volume State"'
op|','
nl|'\n'
name|'calculated_type'
op|'='
name|'str'
op|','
name|'use_method'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|attachment_state
name|'attachment_state'
op|'='
name|'CalculatedProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Attachment State"'
op|','
nl|'\n'
name|'calculated_type'
op|'='
name|'str'
op|','
name|'use_method'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|size
name|'size'
op|'='
name|'CalculatedProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Size (GB)"'
op|','
nl|'\n'
name|'calculated_type'
op|'='
name|'int'
op|','
name|'use_method'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|create
name|'def'
name|'create'
op|'('
name|'cls'
op|','
op|'**'
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'getter'
op|'='
name|'CommandLineGetter'
op|'('
op|')'
newline|'\n'
name|'getter'
op|'.'
name|'get'
op|'('
name|'cls'
op|','
name|'params'
op|')'
newline|'\n'
name|'region'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'region'"
op|')'
newline|'\n'
name|'ec2'
op|'='
name|'region'
op|'.'
name|'connect'
op|'('
op|')'
newline|'\n'
name|'zone'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'zone'"
op|')'
newline|'\n'
name|'size'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'size'"
op|')'
newline|'\n'
name|'ebs_volume'
op|'='
name|'ec2'
op|'.'
name|'create_volume'
op|'('
name|'size'
op|','
name|'zone'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'v'
op|'='
name|'cls'
op|'('
op|')'
newline|'\n'
name|'v'
op|'.'
name|'ec2'
op|'='
name|'ec2'
newline|'\n'
name|'v'
op|'.'
name|'volume_id'
op|'='
name|'ebs_volume'
op|'.'
name|'id'
newline|'\n'
name|'v'
op|'.'
name|'name'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'name'"
op|')'
newline|'\n'
name|'v'
op|'.'
name|'mount_point'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'mount_point'"
op|')'
newline|'\n'
name|'v'
op|'.'
name|'device'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'device'"
op|')'
newline|'\n'
name|'v'
op|'.'
name|'region_name'
op|'='
name|'region'
op|'.'
name|'name'
newline|'\n'
name|'v'
op|'.'
name|'zone_name'
op|'='
name|'zone'
op|'.'
name|'name'
newline|'\n'
name|'v'
op|'.'
name|'put'
op|'('
op|')'
newline|'\n'
name|'return'
name|'v'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|create_from_volume_id
name|'def'
name|'create_from_volume_id'
op|'('
name|'cls'
op|','
name|'region_name'
op|','
name|'volume_id'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vol'
op|'='
name|'None'
newline|'\n'
name|'ec2'
op|'='
name|'boto'
op|'.'
name|'ec2'
op|'.'
name|'connect_to_region'
op|'('
name|'region_name'
op|')'
newline|'\n'
name|'rs'
op|'='
name|'ec2'
op|'.'
name|'get_all_volumes'
op|'('
op|'['
name|'volume_id'
op|']'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'rs'
op|')'
op|'=='
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'v'
op|'='
name|'rs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'vol'
op|'='
name|'cls'
op|'('
op|')'
newline|'\n'
name|'vol'
op|'.'
name|'volume_id'
op|'='
name|'v'
op|'.'
name|'id'
newline|'\n'
name|'vol'
op|'.'
name|'name'
op|'='
name|'name'
newline|'\n'
name|'vol'
op|'.'
name|'region_name'
op|'='
name|'v'
op|'.'
name|'region'
op|'.'
name|'name'
newline|'\n'
name|'vol'
op|'.'
name|'zone_name'
op|'='
name|'v'
op|'.'
name|'zone'
newline|'\n'
name|'vol'
op|'.'
name|'put'
op|'('
op|')'
newline|'\n'
dedent|''
name|'return'
name|'vol'
newline|'\n'
nl|'\n'
DECL|member|create_from_latest_snapshot
dedent|''
name|'def'
name|'create_from_latest_snapshot'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'size'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'snapshot'
op|'='
name|'self'
op|'.'
name|'get_snapshots'
op|'('
op|')'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'create_from_snapshot'
op|'('
name|'name'
op|','
name|'snapshot'
op|','
name|'size'
op|')'
newline|'\n'
nl|'\n'
DECL|member|create_from_snapshot
dedent|''
name|'def'
name|'create_from_snapshot'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'snapshot'
op|','
name|'size'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'size'
op|'<'
name|'self'
op|'.'
name|'size'
op|':'
newline|'\n'
indent|'            '
name|'size'
op|'='
name|'self'
op|'.'
name|'size'
newline|'\n'
dedent|''
name|'ec2'
op|'='
name|'self'
op|'.'
name|'get_ec2_connection'
op|'('
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'zone_name'
op|'=='
name|'None'
name|'or'
name|'self'
op|'.'
name|'zone_name'
op|'=='
string|"''"
op|':'
newline|'\n'
comment|'# deal with the migration case where the zone is not set in the logical volume:'
nl|'\n'
indent|'            '
name|'current_volume'
op|'='
name|'ec2'
op|'.'
name|'get_all_volumes'
op|'('
op|'['
name|'self'
op|'.'
name|'volume_id'
op|']'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'zone_name'
op|'='
name|'current_volume'
op|'.'
name|'zone'
newline|'\n'
dedent|''
name|'ebs_volume'
op|'='
name|'ec2'
op|'.'
name|'create_volume'
op|'('
name|'size'
op|','
name|'self'
op|'.'
name|'zone_name'
op|','
name|'snapshot'
op|')'
newline|'\n'
name|'v'
op|'='
name|'Volume'
op|'('
op|')'
newline|'\n'
name|'v'
op|'.'
name|'ec2'
op|'='
name|'self'
op|'.'
name|'ec2'
newline|'\n'
name|'v'
op|'.'
name|'volume_id'
op|'='
name|'ebs_volume'
op|'.'
name|'id'
newline|'\n'
name|'v'
op|'.'
name|'name'
op|'='
name|'name'
newline|'\n'
name|'v'
op|'.'
name|'mount_point'
op|'='
name|'self'
op|'.'
name|'mount_point'
newline|'\n'
name|'v'
op|'.'
name|'device'
op|'='
name|'self'
op|'.'
name|'device'
newline|'\n'
name|'v'
op|'.'
name|'region_name'
op|'='
name|'self'
op|'.'
name|'region_name'
newline|'\n'
name|'v'
op|'.'
name|'zone_name'
op|'='
name|'self'
op|'.'
name|'zone_name'
newline|'\n'
name|'v'
op|'.'
name|'put'
op|'('
op|')'
newline|'\n'
name|'return'
name|'v'
newline|'\n'
nl|'\n'
DECL|member|get_ec2_connection
dedent|''
name|'def'
name|'get_ec2_connection'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'server'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'server'
op|'.'
name|'ec2'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'hasattr'
op|'('
name|'self'
op|','
string|"'ec2'"
op|')'
name|'or'
name|'self'
op|'.'
name|'ec2'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'ec2'
op|'='
name|'boto'
op|'.'
name|'ec2'
op|'.'
name|'connect_to_region'
op|'('
name|'self'
op|'.'
name|'region_name'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'ec2'
newline|'\n'
nl|'\n'
DECL|member|_volume_state
dedent|''
name|'def'
name|'_volume_state'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ec2'
op|'='
name|'self'
op|'.'
name|'get_ec2_connection'
op|'('
op|')'
newline|'\n'
name|'rs'
op|'='
name|'ec2'
op|'.'
name|'get_all_volumes'
op|'('
op|'['
name|'self'
op|'.'
name|'volume_id'
op|']'
op|')'
newline|'\n'
name|'return'
name|'rs'
op|'['
number|'0'
op|']'
op|'.'
name|'volume_state'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_attachment_state
dedent|''
name|'def'
name|'_attachment_state'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ec2'
op|'='
name|'self'
op|'.'
name|'get_ec2_connection'
op|'('
op|')'
newline|'\n'
name|'rs'
op|'='
name|'ec2'
op|'.'
name|'get_all_volumes'
op|'('
op|'['
name|'self'
op|'.'
name|'volume_id'
op|']'
op|')'
newline|'\n'
name|'return'
name|'rs'
op|'['
number|'0'
op|']'
op|'.'
name|'attachment_state'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_size
dedent|''
name|'def'
name|'_size'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'hasattr'
op|'('
name|'self'
op|','
string|"'__size'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'ec2'
op|'='
name|'self'
op|'.'
name|'get_ec2_connection'
op|'('
op|')'
newline|'\n'
name|'rs'
op|'='
name|'ec2'
op|'.'
name|'get_all_volumes'
op|'('
op|'['
name|'self'
op|'.'
name|'volume_id'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'__size'
op|'='
name|'rs'
op|'['
number|'0'
op|']'
op|'.'
name|'size'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'__size'
newline|'\n'
nl|'\n'
DECL|member|install_xfs
dedent|''
name|'def'
name|'install_xfs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'server'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'server'
op|'.'
name|'install'
op|'('
string|"'xfsprogs xfsdump'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_snapshots
dedent|''
dedent|''
name|'def'
name|'get_snapshots'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Returns a list of all completed snapshots for this volume ID.\n        """'
newline|'\n'
name|'ec2'
op|'='
name|'self'
op|'.'
name|'get_ec2_connection'
op|'('
op|')'
newline|'\n'
name|'rs'
op|'='
name|'ec2'
op|'.'
name|'get_all_snapshots'
op|'('
op|')'
newline|'\n'
name|'all_vols'
op|'='
op|'['
name|'self'
op|'.'
name|'volume_id'
op|']'
op|'+'
name|'self'
op|'.'
name|'past_volume_ids'
newline|'\n'
name|'snaps'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'snapshot'
name|'in'
name|'rs'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'snapshot'
op|'.'
name|'volume_id'
name|'in'
name|'all_vols'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'snapshot'
op|'.'
name|'progress'
op|'=='
string|"'100%'"
op|':'
newline|'\n'
indent|'                    '
name|'snapshot'
op|'.'
name|'date'
op|'='
name|'dateutil'
op|'.'
name|'parser'
op|'.'
name|'parse'
op|'('
name|'snapshot'
op|'.'
name|'start_time'
op|')'
newline|'\n'
name|'snapshot'
op|'.'
name|'keep'
op|'='
name|'True'
newline|'\n'
name|'snaps'
op|'.'
name|'append'
op|'('
name|'snapshot'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'snaps'
op|'.'
name|'sort'
op|'('
name|'cmp'
op|'='
name|'lambda'
name|'x'
op|','
name|'y'
op|':'
name|'cmp'
op|'('
name|'x'
op|'.'
name|'date'
op|','
name|'y'
op|'.'
name|'date'
op|')'
op|')'
newline|'\n'
name|'return'
name|'snaps'
newline|'\n'
nl|'\n'
DECL|member|attach
dedent|''
name|'def'
name|'attach'
op|'('
name|'self'
op|','
name|'server'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'attachment_state'
op|'=='
string|"'attached'"
op|':'
newline|'\n'
indent|'            '
name|'print'
string|"'already attached'"
newline|'\n'
name|'return'
name|'None'
newline|'\n'
dedent|''
name|'if'
name|'server'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'server'
op|'='
name|'server'
newline|'\n'
name|'self'
op|'.'
name|'put'
op|'('
op|')'
newline|'\n'
dedent|''
name|'ec2'
op|'='
name|'self'
op|'.'
name|'get_ec2_connection'
op|'('
op|')'
newline|'\n'
name|'ec2'
op|'.'
name|'attach_volume'
op|'('
name|'self'
op|'.'
name|'volume_id'
op|','
name|'self'
op|'.'
name|'server'
op|'.'
name|'instance_id'
op|','
name|'self'
op|'.'
name|'device'
op|')'
newline|'\n'
nl|'\n'
DECL|member|detach
dedent|''
name|'def'
name|'detach'
op|'('
name|'self'
op|','
name|'force'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'state'
op|'='
name|'self'
op|'.'
name|'attachment_state'
newline|'\n'
name|'if'
name|'state'
op|'=='
string|"'available'"
name|'or'
name|'state'
op|'=='
name|'None'
name|'or'
name|'state'
op|'=='
string|"'detaching'"
op|':'
newline|'\n'
indent|'            '
name|'print'
string|"'already detached'"
newline|'\n'
name|'return'
name|'None'
newline|'\n'
dedent|''
name|'ec2'
op|'='
name|'self'
op|'.'
name|'get_ec2_connection'
op|'('
op|')'
newline|'\n'
name|'ec2'
op|'.'
name|'detach_volume'
op|'('
name|'self'
op|'.'
name|'volume_id'
op|','
name|'self'
op|'.'
name|'server'
op|'.'
name|'instance_id'
op|','
name|'self'
op|'.'
name|'device'
op|','
name|'force'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'server'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'put'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|checkfs
dedent|''
name|'def'
name|'checkfs'
op|'('
name|'self'
op|','
name|'use_cmd'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'server'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ValueError'
op|','
string|"'server attribute must be set to run this command'"
newline|'\n'
comment|'# detemine state of file system on volume, only works if attached'
nl|'\n'
dedent|''
name|'if'
name|'use_cmd'
op|':'
newline|'\n'
indent|'            '
name|'cmd'
op|'='
name|'use_cmd'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'cmd'
op|'='
name|'self'
op|'.'
name|'server'
op|'.'
name|'get_cmdshell'
op|'('
op|')'
newline|'\n'
dedent|''
name|'status'
op|'='
name|'cmd'
op|'.'
name|'run'
op|'('
string|"'xfs_check %s'"
op|'%'
name|'self'
op|'.'
name|'device'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'use_cmd'
op|':'
newline|'\n'
indent|'            '
name|'cmd'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
dedent|''
name|'if'
name|'status'
op|'['
number|'1'
op|']'
op|'.'
name|'startswith'
op|'('
string|"'bad superblock magic number 0'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'False'
newline|'\n'
dedent|''
name|'return'
name|'True'
newline|'\n'
nl|'\n'
DECL|member|wait
dedent|''
name|'def'
name|'wait'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'server'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ValueError'
op|','
string|"'server attribute must be set to run this command'"
newline|'\n'
dedent|''
name|'with'
name|'closing'
op|'('
name|'self'
op|'.'
name|'server'
op|'.'
name|'get_cmdshell'
op|'('
op|')'
op|')'
name|'as'
name|'cmd'
op|':'
newline|'\n'
comment|'# wait for the volume device to appear'
nl|'\n'
indent|'            '
name|'cmd'
op|'='
name|'self'
op|'.'
name|'server'
op|'.'
name|'get_cmdshell'
op|'('
op|')'
newline|'\n'
name|'while'
name|'not'
name|'cmd'
op|'.'
name|'exists'
op|'('
name|'self'
op|'.'
name|'device'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'boto'
op|'.'
name|'log'
op|'.'
name|'info'
op|'('
string|"'%s still does not exist, waiting 10 seconds'"
op|'%'
name|'self'
op|'.'
name|'device'
op|')'
newline|'\n'
name|'time'
op|'.'
name|'sleep'
op|'('
number|'10'
op|')'
newline|'\n'
nl|'\n'
DECL|member|format
dedent|''
dedent|''
dedent|''
name|'def'
name|'format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'server'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ValueError'
op|','
string|"'server attribute must be set to run this command'"
newline|'\n'
dedent|''
name|'status'
op|'='
name|'None'
newline|'\n'
name|'with'
name|'closing'
op|'('
name|'self'
op|'.'
name|'server'
op|'.'
name|'get_cmdshell'
op|'('
op|')'
op|')'
name|'as'
name|'cmd'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'self'
op|'.'
name|'checkfs'
op|'('
name|'cmd'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'boto'
op|'.'
name|'log'
op|'.'
name|'info'
op|'('
string|"'make_fs...'"
op|')'
newline|'\n'
name|'status'
op|'='
name|'cmd'
op|'.'
name|'run'
op|'('
string|"'mkfs -t xfs %s'"
op|'%'
name|'self'
op|'.'
name|'device'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'status'
newline|'\n'
nl|'\n'
DECL|member|mount
dedent|''
name|'def'
name|'mount'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'server'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ValueError'
op|','
string|"'server attribute must be set to run this command'"
newline|'\n'
dedent|''
name|'boto'
op|'.'
name|'log'
op|'.'
name|'info'
op|'('
string|"'handle_mount_point'"
op|')'
newline|'\n'
name|'with'
name|'closing'
op|'('
name|'self'
op|'.'
name|'server'
op|'.'
name|'get_cmdshell'
op|'('
op|')'
op|')'
name|'as'
name|'cmd'
op|':'
newline|'\n'
indent|'            '
name|'cmd'
op|'='
name|'self'
op|'.'
name|'server'
op|'.'
name|'get_cmdshell'
op|'('
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cmd'
op|'.'
name|'isdir'
op|'('
name|'self'
op|'.'
name|'mount_point'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'boto'
op|'.'
name|'log'
op|'.'
name|'info'
op|'('
string|"'making directory'"
op|')'
newline|'\n'
comment|"# mount directory doesn't exist so create it"
nl|'\n'
name|'cmd'
op|'.'
name|'run'
op|'('
string|'"mkdir %s"'
op|'%'
name|'self'
op|'.'
name|'mount_point'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'boto'
op|'.'
name|'log'
op|'.'
name|'info'
op|'('
string|"'directory exists already'"
op|')'
newline|'\n'
name|'status'
op|'='
name|'cmd'
op|'.'
name|'run'
op|'('
string|"'mount -l'"
op|')'
newline|'\n'
name|'lines'
op|'='
name|'status'
op|'['
number|'1'
op|']'
op|'.'
name|'split'
op|'('
string|"'\\n'"
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'lines'
op|':'
newline|'\n'
indent|'                    '
name|'t'
op|'='
name|'line'
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'if'
name|'t'
name|'and'
name|'t'
op|'['
number|'2'
op|']'
op|'=='
name|'self'
op|'.'
name|'mount_point'
op|':'
newline|'\n'
comment|'# something is already mounted at the mount point'
nl|'\n'
comment|'# unmount that and mount it as /tmp'
nl|'\n'
indent|'                        '
name|'if'
name|'t'
op|'['
number|'0'
op|']'
op|'!='
name|'self'
op|'.'
name|'device'
op|':'
newline|'\n'
indent|'                            '
name|'cmd'
op|'.'
name|'run'
op|'('
string|"'umount %s'"
op|'%'
name|'self'
op|'.'
name|'mount_point'
op|')'
newline|'\n'
name|'cmd'
op|'.'
name|'run'
op|'('
string|"'mount %s /tmp'"
op|'%'
name|'t'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'cmd'
op|'.'
name|'run'
op|'('
string|"'chmod 777 /tmp'"
op|')'
newline|'\n'
name|'break'
newline|'\n'
comment|'# Mount up our new EBS volume onto mount_point'
nl|'\n'
dedent|''
dedent|''
dedent|''
dedent|''
name|'cmd'
op|'.'
name|'run'
op|'('
string|'"mount %s %s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'device'
op|','
name|'self'
op|'.'
name|'mount_point'
op|')'
op|')'
newline|'\n'
name|'cmd'
op|'.'
name|'run'
op|'('
string|"'xfs_growfs %s'"
op|'%'
name|'self'
op|'.'
name|'mount_point'
op|')'
newline|'\n'
nl|'\n'
DECL|member|make_ready
dedent|''
dedent|''
name|'def'
name|'make_ready'
op|'('
name|'self'
op|','
name|'server'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'server'
op|'='
name|'server'
newline|'\n'
name|'self'
op|'.'
name|'put'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'install_xfs'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'attach'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'wait'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'format'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mount'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|freeze
dedent|''
name|'def'
name|'freeze'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'server'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'server'
op|'.'
name|'run'
op|'('
string|'"/usr/sbin/xfs_freeze -f %s"'
op|'%'
name|'self'
op|'.'
name|'mount_point'
op|')'
newline|'\n'
nl|'\n'
DECL|member|unfreeze
dedent|''
dedent|''
name|'def'
name|'unfreeze'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'server'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'server'
op|'.'
name|'run'
op|'('
string|'"/usr/sbin/xfs_freeze -u %s"'
op|'%'
name|'self'
op|'.'
name|'mount_point'
op|')'
newline|'\n'
nl|'\n'
DECL|member|snapshot
dedent|''
dedent|''
name|'def'
name|'snapshot'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# if this volume is attached to a server'
nl|'\n'
comment|'# we need to freeze the XFS file system'
nl|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'freeze'
op|'('
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'server'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'snapshot'
op|'='
name|'self'
op|'.'
name|'get_ec2_connection'
op|'('
op|')'
op|'.'
name|'create_snapshot'
op|'('
name|'self'
op|'.'
name|'volume_id'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'snapshot'
op|'='
name|'self'
op|'.'
name|'server'
op|'.'
name|'ec2'
op|'.'
name|'create_snapshot'
op|'('
name|'self'
op|'.'
name|'volume_id'
op|')'
newline|'\n'
dedent|''
name|'boto'
op|'.'
name|'log'
op|'.'
name|'info'
op|'('
string|"'Snapshot of Volume %s created: %s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'name'
op|','
name|'snapshot'
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
op|':'
newline|'\n'
indent|'            '
name|'boto'
op|'.'
name|'log'
op|'.'
name|'info'
op|'('
string|"'Snapshot error'"
op|')'
newline|'\n'
name|'boto'
op|'.'
name|'log'
op|'.'
name|'info'
op|'('
name|'traceback'
op|'.'
name|'format_exc'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'status'
op|'='
name|'self'
op|'.'
name|'unfreeze'
op|'('
op|')'
newline|'\n'
name|'return'
name|'status'
newline|'\n'
nl|'\n'
DECL|member|get_snapshot_range
dedent|''
dedent|''
name|'def'
name|'get_snapshot_range'
op|'('
name|'self'
op|','
name|'snaps'
op|','
name|'start_date'
op|'='
name|'None'
op|','
name|'end_date'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'l'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'snap'
name|'in'
name|'snaps'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'start_date'
name|'and'
name|'end_date'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'snap'
op|'.'
name|'date'
op|'>='
name|'start_date'
name|'and'
name|'snap'
op|'.'
name|'date'
op|'<='
name|'end_date'
op|':'
newline|'\n'
indent|'                    '
name|'l'
op|'.'
name|'append'
op|'('
name|'snap'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'start_date'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'snap'
op|'.'
name|'date'
op|'>='
name|'start_date'
op|':'
newline|'\n'
indent|'                    '
name|'l'
op|'.'
name|'append'
op|'('
name|'snap'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'end_date'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'snap'
op|'.'
name|'date'
op|'<='
name|'end_date'
op|':'
newline|'\n'
indent|'                    '
name|'l'
op|'.'
name|'append'
op|'('
name|'snap'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'l'
op|'.'
name|'append'
op|'('
name|'snap'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'l'
newline|'\n'
nl|'\n'
DECL|member|trim_snapshots
dedent|''
name|'def'
name|'trim_snapshots'
op|'('
name|'self'
op|','
name|'delete'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Trim the number of snapshots for this volume.  This method always\n        keeps the oldest snapshot.  It then uses the parameters passed in\n        to determine how many others should be kept.\n\n        The algorithm is to keep all snapshots from the current day.  Then\n        it will keep the first snapshot of the day for the previous seven days.\n        Then, it will keep the first snapshot of the week for the previous\n        four weeks.  After than, it will keep the first snapshot of the month\n        for as many months as there are.\n\n        """'
newline|'\n'
name|'snaps'
op|'='
name|'self'
op|'.'
name|'get_snapshots'
op|'('
op|')'
newline|'\n'
comment|'# Always keep the oldest and the newest'
nl|'\n'
name|'if'
name|'len'
op|'('
name|'snaps'
op|')'
op|'<='
number|'2'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'snaps'
newline|'\n'
dedent|''
name|'snaps'
op|'='
name|'snaps'
op|'['
number|'1'
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
name|'now'
op|'='
name|'datetime'
op|'.'
name|'datetime'
op|'.'
name|'now'
op|'('
name|'snaps'
op|'['
number|'0'
op|']'
op|'.'
name|'date'
op|'.'
name|'tzinfo'
op|')'
newline|'\n'
name|'midnight'
op|'='
name|'datetime'
op|'.'
name|'datetime'
op|'('
name|'year'
op|'='
name|'now'
op|'.'
name|'year'
op|','
name|'month'
op|'='
name|'now'
op|'.'
name|'month'
op|','
nl|'\n'
name|'day'
op|'='
name|'now'
op|'.'
name|'day'
op|','
name|'tzinfo'
op|'='
name|'now'
op|'.'
name|'tzinfo'
op|')'
newline|'\n'
comment|'# Keep the first snapshot from each day of the previous week'
nl|'\n'
name|'one_week'
op|'='
name|'datetime'
op|'.'
name|'timedelta'
op|'('
name|'days'
op|'='
number|'7'
op|','
name|'seconds'
op|'='
number|'60'
op|'*'
number|'60'
op|')'
newline|'\n'
name|'print'
name|'midnight'
op|'-'
name|'one_week'
op|','
name|'midnight'
newline|'\n'
name|'previous_week'
op|'='
name|'self'
op|'.'
name|'get_snapshot_range'
op|'('
name|'snaps'
op|','
name|'midnight'
op|'-'
name|'one_week'
op|','
name|'midnight'
op|')'
newline|'\n'
name|'print'
name|'previous_week'
newline|'\n'
name|'if'
name|'not'
name|'previous_week'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'snaps'
newline|'\n'
dedent|''
name|'current_day'
op|'='
name|'None'
newline|'\n'
name|'for'
name|'snap'
name|'in'
name|'previous_week'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'current_day'
name|'and'
name|'current_day'
op|'=='
name|'snap'
op|'.'
name|'date'
op|'.'
name|'day'
op|':'
newline|'\n'
indent|'                '
name|'snap'
op|'.'
name|'keep'
op|'='
name|'False'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'current_day'
op|'='
name|'snap'
op|'.'
name|'date'
op|'.'
name|'day'
newline|'\n'
comment|'# Get ourselves onto the next full week boundary'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'previous_week'
op|':'
newline|'\n'
indent|'            '
name|'week_boundary'
op|'='
name|'previous_week'
op|'['
number|'0'
op|']'
op|'.'
name|'date'
newline|'\n'
name|'if'
name|'week_boundary'
op|'.'
name|'weekday'
op|'('
op|')'
op|'!='
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'delta'
op|'='
name|'datetime'
op|'.'
name|'timedelta'
op|'('
name|'days'
op|'='
name|'week_boundary'
op|'.'
name|'weekday'
op|'('
op|')'
op|')'
newline|'\n'
name|'week_boundary'
op|'='
name|'week_boundary'
op|'-'
name|'delta'
newline|'\n'
comment|'# Keep one within this partial week'
nl|'\n'
dedent|''
dedent|''
name|'partial_week'
op|'='
name|'self'
op|'.'
name|'get_snapshot_range'
op|'('
name|'snaps'
op|','
name|'week_boundary'
op|','
name|'previous_week'
op|'['
number|'0'
op|']'
op|'.'
name|'date'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'partial_week'
op|')'
op|'>'
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'snap'
name|'in'
name|'partial_week'
op|'['
number|'1'
op|':'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'snap'
op|'.'
name|'keep'
op|'='
name|'False'
newline|'\n'
comment|'# Keep the first snapshot of each week for the previous 4 weeks'
nl|'\n'
dedent|''
dedent|''
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'0'
op|','
number|'4'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'weeks_worth'
op|'='
name|'self'
op|'.'
name|'get_snapshot_range'
op|'('
name|'snaps'
op|','
name|'week_boundary'
op|'-'
name|'one_week'
op|','
name|'week_boundary'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'weeks_worth'
op|')'
op|'>'
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'for'
name|'snap'
name|'in'
name|'weeks_worth'
op|'['
number|'1'
op|':'
op|']'
op|':'
newline|'\n'
indent|'                    '
name|'snap'
op|'.'
name|'keep'
op|'='
name|'False'
newline|'\n'
dedent|''
dedent|''
name|'week_boundary'
op|'='
name|'week_boundary'
op|'-'
name|'one_week'
newline|'\n'
comment|'# Now look through all remaining snaps and keep one per month'
nl|'\n'
dedent|''
name|'remainder'
op|'='
name|'self'
op|'.'
name|'get_snapshot_range'
op|'('
name|'snaps'
op|','
name|'end_date'
op|'='
name|'week_boundary'
op|')'
newline|'\n'
name|'current_month'
op|'='
name|'None'
newline|'\n'
name|'for'
name|'snap'
name|'in'
name|'remainder'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'current_month'
name|'and'
name|'current_month'
op|'=='
name|'snap'
op|'.'
name|'date'
op|'.'
name|'month'
op|':'
newline|'\n'
indent|'                '
name|'snap'
op|'.'
name|'keep'
op|'='
name|'False'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'current_month'
op|'='
name|'snap'
op|'.'
name|'date'
op|'.'
name|'month'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'delete'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'snap'
name|'in'
name|'snaps'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'not'
name|'snap'
op|'.'
name|'keep'
op|':'
newline|'\n'
indent|'                    '
name|'boto'
op|'.'
name|'log'
op|'.'
name|'info'
op|'('
string|"'Deleting %s(%s) for %s'"
op|'%'
op|'('
name|'snap'
op|','
name|'snap'
op|'.'
name|'date'
op|','
name|'self'
op|'.'
name|'name'
op|')'
op|')'
newline|'\n'
name|'snap'
op|'.'
name|'delete'
op|'('
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'return'
name|'snaps'
newline|'\n'
nl|'\n'
DECL|member|grow
dedent|''
name|'def'
name|'grow'
op|'('
name|'self'
op|','
name|'size'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|copy
dedent|''
name|'def'
name|'copy'
op|'('
name|'self'
op|','
name|'snapshot'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|get_snapshot_from_date
dedent|''
name|'def'
name|'get_snapshot_from_date'
op|'('
name|'self'
op|','
name|'date'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'self'
op|','
name|'delete_ebs_volume'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'delete_ebs_volume'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'detach'
op|'('
op|')'
newline|'\n'
name|'ec2'
op|'='
name|'self'
op|'.'
name|'get_ec2_connection'
op|'('
op|')'
newline|'\n'
name|'ec2'
op|'.'
name|'delete_volume'
op|'('
name|'self'
op|'.'
name|'volume_id'
op|')'
newline|'\n'
dedent|''
name|'Model'
op|'.'
name|'delete'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|archive
dedent|''
name|'def'
name|'archive'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# snapshot volume, trim snaps, delete volume-id'
nl|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
