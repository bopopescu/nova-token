begin_unit
comment|'# Copyright (c) 2006-2009 Mitch Garnaat http://garnaat.org/'
nl|'\n'
comment|'# Copyright (c) 2010 Chris Moyer http://coredumped.org/'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Permission is hereby granted, free of charge, to any person obtaining a'
nl|'\n'
comment|'# copy of this software and associated documentation files (the'
nl|'\n'
comment|'# "Software"), to deal in the Software without restriction, including'
nl|'\n'
comment|'# without limitation the rights to use, copy, modify, merge, publish, dis-'
nl|'\n'
comment|'# tribute, sublicense, and/or sell copies of the Software, and to permit'
nl|'\n'
comment|'# persons to whom the Software is furnished to do so, subject to the fol-'
nl|'\n'
comment|'# lowing conditions:'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# The above copyright notice and this permission notice shall be included'
nl|'\n'
comment|'# in all copies or substantial portions of the Software.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS'
nl|'\n'
comment|'# OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABIL-'
nl|'\n'
comment|'# ITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT'
nl|'\n'
comment|'# SHALL THE AUTHOR BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, '
nl|'\n'
comment|'# WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,'
nl|'\n'
comment|'# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS'
nl|'\n'
comment|'# IN THE SOFTWARE.'
nl|'\n'
nl|'\n'
string|'"""\nHigh-level abstraction of an EC2 server\n"""'
newline|'\n'
name|'from'
name|'__future__'
name|'import'
name|'with_statement'
newline|'\n'
name|'import'
name|'boto'
op|'.'
name|'ec2'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'mashups'
op|'.'
name|'iobject'
name|'import'
name|'IObject'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'pyami'
op|'.'
name|'config'
name|'import'
name|'BotoConfigPath'
op|','
name|'Config'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'sdb'
op|'.'
name|'db'
op|'.'
name|'model'
name|'import'
name|'Model'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'sdb'
op|'.'
name|'db'
op|'.'
name|'property'
name|'import'
name|'StringProperty'
op|','
name|'IntegerProperty'
op|','
name|'BooleanProperty'
op|','
name|'CalculatedProperty'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'manage'
name|'import'
name|'propget'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'ec2'
op|'.'
name|'zone'
name|'import'
name|'Zone'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'ec2'
op|'.'
name|'keypair'
name|'import'
name|'KeyPair'
newline|'\n'
name|'import'
name|'os'
op|','
name|'time'
op|','
name|'StringIO'
newline|'\n'
name|'from'
name|'contextlib'
name|'import'
name|'closing'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'exception'
name|'import'
name|'EC2ResponseError'
newline|'\n'
nl|'\n'
DECL|variable|InstanceTypes
name|'InstanceTypes'
op|'='
op|'['
string|"'m1.small'"
op|','
string|"'m1.large'"
op|','
string|"'m1.xlarge'"
op|','
nl|'\n'
string|"'c1.medium'"
op|','
string|"'c1.xlarge'"
op|','
nl|'\n'
string|"'m2.2xlarge'"
op|','
string|"'m2.4xlarge'"
op|']'
newline|'\n'
nl|'\n'
DECL|class|Bundler
name|'class'
name|'Bundler'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'server'
op|','
name|'uname'
op|'='
string|"'root'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'from'
name|'boto'
op|'.'
name|'manage'
op|'.'
name|'cmdshell'
name|'import'
name|'SSHClient'
newline|'\n'
name|'self'
op|'.'
name|'server'
op|'='
name|'server'
newline|'\n'
name|'self'
op|'.'
name|'uname'
op|'='
name|'uname'
newline|'\n'
name|'self'
op|'.'
name|'ssh_client'
op|'='
name|'SSHClient'
op|'('
name|'server'
op|','
name|'uname'
op|'='
name|'uname'
op|')'
newline|'\n'
nl|'\n'
DECL|member|copy_x509
dedent|''
name|'def'
name|'copy_x509'
op|'('
name|'self'
op|','
name|'key_file'
op|','
name|'cert_file'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'\\tcopying cert and pk over to /mnt directory on server'"
newline|'\n'
name|'self'
op|'.'
name|'ssh_client'
op|'.'
name|'open_sftp'
op|'('
op|')'
newline|'\n'
name|'path'
op|','
name|'name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'split'
op|'('
name|'key_file'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'remote_key_file'
op|'='
string|"'/mnt/%s'"
op|'%'
name|'name'
newline|'\n'
name|'self'
op|'.'
name|'ssh_client'
op|'.'
name|'put_file'
op|'('
name|'key_file'
op|','
name|'self'
op|'.'
name|'remote_key_file'
op|')'
newline|'\n'
name|'path'
op|','
name|'name'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'split'
op|'('
name|'cert_file'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'remote_cert_file'
op|'='
string|"'/mnt/%s'"
op|'%'
name|'name'
newline|'\n'
name|'self'
op|'.'
name|'ssh_client'
op|'.'
name|'put_file'
op|'('
name|'cert_file'
op|','
name|'self'
op|'.'
name|'remote_cert_file'
op|')'
newline|'\n'
name|'print'
string|"'...complete!'"
newline|'\n'
nl|'\n'
DECL|member|bundle_image
dedent|''
name|'def'
name|'bundle_image'
op|'('
name|'self'
op|','
name|'prefix'
op|','
name|'size'
op|','
name|'ssh_key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'command'
op|'='
string|'""'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'uname'
op|'!='
string|"'root'"
op|':'
newline|'\n'
indent|'            '
name|'command'
op|'='
string|'"sudo "'
newline|'\n'
dedent|''
name|'command'
op|'+='
string|"'ec2-bundle-vol '"
newline|'\n'
name|'command'
op|'+='
string|"'-c %s -k %s '"
op|'%'
op|'('
name|'self'
op|'.'
name|'remote_cert_file'
op|','
name|'self'
op|'.'
name|'remote_key_file'
op|')'
newline|'\n'
name|'command'
op|'+='
string|"'-u %s '"
op|'%'
name|'self'
op|'.'
name|'server'
op|'.'
name|'_reservation'
op|'.'
name|'owner_id'
newline|'\n'
name|'command'
op|'+='
string|"'-p %s '"
op|'%'
name|'prefix'
newline|'\n'
name|'command'
op|'+='
string|"'-s %d '"
op|'%'
name|'size'
newline|'\n'
name|'command'
op|'+='
string|"'-d /mnt '"
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'server'
op|'.'
name|'instance_type'
op|'=='
string|"'m1.small'"
name|'or'
name|'self'
op|'.'
name|'server'
op|'.'
name|'instance_type'
op|'=='
string|"'c1.medium'"
op|':'
newline|'\n'
indent|'            '
name|'command'
op|'+='
string|"'-r i386'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'command'
op|'+='
string|"'-r x86_64'"
newline|'\n'
dedent|''
name|'return'
name|'command'
newline|'\n'
nl|'\n'
DECL|member|upload_bundle
dedent|''
name|'def'
name|'upload_bundle'
op|'('
name|'self'
op|','
name|'bucket'
op|','
name|'prefix'
op|','
name|'ssh_key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'command'
op|'='
string|'""'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'uname'
op|'!='
string|"'root'"
op|':'
newline|'\n'
indent|'            '
name|'command'
op|'='
string|'"sudo "'
newline|'\n'
dedent|''
name|'command'
op|'+='
string|"'ec2-upload-bundle '"
newline|'\n'
name|'command'
op|'+='
string|"'-m /mnt/%s.manifest.xml '"
op|'%'
name|'prefix'
newline|'\n'
name|'command'
op|'+='
string|"'-b %s '"
op|'%'
name|'bucket'
newline|'\n'
name|'command'
op|'+='
string|"'-a %s '"
op|'%'
name|'self'
op|'.'
name|'server'
op|'.'
name|'ec2'
op|'.'
name|'aws_access_key_id'
newline|'\n'
name|'command'
op|'+='
string|"'-s %s '"
op|'%'
name|'self'
op|'.'
name|'server'
op|'.'
name|'ec2'
op|'.'
name|'aws_secret_access_key'
newline|'\n'
name|'return'
name|'command'
newline|'\n'
nl|'\n'
DECL|member|bundle
dedent|''
name|'def'
name|'bundle'
op|'('
name|'self'
op|','
name|'bucket'
op|'='
name|'None'
op|','
name|'prefix'
op|'='
name|'None'
op|','
name|'key_file'
op|'='
name|'None'
op|','
name|'cert_file'
op|'='
name|'None'
op|','
nl|'\n'
name|'size'
op|'='
name|'None'
op|','
name|'ssh_key'
op|'='
name|'None'
op|','
name|'fp'
op|'='
name|'None'
op|','
name|'clear_history'
op|'='
name|'True'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'iobject'
op|'='
name|'IObject'
op|'('
op|')'
newline|'\n'
name|'if'
name|'not'
name|'bucket'
op|':'
newline|'\n'
indent|'            '
name|'bucket'
op|'='
name|'iobject'
op|'.'
name|'get_string'
op|'('
string|"'Name of S3 bucket'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'prefix'
op|':'
newline|'\n'
indent|'            '
name|'prefix'
op|'='
name|'iobject'
op|'.'
name|'get_string'
op|'('
string|"'Prefix for AMI file'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'key_file'
op|':'
newline|'\n'
indent|'            '
name|'key_file'
op|'='
name|'iobject'
op|'.'
name|'get_filename'
op|'('
string|"'Path to RSA private key file'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'cert_file'
op|':'
newline|'\n'
indent|'            '
name|'cert_file'
op|'='
name|'iobject'
op|'.'
name|'get_filename'
op|'('
string|"'Path to RSA public cert file'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'size'
op|':'
newline|'\n'
indent|'            '
name|'size'
op|'='
name|'iobject'
op|'.'
name|'get_int'
op|'('
string|"'Size (in MB) of bundled image'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'ssh_key'
op|':'
newline|'\n'
indent|'            '
name|'ssh_key'
op|'='
name|'self'
op|'.'
name|'server'
op|'.'
name|'get_ssh_key_file'
op|'('
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'copy_x509'
op|'('
name|'key_file'
op|','
name|'cert_file'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'fp'
op|':'
newline|'\n'
indent|'            '
name|'fp'
op|'='
name|'StringIO'
op|'.'
name|'StringIO'
op|'('
op|')'
newline|'\n'
dedent|''
name|'fp'
op|'.'
name|'write'
op|'('
string|"'sudo mv %s /mnt/boto.cfg; '"
op|'%'
name|'BotoConfigPath'
op|')'
newline|'\n'
name|'fp'
op|'.'
name|'write'
op|'('
string|"'mv ~/.ssh/authorized_keys /mnt/authorized_keys; '"
op|')'
newline|'\n'
name|'if'
name|'clear_history'
op|':'
newline|'\n'
indent|'            '
name|'fp'
op|'.'
name|'write'
op|'('
string|"'history -c; '"
op|')'
newline|'\n'
dedent|''
name|'fp'
op|'.'
name|'write'
op|'('
name|'self'
op|'.'
name|'bundle_image'
op|'('
name|'prefix'
op|','
name|'size'
op|','
name|'ssh_key'
op|')'
op|')'
newline|'\n'
name|'fp'
op|'.'
name|'write'
op|'('
string|"'; '"
op|')'
newline|'\n'
name|'fp'
op|'.'
name|'write'
op|'('
name|'self'
op|'.'
name|'upload_bundle'
op|'('
name|'bucket'
op|','
name|'prefix'
op|','
name|'ssh_key'
op|')'
op|')'
newline|'\n'
name|'fp'
op|'.'
name|'write'
op|'('
string|"'; '"
op|')'
newline|'\n'
name|'fp'
op|'.'
name|'write'
op|'('
string|"'sudo mv /mnt/boto.cfg %s; '"
op|'%'
name|'BotoConfigPath'
op|')'
newline|'\n'
name|'fp'
op|'.'
name|'write'
op|'('
string|"'mv /mnt/authorized_keys ~/.ssh/authorized_keys'"
op|')'
newline|'\n'
name|'command'
op|'='
name|'fp'
op|'.'
name|'getvalue'
op|'('
op|')'
newline|'\n'
name|'print'
string|"'running the following command on the remote server:'"
newline|'\n'
name|'print'
name|'command'
newline|'\n'
name|'t'
op|'='
name|'self'
op|'.'
name|'ssh_client'
op|'.'
name|'run'
op|'('
name|'command'
op|')'
newline|'\n'
name|'print'
string|"'\\t%s'"
op|'%'
name|'t'
op|'['
number|'0'
op|']'
newline|'\n'
name|'print'
string|"'\\t%s'"
op|'%'
name|'t'
op|'['
number|'1'
op|']'
newline|'\n'
name|'print'
string|"'...complete!'"
newline|'\n'
name|'print'
string|"'registering image...'"
newline|'\n'
name|'self'
op|'.'
name|'image_id'
op|'='
name|'self'
op|'.'
name|'server'
op|'.'
name|'ec2'
op|'.'
name|'register_image'
op|'('
name|'name'
op|'='
name|'prefix'
op|','
name|'image_location'
op|'='
string|"'%s/%s.manifest.xml'"
op|'%'
op|'('
name|'bucket'
op|','
name|'prefix'
op|')'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'image_id'
newline|'\n'
nl|'\n'
DECL|class|CommandLineGetter
dedent|''
dedent|''
name|'class'
name|'CommandLineGetter'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|get_ami_list
indent|'    '
name|'def'
name|'get_ami_list'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'my_amis'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'ami'
name|'in'
name|'self'
op|'.'
name|'ec2'
op|'.'
name|'get_all_images'
op|'('
op|')'
op|':'
newline|'\n'
comment|'# hack alert, need a better way to do this!'
nl|'\n'
indent|'            '
name|'if'
name|'ami'
op|'.'
name|'location'
op|'.'
name|'find'
op|'('
string|"'pyami'"
op|')'
op|'>='
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'my_amis'
op|'.'
name|'append'
op|'('
op|'('
name|'ami'
op|'.'
name|'location'
op|','
name|'ami'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'my_amis'
newline|'\n'
nl|'\n'
DECL|member|get_region
dedent|''
name|'def'
name|'get_region'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'region'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'region'"
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'region'
op|','
name|'str'
op|')'
name|'or'
name|'isinstance'
op|'('
name|'region'
op|','
name|'unicode'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'region'
op|'='
name|'boto'
op|'.'
name|'ec2'
op|'.'
name|'get_region'
op|'('
name|'region'
op|')'
newline|'\n'
name|'params'
op|'['
string|"'region'"
op|']'
op|'='
name|'region'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'region'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'self'
op|'.'
name|'cls'
op|'.'
name|'find_property'
op|'('
string|"'region_name'"
op|')'
newline|'\n'
name|'params'
op|'['
string|"'region'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|','
name|'choices'
op|'='
name|'boto'
op|'.'
name|'ec2'
op|'.'
name|'regions'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_name
dedent|''
dedent|''
name|'def'
name|'get_name'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'params'
op|'.'
name|'get'
op|'('
string|"'name'"
op|','
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'self'
op|'.'
name|'cls'
op|'.'
name|'find_property'
op|'('
string|"'name'"
op|')'
newline|'\n'
name|'params'
op|'['
string|"'name'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_description
dedent|''
dedent|''
name|'def'
name|'get_description'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'params'
op|'.'
name|'get'
op|'('
string|"'description'"
op|','
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'self'
op|'.'
name|'cls'
op|'.'
name|'find_property'
op|'('
string|"'description'"
op|')'
newline|'\n'
name|'params'
op|'['
string|"'description'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_instance_type
dedent|''
dedent|''
name|'def'
name|'get_instance_type'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'params'
op|'.'
name|'get'
op|'('
string|"'instance_type'"
op|','
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'StringProperty'
op|'('
name|'name'
op|'='
string|"'instance_type'"
op|','
name|'verbose_name'
op|'='
string|"'Instance Type'"
op|','
nl|'\n'
name|'choices'
op|'='
name|'InstanceTypes'
op|')'
newline|'\n'
name|'params'
op|'['
string|"'instance_type'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_quantity
dedent|''
dedent|''
name|'def'
name|'get_quantity'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'params'
op|'.'
name|'get'
op|'('
string|"'quantity'"
op|','
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'IntegerProperty'
op|'('
name|'name'
op|'='
string|"'quantity'"
op|','
name|'verbose_name'
op|'='
string|"'Number of Instances'"
op|')'
newline|'\n'
name|'params'
op|'['
string|"'quantity'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_zone
dedent|''
dedent|''
name|'def'
name|'get_zone'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'params'
op|'.'
name|'get'
op|'('
string|"'zone'"
op|','
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'StringProperty'
op|'('
name|'name'
op|'='
string|"'zone'"
op|','
name|'verbose_name'
op|'='
string|"'EC2 Availability Zone'"
op|','
nl|'\n'
name|'choices'
op|'='
name|'self'
op|'.'
name|'ec2'
op|'.'
name|'get_all_zones'
op|')'
newline|'\n'
name|'params'
op|'['
string|"'zone'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_ami_id
dedent|''
dedent|''
name|'def'
name|'get_ami_id'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ami'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'ami'"
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'ami'
op|','
name|'str'
op|')'
name|'or'
name|'isinstance'
op|'('
name|'ami'
op|','
name|'unicode'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'a'
name|'in'
name|'self'
op|'.'
name|'ec2'
op|'.'
name|'get_all_images'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'a'
op|'.'
name|'id'
op|'=='
name|'ami'
op|':'
newline|'\n'
indent|'                    '
name|'params'
op|'['
string|"'ami'"
op|']'
op|'='
name|'a'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'not'
name|'params'
op|'.'
name|'get'
op|'('
string|"'ami'"
op|','
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'StringProperty'
op|'('
name|'name'
op|'='
string|"'ami'"
op|','
name|'verbose_name'
op|'='
string|"'AMI'"
op|','
nl|'\n'
name|'choices'
op|'='
name|'self'
op|'.'
name|'get_ami_list'
op|')'
newline|'\n'
name|'params'
op|'['
string|"'ami'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_group
dedent|''
dedent|''
name|'def'
name|'get_group'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'group'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'group'"
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'group'
op|','
name|'str'
op|')'
name|'or'
name|'isinstance'
op|'('
name|'group'
op|','
name|'unicode'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'group_list'
op|'='
name|'self'
op|'.'
name|'ec2'
op|'.'
name|'get_all_security_groups'
op|'('
op|')'
newline|'\n'
name|'for'
name|'g'
name|'in'
name|'group_list'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'g'
op|'.'
name|'name'
op|'=='
name|'group'
op|':'
newline|'\n'
indent|'                    '
name|'group'
op|'='
name|'g'
newline|'\n'
name|'params'
op|'['
string|"'group'"
op|']'
op|'='
name|'g'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'not'
name|'group'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'StringProperty'
op|'('
name|'name'
op|'='
string|"'group'"
op|','
name|'verbose_name'
op|'='
string|"'EC2 Security Group'"
op|','
nl|'\n'
name|'choices'
op|'='
name|'self'
op|'.'
name|'ec2'
op|'.'
name|'get_all_security_groups'
op|')'
newline|'\n'
name|'params'
op|'['
string|"'group'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_key
dedent|''
dedent|''
name|'def'
name|'get_key'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'keypair'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'keypair'"
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'keypair'
op|','
name|'str'
op|')'
name|'or'
name|'isinstance'
op|'('
name|'keypair'
op|','
name|'unicode'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'key_list'
op|'='
name|'self'
op|'.'
name|'ec2'
op|'.'
name|'get_all_key_pairs'
op|'('
op|')'
newline|'\n'
name|'for'
name|'k'
name|'in'
name|'key_list'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'k'
op|'.'
name|'name'
op|'=='
name|'keypair'
op|':'
newline|'\n'
indent|'                    '
name|'keypair'
op|'='
name|'k'
op|'.'
name|'name'
newline|'\n'
name|'params'
op|'['
string|"'keypair'"
op|']'
op|'='
name|'k'
op|'.'
name|'name'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'not'
name|'keypair'
op|':'
newline|'\n'
indent|'            '
name|'prop'
op|'='
name|'StringProperty'
op|'('
name|'name'
op|'='
string|"'keypair'"
op|','
name|'verbose_name'
op|'='
string|"'EC2 KeyPair'"
op|','
nl|'\n'
name|'choices'
op|'='
name|'self'
op|'.'
name|'ec2'
op|'.'
name|'get_all_key_pairs'
op|')'
newline|'\n'
name|'params'
op|'['
string|"'keypair'"
op|']'
op|'='
name|'propget'
op|'.'
name|'get'
op|'('
name|'prop'
op|')'
op|'.'
name|'name'
newline|'\n'
nl|'\n'
DECL|member|get
dedent|''
dedent|''
name|'def'
name|'get'
op|'('
name|'self'
op|','
name|'cls'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cls'
op|'='
name|'cls'
newline|'\n'
name|'self'
op|'.'
name|'get_region'
op|'('
name|'params'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'ec2'
op|'='
name|'params'
op|'['
string|"'region'"
op|']'
op|'.'
name|'connect'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'get_name'
op|'('
name|'params'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'get_description'
op|'('
name|'params'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'get_instance_type'
op|'('
name|'params'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'get_zone'
op|'('
name|'params'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'get_quantity'
op|'('
name|'params'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'get_ami_id'
op|'('
name|'params'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'get_group'
op|'('
name|'params'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'get_key'
op|'('
name|'params'
op|')'
newline|'\n'
nl|'\n'
DECL|class|Server
dedent|''
dedent|''
name|'class'
name|'Server'
op|'('
name|'Model'
op|')'
op|':'
newline|'\n'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# The properties of this object consists of real properties for data that'
nl|'\n'
comment|'# is not already stored in EC2 somewhere (e.g. name, description) plus'
nl|'\n'
comment|'# calculated properties for all of the properties that are already in'
nl|'\n'
comment|'# EC2 (e.g. hostname, security groups, etc.)'
nl|'\n'
comment|'#'
nl|'\n'
DECL|variable|name
indent|'    '
name|'name'
op|'='
name|'StringProperty'
op|'('
name|'unique'
op|'='
name|'True'
op|','
name|'verbose_name'
op|'='
string|'"Name"'
op|')'
newline|'\n'
DECL|variable|description
name|'description'
op|'='
name|'StringProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Description"'
op|')'
newline|'\n'
DECL|variable|region_name
name|'region_name'
op|'='
name|'StringProperty'
op|'('
name|'verbose_name'
op|'='
string|'"EC2 Region Name"'
op|')'
newline|'\n'
DECL|variable|instance_id
name|'instance_id'
op|'='
name|'StringProperty'
op|'('
name|'verbose_name'
op|'='
string|'"EC2 Instance ID"'
op|')'
newline|'\n'
DECL|variable|elastic_ip
name|'elastic_ip'
op|'='
name|'StringProperty'
op|'('
name|'verbose_name'
op|'='
string|'"EC2 Elastic IP Address"'
op|')'
newline|'\n'
DECL|variable|production
name|'production'
op|'='
name|'BooleanProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Is This Server Production"'
op|','
name|'default'
op|'='
name|'False'
op|')'
newline|'\n'
DECL|variable|ami_id
name|'ami_id'
op|'='
name|'CalculatedProperty'
op|'('
name|'verbose_name'
op|'='
string|'"AMI ID"'
op|','
name|'calculated_type'
op|'='
name|'str'
op|','
name|'use_method'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|zone
name|'zone'
op|'='
name|'CalculatedProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Availability Zone Name"'
op|','
name|'calculated_type'
op|'='
name|'str'
op|','
name|'use_method'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|hostname
name|'hostname'
op|'='
name|'CalculatedProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Public DNS Name"'
op|','
name|'calculated_type'
op|'='
name|'str'
op|','
name|'use_method'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|private_hostname
name|'private_hostname'
op|'='
name|'CalculatedProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Private DNS Name"'
op|','
name|'calculated_type'
op|'='
name|'str'
op|','
name|'use_method'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|groups
name|'groups'
op|'='
name|'CalculatedProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Security Groups"'
op|','
name|'calculated_type'
op|'='
name|'list'
op|','
name|'use_method'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|security_group
name|'security_group'
op|'='
name|'CalculatedProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Primary Security Group Name"'
op|','
name|'calculated_type'
op|'='
name|'str'
op|','
name|'use_method'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|key_name
name|'key_name'
op|'='
name|'CalculatedProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Key Name"'
op|','
name|'calculated_type'
op|'='
name|'str'
op|','
name|'use_method'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|instance_type
name|'instance_type'
op|'='
name|'CalculatedProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Instance Type"'
op|','
name|'calculated_type'
op|'='
name|'str'
op|','
name|'use_method'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|status
name|'status'
op|'='
name|'CalculatedProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Current Status"'
op|','
name|'calculated_type'
op|'='
name|'str'
op|','
name|'use_method'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|launch_time
name|'launch_time'
op|'='
name|'CalculatedProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Server Launch Time"'
op|','
name|'calculated_type'
op|'='
name|'str'
op|','
name|'use_method'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|console_output
name|'console_output'
op|'='
name|'CalculatedProperty'
op|'('
name|'verbose_name'
op|'='
string|'"Console Output"'
op|','
name|'calculated_type'
op|'='
name|'file'
op|','
name|'use_method'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|packages
name|'packages'
op|'='
op|'['
op|']'
newline|'\n'
DECL|variable|plugins
name|'plugins'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|add_credentials
name|'def'
name|'add_credentials'
op|'('
name|'cls'
op|','
name|'cfg'
op|','
name|'aws_access_key_id'
op|','
name|'aws_secret_access_key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'cfg'
op|'.'
name|'has_section'
op|'('
string|"'Credentials'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'cfg'
op|'.'
name|'add_section'
op|'('
string|"'Credentials'"
op|')'
newline|'\n'
dedent|''
name|'cfg'
op|'.'
name|'set'
op|'('
string|"'Credentials'"
op|','
string|"'aws_access_key_id'"
op|','
name|'aws_access_key_id'
op|')'
newline|'\n'
name|'cfg'
op|'.'
name|'set'
op|'('
string|"'Credentials'"
op|','
string|"'aws_secret_access_key'"
op|','
name|'aws_secret_access_key'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'cfg'
op|'.'
name|'has_section'
op|'('
string|"'DB_Server'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'cfg'
op|'.'
name|'add_section'
op|'('
string|"'DB_Server'"
op|')'
newline|'\n'
dedent|''
name|'cfg'
op|'.'
name|'set'
op|'('
string|"'DB_Server'"
op|','
string|"'db_type'"
op|','
string|"'SimpleDB'"
op|')'
newline|'\n'
name|'cfg'
op|'.'
name|'set'
op|'('
string|"'DB_Server'"
op|','
string|"'db_name'"
op|','
name|'cls'
op|'.'
name|'_manager'
op|'.'
name|'domain'
op|'.'
name|'name'
op|')'
newline|'\n'
nl|'\n'
dedent|''
string|"'''\n    Create a new instance based on the specified configuration file or the specified\n    configuration and the passed in parameters.\n    \n    If the config_file argument is not None, the configuration is read from there. \n    Otherwise, the cfg argument is used.\n\n    The config file may include other config files with a #import reference. The included\n    config files must reside in the same directory as the specified file. \n    \n    The logical_volume argument, if supplied, will be used to get the current physical \n    volume ID and use that as an override of the value specified in the config file. This \n    may be useful for debugging purposes when you want to debug with a production config \n    file but a test Volume. \n    \n    The dictionary argument may be used to override any EC2 configuration values in the \n    config file. \n    '''"
newline|'\n'
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|create
name|'def'
name|'create'
op|'('
name|'cls'
op|','
name|'config_file'
op|'='
name|'None'
op|','
name|'logical_volume'
op|'='
name|'None'
op|','
name|'cfg'
op|'='
name|'None'
op|','
op|'**'
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'config_file'
op|':'
newline|'\n'
indent|'            '
name|'cfg'
op|'='
name|'Config'
op|'('
name|'path'
op|'='
name|'config_file'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'cfg'
op|'.'
name|'has_section'
op|'('
string|"'EC2'"
op|')'
op|':'
newline|'\n'
comment|"# include any EC2 configuration values that aren't specified in params:"
nl|'\n'
indent|'            '
name|'for'
name|'option'
name|'in'
name|'cfg'
op|'.'
name|'options'
op|'('
string|"'EC2'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'option'
name|'not'
name|'in'
name|'params'
op|':'
newline|'\n'
indent|'                    '
name|'params'
op|'['
name|'option'
op|']'
op|'='
name|'cfg'
op|'.'
name|'get'
op|'('
string|"'EC2'"
op|','
name|'option'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'getter'
op|'='
name|'CommandLineGetter'
op|'('
op|')'
newline|'\n'
name|'getter'
op|'.'
name|'get'
op|'('
name|'cls'
op|','
name|'params'
op|')'
newline|'\n'
name|'region'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'region'"
op|')'
newline|'\n'
name|'ec2'
op|'='
name|'region'
op|'.'
name|'connect'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'add_credentials'
op|'('
name|'cfg'
op|','
name|'ec2'
op|'.'
name|'aws_access_key_id'
op|','
name|'ec2'
op|'.'
name|'aws_secret_access_key'
op|')'
newline|'\n'
name|'ami'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'ami'"
op|')'
newline|'\n'
name|'kp'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'keypair'"
op|')'
newline|'\n'
name|'group'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'group'"
op|')'
newline|'\n'
name|'zone'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'zone'"
op|')'
newline|'\n'
comment|'# deal with possibly passed in logical volume:'
nl|'\n'
name|'if'
name|'logical_volume'
op|'!='
name|'None'
op|':'
newline|'\n'
indent|'           '
name|'cfg'
op|'.'
name|'set'
op|'('
string|"'EBS'"
op|','
string|"'logical_volume_name'"
op|','
name|'logical_volume'
op|'.'
name|'name'
op|')'
newline|'\n'
dedent|''
name|'cfg_fp'
op|'='
name|'StringIO'
op|'.'
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'cfg'
op|'.'
name|'write'
op|'('
name|'cfg_fp'
op|')'
newline|'\n'
comment|'# deal with the possibility that zone and/or keypair are strings read from the config file:'
nl|'\n'
name|'if'
name|'isinstance'
op|'('
name|'zone'
op|','
name|'Zone'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'zone'
op|'='
name|'zone'
op|'.'
name|'name'
newline|'\n'
dedent|''
name|'if'
name|'isinstance'
op|'('
name|'kp'
op|','
name|'KeyPair'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'kp'
op|'='
name|'kp'
op|'.'
name|'name'
newline|'\n'
dedent|''
name|'reservation'
op|'='
name|'ami'
op|'.'
name|'run'
op|'('
name|'min_count'
op|'='
number|'1'
op|','
nl|'\n'
name|'max_count'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'quantity'"
op|','
number|'1'
op|')'
op|','
nl|'\n'
name|'key_name'
op|'='
name|'kp'
op|','
nl|'\n'
name|'security_groups'
op|'='
op|'['
name|'group'
op|']'
op|','
nl|'\n'
name|'instance_type'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'instance_type'"
op|')'
op|','
nl|'\n'
name|'placement'
op|'='
name|'zone'
op|','
nl|'\n'
name|'user_data'
op|'='
name|'cfg_fp'
op|'.'
name|'getvalue'
op|'('
op|')'
op|')'
newline|'\n'
name|'l'
op|'='
op|'['
op|']'
newline|'\n'
name|'i'
op|'='
number|'0'
newline|'\n'
name|'elastic_ip'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'elastic_ip'"
op|')'
newline|'\n'
name|'instances'
op|'='
name|'reservation'
op|'.'
name|'instances'
newline|'\n'
name|'if'
name|'elastic_ip'
op|'!='
name|'None'
name|'and'
name|'instances'
op|'.'
name|'__len__'
op|'('
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'instance'
op|'='
name|'instances'
op|'['
number|'0'
op|']'
newline|'\n'
name|'print'
string|"'Waiting for instance to start so we can set its elastic IP address...'"
newline|'\n'
name|'while'
name|'instance'
op|'.'
name|'update'
op|'('
op|')'
op|'!='
string|"'running'"
op|':'
newline|'\n'
indent|'                '
name|'time'
op|'.'
name|'sleep'
op|'('
number|'1'
op|')'
newline|'\n'
dedent|''
name|'instance'
op|'.'
name|'use_ip'
op|'('
name|'elastic_ip'
op|')'
newline|'\n'
name|'print'
string|"'set the elastic IP of the first instance to %s'"
op|'%'
name|'elastic_ip'
newline|'\n'
dedent|''
name|'for'
name|'instance'
name|'in'
name|'instances'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'='
name|'cls'
op|'('
op|')'
newline|'\n'
name|'s'
op|'.'
name|'ec2'
op|'='
name|'ec2'
newline|'\n'
name|'s'
op|'.'
name|'name'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'name'"
op|')'
op|'+'
string|"''"
name|'if'
name|'i'
op|'=='
number|'0'
name|'else'
name|'str'
op|'('
name|'i'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'description'
op|'='
name|'params'
op|'.'
name|'get'
op|'('
string|"'description'"
op|')'
newline|'\n'
name|'s'
op|'.'
name|'region_name'
op|'='
name|'region'
op|'.'
name|'name'
newline|'\n'
name|'s'
op|'.'
name|'instance_id'
op|'='
name|'instance'
op|'.'
name|'id'
newline|'\n'
name|'if'
name|'elastic_ip'
name|'and'
name|'i'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'s'
op|'.'
name|'elastic_ip'
op|'='
name|'elastic_ip'
newline|'\n'
dedent|''
name|'s'
op|'.'
name|'put'
op|'('
op|')'
newline|'\n'
name|'l'
op|'.'
name|'append'
op|'('
name|'s'
op|')'
newline|'\n'
name|'i'
op|'+='
number|'1'
newline|'\n'
dedent|''
name|'return'
name|'l'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|create_from_instance_id
name|'def'
name|'create_from_instance_id'
op|'('
name|'cls'
op|','
name|'instance_id'
op|','
name|'name'
op|','
name|'description'
op|'='
string|"''"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'regions'
op|'='
name|'boto'
op|'.'
name|'ec2'
op|'.'
name|'regions'
op|'('
op|')'
newline|'\n'
name|'for'
name|'region'
name|'in'
name|'regions'
op|':'
newline|'\n'
indent|'            '
name|'ec2'
op|'='
name|'region'
op|'.'
name|'connect'
op|'('
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'rs'
op|'='
name|'ec2'
op|'.'
name|'get_all_instances'
op|'('
op|'['
name|'instance_id'
op|']'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'                '
name|'rs'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'rs'
op|')'
op|'=='
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'s'
op|'='
name|'cls'
op|'('
op|')'
newline|'\n'
name|'s'
op|'.'
name|'ec2'
op|'='
name|'ec2'
newline|'\n'
name|'s'
op|'.'
name|'name'
op|'='
name|'name'
newline|'\n'
name|'s'
op|'.'
name|'description'
op|'='
name|'description'
newline|'\n'
name|'s'
op|'.'
name|'region_name'
op|'='
name|'region'
op|'.'
name|'name'
newline|'\n'
name|'s'
op|'.'
name|'instance_id'
op|'='
name|'instance_id'
newline|'\n'
name|'s'
op|'.'
name|'_reservation'
op|'='
name|'rs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'for'
name|'instance'
name|'in'
name|'s'
op|'.'
name|'_reservation'
op|'.'
name|'instances'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'instance'
op|'.'
name|'id'
op|'=='
name|'instance_id'
op|':'
newline|'\n'
indent|'                        '
name|'s'
op|'.'
name|'_instance'
op|'='
name|'instance'
newline|'\n'
dedent|''
dedent|''
name|'s'
op|'.'
name|'put'
op|'('
op|')'
newline|'\n'
name|'return'
name|'s'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'None'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|create_from_current_instances
name|'def'
name|'create_from_current_instances'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'servers'
op|'='
op|'['
op|']'
newline|'\n'
name|'regions'
op|'='
name|'boto'
op|'.'
name|'ec2'
op|'.'
name|'regions'
op|'('
op|')'
newline|'\n'
name|'for'
name|'region'
name|'in'
name|'regions'
op|':'
newline|'\n'
indent|'            '
name|'ec2'
op|'='
name|'region'
op|'.'
name|'connect'
op|'('
op|')'
newline|'\n'
name|'rs'
op|'='
name|'ec2'
op|'.'
name|'get_all_instances'
op|'('
op|')'
newline|'\n'
name|'for'
name|'reservation'
name|'in'
name|'rs'
op|':'
newline|'\n'
indent|'                '
name|'for'
name|'instance'
name|'in'
name|'reservation'
op|'.'
name|'instances'
op|':'
newline|'\n'
indent|'                    '
name|'try'
op|':'
newline|'\n'
indent|'                        '
name|'Server'
op|'.'
name|'find'
op|'('
name|'instance_id'
op|'='
name|'instance'
op|'.'
name|'id'
op|')'
op|'.'
name|'next'
op|'('
op|')'
newline|'\n'
name|'boto'
op|'.'
name|'log'
op|'.'
name|'info'
op|'('
string|"'Server for %s already exists'"
op|'%'
name|'instance'
op|'.'
name|'id'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'StopIteration'
op|':'
newline|'\n'
indent|'                        '
name|'s'
op|'='
name|'cls'
op|'('
op|')'
newline|'\n'
name|'s'
op|'.'
name|'ec2'
op|'='
name|'ec2'
newline|'\n'
name|'s'
op|'.'
name|'name'
op|'='
name|'instance'
op|'.'
name|'id'
newline|'\n'
name|'s'
op|'.'
name|'region_name'
op|'='
name|'region'
op|'.'
name|'name'
newline|'\n'
name|'s'
op|'.'
name|'instance_id'
op|'='
name|'instance'
op|'.'
name|'id'
newline|'\n'
name|'s'
op|'.'
name|'_reservation'
op|'='
name|'reservation'
newline|'\n'
name|'s'
op|'.'
name|'put'
op|'('
op|')'
newline|'\n'
name|'servers'
op|'.'
name|'append'
op|'('
name|'s'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
dedent|''
name|'return'
name|'servers'
newline|'\n'
nl|'\n'
DECL|member|__init__
dedent|''
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'id'
op|'='
name|'None'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'Model'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
name|'id'
op|','
op|'**'
name|'kw'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'ssh_key_file'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'ec2'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'_cmdshell'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'_reservation'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'_instance'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'_setup_ec2'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_setup_ec2
dedent|''
name|'def'
name|'_setup_ec2'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'ec2'
name|'and'
name|'self'
op|'.'
name|'_instance'
name|'and'
name|'self'
op|'.'
name|'_reservation'
op|':'
newline|'\n'
indent|'            '
name|'return'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'id'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'region_name'
op|':'
newline|'\n'
indent|'                '
name|'for'
name|'region'
name|'in'
name|'boto'
op|'.'
name|'ec2'
op|'.'
name|'regions'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'region'
op|'.'
name|'name'
op|'=='
name|'self'
op|'.'
name|'region_name'
op|':'
newline|'\n'
indent|'                        '
name|'self'
op|'.'
name|'ec2'
op|'='
name|'region'
op|'.'
name|'connect'
op|'('
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'instance_id'
name|'and'
name|'not'
name|'self'
op|'.'
name|'_instance'
op|':'
newline|'\n'
indent|'                            '
name|'try'
op|':'
newline|'\n'
indent|'                                '
name|'rs'
op|'='
name|'self'
op|'.'
name|'ec2'
op|'.'
name|'get_all_instances'
op|'('
op|'['
name|'self'
op|'.'
name|'instance_id'
op|']'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'rs'
op|')'
op|'>='
number|'1'
op|':'
newline|'\n'
indent|'                                    '
name|'for'
name|'instance'
name|'in'
name|'rs'
op|'['
number|'0'
op|']'
op|'.'
name|'instances'
op|':'
newline|'\n'
indent|'                                        '
name|'if'
name|'instance'
op|'.'
name|'id'
op|'=='
name|'self'
op|'.'
name|'instance_id'
op|':'
newline|'\n'
indent|'                                            '
name|'self'
op|'.'
name|'_reservation'
op|'='
name|'rs'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_instance'
op|'='
name|'instance'
newline|'\n'
dedent|''
dedent|''
dedent|''
dedent|''
name|'except'
name|'EC2ResponseError'
op|':'
newline|'\n'
indent|'                                '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|_status
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'_status'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'status'
op|'='
string|"''"
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_instance'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'update'
op|'('
op|')'
newline|'\n'
name|'status'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'state'
newline|'\n'
dedent|''
name|'return'
name|'status'
newline|'\n'
nl|'\n'
DECL|member|_hostname
dedent|''
name|'def'
name|'_hostname'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'hostname'
op|'='
string|"''"
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_instance'
op|':'
newline|'\n'
indent|'            '
name|'hostname'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'public_dns_name'
newline|'\n'
dedent|''
name|'return'
name|'hostname'
newline|'\n'
nl|'\n'
DECL|member|_private_hostname
dedent|''
name|'def'
name|'_private_hostname'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'hostname'
op|'='
string|"''"
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_instance'
op|':'
newline|'\n'
indent|'            '
name|'hostname'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'private_dns_name'
newline|'\n'
dedent|''
name|'return'
name|'hostname'
newline|'\n'
nl|'\n'
DECL|member|_instance_type
dedent|''
name|'def'
name|'_instance_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'it'
op|'='
string|"''"
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_instance'
op|':'
newline|'\n'
indent|'            '
name|'it'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'instance_type'
newline|'\n'
dedent|''
name|'return'
name|'it'
newline|'\n'
nl|'\n'
DECL|member|_launch_time
dedent|''
name|'def'
name|'_launch_time'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'lt'
op|'='
string|"''"
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_instance'
op|':'
newline|'\n'
indent|'            '
name|'lt'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'launch_time'
newline|'\n'
dedent|''
name|'return'
name|'lt'
newline|'\n'
nl|'\n'
DECL|member|_console_output
dedent|''
name|'def'
name|'_console_output'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'co'
op|'='
string|"''"
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_instance'
op|':'
newline|'\n'
indent|'            '
name|'co'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'get_console_output'
op|'('
op|')'
newline|'\n'
dedent|''
name|'return'
name|'co'
newline|'\n'
nl|'\n'
DECL|member|_groups
dedent|''
name|'def'
name|'_groups'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'gn'
op|'='
op|'['
op|']'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_reservation'
op|':'
newline|'\n'
indent|'            '
name|'gn'
op|'='
name|'self'
op|'.'
name|'_reservation'
op|'.'
name|'groups'
newline|'\n'
dedent|''
name|'return'
name|'gn'
newline|'\n'
nl|'\n'
DECL|member|_security_group
dedent|''
name|'def'
name|'_security_group'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'groups'
op|'='
name|'self'
op|'.'
name|'_groups'
op|'('
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'groups'
op|')'
op|'>='
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'groups'
op|'['
number|'0'
op|']'
op|'.'
name|'id'
newline|'\n'
dedent|''
name|'return'
string|'""'
newline|'\n'
nl|'\n'
DECL|member|_zone
dedent|''
name|'def'
name|'_zone'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'zone'
op|'='
name|'None'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_instance'
op|':'
newline|'\n'
indent|'            '
name|'zone'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'placement'
newline|'\n'
dedent|''
name|'return'
name|'zone'
newline|'\n'
nl|'\n'
DECL|member|_key_name
dedent|''
name|'def'
name|'_key_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'kn'
op|'='
name|'None'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_instance'
op|':'
newline|'\n'
indent|'            '
name|'kn'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'key_name'
newline|'\n'
dedent|''
name|'return'
name|'kn'
newline|'\n'
nl|'\n'
DECL|member|put
dedent|''
name|'def'
name|'put'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'Model'
op|'.'
name|'put'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_setup_ec2'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|delete
dedent|''
name|'def'
name|'delete'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'production'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ValueError'
op|','
string|'"Can\'t delete a production server"'
newline|'\n'
comment|'#self.stop()'
nl|'\n'
dedent|''
name|'Model'
op|'.'
name|'delete'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|stop
dedent|''
name|'def'
name|'stop'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'production'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ValueError'
op|','
string|'"Can\'t delete a production server"'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'_instance'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'stop'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|terminate
dedent|''
dedent|''
name|'def'
name|'terminate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'production'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'ValueError'
op|','
string|'"Can\'t delete a production server"'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'_instance'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'terminate'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|reboot
dedent|''
dedent|''
name|'def'
name|'reboot'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'_instance'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'reboot'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|wait
dedent|''
dedent|''
name|'def'
name|'wait'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'while'
name|'self'
op|'.'
name|'status'
op|'!='
string|"'running'"
op|':'
newline|'\n'
indent|'            '
name|'time'
op|'.'
name|'sleep'
op|'('
number|'5'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_ssh_key_file
dedent|''
dedent|''
name|'def'
name|'get_ssh_key_file'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'ssh_key_file'
op|':'
newline|'\n'
indent|'            '
name|'ssh_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'expanduser'
op|'('
string|"'~/.ssh'"
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'ssh_dir'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'ssh_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'ssh_dir'
op|','
string|"'%s.pem'"
op|'%'
name|'self'
op|'.'
name|'key_name'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'ssh_file'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'ssh_key_file'
op|'='
name|'ssh_file'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'not'
name|'self'
op|'.'
name|'ssh_key_file'
op|':'
newline|'\n'
indent|'                '
name|'iobject'
op|'='
name|'IObject'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'ssh_key_file'
op|'='
name|'iobject'
op|'.'
name|'get_filename'
op|'('
string|"'Path to OpenSSH Key file'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'self'
op|'.'
name|'ssh_key_file'
newline|'\n'
nl|'\n'
DECL|member|get_cmdshell
dedent|''
name|'def'
name|'get_cmdshell'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'_cmdshell'
op|':'
newline|'\n'
indent|'            '
name|'import'
name|'cmdshell'
newline|'\n'
name|'self'
op|'.'
name|'get_ssh_key_file'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_cmdshell'
op|'='
name|'cmdshell'
op|'.'
name|'start'
op|'('
name|'self'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'_cmdshell'
newline|'\n'
nl|'\n'
DECL|member|reset_cmdshell
dedent|''
name|'def'
name|'reset_cmdshell'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_cmdshell'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|run
dedent|''
name|'def'
name|'run'
op|'('
name|'self'
op|','
name|'command'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'closing'
op|'('
name|'self'
op|'.'
name|'get_cmdshell'
op|'('
op|')'
op|')'
name|'as'
name|'cmd'
op|':'
newline|'\n'
indent|'            '
name|'status'
op|'='
name|'cmd'
op|'.'
name|'run'
op|'('
name|'command'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'status'
newline|'\n'
nl|'\n'
DECL|member|get_bundler
dedent|''
name|'def'
name|'get_bundler'
op|'('
name|'self'
op|','
name|'uname'
op|'='
string|"'root'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'get_ssh_key_file'
op|'('
op|')'
newline|'\n'
name|'return'
name|'Bundler'
op|'('
name|'self'
op|','
name|'uname'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_ssh_client
dedent|''
name|'def'
name|'get_ssh_client'
op|'('
name|'self'
op|','
name|'uname'
op|'='
string|"'root'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'from'
name|'boto'
op|'.'
name|'manage'
op|'.'
name|'cmdshell'
name|'import'
name|'SSHClient'
newline|'\n'
name|'self'
op|'.'
name|'get_ssh_key_file'
op|'('
op|')'
newline|'\n'
name|'return'
name|'SSHClient'
op|'('
name|'self'
op|','
name|'uname'
op|'='
name|'uname'
op|')'
newline|'\n'
nl|'\n'
DECL|member|install
dedent|''
name|'def'
name|'install'
op|'('
name|'self'
op|','
name|'pkg'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'run'
op|'('
string|"'apt-get -y install %s'"
op|'%'
name|'pkg'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
