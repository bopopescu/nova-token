begin_unit
name|'import'
name|'SocketServer'
op|','
name|'os'
op|','
name|'datetime'
op|','
name|'sys'
op|','
name|'random'
op|','
name|'time'
newline|'\n'
name|'import'
name|'simplejson'
newline|'\n'
nl|'\n'
DECL|class|LQSCommand
name|'class'
name|'LQSCommand'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'line'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'raw_line'
op|'='
name|'line'
newline|'\n'
name|'self'
op|'.'
name|'line'
op|'='
name|'self'
op|'.'
name|'raw_line'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'l'
op|'='
name|'self'
op|'.'
name|'line'
op|'.'
name|'split'
op|'('
string|"' '"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'name'
op|'='
name|'l'
op|'['
number|'0'
op|']'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'l'
op|')'
op|'>'
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'args'
op|'='
op|'['
name|'arg'
name|'for'
name|'arg'
name|'in'
name|'l'
op|'['
number|'1'
op|':'
op|']'
name|'if'
name|'arg'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'args'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|class|LQSMessage
dedent|''
dedent|''
dedent|''
name|'class'
name|'LQSMessage'
op|'('
name|'dict'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'item'
op|'='
name|'None'
op|','
name|'args'
op|'='
name|'None'
op|','
name|'jsonvalue'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'dict'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'if'
name|'jsonvalue'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'decode'
op|'('
name|'jsonvalue'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'['
string|"'id'"
op|']'
op|'='
string|"'%d_%d'"
op|'%'
op|'('
name|'int'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|')'
op|','
name|'int'
op|'('
name|'random'
op|'.'
name|'random'
op|'('
op|')'
op|'*'
number|'1000000'
op|')'
op|')'
newline|'\n'
name|'self'
op|'['
string|"'item'"
op|']'
op|'='
name|'item'
newline|'\n'
name|'self'
op|'['
string|"'args'"
op|']'
op|'='
name|'args'
newline|'\n'
nl|'\n'
DECL|member|encode
dedent|''
dedent|''
name|'def'
name|'encode'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'simplejson'
op|'.'
name|'dumps'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|decode
dedent|''
name|'def'
name|'decode'
op|'('
name|'self'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'update'
op|'('
name|'simplejson'
op|'.'
name|'loads'
op|'('
name|'value'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|is_empty
dedent|''
name|'def'
name|'is_empty'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'['
string|"'item'"
op|']'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'True'
newline|'\n'
dedent|''
name|'return'
name|'False'
newline|'\n'
nl|'\n'
DECL|class|LQSServer
dedent|''
dedent|''
name|'class'
name|'LQSServer'
op|'('
name|'SocketServer'
op|'.'
name|'UDPServer'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|variable|PORT
indent|'    '
name|'PORT'
op|'='
number|'5151'
newline|'\n'
DECL|variable|TIMEOUT
name|'TIMEOUT'
op|'='
number|'30'
newline|'\n'
DECL|variable|MAXSIZE
name|'MAXSIZE'
op|'='
number|'8192'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'server_address'
op|','
name|'RequestHandlerClass'
op|','
name|'iterator'
op|','
name|'args'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'server_address'
op|'='
op|'('
name|'server_address'
op|','
name|'self'
op|'.'
name|'PORT'
op|')'
newline|'\n'
name|'SocketServer'
op|'.'
name|'UDPServer'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
name|'server_address'
op|','
name|'RequestHandlerClass'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'count'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'iterator'
op|'='
name|'iterator'
newline|'\n'
name|'self'
op|'.'
name|'args'
op|'='
name|'args'
newline|'\n'
name|'self'
op|'.'
name|'start'
op|'='
name|'datetime'
op|'.'
name|'datetime'
op|'.'
name|'now'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'end'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'extant'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|class|LQSHandler
dedent|''
dedent|''
name|'class'
name|'LQSHandler'
op|'('
name|'SocketServer'
op|'.'
name|'DatagramRequestHandler'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|get_cmd
indent|'    '
name|'def'
name|'get_cmd'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'LQSCommand'
op|'('
name|'self'
op|'.'
name|'rfile'
op|'.'
name|'readline'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|build_msg
dedent|''
name|'def'
name|'build_msg'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'server'
op|'.'
name|'iterator'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'LQSMessage'
op|'('
name|'None'
op|')'
newline|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'item'
op|'='
name|'self'
op|'.'
name|'server'
op|'.'
name|'iterator'
op|'.'
name|'next'
op|'('
op|')'
newline|'\n'
name|'msg'
op|'='
name|'LQSMessage'
op|'('
name|'item'
op|','
name|'self'
op|'.'
name|'server'
op|'.'
name|'args'
op|')'
newline|'\n'
name|'return'
name|'msg'
newline|'\n'
dedent|''
name|'except'
name|'StopIteration'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'server'
op|'.'
name|'iterator'
op|'='
name|'None'
newline|'\n'
name|'return'
name|'LQSMessage'
op|'('
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|respond
dedent|''
dedent|''
name|'def'
name|'respond'
op|'('
name|'self'
op|','
name|'msg'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'wfile'
op|'.'
name|'write'
op|'('
name|'msg'
op|'.'
name|'encode'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|check_extant
dedent|''
name|'def'
name|'check_extant'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'server'
op|'.'
name|'extant'
op|')'
op|'=='
number|'0'
name|'and'
name|'not'
name|'self'
op|'.'
name|'server'
op|'.'
name|'iterator'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'server'
op|'.'
name|'end'
op|'='
name|'datetime'
op|'.'
name|'datetime'
op|'.'
name|'now'
op|'('
op|')'
newline|'\n'
name|'delta'
op|'='
name|'self'
op|'.'
name|'server'
op|'.'
name|'end'
op|'-'
name|'self'
op|'.'
name|'server'
op|'.'
name|'start'
newline|'\n'
name|'print'
string|"'Total Processing Time: %s'"
op|'%'
name|'delta'
newline|'\n'
name|'print'
string|"'Total Messages Processed: %d'"
op|'%'
name|'self'
op|'.'
name|'server'
op|'.'
name|'count'
newline|'\n'
nl|'\n'
DECL|member|do_debug
dedent|''
dedent|''
name|'def'
name|'do_debug'
op|'('
name|'self'
op|','
name|'cmd'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'args'
op|'='
op|'{'
string|"'extant'"
op|':'
name|'self'
op|'.'
name|'server'
op|'.'
name|'extant'
op|','
nl|'\n'
string|"'count'"
op|':'
name|'self'
op|'.'
name|'server'
op|'.'
name|'count'
op|'}'
newline|'\n'
name|'msg'
op|'='
name|'LQSMessage'
op|'('
string|"'debug'"
op|','
name|'args'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'respond'
op|'('
name|'msg'
op|')'
newline|'\n'
nl|'\n'
DECL|member|do_next
dedent|''
name|'def'
name|'do_next'
op|'('
name|'self'
op|','
name|'cmd'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'out_msg'
op|'='
name|'self'
op|'.'
name|'build_msg'
op|'('
op|')'
newline|'\n'
name|'if'
name|'not'
name|'out_msg'
op|'.'
name|'is_empty'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'server'
op|'.'
name|'count'
op|'+='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'server'
op|'.'
name|'extant'
op|'.'
name|'append'
op|'('
name|'out_msg'
op|'['
string|"'id'"
op|']'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'respond'
op|'('
name|'out_msg'
op|')'
newline|'\n'
nl|'\n'
DECL|member|do_delete
dedent|''
name|'def'
name|'do_delete'
op|'('
name|'self'
op|','
name|'cmd'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'len'
op|'('
name|'cmd'
op|'.'
name|'args'
op|')'
op|'!='
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'error'
op|'('
name|'cmd'
op|','
string|"'delete command requires message id'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'mid'
op|'='
name|'cmd'
op|'.'
name|'args'
op|'['
number|'0'
op|']'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'server'
op|'.'
name|'extant'
op|'.'
name|'remove'
op|'('
name|'mid'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'error'
op|'('
name|'cmd'
op|','
string|"'message id not found'"
op|')'
newline|'\n'
dedent|''
name|'args'
op|'='
op|'{'
string|"'deleted'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'msg'
op|'='
name|'LQSMessage'
op|'('
name|'mid'
op|','
name|'args'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'respond'
op|'('
name|'msg'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'check_extant'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|error
dedent|''
dedent|''
name|'def'
name|'error'
op|'('
name|'self'
op|','
name|'cmd'
op|','
name|'error_msg'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'args'
op|'='
op|'{'
string|"'error_msg'"
op|':'
name|'error_msg'
op|','
nl|'\n'
string|"'cmd_name'"
op|':'
name|'cmd'
op|'.'
name|'name'
op|','
nl|'\n'
string|"'cmd_args'"
op|':'
name|'cmd'
op|'.'
name|'args'
op|'}'
newline|'\n'
name|'msg'
op|'='
name|'LQSMessage'
op|'('
string|"'error'"
op|','
name|'args'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'respond'
op|'('
name|'msg'
op|')'
newline|'\n'
nl|'\n'
DECL|member|do_stop
dedent|''
name|'def'
name|'do_stop'
op|'('
name|'self'
op|','
name|'cmd'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'sys'
op|'.'
name|'exit'
op|'('
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|handle
dedent|''
name|'def'
name|'handle'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cmd'
op|'='
name|'self'
op|'.'
name|'get_cmd'
op|'('
op|')'
newline|'\n'
name|'if'
name|'hasattr'
op|'('
name|'self'
op|','
string|"'do_%s'"
op|'%'
name|'cmd'
op|'.'
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'method'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
string|"'do_%s'"
op|'%'
name|'cmd'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'method'
op|'('
name|'cmd'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'error'
op|'('
name|'cmd'
op|','
string|"'unrecognized command'"
op|')'
newline|'\n'
nl|'\n'
DECL|class|PersistHandler
dedent|''
dedent|''
dedent|''
name|'class'
name|'PersistHandler'
op|'('
name|'LQSHandler'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|build_msg
indent|'    '
name|'def'
name|'build_msg'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'server'
op|'.'
name|'iterator'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'LQSMessage'
op|'('
name|'None'
op|')'
newline|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'obj'
op|'='
name|'self'
op|'.'
name|'server'
op|'.'
name|'iterator'
op|'.'
name|'next'
op|'('
op|')'
newline|'\n'
name|'msg'
op|'='
name|'LQSMessage'
op|'('
name|'obj'
op|'.'
name|'id'
op|','
name|'self'
op|'.'
name|'server'
op|'.'
name|'args'
op|')'
newline|'\n'
name|'return'
name|'msg'
newline|'\n'
dedent|''
name|'except'
name|'StopIteration'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'server'
op|'.'
name|'iterator'
op|'='
name|'None'
newline|'\n'
name|'return'
name|'LQSMessage'
op|'('
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|function|test_file
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_file'
op|'('
name|'path'
op|','
name|'args'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'l'
op|'='
name|'os'
op|'.'
name|'listdir'
op|'('
name|'path'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'args'
op|':'
newline|'\n'
indent|'        '
name|'args'
op|'='
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'args'
op|'['
string|"'path'"
op|']'
op|'='
name|'path'
newline|'\n'
name|'s'
op|'='
name|'LQSServer'
op|'('
string|"''"
op|','
name|'LQSHandler'
op|','
name|'iter'
op|'('
name|'l'
op|')'
op|','
name|'args'
op|')'
newline|'\n'
name|'print'
string|'"Awaiting UDP messages on port %d"'
op|'%'
name|'s'
op|'.'
name|'PORT'
newline|'\n'
name|'s'
op|'.'
name|'serve_forever'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|test_simple
dedent|''
name|'def'
name|'test_simple'
op|'('
name|'n'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'l'
op|'='
name|'range'
op|'('
number|'0'
op|','
name|'n'
op|')'
newline|'\n'
name|'s'
op|'='
name|'LQSServer'
op|'('
string|"''"
op|','
name|'LQSHandler'
op|','
name|'iter'
op|'('
name|'l'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'print'
string|'"Awaiting UDP messages on port %d"'
op|'%'
name|'s'
op|'.'
name|'PORT'
newline|'\n'
name|'s'
op|'.'
name|'serve_forever'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
endmarker|''
end_unit
