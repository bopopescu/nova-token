begin_unit
comment|'# Copyright (c) 2006,2007,2008 Mitch Garnaat http://garnaat.org/'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Permission is hereby granted, free of charge, to any person obtaining a'
nl|'\n'
comment|'# copy of this software and associated documentation files (the'
nl|'\n'
comment|'# "Software"), to deal in the Software without restriction, including'
nl|'\n'
comment|'# without limitation the rights to use, copy, modify, merge, publish, dis-'
nl|'\n'
comment|'# tribute, sublicense, and/or sell copies of the Software, and to permit'
nl|'\n'
comment|'# persons to whom the Software is furnished to do so, subject to the fol-'
nl|'\n'
comment|'# lowing conditions:'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# The above copyright notice and this permission notice shall be included'
nl|'\n'
comment|'# in all copies or substantial portions of the Software.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS'
nl|'\n'
comment|'# OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABIL-'
nl|'\n'
comment|'# ITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT'
nl|'\n'
comment|'# SHALL THE AUTHOR BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, '
nl|'\n'
comment|'# WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,'
nl|'\n'
comment|'# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS'
nl|'\n'
comment|'# IN THE SOFTWARE.'
nl|'\n'
name|'import'
name|'boto'
newline|'\n'
nl|'\n'
DECL|function|get_manager
name|'def'
name|'get_manager'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    Returns the appropriate Manager class for a given Model class.  It does this by\n    looking in the boto config for a section like this::\n    \n        [DB]\n        db_type = SimpleDB\n        db_user = <aws access key id>\n        db_passwd = <aws secret access key>\n        db_name = my_domain\n        [DB_TestBasic]\n        db_type = SimpleDB\n        db_user = <another aws access key id>\n        db_passwd = <another aws secret access key>\n        db_name = basic_domain\n        db_port = 1111\n    \n    The values in the DB section are "generic values" that will be used if nothing more\n    specific is found.  You can also create a section for a specific Model class that\n    gives the db info for that class.  In the example above, TestBasic is a Model subclass.\n    """'
newline|'\n'
name|'db_user'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'DB'"
op|','
string|"'db_user'"
op|','
name|'None'
op|')'
newline|'\n'
name|'db_passwd'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'DB'"
op|','
string|"'db_passwd'"
op|','
name|'None'
op|')'
newline|'\n'
name|'db_type'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'DB'"
op|','
string|"'db_type'"
op|','
string|"'SimpleDB'"
op|')'
newline|'\n'
name|'db_name'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'DB'"
op|','
string|"'db_name'"
op|','
name|'None'
op|')'
newline|'\n'
name|'db_table'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'DB'"
op|','
string|"'db_table'"
op|','
name|'None'
op|')'
newline|'\n'
name|'db_host'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'DB'"
op|','
string|"'db_host'"
op|','
string|'"sdb.amazonaws.com"'
op|')'
newline|'\n'
name|'db_port'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'getint'
op|'('
string|"'DB'"
op|','
string|"'db_port'"
op|','
number|'443'
op|')'
newline|'\n'
name|'enable_ssl'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'getbool'
op|'('
string|"'DB'"
op|','
string|"'enable_ssl'"
op|','
name|'True'
op|')'
newline|'\n'
name|'sql_dir'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
string|"'DB'"
op|','
string|"'sql_dir'"
op|','
name|'None'
op|')'
newline|'\n'
name|'debug'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'getint'
op|'('
string|"'DB'"
op|','
string|"'debug'"
op|','
number|'0'
op|')'
newline|'\n'
comment|'# first see if there is a fully qualified section name in the Boto config file'
nl|'\n'
name|'module_name'
op|'='
name|'cls'
op|'.'
name|'__module__'
op|'.'
name|'replace'
op|'('
string|"'.'"
op|','
string|"'_'"
op|')'
newline|'\n'
name|'db_section'
op|'='
string|"'DB_'"
op|'+'
name|'module_name'
op|'+'
string|"'_'"
op|'+'
name|'cls'
op|'.'
name|'__name__'
newline|'\n'
name|'if'
name|'not'
name|'boto'
op|'.'
name|'config'
op|'.'
name|'has_section'
op|'('
name|'db_section'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_section'
op|'='
string|"'DB_'"
op|'+'
name|'cls'
op|'.'
name|'__name__'
newline|'\n'
dedent|''
name|'if'
name|'boto'
op|'.'
name|'config'
op|'.'
name|'has_section'
op|'('
name|'db_section'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_user'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
name|'db_section'
op|','
string|"'db_user'"
op|','
name|'db_user'
op|')'
newline|'\n'
name|'db_passwd'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
name|'db_section'
op|','
string|"'db_passwd'"
op|','
name|'db_passwd'
op|')'
newline|'\n'
name|'db_type'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
name|'db_section'
op|','
string|"'db_type'"
op|','
name|'db_type'
op|')'
newline|'\n'
name|'db_name'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
name|'db_section'
op|','
string|"'db_name'"
op|','
name|'db_name'
op|')'
newline|'\n'
name|'db_table'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
name|'db_section'
op|','
string|"'db_table'"
op|','
name|'db_table'
op|')'
newline|'\n'
name|'db_host'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'get'
op|'('
name|'db_section'
op|','
string|"'db_host'"
op|','
name|'db_host'
op|')'
newline|'\n'
name|'db_port'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'getint'
op|'('
name|'db_section'
op|','
string|"'db_port'"
op|','
name|'db_port'
op|')'
newline|'\n'
name|'enable_ssl'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'getint'
op|'('
name|'db_section'
op|','
string|"'enable_ssl'"
op|','
name|'enable_ssl'
op|')'
newline|'\n'
name|'debug'
op|'='
name|'boto'
op|'.'
name|'config'
op|'.'
name|'getint'
op|'('
name|'db_section'
op|','
string|"'debug'"
op|','
name|'debug'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'hasattr'
op|'('
name|'cls'
op|'.'
name|'__bases__'
op|'['
number|'0'
op|']'
op|','
string|'"_manager"'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'cls'
op|'.'
name|'__bases__'
op|'['
number|'0'
op|']'
op|'.'
name|'_manager'
newline|'\n'
dedent|''
name|'if'
name|'db_type'
op|'=='
string|"'SimpleDB'"
op|':'
newline|'\n'
indent|'        '
name|'from'
name|'sdbmanager'
name|'import'
name|'SDBManager'
newline|'\n'
name|'return'
name|'SDBManager'
op|'('
name|'cls'
op|','
name|'db_name'
op|','
name|'db_user'
op|','
name|'db_passwd'
op|','
nl|'\n'
name|'db_host'
op|','
name|'db_port'
op|','
name|'db_table'
op|','
name|'sql_dir'
op|','
name|'enable_ssl'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'db_type'
op|'=='
string|"'PostgreSQL'"
op|':'
newline|'\n'
indent|'        '
name|'from'
name|'pgmanager'
name|'import'
name|'PGManager'
newline|'\n'
name|'if'
name|'db_table'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'PGManager'
op|'('
name|'cls'
op|','
name|'db_name'
op|','
name|'db_user'
op|','
name|'db_passwd'
op|','
nl|'\n'
name|'db_host'
op|','
name|'db_port'
op|','
name|'db_table'
op|','
name|'sql_dir'
op|','
name|'enable_ssl'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'None'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'db_type'
op|'=='
string|"'XML'"
op|':'
newline|'\n'
indent|'        '
name|'from'
name|'xmlmanager'
name|'import'
name|'XMLManager'
newline|'\n'
name|'return'
name|'XMLManager'
op|'('
name|'cls'
op|','
name|'db_name'
op|','
name|'db_user'
op|','
name|'db_passwd'
op|','
nl|'\n'
name|'db_host'
op|','
name|'db_port'
op|','
name|'db_table'
op|','
name|'sql_dir'
op|','
name|'enable_ssl'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'ValueError'
op|','
string|"'Unknown db_type: %s'"
op|'%'
name|'db_type'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
