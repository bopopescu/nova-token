begin_unit
comment|'# Copyright (c) 2006-2008 Mitch Garnaat http://garnaat.org/'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Permission is hereby granted, free of charge, to any person obtaining a'
nl|'\n'
comment|'# copy of this software and associated documentation files (the'
nl|'\n'
comment|'# "Software"), to deal in the Software without restriction, including'
nl|'\n'
comment|'# without limitation the rights to use, copy, modify, merge, publish, dis-'
nl|'\n'
comment|'# tribute, sublicense, and/or sell copies of the Software, and to permit'
nl|'\n'
comment|'# persons to whom the Software is furnished to do so, subject to the fol-'
nl|'\n'
comment|'# lowing conditions:'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# The above copyright notice and this permission notice shall be included'
nl|'\n'
comment|'# in all copies or substantial portions of the Software.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS'
nl|'\n'
comment|'# OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABIL-'
nl|'\n'
comment|'# ITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT'
nl|'\n'
comment|'# SHALL THE AUTHOR BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, '
nl|'\n'
comment|'# WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,'
nl|'\n'
comment|'# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS'
nl|'\n'
comment|'# IN THE SOFTWARE.'
nl|'\n'
name|'import'
name|'boto'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'utils'
name|'import'
name|'find_class'
op|','
name|'Password'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'sdb'
op|'.'
name|'db'
op|'.'
name|'key'
name|'import'
name|'Key'
newline|'\n'
name|'from'
name|'boto'
op|'.'
name|'sdb'
op|'.'
name|'db'
op|'.'
name|'model'
name|'import'
name|'Model'
newline|'\n'
name|'from'
name|'datetime'
name|'import'
name|'datetime'
newline|'\n'
name|'from'
name|'xml'
op|'.'
name|'dom'
op|'.'
name|'minidom'
name|'import'
name|'getDOMImplementation'
op|','
name|'parse'
op|','
name|'parseString'
op|','
name|'Node'
newline|'\n'
nl|'\n'
DECL|variable|ISO8601
name|'ISO8601'
op|'='
string|"'%Y-%m-%dT%H:%M:%SZ'"
newline|'\n'
nl|'\n'
DECL|class|XMLConverter
name|'class'
name|'XMLConverter'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    Responsible for converting base Python types to format compatible with underlying\n    database.  For SimpleDB, that means everything needs to be converted to a string\n    when stored in SimpleDB and from a string when retrieved.\n\n    To convert a value, pass it to the encode or decode method.  The encode method\n    will take a Python native value and convert to DB format.  The decode method will\n    take a DB format value and convert it to Python native format.  To find the appropriate\n    method to call, the generic encode/decode methods will look for the type-specific\n    method by searching for a method called "encode_<type name>" or "decode_<type name>".\n    """'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'manager'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'manager'
op|'='
name|'manager'
newline|'\n'
name|'self'
op|'.'
name|'type_map'
op|'='
op|'{'
name|'bool'
op|':'
op|'('
name|'self'
op|'.'
name|'encode_bool'
op|','
name|'self'
op|'.'
name|'decode_bool'
op|')'
op|','
nl|'\n'
name|'int'
op|':'
op|'('
name|'self'
op|'.'
name|'encode_int'
op|','
name|'self'
op|'.'
name|'decode_int'
op|')'
op|','
nl|'\n'
name|'long'
op|':'
op|'('
name|'self'
op|'.'
name|'encode_long'
op|','
name|'self'
op|'.'
name|'decode_long'
op|')'
op|','
nl|'\n'
name|'Model'
op|':'
op|'('
name|'self'
op|'.'
name|'encode_reference'
op|','
name|'self'
op|'.'
name|'decode_reference'
op|')'
op|','
nl|'\n'
name|'Key'
op|':'
op|'('
name|'self'
op|'.'
name|'encode_reference'
op|','
name|'self'
op|'.'
name|'decode_reference'
op|')'
op|','
nl|'\n'
name|'Password'
op|':'
op|'('
name|'self'
op|'.'
name|'encode_password'
op|','
name|'self'
op|'.'
name|'decode_password'
op|')'
op|','
nl|'\n'
name|'datetime'
op|':'
op|'('
name|'self'
op|'.'
name|'encode_datetime'
op|','
name|'self'
op|'.'
name|'decode_datetime'
op|')'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|get_text_value
dedent|''
name|'def'
name|'get_text_value'
op|'('
name|'self'
op|','
name|'parent_node'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'value'
op|'='
string|"''"
newline|'\n'
name|'for'
name|'node'
name|'in'
name|'parent_node'
op|'.'
name|'childNodes'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'node'
op|'.'
name|'nodeType'
op|'=='
name|'node'
op|'.'
name|'TEXT_NODE'
op|':'
newline|'\n'
indent|'                '
name|'value'
op|'+='
name|'node'
op|'.'
name|'data'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'value'
newline|'\n'
nl|'\n'
DECL|member|encode
dedent|''
name|'def'
name|'encode'
op|'('
name|'self'
op|','
name|'item_type'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'item_type'
name|'in'
name|'self'
op|'.'
name|'type_map'
op|':'
newline|'\n'
indent|'            '
name|'encode'
op|'='
name|'self'
op|'.'
name|'type_map'
op|'['
name|'item_type'
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'return'
name|'encode'
op|'('
name|'value'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'value'
newline|'\n'
nl|'\n'
DECL|member|decode
dedent|''
name|'def'
name|'decode'
op|'('
name|'self'
op|','
name|'item_type'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'item_type'
name|'in'
name|'self'
op|'.'
name|'type_map'
op|':'
newline|'\n'
indent|'            '
name|'decode'
op|'='
name|'self'
op|'.'
name|'type_map'
op|'['
name|'item_type'
op|']'
op|'['
number|'1'
op|']'
newline|'\n'
name|'return'
name|'decode'
op|'('
name|'value'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'value'
op|'='
name|'self'
op|'.'
name|'get_text_value'
op|'('
name|'value'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'value'
newline|'\n'
nl|'\n'
DECL|member|encode_prop
dedent|''
name|'def'
name|'encode_prop'
op|'('
name|'self'
op|','
name|'prop'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'isinstance'
op|'('
name|'value'
op|','
name|'list'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'hasattr'
op|'('
name|'prop'
op|','
string|"'item_type'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'new_value'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'v'
name|'in'
name|'value'
op|':'
newline|'\n'
indent|'                    '
name|'item_type'
op|'='
name|'getattr'
op|'('
name|'prop'
op|','
string|'"item_type"'
op|')'
newline|'\n'
name|'if'
name|'Model'
name|'in'
name|'item_type'
op|'.'
name|'mro'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'item_type'
op|'='
name|'Model'
newline|'\n'
dedent|''
name|'new_value'
op|'.'
name|'append'
op|'('
name|'self'
op|'.'
name|'encode'
op|'('
name|'item_type'
op|','
name|'v'
op|')'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'new_value'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'value'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'encode'
op|'('
name|'prop'
op|'.'
name|'data_type'
op|','
name|'value'
op|')'
newline|'\n'
nl|'\n'
DECL|member|decode_prop
dedent|''
dedent|''
name|'def'
name|'decode_prop'
op|'('
name|'self'
op|','
name|'prop'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'prop'
op|'.'
name|'data_type'
op|'=='
name|'list'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'hasattr'
op|'('
name|'prop'
op|','
string|"'item_type'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'item_type'
op|'='
name|'getattr'
op|'('
name|'prop'
op|','
string|'"item_type"'
op|')'
newline|'\n'
name|'if'
name|'Model'
name|'in'
name|'item_type'
op|'.'
name|'mro'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'item_type'
op|'='
name|'Model'
newline|'\n'
dedent|''
name|'values'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'item_node'
name|'in'
name|'value'
op|'.'
name|'getElementsByTagName'
op|'('
string|"'item'"
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'value'
op|'='
name|'self'
op|'.'
name|'decode'
op|'('
name|'item_type'
op|','
name|'item_node'
op|')'
newline|'\n'
name|'values'
op|'.'
name|'append'
op|'('
name|'value'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'values'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'self'
op|'.'
name|'get_text_value'
op|'('
name|'value'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'decode'
op|'('
name|'prop'
op|'.'
name|'data_type'
op|','
name|'value'
op|')'
newline|'\n'
nl|'\n'
DECL|member|encode_int
dedent|''
dedent|''
name|'def'
name|'encode_int'
op|'('
name|'self'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'value'
op|'='
name|'int'
op|'('
name|'value'
op|')'
newline|'\n'
name|'return'
string|"'%d'"
op|'%'
name|'value'
newline|'\n'
nl|'\n'
DECL|member|decode_int
dedent|''
name|'def'
name|'decode_int'
op|'('
name|'self'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'value'
op|'='
name|'self'
op|'.'
name|'get_text_value'
op|'('
name|'value'
op|')'
newline|'\n'
name|'if'
name|'value'
op|':'
newline|'\n'
indent|'            '
name|'value'
op|'='
name|'int'
op|'('
name|'value'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'value'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'return'
name|'value'
newline|'\n'
nl|'\n'
DECL|member|encode_long
dedent|''
name|'def'
name|'encode_long'
op|'('
name|'self'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'value'
op|'='
name|'long'
op|'('
name|'value'
op|')'
newline|'\n'
name|'return'
string|"'%d'"
op|'%'
name|'value'
newline|'\n'
nl|'\n'
DECL|member|decode_long
dedent|''
name|'def'
name|'decode_long'
op|'('
name|'self'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'value'
op|'='
name|'self'
op|'.'
name|'get_text_value'
op|'('
name|'value'
op|')'
newline|'\n'
name|'return'
name|'long'
op|'('
name|'value'
op|')'
newline|'\n'
nl|'\n'
DECL|member|encode_bool
dedent|''
name|'def'
name|'encode_bool'
op|'('
name|'self'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'value'
op|'=='
name|'True'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|"'true'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|"'false'"
newline|'\n'
nl|'\n'
DECL|member|decode_bool
dedent|''
dedent|''
name|'def'
name|'decode_bool'
op|'('
name|'self'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'value'
op|'='
name|'self'
op|'.'
name|'get_text_value'
op|'('
name|'value'
op|')'
newline|'\n'
name|'if'
name|'value'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'true'"
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'True'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'False'
newline|'\n'
nl|'\n'
DECL|member|encode_datetime
dedent|''
dedent|''
name|'def'
name|'encode_datetime'
op|'('
name|'self'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'value'
op|'.'
name|'strftime'
op|'('
name|'ISO8601'
op|')'
newline|'\n'
nl|'\n'
DECL|member|decode_datetime
dedent|''
name|'def'
name|'decode_datetime'
op|'('
name|'self'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'value'
op|'='
name|'self'
op|'.'
name|'get_text_value'
op|'('
name|'value'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'datetime'
op|'.'
name|'strptime'
op|'('
name|'value'
op|','
name|'ISO8601'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'None'
newline|'\n'
nl|'\n'
DECL|member|encode_reference
dedent|''
dedent|''
name|'def'
name|'encode_reference'
op|'('
name|'self'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'isinstance'
op|'('
name|'value'
op|','
name|'str'
op|')'
name|'or'
name|'isinstance'
op|'('
name|'value'
op|','
name|'unicode'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'value'
newline|'\n'
dedent|''
name|'if'
name|'value'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|"''"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'val_node'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'doc'
op|'.'
name|'createElement'
op|'('
string|'"object"'
op|')'
newline|'\n'
name|'val_node'
op|'.'
name|'setAttribute'
op|'('
string|"'id'"
op|','
name|'value'
op|'.'
name|'id'
op|')'
newline|'\n'
name|'val_node'
op|'.'
name|'setAttribute'
op|'('
string|"'class'"
op|','
string|"'%s.%s'"
op|'%'
op|'('
name|'value'
op|'.'
name|'__class__'
op|'.'
name|'__module__'
op|','
name|'value'
op|'.'
name|'__class__'
op|'.'
name|'__name__'
op|')'
op|')'
newline|'\n'
name|'return'
name|'val_node'
newline|'\n'
nl|'\n'
DECL|member|decode_reference
dedent|''
dedent|''
name|'def'
name|'decode_reference'
op|'('
name|'self'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'value'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'None'
newline|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'value'
op|'='
name|'value'
op|'.'
name|'childNodes'
op|'['
number|'0'
op|']'
newline|'\n'
name|'class_name'
op|'='
name|'value'
op|'.'
name|'getAttribute'
op|'('
string|'"class"'
op|')'
newline|'\n'
name|'id'
op|'='
name|'value'
op|'.'
name|'getAttribute'
op|'('
string|'"id"'
op|')'
newline|'\n'
name|'cls'
op|'='
name|'find_class'
op|'('
name|'class_name'
op|')'
newline|'\n'
name|'return'
name|'cls'
op|'.'
name|'get_by_ids'
op|'('
name|'id'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'None'
newline|'\n'
nl|'\n'
DECL|member|encode_password
dedent|''
dedent|''
name|'def'
name|'encode_password'
op|'('
name|'self'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'value'
name|'and'
name|'len'
op|'('
name|'value'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'str'
op|'('
name|'value'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'None'
newline|'\n'
nl|'\n'
DECL|member|decode_password
dedent|''
dedent|''
name|'def'
name|'decode_password'
op|'('
name|'self'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'value'
op|'='
name|'self'
op|'.'
name|'get_text_value'
op|'('
name|'value'
op|')'
newline|'\n'
name|'return'
name|'Password'
op|'('
name|'value'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|XMLManager
dedent|''
dedent|''
name|'class'
name|'XMLManager'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'cls'
op|','
name|'db_name'
op|','
name|'db_user'
op|','
name|'db_passwd'
op|','
nl|'\n'
name|'db_host'
op|','
name|'db_port'
op|','
name|'db_table'
op|','
name|'ddl_dir'
op|','
name|'enable_ssl'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cls'
op|'='
name|'cls'
newline|'\n'
name|'if'
name|'not'
name|'db_name'
op|':'
newline|'\n'
indent|'            '
name|'db_name'
op|'='
name|'cls'
op|'.'
name|'__name__'
op|'.'
name|'lower'
op|'('
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'db_name'
op|'='
name|'db_name'
newline|'\n'
name|'self'
op|'.'
name|'db_user'
op|'='
name|'db_user'
newline|'\n'
name|'self'
op|'.'
name|'db_passwd'
op|'='
name|'db_passwd'
newline|'\n'
name|'self'
op|'.'
name|'db_host'
op|'='
name|'db_host'
newline|'\n'
name|'self'
op|'.'
name|'db_port'
op|'='
name|'db_port'
newline|'\n'
name|'self'
op|'.'
name|'db_table'
op|'='
name|'db_table'
newline|'\n'
name|'self'
op|'.'
name|'ddl_dir'
op|'='
name|'ddl_dir'
newline|'\n'
name|'self'
op|'.'
name|'s3'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'converter'
op|'='
name|'XMLConverter'
op|'('
name|'self'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'impl'
op|'='
name|'getDOMImplementation'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'doc'
op|'='
name|'self'
op|'.'
name|'impl'
op|'.'
name|'createDocument'
op|'('
name|'None'
op|','
string|"'objects'"
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'connection'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'enable_ssl'
op|'='
name|'enable_ssl'
newline|'\n'
name|'self'
op|'.'
name|'auth_header'
op|'='
name|'None'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'db_user'
op|':'
newline|'\n'
indent|'            '
name|'import'
name|'base64'
newline|'\n'
name|'base64string'
op|'='
name|'base64'
op|'.'
name|'encodestring'
op|'('
string|"'%s:%s'"
op|'%'
op|'('
name|'self'
op|'.'
name|'db_user'
op|','
name|'self'
op|'.'
name|'db_passwd'
op|')'
op|')'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
name|'authheader'
op|'='
string|'"Basic %s"'
op|'%'
name|'base64string'
newline|'\n'
name|'self'
op|'.'
name|'auth_header'
op|'='
name|'authheader'
newline|'\n'
nl|'\n'
DECL|member|_connect
dedent|''
dedent|''
name|'def'
name|'_connect'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'db_host'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'enable_ssl'
op|':'
newline|'\n'
indent|'                '
name|'from'
name|'httplib'
name|'import'
name|'HTTPSConnection'
name|'as'
name|'Connection'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'from'
name|'httplib'
name|'import'
name|'HTTPConnection'
name|'as'
name|'Connection'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'connection'
op|'='
name|'Connection'
op|'('
name|'self'
op|'.'
name|'db_host'
op|','
name|'self'
op|'.'
name|'db_port'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_make_request
dedent|''
dedent|''
name|'def'
name|'_make_request'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'url'
op|','
name|'post_data'
op|'='
name|'None'
op|','
name|'body'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Make a request on this connection\n        """'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'connection'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_connect'
op|'('
op|')'
newline|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'connection'
op|'.'
name|'connect'
op|'('
op|')'
newline|'\n'
name|'headers'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'auth_header'
op|':'
newline|'\n'
indent|'            '
name|'headers'
op|'['
string|'"Authorization"'
op|']'
op|'='
name|'self'
op|'.'
name|'auth_header'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'connection'
op|'.'
name|'request'
op|'('
name|'method'
op|','
name|'url'
op|','
name|'body'
op|','
name|'headers'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'return'
name|'resp'
newline|'\n'
nl|'\n'
DECL|member|new_doc
dedent|''
name|'def'
name|'new_doc'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'impl'
op|'.'
name|'createDocument'
op|'('
name|'None'
op|','
string|"'objects'"
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_object_lister
dedent|''
name|'def'
name|'_object_lister'
op|'('
name|'self'
op|','
name|'cls'
op|','
name|'doc'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'obj_node'
name|'in'
name|'doc'
op|'.'
name|'getElementsByTagName'
op|'('
string|"'object'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'cls'
op|':'
newline|'\n'
indent|'                '
name|'class_name'
op|'='
name|'obj_node'
op|'.'
name|'getAttribute'
op|'('
string|"'class'"
op|')'
newline|'\n'
name|'cls'
op|'='
name|'find_class'
op|'('
name|'class_name'
op|')'
newline|'\n'
dedent|''
name|'id'
op|'='
name|'obj_node'
op|'.'
name|'getAttribute'
op|'('
string|"'id'"
op|')'
newline|'\n'
name|'obj'
op|'='
name|'cls'
op|'('
name|'id'
op|')'
newline|'\n'
name|'for'
name|'prop_node'
name|'in'
name|'obj_node'
op|'.'
name|'getElementsByTagName'
op|'('
string|"'property'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'prop_name'
op|'='
name|'prop_node'
op|'.'
name|'getAttribute'
op|'('
string|"'name'"
op|')'
newline|'\n'
name|'prop'
op|'='
name|'obj'
op|'.'
name|'find_property'
op|'('
name|'prop_name'
op|')'
newline|'\n'
name|'if'
name|'prop'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'hasattr'
op|'('
name|'prop'
op|','
string|"'item_type'"
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'value'
op|'='
name|'self'
op|'.'
name|'get_list'
op|'('
name|'prop_node'
op|','
name|'prop'
op|'.'
name|'item_type'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'value'
op|'='
name|'self'
op|'.'
name|'decode_value'
op|'('
name|'prop'
op|','
name|'prop_node'
op|')'
newline|'\n'
name|'value'
op|'='
name|'prop'
op|'.'
name|'make_value_from_datastore'
op|'('
name|'value'
op|')'
newline|'\n'
dedent|''
name|'setattr'
op|'('
name|'obj'
op|','
name|'prop'
op|'.'
name|'name'
op|','
name|'value'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'yield'
name|'obj'
newline|'\n'
nl|'\n'
DECL|member|reset
dedent|''
dedent|''
name|'def'
name|'reset'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_connect'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_doc
dedent|''
name|'def'
name|'get_doc'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'doc'
newline|'\n'
nl|'\n'
DECL|member|encode_value
dedent|''
name|'def'
name|'encode_value'
op|'('
name|'self'
op|','
name|'prop'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'converter'
op|'.'
name|'encode_prop'
op|'('
name|'prop'
op|','
name|'value'
op|')'
newline|'\n'
nl|'\n'
DECL|member|decode_value
dedent|''
name|'def'
name|'decode_value'
op|'('
name|'self'
op|','
name|'prop'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'converter'
op|'.'
name|'decode_prop'
op|'('
name|'prop'
op|','
name|'value'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_s3_connection
dedent|''
name|'def'
name|'get_s3_connection'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'s3'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'s3'
op|'='
name|'boto'
op|'.'
name|'connect_s3'
op|'('
name|'self'
op|'.'
name|'aws_access_key_id'
op|','
name|'self'
op|'.'
name|'aws_secret_access_key'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'s3'
newline|'\n'
nl|'\n'
DECL|member|get_list
dedent|''
name|'def'
name|'get_list'
op|'('
name|'self'
op|','
name|'prop_node'
op|','
name|'item_type'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'values'
op|'='
op|'['
op|']'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'items_node'
op|'='
name|'prop_node'
op|'.'
name|'getElementsByTagName'
op|'('
string|"'items'"
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'['
op|']'
newline|'\n'
dedent|''
name|'for'
name|'item_node'
name|'in'
name|'items_node'
op|'.'
name|'getElementsByTagName'
op|'('
string|"'item'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'value'
op|'='
name|'self'
op|'.'
name|'converter'
op|'.'
name|'decode'
op|'('
name|'item_type'
op|','
name|'item_node'
op|')'
newline|'\n'
name|'values'
op|'.'
name|'append'
op|'('
name|'value'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'values'
newline|'\n'
nl|'\n'
DECL|member|get_object_from_doc
dedent|''
name|'def'
name|'get_object_from_doc'
op|'('
name|'self'
op|','
name|'cls'
op|','
name|'id'
op|','
name|'doc'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'obj_node'
op|'='
name|'doc'
op|'.'
name|'getElementsByTagName'
op|'('
string|"'object'"
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|':'
newline|'\n'
indent|'            '
name|'class_name'
op|'='
name|'obj_node'
op|'.'
name|'getAttribute'
op|'('
string|"'class'"
op|')'
newline|'\n'
name|'cls'
op|'='
name|'find_class'
op|'('
name|'class_name'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'id'
op|':'
newline|'\n'
indent|'            '
name|'id'
op|'='
name|'obj_node'
op|'.'
name|'getAttribute'
op|'('
string|"'id'"
op|')'
newline|'\n'
dedent|''
name|'obj'
op|'='
name|'cls'
op|'('
name|'id'
op|')'
newline|'\n'
name|'for'
name|'prop_node'
name|'in'
name|'obj_node'
op|'.'
name|'getElementsByTagName'
op|'('
string|"'property'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop_name'
op|'='
name|'prop_node'
op|'.'
name|'getAttribute'
op|'('
string|"'name'"
op|')'
newline|'\n'
name|'prop'
op|'='
name|'obj'
op|'.'
name|'find_property'
op|'('
name|'prop_name'
op|')'
newline|'\n'
name|'value'
op|'='
name|'self'
op|'.'
name|'decode_value'
op|'('
name|'prop'
op|','
name|'prop_node'
op|')'
newline|'\n'
name|'value'
op|'='
name|'prop'
op|'.'
name|'make_value_from_datastore'
op|'('
name|'value'
op|')'
newline|'\n'
name|'if'
name|'value'
op|'!='
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'try'
op|':'
newline|'\n'
indent|'                    '
name|'setattr'
op|'('
name|'obj'
op|','
name|'prop'
op|'.'
name|'name'
op|','
name|'value'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'                    '
name|'pass'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'return'
name|'obj'
newline|'\n'
nl|'\n'
DECL|member|get_props_from_doc
dedent|''
name|'def'
name|'get_props_from_doc'
op|'('
name|'self'
op|','
name|'cls'
op|','
name|'id'
op|','
name|'doc'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Pull out the properties from this document\n        Returns the class, the properties in a hash, and the id if provided as a tuple\n        :return: (cls, props, id)\n        """'
newline|'\n'
name|'obj_node'
op|'='
name|'doc'
op|'.'
name|'getElementsByTagName'
op|'('
string|"'object'"
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'if'
name|'not'
name|'cls'
op|':'
newline|'\n'
indent|'            '
name|'class_name'
op|'='
name|'obj_node'
op|'.'
name|'getAttribute'
op|'('
string|"'class'"
op|')'
newline|'\n'
name|'cls'
op|'='
name|'find_class'
op|'('
name|'class_name'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'id'
op|':'
newline|'\n'
indent|'            '
name|'id'
op|'='
name|'obj_node'
op|'.'
name|'getAttribute'
op|'('
string|"'id'"
op|')'
newline|'\n'
dedent|''
name|'props'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'prop_node'
name|'in'
name|'obj_node'
op|'.'
name|'getElementsByTagName'
op|'('
string|"'property'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop_name'
op|'='
name|'prop_node'
op|'.'
name|'getAttribute'
op|'('
string|"'name'"
op|')'
newline|'\n'
name|'prop'
op|'='
name|'cls'
op|'.'
name|'find_property'
op|'('
name|'prop_name'
op|')'
newline|'\n'
name|'value'
op|'='
name|'self'
op|'.'
name|'decode_value'
op|'('
name|'prop'
op|','
name|'prop_node'
op|')'
newline|'\n'
name|'value'
op|'='
name|'prop'
op|'.'
name|'make_value_from_datastore'
op|'('
name|'value'
op|')'
newline|'\n'
name|'if'
name|'value'
op|'!='
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'props'
op|'['
name|'prop'
op|'.'
name|'name'
op|']'
op|'='
name|'value'
newline|'\n'
dedent|''
dedent|''
name|'return'
op|'('
name|'cls'
op|','
name|'props'
op|','
name|'id'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|get_object
dedent|''
name|'def'
name|'get_object'
op|'('
name|'self'
op|','
name|'cls'
op|','
name|'id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'connection'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_connect'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'not'
name|'self'
op|'.'
name|'connection'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'NotImplementedError'
op|'('
string|'"Can\'t query without a database connection"'
op|')'
newline|'\n'
dedent|''
name|'url'
op|'='
string|'"/%s/%s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'db_name'
op|','
name|'id'
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'GET'"
op|','
name|'url'
op|')'
newline|'\n'
name|'if'
name|'resp'
op|'.'
name|'status'
op|'=='
number|'200'
op|':'
newline|'\n'
indent|'            '
name|'doc'
op|'='
name|'parse'
op|'('
name|'resp'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|'"Error: %s"'
op|'%'
name|'resp'
op|'.'
name|'status'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'get_object_from_doc'
op|'('
name|'cls'
op|','
name|'id'
op|','
name|'doc'
op|')'
newline|'\n'
nl|'\n'
DECL|member|query
dedent|''
name|'def'
name|'query'
op|'('
name|'self'
op|','
name|'cls'
op|','
name|'filters'
op|','
name|'limit'
op|'='
name|'None'
op|','
name|'order_by'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'connection'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_connect'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'not'
name|'self'
op|'.'
name|'connection'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'NotImplementedError'
op|'('
string|'"Can\'t query without a database connection"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'from'
name|'urllib'
name|'import'
name|'urlencode'
newline|'\n'
nl|'\n'
name|'query'
op|'='
name|'str'
op|'('
name|'self'
op|'.'
name|'_build_query'
op|'('
name|'cls'
op|','
name|'filters'
op|','
name|'limit'
op|','
name|'order_by'
op|')'
op|')'
newline|'\n'
name|'if'
name|'query'
op|':'
newline|'\n'
indent|'            '
name|'url'
op|'='
string|'"/%s?%s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'db_name'
op|','
name|'urlencode'
op|'('
op|'{'
string|'"query"'
op|':'
name|'query'
op|'}'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'url'
op|'='
string|'"/%s"'
op|'%'
name|'self'
op|'.'
name|'db_name'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|"'GET'"
op|','
name|'url'
op|')'
newline|'\n'
name|'if'
name|'resp'
op|'.'
name|'status'
op|'=='
number|'200'
op|':'
newline|'\n'
indent|'            '
name|'doc'
op|'='
name|'parse'
op|'('
name|'resp'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|'"Error: %s"'
op|'%'
name|'resp'
op|'.'
name|'status'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'_object_lister'
op|'('
name|'cls'
op|','
name|'doc'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_build_query
dedent|''
name|'def'
name|'_build_query'
op|'('
name|'self'
op|','
name|'cls'
op|','
name|'filters'
op|','
name|'limit'
op|','
name|'order_by'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'import'
name|'types'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'filters'
op|')'
op|'>'
number|'4'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|"'Too many filters, max is 4'"
op|')'
newline|'\n'
dedent|''
name|'parts'
op|'='
op|'['
op|']'
newline|'\n'
name|'properties'
op|'='
name|'cls'
op|'.'
name|'properties'
op|'('
name|'hidden'
op|'='
name|'False'
op|')'
newline|'\n'
name|'for'
name|'filter'
op|','
name|'value'
name|'in'
name|'filters'
op|':'
newline|'\n'
indent|'            '
name|'name'
op|','
name|'op'
op|'='
name|'filter'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'found'
op|'='
name|'False'
newline|'\n'
name|'for'
name|'property'
name|'in'
name|'properties'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'property'
op|'.'
name|'name'
op|'=='
name|'name'
op|':'
newline|'\n'
indent|'                    '
name|'found'
op|'='
name|'True'
newline|'\n'
name|'if'
name|'types'
op|'.'
name|'TypeType'
op|'('
name|'value'
op|')'
op|'=='
name|'types'
op|'.'
name|'ListType'
op|':'
newline|'\n'
indent|'                        '
name|'filter_parts'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'val'
name|'in'
name|'value'
op|':'
newline|'\n'
indent|'                            '
name|'val'
op|'='
name|'self'
op|'.'
name|'encode_value'
op|'('
name|'property'
op|','
name|'val'
op|')'
newline|'\n'
name|'filter_parts'
op|'.'
name|'append'
op|'('
string|'"\'%s\' %s \'%s\'"'
op|'%'
op|'('
name|'name'
op|','
name|'op'
op|','
name|'val'
op|')'
op|')'
newline|'\n'
dedent|''
name|'parts'
op|'.'
name|'append'
op|'('
string|'"[%s]"'
op|'%'
string|'" OR "'
op|'.'
name|'join'
op|'('
name|'filter_parts'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'value'
op|'='
name|'self'
op|'.'
name|'encode_value'
op|'('
name|'property'
op|','
name|'value'
op|')'
newline|'\n'
name|'parts'
op|'.'
name|'append'
op|'('
string|'"[\'%s\' %s \'%s\']"'
op|'%'
op|'('
name|'name'
op|','
name|'op'
op|','
name|'value'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'not'
name|'found'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'Exception'
op|'('
string|"'%s is not a valid field'"
op|'%'
name|'name'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'order_by'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'order_by'
op|'.'
name|'startswith'
op|'('
string|'"-"'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'key'
op|'='
name|'order_by'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
name|'type'
op|'='
string|'"desc"'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'key'
op|'='
name|'order_by'
newline|'\n'
name|'type'
op|'='
string|'"asc"'
newline|'\n'
dedent|''
name|'parts'
op|'.'
name|'append'
op|'('
string|'"[\'%s\' starts-with \'\'] sort \'%s\' %s"'
op|'%'
op|'('
name|'key'
op|','
name|'key'
op|','
name|'type'
op|')'
op|')'
newline|'\n'
dedent|''
name|'return'
string|"' intersection '"
op|'.'
name|'join'
op|'('
name|'parts'
op|')'
newline|'\n'
nl|'\n'
DECL|member|query_gql
dedent|''
name|'def'
name|'query_gql'
op|'('
name|'self'
op|','
name|'query_string'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwds'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'NotImplementedError'
op|','
string|'"GQL queries not supported in XML"'
newline|'\n'
nl|'\n'
DECL|member|save_list
dedent|''
name|'def'
name|'save_list'
op|'('
name|'self'
op|','
name|'doc'
op|','
name|'items'
op|','
name|'prop_node'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'items_node'
op|'='
name|'doc'
op|'.'
name|'createElement'
op|'('
string|"'items'"
op|')'
newline|'\n'
name|'prop_node'
op|'.'
name|'appendChild'
op|'('
name|'items_node'
op|')'
newline|'\n'
name|'for'
name|'item'
name|'in'
name|'items'
op|':'
newline|'\n'
indent|'            '
name|'item_node'
op|'='
name|'doc'
op|'.'
name|'createElement'
op|'('
string|"'item'"
op|')'
newline|'\n'
name|'items_node'
op|'.'
name|'appendChild'
op|'('
name|'item_node'
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'item'
op|','
name|'Node'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'item_node'
op|'.'
name|'appendChild'
op|'('
name|'item'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'text_node'
op|'='
name|'doc'
op|'.'
name|'createTextNode'
op|'('
name|'item'
op|')'
newline|'\n'
name|'item_node'
op|'.'
name|'appendChild'
op|'('
name|'text_node'
op|')'
newline|'\n'
nl|'\n'
DECL|member|save_object
dedent|''
dedent|''
dedent|''
name|'def'
name|'save_object'
op|'('
name|'self'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Marshal the object and do a PUT\n        """'
newline|'\n'
name|'doc'
op|'='
name|'self'
op|'.'
name|'marshal_object'
op|'('
name|'obj'
op|')'
newline|'\n'
name|'if'
name|'obj'
op|'.'
name|'id'
op|':'
newline|'\n'
indent|'            '
name|'url'
op|'='
string|'"/%s/%s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'db_name'
op|','
name|'obj'
op|'.'
name|'id'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'url'
op|'='
string|'"/%s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'db_name'
op|')'
newline|'\n'
dedent|''
name|'resp'
op|'='
name|'self'
op|'.'
name|'_make_request'
op|'('
string|'"PUT"'
op|','
name|'url'
op|','
name|'body'
op|'='
name|'doc'
op|'.'
name|'toxml'
op|'('
op|')'
op|')'
newline|'\n'
name|'new_obj'
op|'='
name|'self'
op|'.'
name|'get_object_from_doc'
op|'('
name|'obj'
op|'.'
name|'__class__'
op|','
name|'None'
op|','
name|'parse'
op|'('
name|'resp'
op|')'
op|')'
newline|'\n'
name|'obj'
op|'.'
name|'id'
op|'='
name|'new_obj'
op|'.'
name|'id'
newline|'\n'
name|'for'
name|'prop'
name|'in'
name|'obj'
op|'.'
name|'properties'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'propname'
op|'='
name|'prop'
op|'.'
name|'name'
newline|'\n'
dedent|''
name|'except'
name|'AttributeError'
op|':'
newline|'\n'
indent|'                '
name|'propname'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'if'
name|'propname'
op|':'
newline|'\n'
indent|'                '
name|'value'
op|'='
name|'getattr'
op|'('
name|'new_obj'
op|','
name|'prop'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'if'
name|'value'
op|':'
newline|'\n'
indent|'                    '
name|'setattr'
op|'('
name|'obj'
op|','
name|'prop'
op|'.'
name|'name'
op|','
name|'value'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'return'
name|'obj'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|marshal_object
dedent|''
name|'def'
name|'marshal_object'
op|'('
name|'self'
op|','
name|'obj'
op|','
name|'doc'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'doc'
op|':'
newline|'\n'
indent|'            '
name|'doc'
op|'='
name|'self'
op|'.'
name|'new_doc'
op|'('
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'doc'
op|':'
newline|'\n'
indent|'            '
name|'doc'
op|'='
name|'self'
op|'.'
name|'doc'
newline|'\n'
dedent|''
name|'obj_node'
op|'='
name|'doc'
op|'.'
name|'createElement'
op|'('
string|"'object'"
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'obj'
op|'.'
name|'id'
op|':'
newline|'\n'
indent|'            '
name|'obj_node'
op|'.'
name|'setAttribute'
op|'('
string|"'id'"
op|','
name|'obj'
op|'.'
name|'id'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'obj_node'
op|'.'
name|'setAttribute'
op|'('
string|"'class'"
op|','
string|"'%s.%s'"
op|'%'
op|'('
name|'obj'
op|'.'
name|'__class__'
op|'.'
name|'__module__'
op|','
nl|'\n'
name|'obj'
op|'.'
name|'__class__'
op|'.'
name|'__name__'
op|')'
op|')'
newline|'\n'
name|'root'
op|'='
name|'doc'
op|'.'
name|'documentElement'
newline|'\n'
name|'root'
op|'.'
name|'appendChild'
op|'('
name|'obj_node'
op|')'
newline|'\n'
name|'for'
name|'property'
name|'in'
name|'obj'
op|'.'
name|'properties'
op|'('
name|'hidden'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'prop_node'
op|'='
name|'doc'
op|'.'
name|'createElement'
op|'('
string|"'property'"
op|')'
newline|'\n'
name|'prop_node'
op|'.'
name|'setAttribute'
op|'('
string|"'name'"
op|','
name|'property'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'prop_node'
op|'.'
name|'setAttribute'
op|'('
string|"'type'"
op|','
name|'property'
op|'.'
name|'type_name'
op|')'
newline|'\n'
name|'value'
op|'='
name|'property'
op|'.'
name|'get_value_for_datastore'
op|'('
name|'obj'
op|')'
newline|'\n'
name|'if'
name|'value'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'value'
op|'='
name|'self'
op|'.'
name|'encode_value'
op|'('
name|'property'
op|','
name|'value'
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'value'
op|','
name|'list'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'save_list'
op|'('
name|'doc'
op|','
name|'value'
op|','
name|'prop_node'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'isinstance'
op|'('
name|'value'
op|','
name|'Node'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'prop_node'
op|'.'
name|'appendChild'
op|'('
name|'value'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'text_node'
op|'='
name|'doc'
op|'.'
name|'createTextNode'
op|'('
name|'str'
op|'('
name|'value'
op|')'
op|')'
newline|'\n'
name|'prop_node'
op|'.'
name|'appendChild'
op|'('
name|'text_node'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'obj_node'
op|'.'
name|'appendChild'
op|'('
name|'prop_node'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'doc'
newline|'\n'
nl|'\n'
DECL|member|unmarshal_object
dedent|''
name|'def'
name|'unmarshal_object'
op|'('
name|'self'
op|','
name|'fp'
op|','
name|'cls'
op|'='
name|'None'
op|','
name|'id'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'isinstance'
op|'('
name|'fp'
op|','
name|'str'
op|')'
name|'or'
name|'isinstance'
op|'('
name|'fp'
op|','
name|'unicode'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'doc'
op|'='
name|'parseString'
op|'('
name|'fp'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'doc'
op|'='
name|'parse'
op|'('
name|'fp'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'get_object_from_doc'
op|'('
name|'cls'
op|','
name|'id'
op|','
name|'doc'
op|')'
newline|'\n'
nl|'\n'
DECL|member|unmarshal_props
dedent|''
name|'def'
name|'unmarshal_props'
op|'('
name|'self'
op|','
name|'fp'
op|','
name|'cls'
op|'='
name|'None'
op|','
name|'id'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Same as unmarshalling an object, except it returns\n        from "get_props_from_doc"\n        """'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'fp'
op|','
name|'str'
op|')'
name|'or'
name|'isinstance'
op|'('
name|'fp'
op|','
name|'unicode'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'doc'
op|'='
name|'parseString'
op|'('
name|'fp'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'doc'
op|'='
name|'parse'
op|'('
name|'fp'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'get_props_from_doc'
op|'('
name|'cls'
op|','
name|'id'
op|','
name|'doc'
op|')'
newline|'\n'
nl|'\n'
DECL|member|delete_object
dedent|''
name|'def'
name|'delete_object'
op|'('
name|'self'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'url'
op|'='
string|'"/%s/%s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'db_name'
op|','
name|'obj'
op|'.'
name|'id'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'_make_request'
op|'('
string|'"DELETE"'
op|','
name|'url'
op|')'
newline|'\n'
nl|'\n'
DECL|member|set_key_value
dedent|''
name|'def'
name|'set_key_value'
op|'('
name|'self'
op|','
name|'obj'
op|','
name|'name'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'domain'
op|'.'
name|'put_attributes'
op|'('
name|'obj'
op|'.'
name|'id'
op|','
op|'{'
name|'name'
op|':'
name|'value'
op|'}'
op|','
name|'replace'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|delete_key_value
dedent|''
name|'def'
name|'delete_key_value'
op|'('
name|'self'
op|','
name|'obj'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'domain'
op|'.'
name|'delete_attributes'
op|'('
name|'obj'
op|'.'
name|'id'
op|','
name|'name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_key_value
dedent|''
name|'def'
name|'get_key_value'
op|'('
name|'self'
op|','
name|'obj'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'a'
op|'='
name|'self'
op|'.'
name|'domain'
op|'.'
name|'get_attributes'
op|'('
name|'obj'
op|'.'
name|'id'
op|','
name|'name'
op|')'
newline|'\n'
name|'if'
name|'a'
op|'.'
name|'has_key'
op|'('
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'a'
op|'['
name|'name'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'None'
newline|'\n'
nl|'\n'
DECL|member|get_raw_item
dedent|''
dedent|''
name|'def'
name|'get_raw_item'
op|'('
name|'self'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'domain'
op|'.'
name|'get_item'
op|'('
name|'obj'
op|'.'
name|'id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|set_property
dedent|''
name|'def'
name|'set_property'
op|'('
name|'self'
op|','
name|'prop'
op|','
name|'obj'
op|','
name|'name'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|get_property
dedent|''
name|'def'
name|'get_property'
op|'('
name|'self'
op|','
name|'prop'
op|','
name|'obj'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|load_object
dedent|''
name|'def'
name|'load_object'
op|'('
name|'self'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'obj'
op|'.'
name|'_loaded'
op|':'
newline|'\n'
indent|'            '
name|'obj'
op|'='
name|'obj'
op|'.'
name|'get_by_id'
op|'('
name|'obj'
op|'.'
name|'id'
op|')'
newline|'\n'
name|'obj'
op|'.'
name|'_loaded'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'return'
name|'obj'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
