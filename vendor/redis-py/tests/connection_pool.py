begin_unit
name|'import'
name|'redis'
newline|'\n'
name|'import'
name|'threading'
newline|'\n'
name|'import'
name|'time'
newline|'\n'
name|'import'
name|'unittest'
newline|'\n'
nl|'\n'
DECL|class|ConnectionPoolTestCase
name|'class'
name|'ConnectionPoolTestCase'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|test_multiple_connections
indent|'    '
name|'def'
name|'test_multiple_connections'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# 2 clients to the same host/port/db/pool should use the same connection'
nl|'\n'
indent|'        '
name|'pool'
op|'='
name|'redis'
op|'.'
name|'ConnectionPool'
op|'('
op|')'
newline|'\n'
name|'r1'
op|'='
name|'redis'
op|'.'
name|'Redis'
op|'('
name|'host'
op|'='
string|"'localhost'"
op|','
name|'port'
op|'='
number|'6379'
op|','
name|'db'
op|'='
number|'9'
op|','
name|'connection_pool'
op|'='
name|'pool'
op|')'
newline|'\n'
name|'r2'
op|'='
name|'redis'
op|'.'
name|'Redis'
op|'('
name|'host'
op|'='
string|"'localhost'"
op|','
name|'port'
op|'='
number|'6379'
op|','
name|'db'
op|'='
number|'9'
op|','
name|'connection_pool'
op|'='
name|'pool'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'r1'
op|'.'
name|'connection'
op|','
name|'r2'
op|'.'
name|'connection'
op|')'
newline|'\n'
nl|'\n'
comment|'# if one of them switches, they should have'
nl|'\n'
comment|'# separate conncetion objects'
nl|'\n'
name|'r2'
op|'.'
name|'select'
op|'('
name|'db'
op|'='
number|'10'
op|','
name|'host'
op|'='
string|"'localhost'"
op|','
name|'port'
op|'='
number|'6379'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotEqual'
op|'('
name|'r1'
op|'.'
name|'connection'
op|','
name|'r2'
op|'.'
name|'connection'
op|')'
newline|'\n'
nl|'\n'
name|'conns'
op|'='
op|'['
name|'r1'
op|'.'
name|'connection'
op|','
name|'r2'
op|'.'
name|'connection'
op|']'
newline|'\n'
name|'conns'
op|'.'
name|'sort'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# but returning to the original state shares the object again'
nl|'\n'
name|'r2'
op|'.'
name|'select'
op|'('
name|'db'
op|'='
number|'9'
op|','
name|'host'
op|'='
string|"'localhost'"
op|','
name|'port'
op|'='
number|'6379'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'r1'
op|'.'
name|'connection'
op|','
name|'r2'
op|'.'
name|'connection'
op|')'
newline|'\n'
nl|'\n'
comment|'# the connection manager should still have just 2 connections'
nl|'\n'
name|'mgr_conns'
op|'='
name|'pool'
op|'.'
name|'get_all_connections'
op|'('
op|')'
newline|'\n'
name|'mgr_conns'
op|'.'
name|'sort'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'conns'
op|','
name|'mgr_conns'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_threaded_workers
dedent|''
name|'def'
name|'test_threaded_workers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'r'
op|'='
name|'redis'
op|'.'
name|'Redis'
op|'('
name|'host'
op|'='
string|"'localhost'"
op|','
name|'port'
op|'='
number|'6379'
op|','
name|'db'
op|'='
number|'9'
op|')'
newline|'\n'
name|'r'
op|'.'
name|'set'
op|'('
string|"'a'"
op|','
string|"'foo'"
op|')'
newline|'\n'
name|'r'
op|'.'
name|'set'
op|'('
string|"'b'"
op|','
string|"'bar'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|_info_worker
name|'def'
name|'_info_worker'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'50'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'_'
op|'='
name|'r'
op|'.'
name|'info'
op|'('
op|')'
newline|'\n'
name|'time'
op|'.'
name|'sleep'
op|'('
number|'0.01'
op|')'
newline|'\n'
nl|'\n'
DECL|function|_keys_worker
dedent|''
dedent|''
name|'def'
name|'_keys_worker'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'50'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'_'
op|'='
name|'r'
op|'.'
name|'keys'
op|'('
op|')'
newline|'\n'
name|'time'
op|'.'
name|'sleep'
op|'('
number|'0.01'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'t1'
op|'='
name|'threading'
op|'.'
name|'Thread'
op|'('
name|'target'
op|'='
name|'_info_worker'
op|')'
newline|'\n'
name|'t2'
op|'='
name|'threading'
op|'.'
name|'Thread'
op|'('
name|'target'
op|'='
name|'_keys_worker'
op|')'
newline|'\n'
name|'t1'
op|'.'
name|'start'
op|'('
op|')'
newline|'\n'
name|'t2'
op|'.'
name|'start'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'i'
name|'in'
op|'['
name|'t1'
op|','
name|'t2'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'i'
op|'.'
name|'join'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
endmarker|''
end_unit
