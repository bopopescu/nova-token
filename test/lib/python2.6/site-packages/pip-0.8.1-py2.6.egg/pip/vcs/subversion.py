begin_unit
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'re'
newline|'\n'
name|'from'
name|'pip'
name|'import'
name|'call_subprocess'
newline|'\n'
name|'from'
name|'pip'
op|'.'
name|'index'
name|'import'
name|'Link'
newline|'\n'
name|'from'
name|'pip'
op|'.'
name|'util'
name|'import'
name|'rmtree'
op|','
name|'display_path'
newline|'\n'
name|'from'
name|'pip'
op|'.'
name|'log'
name|'import'
name|'logger'
newline|'\n'
name|'from'
name|'pip'
op|'.'
name|'vcs'
name|'import'
name|'vcs'
op|','
name|'VersionControl'
newline|'\n'
nl|'\n'
DECL|variable|_svn_xml_url_re
name|'_svn_xml_url_re'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|'\'url="([^"]+)"\''
op|')'
newline|'\n'
DECL|variable|_svn_rev_re
name|'_svn_rev_re'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|'\'committed-rev="(\\d+)"\''
op|')'
newline|'\n'
DECL|variable|_svn_url_re
name|'_svn_url_re'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"r'URL: (.+)'"
op|')'
newline|'\n'
DECL|variable|_svn_revision_re
name|'_svn_revision_re'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"r'Revision: (.+)'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|Subversion
name|'class'
name|'Subversion'
op|'('
name|'VersionControl'
op|')'
op|':'
newline|'\n'
DECL|variable|name
indent|'    '
name|'name'
op|'='
string|"'svn'"
newline|'\n'
DECL|variable|dirname
name|'dirname'
op|'='
string|"'.svn'"
newline|'\n'
DECL|variable|repo_name
name|'repo_name'
op|'='
string|"'checkout'"
newline|'\n'
DECL|variable|schemes
name|'schemes'
op|'='
op|'('
string|"'svn'"
op|','
string|"'svn+ssh'"
op|','
string|"'svn+http'"
op|','
string|"'svn+https'"
op|')'
newline|'\n'
DECL|variable|bundle_file
name|'bundle_file'
op|'='
string|"'svn-checkout.txt'"
newline|'\n'
DECL|variable|guide
name|'guide'
op|'='
op|'('
string|"'# This was an svn checkout; to make it a checkout again run:\\n'"
nl|'\n'
string|"'svn checkout --force -r %(rev)s %(url)s .\\n'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_info
name|'def'
name|'get_info'
op|'('
name|'self'
op|','
name|'location'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Returns (url, revision), where both are strings"""'
newline|'\n'
name|'assert'
name|'not'
name|'location'
op|'.'
name|'rstrip'
op|'('
string|"'/'"
op|')'
op|'.'
name|'endswith'
op|'('
name|'self'
op|'.'
name|'dirname'
op|')'
op|','
string|"'Bad directory: %s'"
op|'%'
name|'location'
newline|'\n'
name|'output'
op|'='
name|'call_subprocess'
op|'('
nl|'\n'
op|'['
name|'self'
op|'.'
name|'cmd'
op|','
string|"'info'"
op|','
name|'location'
op|']'
op|','
name|'show_stdout'
op|'='
name|'False'
op|','
name|'extra_environ'
op|'='
op|'{'
string|"'LANG'"
op|':'
string|"'C'"
op|'}'
op|')'
newline|'\n'
name|'match'
op|'='
name|'_svn_url_re'
op|'.'
name|'search'
op|'('
name|'output'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'match'
op|':'
newline|'\n'
indent|'            '
name|'logger'
op|'.'
name|'warn'
op|'('
string|"'Cannot determine URL of svn checkout %s'"
op|'%'
name|'display_path'
op|'('
name|'location'
op|')'
op|')'
newline|'\n'
name|'logger'
op|'.'
name|'info'
op|'('
string|"'Output that cannot be parsed: \\n%s'"
op|'%'
name|'output'
op|')'
newline|'\n'
name|'return'
name|'None'
op|','
name|'None'
newline|'\n'
dedent|''
name|'url'
op|'='
name|'match'
op|'.'
name|'group'
op|'('
number|'1'
op|')'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'match'
op|'='
name|'_svn_revision_re'
op|'.'
name|'search'
op|'('
name|'output'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'match'
op|':'
newline|'\n'
indent|'            '
name|'logger'
op|'.'
name|'warn'
op|'('
string|"'Cannot determine revision of svn checkout %s'"
op|'%'
name|'display_path'
op|'('
name|'location'
op|')'
op|')'
newline|'\n'
name|'logger'
op|'.'
name|'info'
op|'('
string|"'Output that cannot be parsed: \\n%s'"
op|'%'
name|'output'
op|')'
newline|'\n'
name|'return'
name|'url'
op|','
name|'None'
newline|'\n'
dedent|''
name|'return'
name|'url'
op|','
name|'match'
op|'.'
name|'group'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|parse_vcs_bundle_file
dedent|''
name|'def'
name|'parse_vcs_bundle_file'
op|'('
name|'self'
op|','
name|'content'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'line'
name|'in'
name|'content'
op|'.'
name|'splitlines'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'line'
op|'.'
name|'strip'
op|'('
op|')'
name|'or'
name|'line'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'startswith'
op|'('
string|"'#'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'match'
op|'='
name|'re'
op|'.'
name|'search'
op|'('
string|"r'^-r\\s*([^ ])?'"
op|','
name|'line'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'match'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'None'
op|','
name|'None'
newline|'\n'
dedent|''
name|'rev'
op|'='
name|'match'
op|'.'
name|'group'
op|'('
number|'1'
op|')'
newline|'\n'
name|'rest'
op|'='
name|'line'
op|'['
name|'match'
op|'.'
name|'end'
op|'('
op|')'
op|':'
op|']'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'split'
op|'('
name|'None'
op|','
number|'1'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'return'
name|'rest'
op|','
name|'rev'
newline|'\n'
dedent|''
name|'return'
name|'None'
op|','
name|'None'
newline|'\n'
nl|'\n'
DECL|member|unpack
dedent|''
name|'def'
name|'unpack'
op|'('
name|'self'
op|','
name|'location'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Check out the svn repository at the url to the destination location"""'
newline|'\n'
name|'url'
op|','
name|'rev'
op|'='
name|'self'
op|'.'
name|'get_url_rev'
op|'('
op|')'
newline|'\n'
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'Checking out svn repository %s to %s'"
op|'%'
op|'('
name|'url'
op|','
name|'location'
op|')'
op|')'
newline|'\n'
name|'logger'
op|'.'
name|'indent'
op|'+='
number|'2'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'location'
op|')'
op|':'
newline|'\n'
comment|"# Subversion doesn't like to check out over an existing directory"
nl|'\n'
comment|'# --force fixes this, but was only added in svn 1.5'
nl|'\n'
indent|'                '
name|'rmtree'
op|'('
name|'location'
op|')'
newline|'\n'
dedent|''
name|'call_subprocess'
op|'('
nl|'\n'
op|'['
name|'self'
op|'.'
name|'cmd'
op|','
string|"'checkout'"
op|','
name|'url'
op|','
name|'location'
op|']'
op|','
nl|'\n'
name|'filter_stdout'
op|'='
name|'self'
op|'.'
name|'_filter'
op|','
name|'show_stdout'
op|'='
name|'False'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'logger'
op|'.'
name|'indent'
op|'-='
number|'2'
newline|'\n'
nl|'\n'
DECL|member|export
dedent|''
dedent|''
name|'def'
name|'export'
op|'('
name|'self'
op|','
name|'location'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Export the svn repository at the url to the destination location"""'
newline|'\n'
name|'url'
op|','
name|'rev'
op|'='
name|'self'
op|'.'
name|'get_url_rev'
op|'('
op|')'
newline|'\n'
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'Exporting svn repository %s to %s'"
op|'%'
op|'('
name|'url'
op|','
name|'location'
op|')'
op|')'
newline|'\n'
name|'logger'
op|'.'
name|'indent'
op|'+='
number|'2'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'location'
op|')'
op|':'
newline|'\n'
comment|"# Subversion doesn't like to check out over an existing directory"
nl|'\n'
comment|'# --force fixes this, but was only added in svn 1.5'
nl|'\n'
indent|'                '
name|'rmtree'
op|'('
name|'location'
op|')'
newline|'\n'
dedent|''
name|'call_subprocess'
op|'('
nl|'\n'
op|'['
name|'self'
op|'.'
name|'cmd'
op|','
string|"'export'"
op|','
name|'url'
op|','
name|'location'
op|']'
op|','
nl|'\n'
name|'filter_stdout'
op|'='
name|'self'
op|'.'
name|'_filter'
op|','
name|'show_stdout'
op|'='
name|'False'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'logger'
op|'.'
name|'indent'
op|'-='
number|'2'
newline|'\n'
nl|'\n'
DECL|member|switch
dedent|''
dedent|''
name|'def'
name|'switch'
op|'('
name|'self'
op|','
name|'dest'
op|','
name|'url'
op|','
name|'rev_options'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'call_subprocess'
op|'('
nl|'\n'
op|'['
name|'self'
op|'.'
name|'cmd'
op|','
string|"'switch'"
op|']'
op|'+'
name|'rev_options'
op|'+'
op|'['
name|'url'
op|','
name|'dest'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|update
dedent|''
name|'def'
name|'update'
op|'('
name|'self'
op|','
name|'dest'
op|','
name|'rev_options'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'call_subprocess'
op|'('
nl|'\n'
op|'['
name|'self'
op|'.'
name|'cmd'
op|','
string|"'update'"
op|']'
op|'+'
name|'rev_options'
op|'+'
op|'['
name|'dest'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|obtain
dedent|''
name|'def'
name|'obtain'
op|'('
name|'self'
op|','
name|'dest'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'url'
op|','
name|'rev'
op|'='
name|'self'
op|'.'
name|'get_url_rev'
op|'('
op|')'
newline|'\n'
name|'if'
name|'rev'
op|':'
newline|'\n'
indent|'            '
name|'rev_options'
op|'='
op|'['
string|"'-r'"
op|','
name|'rev'
op|']'
newline|'\n'
name|'rev_display'
op|'='
string|"' (to revision %s)'"
op|'%'
name|'rev'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'rev_options'
op|'='
op|'['
op|']'
newline|'\n'
name|'rev_display'
op|'='
string|"''"
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'check_destination'
op|'('
name|'dest'
op|','
name|'url'
op|','
name|'rev_options'
op|','
name|'rev_display'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'Checking out %s%s to %s'"
nl|'\n'
op|'%'
op|'('
name|'url'
op|','
name|'rev_display'
op|','
name|'display_path'
op|'('
name|'dest'
op|')'
op|')'
op|')'
newline|'\n'
name|'call_subprocess'
op|'('
nl|'\n'
op|'['
name|'self'
op|'.'
name|'cmd'
op|','
string|"'checkout'"
op|','
string|"'-q'"
op|']'
op|'+'
name|'rev_options'
op|'+'
op|'['
name|'url'
op|','
name|'dest'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_location
dedent|''
dedent|''
name|'def'
name|'get_location'
op|'('
name|'self'
op|','
name|'dist'
op|','
name|'dependency_links'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'url'
name|'in'
name|'dependency_links'
op|':'
newline|'\n'
indent|'            '
name|'egg_fragment'
op|'='
name|'Link'
op|'('
name|'url'
op|')'
op|'.'
name|'egg_fragment'
newline|'\n'
name|'if'
name|'not'
name|'egg_fragment'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'if'
string|"'-'"
name|'in'
name|'egg_fragment'
op|':'
newline|'\n'
comment|'## FIXME: will this work when a package has - in the name?'
nl|'\n'
indent|'                '
name|'key'
op|'='
string|"'-'"
op|'.'
name|'join'
op|'('
name|'egg_fragment'
op|'.'
name|'split'
op|'('
string|"'-'"
op|')'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|')'
op|'.'
name|'lower'
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'key'
op|'='
name|'egg_fragment'
newline|'\n'
dedent|''
name|'if'
name|'key'
op|'=='
name|'dist'
op|'.'
name|'key'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'url'
op|'.'
name|'split'
op|'('
string|"'#'"
op|','
number|'1'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'None'
newline|'\n'
nl|'\n'
DECL|member|get_revision
dedent|''
name|'def'
name|'get_revision'
op|'('
name|'self'
op|','
name|'location'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""\n        Return the maximum revision for all files under a given location\n        """'
newline|'\n'
comment|'# Note: taken from setuptools.command.egg_info'
nl|'\n'
name|'revision'
op|'='
number|'0'
newline|'\n'
nl|'\n'
name|'for'
name|'base'
op|','
name|'dirs'
op|','
name|'files'
name|'in'
name|'os'
op|'.'
name|'walk'
op|'('
name|'location'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'dirname'
name|'not'
name|'in'
name|'dirs'
op|':'
newline|'\n'
indent|'                '
name|'dirs'
op|'['
op|':'
op|']'
op|'='
op|'['
op|']'
newline|'\n'
name|'continue'
comment|'# no sense walking uncontrolled subdirs'
newline|'\n'
dedent|''
name|'dirs'
op|'.'
name|'remove'
op|'('
name|'self'
op|'.'
name|'dirname'
op|')'
newline|'\n'
name|'entries_fn'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'base'
op|','
name|'self'
op|'.'
name|'dirname'
op|','
string|"'entries'"
op|')'
newline|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'entries_fn'
op|')'
op|':'
newline|'\n'
comment|'## FIXME: should we warn?'
nl|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'f'
op|'='
name|'open'
op|'('
name|'entries_fn'
op|')'
newline|'\n'
name|'data'
op|'='
name|'f'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'data'
op|'.'
name|'startswith'
op|'('
string|"'8'"
op|')'
name|'or'
name|'data'
op|'.'
name|'startswith'
op|'('
string|"'9'"
op|')'
name|'or'
name|'data'
op|'.'
name|'startswith'
op|'('
string|"'10'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'data'
op|'='
name|'map'
op|'('
name|'str'
op|'.'
name|'splitlines'
op|','
name|'data'
op|'.'
name|'split'
op|'('
string|"'\\n\\x0c\\n'"
op|')'
op|')'
newline|'\n'
name|'del'
name|'data'
op|'['
number|'0'
op|']'
op|'['
number|'0'
op|']'
comment|"# get rid of the '8'"
newline|'\n'
name|'dirurl'
op|'='
name|'data'
op|'['
number|'0'
op|']'
op|'['
number|'3'
op|']'
newline|'\n'
name|'revs'
op|'='
op|'['
name|'int'
op|'('
name|'d'
op|'['
number|'9'
op|']'
op|')'
name|'for'
name|'d'
name|'in'
name|'data'
name|'if'
name|'len'
op|'('
name|'d'
op|')'
op|'>'
number|'9'
name|'and'
name|'d'
op|'['
number|'9'
op|']'
op|']'
op|'+'
op|'['
number|'0'
op|']'
newline|'\n'
name|'if'
name|'revs'
op|':'
newline|'\n'
indent|'                    '
name|'localrev'
op|'='
name|'max'
op|'('
name|'revs'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'localrev'
op|'='
number|'0'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'data'
op|'.'
name|'startswith'
op|'('
string|"'<?xml'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'dirurl'
op|'='
name|'_svn_xml_url_re'
op|'.'
name|'search'
op|'('
name|'data'
op|')'
op|'.'
name|'group'
op|'('
number|'1'
op|')'
comment|'# get repository URL'
newline|'\n'
name|'revs'
op|'='
op|'['
name|'int'
op|'('
name|'m'
op|'.'
name|'group'
op|'('
number|'1'
op|')'
op|')'
name|'for'
name|'m'
name|'in'
name|'_svn_rev_re'
op|'.'
name|'finditer'
op|'('
name|'data'
op|')'
op|']'
op|'+'
op|'['
number|'0'
op|']'
newline|'\n'
name|'if'
name|'revs'
op|':'
newline|'\n'
indent|'                    '
name|'localrev'
op|'='
name|'max'
op|'('
name|'revs'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'localrev'
op|'='
number|'0'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'logger'
op|'.'
name|'warn'
op|'('
string|'"Unrecognized .svn/entries format; skipping %s"'
op|','
name|'base'
op|')'
newline|'\n'
name|'dirs'
op|'['
op|':'
op|']'
op|'='
op|'['
op|']'
newline|'\n'
name|'continue'
newline|'\n'
dedent|''
name|'if'
name|'base'
op|'=='
name|'location'
op|':'
newline|'\n'
indent|'                '
name|'base_url'
op|'='
name|'dirurl'
op|'+'
string|"'/'"
comment|'# save the root url'
newline|'\n'
dedent|''
name|'elif'
name|'not'
name|'dirurl'
op|'.'
name|'startswith'
op|'('
name|'base_url'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'dirs'
op|'['
op|':'
op|']'
op|'='
op|'['
op|']'
newline|'\n'
name|'continue'
comment|'# not part of the same svn tree, skip it'
newline|'\n'
dedent|''
name|'revision'
op|'='
name|'max'
op|'('
name|'revision'
op|','
name|'localrev'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'revision'
newline|'\n'
nl|'\n'
DECL|member|get_url_rev
dedent|''
name|'def'
name|'get_url_rev'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# hotfix the URL scheme after removing svn+ from svn+ssh:// readd it'
nl|'\n'
indent|'        '
name|'url'
op|','
name|'rev'
op|'='
name|'super'
op|'('
name|'Subversion'
op|','
name|'self'
op|')'
op|'.'
name|'get_url_rev'
op|'('
op|')'
newline|'\n'
name|'if'
name|'url'
op|'.'
name|'startswith'
op|'('
string|"'ssh://'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'url'
op|'='
string|"'svn+'"
op|'+'
name|'url'
newline|'\n'
dedent|''
name|'return'
name|'url'
op|','
name|'rev'
newline|'\n'
nl|'\n'
DECL|member|get_url
dedent|''
name|'def'
name|'get_url'
op|'('
name|'self'
op|','
name|'location'
op|')'
op|':'
newline|'\n'
comment|'# In cases where the source is in a subdirectory, not alongside setup.py'
nl|'\n'
comment|'# we have to look up in the location until we find a real setup.py'
nl|'\n'
indent|'        '
name|'orig_location'
op|'='
name|'location'
newline|'\n'
name|'while'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'location'
op|','
string|"'setup.py'"
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'last_location'
op|'='
name|'location'
newline|'\n'
name|'location'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'location'
op|')'
newline|'\n'
name|'if'
name|'location'
op|'=='
name|'last_location'
op|':'
newline|'\n'
comment|"# We've traversed up to the root of the filesystem without finding setup.py"
nl|'\n'
indent|'                '
name|'logger'
op|'.'
name|'warn'
op|'('
string|'"Could not find setup.py for directory %s (tried all parent directories)"'
nl|'\n'
op|'%'
name|'orig_location'
op|')'
newline|'\n'
name|'return'
name|'None'
newline|'\n'
dedent|''
dedent|''
name|'f'
op|'='
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'location'
op|','
name|'self'
op|'.'
name|'dirname'
op|','
string|"'entries'"
op|')'
op|')'
newline|'\n'
name|'data'
op|'='
name|'f'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'if'
name|'data'
op|'.'
name|'startswith'
op|'('
string|"'8'"
op|')'
name|'or'
name|'data'
op|'.'
name|'startswith'
op|'('
string|"'9'"
op|')'
name|'or'
name|'data'
op|'.'
name|'startswith'
op|'('
string|"'10'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'data'
op|'='
name|'map'
op|'('
name|'str'
op|'.'
name|'splitlines'
op|','
name|'data'
op|'.'
name|'split'
op|'('
string|"'\\n\\x0c\\n'"
op|')'
op|')'
newline|'\n'
name|'del'
name|'data'
op|'['
number|'0'
op|']'
op|'['
number|'0'
op|']'
comment|"# get rid of the '8'"
newline|'\n'
name|'return'
name|'data'
op|'['
number|'0'
op|']'
op|'['
number|'3'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'data'
op|'.'
name|'startswith'
op|'('
string|"'<?xml'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'match'
op|'='
name|'_svn_xml_url_re'
op|'.'
name|'search'
op|'('
name|'data'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'match'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'ValueError'
op|'('
string|"'Badly formatted data: %r'"
op|'%'
name|'data'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'match'
op|'.'
name|'group'
op|'('
number|'1'
op|')'
comment|'# get repository URL'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'logger'
op|'.'
name|'warn'
op|'('
string|'"Unrecognized .svn/entries format in %s"'
op|'%'
name|'location'
op|')'
newline|'\n'
comment|'# Or raise exception?'
nl|'\n'
name|'return'
name|'None'
newline|'\n'
nl|'\n'
DECL|member|get_tag_revs
dedent|''
dedent|''
name|'def'
name|'get_tag_revs'
op|'('
name|'self'
op|','
name|'svn_tag_url'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'stdout'
op|'='
name|'call_subprocess'
op|'('
nl|'\n'
op|'['
name|'self'
op|'.'
name|'cmd'
op|','
string|"'ls'"
op|','
string|"'-v'"
op|','
name|'svn_tag_url'
op|']'
op|','
name|'show_stdout'
op|'='
name|'False'
op|')'
newline|'\n'
name|'results'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'stdout'
op|'.'
name|'splitlines'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'parts'
op|'='
name|'line'
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'rev'
op|'='
name|'int'
op|'('
name|'parts'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'tag'
op|'='
name|'parts'
op|'['
op|'-'
number|'1'
op|']'
op|'.'
name|'strip'
op|'('
string|"'/'"
op|')'
newline|'\n'
name|'results'
op|'.'
name|'append'
op|'('
op|'('
name|'tag'
op|','
name|'rev'
op|')'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'results'
newline|'\n'
nl|'\n'
DECL|member|find_tag_match
dedent|''
name|'def'
name|'find_tag_match'
op|'('
name|'self'
op|','
name|'rev'
op|','
name|'tag_revs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'best_match_rev'
op|'='
name|'None'
newline|'\n'
name|'best_tag'
op|'='
name|'None'
newline|'\n'
name|'for'
name|'tag'
op|','
name|'tag_rev'
name|'in'
name|'tag_revs'
op|':'
newline|'\n'
indent|'            '
name|'if'
op|'('
name|'tag_rev'
op|'>'
name|'rev'
name|'and'
nl|'\n'
op|'('
name|'best_match_rev'
name|'is'
name|'None'
name|'or'
name|'best_match_rev'
op|'>'
name|'tag_rev'
op|')'
op|')'
op|':'
newline|'\n'
comment|'# FIXME: Is best_match > tag_rev really possible?'
nl|'\n'
comment|'# or is it a sign something is wacky?'
nl|'\n'
indent|'                '
name|'best_match_rev'
op|'='
name|'tag_rev'
newline|'\n'
name|'best_tag'
op|'='
name|'tag'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'best_tag'
newline|'\n'
nl|'\n'
DECL|member|get_src_requirement
dedent|''
name|'def'
name|'get_src_requirement'
op|'('
name|'self'
op|','
name|'dist'
op|','
name|'location'
op|','
name|'find_tags'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'repo'
op|'='
name|'self'
op|'.'
name|'get_url'
op|'('
name|'location'
op|')'
newline|'\n'
name|'if'
name|'repo'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'None'
newline|'\n'
dedent|''
name|'parts'
op|'='
name|'repo'
op|'.'
name|'split'
op|'('
string|"'/'"
op|')'
newline|'\n'
comment|'## FIXME: why not project name?'
nl|'\n'
name|'egg_project_name'
op|'='
name|'dist'
op|'.'
name|'egg_name'
op|'('
op|')'
op|'.'
name|'split'
op|'('
string|"'-'"
op|','
number|'1'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'rev'
op|'='
name|'self'
op|'.'
name|'get_revision'
op|'('
name|'location'
op|')'
newline|'\n'
name|'if'
name|'parts'
op|'['
op|'-'
number|'2'
op|']'
name|'in'
op|'('
string|"'tags'"
op|','
string|"'tag'"
op|')'
op|':'
newline|'\n'
comment|"# It's a tag, perfect!"
nl|'\n'
indent|'            '
name|'full_egg_name'
op|'='
string|"'%s-%s'"
op|'%'
op|'('
name|'egg_project_name'
op|','
name|'parts'
op|'['
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'parts'
op|'['
op|'-'
number|'2'
op|']'
name|'in'
op|'('
string|"'branches'"
op|','
string|"'branch'"
op|')'
op|':'
newline|'\n'
comment|"# It's a branch :("
nl|'\n'
indent|'            '
name|'full_egg_name'
op|'='
string|"'%s-%s-r%s'"
op|'%'
op|'('
name|'dist'
op|'.'
name|'egg_name'
op|'('
op|')'
op|','
name|'parts'
op|'['
op|'-'
number|'1'
op|']'
op|','
name|'rev'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'parts'
op|'['
op|'-'
number|'1'
op|']'
op|'=='
string|"'trunk'"
op|':'
newline|'\n'
comment|'# Trunk :-/'
nl|'\n'
indent|'            '
name|'full_egg_name'
op|'='
string|"'%s-dev_r%s'"
op|'%'
op|'('
name|'dist'
op|'.'
name|'egg_name'
op|'('
op|')'
op|','
name|'rev'
op|')'
newline|'\n'
name|'if'
name|'find_tags'
op|':'
newline|'\n'
indent|'                '
name|'tag_url'
op|'='
string|"'/'"
op|'.'
name|'join'
op|'('
name|'parts'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|')'
op|'+'
string|"'/tags'"
newline|'\n'
name|'tag_revs'
op|'='
name|'self'
op|'.'
name|'get_tag_revs'
op|'('
name|'tag_url'
op|')'
newline|'\n'
name|'match'
op|'='
name|'self'
op|'.'
name|'find_tag_match'
op|'('
name|'rev'
op|','
name|'tag_revs'
op|')'
newline|'\n'
name|'if'
name|'match'
op|':'
newline|'\n'
indent|'                    '
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'trunk checkout %s seems to be equivalent to tag %s'"
op|'%'
name|'match'
op|')'
newline|'\n'
name|'repo'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'tag_url'
op|','
name|'match'
op|')'
newline|'\n'
name|'full_egg_name'
op|'='
string|"'%s-%s'"
op|'%'
op|'('
name|'egg_project_name'
op|','
name|'match'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
comment|"# Don't know what it is"
nl|'\n'
indent|'            '
name|'logger'
op|'.'
name|'warn'
op|'('
string|"'svn URL does not fit normal structure (tags/branches/trunk): %s'"
op|'%'
name|'repo'
op|')'
newline|'\n'
name|'full_egg_name'
op|'='
string|"'%s-dev_r%s'"
op|'%'
op|'('
name|'egg_project_name'
op|','
name|'rev'
op|')'
newline|'\n'
dedent|''
name|'return'
string|"'svn+%s@%s#egg=%s'"
op|'%'
op|'('
name|'repo'
op|','
name|'rev'
op|','
name|'full_egg_name'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'vcs'
op|'.'
name|'register'
op|'('
name|'Subversion'
op|')'
newline|'\n'
endmarker|''
end_unit
