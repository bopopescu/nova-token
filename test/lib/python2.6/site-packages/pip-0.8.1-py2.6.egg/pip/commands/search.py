begin_unit
name|'import'
name|'sys'
newline|'\n'
name|'import'
name|'xmlrpclib'
newline|'\n'
name|'import'
name|'textwrap'
newline|'\n'
name|'import'
name|'pkg_resources'
newline|'\n'
name|'import'
name|'pip'
op|'.'
name|'download'
newline|'\n'
name|'from'
name|'pip'
op|'.'
name|'basecommand'
name|'import'
name|'Command'
newline|'\n'
name|'from'
name|'pip'
op|'.'
name|'util'
name|'import'
name|'get_terminal_size'
newline|'\n'
name|'from'
name|'pip'
op|'.'
name|'log'
name|'import'
name|'logger'
newline|'\n'
name|'from'
name|'distutils'
op|'.'
name|'version'
name|'import'
name|'StrictVersion'
op|','
name|'LooseVersion'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SearchCommand
name|'class'
name|'SearchCommand'
op|'('
name|'Command'
op|')'
op|':'
newline|'\n'
DECL|variable|name
indent|'    '
name|'name'
op|'='
string|"'search'"
newline|'\n'
DECL|variable|usage
name|'usage'
op|'='
string|"'%prog QUERY'"
newline|'\n'
DECL|variable|summary
name|'summary'
op|'='
string|"'Search PyPI'"
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'SearchCommand'
op|','
name|'self'
op|')'
op|'.'
name|'__init__'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'parser'
op|'.'
name|'add_option'
op|'('
nl|'\n'
string|"'--index'"
op|','
nl|'\n'
name|'dest'
op|'='
string|"'index'"
op|','
nl|'\n'
name|'metavar'
op|'='
string|"'URL'"
op|','
nl|'\n'
name|'default'
op|'='
string|"'http://pypi.python.org/pypi'"
op|','
nl|'\n'
name|'help'
op|'='
string|"'Base URL of Python Package Index (default %default)'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|run
dedent|''
name|'def'
name|'run'
op|'('
name|'self'
op|','
name|'options'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'args'
op|':'
newline|'\n'
indent|'            '
name|'logger'
op|'.'
name|'warn'
op|'('
string|"'ERROR: Missing required argument (search query).'"
op|')'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'query'
op|'='
string|"' '"
op|'.'
name|'join'
op|'('
name|'args'
op|')'
newline|'\n'
name|'index_url'
op|'='
name|'options'
op|'.'
name|'index'
newline|'\n'
nl|'\n'
name|'pypi_hits'
op|'='
name|'self'
op|'.'
name|'search'
op|'('
name|'query'
op|','
name|'index_url'
op|')'
newline|'\n'
name|'hits'
op|'='
name|'transform_hits'
op|'('
name|'pypi_hits'
op|')'
newline|'\n'
nl|'\n'
name|'terminal_width'
op|'='
name|'None'
newline|'\n'
name|'if'
name|'sys'
op|'.'
name|'stdout'
op|'.'
name|'isatty'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'terminal_width'
op|'='
name|'get_terminal_size'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'print_results'
op|'('
name|'hits'
op|','
name|'terminal_width'
op|'='
name|'terminal_width'
op|')'
newline|'\n'
nl|'\n'
DECL|member|search
dedent|''
name|'def'
name|'search'
op|'('
name|'self'
op|','
name|'query'
op|','
name|'index_url'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pypi'
op|'='
name|'xmlrpclib'
op|'.'
name|'ServerProxy'
op|'('
name|'index_url'
op|','
name|'pip'
op|'.'
name|'download'
op|'.'
name|'xmlrpclib_transport'
op|')'
newline|'\n'
name|'hits'
op|'='
name|'pypi'
op|'.'
name|'search'
op|'('
op|'{'
string|"'name'"
op|':'
name|'query'
op|','
string|"'summary'"
op|':'
name|'query'
op|'}'
op|','
string|"'or'"
op|')'
newline|'\n'
name|'return'
name|'hits'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|transform_hits
dedent|''
dedent|''
name|'def'
name|'transform_hits'
op|'('
name|'hits'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""\n    The list from pypi is really a list of versions. We want a list of\n    packages with the list of versions stored inline. This converts the\n    list from pypi into one we can use.\n    """'
newline|'\n'
name|'packages'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'hit'
name|'in'
name|'hits'
op|':'
newline|'\n'
indent|'        '
name|'name'
op|'='
name|'hit'
op|'['
string|"'name'"
op|']'
newline|'\n'
name|'summary'
op|'='
name|'hit'
op|'['
string|"'summary'"
op|']'
newline|'\n'
name|'version'
op|'='
name|'hit'
op|'['
string|"'version'"
op|']'
newline|'\n'
name|'score'
op|'='
name|'hit'
op|'['
string|"'_pypi_ordering'"
op|']'
newline|'\n'
nl|'\n'
name|'if'
name|'name'
name|'not'
name|'in'
name|'packages'
op|'.'
name|'keys'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'packages'
op|'['
name|'name'
op|']'
op|'='
op|'{'
string|"'name'"
op|':'
name|'name'
op|','
string|"'summary'"
op|':'
name|'summary'
op|','
string|"'versions'"
op|':'
op|'['
name|'version'
op|']'
op|','
string|"'score'"
op|':'
name|'score'
op|'}'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'packages'
op|'['
name|'name'
op|']'
op|'['
string|"'versions'"
op|']'
op|'.'
name|'append'
op|'('
name|'version'
op|')'
newline|'\n'
nl|'\n'
comment|'# if this is the highest version, replace summary and score'
nl|'\n'
name|'if'
name|'version'
op|'=='
name|'highest_version'
op|'('
name|'packages'
op|'['
name|'name'
op|']'
op|'['
string|"'versions'"
op|']'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'packages'
op|'['
name|'name'
op|']'
op|'['
string|"'summary'"
op|']'
op|'='
name|'summary'
newline|'\n'
name|'packages'
op|'['
name|'name'
op|']'
op|'['
string|"'score'"
op|']'
op|'='
name|'score'
newline|'\n'
nl|'\n'
comment|'# each record has a unique name now, so we will convert the dict into a list sorted by score'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'package_list'
op|'='
name|'sorted'
op|'('
name|'packages'
op|'.'
name|'values'
op|'('
op|')'
op|','
name|'lambda'
name|'x'
op|','
name|'y'
op|':'
name|'cmp'
op|'('
name|'y'
op|'['
string|"'score'"
op|']'
op|','
name|'x'
op|'['
string|"'score'"
op|']'
op|')'
op|')'
newline|'\n'
name|'return'
name|'package_list'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|print_results
dedent|''
name|'def'
name|'print_results'
op|'('
name|'hits'
op|','
name|'name_column_width'
op|'='
number|'25'
op|','
name|'terminal_width'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'installed_packages'
op|'='
op|'['
name|'p'
op|'.'
name|'project_name'
name|'for'
name|'p'
name|'in'
name|'pkg_resources'
op|'.'
name|'working_set'
op|']'
newline|'\n'
name|'for'
name|'hit'
name|'in'
name|'hits'
op|':'
newline|'\n'
indent|'        '
name|'name'
op|'='
name|'hit'
op|'['
string|"'name'"
op|']'
newline|'\n'
name|'summary'
op|'='
name|'hit'
op|'['
string|"'summary'"
op|']'
name|'or'
string|"''"
newline|'\n'
name|'if'
name|'terminal_width'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
comment|'# wrap and indent summary to fit terminal'
nl|'\n'
indent|'            '
name|'summary'
op|'='
name|'textwrap'
op|'.'
name|'wrap'
op|'('
name|'summary'
op|','
name|'terminal_width'
op|'-'
name|'name_column_width'
op|'-'
number|'5'
op|')'
newline|'\n'
name|'summary'
op|'='
op|'('
string|"'\\n'"
op|'+'
string|"' '"
op|'*'
op|'('
name|'name_column_width'
op|'+'
number|'3'
op|')'
op|')'
op|'.'
name|'join'
op|'('
name|'summary'
op|')'
newline|'\n'
dedent|''
name|'line'
op|'='
string|"'%s - %s'"
op|'%'
op|'('
name|'name'
op|'.'
name|'ljust'
op|'('
name|'name_column_width'
op|')'
op|','
name|'summary'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'logger'
op|'.'
name|'notify'
op|'('
name|'line'
op|')'
newline|'\n'
name|'if'
name|'name'
name|'in'
name|'installed_packages'
op|':'
newline|'\n'
indent|'                '
name|'dist'
op|'='
name|'pkg_resources'
op|'.'
name|'get_distribution'
op|'('
name|'name'
op|')'
newline|'\n'
name|'logger'
op|'.'
name|'indent'
op|'+='
number|'2'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                    '
name|'latest'
op|'='
name|'highest_version'
op|'('
name|'hit'
op|'['
string|"'versions'"
op|']'
op|')'
newline|'\n'
name|'if'
name|'dist'
op|'.'
name|'version'
op|'=='
name|'latest'
op|':'
newline|'\n'
indent|'                        '
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'INSTALLED: %s (latest)'"
op|'%'
name|'dist'
op|'.'
name|'version'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'INSTALLED: %s'"
op|'%'
name|'dist'
op|'.'
name|'version'
op|')'
newline|'\n'
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'LATEST:    %s'"
op|'%'
name|'latest'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'                    '
name|'logger'
op|'.'
name|'indent'
op|'-='
number|'2'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'except'
name|'UnicodeEncodeError'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|compare_versions
dedent|''
dedent|''
dedent|''
name|'def'
name|'compare_versions'
op|'('
name|'version1'
op|','
name|'version2'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'try'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'cmp'
op|'('
name|'StrictVersion'
op|'('
name|'version1'
op|')'
op|','
name|'StrictVersion'
op|'('
name|'version2'
op|')'
op|')'
newline|'\n'
comment|'# in case of abnormal version number, fall back to LooseVersion'
nl|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'cmp'
op|'('
name|'LooseVersion'
op|'('
name|'version1'
op|')'
op|','
name|'LooseVersion'
op|'('
name|'version2'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|highest_version
dedent|''
dedent|''
name|'def'
name|'highest_version'
op|'('
name|'versions'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'reduce'
op|'('
op|'('
name|'lambda'
name|'v1'
op|','
name|'v2'
op|':'
name|'compare_versions'
op|'('
name|'v1'
op|','
name|'v2'
op|')'
op|'=='
number|'1'
name|'and'
name|'v1'
name|'or'
name|'v2'
op|')'
op|','
name|'versions'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
name|'SearchCommand'
op|'('
op|')'
newline|'\n'
endmarker|''
end_unit
