begin_unit
name|'import'
name|'sys'
newline|'\n'
name|'import'
name|'re'
newline|'\n'
name|'import'
name|'fnmatch'
newline|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'shutil'
newline|'\n'
name|'import'
name|'zipfile'
newline|'\n'
name|'from'
name|'pip'
op|'.'
name|'util'
name|'import'
name|'display_path'
op|','
name|'backup_dir'
newline|'\n'
name|'from'
name|'pip'
op|'.'
name|'log'
name|'import'
name|'logger'
newline|'\n'
name|'from'
name|'pip'
op|'.'
name|'exceptions'
name|'import'
name|'InstallationError'
newline|'\n'
name|'from'
name|'pip'
op|'.'
name|'basecommand'
name|'import'
name|'Command'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ZipCommand
name|'class'
name|'ZipCommand'
op|'('
name|'Command'
op|')'
op|':'
newline|'\n'
DECL|variable|name
indent|'    '
name|'name'
op|'='
string|"'zip'"
newline|'\n'
DECL|variable|usage
name|'usage'
op|'='
string|"'%prog [OPTIONS] PACKAGE_NAMES...'"
newline|'\n'
DECL|variable|summary
name|'summary'
op|'='
string|"'Zip individual packages'"
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'ZipCommand'
op|','
name|'self'
op|')'
op|'.'
name|'__init__'
op|'('
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'name'
op|'=='
string|"'zip'"
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'parser'
op|'.'
name|'add_option'
op|'('
nl|'\n'
string|"'--unzip'"
op|','
nl|'\n'
name|'action'
op|'='
string|"'store_true'"
op|','
nl|'\n'
name|'dest'
op|'='
string|"'unzip'"
op|','
nl|'\n'
name|'help'
op|'='
string|"'Unzip (rather than zip) a package'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'parser'
op|'.'
name|'add_option'
op|'('
nl|'\n'
string|"'--zip'"
op|','
nl|'\n'
name|'action'
op|'='
string|"'store_false'"
op|','
nl|'\n'
name|'dest'
op|'='
string|"'unzip'"
op|','
nl|'\n'
name|'default'
op|'='
name|'True'
op|','
nl|'\n'
name|'help'
op|'='
string|"'Zip (rather than unzip) a package'"
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'parser'
op|'.'
name|'add_option'
op|'('
nl|'\n'
string|"'--no-pyc'"
op|','
nl|'\n'
name|'action'
op|'='
string|"'store_true'"
op|','
nl|'\n'
name|'dest'
op|'='
string|"'no_pyc'"
op|','
nl|'\n'
name|'help'
op|'='
string|"'Do not include .pyc files in zip files (useful on Google App Engine)'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'parser'
op|'.'
name|'add_option'
op|'('
nl|'\n'
string|"'-l'"
op|','
string|"'--list'"
op|','
nl|'\n'
name|'action'
op|'='
string|"'store_true'"
op|','
nl|'\n'
name|'dest'
op|'='
string|"'list'"
op|','
nl|'\n'
name|'help'
op|'='
string|"'List the packages available, and their zip status'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'parser'
op|'.'
name|'add_option'
op|'('
nl|'\n'
string|"'--sort-files'"
op|','
nl|'\n'
name|'action'
op|'='
string|"'store_true'"
op|','
nl|'\n'
name|'dest'
op|'='
string|"'sort_files'"
op|','
nl|'\n'
name|'help'
op|'='
string|"'With --list, sort packages according to how many files they contain'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'parser'
op|'.'
name|'add_option'
op|'('
nl|'\n'
string|"'--path'"
op|','
nl|'\n'
name|'action'
op|'='
string|"'append'"
op|','
nl|'\n'
name|'dest'
op|'='
string|"'paths'"
op|','
nl|'\n'
name|'help'
op|'='
string|"'Restrict operations to the given paths (may include wildcards)'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'parser'
op|'.'
name|'add_option'
op|'('
nl|'\n'
string|"'-n'"
op|','
string|"'--simulate'"
op|','
nl|'\n'
name|'action'
op|'='
string|"'store_true'"
op|','
nl|'\n'
name|'help'
op|'='
string|"'Do not actually perform the zip/unzip operation'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|paths
dedent|''
name|'def'
name|'paths'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""All the entries of sys.path, possibly restricted by --path"""'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'select_paths'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'sys'
op|'.'
name|'path'
newline|'\n'
dedent|''
name|'result'
op|'='
op|'['
op|']'
newline|'\n'
name|'match_any'
op|'='
name|'set'
op|'('
op|')'
newline|'\n'
name|'for'
name|'path'
name|'in'
name|'sys'
op|'.'
name|'path'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'normcase'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'abspath'
op|'('
name|'path'
op|')'
op|')'
newline|'\n'
name|'for'
name|'match'
name|'in'
name|'self'
op|'.'
name|'select_paths'
op|':'
newline|'\n'
indent|'                '
name|'match'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'normcase'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'abspath'
op|'('
name|'match'
op|')'
op|')'
newline|'\n'
name|'if'
string|"'*'"
name|'in'
name|'match'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'re'
op|'.'
name|'search'
op|'('
name|'fnmatch'
op|'.'
name|'translate'
op|'('
name|'match'
op|'+'
string|"'*'"
op|')'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'result'
op|'.'
name|'append'
op|'('
name|'path'
op|')'
newline|'\n'
name|'match_any'
op|'.'
name|'add'
op|'('
name|'match'
op|')'
newline|'\n'
name|'break'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'path'
op|'.'
name|'startswith'
op|'('
name|'match'
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'result'
op|'.'
name|'append'
op|'('
name|'path'
op|')'
newline|'\n'
name|'match_any'
op|'.'
name|'add'
op|'('
name|'match'
op|')'
newline|'\n'
name|'break'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'logger'
op|'.'
name|'debug'
op|'('
string|'"Skipping path %s because it doesn\'t match %s"'
nl|'\n'
op|'%'
op|'('
name|'path'
op|','
string|"', '"
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'select_paths'
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'for'
name|'match'
name|'in'
name|'self'
op|'.'
name|'select_paths'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'match'
name|'not'
name|'in'
name|'match_any'
name|'and'
string|"'*'"
name|'not'
name|'in'
name|'match'
op|':'
newline|'\n'
indent|'                '
name|'result'
op|'.'
name|'append'
op|'('
name|'match'
op|')'
newline|'\n'
name|'logger'
op|'.'
name|'debug'
op|'('
string|'"Adding path %s because it doesn\'t match anything already on sys.path"'
nl|'\n'
op|'%'
name|'match'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'result'
newline|'\n'
nl|'\n'
DECL|member|run
dedent|''
name|'def'
name|'run'
op|'('
name|'self'
op|','
name|'options'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'select_paths'
op|'='
name|'options'
op|'.'
name|'paths'
newline|'\n'
name|'self'
op|'.'
name|'simulate'
op|'='
name|'options'
op|'.'
name|'simulate'
newline|'\n'
name|'if'
name|'options'
op|'.'
name|'list'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'list'
op|'('
name|'options'
op|','
name|'args'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'args'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'InstallationError'
op|'('
nl|'\n'
string|"'You must give at least one package to zip or unzip'"
op|')'
newline|'\n'
dedent|''
name|'packages'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'arg'
name|'in'
name|'args'
op|':'
newline|'\n'
indent|'            '
name|'module_name'
op|','
name|'filename'
op|'='
name|'self'
op|'.'
name|'find_package'
op|'('
name|'arg'
op|')'
newline|'\n'
name|'if'
name|'options'
op|'.'
name|'unzip'
name|'and'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'InstallationError'
op|'('
nl|'\n'
string|"'The module %s (in %s) is not a zip file; cannot be unzipped'"
nl|'\n'
op|'%'
op|'('
name|'module_name'
op|','
name|'filename'
op|')'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'not'
name|'options'
op|'.'
name|'unzip'
name|'and'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'InstallationError'
op|'('
nl|'\n'
string|"'The module %s (in %s) is not a directory; cannot be zipped'"
nl|'\n'
op|'%'
op|'('
name|'module_name'
op|','
name|'filename'
op|')'
op|')'
newline|'\n'
dedent|''
name|'packages'
op|'.'
name|'append'
op|'('
op|'('
name|'module_name'
op|','
name|'filename'
op|')'
op|')'
newline|'\n'
dedent|''
name|'last_status'
op|'='
name|'None'
newline|'\n'
name|'for'
name|'module_name'
op|','
name|'filename'
name|'in'
name|'packages'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'options'
op|'.'
name|'unzip'
op|':'
newline|'\n'
indent|'                '
name|'last_status'
op|'='
name|'self'
op|'.'
name|'unzip_package'
op|'('
name|'module_name'
op|','
name|'filename'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'last_status'
op|'='
name|'self'
op|'.'
name|'zip_package'
op|'('
name|'module_name'
op|','
name|'filename'
op|','
name|'options'
op|'.'
name|'no_pyc'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'last_status'
newline|'\n'
nl|'\n'
DECL|member|unzip_package
dedent|''
name|'def'
name|'unzip_package'
op|'('
name|'self'
op|','
name|'module_name'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'zip_filename'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'filename'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'zip_filename'
op|')'
name|'and'
name|'zipfile'
op|'.'
name|'is_zipfile'
op|'('
name|'zip_filename'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'InstallationError'
op|'('
nl|'\n'
string|"'Module %s (in %s) isn\\'t located in a zip file in %s'"
nl|'\n'
op|'%'
op|'('
name|'module_name'
op|','
name|'filename'
op|','
name|'zip_filename'
op|')'
op|')'
newline|'\n'
dedent|''
name|'package_path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'zip_filename'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'package_path'
name|'in'
name|'self'
op|'.'
name|'paths'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'logger'
op|'.'
name|'warn'
op|'('
nl|'\n'
string|"'Unpacking %s into %s, but %s is not on sys.path'"
nl|'\n'
op|'%'
op|'('
name|'display_path'
op|'('
name|'zip_filename'
op|')'
op|','
name|'display_path'
op|'('
name|'package_path'
op|')'
op|','
nl|'\n'
name|'display_path'
op|'('
name|'package_path'
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'Unzipping %s (in %s)'"
op|'%'
op|'('
name|'module_name'
op|','
name|'display_path'
op|'('
name|'zip_filename'
op|')'
op|')'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'simulate'
op|':'
newline|'\n'
indent|'            '
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'Skipping remaining operations because of --simulate'"
op|')'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'logger'
op|'.'
name|'indent'
op|'+='
number|'2'
newline|'\n'
name|'try'
op|':'
newline|'\n'
comment|'## FIXME: this should be undoable:'
nl|'\n'
indent|'            '
name|'zip'
op|'='
name|'zipfile'
op|'.'
name|'ZipFile'
op|'('
name|'zip_filename'
op|')'
newline|'\n'
name|'to_save'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'name'
name|'in'
name|'zip'
op|'.'
name|'namelist'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'name'
op|'.'
name|'startswith'
op|'('
name|'module_name'
op|'+'
name|'os'
op|'.'
name|'path'
op|'.'
name|'sep'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'content'
op|'='
name|'zip'
op|'.'
name|'read'
op|'('
name|'name'
op|')'
newline|'\n'
name|'dest'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'package_path'
op|','
name|'name'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'dest'
op|')'
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'dest'
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'content'
name|'and'
name|'dest'
op|'.'
name|'endswith'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'sep'
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'dest'
op|')'
op|':'
newline|'\n'
indent|'                            '
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'dest'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'f'
op|'='
name|'open'
op|'('
name|'dest'
op|','
string|"'wb'"
op|')'
newline|'\n'
name|'f'
op|'.'
name|'write'
op|'('
name|'content'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'to_save'
op|'.'
name|'append'
op|'('
op|'('
name|'name'
op|','
name|'zip'
op|'.'
name|'read'
op|'('
name|'name'
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'zip'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'if'
name|'not'
name|'to_save'
op|':'
newline|'\n'
indent|'                '
name|'logger'
op|'.'
name|'info'
op|'('
string|"'Removing now-empty zip file %s'"
op|'%'
name|'display_path'
op|'('
name|'zip_filename'
op|')'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'unlink'
op|'('
name|'zip_filename'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'remove_filename_from_pth'
op|'('
name|'zip_filename'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'logger'
op|'.'
name|'info'
op|'('
string|"'Removing entries in %s/ from zip file %s'"
op|'%'
op|'('
name|'module_name'
op|','
name|'display_path'
op|'('
name|'zip_filename'
op|')'
op|')'
op|')'
newline|'\n'
name|'zip'
op|'='
name|'zipfile'
op|'.'
name|'ZipFile'
op|'('
name|'zip_filename'
op|','
string|"'w'"
op|')'
newline|'\n'
name|'for'
name|'name'
op|','
name|'content'
name|'in'
name|'to_save'
op|':'
newline|'\n'
indent|'                    '
name|'zip'
op|'.'
name|'writestr'
op|'('
name|'name'
op|','
name|'content'
op|')'
newline|'\n'
dedent|''
name|'zip'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'logger'
op|'.'
name|'indent'
op|'-='
number|'2'
newline|'\n'
nl|'\n'
DECL|member|zip_package
dedent|''
dedent|''
name|'def'
name|'zip_package'
op|'('
name|'self'
op|','
name|'module_name'
op|','
name|'filename'
op|','
name|'no_pyc'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'orig_filename'
op|'='
name|'filename'
newline|'\n'
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'Zip %s (in %s)'"
op|'%'
op|'('
name|'module_name'
op|','
name|'display_path'
op|'('
name|'filename'
op|')'
op|')'
op|')'
newline|'\n'
name|'logger'
op|'.'
name|'indent'
op|'+='
number|'2'
newline|'\n'
name|'if'
name|'filename'
op|'.'
name|'endswith'
op|'('
string|"'.egg'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'dest_filename'
op|'='
name|'filename'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'dest_filename'
op|'='
name|'filename'
op|'+'
string|"'.zip'"
newline|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
comment|'## FIXME: I think this needs to be undoable:'
nl|'\n'
indent|'            '
name|'if'
name|'filename'
op|'=='
name|'dest_filename'
op|':'
newline|'\n'
indent|'                '
name|'filename'
op|'='
name|'backup_dir'
op|'('
name|'orig_filename'
op|')'
newline|'\n'
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'Moving %s aside to %s'"
op|'%'
op|'('
name|'orig_filename'
op|','
name|'filename'
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'simulate'
op|':'
newline|'\n'
indent|'                    '
name|'shutil'
op|'.'
name|'move'
op|'('
name|'orig_filename'
op|','
name|'filename'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'logger'
op|'.'
name|'info'
op|'('
string|"'Creating zip file in %s'"
op|'%'
name|'display_path'
op|'('
name|'dest_filename'
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'simulate'
op|':'
newline|'\n'
indent|'                    '
name|'zip'
op|'='
name|'zipfile'
op|'.'
name|'ZipFile'
op|'('
name|'dest_filename'
op|','
string|"'w'"
op|')'
newline|'\n'
name|'zip'
op|'.'
name|'writestr'
op|'('
name|'module_name'
op|'+'
string|"'/'"
op|','
string|"''"
op|')'
newline|'\n'
name|'for'
name|'dirpath'
op|','
name|'dirnames'
op|','
name|'filenames'
name|'in'
name|'os'
op|'.'
name|'walk'
op|'('
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'if'
name|'no_pyc'
op|':'
newline|'\n'
indent|'                            '
name|'filenames'
op|'='
op|'['
name|'f'
name|'for'
name|'f'
name|'in'
name|'filenames'
nl|'\n'
name|'if'
name|'not'
name|'f'
op|'.'
name|'lower'
op|'('
op|')'
op|'.'
name|'endswith'
op|'('
string|"'.pyc'"
op|')'
op|']'
newline|'\n'
dedent|''
name|'for'
name|'fns'
op|','
name|'is_dir'
name|'in'
op|'['
op|'('
name|'dirnames'
op|','
name|'True'
op|')'
op|','
op|'('
name|'filenames'
op|','
name|'False'
op|')'
op|']'
op|':'
newline|'\n'
indent|'                            '
name|'for'
name|'fn'
name|'in'
name|'fns'
op|':'
newline|'\n'
indent|'                                '
name|'full'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'dirpath'
op|','
name|'fn'
op|')'
newline|'\n'
name|'dest'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'module_name'
op|','
name|'dirpath'
op|'['
name|'len'
op|'('
name|'filename'
op|')'
op|':'
op|']'
op|'.'
name|'lstrip'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'sep'
op|')'
op|','
name|'fn'
op|')'
newline|'\n'
name|'if'
name|'is_dir'
op|':'
newline|'\n'
indent|'                                    '
name|'zip'
op|'.'
name|'writestr'
op|'('
name|'dest'
op|'+'
string|"'/'"
op|','
string|"''"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                                    '
name|'zip'
op|'.'
name|'write'
op|'('
name|'full'
op|','
name|'dest'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
dedent|''
name|'zip'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
dedent|''
name|'logger'
op|'.'
name|'info'
op|'('
string|"'Removing old directory %s'"
op|'%'
name|'display_path'
op|'('
name|'filename'
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'simulate'
op|':'
newline|'\n'
indent|'                    '
name|'shutil'
op|'.'
name|'rmtree'
op|'('
name|'filename'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'except'
op|':'
newline|'\n'
comment|'## FIXME: need to do an undo here'
nl|'\n'
indent|'                '
name|'raise'
newline|'\n'
comment|'## FIXME: should also be undone:'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'add_filename_to_pth'
op|'('
name|'dest_filename'
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'            '
name|'logger'
op|'.'
name|'indent'
op|'-='
number|'2'
newline|'\n'
nl|'\n'
DECL|member|remove_filename_from_pth
dedent|''
dedent|''
name|'def'
name|'remove_filename_from_pth'
op|'('
name|'self'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'pth'
name|'in'
name|'self'
op|'.'
name|'pth_files'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'f'
op|'='
name|'open'
op|'('
name|'pth'
op|','
string|"'r'"
op|')'
newline|'\n'
name|'lines'
op|'='
name|'f'
op|'.'
name|'readlines'
op|'('
op|')'
newline|'\n'
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'new_lines'
op|'='
op|'['
nl|'\n'
name|'l'
name|'for'
name|'l'
name|'in'
name|'lines'
name|'if'
name|'l'
op|'.'
name|'strip'
op|'('
op|')'
op|'!='
name|'filename'
op|']'
newline|'\n'
name|'if'
name|'lines'
op|'!='
name|'new_lines'
op|':'
newline|'\n'
indent|'                '
name|'logger'
op|'.'
name|'info'
op|'('
string|"'Removing reference to %s from .pth file %s'"
nl|'\n'
op|'%'
op|'('
name|'display_path'
op|'('
name|'filename'
op|')'
op|','
name|'display_path'
op|'('
name|'pth'
op|')'
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'filter'
op|'('
name|'None'
op|','
name|'new_lines'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'logger'
op|'.'
name|'info'
op|'('
string|"'%s file would be empty: deleting'"
op|'%'
name|'display_path'
op|'('
name|'pth'
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'simulate'
op|':'
newline|'\n'
indent|'                        '
name|'os'
op|'.'
name|'unlink'
op|'('
name|'pth'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'not'
name|'self'
op|'.'
name|'simulate'
op|':'
newline|'\n'
indent|'                        '
name|'f'
op|'='
name|'open'
op|'('
name|'pth'
op|','
string|"'wb'"
op|')'
newline|'\n'
name|'f'
op|'.'
name|'writelines'
op|'('
name|'new_lines'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
newline|'\n'
dedent|''
dedent|''
name|'logger'
op|'.'
name|'warn'
op|'('
string|"'Cannot find a reference to %s in any .pth file'"
op|'%'
name|'display_path'
op|'('
name|'filename'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|add_filename_to_pth
dedent|''
name|'def'
name|'add_filename_to_pth'
op|'('
name|'self'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'filename'
op|')'
newline|'\n'
name|'dest'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'path'
op|','
name|'filename'
op|'+'
string|"'.pth'"
op|')'
newline|'\n'
name|'if'
name|'path'
name|'not'
name|'in'
name|'self'
op|'.'
name|'paths'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'logger'
op|'.'
name|'warn'
op|'('
string|"'Adding .pth file %s, but it is not on sys.path'"
op|'%'
name|'display_path'
op|'('
name|'dest'
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'self'
op|'.'
name|'simulate'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'dest'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'f'
op|'='
name|'open'
op|'('
name|'dest'
op|')'
newline|'\n'
name|'lines'
op|'='
name|'f'
op|'.'
name|'readlines'
op|'('
op|')'
newline|'\n'
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'if'
name|'lines'
name|'and'
name|'not'
name|'lines'
op|'['
op|'-'
number|'1'
op|']'
op|'.'
name|'endswith'
op|'('
string|"'\\n'"
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'lines'
op|'['
op|'-'
number|'1'
op|']'
op|'+='
string|"'\\n'"
newline|'\n'
dedent|''
name|'lines'
op|'.'
name|'append'
op|'('
name|'filename'
op|'+'
string|"'\\n'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'lines'
op|'='
op|'['
name|'filename'
op|'+'
string|"'\\n'"
op|']'
newline|'\n'
dedent|''
name|'f'
op|'='
name|'open'
op|'('
name|'dest'
op|','
string|"'wb'"
op|')'
newline|'\n'
name|'f'
op|'.'
name|'writelines'
op|'('
name|'lines'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|pth_files
dedent|''
dedent|''
name|'def'
name|'pth_files'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'path'
name|'in'
name|'self'
op|'.'
name|'paths'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'path'
op|')'
name|'or'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'for'
name|'filename'
name|'in'
name|'os'
op|'.'
name|'listdir'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'filename'
op|'.'
name|'endswith'
op|'('
string|"'.pth'"
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'yield'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'path'
op|','
name|'filename'
op|')'
newline|'\n'
nl|'\n'
DECL|member|find_package
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'find_package'
op|'('
name|'self'
op|','
name|'package'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'path'
name|'in'
name|'self'
op|'.'
name|'paths'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'full'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'path'
op|','
name|'package'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'full'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'package'
op|','
name|'full'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'path'
op|')'
name|'and'
name|'zipfile'
op|'.'
name|'is_zipfile'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'zip'
op|'='
name|'zipfile'
op|'.'
name|'ZipFile'
op|'('
name|'path'
op|','
string|"'r'"
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                    '
name|'zip'
op|'.'
name|'read'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'package'
op|','
string|"'__init__.py'"
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'KeyError'
op|':'
newline|'\n'
indent|'                    '
name|'pass'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'zip'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'return'
name|'package'
op|','
name|'full'
newline|'\n'
dedent|''
name|'zip'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
comment|'## FIXME: need special error for package.py case:'
nl|'\n'
dedent|''
dedent|''
name|'raise'
name|'InstallationError'
op|'('
nl|'\n'
string|"'No package with the name %s found'"
op|'%'
name|'package'
op|')'
newline|'\n'
nl|'\n'
DECL|member|list
dedent|''
name|'def'
name|'list'
op|'('
name|'self'
op|','
name|'options'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'args'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'InstallationError'
op|'('
nl|'\n'
string|"'You cannot give an argument with --list'"
op|')'
newline|'\n'
dedent|''
name|'for'
name|'path'
name|'in'
name|'sorted'
op|'('
name|'self'
op|'.'
name|'paths'
op|'('
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'basename'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'path'
op|'.'
name|'rstrip'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'sep'
op|')'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'path'
op|')'
name|'and'
name|'zipfile'
op|'.'
name|'is_zipfile'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'path'
op|')'
name|'not'
name|'in'
name|'self'
op|'.'
name|'paths'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'Zipped egg: %s'"
op|'%'
name|'display_path'
op|'('
name|'path'
op|')'
op|')'
newline|'\n'
dedent|''
name|'continue'
newline|'\n'
dedent|''
name|'if'
op|'('
name|'basename'
op|'!='
string|"'site-packages'"
name|'and'
name|'basename'
op|'!='
string|"'dist-packages'"
nl|'\n'
name|'and'
name|'not'
name|'path'
op|'.'
name|'replace'
op|'('
string|"'\\\\'"
op|','
string|"'/'"
op|')'
op|'.'
name|'endswith'
op|'('
string|"'lib/python'"
op|')'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'In %s:'"
op|'%'
name|'display_path'
op|'('
name|'path'
op|')'
op|')'
newline|'\n'
name|'logger'
op|'.'
name|'indent'
op|'+='
number|'2'
newline|'\n'
name|'zipped'
op|'='
op|'['
op|']'
newline|'\n'
name|'unzipped'
op|'='
op|'['
op|']'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'for'
name|'filename'
name|'in'
name|'sorted'
op|'('
name|'os'
op|'.'
name|'listdir'
op|'('
name|'path'
op|')'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'ext'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'splitext'
op|'('
name|'filename'
op|')'
op|'['
number|'1'
op|']'
op|'.'
name|'lower'
op|'('
op|')'
newline|'\n'
name|'if'
name|'ext'
name|'in'
op|'('
string|"'.pth'"
op|','
string|"'.egg-info'"
op|','
string|"'.egg-link'"
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'continue'
newline|'\n'
dedent|''
name|'if'
name|'ext'
op|'=='
string|"'.py'"
op|':'
newline|'\n'
indent|'                        '
name|'logger'
op|'.'
name|'info'
op|'('
string|"'Not displaying %s: not a package'"
op|'%'
name|'display_path'
op|'('
name|'filename'
op|')'
op|')'
newline|'\n'
name|'continue'
newline|'\n'
dedent|''
name|'full'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'path'
op|','
name|'filename'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'full'
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'unzipped'
op|'.'
name|'append'
op|'('
op|'('
name|'filename'
op|','
name|'self'
op|'.'
name|'count_package'
op|'('
name|'full'
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'zipfile'
op|'.'
name|'is_zipfile'
op|'('
name|'full'
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'zipped'
op|'.'
name|'append'
op|'('
name|'filename'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'logger'
op|'.'
name|'info'
op|'('
string|"'Unknown file: %s'"
op|'%'
name|'display_path'
op|'('
name|'filename'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'zipped'
op|':'
newline|'\n'
indent|'                    '
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'Zipped packages:'"
op|')'
newline|'\n'
name|'logger'
op|'.'
name|'indent'
op|'+='
number|'2'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                        '
name|'for'
name|'filename'
name|'in'
name|'zipped'
op|':'
newline|'\n'
indent|'                            '
name|'logger'
op|'.'
name|'notify'
op|'('
name|'filename'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'                        '
name|'logger'
op|'.'
name|'indent'
op|'-='
number|'2'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'No zipped packages.'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'unzipped'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'options'
op|'.'
name|'sort_files'
op|':'
newline|'\n'
indent|'                        '
name|'unzipped'
op|'.'
name|'sort'
op|'('
name|'key'
op|'='
name|'lambda'
name|'x'
op|':'
op|'-'
name|'x'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
dedent|''
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'Unzipped packages:'"
op|')'
newline|'\n'
name|'logger'
op|'.'
name|'indent'
op|'+='
number|'2'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                        '
name|'for'
name|'filename'
op|','
name|'count'
name|'in'
name|'unzipped'
op|':'
newline|'\n'
indent|'                            '
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'%s  (%i files)'"
op|'%'
op|'('
name|'filename'
op|','
name|'count'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'                        '
name|'logger'
op|'.'
name|'indent'
op|'-='
number|'2'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'logger'
op|'.'
name|'notify'
op|'('
string|"'No unzipped packages.'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'                '
name|'logger'
op|'.'
name|'indent'
op|'-='
number|'2'
newline|'\n'
nl|'\n'
DECL|member|count_package
dedent|''
dedent|''
dedent|''
name|'def'
name|'count_package'
op|'('
name|'self'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'total'
op|'='
number|'0'
newline|'\n'
name|'for'
name|'dirpath'
op|','
name|'dirnames'
op|','
name|'filenames'
name|'in'
name|'os'
op|'.'
name|'walk'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'filenames'
op|'='
op|'['
name|'f'
name|'for'
name|'f'
name|'in'
name|'filenames'
nl|'\n'
name|'if'
name|'not'
name|'f'
op|'.'
name|'lower'
op|'('
op|')'
op|'.'
name|'endswith'
op|'('
string|"'.pyc'"
op|')'
op|']'
newline|'\n'
name|'total'
op|'+='
name|'len'
op|'('
name|'filenames'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'total'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'ZipCommand'
op|'('
op|')'
newline|'\n'
endmarker|''
end_unit
