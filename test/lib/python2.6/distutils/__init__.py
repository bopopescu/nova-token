begin_unit
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'sys'
newline|'\n'
name|'import'
name|'warnings'
newline|'\n'
name|'import'
name|'opcode'
comment|'# opcode is not a virtualenv module, so we can use it to find the stdlib'
newline|'\n'
comment|'# Important! To work on pypy, this must be a module that resides in the'
nl|'\n'
comment|'# lib-python/modified-x.y.z directory'
nl|'\n'
nl|'\n'
DECL|variable|dirname
name|'dirname'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
newline|'\n'
nl|'\n'
DECL|variable|distutils_path
name|'distutils_path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'opcode'
op|'.'
name|'__file__'
op|')'
op|','
string|"'distutils'"
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'normpath'
op|'('
name|'distutils_path'
op|')'
op|'=='
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'normpath'
op|'('
name|'__file__'
op|')'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'warnings'
op|'.'
name|'warn'
op|'('
nl|'\n'
string|'"The virtualenv distutils package at %s appears to be in the same location as the system distutils?"'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'__path__'
op|'.'
name|'insert'
op|'('
number|'0'
op|','
name|'distutils_path'
op|')'
newline|'\n'
name|'exec'
name|'open'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'distutils_path'
op|','
string|"'__init__.py'"
op|')'
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'import'
name|'dist'
newline|'\n'
name|'import'
name|'sysconfig'
newline|'\n'
nl|'\n'
nl|'\n'
comment|"## patch build_ext (distutils doesn't know how to get the libs directory"
nl|'\n'
comment|'## path on windows - it hardcodes the paths around the patched sys.prefix)'
nl|'\n'
nl|'\n'
name|'if'
name|'sys'
op|'.'
name|'platform'
op|'=='
string|"'win32'"
op|':'
newline|'\n'
indent|'    '
name|'from'
name|'distutils'
op|'.'
name|'command'
op|'.'
name|'build_ext'
name|'import'
name|'build_ext'
name|'as'
name|'old_build_ext'
newline|'\n'
DECL|class|build_ext
name|'class'
name|'build_ext'
op|'('
name|'old_build_ext'
op|')'
op|':'
newline|'\n'
DECL|member|finalize_options
indent|'        '
name|'def'
name|'finalize_options'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'library_dirs'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'library_dirs'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'isinstance'
op|'('
name|'self'
op|'.'
name|'library_dirs'
op|','
name|'basestring'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'library_dirs'
op|'='
name|'self'
op|'.'
name|'library_dirs'
op|'.'
name|'split'
op|'('
name|'os'
op|'.'
name|'pathsep'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'library_dirs'
op|'.'
name|'insert'
op|'('
number|'0'
op|','
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'sys'
op|'.'
name|'real_prefix'
op|','
string|'"Libs"'
op|')'
op|')'
newline|'\n'
name|'old_build_ext'
op|'.'
name|'finalize_options'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'from'
name|'distutils'
op|'.'
name|'command'
name|'import'
name|'build_ext'
name|'as'
name|'build_ext_module'
newline|'\n'
name|'build_ext_module'
op|'.'
name|'build_ext'
op|'='
name|'build_ext'
newline|'\n'
nl|'\n'
comment|'## distutils.dist patches:'
nl|'\n'
nl|'\n'
DECL|variable|old_find_config_files
dedent|''
name|'old_find_config_files'
op|'='
name|'dist'
op|'.'
name|'Distribution'
op|'.'
name|'find_config_files'
newline|'\n'
DECL|function|find_config_files
name|'def'
name|'find_config_files'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'found'
op|'='
name|'old_find_config_files'
op|'('
name|'self'
op|')'
newline|'\n'
name|'system_distutils'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'distutils_path'
op|','
string|"'distutils.cfg'"
op|')'
newline|'\n'
comment|'#if os.path.exists(system_distutils):'
nl|'\n'
comment|'#    found.insert(0, system_distutils)'
nl|'\n'
comment|'# What to call the per-user config file'
nl|'\n'
name|'if'
name|'os'
op|'.'
name|'name'
op|'=='
string|"'posix'"
op|':'
newline|'\n'
indent|'        '
name|'user_filename'
op|'='
string|'".pydistutils.cfg"'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'user_filename'
op|'='
string|'"pydistutils.cfg"'
newline|'\n'
dedent|''
name|'user_filename'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'sys'
op|'.'
name|'prefix'
op|','
name|'user_filename'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'user_filename'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'item'
name|'in'
name|'list'
op|'('
name|'found'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'item'
op|'.'
name|'endswith'
op|'('
string|"'pydistutils.cfg'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'found'
op|'.'
name|'remove'
op|'('
name|'item'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'found'
op|'.'
name|'append'
op|'('
name|'user_filename'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'found'
newline|'\n'
dedent|''
name|'dist'
op|'.'
name|'Distribution'
op|'.'
name|'find_config_files'
op|'='
name|'find_config_files'
newline|'\n'
nl|'\n'
comment|'## distutils.sysconfig patches:'
nl|'\n'
nl|'\n'
DECL|variable|old_get_python_inc
name|'old_get_python_inc'
op|'='
name|'sysconfig'
op|'.'
name|'get_python_inc'
newline|'\n'
DECL|function|sysconfig_get_python_inc
name|'def'
name|'sysconfig_get_python_inc'
op|'('
name|'plat_specific'
op|'='
number|'0'
op|','
name|'prefix'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'prefix'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'        '
name|'prefix'
op|'='
name|'sys'
op|'.'
name|'real_prefix'
newline|'\n'
dedent|''
name|'return'
name|'old_get_python_inc'
op|'('
name|'plat_specific'
op|','
name|'prefix'
op|')'
newline|'\n'
dedent|''
name|'sysconfig_get_python_inc'
op|'.'
name|'__doc__'
op|'='
name|'old_get_python_inc'
op|'.'
name|'__doc__'
newline|'\n'
name|'sysconfig'
op|'.'
name|'get_python_inc'
op|'='
name|'sysconfig_get_python_inc'
newline|'\n'
nl|'\n'
DECL|variable|old_get_python_lib
name|'old_get_python_lib'
op|'='
name|'sysconfig'
op|'.'
name|'get_python_lib'
newline|'\n'
DECL|function|sysconfig_get_python_lib
name|'def'
name|'sysconfig_get_python_lib'
op|'('
name|'plat_specific'
op|'='
number|'0'
op|','
name|'standard_lib'
op|'='
number|'0'
op|','
name|'prefix'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'standard_lib'
name|'and'
name|'prefix'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'        '
name|'prefix'
op|'='
name|'sys'
op|'.'
name|'real_prefix'
newline|'\n'
dedent|''
name|'return'
name|'old_get_python_lib'
op|'('
name|'plat_specific'
op|','
name|'standard_lib'
op|','
name|'prefix'
op|')'
newline|'\n'
dedent|''
name|'sysconfig_get_python_lib'
op|'.'
name|'__doc__'
op|'='
name|'old_get_python_lib'
op|'.'
name|'__doc__'
newline|'\n'
name|'sysconfig'
op|'.'
name|'get_python_lib'
op|'='
name|'sysconfig_get_python_lib'
newline|'\n'
nl|'\n'
DECL|variable|old_get_config_vars
name|'old_get_config_vars'
op|'='
name|'sysconfig'
op|'.'
name|'get_config_vars'
newline|'\n'
DECL|function|sysconfig_get_config_vars
name|'def'
name|'sysconfig_get_config_vars'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'real_vars'
op|'='
name|'old_get_config_vars'
op|'('
op|'*'
name|'args'
op|')'
newline|'\n'
name|'if'
name|'sys'
op|'.'
name|'platform'
op|'=='
string|"'win32'"
op|':'
newline|'\n'
indent|'        '
name|'lib_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'sys'
op|'.'
name|'real_prefix'
op|','
string|'"libs"'
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'real_vars'
op|','
name|'dict'
op|')'
name|'and'
string|"'LIBDIR'"
name|'not'
name|'in'
name|'real_vars'
op|':'
newline|'\n'
indent|'            '
name|'real_vars'
op|'['
string|"'LIBDIR'"
op|']'
op|'='
name|'lib_dir'
comment|'# asked for all'
newline|'\n'
dedent|''
name|'elif'
name|'isinstance'
op|'('
name|'real_vars'
op|','
name|'list'
op|')'
name|'and'
string|"'LIBDIR'"
name|'in'
name|'args'
op|':'
newline|'\n'
indent|'            '
name|'real_vars'
op|'='
name|'real_vars'
op|'+'
op|'['
name|'lib_dir'
op|']'
comment|'# asked for list'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'real_vars'
newline|'\n'
dedent|''
name|'sysconfig_get_config_vars'
op|'.'
name|'__doc__'
op|'='
name|'old_get_config_vars'
op|'.'
name|'__doc__'
newline|'\n'
name|'sysconfig'
op|'.'
name|'get_config_vars'
op|'='
name|'sysconfig_get_config_vars'
newline|'\n'
endmarker|''
end_unit
