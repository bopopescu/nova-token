

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>VLAN Network Mode &mdash; nova v2010.1 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tweaks.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2010.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/jquery.tweet.js"></script>
    <link rel="top" title="nova v2010.1 documentation" href="../index.html" />
    <link rel="up" title="Administration Guide" href="index.html" />
    <link rel="next" title="Flat Network Mode (Original and Flat)" href="network.flat.html" />
    <link rel="prev" title="Installing Nova on Multiple Servers" href="multi.node.install.html" />
    <script type='text/javascript'>
        $(document).ready(function(){
            $("#twitter_feed").tweet({
                username: "openstack",
                query: "from:openstack",
                avatar_size: 32,
                count: 10,
                loading_text: "loading tweets..."
            });
        });
    </script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="network.flat.html" title="Flat Network Mode (Original and Flat)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="multi.node.install.html" title="Installing Nova on Multiple Servers"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">nova v2010.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Administration Guide</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">VLAN Network Mode</a><ul>
<li><a class="reference internal" href="#goals">Goals</a></li>
<li><a class="reference internal" href="#limitations">Limitations</a></li>
<li><a class="reference internal" href="#implementation">Implementation</a></li>
<li><a class="reference internal" href="#external-infrastructure">External Infrastructure</a></li>
<li><a class="reference internal" href="#example">Example</a><ul>
<li><a class="reference internal" href="#hardware">Hardware</a></li>
<li><a class="reference internal" href="#operation">Operation</a></li>
<li><a class="reference internal" href="#setup">Setup</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="multi.node.install.html"
                                  title="previous chapter">Installing Nova on Multiple Servers</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="network.flat.html"
                                  title="next chapter">Flat Network Mode (Original and Flat)</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/adminguide/network.vlan.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="vlan-network-mode">
<h1>VLAN Network Mode<a class="headerlink" href="#vlan-network-mode" title="Permalink to this headline">¶</a></h1>
<p>VLAN Network Mode is the default mode for Nova.  It provides a private network
segment for each project&#8217;s instances that can be accessed via a dedicated
VPN connection from the Internet.</p>
<p>In this mode, each project gets its own VLAN, Linux networking bridge, and subnet. The subnets are specified by the network administrator, and are assigned dynamically to a project when required. A DHCP Server is started for each VLAN to pass out IP addresses to VM instances from the subnet assigned to the project. All instances belonging to one project are bridged into the same VLAN for that project. The Linux networking bridges and VLANs are created by Nova when required, described in more detail in Nova VLAN Network Management Implementation.</p>
<div class="admonition-todo admonition " id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Insert Figure 2 from &#8220;An OpenStack Network Overview&#8221; contributed by Citrix</p>
</div>
<p>While network traffic between VM instances belonging to the same VLAN is always open, Nova can enforce isolation of network traffic between different projects by enforcing one VLAN per project.</p>
<p>In addition, the network administrator can specify a pool of public IP addresses that users may allocate and then assign to VMs, either at boot or dynamically at run-time. This capability is similar to Amazon&#8217;s &#8216;elastic IPs&#8217;. A public IP address may be associated with a running instances, allowing the VM instance to be accessed from the public network. The public IP addresses are accessible from the network host and NATed to the private IP address of the project.</p>
<div class="admonition-todo admonition " id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">Describe how a public IP address could be associated with a project (a VLAN)</p>
</div>
<p>This is the default networking mode and supports the most features.  For multiple machine installation, it requires a switch that supports host-managed vlan tagging.  In this mode, nova will create a vlan and bridge for each project.  The project gets a range of private ips that are only accessible from inside the vlan.  In order for a user to access the instances in their project, a special vpn instance (code named <a class="reference internal" href="../devref/cloudpipe.html#cloudpipe"><em>cloudpipe</em></a>) needs to be created.  Nova generates a certificate and key for the user to access the vpn and starts the vpn automatically. More information on cloudpipe can be found <a class="reference internal" href="../devref/cloudpipe.html#cloudpipe"><em>here</em></a>.</p>
<p>The following diagram illustrates how the communication that occurs between the vlan (the dashed box) and the public internet (represented by the two clouds)</p>
<img alt="../_images/cloudpipe.png" src="../_images/cloudpipe.png" style="width: 100%;" />
<div class="section" id="goals">
<h2>Goals<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>each project is in a protected network segment<ul>
<li>RFC-1918 IP space</li>
<li>public IP via NAT</li>
<li>no default inbound Internet access without public NAT</li>
<li>limited (project-admin controllable) outbound Internet access</li>
<li>limited (project-admin controllable) access to other project segments</li>
<li>all connectivity to instance and cloud API is via VPN into the project segment</li>
</ul>
</li>
<li>common DMZ segment for support services (only visible from project segment)<ul>
<li>metadata</li>
<li>dashboard</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Projects / cluster limited to available VLANs in switching infrastructure</li>
<li>Requires VPN for access to project segment</li>
</ul>
</div>
<div class="section" id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>Currently Nova segregates project VLANs using 802.1q VLAN tagging in the
switching layer.  Compute hosts create VLAN-specific interfaces and bridges
as required.</p>
<p>The network nodes act as default gateway for project networks and contain
all of the routing and firewall rules implementing security groups.  The
network node also handles DHCP to provide instance IPs for each project.</p>
<p>VPN access is provided by running a small instance called CloudPipe
on the IP immediately following the gateway IP for each project.  The
network node maps a dedicated public IP/port to the CloudPipe instance.</p>
<p>Compute nodes have per-VLAN interfaces and bridges created as required.
These do NOT have IP addresses in the host to protect host access.
Compute nodes have iptables/ebtables entries created per project and
instance to protect against IP/MAC address spoofing and ARP poisoning.</p>
<p>The network assignment to a project, and IP address assignment to a VM instance, are triggered when a user starts to run a VM instance. When running a VM instance, a user needs to specify a project for the instances, and the security groups (described in Security Groups) when the instance wants to join. If this is the first instance to be created for the project, then Nova (the cloud controller) needs to find a network controller to be the network host for the project; it then sets up a private network by finding an unused VLAN id, an unused subnet, and then the controller assigns them to the project, it also assigns a name to the project&#8217;s Linux bridge, and allocating a private IP within the project&#8217;s subnet for the new instance.</p>
<p>If the instance the user wants to start is not the project&#8217;s first, a subnet and a VLAN must have already been assigned to the project; therefore the system needs only to find an available IP address within the subnet and assign it to the new starting instance. If there is no private IP available within the subnet, an exception will be raised to the cloud controller, and the VM creation cannot proceed.</p>
<div class="admonition-todo admonition " id="index-2">
<p class="first admonition-title">Todo</p>
<p class="last">insert the name of the Linux bridge, is it always named bridge?</p>
</div>
</div>
<div class="section" id="external-infrastructure">
<h2>External Infrastructure<a class="headerlink" href="#external-infrastructure" title="Permalink to this headline">¶</a></h2>
<p>Nova assumes the following is available:</p>
<ul class="simple">
<li>DNS</li>
<li>NTP</li>
<li>Internet connectivity</li>
</ul>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>This example network configuration demonstrates most of the capabilities
of VLAN Mode.  It splits administrative access to the nodes onto a dedicated
management network and uses dedicated network nodes to handle all
routing and gateway functions.</p>
<p>It uses a 10GB network for instance traffic and a 1GB network for management.</p>
<div class="section" id="hardware">
<h3>Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>All nodes have a minimum of two NICs for management and production.<ul>
<li>management is 1GB</li>
<li>production is 10GB</li>
<li>add additional NICs for bonding or HA/performance</li>
</ul>
</li>
<li>network nodes should have an additional NIC dedicated to public Internet traffic</li>
<li>switch needs to support enough simultaneous VLANs for number of projects</li>
<li>production network configured as 802.1q trunk on switch</li>
</ul>
</div>
<div class="section" id="operation">
<h3>Operation<a class="headerlink" href="#operation" title="Permalink to this headline">¶</a></h3>
<p>The network node controls the project network configuration:</p>
<ul class="simple">
<li>assigns each project a VLAN and private IP range</li>
<li>starts dnsmasq on project VLAN to serve private IP range</li>
<li>configures iptables on network node for default project access</li>
<li>launches CloudPipe instance and configures iptables access</li>
</ul>
<p>When starting an instance the network node:</p>
<ul class="simple">
<li>sets up a VLAN interface and bridge on each host as required when an
instance is started on that host</li>
<li>assigns private IP to instance</li>
<li>generates MAC address for instance</li>
<li>update dnsmasq with IP/MAC for instance</li>
</ul>
<p>When starting an instance the compute node:</p>
<ul class="simple">
<li>sets up a VLAN interface and bridge on each host as required when an
instance is started on that host</li>
</ul>
</div>
<div class="section" id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Assign VLANs in the switch:<ul>
<li>public Internet segment</li>
<li>production network</li>
<li>management network</li>
<li>cluster DMZ</li>
</ul>
</li>
<li>Assign a contiguous range of VLANs to Nova for project use.</li>
<li>Configure management NIC ports as management VLAN access ports.</li>
<li>Configure management VLAN with Internet access as required</li>
<li>Configure production NIC ports as 802.1q trunk ports.</li>
<li>Configure Nova (need to add specifics here)<ul>
<li>public IPs</li>
<li>instance IPs</li>
<li>project network size</li>
<li>DMZ network</li>
</ul>
</li>
</ul>
<div class="admonition-todo admonition " id="index-3">
<p class="first admonition-title">Todo</p>
<p class="last">need specific Nova configuration added</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="network.flat.html" title="Flat Network Mode (Original and Flat)"
             >next</a> |</li>
        <li class="right" >
          <a href="multi.node.install.html" title="Installing Nova on Multiple Servers"
             >previous</a> |</li>
        <li><a href="../index.html">nova v2010.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Administration Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, United States Government as represented by the Administrator of the National Aeronautics and Space Administration..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>