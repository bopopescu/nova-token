begin_unit
name|'from'
name|'sqlalchemy'
op|'.'
name|'orm'
name|'import'
name|'relationship'
op|','
name|'backref'
op|','
name|'validates'
newline|'\n'
name|'from'
name|'sqlalchemy'
name|'import'
name|'Table'
op|','
name|'Column'
op|','
name|'Integer'
op|','
name|'String'
op|','
name|'MetaData'
op|','
name|'ForeignKey'
op|','
name|'DateTime'
op|','
name|'Boolean'
op|','
name|'Text'
newline|'\n'
name|'from'
name|'sqlalchemy'
op|'.'
name|'ext'
op|'.'
name|'declarative'
name|'import'
name|'declarative_base'
newline|'\n'
name|'from'
name|'auth'
name|'import'
op|'*'
newline|'\n'
nl|'\n'
DECL|variable|Base
name|'Base'
op|'='
name|'declarative_base'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|class|User
name|'class'
name|'User'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
comment|'# sqlalchemy'
nl|'\n'
DECL|variable|__tablename__
indent|'    '
name|'__tablename__'
op|'='
string|"'users'"
newline|'\n'
DECL|variable|sid
name|'sid'
op|'='
name|'Column'
op|'('
name|'String'
op|','
name|'primary_key'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
comment|'# backwards compatibility'
nl|'\n'
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|safe_id
name|'def'
name|'safe_id'
op|'('
name|'cls'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Safe get object id\n\n        This method will return the id of the object if the object\n        is of this class, otherwise it will return the original object.\n        This allows methods to accept objects or ids as paramaters.\n\n        """'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'obj'
op|','
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'obj'
op|'.'
name|'id'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'obj'
newline|'\n'
nl|'\n'
comment|'#    def __init__(self, id, name, access, secret, admin):'
nl|'\n'
comment|'#        self.id = id'
nl|'\n'
comment|'#        self.name = name'
nl|'\n'
comment|'#        self.access = access'
nl|'\n'
comment|'#        self.secret = secret'
nl|'\n'
comment|'#        self.admin = admin'
nl|'\n'
nl|'\n'
DECL|member|__getattr__
dedent|''
dedent|''
name|'def'
name|'__getattr__'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'name'
op|'=='
string|"'id'"
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'uid'
newline|'\n'
dedent|''
name|'else'
op|':'
name|'raise'
name|'AttributeError'
op|','
name|'name'
newline|'\n'
nl|'\n'
DECL|member|is_superuser
dedent|''
name|'def'
name|'is_superuser'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'AuthManager'
op|'('
op|')'
op|'.'
name|'is_superuser'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|is_admin
dedent|''
name|'def'
name|'is_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'AuthManager'
op|'('
op|')'
op|'.'
name|'is_admin'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|has_role
dedent|''
name|'def'
name|'has_role'
op|'('
name|'self'
op|','
name|'role'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'AuthManager'
op|'('
op|')'
op|'.'
name|'has_role'
op|'('
name|'self'
op|','
name|'role'
op|')'
newline|'\n'
nl|'\n'
DECL|member|add_role
dedent|''
name|'def'
name|'add_role'
op|'('
name|'self'
op|','
name|'role'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'AuthManager'
op|'('
op|')'
op|'.'
name|'add_role'
op|'('
name|'self'
op|','
name|'role'
op|')'
newline|'\n'
nl|'\n'
DECL|member|remove_role
dedent|''
name|'def'
name|'remove_role'
op|'('
name|'self'
op|','
name|'role'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'AuthManager'
op|'('
op|')'
op|'.'
name|'remove_role'
op|'('
name|'self'
op|','
name|'role'
op|')'
newline|'\n'
nl|'\n'
DECL|member|is_project_member
dedent|''
name|'def'
name|'is_project_member'
op|'('
name|'self'
op|','
name|'project'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'AuthManager'
op|'('
op|')'
op|'.'
name|'is_project_member'
op|'('
name|'self'
op|','
name|'project'
op|')'
newline|'\n'
nl|'\n'
DECL|member|is_project_manager
dedent|''
name|'def'
name|'is_project_manager'
op|'('
name|'self'
op|','
name|'project'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'AuthManager'
op|'('
op|')'
op|'.'
name|'is_project_manager'
op|'('
name|'self'
op|','
name|'project'
op|')'
newline|'\n'
nl|'\n'
DECL|member|generate_key_pair
dedent|''
name|'def'
name|'generate_key_pair'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'AuthManager'
op|'('
op|')'
op|'.'
name|'generate_key_pair'
op|'('
name|'self'
op|'.'
name|'id'
op|','
name|'name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|create_key_pair
dedent|''
name|'def'
name|'create_key_pair'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'public_key'
op|','
name|'fingerprint'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'AuthManager'
op|'('
op|')'
op|'.'
name|'create_key_pair'
op|'('
name|'self'
op|'.'
name|'id'
op|','
nl|'\n'
name|'name'
op|','
nl|'\n'
name|'public_key'
op|','
nl|'\n'
name|'fingerprint'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_key_pair
dedent|''
name|'def'
name|'get_key_pair'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'AuthManager'
op|'('
op|')'
op|'.'
name|'get_key_pair'
op|'('
name|'self'
op|'.'
name|'id'
op|','
name|'name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|delete_key_pair
dedent|''
name|'def'
name|'delete_key_pair'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'AuthManager'
op|'('
op|')'
op|'.'
name|'delete_key_pair'
op|'('
name|'self'
op|'.'
name|'id'
op|','
name|'name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_key_pairs
dedent|''
name|'def'
name|'get_key_pairs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'AuthManager'
op|'('
op|')'
op|'.'
name|'get_key_pairs'
op|'('
name|'self'
op|'.'
name|'id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__repr__
dedent|''
name|'def'
name|'__repr__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
string|'"User(\'%s\', \'%s\', \'%s\', \'%s\', %s)"'
op|'%'
op|'('
name|'self'
op|'.'
name|'id'
op|','
nl|'\n'
name|'self'
op|'.'
name|'name'
op|','
nl|'\n'
name|'self'
op|'.'
name|'access'
op|','
nl|'\n'
name|'self'
op|'.'
name|'secret'
op|','
nl|'\n'
name|'self'
op|'.'
name|'admin'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
nl|'\n'
DECL|class|Project
dedent|''
dedent|''
name|'class'
name|'Project'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|__tablename__
indent|'    '
name|'__tablename__'
op|'='
string|"'projects'"
newline|'\n'
DECL|variable|sid
name|'sid'
op|'='
name|'Column'
op|'('
name|'String'
op|','
name|'primary_key'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|class|Image
dedent|''
name|'class'
name|'Image'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|__tablename__
indent|'    '
name|'__tablename__'
op|'='
string|"'images'"
newline|'\n'
DECL|variable|user_sid
name|'user_sid'
op|'='
name|'Column'
op|'('
name|'String'
op|','
name|'ForeignKey'
op|'('
string|"'users.sid'"
op|')'
op|','
name|'nullable'
op|'='
name|'False'
op|')'
newline|'\n'
DECL|variable|project_sid
name|'project_sid'
op|'='
name|'Column'
op|'('
name|'String'
op|','
name|'ForeignKey'
op|'('
string|"'projects.sid'"
op|')'
op|','
name|'nullable'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|sid
name|'sid'
op|'='
name|'Column'
op|'('
name|'String'
op|','
name|'primary_key'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|image_type
name|'image_type'
op|'='
name|'Column'
op|'('
name|'String'
op|')'
newline|'\n'
DECL|variable|public
name|'public'
op|'='
name|'Column'
op|'('
name|'Boolean'
op|','
name|'default'
op|'='
name|'False'
op|')'
newline|'\n'
DECL|variable|state
name|'state'
op|'='
name|'Column'
op|'('
name|'String'
op|')'
newline|'\n'
DECL|variable|location
name|'location'
op|'='
name|'Column'
op|'('
name|'String'
op|')'
newline|'\n'
DECL|variable|arch
name|'arch'
op|'='
name|'Column'
op|'('
name|'String'
op|')'
newline|'\n'
DECL|variable|default_kernel_sid
name|'default_kernel_sid'
op|'='
name|'Column'
op|'('
name|'String'
op|')'
newline|'\n'
DECL|variable|default_ramdisk_sid
name|'default_ramdisk_sid'
op|'='
name|'Column'
op|'('
name|'String'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|created_at
name|'created_at'
op|'='
name|'Column'
op|'('
name|'DateTime'
op|')'
newline|'\n'
DECL|variable|updated_at
name|'updated_at'
op|'='
name|'Column'
op|'('
name|'DateTime'
op|')'
comment|'# auto update on change FIXME'
newline|'\n'
nl|'\n'
nl|'\n'
op|'@'
name|'validates'
op|'('
string|"'image_type'"
op|')'
newline|'\n'
DECL|member|validate_image_type
name|'def'
name|'validate_image_type'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'image_type'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'assert'
op|'('
name|'image_type'
name|'in'
op|'['
string|"'machine'"
op|','
string|"'kernel'"
op|','
string|"'ramdisk'"
op|','
string|"'raw'"
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'validates'
op|'('
string|"'state'"
op|')'
newline|'\n'
DECL|member|validate_state
name|'def'
name|'validate_state'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'state'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'assert'
op|'('
name|'state'
name|'in'
op|'['
string|"'available'"
op|','
string|"'pending'"
op|','
string|"'disabled'"
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'validates'
op|'('
string|"'default_kernel_sid'"
op|')'
newline|'\n'
DECL|member|validate_kernel_sid
name|'def'
name|'validate_kernel_sid'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'val'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'val'
op|'!='
string|"'machine'"
op|':'
newline|'\n'
indent|'            '
name|'assert'
op|'('
name|'val'
name|'is'
name|'None'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'validates'
op|'('
string|"'default_ramdisk_sid'"
op|')'
newline|'\n'
DECL|member|validate_ramdisk_sid
name|'def'
name|'validate_ramdisk_sid'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'val'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'val'
op|'!='
string|"'machine'"
op|':'
newline|'\n'
indent|'            '
name|'assert'
op|'('
name|'val'
name|'is'
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|class|Network
dedent|''
dedent|''
dedent|''
name|'class'
name|'Network'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|__tablename__
indent|'    '
name|'__tablename__'
op|'='
string|"'networks'"
newline|'\n'
DECL|variable|id
name|'id'
op|'='
name|'Column'
op|'('
name|'Integer'
op|','
name|'primary_key'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|bridge
name|'bridge'
op|'='
name|'Column'
op|'('
name|'String'
op|')'
newline|'\n'
DECL|variable|vlan
name|'vlan'
op|'='
name|'Column'
op|'('
name|'String'
op|')'
newline|'\n'
comment|'#vpn_port = Column(Integer)'
nl|'\n'
DECL|variable|project_sid
name|'project_sid'
op|'='
name|'Column'
op|'('
name|'String'
op|','
name|'ForeignKey'
op|'('
string|"'projects.sid'"
op|')'
op|','
name|'nullable'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|class|PhysicalNode
dedent|''
name|'class'
name|'PhysicalNode'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|__tablename__
indent|'    '
name|'__tablename__'
op|'='
string|"'physical_nodes'"
newline|'\n'
DECL|variable|id
name|'id'
op|'='
name|'Column'
op|'('
name|'Integer'
op|','
name|'primary_key'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|class|Instance
dedent|''
name|'class'
name|'Instance'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|__tablename__
indent|'    '
name|'__tablename__'
op|'='
string|"'instances'"
newline|'\n'
DECL|variable|id
name|'id'
op|'='
name|'Column'
op|'('
name|'Integer'
op|','
name|'primary_key'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|user_sid
name|'user_sid'
op|'='
name|'Column'
op|'('
name|'String'
op|','
name|'ForeignKey'
op|'('
string|"'users.sid'"
op|')'
op|','
name|'nullable'
op|'='
name|'False'
op|')'
newline|'\n'
DECL|variable|project_sid
name|'project_sid'
op|'='
name|'Column'
op|'('
name|'String'
op|','
name|'ForeignKey'
op|'('
string|"'projects.sid'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|image_sid
name|'image_sid'
op|'='
name|'Column'
op|'('
name|'Integer'
op|','
name|'ForeignKey'
op|'('
string|"'images.sid'"
op|')'
op|','
name|'nullable'
op|'='
name|'False'
op|')'
newline|'\n'
DECL|variable|kernel_sid
name|'kernel_sid'
op|'='
name|'Column'
op|'('
name|'String'
op|','
name|'ForeignKey'
op|'('
string|"'images.sid'"
op|')'
op|','
name|'nullable'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|ramdisk_sid
name|'ramdisk_sid'
op|'='
name|'Column'
op|'('
name|'String'
op|','
name|'ForeignKey'
op|'('
string|"'images.sid'"
op|')'
op|','
name|'nullable'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|launch_index
name|'launch_index'
op|'='
name|'Column'
op|'('
name|'Integer'
op|')'
newline|'\n'
DECL|variable|key_name
name|'key_name'
op|'='
name|'Column'
op|'('
name|'String'
op|')'
newline|'\n'
DECL|variable|key_data
name|'key_data'
op|'='
name|'Column'
op|'('
name|'Text'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|state
name|'state'
op|'='
name|'Column'
op|'('
name|'String'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|hostname
name|'hostname'
op|'='
name|'Column'
op|'('
name|'String'
op|')'
newline|'\n'
DECL|variable|physical_node_id
name|'physical_node_id'
op|'='
name|'Column'
op|'('
name|'Integer'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|instance_type
name|'instance_type'
op|'='
name|'Column'
op|'('
name|'Integer'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|user_data
name|'user_data'
op|'='
name|'Column'
op|'('
name|'Text'
op|')'
newline|'\n'
nl|'\n'
comment|"#    user = relationship(User, backref=backref('instances', order_by=id))"
nl|'\n'
comment|"#    ramdisk = relationship(Ramdisk, backref=backref('instances', order_by=id))"
nl|'\n'
comment|"#    kernel = relationship(Kernel, backref=backref('instances', order_by=id))"
nl|'\n'
comment|"#    project = relationship(Project, backref=backref('instances', order_by=id))"
nl|'\n'
nl|'\n'
comment|"#TODO - see Ewan's email about state improvements"
nl|'\n'
comment|'# vmstate_state = running, halted, suspended, paused'
nl|'\n'
comment|'# power_state = what we have'
nl|'\n'
comment|'# task_state = transitory and may trigger power state transition'
nl|'\n'
nl|'\n'
op|'@'
name|'validates'
op|'('
string|"'state'"
op|')'
newline|'\n'
DECL|member|validate_state
name|'def'
name|'validate_state'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'state'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'assert'
op|'('
name|'state'
name|'in'
op|'['
string|"'nostate'"
op|','
string|"'running'"
op|','
string|"'blocked'"
op|','
string|"'paused'"
op|','
string|"'shutdown'"
op|','
string|"'shutoff'"
op|','
string|"'crashed'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|class|Volume
dedent|''
dedent|''
name|'class'
name|'Volume'
op|'('
name|'Base'
op|')'
op|':'
newline|'\n'
DECL|variable|__tablename__
indent|'    '
name|'__tablename__'
op|'='
string|"'volumes'"
newline|'\n'
DECL|variable|id
name|'id'
op|'='
name|'Column'
op|'('
name|'Integer'
op|','
name|'primary_key'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|variable|shelf_id
name|'shelf_id'
op|'='
name|'Column'
op|'('
name|'Integer'
op|')'
newline|'\n'
DECL|variable|blade_id
name|'blade_id'
op|'='
name|'Column'
op|'('
name|'Integer'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'from'
name|'sqlalchemy'
name|'import'
name|'create_engine'
newline|'\n'
DECL|variable|engine
name|'engine'
op|'='
name|'create_engine'
op|'('
string|"'sqlite:///:memory:'"
op|','
name|'echo'
op|'='
name|'True'
op|')'
newline|'\n'
name|'Base'
op|'.'
name|'metadata'
op|'.'
name|'create_all'
op|'('
name|'engine'
op|')'
newline|'\n'
nl|'\n'
name|'from'
name|'sqlalchemy'
op|'.'
name|'orm'
name|'import'
name|'sessionmaker'
newline|'\n'
DECL|variable|Session
name|'Session'
op|'='
name|'sessionmaker'
op|'('
name|'bind'
op|'='
name|'engine'
op|')'
newline|'\n'
DECL|variable|session
name|'session'
op|'='
name|'Session'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|variable|instance
name|'instance'
op|'='
name|'Instance'
op|'('
name|'image_sid'
op|'='
string|"'as'"
op|','
name|'ramdisk_sid'
op|'='
string|"'AS'"
op|','
name|'user_sid'
op|'='
string|"'anthony'"
op|')'
newline|'\n'
DECL|variable|user
name|'user'
op|'='
name|'User'
op|'('
name|'sid'
op|'='
string|"'anthony'"
op|')'
newline|'\n'
name|'session'
op|'.'
name|'add'
op|'('
name|'instance'
op|')'
newline|'\n'
name|'session'
op|'.'
name|'commit'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
endmarker|''
end_unit
