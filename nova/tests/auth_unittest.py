begin_unit
comment|'# vim: tabstop=4 shiftwidth=4 softtabstop=4'
nl|'\n'
nl|'\n'
comment|'# Copyright 2010 United States Government as represented by the'
nl|'\n'
comment|'# Administrator of the National Aeronautics and Space Administration.'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'logging'
newline|'\n'
name|'from'
name|'M2Crypto'
name|'import'
name|'BIO'
newline|'\n'
name|'from'
name|'M2Crypto'
name|'import'
name|'RSA'
newline|'\n'
name|'from'
name|'M2Crypto'
name|'import'
name|'X509'
newline|'\n'
name|'import'
name|'unittest'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'crypto'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'flags'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'auth'
name|'import'
name|'manager'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'endpoint'
name|'import'
name|'cloud'
newline|'\n'
nl|'\n'
DECL|variable|FLAGS
name|'FLAGS'
op|'='
name|'flags'
op|'.'
name|'FLAGS'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|AuthTestCase
name|'class'
name|'AuthTestCase'
op|'('
name|'test'
op|'.'
name|'TrialTestCase'
op|')'
op|':'
newline|'\n'
DECL|variable|flush_db
indent|'    '
name|'flush_db'
op|'='
name|'False'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'AuthTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'connection_type'
op|'='
string|"'fake'"
op|','
nl|'\n'
name|'fake_storage'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'manager'
op|'='
name|'manager'
op|'.'
name|'AuthManager'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_001_can_create_users
dedent|''
name|'def'
name|'test_001_can_create_users'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'manager'
op|'.'
name|'create_user'
op|'('
string|"'test1'"
op|','
string|"'access'"
op|','
string|"'secret'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'manager'
op|'.'
name|'create_user'
op|'('
string|"'test2'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_002_can_get_user
dedent|''
name|'def'
name|'test_002_can_get_user'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user'
op|'('
string|"'test1'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_003_can_retreive_properties
dedent|''
name|'def'
name|'test_003_can_retreive_properties'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user'
op|'('
string|"'test1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'test1'"
op|','
name|'user'
op|'.'
name|'id'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'access'"
op|','
name|'user'
op|'.'
name|'access'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'secret'"
op|','
name|'user'
op|'.'
name|'secret'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_004_signature_is_valid
dedent|''
name|'def'
name|'test_004_signature_is_valid'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'#self.assertTrue(self.manager.authenticate( **boto.generate_url ... ? ? ? ))'
nl|'\n'
indent|'        '
name|'pass'
newline|'\n'
comment|'#raise NotImplementedError'
nl|'\n'
nl|'\n'
DECL|member|test_005_can_get_credentials
dedent|''
name|'def'
name|'test_005_can_get_credentials'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
newline|'\n'
name|'credentials'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user'
op|'('
string|"'test1'"
op|')'
op|'.'
name|'get_credentials'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'credentials'
op|','
nl|'\n'
string|'\'export EC2_ACCESS_KEY="access"\\n\''
op|'+'
nl|'\n'
string|'\'export EC2_SECRET_KEY="secret"\\n\''
op|'+'
nl|'\n'
string|'\'export EC2_URL="http://127.0.0.1:8773/services/Cloud"\\n\''
op|'+'
nl|'\n'
string|'\'export S3_URL="http://127.0.0.1:3333/"\\n\''
op|'+'
nl|'\n'
string|'\'export EC2_USER_ID="test1"\\n\''
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_006_test_key_storage
dedent|''
name|'def'
name|'test_006_test_key_storage'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user'
op|'('
string|"'test1'"
op|')'
newline|'\n'
name|'user'
op|'.'
name|'create_key_pair'
op|'('
string|"'public'"
op|','
string|"'key'"
op|','
string|"'fingerprint'"
op|')'
newline|'\n'
name|'key'
op|'='
name|'user'
op|'.'
name|'get_key_pair'
op|'('
string|"'public'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'key'"
op|','
name|'key'
op|'.'
name|'public_key'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'fingerprint'"
op|','
name|'key'
op|'.'
name|'fingerprint'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_007_test_key_generation
dedent|''
name|'def'
name|'test_007_test_key_generation'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user'
op|'('
string|"'test1'"
op|')'
newline|'\n'
name|'private_key'
op|','
name|'fingerprint'
op|'='
name|'user'
op|'.'
name|'generate_key_pair'
op|'('
string|"'public2'"
op|')'
newline|'\n'
name|'key'
op|'='
name|'RSA'
op|'.'
name|'load_key_string'
op|'('
name|'private_key'
op|','
name|'callback'
op|'='
name|'lambda'
op|':'
name|'None'
op|')'
newline|'\n'
name|'bio'
op|'='
name|'BIO'
op|'.'
name|'MemoryBuffer'
op|'('
op|')'
newline|'\n'
name|'public_key'
op|'='
name|'user'
op|'.'
name|'get_key_pair'
op|'('
string|"'public2'"
op|')'
op|'.'
name|'public_key'
newline|'\n'
name|'key'
op|'.'
name|'save_pub_key_bio'
op|'('
name|'bio'
op|')'
newline|'\n'
name|'converted'
op|'='
name|'crypto'
op|'.'
name|'ssl_pub_to_ssh_pub'
op|'('
name|'bio'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
comment|'# assert key fields are equal'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'public_key'
op|'.'
name|'split'
op|'('
string|'" "'
op|')'
op|'['
number|'1'
op|']'
op|'.'
name|'strip'
op|'('
op|')'
op|','
nl|'\n'
name|'converted'
op|'.'
name|'split'
op|'('
string|'" "'
op|')'
op|'['
number|'1'
op|']'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_008_can_list_key_pairs
dedent|''
name|'def'
name|'test_008_can_list_key_pairs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'keys'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user'
op|'('
string|"'test1'"
op|')'
op|'.'
name|'get_key_pairs'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filter'
op|'('
name|'lambda'
name|'k'
op|':'
name|'k'
op|'.'
name|'name'
op|'=='
string|"'public'"
op|','
name|'keys'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filter'
op|'('
name|'lambda'
name|'k'
op|':'
name|'k'
op|'.'
name|'name'
op|'=='
string|"'public2'"
op|','
name|'keys'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_009_can_delete_key_pair
dedent|''
name|'def'
name|'test_009_can_delete_key_pair'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user'
op|'('
string|"'test1'"
op|')'
op|'.'
name|'delete_key_pair'
op|'('
string|"'public'"
op|')'
newline|'\n'
name|'keys'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user'
op|'('
string|"'test1'"
op|')'
op|'.'
name|'get_key_pairs'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filter'
op|'('
name|'lambda'
name|'k'
op|':'
name|'k'
op|'.'
name|'name'
op|'=='
string|"'public'"
op|','
name|'keys'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_010_can_list_users
dedent|''
name|'def'
name|'test_010_can_list_users'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'users'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_users'
op|'('
op|')'
newline|'\n'
name|'logging'
op|'.'
name|'warn'
op|'('
name|'users'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filter'
op|'('
name|'lambda'
name|'u'
op|':'
name|'u'
op|'.'
name|'id'
op|'=='
string|"'test1'"
op|','
name|'users'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_101_can_add_user_role
dedent|''
name|'def'
name|'test_101_can_add_user_role'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'has_role'
op|'('
string|"'test1'"
op|','
string|"'itsec'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'manager'
op|'.'
name|'add_role'
op|'('
string|"'test1'"
op|','
string|"'itsec'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'has_role'
op|'('
string|"'test1'"
op|','
string|"'itsec'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_199_can_remove_user_role
dedent|''
name|'def'
name|'test_199_can_remove_user_role'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'has_role'
op|'('
string|"'test1'"
op|','
string|"'itsec'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'manager'
op|'.'
name|'remove_role'
op|'('
string|"'test1'"
op|','
string|"'itsec'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'has_role'
op|'('
string|"'test1'"
op|','
string|"'itsec'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_201_can_create_project
dedent|''
name|'def'
name|'test_201_can_create_project'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'project'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'create_project'
op|'('
string|"'testproj'"
op|','
string|"'test1'"
op|','
string|"'A test project'"
op|','
op|'['
string|"'test1'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filter'
op|'('
name|'lambda'
name|'p'
op|':'
name|'p'
op|'.'
name|'name'
op|'=='
string|"'testproj'"
op|','
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_projects'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'project'
op|'.'
name|'name'
op|','
string|"'testproj'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'project'
op|'.'
name|'description'
op|','
string|"'A test project'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'project'
op|'.'
name|'project_manager_id'
op|','
string|"'test1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'project'
op|'.'
name|'has_member'
op|'('
string|"'test1'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_202_user1_is_project_member
dedent|''
name|'def'
name|'test_202_user1_is_project_member'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user'
op|'('
string|"'test1'"
op|')'
op|'.'
name|'is_project_member'
op|'('
string|"'testproj'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_203_user2_is_not_project_member
dedent|''
name|'def'
name|'test_203_user2_is_not_project_member'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user'
op|'('
string|"'test2'"
op|')'
op|'.'
name|'is_project_member'
op|'('
string|"'testproj'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_204_user1_is_project_manager
dedent|''
name|'def'
name|'test_204_user1_is_project_manager'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user'
op|'('
string|"'test1'"
op|')'
op|'.'
name|'is_project_manager'
op|'('
string|"'testproj'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_205_user2_is_not_project_manager
dedent|''
name|'def'
name|'test_205_user2_is_not_project_manager'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user'
op|'('
string|"'test2'"
op|')'
op|'.'
name|'is_project_manager'
op|'('
string|"'testproj'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_206_can_add_user_to_project
dedent|''
name|'def'
name|'test_206_can_add_user_to_project'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'manager'
op|'.'
name|'add_to_project'
op|'('
string|"'test2'"
op|','
string|"'testproj'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_project'
op|'('
string|"'testproj'"
op|')'
op|'.'
name|'has_member'
op|'('
string|"'test2'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_207_can_remove_user_from_project
dedent|''
name|'def'
name|'test_207_can_remove_user_from_project'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'manager'
op|'.'
name|'remove_from_project'
op|'('
string|"'test2'"
op|','
string|"'testproj'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_project'
op|'('
string|"'testproj'"
op|')'
op|'.'
name|'has_member'
op|'('
string|"'test2'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_208_can_remove_add_user_with_role
dedent|''
name|'def'
name|'test_208_can_remove_add_user_with_role'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'manager'
op|'.'
name|'add_to_project'
op|'('
string|"'test2'"
op|','
string|"'testproj'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'manager'
op|'.'
name|'add_role'
op|'('
string|"'test2'"
op|','
string|"'developer'"
op|','
string|"'testproj'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'manager'
op|'.'
name|'remove_from_project'
op|'('
string|"'test2'"
op|','
string|"'testproj'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'has_role'
op|'('
string|"'test2'"
op|','
string|"'developer'"
op|','
string|"'testproj'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'manager'
op|'.'
name|'add_to_project'
op|'('
string|"'test2'"
op|','
string|"'testproj'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'manager'
op|'.'
name|'remove_from_project'
op|'('
string|"'test2'"
op|','
string|"'testproj'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_209_can_generate_x509
dedent|''
name|'def'
name|'test_209_can_generate_x509'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# MUST HAVE RUN CLOUD SETUP BY NOW'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'cloud'
op|'='
name|'cloud'
op|'.'
name|'CloudController'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'cloud'
op|'.'
name|'setup'
op|'('
op|')'
newline|'\n'
name|'_key'
op|','
name|'cert_str'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'_generate_x509_cert'
op|'('
string|"'test1'"
op|','
string|"'testproj'"
op|')'
newline|'\n'
name|'logging'
op|'.'
name|'debug'
op|'('
name|'cert_str'
op|')'
newline|'\n'
nl|'\n'
comment|"# Need to verify that it's signed by the right intermediate CA"
nl|'\n'
name|'full_chain'
op|'='
name|'crypto'
op|'.'
name|'fetch_ca'
op|'('
name|'project_id'
op|'='
string|"'testproj'"
op|','
name|'chain'
op|'='
name|'True'
op|')'
newline|'\n'
name|'int_cert'
op|'='
name|'crypto'
op|'.'
name|'fetch_ca'
op|'('
name|'project_id'
op|'='
string|"'testproj'"
op|','
name|'chain'
op|'='
name|'False'
op|')'
newline|'\n'
name|'cloud_cert'
op|'='
name|'crypto'
op|'.'
name|'fetch_ca'
op|'('
op|')'
newline|'\n'
name|'logging'
op|'.'
name|'debug'
op|'('
string|'"CA chain:\\n\\n =====\\n%s\\n\\n====="'
op|'%'
name|'full_chain'
op|')'
newline|'\n'
name|'signed_cert'
op|'='
name|'X509'
op|'.'
name|'load_cert_string'
op|'('
name|'cert_str'
op|')'
newline|'\n'
name|'chain_cert'
op|'='
name|'X509'
op|'.'
name|'load_cert_string'
op|'('
name|'full_chain'
op|')'
newline|'\n'
name|'int_cert'
op|'='
name|'X509'
op|'.'
name|'load_cert_string'
op|'('
name|'int_cert'
op|')'
newline|'\n'
name|'cloud_cert'
op|'='
name|'X509'
op|'.'
name|'load_cert_string'
op|'('
name|'cloud_cert'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'signed_cert'
op|'.'
name|'verify'
op|'('
name|'chain_cert'
op|'.'
name|'get_pubkey'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'signed_cert'
op|'.'
name|'verify'
op|'('
name|'int_cert'
op|'.'
name|'get_pubkey'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'FLAGS'
op|'.'
name|'use_intermediate_ca'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'signed_cert'
op|'.'
name|'verify'
op|'('
name|'cloud_cert'
op|'.'
name|'get_pubkey'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'signed_cert'
op|'.'
name|'verify'
op|'('
name|'cloud_cert'
op|'.'
name|'get_pubkey'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_210_can_add_project_role
dedent|''
dedent|''
name|'def'
name|'test_210_can_add_project_role'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'project'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_project'
op|'('
string|"'testproj'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'project'
op|'.'
name|'has_role'
op|'('
string|"'test1'"
op|','
string|"'sysadmin'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'manager'
op|'.'
name|'add_role'
op|'('
string|"'test1'"
op|','
string|"'sysadmin'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'project'
op|'.'
name|'has_role'
op|'('
string|"'test1'"
op|','
string|"'sysadmin'"
op|')'
op|')'
newline|'\n'
name|'project'
op|'.'
name|'add_role'
op|'('
string|"'test1'"
op|','
string|"'sysadmin'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'project'
op|'.'
name|'has_role'
op|'('
string|"'test1'"
op|','
string|"'sysadmin'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_211_can_list_project_roles
dedent|''
name|'def'
name|'test_211_can_list_project_roles'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'project'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_project'
op|'('
string|"'testproj'"
op|')'
newline|'\n'
name|'user'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user'
op|'('
string|"'test1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'manager'
op|'.'
name|'add_role'
op|'('
name|'user'
op|','
string|"'netadmin'"
op|','
name|'project'
op|')'
newline|'\n'
name|'roles'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user_roles'
op|'('
name|'user'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'sysadmin'"
name|'in'
name|'roles'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
string|"'netadmin'"
name|'in'
name|'roles'
op|')'
newline|'\n'
name|'project_roles'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user_roles'
op|'('
name|'user'
op|','
name|'project'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'sysadmin'"
name|'in'
name|'project_roles'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
string|"'netadmin'"
name|'in'
name|'project_roles'
op|')'
newline|'\n'
comment|'# has role should be false because global role is missing'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'has_role'
op|'('
name|'user'
op|','
string|"'netadmin'"
op|','
name|'project'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|member|test_212_can_remove_project_role
dedent|''
name|'def'
name|'test_212_can_remove_project_role'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'project'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_project'
op|'('
string|"'testproj'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'project'
op|'.'
name|'has_role'
op|'('
string|"'test1'"
op|','
string|"'sysadmin'"
op|')'
op|')'
newline|'\n'
name|'project'
op|'.'
name|'remove_role'
op|'('
string|"'test1'"
op|','
string|"'sysadmin'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'project'
op|'.'
name|'has_role'
op|'('
string|"'test1'"
op|','
string|"'sysadmin'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'manager'
op|'.'
name|'remove_role'
op|'('
string|"'test1'"
op|','
string|"'sysadmin'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'project'
op|'.'
name|'has_role'
op|'('
string|"'test1'"
op|','
string|"'sysadmin'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_214_can_retrieve_project_by_user
dedent|''
name|'def'
name|'test_214_can_retrieve_project_by_user'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'project'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'create_project'
op|'('
string|"'testproj2'"
op|','
string|"'test2'"
op|','
string|"'Another test project'"
op|','
op|'['
string|"'test2'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assert_'
op|'('
name|'len'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_projects'
op|'('
op|')'
op|')'
op|'>'
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_projects'
op|'('
string|"'test2'"
op|')'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_299_can_delete_project
dedent|''
name|'def'
name|'test_299_can_delete_project'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'manager'
op|'.'
name|'delete_project'
op|'('
string|"'testproj'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filter'
op|'('
name|'lambda'
name|'p'
op|':'
name|'p'
op|'.'
name|'name'
op|'=='
string|"'testproj'"
op|','
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_projects'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'manager'
op|'.'
name|'delete_project'
op|'('
string|"'testproj2'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_999_can_delete_users
dedent|''
name|'def'
name|'test_999_can_delete_users'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'manager'
op|'.'
name|'delete_user'
op|'('
string|"'test1'"
op|')'
newline|'\n'
name|'users'
op|'='
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_users'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filter'
op|'('
name|'lambda'
name|'u'
op|':'
name|'u'
op|'.'
name|'id'
op|'=='
string|"'test1'"
op|','
name|'users'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'manager'
op|'.'
name|'delete_user'
op|'('
string|"'test2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'manager'
op|'.'
name|'get_user'
op|'('
string|"'test2'"
op|')'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|'"__main__"'
op|':'
newline|'\n'
comment|'# TODO: Implement use_fake as an option'
nl|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
