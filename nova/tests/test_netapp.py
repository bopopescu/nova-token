begin_unit
comment|'# vim: tabstop=4 shiftwidth=4 softtabstop=4'
nl|'\n'
nl|'\n'
comment|'# Copyright (c) 2012 NetApp, Inc.'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
string|'"""\nTests for NetApp volume driver\n\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'BaseHTTPServer'
newline|'\n'
name|'import'
name|'httplib'
newline|'\n'
name|'import'
name|'StringIO'
newline|'\n'
nl|'\n'
name|'from'
name|'lxml'
name|'import'
name|'etree'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'log'
name|'as'
name|'logging'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'volume'
name|'import'
name|'netapp'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|LOG
name|'LOG'
op|'='
name|'logging'
op|'.'
name|'getLogger'
op|'('
name|'__name__'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
name|'WSDL_HEADER'
op|'='
string|'"""<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<definitions xmlns="http://schemas.xmlsoap.org/wsdl/"\n    xmlns:na="http://www.netapp.com/management/v1"\n    xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"\n    xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="NetAppDfm"\n    targetNamespace="http://www.netapp.com/management/v1">"""'
newline|'\n'
nl|'\n'
name|'WSDL_TYPES'
op|'='
string|'"""<types>\n<xsd:schema attributeFormDefault="unqualified" elementFormDefault="qualified"\n    targetNamespace="http://www.netapp.com/management/v1">\n<xsd:element name="ApiProxy">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Request" type="na:Request"/>\n            <xsd:element name="Target" type="xsd:string"/>\n            <xsd:element minOccurs="0" name="Timeout" type="xsd:integer"/>\n            <xsd:element minOccurs="0" name="Username" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="ApiProxyResult">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Response" type="na:Response"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetEditBegin">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="DatasetNameOrId" type="na:ObjNameOrId"/>\n            <xsd:element minOccurs="0" name="Force" type="xsd:boolean"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetEditBeginResult">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="EditLockId" type="xsd:integer"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetEditCommit">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element minOccurs="0" name="AssumeConfirmation"\n                type="xsd:boolean"/>\n            <xsd:element name="EditLockId" type="xsd:integer"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetEditCommitResult">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element minOccurs="0" name="IsProvisioningFailure"\n                type="xsd:boolean"/>\n            <xsd:element minOccurs="0" name="JobIds" type="na:ArrayOfJobInfo"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetEditRollback">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="EditLockId" type="xsd:integer"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetEditRollbackResult">\n    <xsd:complexType/>\n</xsd:element>\n<xsd:element name="DatasetListInfoIterEnd">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetListInfoIterEndResult">\n    <xsd:complexType/>\n</xsd:element>\n<xsd:element name="DatasetListInfoIterNext">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Maximum" type="xsd:integer"/>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetListInfoIterNextResult">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Datasets" type="na:ArrayOfDatasetInfo"/>\n            <xsd:element name="Records" type="xsd:integer"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetListInfoIterStart">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element minOccurs="0" name="ObjectNameOrId"\n                type="na:ObjNameOrId"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetListInfoIterStartResult">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Records" type="xsd:integer"/>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetMemberListInfoIterEnd">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetMemberListInfoIterEndResult">\n    <xsd:complexType/>\n</xsd:element>\n<xsd:element name="DatasetMemberListInfoIterNext">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Maximum" type="xsd:integer"/>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetMemberListInfoIterNextResult">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="DatasetMembers"\n                type="na:ArrayOfDatasetMemberInfo"/>\n            <xsd:element name="Records" type="xsd:integer"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetMemberListInfoIterStart">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="DatasetNameOrId" type="na:ObjNameOrId"/>\n            <xsd:element minOccurs="0" name="IncludeExportsInfo"\n                type="xsd:boolean"/>\n            <xsd:element minOccurs="0" name="IncludeIndirect"\n                type="xsd:boolean"/>\n            <xsd:element minOccurs="0" name="MemberType" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetMemberListInfoIterStartResult">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Records" type="xsd:integer"/>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetProvisionMember">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="EditLockId" type="xsd:integer"/>\n            <xsd:element name="ProvisionMemberRequestInfo"\n                type="na:ProvisionMemberRequestInfo"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetProvisionMemberResult">\n    <xsd:complexType/>\n</xsd:element>\n<xsd:element name="DatasetRemoveMember">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="DatasetMemberParameters"\n                type="na:ArrayOfDatasetMemberParameter"/>\n            <xsd:element minOccurs="0" name="Destroy" type="xsd:boolean"/>\n            <xsd:element name="EditLockId" type="xsd:integer"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DatasetRemoveMemberResult">\n    <xsd:complexType/>\n</xsd:element>\n<xsd:element name="DpJobProgressEventListIterEnd">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DpJobProgressEventListIterEndResult">\n    <xsd:complexType/>\n</xsd:element>\n<xsd:element name="DpJobProgressEventListIterNext">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Maximum" type="xsd:integer"/>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DpJobProgressEventListIterNextResult">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="ProgressEvents"\n                type="na:ArrayOfDpJobProgressEventInfo"/>\n            <xsd:element name="Records" type="xsd:integer"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DpJobProgressEventListIterStart">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element minOccurs="0" name="JobId" type="xsd:integer"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DpJobProgressEventListIterStartResult">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Records" type="xsd:integer"/>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DfmAbout">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element minOccurs="0" name="IncludeDirectorySizeInfo"\n                type="xsd:boolean"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="DfmAboutResult">\n    <xsd:complexType>\n        <xsd:all/>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="HostListInfoIterEnd">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="HostListInfoIterEndResult">\n    <xsd:complexType/>\n</xsd:element>\n<xsd:element name="HostListInfoIterNext">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Maximum" type="xsd:integer"/>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="HostListInfoIterNextResult">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Hosts" type="na:ArrayOfHostInfo"/>\n            <xsd:element name="Records" type="xsd:integer"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="HostListInfoIterStart">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element minOccurs="0" name="ObjectNameOrId"\n                type="na:ObjNameOrId"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="HostListInfoIterStartResult">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Records" type="xsd:integer"/>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="LunListInfoIterEnd">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="LunListInfoIterEndResult">\n    <xsd:complexType/>\n</xsd:element>\n<xsd:element name="LunListInfoIterNext">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Maximum" type="xsd:integer"/>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="LunListInfoIterNextResult">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Luns" type="na:ArrayOfLunInfo"/>\n            <xsd:element name="Records" type="xsd:integer"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="LunListInfoIterStart">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element minOccurs="0" name="ObjectNameOrId"\n                type="na:ObjNameOrId"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="LunListInfoIterStartResult">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element name="Records" type="xsd:integer"/>\n            <xsd:element name="Tag" type="xsd:string"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="StorageServiceDatasetProvision">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element minOccurs="0" name="AssumeConfirmation"\n                type="xsd:boolean"/>\n            <xsd:element name="DatasetName" type="na:ObjName"/>\n            <xsd:element name="StorageServiceNameOrId" type="na:ObjNameOrId"/>\n            <xsd:element minOccurs="0" name="StorageSetDetails"\n                type="na:ArrayOfStorageSetInfo"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:element name="StorageServiceDatasetProvisionResult">\n    <xsd:complexType>\n        <xsd:all>\n            <xsd:element minOccurs="0" name="ConformanceAlerts"\n                type="na:ArrayOfConformanceAlert"/>\n            <xsd:element name="DatasetId" type="na:ObjId"/>\n            <xsd:element minOccurs="0" name="DryRunResults"\n                type="na:ArrayOfDryRunResult"/>\n        </xsd:all>\n    </xsd:complexType>\n</xsd:element>\n<xsd:complexType name="ArrayOfDatasetInfo">\n    <xsd:sequence>\n        <xsd:element maxOccurs="unbounded" name="DatasetInfo"\n            type="na:DatasetInfo"/>\n    </xsd:sequence>\n</xsd:complexType>\n<xsd:complexType name="ArrayOfDatasetMemberInfo">\n    <xsd:sequence>\n        <xsd:element maxOccurs="unbounded" name="DatasetMemberInfo"\n            type="na:DatasetMemberInfo"/>\n    </xsd:sequence>\n</xsd:complexType>\n<xsd:complexType name="ArrayOfDatasetMemberParameter">\n    <xsd:sequence>\n        <xsd:element maxOccurs="unbounded" name="DatasetMemberParameter"\n            type="na:DatasetMemberParameter"/>\n    </xsd:sequence>\n</xsd:complexType>\n<xsd:complexType name="ArrayOfDfmMetadataField">\n    <xsd:sequence>\n        <xsd:element maxOccurs="unbounded" name="DfmMetadataField"\n            type="na:DfmMetadataField"/>\n    </xsd:sequence>\n</xsd:complexType>\n<xsd:complexType name="ArrayOfDpJobProgressEventInfo">\n    <xsd:sequence>\n        <xsd:element maxOccurs="unbounded" name="DpJobProgressEventInfo"\n            type="na:DpJobProgressEventInfo"/>\n    </xsd:sequence>\n</xsd:complexType>\n<xsd:complexType name="ArrayOfHostInfo">\n    <xsd:sequence>\n        <xsd:element maxOccurs="unbounded" name="HostInfo" type="na:HostInfo"/>\n    </xsd:sequence>\n</xsd:complexType>\n<xsd:complexType name="ArrayOfJobInfo">\n    <xsd:sequence>\n        <xsd:element maxOccurs="unbounded" name="JobInfo" type="na:JobInfo"/>\n    </xsd:sequence>\n</xsd:complexType>\n<xsd:complexType name="ArrayOfLunInfo">\n    <xsd:sequence>\n        <xsd:element maxOccurs="unbounded" name="LunInfo" type="na:LunInfo"/>\n    </xsd:sequence>\n</xsd:complexType>\n<xsd:complexType name="ArrayOfStorageSetInfo">\n    <xsd:sequence>\n        <xsd:element maxOccurs="unbounded" name="StorageSetInfo"\n            type="na:StorageSetInfo"/>\n    </xsd:sequence>\n</xsd:complexType>\n<xsd:complexType name="DatasetExportInfo">\n    <xsd:all>\n        <xsd:element minOccurs="0" name="DatasetExportProtocol"\n            type="na:DatasetExportProtocol"/>\n        <xsd:element minOccurs="0" name="DatasetLunMappingInfo"\n            type="na:DatasetLunMappingInfo"/>\n    </xsd:all>\n</xsd:complexType>\n<xsd:simpleType name="DatasetExportProtocol">\n    <xsd:restriction base="xsd:string"/>\n</xsd:simpleType>\n<xsd:complexType name="DatasetInfo">\n    <xsd:all>\n        <xsd:element name="DatasetId" type="na:ObjId"/>\n        <xsd:element name="DatasetName" type="na:ObjName"/>\n        <xsd:element name="DatasetMetadata" type="na:ArrayOfDfmMetadataField"/>\n    </xsd:all>\n</xsd:complexType>\n<xsd:complexType name="DatasetLunMappingInfo">\n    <xsd:all>\n        <xsd:element name="IgroupOsType" type="xsd:string"/>\n    </xsd:all>\n</xsd:complexType>\n<xsd:complexType name="DatasetMemberInfo">\n    <xsd:all>\n        <xsd:element name="MemberId" type="na:ObjId"/>\n        <xsd:element name="MemberName" type="na:ObjName"/>\n    </xsd:all>\n</xsd:complexType>\n<xsd:complexType name="DatasetMemberParameter">\n    <xsd:all>\n        <xsd:element name="ObjectNameOrId" type="na:ObjNameOrId"/>\n    </xsd:all>\n</xsd:complexType>\n<xsd:complexType name="DfmMetadataField">\n    <xsd:all>\n        <xsd:element name="FieldName" type="xsd:string"/>\n        <xsd:element name="FieldValue" type="xsd:string"/>\n    </xsd:all>\n</xsd:complexType>\n<xsd:complexType name="DpJobProgressEventInfo">\n    <xsd:all>\n        <xsd:element name="EventStatus" type="na:ObjStatus"/>\n        <xsd:element name="EventType" type="xsd:string"/>\n        <xsd:element minOccurs="0" name="ProgressLunInfo"\n            type="na:ProgressLunInfo"/>\n    </xsd:all>\n</xsd:complexType>\n<xsd:simpleType name="DpPolicyNodeName">\n    <xsd:restriction base="xsd:string"/>\n</xsd:simpleType>\n<xsd:simpleType name="HostId">\n    <xsd:restriction base="xsd:integer"/>\n</xsd:simpleType>\n<xsd:complexType name="HostInfo">\n    <xsd:all>\n        <xsd:element name="HostAddress" type="xsd:string"/>\n        <xsd:element name="HostId" type="na:HostId"/>\n        <xsd:element name="HostName" type="xsd:string"/>\n    </xsd:all>\n</xsd:complexType>\n<xsd:complexType name="JobInfo">\n    <xsd:all>\n        <xsd:element name="JobId" type="xsd:integer"/>\n    </xsd:all>\n</xsd:complexType>\n<xsd:complexType name="LunInfo">\n    <xsd:all>\n        <xsd:element name="HostId" type="na:ObjId"/>\n        <xsd:element name="LunPath" type="na:ObjName"/>\n    </xsd:all>\n</xsd:complexType>\n<xsd:simpleType name="ObjId">\n    <xsd:restriction base="xsd:integer"/>\n</xsd:simpleType>\n<xsd:simpleType name="ObjName">\n    <xsd:restriction base="xsd:string"/>\n</xsd:simpleType>\n<xsd:simpleType name="ObjNameOrId">\n    <xsd:restriction base="xsd:string"/>\n</xsd:simpleType>\n<xsd:simpleType name="ObjStatus">\n    <xsd:restriction base="xsd:string"/>\n</xsd:simpleType>\n<xsd:complexType name="ProgressLunInfo">\n    <xsd:all>\n        <xsd:element name="LunPathId" type="na:ObjId"/>\n        <xsd:element name="LunName" type="na:ObjName"/>\n    </xsd:all>\n</xsd:complexType>\n<xsd:complexType name="ProvisionMemberRequestInfo">\n    <xsd:all>\n        <xsd:element minOccurs="0" name="Description" type="xsd:string"/>\n        <xsd:element minOccurs="0" name="MaximumSnapshotSpace"\n            type="xsd:integer"/>\n        <xsd:element name="Name" type="xsd:string"/>\n        <xsd:element name="Size" type="xsd:integer"/>\n    </xsd:all>\n</xsd:complexType>\n<xsd:complexType name="Request">\n    <xsd:all>\n        <xsd:element minOccurs="0" name="Args">\n            <xsd:complexType>\n                <xsd:sequence>\n                    <xsd:any maxOccurs="unbounded" minOccurs="0"/>\n                </xsd:sequence>\n            </xsd:complexType>\n        </xsd:element>\n        <xsd:element name="Name" type="xsd:string">\n        </xsd:element>\n    </xsd:all>\n</xsd:complexType>\n<xsd:complexType name="Response">\n    <xsd:all>\n        <xsd:element minOccurs="0" name="Errno" type="xsd:integer"/>\n        <xsd:element minOccurs="0" name="Reason" type="xsd:string"/>\n        <xsd:element minOccurs="0" name="Results">\n            <xsd:complexType>\n                <xsd:sequence>\n                    <xsd:any maxOccurs="unbounded" minOccurs="0"/>\n                </xsd:sequence>\n            </xsd:complexType>\n        </xsd:element>\n        <xsd:element name="Status" type="xsd:string"/>\n    </xsd:all>\n</xsd:complexType>\n<xsd:complexType name="StorageSetInfo">\n    <xsd:all>\n        <xsd:element minOccurs="0" name="DatasetExportInfo"\n            type="na:DatasetExportInfo"/>\n        <xsd:element minOccurs="0" name="DpNodeName"\n            type="na:DpPolicyNodeName"/>\n        <xsd:element minOccurs="0" name="ServerNameOrId"\n            type="na:ObjNameOrId"/>\n    </xsd:all>\n</xsd:complexType>\n</xsd:schema></types>"""'
newline|'\n'
nl|'\n'
name|'WSDL_TRAILER'
op|'='
string|'"""<service name="DfmService">\n<port binding="na:DfmBinding" name="DfmPort">\n<soap:address location="https://HOST_NAME:8488/apis/soap/v1"/>\n</port></service></definitions>"""'
newline|'\n'
nl|'\n'
name|'RESPONSE_PREFIX'
op|'='
string|'"""<?xml version="1.0" encoding="UTF-8"?>\n<env:Envelope xmlns:env="http://schemas.xmlsoap.org/soap/envelope/"\n    xmlns:na="http://www.netapp.com/management/v1"><env:Header/><env:Body>"""'
newline|'\n'
nl|'\n'
name|'RESPONSE_SUFFIX'
op|'='
string|'"""</env:Body></env:Envelope>"""'
newline|'\n'
nl|'\n'
DECL|variable|APIS
name|'APIS'
op|'='
op|'['
string|"'ApiProxy'"
op|','
string|"'DatasetListInfoIterStart'"
op|','
string|"'DatasetListInfoIterNext'"
op|','
nl|'\n'
string|"'DatasetListInfoIterEnd'"
op|','
string|"'DatasetEditBegin'"
op|','
string|"'DatasetEditCommit'"
op|','
nl|'\n'
string|"'DatasetProvisionMember'"
op|','
string|"'DatasetRemoveMember'"
op|','
string|"'DfmAbout'"
op|','
nl|'\n'
string|"'DpJobProgressEventListIterStart'"
op|','
string|"'DpJobProgressEventListIterNext'"
op|','
nl|'\n'
string|"'DpJobProgressEventListIterEnd'"
op|','
string|"'DatasetMemberListInfoIterStart'"
op|','
nl|'\n'
string|"'DatasetMemberListInfoIterNext'"
op|','
string|"'DatasetMemberListInfoIterEnd'"
op|','
nl|'\n'
string|"'HostListInfoIterStart'"
op|','
string|"'HostListInfoIterNext'"
op|','
string|"'HostListInfoIterEnd'"
op|','
nl|'\n'
string|"'LunListInfoIterStart'"
op|','
string|"'LunListInfoIterNext'"
op|','
string|"'LunListInfoIterEnd'"
op|','
nl|'\n'
string|"'StorageServiceDatasetProvision'"
op|']'
newline|'\n'
nl|'\n'
DECL|variable|iter_count
name|'iter_count'
op|'='
number|'0'
newline|'\n'
DECL|variable|iter_table
name|'iter_table'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeDfmServerHandler
name|'class'
name|'FakeDfmServerHandler'
op|'('
name|'BaseHTTPServer'
op|'.'
name|'BaseHTTPRequestHandler'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""HTTP handler that fakes enough stuff to allow the driver to run"""'
newline|'\n'
nl|'\n'
DECL|member|do_GET
name|'def'
name|'do_GET'
op|'('
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Respond to a GET request."""'
newline|'\n'
name|'if'
string|"'/dfm.wsdl'"
op|'!='
name|'s'
op|'.'
name|'path'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'.'
name|'send_response'
op|'('
number|'404'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'end_headers'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'s'
op|'.'
name|'send_response'
op|'('
number|'200'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'send_header'
op|'('
string|'"Content-Type"'
op|','
string|'"application/wsdl+xml"'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'end_headers'
op|'('
op|')'
newline|'\n'
name|'out'
op|'='
name|'s'
op|'.'
name|'wfile'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
name|'WSDL_HEADER'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
name|'WSDL_TYPES'
op|')'
newline|'\n'
name|'for'
name|'api'
name|'in'
name|'APIS'
op|':'
newline|'\n'
indent|'            '
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<message name="%sRequest">\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<part element="na:%s" name="parameters"/>\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|"'</message>'"
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<message name="%sResponse">\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<part element="na:%sResult" name="results"/>\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|"'</message>'"
op|')'
newline|'\n'
dedent|''
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<portType name="DfmInterface">\''
op|')'
newline|'\n'
name|'for'
name|'api'
name|'in'
name|'APIS'
op|':'
newline|'\n'
indent|'            '
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<operation name="%s">\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<input message="na:%sRequest"/>\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<output message="na:%sResponse"/>\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|"'</operation>'"
op|')'
newline|'\n'
dedent|''
name|'out'
op|'.'
name|'write'
op|'('
string|"'</portType>'"
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<binding name="DfmBinding" type="na:DfmInterface">\''
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<soap:binding style="document" \''
op|'+'
nl|'\n'
string|'\'transport="http://schemas.xmlsoap.org/soap/http"/>\''
op|')'
newline|'\n'
name|'for'
name|'api'
name|'in'
name|'APIS'
op|':'
newline|'\n'
indent|'            '
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<operation name="%s">\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<soap:operation soapAction="urn:%s"/>\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<input><soap:body use="literal"/></input>\''
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<output><soap:body use="literal"/></output>\''
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|"'</operation>'"
op|')'
newline|'\n'
dedent|''
name|'out'
op|'.'
name|'write'
op|'('
string|"'</binding>'"
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
name|'WSDL_TRAILER'
op|')'
newline|'\n'
nl|'\n'
DECL|member|do_POST
dedent|''
name|'def'
name|'do_POST'
op|'('
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Respond to a POST request."""'
newline|'\n'
name|'if'
string|"'/apis/soap/v1'"
op|'!='
name|'s'
op|'.'
name|'path'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'.'
name|'send_response'
op|'('
number|'404'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'end_headers'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'request_xml'
op|'='
name|'s'
op|'.'
name|'rfile'
op|'.'
name|'read'
op|'('
name|'int'
op|'('
name|'s'
op|'.'
name|'headers'
op|'['
string|"'Content-Length'"
op|']'
op|')'
op|')'
newline|'\n'
name|'ntap_ns'
op|'='
string|"'http://www.netapp.com/management/v1'"
newline|'\n'
name|'nsmap'
op|'='
op|'{'
string|"'env'"
op|':'
string|"'http://schemas.xmlsoap.org/soap/envelope/'"
op|','
nl|'\n'
string|"'na'"
op|':'
name|'ntap_ns'
op|'}'
newline|'\n'
name|'root'
op|'='
name|'etree'
op|'.'
name|'fromstring'
op|'('
name|'request_xml'
op|')'
newline|'\n'
nl|'\n'
name|'body'
op|'='
name|'root'
op|'.'
name|'xpath'
op|'('
string|"'/env:Envelope/env:Body'"
op|','
name|'namespaces'
op|'='
name|'nsmap'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'request'
op|'='
name|'body'
op|'.'
name|'getchildren'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'tag'
op|'='
name|'request'
op|'.'
name|'tag'
newline|'\n'
name|'if'
name|'not'
name|'tag'
op|'.'
name|'startswith'
op|'('
string|"'{'"
op|'+'
name|'ntap_ns'
op|'+'
string|"'}'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'.'
name|'send_response'
op|'('
number|'500'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'end_headers'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'api'
op|'='
name|'tag'
op|'['
op|'('
number|'2'
op|'+'
name|'len'
op|'('
name|'ntap_ns'
op|')'
op|')'
op|':'
op|']'
newline|'\n'
name|'global'
name|'iter_count'
newline|'\n'
name|'global'
name|'iter_table'
newline|'\n'
name|'if'
string|"'DatasetListInfoIterStart'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'iter_name'
op|'='
string|"'dataset_%s'"
op|'%'
name|'iter_count'
newline|'\n'
name|'iter_count'
op|'='
name|'iter_count'
op|'+'
number|'1'
newline|'\n'
name|'iter_table'
op|'['
name|'iter_name'
op|']'
op|'='
number|'0'
newline|'\n'
name|'body'
op|'='
string|'"""<na:DatasetListInfoIterStartResult>\n                    <na:Records>1</na:Records>\n                    <na:Tag>%s</na:Tag>\n                </na:DatasetListInfoIterStartResult>"""'
op|'%'
name|'iter_name'
newline|'\n'
dedent|''
name|'elif'
string|"'DatasetListInfoIterNext'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'tags'
op|'='
name|'body'
op|'.'
name|'xpath'
op|'('
string|"'na:DatasetListInfoIterNext/na:Tag'"
op|','
nl|'\n'
name|'namespaces'
op|'='
name|'nsmap'
op|')'
newline|'\n'
name|'iter_name'
op|'='
name|'tags'
op|'['
number|'0'
op|']'
op|'.'
name|'text'
newline|'\n'
name|'if'
name|'iter_table'
op|'['
name|'iter_name'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'body'
op|'='
string|'"""<na:DatasetListInfoIterNextResult>\n                        <na:Datasets></na:Datasets>\n                        <na:Records>0</na:Records>\n                    </na:DatasetListInfoIterNextResult>"""'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'iter_table'
op|'['
name|'iter_name'
op|']'
op|'='
number|'1'
newline|'\n'
name|'body'
op|'='
string|'"""<na:DatasetListInfoIterNextResult>\n                        <na:Datasets>\n                            <na:DatasetInfo>\n                                <na:DatasetId>0</na:DatasetId>\n                                <na:DatasetMetadata>\n                                    <na:DfmMetadataField>\n                                  <na:FieldName>OpenStackProject</na:FieldName>\n                                        <na:FieldValue>testproj</na:FieldValue>\n                                    </na:DfmMetadataField>\n                                    <na:DfmMetadataField>\n                                  <na:FieldName>OpenStackVolType</na:FieldName>\n                                        <na:FieldValue></na:FieldValue>\n                                    </na:DfmMetadataField>\n                                </na:DatasetMetadata>\n                            <na:DatasetName>OpenStack_testproj</na:DatasetName>\n                            </na:DatasetInfo>\n                        </na:Datasets>\n                        <na:Records>1</na:Records>\n                    </na:DatasetListInfoIterNextResult>"""'
newline|'\n'
dedent|''
dedent|''
name|'elif'
string|"'DatasetListInfoIterEnd'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<na:DatasetListInfoIterEndResult/>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'DatasetEditBegin'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<na:DatasetEditBeginResult>\n                    <na:EditLockId>0</na:EditLockId>\n                </na:DatasetEditBeginResult>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'DatasetEditCommit'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<na:DatasetEditCommitResult>\n                    <na:IsProvisioningFailure>false</na:IsProvisioningFailure>\n                    <na:JobIds>\n                        <na:JobInfo>\n                            <na:JobId>0</na:JobId>\n                        </na:JobInfo>\n                    </na:JobIds>\n                </na:DatasetEditCommitResult>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'DatasetProvisionMember'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<na:DatasetProvisionMemberResult/>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'DatasetRemoveMember'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<na:DatasetRemoveMemberResult/>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'DfmAbout'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<na:DfmAboutResult/>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'DpJobProgressEventListIterStart'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'iter_name'
op|'='
string|"'dpjobprogress_%s'"
op|'%'
name|'iter_count'
newline|'\n'
name|'iter_count'
op|'='
name|'iter_count'
op|'+'
number|'1'
newline|'\n'
name|'iter_table'
op|'['
name|'iter_name'
op|']'
op|'='
number|'0'
newline|'\n'
name|'body'
op|'='
string|'"""<na:DpJobProgressEventListIterStartResult>\n                    <na:Records>2</na:Records>\n                    <na:Tag>%s</na:Tag>\n                </na:DpJobProgressEventListIterStartResult>"""'
op|'%'
name|'iter_name'
newline|'\n'
dedent|''
name|'elif'
string|"'DpJobProgressEventListIterNext'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'tags'
op|'='
name|'body'
op|'.'
name|'xpath'
op|'('
string|"'na:DpJobProgressEventListIterNext/na:Tag'"
op|','
nl|'\n'
name|'namespaces'
op|'='
name|'nsmap'
op|')'
newline|'\n'
name|'iter_name'
op|'='
name|'tags'
op|'['
number|'0'
op|']'
op|'.'
name|'text'
newline|'\n'
name|'if'
name|'iter_table'
op|'['
name|'iter_name'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'body'
op|'='
string|'"""<na:DpJobProgressEventListIterNextResult/>"""'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'iter_table'
op|'['
name|'iter_name'
op|']'
op|'='
number|'1'
newline|'\n'
name|'name'
op|'='
op|'('
string|"'filer:/OpenStack_testproj/volume-00000001/'"
nl|'\n'
string|"'volume-00000001'"
op|')'
newline|'\n'
name|'body'
op|'='
string|'"""<na:DpJobProgressEventListIterNextResult>\n                        <na:ProgressEvents>\n                            <na:DpJobProgressEventInfo>\n                                <na:EventStatus>normal</na:EventStatus>\n                                <na:EventType>lun-create</na:EventType>\n                                <na:ProgressLunInfo>\n                                    <na:LunPathId>0</na:LunPathId>\n                                    <na:LunName>%s</na:LunName>\n                                 </na:ProgressLunInfo>\n                            </na:DpJobProgressEventInfo>\n                            <na:DpJobProgressEventInfo>\n                                <na:EventStatus>normal</na:EventStatus>\n                                <na:EventType>job-end</na:EventType>\n                            </na:DpJobProgressEventInfo>\n                        </na:ProgressEvents>\n                        <na:Records>2</na:Records>\n                    </na:DpJobProgressEventListIterNextResult>"""'
op|'%'
name|'name'
newline|'\n'
dedent|''
dedent|''
name|'elif'
string|"'DpJobProgressEventListIterEnd'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<na:DpJobProgressEventListIterEndResult/>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'DatasetMemberListInfoIterStart'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'iter_name'
op|'='
string|"'datasetmember_%s'"
op|'%'
name|'iter_count'
newline|'\n'
name|'iter_count'
op|'='
name|'iter_count'
op|'+'
number|'1'
newline|'\n'
name|'iter_table'
op|'['
name|'iter_name'
op|']'
op|'='
number|'0'
newline|'\n'
name|'body'
op|'='
string|'"""<na:DatasetMemberListInfoIterStartResult>\n                    <na:Records>1</na:Records>\n                    <na:Tag>%s</na:Tag>\n                </na:DatasetMemberListInfoIterStartResult>"""'
op|'%'
name|'iter_name'
newline|'\n'
dedent|''
name|'elif'
string|"'DatasetMemberListInfoIterNext'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'tags'
op|'='
name|'body'
op|'.'
name|'xpath'
op|'('
string|"'na:DatasetMemberListInfoIterNext/na:Tag'"
op|','
nl|'\n'
name|'namespaces'
op|'='
name|'nsmap'
op|')'
newline|'\n'
name|'iter_name'
op|'='
name|'tags'
op|'['
number|'0'
op|']'
op|'.'
name|'text'
newline|'\n'
name|'if'
name|'iter_table'
op|'['
name|'iter_name'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'body'
op|'='
string|'"""<na:DatasetMemberListInfoIterNextResult>\n                        <na:DatasetMembers></na:DatasetMembers>\n                        <na:Records>0</na:Records>\n                    </na:DatasetMemberListInfoIterNextResult>"""'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'iter_table'
op|'['
name|'iter_name'
op|']'
op|'='
number|'1'
newline|'\n'
name|'name'
op|'='
op|'('
string|"'filer:/OpenStack_testproj/volume-00000001/'"
nl|'\n'
string|"'volume-00000001'"
op|')'
newline|'\n'
name|'body'
op|'='
string|'"""<na:DatasetMemberListInfoIterNextResult>\n                        <na:DatasetMembers>\n                            <na:DatasetMemberInfo>\n                                <na:MemberId>0</na:MemberId>\n                                <na:MemberName>%s</na:MemberName>\n                            </na:DatasetMemberInfo>\n                        </na:DatasetMembers>\n                        <na:Records>1</na:Records>\n                    </na:DatasetMemberListInfoIterNextResult>"""'
op|'%'
name|'name'
newline|'\n'
dedent|''
dedent|''
name|'elif'
string|"'DatasetMemberListInfoIterEnd'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<na:DatasetMemberListInfoIterEndResult/>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'HostListInfoIterStart'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<na:HostListInfoIterStartResult>\n                    <na:Records>1</na:Records>\n                    <na:Tag>host</na:Tag>\n                </na:HostListInfoIterStartResult>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'HostListInfoIterNext'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<na:HostListInfoIterNextResult>\n                    <na:Hosts>\n                        <na:HostInfo>\n                            <na:HostAddress>1.2.3.4</na:HostAddress>\n                            <na:HostId>0</na:HostId>\n                            <na:HostName>filer</na:HostName>\n                        </na:HostInfo>\n                    </na:Hosts>\n                    <na:Records>1</na:Records>\n                </na:HostListInfoIterNextResult>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'HostListInfoIterEnd'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<na:HostListInfoIterEndResult/>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'LunListInfoIterStart'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<na:LunListInfoIterStartResult>\n                    <na:Records>1</na:Records>\n                    <na:Tag>lun</na:Tag>\n                </na:LunListInfoIterStartResult>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'LunListInfoIterNext'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
string|"'OpenStack_testproj/volume-00000001/volume-00000001'"
newline|'\n'
name|'body'
op|'='
string|'"""<na:LunListInfoIterNextResult>\n                    <na:Luns>\n                        <na:LunInfo>\n                            <na:HostId>0</na:HostId>\n                            <na:LunPath>%s</na:LunPath>\n                        </na:LunInfo>\n                    </na:Luns>\n                    <na:Records>1</na:Records>\n                </na:LunListInfoIterNextResult>"""'
op|'%'
name|'path'
newline|'\n'
dedent|''
name|'elif'
string|"'LunListInfoIterEnd'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<na:LunListInfoIterEndResult/>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'ApiProxy'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'names'
op|'='
name|'body'
op|'.'
name|'xpath'
op|'('
string|"'na:ApiProxy/na:Request/na:Name'"
op|','
nl|'\n'
name|'namespaces'
op|'='
name|'nsmap'
op|')'
newline|'\n'
name|'proxy'
op|'='
name|'names'
op|'['
number|'0'
op|']'
op|'.'
name|'text'
newline|'\n'
name|'if'
string|"'igroup-list-info'"
op|'=='
name|'proxy'
op|':'
newline|'\n'
indent|'                '
name|'igroup'
op|'='
string|"'openstack-iqn.1993-08.org.debian:01:23456789'"
newline|'\n'
name|'initiator'
op|'='
string|"'iqn.1993-08.org.debian:01:23456789'"
newline|'\n'
name|'proxy_body'
op|'='
string|'"""<initiator-groups>\n                        <initiator-group-info>\n                            <initiator-group-name>%s</initiator-group-name>\n                            <initiator-group-type>iscsi</initiator-group-type>\n                       <initiator-group-os-type>linux</initiator-group-os-type>\n                            <initiators>\n                                <initiator-info>\n                                    <initiator-name>%s</initiator-name>\n                                </initiator-info>\n                            </initiators>\n                        </initiator-group-info>\n                    </initiator-groups>"""'
op|'%'
op|'('
name|'igroup'
op|','
name|'initiator'
op|')'
newline|'\n'
dedent|''
name|'elif'
string|"'igroup-create'"
op|'=='
name|'proxy'
op|':'
newline|'\n'
indent|'                '
name|'proxy_body'
op|'='
string|"''"
newline|'\n'
dedent|''
name|'elif'
string|"'igroup-add'"
op|'=='
name|'proxy'
op|':'
newline|'\n'
indent|'                '
name|'proxy_body'
op|'='
string|"''"
newline|'\n'
dedent|''
name|'elif'
string|"'lun-map-list-info'"
op|'=='
name|'proxy'
op|':'
newline|'\n'
indent|'                '
name|'proxy_body'
op|'='
string|"'<initiator-groups/>'"
newline|'\n'
dedent|''
name|'elif'
string|"'lun-map'"
op|'=='
name|'proxy'
op|':'
newline|'\n'
indent|'                '
name|'proxy_body'
op|'='
string|"'<lun-id-assigned>0</lun-id-assigned>'"
newline|'\n'
dedent|''
name|'elif'
string|"'lun-unmap'"
op|'=='
name|'proxy'
op|':'
newline|'\n'
indent|'                '
name|'proxy_body'
op|'='
string|"''"
newline|'\n'
dedent|''
name|'elif'
string|"'iscsi-portal-list-info'"
op|'=='
name|'proxy'
op|':'
newline|'\n'
indent|'                '
name|'proxy_body'
op|'='
string|'"""<iscsi-portal-list-entries>\n                        <iscsi-portal-list-entry-info>\n                            <ip-address>1.2.3.4</ip-address>\n                            <ip-port>3260</ip-port>\n                            <tpgroup-tag>1000</tpgroup-tag>\n                        </iscsi-portal-list-entry-info>\n                    </iscsi-portal-list-entries>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'iscsi-node-get-name'"
op|'=='
name|'proxy'
op|':'
newline|'\n'
indent|'                '
name|'target'
op|'='
string|"'iqn.1992-08.com.netapp:sn.111111111'"
newline|'\n'
name|'proxy_body'
op|'='
string|"'<node-name>%s</node-name>'"
op|'%'
name|'target'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# Unknown proxy API'
nl|'\n'
indent|'                '
name|'s'
op|'.'
name|'send_response'
op|'('
number|'500'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'end_headers'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'api'
op|'='
name|'api'
op|'+'
string|"':'"
op|'+'
name|'proxy'
newline|'\n'
name|'proxy_header'
op|'='
string|"'<na:ApiProxyResult><na:Response><na:Results>'"
newline|'\n'
name|'proxy_trailer'
op|'='
string|'"""</na:Results><na:Status>passed</na:Status>\n                </na:Response></na:ApiProxyResult>"""'
newline|'\n'
name|'body'
op|'='
name|'proxy_header'
op|'+'
name|'proxy_body'
op|'+'
name|'proxy_trailer'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# Unknown API'
nl|'\n'
indent|'            '
name|'s'
op|'.'
name|'send_response'
op|'('
number|'500'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'end_headers'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'s'
op|'.'
name|'send_response'
op|'('
number|'200'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'send_header'
op|'('
string|'"Content-Type"'
op|','
string|'"text/xml; charset=utf-8"'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'end_headers'
op|'('
op|')'
newline|'\n'
name|'s'
op|'.'
name|'wfile'
op|'.'
name|'write'
op|'('
name|'RESPONSE_PREFIX'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'wfile'
op|'.'
name|'write'
op|'('
name|'body'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'wfile'
op|'.'
name|'write'
op|'('
name|'RESPONSE_SUFFIX'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeHttplibSocket
dedent|''
dedent|''
name|'class'
name|'FakeHttplibSocket'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""A fake socket implementation for httplib.HTTPResponse"""'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_rbuffer'
op|'='
name|'StringIO'
op|'.'
name|'StringIO'
op|'('
name|'value'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_wbuffer'
op|'='
name|'StringIO'
op|'.'
name|'StringIO'
op|'('
string|"''"
op|')'
newline|'\n'
name|'oldclose'
op|'='
name|'self'
op|'.'
name|'_wbuffer'
op|'.'
name|'close'
newline|'\n'
nl|'\n'
DECL|function|newclose
name|'def'
name|'newclose'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'result'
op|'='
name|'self'
op|'.'
name|'_wbuffer'
op|'.'
name|'getvalue'
op|'('
op|')'
newline|'\n'
name|'oldclose'
op|'('
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'_wbuffer'
op|'.'
name|'close'
op|'='
name|'newclose'
newline|'\n'
nl|'\n'
DECL|member|makefile
dedent|''
name|'def'
name|'makefile'
op|'('
name|'self'
op|','
name|'mode'
op|','
name|'_other'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Returns the socket\'s internal buffer"""'
newline|'\n'
name|'if'
name|'mode'
op|'=='
string|"'r'"
name|'or'
name|'mode'
op|'=='
string|"'rb'"
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'_rbuffer'
newline|'\n'
dedent|''
name|'if'
name|'mode'
op|'=='
string|"'w'"
name|'or'
name|'mode'
op|'=='
string|"'wb'"
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'_wbuffer'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeHTTPConnection
dedent|''
dedent|''
dedent|''
name|'class'
name|'FakeHTTPConnection'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""A fake httplib.HTTPConnection for netapp tests\n\n    Requests made via this connection actually get translated and routed into\n    the fake Dfm handler above, we then turn the response into\n    the httplib.HTTPResponse that the caller expects.\n    """'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'host'
op|','
name|'timeout'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'host'
op|'='
name|'host'
newline|'\n'
nl|'\n'
DECL|member|request
dedent|''
name|'def'
name|'request'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'data'
op|'='
name|'None'
op|','
name|'headers'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'headers'
op|':'
newline|'\n'
indent|'            '
name|'headers'
op|'='
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'req_str'
op|'='
string|"'%s %s HTTP/1.1\\r\\n'"
op|'%'
op|'('
name|'method'
op|','
name|'path'
op|')'
newline|'\n'
name|'for'
name|'key'
op|','
name|'value'
name|'in'
name|'headers'
op|'.'
name|'iteritems'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'req_str'
op|'+='
string|'"%s: %s\\r\\n"'
op|'%'
op|'('
name|'key'
op|','
name|'value'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'data'
op|':'
newline|'\n'
indent|'            '
name|'req_str'
op|'+='
string|"'\\r\\n%s'"
op|'%'
name|'data'
newline|'\n'
nl|'\n'
comment|'# NOTE(vish): normally the http transport normailizes from unicode'
nl|'\n'
dedent|''
name|'sock'
op|'='
name|'FakeHttplibSocket'
op|'('
name|'req_str'
op|'.'
name|'decode'
op|'('
string|'"latin-1"'
op|')'
op|'.'
name|'encode'
op|'('
string|'"utf-8"'
op|')'
op|')'
newline|'\n'
comment|'# NOTE(vish): stop the server from trying to look up address from'
nl|'\n'
comment|'#             the fake socket'
nl|'\n'
name|'FakeDfmServerHandler'
op|'.'
name|'address_string'
op|'='
name|'lambda'
name|'x'
op|':'
string|"'127.0.0.1'"
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'='
name|'FakeDfmServerHandler'
op|'('
name|'sock'
op|','
string|"'127.0.0.1:8088'"
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'sock'
op|'='
name|'FakeHttplibSocket'
op|'('
name|'sock'
op|'.'
name|'result'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'http_response'
op|'='
name|'httplib'
op|'.'
name|'HTTPResponse'
op|'('
name|'self'
op|'.'
name|'sock'
op|')'
newline|'\n'
nl|'\n'
DECL|member|set_debuglevel
dedent|''
name|'def'
name|'set_debuglevel'
op|'('
name|'self'
op|','
name|'level'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|getresponse
dedent|''
name|'def'
name|'getresponse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'http_response'
op|'.'
name|'begin'
op|'('
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'http_response'
newline|'\n'
nl|'\n'
DECL|member|getresponsebody
dedent|''
name|'def'
name|'getresponsebody'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'sock'
op|'.'
name|'result'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|NetAppDriverTestCase
dedent|''
dedent|''
name|'class'
name|'NetAppDriverTestCase'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Test case for NetAppISCSIDriver"""'
newline|'\n'
DECL|variable|STORAGE_SERVICE
name|'STORAGE_SERVICE'
op|'='
string|"'Openstack Service'"
newline|'\n'
DECL|variable|STORAGE_SERVICE_PREFIX
name|'STORAGE_SERVICE_PREFIX'
op|'='
string|"'Openstack Service-'"
newline|'\n'
DECL|variable|PROJECT_ID
name|'PROJECT_ID'
op|'='
string|"'testproj'"
newline|'\n'
DECL|variable|VOLUME_NAME
name|'VOLUME_NAME'
op|'='
string|"'volume-00000001'"
newline|'\n'
DECL|variable|VOLUME_TYPE
name|'VOLUME_TYPE'
op|'='
string|"''"
newline|'\n'
DECL|variable|VOLUME_SIZE
name|'VOLUME_SIZE'
op|'='
number|'2147483648L'
comment|'# 2 GB'
newline|'\n'
DECL|variable|INITIATOR
name|'INITIATOR'
op|'='
string|"'iqn.1993-08.org.debian:01:23456789'"
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'NetAppDriverTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'driver'
op|'='
name|'netapp'
op|'.'
name|'NetAppISCSIDriver'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'httplib'
op|','
string|"'HTTPConnection'"
op|','
name|'FakeHTTPConnection'
op|')'
newline|'\n'
name|'driver'
op|'.'
name|'_create_client'
op|'('
name|'wsdl_url'
op|'='
string|"'http://localhost:8088/dfm.wsdl'"
op|','
nl|'\n'
name|'login'
op|'='
string|"'root'"
op|','
name|'password'
op|'='
string|"'password'"
op|','
nl|'\n'
name|'hostname'
op|'='
string|"'localhost'"
op|','
name|'port'
op|'='
number|'8088'
op|','
name|'cache'
op|'='
name|'False'
op|')'
newline|'\n'
name|'driver'
op|'.'
name|'_set_storage_service'
op|'('
name|'self'
op|'.'
name|'STORAGE_SERVICE'
op|')'
newline|'\n'
name|'driver'
op|'.'
name|'_set_storage_service_prefix'
op|'('
name|'self'
op|'.'
name|'STORAGE_SERVICE_PREFIX'
op|')'
newline|'\n'
name|'driver'
op|'.'
name|'_set_vfiler'
op|'('
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'='
name|'driver'
newline|'\n'
nl|'\n'
DECL|member|test_connect
dedent|''
name|'def'
name|'test_connect'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'driver'
op|'.'
name|'check_for_setup_error'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_destroy
dedent|''
name|'def'
name|'test_create_destroy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'driver'
op|'.'
name|'_discover_luns'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'.'
name|'_provision'
op|'('
name|'self'
op|'.'
name|'VOLUME_NAME'
op|','
name|'None'
op|','
name|'self'
op|'.'
name|'PROJECT_ID'
op|','
nl|'\n'
name|'self'
op|'.'
name|'VOLUME_TYPE'
op|','
name|'self'
op|'.'
name|'VOLUME_SIZE'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'.'
name|'_remove_destroy'
op|'('
name|'self'
op|'.'
name|'VOLUME_NAME'
op|','
name|'self'
op|'.'
name|'PROJECT_ID'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_map_unmap
dedent|''
name|'def'
name|'test_map_unmap'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'driver'
op|'.'
name|'_discover_luns'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'.'
name|'_provision'
op|'('
name|'self'
op|'.'
name|'VOLUME_NAME'
op|','
name|'None'
op|','
name|'self'
op|'.'
name|'PROJECT_ID'
op|','
nl|'\n'
name|'self'
op|'.'
name|'VOLUME_TYPE'
op|','
name|'self'
op|'.'
name|'VOLUME_SIZE'
op|')'
newline|'\n'
name|'volume'
op|'='
op|'{'
string|"'name'"
op|':'
name|'self'
op|'.'
name|'VOLUME_NAME'
op|','
string|"'project_id'"
op|':'
name|'self'
op|'.'
name|'PROJECT_ID'
op|','
nl|'\n'
string|"'id'"
op|':'
number|'0'
op|','
string|"'provider_auth'"
op|':'
name|'None'
op|'}'
newline|'\n'
name|'updates'
op|'='
name|'self'
op|'.'
name|'driver'
op|'.'
name|'_get_export'
op|'('
name|'volume'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'updates'
op|'['
string|"'provider_location'"
op|']'
op|')'
newline|'\n'
name|'volume'
op|'['
string|"'provider_location'"
op|']'
op|'='
name|'updates'
op|'['
string|"'provider_location'"
op|']'
newline|'\n'
name|'connector'
op|'='
op|'{'
string|"'initiator'"
op|':'
name|'self'
op|'.'
name|'INITIATOR'
op|'}'
newline|'\n'
name|'connection_info'
op|'='
name|'self'
op|'.'
name|'driver'
op|'.'
name|'initialize_connection'
op|'('
name|'volume'
op|','
name|'connector'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'connection_info'
op|'['
string|"'driver_volume_type'"
op|']'
op|','
string|"'iscsi'"
op|')'
newline|'\n'
name|'properties'
op|'='
name|'connection_info'
op|'['
string|"'data'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'.'
name|'terminate_connection'
op|'('
name|'volume'
op|','
name|'connector'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'.'
name|'_remove_destroy'
op|'('
name|'self'
op|'.'
name|'VOLUME_NAME'
op|','
name|'self'
op|'.'
name|'PROJECT_ID'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
name|'WSDL_HEADER_CMODE'
op|'='
string|'"""<?xml version="1.0" encoding="UTF-8"?>\n<definitions xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"\n xmlns:na="http://cloud.netapp.com/"\nxmlns:xsd="http://www.w3.org/2001/XMLSchema"\nxmlns="http://schemas.xmlsoap.org/wsdl/"\ntargetNamespace="http://cloud.netapp.com/" name="CloudStorageService">\n"""'
newline|'\n'
nl|'\n'
name|'WSDL_TYPES_CMODE'
op|'='
string|'"""<types>\n<xs:schema xmlns:na="http://cloud.netapp.com/"\nxmlns:xs="http://www.w3.org/2001/XMLSchema" version="1.0"\ntargetNamespace="http://cloud.netapp.com/">\n\n      <xs:element name="ProvisionLun">\n        <xs:complexType>\n          <xs:all>\n            <xs:element name="Name" type="xs:string"/>\n            <xs:element name="Size" type="xsd:long"/>\n            <xs:element name="Metadata" type="na:Metadata" minOccurs="0"\n              maxOccurs="unbounded"/>\n          </xs:all>\n        </xs:complexType>\n      </xs:element>\n      <xs:element name="ProvisionLunResult">\n        <xs:complexType>\n          <xs:all>\n            <xs:element name="Lun" type="na:Lun"/>\n          </xs:all>\n        </xs:complexType>\n      </xs:element>\n\n      <xs:element name="DestroyLun">\n        <xs:complexType>\n          <xs:all>\n            <xs:element name="Handle" type="xsd:string"/>\n          </xs:all>\n        </xs:complexType>\n      </xs:element>\n      <xs:element name="DestroyLunResult">\n        <xs:complexType>\n          <xs:all/>\n        </xs:complexType>\n      </xs:element>\n\n      <xs:element name="CloneLun">\n        <xs:complexType>\n          <xs:all>\n            <xs:element name="Handle" type="xsd:string"/>\n            <xs:element name="NewName" type="xsd:string"/>\n            <xs:element name="Metadata" type="na:Metadata" minOccurs="0"\n              maxOccurs="unbounded"/>\n          </xs:all>\n        </xs:complexType>\n      </xs:element>\n      <xs:element name="CloneLunResult">\n        <xs:complexType>\n          <xs:all>\n            <xs:element name="Lun" type="na:Lun"/>\n          </xs:all>\n        </xs:complexType>\n      </xs:element>\n\n      <xs:element name="MapLun">\n        <xs:complexType>\n          <xs:all>\n            <xs:element name="Handle" type="xsd:string"/>\n            <xs:element name="InitiatorType" type="xsd:string"/>\n            <xs:element name="InitiatorName" type="xsd:string"/>\n          </xs:all>\n        </xs:complexType>\n      </xs:element>\n      <xs:element name="MapLunResult">\n        <xs:complexType>\n          <xs:all/>\n        </xs:complexType>\n      </xs:element>\n\n      <xs:element name="UnmapLun">\n        <xs:complexType>\n          <xs:all>\n            <xs:element name="Handle" type="xsd:string"/>\n            <xs:element name="InitiatorType" type="xsd:string"/>\n            <xs:element name="InitiatorName" type="xsd:string"/>\n          </xs:all>\n        </xs:complexType>\n      </xs:element>\n      <xs:element name="UnmapLunResult">\n        <xs:complexType>\n          <xs:all/>\n        </xs:complexType>\n      </xs:element>\n\n      <xs:element name="ListLuns">\n        <xs:complexType>\n          <xs:all>\n            <xs:element name="NameFilter" type="xsd:string" minOccurs="0"/>\n          </xs:all>\n        </xs:complexType>\n      </xs:element>\n      <xs:element name="ListLunsResult">\n        <xs:complexType>\n          <xs:all>\n            <xs:element name="Lun" type="na:Lun" minOccurs="0"\n              maxOccurs="unbounded"/>\n          </xs:all>\n        </xs:complexType>\n      </xs:element>\n\n      <xs:element name="GetLunTargetDetails">\n        <xs:complexType>\n          <xs:all>\n            <xs:element name="Handle" type="xsd:string"/>\n            <xs:element name="InitiatorType" type="xsd:string"/>\n            <xs:element name="InitiatorName" type="xsd:string"/>\n          </xs:all>\n        </xs:complexType>\n      </xs:element>\n      <xs:element name="GetLunTargetDetailsResult">\n        <xs:complexType>\n          <xs:all>\n            <xs:element name="TargetDetails" type="na:TargetDetails"\n              minOccurs="0" maxOccurs="unbounded"/>\n          </xs:all>\n        </xs:complexType>\n      </xs:element>\n\n      <xs:complexType name="Metadata">\n        <xs:sequence>\n          <xs:element name="Key" type="xs:string"/>\n          <xs:element name="Value" type="xs:string"/>\n        </xs:sequence>\n      </xs:complexType>\n\n      <xs:complexType name="Lun">\n        <xs:sequence>\n          <xs:element name="Name" type="xs:string"/>\n          <xs:element name="Size" type="xs:long"/>\n          <xs:element name="Handle" type="xs:string"/>\n          <xs:element name="Metadata" type="na:Metadata" minOccurs="0"\n            maxOccurs="unbounded"/>\n        </xs:sequence>\n      </xs:complexType>\n\n      <xs:complexType name="TargetDetails">\n        <xs:sequence>\n          <xs:element name="Address" type="xs:string"/>\n          <xs:element name="Port" type="xs:int"/>\n          <xs:element name="Portal" type="xs:int"/>\n          <xs:element name="Iqn" type="xs:string"/>\n          <xs:element name="LunNumber" type="xs:int"/>\n        </xs:sequence>\n      </xs:complexType>\n\n    </xs:schema></types>"""'
newline|'\n'
nl|'\n'
name|'WSDL_TRAILER_CMODE'
op|'='
string|'"""<service name="CloudStorageService">\n    <port name="CloudStoragePort" binding="na:CloudStorageBinding">\n      <soap:address location="http://hostname:8080/ws/ntapcloud"/>\n    </port>\n  </service>\n</definitions>"""'
newline|'\n'
nl|'\n'
name|'RESPONSE_PREFIX_CMODE'
op|'='
string|'"""<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">\n<soapenv:Body>"""'
newline|'\n'
nl|'\n'
name|'RESPONSE_SUFFIX_CMODE'
op|'='
string|'"""</soapenv:Body></soapenv:Envelope>"""'
newline|'\n'
nl|'\n'
DECL|variable|CMODE_APIS
name|'CMODE_APIS'
op|'='
op|'['
string|"'ProvisionLun'"
op|','
string|"'DestroyLun'"
op|','
string|"'CloneLun'"
op|','
string|"'MapLun'"
op|','
string|"'UnmapLun'"
op|','
nl|'\n'
string|"'ListLuns'"
op|','
string|"'GetLunTargetDetails'"
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeCMODEServerHandler
name|'class'
name|'FakeCMODEServerHandler'
op|'('
name|'BaseHTTPServer'
op|'.'
name|'BaseHTTPRequestHandler'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""HTTP handler that fakes enough stuff to allow the driver to run"""'
newline|'\n'
nl|'\n'
DECL|member|do_GET
name|'def'
name|'do_GET'
op|'('
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Respond to a GET request."""'
newline|'\n'
name|'if'
string|"'/ntap_cloud.wsdl'"
op|'!='
name|'s'
op|'.'
name|'path'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'.'
name|'send_response'
op|'('
number|'404'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'end_headers'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'s'
op|'.'
name|'send_response'
op|'('
number|'200'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'send_header'
op|'('
string|'"Content-Type"'
op|','
string|'"application/wsdl+xml"'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'end_headers'
op|'('
op|')'
newline|'\n'
name|'out'
op|'='
name|'s'
op|'.'
name|'wfile'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
name|'WSDL_HEADER_CMODE'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
name|'WSDL_TYPES_CMODE'
op|')'
newline|'\n'
name|'for'
name|'api'
name|'in'
name|'CMODE_APIS'
op|':'
newline|'\n'
indent|'            '
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<message name="%sRequest">\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<part element="na:%s" name="req"/>\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|"'</message>'"
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<message name="%sResponse">\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<part element="na:%sResult" name="res"/>\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|"'</message>'"
op|')'
newline|'\n'
dedent|''
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<portType name="CloudStorage">\''
op|')'
newline|'\n'
name|'for'
name|'api'
name|'in'
name|'CMODE_APIS'
op|':'
newline|'\n'
indent|'            '
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<operation name="%s">\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<input message="na:%sRequest"/>\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<output message="na:%sResponse"/>\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|"'</operation>'"
op|')'
newline|'\n'
dedent|''
name|'out'
op|'.'
name|'write'
op|'('
string|"'</portType>'"
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<binding name="CloudStorageBinding" \''
nl|'\n'
string|'\'type="na:CloudStorage">\''
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<soap:binding style="document" \''
op|'+'
nl|'\n'
string|'\'transport="http://schemas.xmlsoap.org/soap/http"/>\''
op|')'
newline|'\n'
name|'for'
name|'api'
name|'in'
name|'CMODE_APIS'
op|':'
newline|'\n'
indent|'            '
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<operation name="%s">\''
op|'%'
name|'api'
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<soap:operation soapAction=""/>\''
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<input><soap:body use="literal"/></input>\''
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|'\'<output><soap:body use="literal"/></output>\''
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
string|"'</operation>'"
op|')'
newline|'\n'
dedent|''
name|'out'
op|'.'
name|'write'
op|'('
string|"'</binding>'"
op|')'
newline|'\n'
name|'out'
op|'.'
name|'write'
op|'('
name|'WSDL_TRAILER_CMODE'
op|')'
newline|'\n'
nl|'\n'
DECL|member|do_POST
dedent|''
name|'def'
name|'do_POST'
op|'('
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Respond to a POST request."""'
newline|'\n'
name|'if'
string|"'/ws/ntapcloud'"
op|'!='
name|'s'
op|'.'
name|'path'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'.'
name|'send_response'
op|'('
number|'404'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'end_headers'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'request_xml'
op|'='
name|'s'
op|'.'
name|'rfile'
op|'.'
name|'read'
op|'('
name|'int'
op|'('
name|'s'
op|'.'
name|'headers'
op|'['
string|"'Content-Length'"
op|']'
op|')'
op|')'
newline|'\n'
name|'ntap_ns'
op|'='
string|"'http://cloud.netapp.com/'"
newline|'\n'
name|'nsmap'
op|'='
op|'{'
string|"'soapenv'"
op|':'
string|"'http://schemas.xmlsoap.org/soap/envelope/'"
op|','
nl|'\n'
string|"'na'"
op|':'
name|'ntap_ns'
op|'}'
newline|'\n'
name|'root'
op|'='
name|'etree'
op|'.'
name|'fromstring'
op|'('
name|'request_xml'
op|')'
newline|'\n'
nl|'\n'
name|'body'
op|'='
name|'root'
op|'.'
name|'xpath'
op|'('
string|"'/soapenv:Envelope/soapenv:Body'"
op|','
nl|'\n'
name|'namespaces'
op|'='
name|'nsmap'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'request'
op|'='
name|'body'
op|'.'
name|'getchildren'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'tag'
op|'='
name|'request'
op|'.'
name|'tag'
newline|'\n'
name|'if'
name|'not'
name|'tag'
op|'.'
name|'startswith'
op|'('
string|"'{'"
op|'+'
name|'ntap_ns'
op|'+'
string|"'}'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'.'
name|'send_response'
op|'('
number|'500'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'end_headers'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'api'
op|'='
name|'tag'
op|'['
op|'('
number|'2'
op|'+'
name|'len'
op|'('
name|'ntap_ns'
op|')'
op|')'
op|':'
op|']'
newline|'\n'
name|'if'
string|"'ProvisionLun'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<ns:ProvisionLunResult xmlns:ns=\n            "http://cloud.netapp.com/">\n            <Lun><Name>lun1</Name><Size>20</Size>\n             <Handle>1d9c006c-a406-42f6-a23f-5ed7a6dc33e3</Handle>\n            <Metadata><Key>OsType</Key>\n            <Value>linux</Value></Metadata></Lun>\n            </ns:ProvisionLunResult>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'DestroyLun'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<ns:DestroyLunResult xmlns:ns="http://cloud.netapp.com/"\n             />"""'
newline|'\n'
dedent|''
name|'elif'
string|"'CloneLun'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<ns:CloneLunResult xmlns:ns="http://cloud.netapp.com/">\n                     <Lun><Name>lun2</Name><Size>2</Size>\n                     <Handle>98ea1791d228453899d422b4611642c3</Handle>\n                     <Metadata><Key>OsType</Key>\n                     <Value>linux</Value></Metadata>\n                     </Lun></ns:CloneLunResult>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'MapLun'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<ns1:MapLunResult xmlns:ns="http://cloud.netapp.com/"\n             />"""'
newline|'\n'
dedent|''
name|'elif'
string|"'Unmap'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<ns1:UnmapLunResult xmlns:ns="http://cloud.netapp.com/"\n             />"""'
newline|'\n'
dedent|''
name|'elif'
string|"'ListLuns'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<ns:ListLunsResult xmlns:ns="http://cloud.netapp.com/">\n                 <Lun>\n                 <Name>lun1</Name>\n                 <Size>20</Size>\n                 <Handle>asdjdnsd</Handle>\n                 </Lun>\n                 </ns:ListLunsResult>"""'
newline|'\n'
dedent|''
name|'elif'
string|"'GetLunTargetDetails'"
op|'=='
name|'api'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
string|'"""<ns:GetLunTargetDetailsResult\n            xmlns:ns="http://cloud.netapp.com/">\n                    <TargetDetail>\n                     <Address>1.2.3.4</Address>\n                     <Port>3260</Port>\n                     <Portal>1000</Portal>\n                     <Iqn>iqn.199208.com.netapp:sn.123456789</Iqn>\n                     <LunNumber>0</LunNumber>\n                    </TargetDetail>\n                    </ns:GetLunTargetDetailsResult>"""'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# Unknown API'
nl|'\n'
indent|'            '
name|'s'
op|'.'
name|'send_response'
op|'('
number|'500'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'end_headers'
newline|'\n'
name|'return'
newline|'\n'
dedent|''
name|'s'
op|'.'
name|'send_response'
op|'('
number|'200'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'send_header'
op|'('
string|'"Content-Type"'
op|','
string|'"text/xml; charset=utf-8"'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'end_headers'
op|'('
op|')'
newline|'\n'
name|'s'
op|'.'
name|'wfile'
op|'.'
name|'write'
op|'('
name|'RESPONSE_PREFIX_CMODE'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'wfile'
op|'.'
name|'write'
op|'('
name|'body'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'wfile'
op|'.'
name|'write'
op|'('
name|'RESPONSE_SUFFIX_CMODE'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeCmodeHTTPConnection
dedent|''
dedent|''
name|'class'
name|'FakeCmodeHTTPConnection'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""A fake httplib.HTTPConnection for netapp tests\n\n    Requests made via this connection actually get translated and routed into\n    the fake Dfm handler above, we then turn the response into\n    the httplib.HTTPResponse that the caller expects.\n    """'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'host'
op|','
name|'timeout'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'host'
op|'='
name|'host'
newline|'\n'
nl|'\n'
DECL|member|request
dedent|''
name|'def'
name|'request'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'data'
op|'='
name|'None'
op|','
name|'headers'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'headers'
op|':'
newline|'\n'
indent|'            '
name|'headers'
op|'='
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'req_str'
op|'='
string|"'%s %s HTTP/1.1\\r\\n'"
op|'%'
op|'('
name|'method'
op|','
name|'path'
op|')'
newline|'\n'
name|'for'
name|'key'
op|','
name|'value'
name|'in'
name|'headers'
op|'.'
name|'iteritems'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'req_str'
op|'+='
string|'"%s: %s\\r\\n"'
op|'%'
op|'('
name|'key'
op|','
name|'value'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'data'
op|':'
newline|'\n'
indent|'            '
name|'req_str'
op|'+='
string|"'\\r\\n%s'"
op|'%'
name|'data'
newline|'\n'
nl|'\n'
comment|'# NOTE(vish): normally the http transport normailizes from unicode'
nl|'\n'
dedent|''
name|'sock'
op|'='
name|'FakeHttplibSocket'
op|'('
name|'req_str'
op|'.'
name|'decode'
op|'('
string|'"latin-1"'
op|')'
op|'.'
name|'encode'
op|'('
string|'"utf-8"'
op|')'
op|')'
newline|'\n'
comment|'# NOTE(vish): stop the server from trying to look up address from'
nl|'\n'
comment|'#             the fake socket'
nl|'\n'
name|'FakeCMODEServerHandler'
op|'.'
name|'address_string'
op|'='
name|'lambda'
name|'x'
op|':'
string|"'127.0.0.1'"
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'='
name|'FakeCMODEServerHandler'
op|'('
name|'sock'
op|','
string|"'127.0.0.1:8080'"
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'sock'
op|'='
name|'FakeHttplibSocket'
op|'('
name|'sock'
op|'.'
name|'result'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'http_response'
op|'='
name|'httplib'
op|'.'
name|'HTTPResponse'
op|'('
name|'self'
op|'.'
name|'sock'
op|')'
newline|'\n'
nl|'\n'
DECL|member|set_debuglevel
dedent|''
name|'def'
name|'set_debuglevel'
op|'('
name|'self'
op|','
name|'level'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|getresponse
dedent|''
name|'def'
name|'getresponse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'http_response'
op|'.'
name|'begin'
op|'('
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'http_response'
newline|'\n'
nl|'\n'
DECL|member|getresponsebody
dedent|''
name|'def'
name|'getresponsebody'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'sock'
op|'.'
name|'result'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|NetAppCmodeISCSIDriverTestCase
dedent|''
dedent|''
name|'class'
name|'NetAppCmodeISCSIDriverTestCase'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Test case for NetAppISCSIDriver"""'
newline|'\n'
DECL|variable|volume
name|'volume'
op|'='
op|'{'
nl|'\n'
string|"'name'"
op|':'
string|"'lun1'"
op|','
string|"'size'"
op|':'
number|'1'
op|','
string|"'volume_name'"
op|':'
string|"'lun1'"
op|','
nl|'\n'
string|"'os_type'"
op|':'
string|"'linux'"
op|','
string|"'provider_location'"
op|':'
string|"'lun1'"
op|','
nl|'\n'
string|"'id'"
op|':'
string|"'lun1'"
op|','
string|"'provider_auth'"
op|':'
name|'None'
op|','
string|"'project_id'"
op|':'
string|"'project'"
op|','
nl|'\n'
string|"'display_name'"
op|':'
name|'None'
op|','
string|"'display_description'"
op|':'
string|"'lun1'"
op|','
nl|'\n'
string|"'volume_type_id'"
op|':'
name|'None'
nl|'\n'
op|'}'
newline|'\n'
DECL|variable|snapshot
name|'snapshot'
op|'='
op|'{'
nl|'\n'
string|"'name'"
op|':'
string|"'lun2'"
op|','
string|"'size'"
op|':'
number|'1'
op|','
string|"'volume_name'"
op|':'
string|"'lun1'"
op|','
nl|'\n'
string|"'volume_size'"
op|':'
number|'1'
op|','
string|"'project_id'"
op|':'
string|"'project'"
nl|'\n'
op|'}'
newline|'\n'
DECL|variable|volume_sec
name|'volume_sec'
op|'='
op|'{'
nl|'\n'
string|"'name'"
op|':'
string|"'vol_snapshot'"
op|','
string|"'size'"
op|':'
number|'1'
op|','
string|"'volume_name'"
op|':'
string|"'lun1'"
op|','
nl|'\n'
string|"'os_type'"
op|':'
string|"'linux'"
op|','
string|"'provider_location'"
op|':'
string|"'lun1'"
op|','
nl|'\n'
string|"'id'"
op|':'
string|"'lun1'"
op|','
string|"'provider_auth'"
op|':'
name|'None'
op|','
string|"'project_id'"
op|':'
string|"'project'"
op|','
nl|'\n'
string|"'display_name'"
op|':'
name|'None'
op|','
string|"'display_description'"
op|':'
string|"'lun1'"
op|','
nl|'\n'
string|"'volume_type_id'"
op|':'
name|'None'
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'NetAppCmodeISCSIDriverTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'driver'
op|'='
name|'netapp'
op|'.'
name|'NetAppCmodeISCSIDriver'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'httplib'
op|','
string|"'HTTPConnection'"
op|','
name|'FakeCmodeHTTPConnection'
op|')'
newline|'\n'
name|'driver'
op|'.'
name|'_create_client'
op|'('
name|'wsdl_url'
op|'='
string|"'http://localhost:8080/ntap_cloud.wsdl'"
op|','
nl|'\n'
name|'login'
op|'='
string|"'root'"
op|','
name|'password'
op|'='
string|"'password'"
op|','
nl|'\n'
name|'hostname'
op|'='
string|"'localhost'"
op|','
name|'port'
op|'='
number|'8080'
op|','
name|'cache'
op|'='
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'='
name|'driver'
newline|'\n'
nl|'\n'
DECL|member|test_connect
dedent|''
name|'def'
name|'test_connect'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'driver'
op|'.'
name|'check_for_setup_error'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_destroy
dedent|''
name|'def'
name|'test_create_destroy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'driver'
op|'.'
name|'create_volume'
op|'('
name|'self'
op|'.'
name|'volume'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'.'
name|'delete_volume'
op|'('
name|'self'
op|'.'
name|'volume'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_vol_snapshot_destroy
dedent|''
name|'def'
name|'test_create_vol_snapshot_destroy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'driver'
op|'.'
name|'create_volume'
op|'('
name|'self'
op|'.'
name|'volume'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'.'
name|'create_snapshot'
op|'('
name|'self'
op|'.'
name|'snapshot'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'.'
name|'create_volume_from_snapshot'
op|'('
name|'self'
op|'.'
name|'volume_sec'
op|','
name|'self'
op|'.'
name|'snapshot'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'.'
name|'delete_snapshot'
op|'('
name|'self'
op|'.'
name|'snapshot'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'.'
name|'delete_volume'
op|'('
name|'self'
op|'.'
name|'volume'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_map_unmap
dedent|''
name|'def'
name|'test_map_unmap'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'driver'
op|'.'
name|'create_volume'
op|'('
name|'self'
op|'.'
name|'volume'
op|')'
newline|'\n'
name|'updates'
op|'='
name|'self'
op|'.'
name|'driver'
op|'.'
name|'create_export'
op|'('
name|'None'
op|','
name|'self'
op|'.'
name|'volume'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'updates'
op|'['
string|"'provider_location'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'volume'
op|'['
string|"'provider_location'"
op|']'
op|'='
name|'updates'
op|'['
string|"'provider_location'"
op|']'
newline|'\n'
name|'connector'
op|'='
op|'{'
string|"'initiator'"
op|':'
string|"'init1'"
op|'}'
newline|'\n'
name|'connection_info'
op|'='
name|'self'
op|'.'
name|'driver'
op|'.'
name|'initialize_connection'
op|'('
name|'self'
op|'.'
name|'volume'
op|','
nl|'\n'
name|'connector'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'connection_info'
op|'['
string|"'driver_volume_type'"
op|']'
op|','
string|"'iscsi'"
op|')'
newline|'\n'
name|'properties'
op|'='
name|'connection_info'
op|'['
string|"'data'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'.'
name|'terminate_connection'
op|'('
name|'self'
op|'.'
name|'volume'
op|','
name|'connector'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'.'
name|'delete_volume'
op|'('
name|'self'
op|'.'
name|'volume'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
