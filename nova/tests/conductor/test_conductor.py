begin_unit
comment|'#    Copyright 2012 IBM Corp.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
string|'"""Tests for the conductor service."""'
newline|'\n'
nl|'\n'
name|'import'
name|'mox'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
op|'.'
name|'api'
op|'.'
name|'ec2'
name|'import'
name|'ec2utils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'compute'
name|'import'
name|'flavors'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'compute'
name|'import'
name|'utils'
name|'as'
name|'compute_utils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'compute'
name|'import'
name|'vm_states'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'conductor'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'conductor'
name|'import'
name|'api'
name|'as'
name|'conductor_api'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'conductor'
name|'import'
name|'manager'
name|'as'
name|'conductor_manager'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'conductor'
name|'import'
name|'rpcapi'
name|'as'
name|'conductor_rpcapi'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'context'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'db'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'db'
op|'.'
name|'sqlalchemy'
name|'import'
name|'models'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
name|'as'
name|'exc'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'notifications'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'jsonutils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
op|'.'
name|'notifier'
name|'import'
name|'api'
name|'as'
name|'notifier_api'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
op|'.'
name|'notifier'
name|'import'
name|'test_notifier'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
op|'.'
name|'rpc'
name|'import'
name|'common'
name|'as'
name|'rpc_common'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'timeutils'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'quota'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|FAKE_IMAGE_REF
name|'FAKE_IMAGE_REF'
op|'='
string|"'fake-image-ref'"
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeContext
name|'class'
name|'FakeContext'
op|'('
name|'context'
op|'.'
name|'RequestContext'
op|')'
op|':'
newline|'\n'
DECL|member|elevated
indent|'    '
name|'def'
name|'elevated'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Return a consistent elevated context so we can detect it."""'
newline|'\n'
name|'if'
name|'not'
name|'hasattr'
op|'('
name|'self'
op|','
string|"'_elevated'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_elevated'
op|'='
name|'super'
op|'('
name|'FakeContext'
op|','
name|'self'
op|')'
op|'.'
name|'elevated'
op|'('
op|')'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'_elevated'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|_BaseTestCase
dedent|''
dedent|''
name|'class'
name|'_BaseTestCase'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'_BaseTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'db'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'user_id'
op|'='
string|"'fake'"
newline|'\n'
name|'self'
op|'.'
name|'project_id'
op|'='
string|"'fake'"
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'FakeContext'
op|'('
name|'self'
op|'.'
name|'user_id'
op|','
name|'self'
op|'.'
name|'project_id'
op|')'
newline|'\n'
nl|'\n'
name|'notifier_api'
op|'.'
name|'_reset_drivers'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'addCleanup'
op|'('
name|'notifier_api'
op|'.'
name|'_reset_drivers'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'notification_driver'
op|'='
op|'['
name|'test_notifier'
op|'.'
name|'__name__'
op|']'
op|')'
newline|'\n'
name|'test_notifier'
op|'.'
name|'NOTIFICATIONS'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|member|stub_out_client_exceptions
dedent|''
name|'def'
name|'stub_out_client_exceptions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|passthru
indent|'        '
name|'def'
name|'passthru'
op|'('
name|'exceptions'
op|','
name|'func'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'func'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'rpc_common'
op|','
string|"'catch_client_exception'"
op|','
name|'passthru'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_create_fake_instance
dedent|''
name|'def'
name|'_create_fake_instance'
op|'('
name|'self'
op|','
name|'params'
op|'='
name|'None'
op|','
name|'type_name'
op|'='
string|"'m1.tiny'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'params'
op|':'
newline|'\n'
indent|'            '
name|'params'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
dedent|''
name|'inst'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'inst'
op|'['
string|"'vm_state'"
op|']'
op|'='
name|'vm_states'
op|'.'
name|'ACTIVE'
newline|'\n'
name|'inst'
op|'['
string|"'image_ref'"
op|']'
op|'='
name|'FAKE_IMAGE_REF'
newline|'\n'
name|'inst'
op|'['
string|"'reservation_id'"
op|']'
op|'='
string|"'r-fakeres'"
newline|'\n'
name|'inst'
op|'['
string|"'launch_time'"
op|']'
op|'='
string|"'10'"
newline|'\n'
name|'inst'
op|'['
string|"'user_id'"
op|']'
op|'='
name|'self'
op|'.'
name|'user_id'
newline|'\n'
name|'inst'
op|'['
string|"'project_id'"
op|']'
op|'='
name|'self'
op|'.'
name|'project_id'
newline|'\n'
name|'inst'
op|'['
string|"'host'"
op|']'
op|'='
string|"'fake_host'"
newline|'\n'
name|'type_id'
op|'='
name|'flavors'
op|'.'
name|'get_instance_type_by_name'
op|'('
name|'type_name'
op|')'
op|'['
string|"'id'"
op|']'
newline|'\n'
name|'inst'
op|'['
string|"'instance_type_id'"
op|']'
op|'='
name|'type_id'
newline|'\n'
name|'inst'
op|'['
string|"'ami_launch_index'"
op|']'
op|'='
number|'0'
newline|'\n'
name|'inst'
op|'['
string|"'memory_mb'"
op|']'
op|'='
number|'0'
newline|'\n'
name|'inst'
op|'['
string|"'vcpus'"
op|']'
op|'='
number|'0'
newline|'\n'
name|'inst'
op|'['
string|"'root_gb'"
op|']'
op|'='
number|'0'
newline|'\n'
name|'inst'
op|'['
string|"'ephemeral_gb'"
op|']'
op|'='
number|'0'
newline|'\n'
name|'inst'
op|'['
string|"'architecture'"
op|']'
op|'='
string|"'x86_64'"
newline|'\n'
name|'inst'
op|'['
string|"'os_type'"
op|']'
op|'='
string|"'Linux'"
newline|'\n'
name|'inst'
op|'['
string|"'availability_zone'"
op|']'
op|'='
string|"'fake-az'"
newline|'\n'
name|'inst'
op|'.'
name|'update'
op|'('
name|'params'
op|')'
newline|'\n'
name|'return'
name|'db'
op|'.'
name|'instance_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'inst'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_do_update
dedent|''
name|'def'
name|'_do_update'
op|'('
name|'self'
op|','
name|'instance_uuid'
op|','
op|'**'
name|'updates'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'instance_update'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'instance_uuid'
op|','
nl|'\n'
name|'updates'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_update
dedent|''
name|'def'
name|'test_instance_update'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
name|'self'
op|'.'
name|'_create_fake_instance'
op|'('
op|')'
newline|'\n'
name|'new_inst'
op|'='
name|'self'
op|'.'
name|'_do_update'
op|'('
name|'instance'
op|'['
string|"'uuid'"
op|']'
op|','
nl|'\n'
name|'vm_state'
op|'='
name|'vm_states'
op|'.'
name|'STOPPED'
op|')'
newline|'\n'
name|'instance'
op|'='
name|'db'
op|'.'
name|'instance_get_by_uuid'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'instance'
op|'['
string|"'uuid'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'instance'
op|'['
string|"'vm_state'"
op|']'
op|','
name|'vm_states'
op|'.'
name|'STOPPED'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'new_inst'
op|'['
string|"'vm_state'"
op|']'
op|','
name|'instance'
op|'['
string|"'vm_state'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_action_event_start
dedent|''
name|'def'
name|'test_action_event_start'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'action_event_start'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'action_event_start'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'action_event_start'
op|'('
name|'self'
op|'.'
name|'context'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_action_event_finish
dedent|''
name|'def'
name|'test_action_event_finish'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'action_event_finish'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'action_event_finish'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'action_event_finish'
op|'('
name|'self'
op|'.'
name|'context'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_update_invalid_key
dedent|''
name|'def'
name|'test_instance_update_invalid_key'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(danms): the real DB API call ignores invalid keys'
nl|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'db'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'stub_out_client_exceptions'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'KeyError'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_do_update'
op|','
string|"'any-uuid'"
op|','
name|'foobar'
op|'='
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_migration_get
dedent|''
dedent|''
name|'def'
name|'test_migration_get'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'migration'
op|'='
name|'db'
op|'.'
name|'migration_create'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
op|'{'
string|"'instance_uuid'"
op|':'
string|"'fake-uuid'"
op|','
nl|'\n'
string|"'status'"
op|':'
string|"'migrating'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'migration'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'migration_get'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'migration'
op|'['
string|"'id'"
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_migration_get_unconfirmed_by_dest_compute
dedent|''
name|'def'
name|'test_migration_get_unconfirmed_by_dest_compute'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
nl|'\n'
string|"'migration_get_unconfirmed_by_dest_compute'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'migration_get_unconfirmed_by_dest_compute'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'fake-window'"
op|','
nl|'\n'
string|"'fake-host'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'migration_get_unconfirmed_by_dest_compute'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'fake-window'"
op|','
nl|'\n'
string|"'fake-host'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_migration_get_in_progress_by_host_and_node
dedent|''
name|'def'
name|'test_migration_get_in_progress_by_host_and_node'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
nl|'\n'
string|"'migration_get_in_progress_by_host_and_node'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'migration_get_in_progress_by_host_and_node'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-host'"
op|','
string|"'fake-node'"
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'fake-result'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'migration_get_in_progress_by_host_and_node'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-host'"
op|','
string|"'fake-node'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'fake-result'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_migration_create
dedent|''
name|'def'
name|'test_migration_create'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'inst'
op|'='
op|'{'
string|"'uuid'"
op|':'
string|"'fake-uuid'"
op|','
nl|'\n'
string|"'host'"
op|':'
string|"'fake-host'"
op|','
nl|'\n'
string|"'node'"
op|':'
string|"'fake-node'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'migration_create'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'migration_create'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
op|'{'
string|"'instance_uuid'"
op|':'
name|'inst'
op|'['
string|"'uuid'"
op|']'
op|','
nl|'\n'
string|"'source_compute'"
op|':'
name|'inst'
op|'['
string|"'host'"
op|']'
op|','
nl|'\n'
string|"'source_node'"
op|':'
name|'inst'
op|'['
string|"'node'"
op|']'
op|','
nl|'\n'
string|"'fake-key'"
op|':'
string|"'fake-value'"
op|'}'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'result'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'migration_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'inst'
op|','
nl|'\n'
op|'{'
string|"'fake-key'"
op|':'
string|"'fake-value'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'result'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_migration_update
dedent|''
name|'def'
name|'test_migration_update'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'migration'
op|'='
name|'db'
op|'.'
name|'migration_create'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
op|'{'
string|"'instance_uuid'"
op|':'
string|"'fake-uuid'"
op|','
nl|'\n'
string|"'status'"
op|':'
string|"'migrating'"
op|'}'
op|')'
newline|'\n'
name|'migration_p'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'migration'
op|')'
newline|'\n'
name|'migration'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'migration_update'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'migration_p'
op|','
nl|'\n'
string|"'finished'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'migration'
op|'['
string|"'status'"
op|']'
op|','
string|"'finished'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_get_by_uuid
dedent|''
name|'def'
name|'test_instance_get_by_uuid'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'orig_instance'
op|'='
name|'self'
op|'.'
name|'_create_fake_instance'
op|'('
op|')'
newline|'\n'
name|'copy_instance'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'instance_get_by_uuid'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'orig_instance'
op|'['
string|"'uuid'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'orig_instance'
op|'['
string|"'name'"
op|']'
op|','
nl|'\n'
name|'copy_instance'
op|'['
string|"'name'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_setup_aggregate_with_host
dedent|''
name|'def'
name|'_setup_aggregate_with_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'aggregate_ref'
op|'='
name|'db'
op|'.'
name|'aggregate_create'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'foo'"
op|'}'
op|','
name|'metadata'
op|'='
op|'{'
string|"'availability_zone'"
op|':'
string|"'foo'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'aggregate_host_add'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'aggregate_ref'
op|','
string|"'bar'"
op|')'
newline|'\n'
nl|'\n'
name|'aggregate_ref'
op|'='
name|'db'
op|'.'
name|'aggregate_get'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
name|'aggregate_ref'
op|'['
string|"'id'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'return'
name|'aggregate_ref'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_host_add
dedent|''
name|'def'
name|'test_aggregate_host_add'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'aggregate_ref'
op|'='
name|'self'
op|'.'
name|'_setup_aggregate_with_host'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'any'
op|'('
op|'['
name|'host'
op|'=='
string|"'bar'"
nl|'\n'
name|'for'
name|'host'
name|'in'
name|'aggregate_ref'
op|'['
string|"'hosts'"
op|']'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'db'
op|'.'
name|'aggregate_delete'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
name|'aggregate_ref'
op|'['
string|"'id'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_host_delete
dedent|''
name|'def'
name|'test_aggregate_host_delete'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'aggregate_ref'
op|'='
name|'self'
op|'.'
name|'_setup_aggregate_with_host'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'aggregate_host_delete'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'aggregate_ref'
op|','
nl|'\n'
string|"'bar'"
op|')'
newline|'\n'
nl|'\n'
name|'aggregate_ref'
op|'='
name|'db'
op|'.'
name|'aggregate_get'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
name|'aggregate_ref'
op|'['
string|"'id'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'any'
op|'('
op|'['
name|'host'
op|'=='
string|"'bar'"
nl|'\n'
name|'for'
name|'host'
name|'in'
name|'aggregate_ref'
op|'['
string|"'hosts'"
op|']'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'db'
op|'.'
name|'aggregate_delete'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
name|'aggregate_ref'
op|'['
string|"'id'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_get
dedent|''
name|'def'
name|'test_aggregate_get'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'aggregate_ref'
op|'='
name|'self'
op|'.'
name|'_setup_aggregate_with_host'
op|'('
op|')'
newline|'\n'
name|'aggregate'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'aggregate_get'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'aggregate_ref'
op|'['
string|"'id'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'aggregate_ref'
op|')'
op|','
name|'aggregate'
op|')'
newline|'\n'
name|'db'
op|'.'
name|'aggregate_delete'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
name|'aggregate_ref'
op|'['
string|"'id'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_get_by_host
dedent|''
name|'def'
name|'test_aggregate_get_by_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_setup_aggregate_with_host'
op|'('
op|')'
newline|'\n'
name|'aggregates'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'aggregate_get_by_host'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'bar'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'aggregates'
op|'['
number|'0'
op|']'
op|'['
string|"'availability_zone'"
op|']'
op|','
string|"'foo'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_metadata_add
dedent|''
name|'def'
name|'test_aggregate_metadata_add'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'aggregate'
op|'='
op|'{'
string|"'name'"
op|':'
string|"'fake aggregate'"
op|','
string|"'id'"
op|':'
string|"'fake-id'"
op|'}'
newline|'\n'
name|'metadata'
op|'='
op|'{'
string|"'foo'"
op|':'
string|"'bar'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'aggregate_metadata_add'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'aggregate_metadata_add'
op|'('
nl|'\n'
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|','
name|'aggregate'
op|'['
string|"'id'"
op|']'
op|','
name|'metadata'
op|','
name|'False'
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
name|'metadata'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'aggregate_metadata_add'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'aggregate'
op|','
nl|'\n'
name|'metadata'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_metadata_delete
dedent|''
name|'def'
name|'test_aggregate_metadata_delete'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'aggregate'
op|'='
op|'{'
string|"'name'"
op|':'
string|"'fake aggregate'"
op|','
string|"'id'"
op|':'
string|"'fake-id'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'aggregate_metadata_delete'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'aggregate_metadata_delete'
op|'('
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|','
name|'aggregate'
op|'['
string|"'id'"
op|']'
op|','
string|"'fake'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'aggregate_metadata_delete'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'aggregate'
op|','
nl|'\n'
string|"'fake'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_metadata_get_by_host
dedent|''
name|'def'
name|'test_aggregate_metadata_get_by_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'aggregate_metadata_get_by_host'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'aggregate_metadata_get_by_host'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'host'"
op|','
nl|'\n'
string|"'key'"
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'result'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'aggregate_metadata_get_by_host'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'host'"
op|','
string|"'key'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'result'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bw_usage_update
dedent|''
name|'def'
name|'test_bw_usage_update'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'bw_usage_update'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'bw_usage_get'"
op|')'
newline|'\n'
nl|'\n'
name|'update_args'
op|'='
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'uuid'"
op|','
string|"'mac'"
op|','
number|'0'
op|','
number|'10'
op|','
number|'20'
op|','
number|'5'
op|','
number|'10'
op|','
number|'20'
op|')'
newline|'\n'
name|'get_args'
op|'='
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'uuid'"
op|','
number|'0'
op|','
string|"'mac'"
op|')'
newline|'\n'
nl|'\n'
name|'db'
op|'.'
name|'bw_usage_update'
op|'('
op|'*'
name|'update_args'
op|')'
newline|'\n'
name|'db'
op|'.'
name|'bw_usage_get'
op|'('
op|'*'
name|'get_args'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'foo'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'bw_usage_update'
op|'('
op|'*'
name|'update_args'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'foo'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_security_group_get_by_instance
dedent|''
name|'def'
name|'test_security_group_get_by_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_instance'
op|'='
op|'{'
string|"'id'"
op|':'
string|"'fake-instance'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'security_group_get_by_instance'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'security_group_get_by_instance'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'fake_instance'
op|'['
string|"'id'"
op|']'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'it worked'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'security_group_get_by_instance'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'fake_instance'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'it worked'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_security_group_rule_get_by_security_group
dedent|''
name|'def'
name|'test_security_group_rule_get_by_security_group'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_secgroup'
op|'='
op|'{'
string|"'id'"
op|':'
string|"'fake-secgroup'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
nl|'\n'
string|"'security_group_rule_get_by_security_group'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'security_group_rule_get_by_security_group'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'fake_secgroup'
op|'['
string|"'id'"
op|']'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'it worked'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'security_group_rule_get_by_security_group'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'fake_secgroup'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'it worked'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_provider_fw_rule_get_all
dedent|''
name|'def'
name|'test_provider_fw_rule_get_all'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_rules'
op|'='
op|'['
string|"'a'"
op|','
string|"'b'"
op|','
string|"'c'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'provider_fw_rule_get_all'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'provider_fw_rule_get_all'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'fake_rules'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'provider_fw_rule_get_all'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'fake_rules'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_agent_build_get_by_triple
dedent|''
name|'def'
name|'test_agent_build_get_by_triple'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'agent_build_get_by_triple'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'agent_build_get_by_triple'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-hv'"
op|','
string|"'fake-os'"
op|','
nl|'\n'
string|"'fake-arch'"
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'it worked'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'agent_build_get_by_triple'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'fake-hv'"
op|','
nl|'\n'
string|"'fake-os'"
op|','
nl|'\n'
string|"'fake-arch'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'it worked'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_block_device_mapping_get_all_by_instance
dedent|''
name|'def'
name|'test_block_device_mapping_get_all_by_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_inst'
op|'='
op|'{'
string|"'uuid'"
op|':'
string|"'fake-uuid'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
nl|'\n'
string|"'block_device_mapping_get_all_by_instance'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_get_all_by_instance'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'fake_inst'
op|'['
string|"'uuid'"
op|']'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'fake-result'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_get_all_by_instance'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'fake_inst'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'fake-result'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_get_active_by_window_joined
dedent|''
name|'def'
name|'test_instance_get_active_by_window_joined'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'instance_get_active_by_window_joined'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'instance_get_active_by_window_joined'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-begin'"
op|','
nl|'\n'
string|"'fake-end'"
op|','
string|"'fake-proj'"
op|','
nl|'\n'
string|"'fake-host'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'instance_get_active_by_window_joined'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-begin'"
op|','
string|"'fake-end'"
op|','
string|"'fake-proj'"
op|','
string|"'fake-host'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_destroy
dedent|''
name|'def'
name|'test_instance_destroy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'instance_destroy'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'instance_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-uuid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'instance_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
op|'{'
string|"'uuid'"
op|':'
string|"'fake-uuid'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_info_cache_delete
dedent|''
name|'def'
name|'test_instance_info_cache_delete'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'instance_info_cache_delete'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'instance_info_cache_delete'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-uuid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'instance_info_cache_delete'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
op|'{'
string|"'uuid'"
op|':'
string|"'fake-uuid'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_info_cache_update
dedent|''
name|'def'
name|'test_instance_info_cache_update'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_values'
op|'='
op|'{'
string|"'key1'"
op|':'
string|"'val1'"
op|','
string|"'key2'"
op|':'
string|"'val2'"
op|'}'
newline|'\n'
name|'fake_instance'
op|'='
op|'{'
string|"'uuid'"
op|':'
string|"'fake-uuid'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'instance_info_cache_update'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'instance_info_cache_update'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-uuid'"
op|','
nl|'\n'
name|'fake_values'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'instance_info_cache_update'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'fake_instance'
op|','
nl|'\n'
name|'fake_values'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_type_get
dedent|''
name|'def'
name|'test_instance_type_get'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'instance_type_get'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'instance_type_get'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-id'"
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'fake-type'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'instance_type_get'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-id'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'fake-type'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vol_get_usage_by_time
dedent|''
name|'def'
name|'test_vol_get_usage_by_time'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'vol_get_usage_by_time'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'vol_get_usage_by_time'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-time'"
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
string|"'fake-usage'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'vol_get_usage_by_time'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'fake-time'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'fake-usage'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vol_usage_update
dedent|''
name|'def'
name|'test_vol_usage_update'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# the vol_usage_update method sends the volume usage notifications'
nl|'\n'
comment|'# as well as updating the database'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'vol_usage_update'"
op|')'
newline|'\n'
name|'inst'
op|'='
name|'self'
op|'.'
name|'_create_fake_instance'
op|'('
op|'{'
nl|'\n'
string|"'project_id'"
op|':'
string|"'fake-project_id'"
op|','
nl|'\n'
string|"'user_id'"
op|':'
string|"'fake-user_id'"
op|','
nl|'\n'
op|'}'
op|')'
newline|'\n'
name|'fake_usage'
op|'='
op|'{'
string|"'tot_last_refreshed'"
op|':'
number|'20'
op|','
nl|'\n'
string|"'curr_last_refreshed'"
op|':'
number|'10'
op|','
nl|'\n'
string|"'volume_id'"
op|':'
string|"'fake-vol'"
op|','
nl|'\n'
string|"'instance_uuid'"
op|':'
name|'inst'
op|'['
string|"'uuid'"
op|']'
op|','
nl|'\n'
string|"'project_id'"
op|':'
string|"'fake-project_id'"
op|','
nl|'\n'
string|"'user_id'"
op|':'
string|"'fake-user_id'"
op|','
nl|'\n'
string|"'availability_zone'"
op|':'
string|"'fake-az'"
op|','
nl|'\n'
string|"'tot_reads'"
op|':'
number|'11'
op|','
nl|'\n'
string|"'curr_reads'"
op|':'
number|'22'
op|','
nl|'\n'
string|"'tot_read_bytes'"
op|':'
number|'33'
op|','
nl|'\n'
string|"'curr_read_bytes'"
op|':'
number|'44'
op|','
nl|'\n'
string|"'tot_writes'"
op|':'
number|'55'
op|','
nl|'\n'
string|"'curr_writes'"
op|':'
number|'66'
op|','
nl|'\n'
string|"'tot_write_bytes'"
op|':'
number|'77'
op|','
nl|'\n'
string|"'curr_write_bytes'"
op|':'
number|'88'
op|'}'
newline|'\n'
name|'db'
op|'.'
name|'vol_usage_update'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-vol'"
op|','
string|"'rd-req'"
op|','
string|"'rd-bytes'"
op|','
nl|'\n'
string|"'wr-req'"
op|','
string|"'wr-bytes'"
op|','
name|'inst'
op|'['
string|"'uuid'"
op|']'
op|','
nl|'\n'
string|"'fake-project_id'"
op|','
string|"'fake-user_id'"
op|','
string|"'fake-az'"
op|','
nl|'\n'
string|"'fake-refr'"
op|','
string|"'fake-bool'"
op|','
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'fake_usage'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'vol_usage_update'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-vol'"
op|','
string|"'rd-req'"
op|','
nl|'\n'
string|"'rd-bytes'"
op|','
string|"'wr-req'"
op|','
string|"'wr-bytes'"
op|','
nl|'\n'
name|'inst'
op|','
string|"'fake-refr'"
op|','
string|"'fake-bool'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'len'
op|'('
name|'test_notifier'
op|'.'
name|'NOTIFICATIONS'
op|')'
op|','
number|'1'
op|')'
newline|'\n'
name|'msg'
op|'='
name|'test_notifier'
op|'.'
name|'NOTIFICATIONS'
op|'['
number|'0'
op|']'
newline|'\n'
name|'payload'
op|'='
name|'msg'
op|'['
string|"'payload'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'payload'
op|'['
string|"'instance_id'"
op|']'
op|','
name|'inst'
op|'['
string|"'uuid'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'payload'
op|'['
string|"'user_id'"
op|']'
op|','
string|"'fake-user_id'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'payload'
op|'['
string|"'tenant_id'"
op|']'
op|','
string|"'fake-project_id'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'payload'
op|'['
string|"'reads'"
op|']'
op|','
number|'33'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'payload'
op|'['
string|"'read_bytes'"
op|']'
op|','
number|'77'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'payload'
op|'['
string|"'writes'"
op|']'
op|','
number|'121'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'payload'
op|'['
string|"'write_bytes'"
op|']'
op|','
number|'165'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'payload'
op|'['
string|"'availability_zone'"
op|']'
op|','
string|"'fake-az'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_node_create
dedent|''
name|'def'
name|'test_compute_node_create'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'compute_node_create'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'compute_node_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-values'"
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
string|"'fake-result'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'compute_node_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'fake-values'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'fake-result'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_node_update
dedent|''
name|'def'
name|'test_compute_node_update'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'node'
op|'='
op|'{'
string|"'id'"
op|':'
string|"'fake-id'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'compute_node_update'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'compute_node_update'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'node'
op|'['
string|"'id'"
op|']'
op|','
string|"'fake-values'"
op|','
nl|'\n'
name|'False'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'fake-result'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'compute_node_update'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'node'
op|','
nl|'\n'
string|"'fake-values'"
op|','
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'fake-result'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_node_delete
dedent|''
name|'def'
name|'test_compute_node_delete'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'node'
op|'='
op|'{'
string|"'id'"
op|':'
string|"'fake-id'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'compute_node_delete'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'compute_node_delete'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'node'
op|'['
string|"'id'"
op|']'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'compute_node_delete'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'node'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_fault_create
dedent|''
name|'def'
name|'test_instance_fault_create'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'instance_fault_create'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'instance_fault_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-values'"
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
string|"'fake-result'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'instance_fault_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'fake-values'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'fake-result'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_task_log_get
dedent|''
name|'def'
name|'test_task_log_get'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'task_log_get'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'task_log_get'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'task'"
op|','
string|"'begin'"
op|','
string|"'end'"
op|','
string|"'host'"
op|','
nl|'\n'
string|"'state'"
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'result'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'task_log_get'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'task'"
op|','
string|"'begin'"
op|','
nl|'\n'
string|"'end'"
op|','
string|"'host'"
op|','
string|"'state'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'result'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_task_log_get_with_no_state
dedent|''
name|'def'
name|'test_task_log_get_with_no_state'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'task_log_get'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'task_log_get'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'task'"
op|','
string|"'begin'"
op|','
string|"'end'"
op|','
nl|'\n'
string|"'host'"
op|','
name|'None'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'result'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'task_log_get'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'task'"
op|','
string|"'begin'"
op|','
nl|'\n'
string|"'end'"
op|','
string|"'host'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'result'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_task_log_begin_task
dedent|''
name|'def'
name|'test_task_log_begin_task'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'task_log_begin_task'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'task_log_begin_task'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
string|"'task'"
op|','
string|"'begin'"
op|','
nl|'\n'
string|"'end'"
op|','
string|"'host'"
op|','
string|"'items'"
op|','
nl|'\n'
string|"'message'"
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'result'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'task_log_begin_task'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
string|"'task'"
op|','
string|"'begin'"
op|','
string|"'end'"
op|','
string|"'host'"
op|','
string|"'items'"
op|','
string|"'message'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'result'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_task_log_end_task
dedent|''
name|'def'
name|'test_task_log_end_task'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'task_log_end_task'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'task_log_end_task'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
string|"'task'"
op|','
string|"'begin'"
op|','
string|"'end'"
op|','
nl|'\n'
string|"'host'"
op|','
string|"'errors'"
op|','
string|"'message'"
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'result'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'task_log_end_task'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
string|"'task'"
op|','
string|"'begin'"
op|','
string|"'end'"
op|','
string|"'host'"
op|','
string|"'errors'"
op|','
string|"'message'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'result'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_notify_usage_exists
dedent|''
name|'def'
name|'test_notify_usage_exists'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'info'
op|'='
op|'{'
nl|'\n'
string|"'audit_period_beginning'"
op|':'
string|"'start'"
op|','
nl|'\n'
string|"'audit_period_ending'"
op|':'
string|"'end'"
op|','
nl|'\n'
string|"'bandwidth'"
op|':'
string|"'bw_usage'"
op|','
nl|'\n'
string|"'image_meta'"
op|':'
op|'{'
op|'}'
op|','
nl|'\n'
string|"'extra'"
op|':'
string|"'info'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'instance'
op|'='
op|'{'
nl|'\n'
string|"'system_metadata'"
op|':'
op|'['
op|']'
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'notifications'
op|','
string|"'audit_period_bounds'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'notifications'
op|','
string|"'bandwidth_usage'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'compute_utils'
op|','
string|"'notify_about_instance_usage'"
op|')'
newline|'\n'
nl|'\n'
name|'notifications'
op|'.'
name|'audit_period_bounds'
op|'('
name|'False'
op|')'
op|'.'
name|'AndReturn'
op|'('
op|'('
string|"'start'"
op|','
string|"'end'"
op|')'
op|')'
newline|'\n'
name|'notifications'
op|'.'
name|'bandwidth_usage'
op|'('
name|'instance'
op|','
string|"'start'"
op|','
name|'True'
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
string|"'bw_usage'"
op|')'
newline|'\n'
name|'compute_utils'
op|'.'
name|'notify_about_instance_usage'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'instance'
op|','
nl|'\n'
string|"'exists'"
op|','
nl|'\n'
name|'system_metadata'
op|'='
op|'{'
op|'}'
op|','
nl|'\n'
name|'extra_usage_info'
op|'='
name|'info'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'notify_usage_exists'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'instance'
op|','
nl|'\n'
name|'system_metadata'
op|'='
op|'{'
op|'}'
op|','
nl|'\n'
name|'extra_usage_info'
op|'='
name|'dict'
op|'('
name|'extra'
op|'='
string|"'info'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_security_groups_trigger_members_refresh
dedent|''
name|'def'
name|'test_security_groups_trigger_members_refresh'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'security_group_api'
op|','
nl|'\n'
string|"'trigger_members_refresh'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'security_group_api'
op|'.'
name|'trigger_members_refresh'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
op|'['
number|'1'
op|','
number|'2'
op|','
number|'3'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'security_groups_trigger_members_refresh'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
op|'['
number|'1'
op|','
number|'2'
op|','
number|'3'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_network_migrate_instance_start
dedent|''
name|'def'
name|'test_network_migrate_instance_start'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'network_api'
op|','
nl|'\n'
string|"'migrate_instance_start'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'network_api'
op|'.'
name|'migrate_instance_start'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance'"
op|','
nl|'\n'
string|"'migration'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'network_migrate_instance_start'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance'"
op|','
nl|'\n'
string|"'migration'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_network_migrate_instance_finish
dedent|''
name|'def'
name|'test_network_migrate_instance_finish'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'network_api'
op|','
nl|'\n'
string|"'migrate_instance_finish'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'network_api'
op|'.'
name|'migrate_instance_finish'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
string|"'instance'"
op|','
string|"'migration'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'network_migrate_instance_finish'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance'"
op|','
nl|'\n'
string|"'migration'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_quota_commit
dedent|''
name|'def'
name|'test_quota_commit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'quota'
op|'.'
name|'QUOTAS'
op|','
string|"'commit'"
op|')'
newline|'\n'
name|'quota'
op|'.'
name|'QUOTAS'
op|'.'
name|'commit'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'reservations'"
op|','
name|'project_id'
op|'='
name|'None'
op|')'
newline|'\n'
name|'quota'
op|'.'
name|'QUOTAS'
op|'.'
name|'commit'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'reservations'"
op|','
name|'project_id'
op|'='
string|"'proj'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'quota_commit'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'reservations'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'quota_commit'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'reservations'"
op|','
string|"'proj'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_quota_rollback
dedent|''
name|'def'
name|'test_quota_rollback'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'quota'
op|'.'
name|'QUOTAS'
op|','
string|"'rollback'"
op|')'
newline|'\n'
name|'quota'
op|'.'
name|'QUOTAS'
op|'.'
name|'rollback'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'reservations'"
op|','
name|'project_id'
op|'='
name|'None'
op|')'
newline|'\n'
name|'quota'
op|'.'
name|'QUOTAS'
op|'.'
name|'rollback'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'reservations'"
op|','
name|'project_id'
op|'='
string|"'proj'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'quota_rollback'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'reservations'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'quota_rollback'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'reservations'"
op|','
string|"'proj'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_ec2_ids
dedent|''
name|'def'
name|'test_get_ec2_ids'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expected'
op|'='
op|'{'
nl|'\n'
string|"'instance-id'"
op|':'
string|"'ec2-inst-id'"
op|','
nl|'\n'
string|"'ami-id'"
op|':'
string|"'ec2-ami-id'"
op|','
nl|'\n'
string|"'kernel-id'"
op|':'
string|"'ami-kernel-ec2-kernelid'"
op|','
nl|'\n'
string|"'ramdisk-id'"
op|':'
string|"'ami-ramdisk-ec2-ramdiskid'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'inst'
op|'='
op|'{'
nl|'\n'
string|"'uuid'"
op|':'
string|"'fake-uuid'"
op|','
nl|'\n'
string|"'kernel_id'"
op|':'
string|"'ec2-kernelid'"
op|','
nl|'\n'
string|"'ramdisk_id'"
op|':'
string|"'ec2-ramdiskid'"
op|','
nl|'\n'
string|"'image_ref'"
op|':'
string|"'fake-image'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'ec2utils'
op|','
string|"'id_to_ec2_inst_id'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'ec2utils'
op|','
string|"'glance_id_to_ec2_id'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'ec2utils'
op|','
string|"'image_type'"
op|')'
newline|'\n'
nl|'\n'
name|'ec2utils'
op|'.'
name|'id_to_ec2_inst_id'
op|'('
name|'inst'
op|'['
string|"'uuid'"
op|']'
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
name|'expected'
op|'['
string|"'instance-id'"
op|']'
op|')'
newline|'\n'
name|'ec2utils'
op|'.'
name|'glance_id_to_ec2_id'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'inst'
op|'['
string|"'image_ref'"
op|']'
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
name|'expected'
op|'['
string|"'ami-id'"
op|']'
op|')'
newline|'\n'
name|'for'
name|'image_type'
name|'in'
op|'['
string|"'kernel'"
op|','
string|"'ramdisk'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'image_id'
op|'='
name|'inst'
op|'['
string|"'%s_id'"
op|'%'
name|'image_type'
op|']'
newline|'\n'
name|'ec2utils'
op|'.'
name|'image_type'
op|'('
name|'image_type'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'ami-'"
op|'+'
name|'image_type'
op|')'
newline|'\n'
name|'ec2utils'
op|'.'
name|'glance_id_to_ec2_id'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'image_id'
op|','
nl|'\n'
string|"'ami-'"
op|'+'
name|'image_type'
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
string|"'ami-%s-ec2-%sid'"
op|'%'
op|'('
name|'image_type'
op|','
name|'image_type'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'get_ec2_ids'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'inst'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_stop
dedent|''
name|'def'
name|'test_compute_stop'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'compute_api'
op|','
string|"'stop'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'compute_api'
op|'.'
name|'stop'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'instance'"
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'compute_stop'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'instance'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_confirm_resize
dedent|''
name|'def'
name|'test_compute_confirm_resize'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'compute_api'
op|','
nl|'\n'
string|"'confirm_resize'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'compute_api'
op|'.'
name|'confirm_resize'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance'"
op|','
nl|'\n'
string|"'migration'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'compute_confirm_resize'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'instance'"
op|','
nl|'\n'
string|"'migration'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_unrescue
dedent|''
name|'def'
name|'test_compute_unrescue'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'compute_api'
op|','
nl|'\n'
string|"'unrescue'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'compute_api'
op|'.'
name|'unrescue'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'instance'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'compute_unrescue'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'instance'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ConductorTestCase
dedent|''
dedent|''
name|'class'
name|'ConductorTestCase'
op|'('
name|'_BaseTestCase'
op|','
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Conductor Manager Tests."""'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'ConductorTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'='
name|'conductor_manager'
op|'.'
name|'ConductorManager'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'='
name|'self'
op|'.'
name|'conductor'
newline|'\n'
nl|'\n'
DECL|member|test_block_device_mapping_update_or_create
dedent|''
name|'def'
name|'test_block_device_mapping_update_or_create'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_bdm'
op|'='
op|'{'
string|"'id'"
op|':'
string|"'fake-id'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'block_device_mapping_create'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'block_device_mapping_update'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'block_device_mapping_update_or_create'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'fake_bdm'
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_update'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'fake_bdm'
op|'['
string|"'id'"
op|']'
op|','
name|'fake_bdm'
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_update_or_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'fake_bdm'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_update_or_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'fake_bdm'
op|','
nl|'\n'
name|'create'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_update_or_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'fake_bdm'
op|','
nl|'\n'
name|'create'
op|'='
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_update_or_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'fake_bdm'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_block_device_mapping_destroy
dedent|''
name|'def'
name|'test_block_device_mapping_destroy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_bdm'
op|'='
op|'{'
string|"'id'"
op|':'
string|"'fake-bdm'"
op|'}'
newline|'\n'
name|'fake_bdm2'
op|'='
op|'{'
string|"'id'"
op|':'
string|"'fake-bdm-2'"
op|'}'
newline|'\n'
name|'fake_inst'
op|'='
op|'{'
string|"'uuid'"
op|':'
string|"'fake-uuid'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'block_device_mapping_destroy'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
nl|'\n'
name|'db'
op|','
string|"'block_device_mapping_destroy_by_instance_and_device'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
nl|'\n'
name|'db'
op|','
string|"'block_device_mapping_destroy_by_instance_and_volume'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-bdm'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-bdm-2'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_destroy_by_instance_and_device'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'fake-uuid'"
op|','
nl|'\n'
string|"'fake-device'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_destroy_by_instance_and_volume'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'fake-uuid'"
op|','
nl|'\n'
string|"'fake-volume'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
op|'['
name|'fake_bdm'
op|','
nl|'\n'
name|'fake_bdm2'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'instance'
op|'='
name|'fake_inst'
op|','
nl|'\n'
name|'device_name'
op|'='
string|"'fake-device'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'instance'
op|'='
name|'fake_inst'
op|','
nl|'\n'
name|'volume_id'
op|'='
string|"'fake-volume'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_get_all_by_filters
dedent|''
name|'def'
name|'test_instance_get_all_by_filters'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filters'
op|'='
op|'{'
string|"'foo'"
op|':'
string|"'bar'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'instance_get_all_by_filters'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'instance_get_all_by_filters'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'filters'
op|','
nl|'\n'
string|"'fake-key'"
op|','
string|"'fake-sort'"
op|','
nl|'\n'
name|'columns_to_join'
op|'='
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'instance_get_all_by_filters'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'filters'
op|','
nl|'\n'
string|"'fake-key'"
op|','
string|"'fake-sort'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_get_all_by_host
dedent|''
name|'def'
name|'test_instance_get_all_by_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'instance_get_all_by_host'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'instance_get_all_by_host_and_node'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'instance_get_all_by_host'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'host'"
op|','
name|'None'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'result'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'instance_get_all_by_host_and_node'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
string|"'host'"
op|','
nl|'\n'
string|"'node'"
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'result'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'instance_get_all_by_host'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'host'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'result'"
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'instance_get_all_by_host'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'host'"
op|','
nl|'\n'
string|"'node'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'result'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_stubbed
dedent|''
name|'def'
name|'_test_stubbed'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'dbargs'
op|','
name|'condargs'
op|','
nl|'\n'
name|'db_result_listified'
op|'='
name|'False'
op|','
name|'db_exception'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
name|'name'
op|')'
newline|'\n'
name|'if'
name|'db_exception'
op|':'
newline|'\n'
indent|'            '
name|'getattr'
op|'('
name|'db'
op|','
name|'name'
op|')'
op|'('
name|'self'
op|'.'
name|'context'
op|','
op|'*'
name|'dbargs'
op|')'
op|'.'
name|'AndRaise'
op|'('
name|'db_exception'
op|')'
newline|'\n'
name|'getattr'
op|'('
name|'db'
op|','
name|'name'
op|')'
op|'('
name|'self'
op|'.'
name|'context'
op|','
op|'*'
name|'dbargs'
op|')'
op|'.'
name|'AndRaise'
op|'('
name|'db_exception'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'getattr'
op|'('
name|'db'
op|','
name|'name'
op|')'
op|'('
name|'self'
op|'.'
name|'context'
op|','
op|'*'
name|'dbargs'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'fake-result'"
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'if'
name|'db_exception'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'rpc_common'
op|'.'
name|'ClientException'
op|','
nl|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'service_get_all_by'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
op|'**'
name|'condargs'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stub_out_client_exceptions'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'db_exception'
op|'.'
name|'__class__'
op|','
nl|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'service_get_all_by'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
op|'**'
name|'condargs'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'service_get_all_by'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
op|'**'
name|'condargs'
op|')'
newline|'\n'
name|'if'
name|'db_result_listified'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
string|"'fake-result'"
op|']'
op|','
name|'result'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'fake-result'"
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_all
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_service_get_all'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_all'"
op|','
op|'('
op|')'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_host_and_topic
dedent|''
name|'def'
name|'test_service_get_by_host_and_topic'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_host_and_topic'"
op|','
nl|'\n'
op|'('
string|"'host'"
op|','
string|"'topic'"
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
name|'topic'
op|'='
string|"'topic'"
op|','
name|'host'
op|'='
string|"'host'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_all_by_topic
dedent|''
name|'def'
name|'test_service_get_all_by_topic'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_all_by_topic'"
op|','
nl|'\n'
op|'('
string|"'topic'"
op|','
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
name|'topic'
op|'='
string|"'topic'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_all_by_host
dedent|''
name|'def'
name|'test_service_get_all_by_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_all_by_host'"
op|','
nl|'\n'
op|'('
string|"'host'"
op|','
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
name|'host'
op|'='
string|"'host'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_compute_host
dedent|''
name|'def'
name|'test_service_get_by_compute_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_compute_host'"
op|','
nl|'\n'
op|'('
string|"'host'"
op|','
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
name|'topic'
op|'='
string|"'compute'"
op|','
name|'host'
op|'='
string|"'host'"
op|')'
op|','
nl|'\n'
name|'db_result_listified'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_args
dedent|''
name|'def'
name|'test_service_get_by_args'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_args'"
op|','
nl|'\n'
op|'('
string|"'host'"
op|','
string|"'binary'"
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
name|'host'
op|'='
string|"'host'"
op|','
name|'binary'
op|'='
string|"'binary'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_compute_host_not_found
dedent|''
name|'def'
name|'test_service_get_by_compute_host_not_found'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_compute_host'"
op|','
nl|'\n'
op|'('
string|"'host'"
op|','
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
name|'topic'
op|'='
string|"'compute'"
op|','
name|'host'
op|'='
string|"'host'"
op|')'
op|','
nl|'\n'
name|'db_exception'
op|'='
name|'exc'
op|'.'
name|'ComputeHostNotFound'
op|'('
name|'host'
op|'='
string|"'host'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_args_not_found
dedent|''
name|'def'
name|'test_service_get_by_args_not_found'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_args'"
op|','
nl|'\n'
op|'('
string|"'host'"
op|','
string|"'binary'"
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
name|'host'
op|'='
string|"'host'"
op|','
name|'binary'
op|'='
string|"'binary'"
op|')'
op|','
nl|'\n'
name|'db_exception'
op|'='
name|'exc'
op|'.'
name|'HostBinaryNotFound'
op|'('
name|'binary'
op|'='
string|"'binary'"
op|','
nl|'\n'
name|'host'
op|'='
string|"'host'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_security_groups_trigger_handler
dedent|''
name|'def'
name|'test_security_groups_trigger_handler'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'security_group_api'
op|','
nl|'\n'
string|"'trigger_handler'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'security_group_api'
op|'.'
name|'trigger_handler'
op|'('
string|"'event'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'args'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'security_groups_trigger_handler'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'event'"
op|','
op|'['
string|"'args'"
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ConductorRPCAPITestCase
dedent|''
dedent|''
name|'class'
name|'ConductorRPCAPITestCase'
op|'('
name|'_BaseTestCase'
op|','
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Conductor RPC API Tests."""'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'ConductorRPCAPITestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_service'
op|'='
name|'self'
op|'.'
name|'start_service'
op|'('
nl|'\n'
string|"'conductor'"
op|','
name|'manager'
op|'='
string|"'nova.conductor.manager.ConductorManager'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'='
name|'self'
op|'.'
name|'conductor_service'
op|'.'
name|'manager'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'='
name|'conductor_rpcapi'
op|'.'
name|'ConductorAPI'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_block_device_mapping_update_or_create
dedent|''
name|'def'
name|'test_block_device_mapping_update_or_create'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_bdm'
op|'='
op|'{'
string|"'id'"
op|':'
string|"'fake-id'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'block_device_mapping_create'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'block_device_mapping_update'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'block_device_mapping_update_or_create'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'fake_bdm'
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_update'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'fake_bdm'
op|'['
string|"'id'"
op|']'
op|','
name|'fake_bdm'
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_update_or_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'fake_bdm'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_update_or_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'fake_bdm'
op|','
nl|'\n'
name|'create'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_update_or_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'fake_bdm'
op|','
nl|'\n'
name|'create'
op|'='
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_update_or_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'fake_bdm'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_block_device_mapping_destroy
dedent|''
name|'def'
name|'test_block_device_mapping_destroy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_bdm'
op|'='
op|'{'
string|"'id'"
op|':'
string|"'fake-bdm'"
op|'}'
newline|'\n'
name|'fake_inst'
op|'='
op|'{'
string|"'uuid'"
op|':'
string|"'fake-uuid'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'block_device_mapping_destroy'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
nl|'\n'
name|'db'
op|','
string|"'block_device_mapping_destroy_by_instance_and_device'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
nl|'\n'
name|'db'
op|','
string|"'block_device_mapping_destroy_by_instance_and_volume'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-bdm'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_destroy_by_instance_and_device'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'fake-uuid'"
op|','
nl|'\n'
string|"'fake-device'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_destroy_by_instance_and_volume'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'fake-uuid'"
op|','
nl|'\n'
string|"'fake-volume'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'bdms'
op|'='
op|'['
name|'fake_bdm'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'instance'
op|'='
name|'fake_inst'
op|','
nl|'\n'
name|'device_name'
op|'='
string|"'fake-device'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'instance'
op|'='
name|'fake_inst'
op|','
nl|'\n'
name|'volume_id'
op|'='
string|"'fake-volume'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_get_all_by_filters
dedent|''
name|'def'
name|'test_instance_get_all_by_filters'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filters'
op|'='
op|'{'
string|"'foo'"
op|':'
string|"'bar'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'instance_get_all_by_filters'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'instance_get_all_by_filters'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'filters'
op|','
nl|'\n'
string|"'fake-key'"
op|','
string|"'fake-sort'"
op|','
nl|'\n'
name|'columns_to_join'
op|'='
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'instance_get_all_by_filters'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'filters'
op|','
nl|'\n'
string|"'fake-key'"
op|','
string|"'fake-sort'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_stubbed
dedent|''
name|'def'
name|'_test_stubbed'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'dbargs'
op|','
name|'condargs'
op|','
nl|'\n'
name|'db_result_listified'
op|'='
name|'False'
op|','
name|'db_exception'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
name|'name'
op|')'
newline|'\n'
name|'if'
name|'db_exception'
op|':'
newline|'\n'
indent|'            '
name|'getattr'
op|'('
name|'db'
op|','
name|'name'
op|')'
op|'('
name|'self'
op|'.'
name|'context'
op|','
op|'*'
name|'dbargs'
op|')'
op|'.'
name|'AndRaise'
op|'('
name|'db_exception'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'getattr'
op|'('
name|'db'
op|','
name|'name'
op|')'
op|'('
name|'self'
op|'.'
name|'context'
op|','
op|'*'
name|'dbargs'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'fake-result'"
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'if'
name|'db_exception'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'db_exception'
op|'.'
name|'__class__'
op|','
nl|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'service_get_all_by'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
op|'**'
name|'condargs'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'service_get_all_by'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
op|'**'
name|'condargs'
op|')'
newline|'\n'
name|'if'
name|'db_result_listified'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
string|"'fake-result'"
op|']'
op|','
name|'result'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'fake-result'"
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_all
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_service_get_all'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_all'"
op|','
op|'('
op|')'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_host_and_topic
dedent|''
name|'def'
name|'test_service_get_by_host_and_topic'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_host_and_topic'"
op|','
nl|'\n'
op|'('
string|"'host'"
op|','
string|"'topic'"
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
name|'topic'
op|'='
string|"'topic'"
op|','
name|'host'
op|'='
string|"'host'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_all_by_topic
dedent|''
name|'def'
name|'test_service_get_all_by_topic'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_all_by_topic'"
op|','
nl|'\n'
op|'('
string|"'topic'"
op|','
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
name|'topic'
op|'='
string|"'topic'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_all_by_host
dedent|''
name|'def'
name|'test_service_get_all_by_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_all_by_host'"
op|','
nl|'\n'
op|'('
string|"'host'"
op|','
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
name|'host'
op|'='
string|"'host'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_compute_host
dedent|''
name|'def'
name|'test_service_get_by_compute_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_compute_host'"
op|','
nl|'\n'
op|'('
string|"'host'"
op|','
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
name|'topic'
op|'='
string|"'compute'"
op|','
name|'host'
op|'='
string|"'host'"
op|')'
op|','
nl|'\n'
name|'db_result_listified'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_args
dedent|''
name|'def'
name|'test_service_get_by_args'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_args'"
op|','
nl|'\n'
op|'('
string|"'host'"
op|','
string|"'binary'"
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
name|'host'
op|'='
string|"'host'"
op|','
name|'binary'
op|'='
string|"'binary'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_compute_host_not_found
dedent|''
name|'def'
name|'test_service_get_by_compute_host_not_found'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_compute_host'"
op|','
nl|'\n'
op|'('
string|"'host'"
op|','
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
name|'topic'
op|'='
string|"'compute'"
op|','
name|'host'
op|'='
string|"'host'"
op|')'
op|','
nl|'\n'
name|'db_exception'
op|'='
name|'exc'
op|'.'
name|'ComputeHostNotFound'
op|'('
name|'host'
op|'='
string|"'host'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_args_not_found
dedent|''
name|'def'
name|'test_service_get_by_args_not_found'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_args'"
op|','
nl|'\n'
op|'('
string|"'host'"
op|','
string|"'binary'"
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
name|'host'
op|'='
string|"'host'"
op|','
name|'binary'
op|'='
string|"'binary'"
op|')'
op|','
nl|'\n'
name|'db_exception'
op|'='
name|'exc'
op|'.'
name|'HostBinaryNotFound'
op|'('
name|'binary'
op|'='
string|"'binary'"
op|','
nl|'\n'
name|'host'
op|'='
string|"'host'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_security_groups_trigger_handler
dedent|''
name|'def'
name|'test_security_groups_trigger_handler'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'security_group_api'
op|','
nl|'\n'
string|"'trigger_handler'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'security_group_api'
op|'.'
name|'trigger_handler'
op|'('
string|"'event'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'arg'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'security_groups_trigger_handler'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'event'"
op|','
op|'['
string|"'arg'"
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ConductorAPITestCase
dedent|''
dedent|''
name|'class'
name|'ConductorAPITestCase'
op|'('
name|'_BaseTestCase'
op|','
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Conductor API Tests."""'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'ConductorAPITestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_service'
op|'='
name|'self'
op|'.'
name|'start_service'
op|'('
nl|'\n'
string|"'conductor'"
op|','
name|'manager'
op|'='
string|"'nova.conductor.manager.ConductorManager'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'='
name|'conductor_api'
op|'.'
name|'API'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'='
name|'self'
op|'.'
name|'conductor_service'
op|'.'
name|'manager'
newline|'\n'
name|'self'
op|'.'
name|'db'
op|'='
name|'None'
newline|'\n'
nl|'\n'
DECL|member|_do_update
dedent|''
name|'def'
name|'_do_update'
op|'('
name|'self'
op|','
name|'instance_uuid'
op|','
op|'**'
name|'updates'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(danms): the public API takes actual keyword arguments,'
nl|'\n'
comment|'# so override the base class here to make the call correctly'
nl|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'instance_update'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'instance_uuid'
op|','
nl|'\n'
op|'**'
name|'updates'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bw_usage_get
dedent|''
name|'def'
name|'test_bw_usage_get'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'bw_usage_update'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'bw_usage_get'"
op|')'
newline|'\n'
nl|'\n'
name|'get_args'
op|'='
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'uuid'"
op|','
number|'0'
op|','
string|"'mac'"
op|')'
newline|'\n'
nl|'\n'
name|'db'
op|'.'
name|'bw_usage_get'
op|'('
op|'*'
name|'get_args'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'foo'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'bw_usage_get'
op|'('
op|'*'
name|'get_args'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'foo'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_block_device_mapping_update_or_create
dedent|''
name|'def'
name|'test_block_device_mapping_update_or_create'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'block_device_mapping_create'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'block_device_mapping_update'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'block_device_mapping_update_or_create'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-bdm'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_update'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'fake-id'"
op|','
op|'{'
string|"'id'"
op|':'
string|"'fake-id'"
op|'}'
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_update_or_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-bdm'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-bdm'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_update'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-id'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_update_or_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'fake-bdm'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_block_device_mapping_destroy
dedent|''
name|'def'
name|'test_block_device_mapping_destroy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_bdm'
op|'='
op|'{'
string|"'id'"
op|':'
string|"'fake-bdm'"
op|'}'
newline|'\n'
name|'fake_inst'
op|'='
op|'{'
string|"'uuid'"
op|':'
string|"'fake-uuid'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'block_device_mapping_destroy'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
nl|'\n'
name|'db'
op|','
string|"'block_device_mapping_destroy_by_instance_and_device'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
nl|'\n'
name|'db'
op|','
string|"'block_device_mapping_destroy_by_instance_and_volume'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'fake-bdm'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_destroy_by_instance_and_device'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'fake-uuid'"
op|','
nl|'\n'
string|"'fake-device'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'block_device_mapping_destroy_by_instance_and_volume'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'fake-uuid'"
op|','
nl|'\n'
string|"'fake-volume'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
op|'['
name|'fake_bdm'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_destroy_by_instance_and_device'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'fake_inst'
op|','
string|"'fake-device'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'block_device_mapping_destroy_by_instance_and_volume'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'fake_inst'
op|','
string|"'fake-volume'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_stubbed
dedent|''
name|'def'
name|'_test_stubbed'
op|'('
name|'self'
op|','
name|'name'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'args'
name|'and'
name|'isinstance'
op|'('
name|'args'
op|'['
number|'0'
op|']'
op|','
name|'FakeContext'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'ctxt'
op|'='
name|'args'
op|'['
number|'0'
op|']'
newline|'\n'
name|'args'
op|'='
name|'args'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'ctxt'
op|'='
name|'self'
op|'.'
name|'context'
newline|'\n'
dedent|''
name|'db_exception'
op|'='
name|'kwargs'
op|'.'
name|'get'
op|'('
string|"'db_exception'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
name|'name'
op|')'
newline|'\n'
name|'if'
name|'db_exception'
op|':'
newline|'\n'
indent|'            '
name|'getattr'
op|'('
name|'db'
op|','
name|'name'
op|')'
op|'('
name|'ctxt'
op|','
op|'*'
name|'args'
op|')'
op|'.'
name|'AndRaise'
op|'('
name|'db_exception'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'getattr'
op|'('
name|'db'
op|','
name|'name'
op|')'
op|'('
name|'ctxt'
op|','
op|'*'
name|'args'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'fake-result'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'name'
op|'=='
string|"'service_destroy'"
op|':'
newline|'\n'
comment|'# TODO(russellb) This is a hack ... SetUp() starts the conductor()'
nl|'\n'
comment|'# service.  There is a cleanup step that runs after this test which'
nl|'\n'
comment|'# also deletes the associated service record. This involves a call'
nl|'\n'
comment|'# to db.service_destroy(), which we have stubbed out.'
nl|'\n'
indent|'            '
name|'db'
op|'.'
name|'service_destroy'
op|'('
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|','
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'if'
name|'db_exception'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'db_exception'
op|'.'
name|'__class__'
op|','
nl|'\n'
name|'getattr'
op|'('
name|'self'
op|'.'
name|'conductor'
op|','
name|'name'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
op|'*'
name|'args'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'result'
op|'='
name|'getattr'
op|'('
name|'self'
op|'.'
name|'conductor'
op|','
name|'name'
op|')'
op|'('
name|'self'
op|'.'
name|'context'
op|','
op|'*'
name|'args'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
name|'result'
op|','
string|"'fake-result'"
name|'if'
name|'kwargs'
op|'.'
name|'get'
op|'('
string|"'returns'"
op|','
name|'True'
op|')'
name|'else'
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_all
dedent|''
dedent|''
name|'def'
name|'test_service_get_all'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_all'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_host_and_topic
dedent|''
name|'def'
name|'test_service_get_by_host_and_topic'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_host_and_topic'"
op|','
string|"'host'"
op|','
string|"'topic'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_all_by_topic
dedent|''
name|'def'
name|'test_service_get_all_by_topic'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_all_by_topic'"
op|','
string|"'topic'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_all_by_host
dedent|''
name|'def'
name|'test_service_get_all_by_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_all_by_host'"
op|','
string|"'host'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_compute_host
dedent|''
name|'def'
name|'test_service_get_by_compute_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_compute_host'"
op|','
string|"'host'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_args
dedent|''
name|'def'
name|'test_service_get_by_args'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_args'"
op|','
string|"'host'"
op|','
string|"'binary'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_compute_host_not_found
dedent|''
name|'def'
name|'test_service_get_by_compute_host_not_found'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_compute_host'"
op|','
string|"'host'"
op|','
nl|'\n'
name|'db_exception'
op|'='
name|'exc'
op|'.'
name|'ComputeHostNotFound'
op|'('
name|'host'
op|'='
string|"'host'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_get_by_args_not_found
dedent|''
name|'def'
name|'test_service_get_by_args_not_found'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_get_by_args'"
op|','
string|"'host'"
op|','
string|"'binary'"
op|','
nl|'\n'
name|'db_exception'
op|'='
name|'exc'
op|'.'
name|'HostBinaryNotFound'
op|'('
name|'binary'
op|'='
string|"'binary'"
op|','
nl|'\n'
name|'host'
op|'='
string|"'host'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_create
dedent|''
name|'def'
name|'test_service_create'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_create'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_destroy
dedent|''
name|'def'
name|'test_service_destroy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'service_destroy'"
op|','
string|"''"
op|','
name|'returns'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_service_update
dedent|''
name|'def'
name|'test_service_update'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ctxt'
op|'='
name|'self'
op|'.'
name|'context'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'service_update'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'service_update'
op|'('
name|'ctxt'
op|','
string|"''"
op|','
op|'{'
op|'}'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'fake-result'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'service_update'
op|'('
name|'self'
op|'.'
name|'context'
op|','
op|'{'
string|"'id'"
op|':'
string|"''"
op|'}'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'fake-result'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_get_all_by_host_and_node
dedent|''
name|'def'
name|'test_instance_get_all_by_host_and_node'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_stubbed'
op|'('
string|"'instance_get_all_by_host_and_node'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
string|"'host'"
op|','
string|"'node'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_get_all_by_host
dedent|''
name|'def'
name|'test_instance_get_all_by_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'instance_get_all_by_host'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'db'
op|','
string|"'instance_get_all_by_host_and_node'"
op|')'
newline|'\n'
name|'db'
op|'.'
name|'instance_get_all_by_host'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
string|"'host'"
op|','
nl|'\n'
name|'None'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'fake-result'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'instance_get_all_by_host'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'host'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|"'fake-result'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_wait_until_ready
dedent|''
name|'def'
name|'test_wait_until_ready'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'timeouts'
op|'='
op|'['
op|']'
newline|'\n'
name|'calls'
op|'='
name|'dict'
op|'('
name|'count'
op|'='
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|function|fake_ping
name|'def'
name|'fake_ping'
op|'('
name|'context'
op|','
name|'message'
op|','
name|'timeout'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'timeouts'
op|'.'
name|'append'
op|'('
name|'timeout'
op|')'
newline|'\n'
name|'calls'
op|'['
string|"'count'"
op|']'
op|'+='
number|'1'
newline|'\n'
name|'if'
name|'calls'
op|'['
string|"'count'"
op|']'
op|'<'
number|'15'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'rpc_common'
op|'.'
name|'Timeout'
op|'('
string|'"fake"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'base_rpcapi'
op|','
string|"'ping'"
op|','
name|'fake_ping'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'wait_until_ready'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'timeouts'
op|'.'
name|'count'
op|'('
number|'10'
op|')'
op|','
number|'10'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'None'
name|'in'
name|'timeouts'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_security_groups_trigger_handler
dedent|''
name|'def'
name|'test_security_groups_trigger_handler'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'security_group_api'
op|','
nl|'\n'
string|"'trigger_handler'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'security_group_api'
op|'.'
name|'trigger_handler'
op|'('
string|"'event'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'arg'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'security_groups_trigger_handler'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'event'"
op|','
string|"'arg'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ConductorLocalAPITestCase
dedent|''
dedent|''
name|'class'
name|'ConductorLocalAPITestCase'
op|'('
name|'ConductorAPITestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Conductor LocalAPI Tests."""'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'ConductorLocalAPITestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'='
name|'conductor_api'
op|'.'
name|'LocalAPI'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'_manager'
op|'.'
name|'_target'
newline|'\n'
name|'self'
op|'.'
name|'db'
op|'='
name|'db'
newline|'\n'
nl|'\n'
DECL|member|test_client_exceptions
dedent|''
name|'def'
name|'test_client_exceptions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
name|'self'
op|'.'
name|'_create_fake_instance'
op|'('
op|')'
newline|'\n'
comment|'# NOTE(danms): The LocalAPI should not raise exceptions wrapped'
nl|'\n'
comment|'# in ClientException. KeyError should be raised if an invalid'
nl|'\n'
comment|'# update key is passed, so use that to validate.'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'KeyError'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_do_update'
op|','
name|'instance'
op|'['
string|"'uuid'"
op|']'
op|','
name|'foo'
op|'='
string|"'bar'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_wait_until_ready
dedent|''
name|'def'
name|'test_wait_until_ready'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Override test in ConductorAPITestCase'
nl|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ConductorImportTest
dedent|''
dedent|''
name|'class'
name|'ConductorImportTest'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|test_import_conductor_local
indent|'    '
name|'def'
name|'test_import_conductor_local'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'use_local'
op|'='
name|'True'
op|','
name|'group'
op|'='
string|"'conductor'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'isinstance'
op|'('
name|'conductor'
op|'.'
name|'API'
op|'('
op|')'
op|','
nl|'\n'
name|'conductor_api'
op|'.'
name|'LocalAPI'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'isinstance'
op|'('
name|'conductor'
op|'.'
name|'ComputeTaskAPI'
op|'('
op|')'
op|','
nl|'\n'
name|'conductor_api'
op|'.'
name|'LocalComputeTaskAPI'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_import_conductor_rpc
dedent|''
name|'def'
name|'test_import_conductor_rpc'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'use_local'
op|'='
name|'False'
op|','
name|'group'
op|'='
string|"'conductor'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'isinstance'
op|'('
name|'conductor'
op|'.'
name|'API'
op|'('
op|')'
op|','
nl|'\n'
name|'conductor_api'
op|'.'
name|'API'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'isinstance'
op|'('
name|'conductor'
op|'.'
name|'ComputeTaskAPI'
op|'('
op|')'
op|','
nl|'\n'
name|'conductor_api'
op|'.'
name|'ComputeTaskAPI'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_import_conductor_override_to_local
dedent|''
name|'def'
name|'test_import_conductor_override_to_local'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'use_local'
op|'='
name|'False'
op|','
name|'group'
op|'='
string|"'conductor'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'isinstance'
op|'('
name|'conductor'
op|'.'
name|'API'
op|'('
name|'use_local'
op|'='
name|'True'
op|')'
op|','
nl|'\n'
name|'conductor_api'
op|'.'
name|'LocalAPI'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'isinstance'
op|'('
name|'conductor'
op|'.'
name|'ComputeTaskAPI'
op|'('
name|'use_local'
op|'='
name|'True'
op|')'
op|','
nl|'\n'
name|'conductor_api'
op|'.'
name|'LocalComputeTaskAPI'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ConductorPolicyTest
dedent|''
dedent|''
name|'class'
name|'ConductorPolicyTest'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|test_all_allowed_keys
indent|'    '
name|'def'
name|'test_all_allowed_keys'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_db_instance_update
indent|'        '
name|'def'
name|'fake_db_instance_update'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'None'
op|','
name|'None'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'db'
op|','
string|"'instance_update_and_get_original'"
op|','
nl|'\n'
name|'fake_db_instance_update'
op|')'
newline|'\n'
nl|'\n'
name|'ctxt'
op|'='
name|'context'
op|'.'
name|'RequestContext'
op|'('
string|"'fake-user'"
op|','
string|"'fake-project'"
op|')'
newline|'\n'
name|'conductor'
op|'='
name|'conductor_api'
op|'.'
name|'LocalAPI'
op|'('
op|')'
newline|'\n'
name|'updates'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'key'
name|'in'
name|'conductor_manager'
op|'.'
name|'allowed_updates'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'key'
name|'in'
name|'conductor_manager'
op|'.'
name|'datetime_fields'
op|':'
newline|'\n'
indent|'                '
name|'updates'
op|'['
name|'key'
op|']'
op|'='
name|'timeutils'
op|'.'
name|'utcnow'
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'updates'
op|'['
name|'key'
op|']'
op|'='
string|"'foo'"
newline|'\n'
dedent|''
dedent|''
name|'conductor'
op|'.'
name|'instance_update'
op|'('
name|'ctxt'
op|','
string|"'fake-instance'"
op|','
op|'**'
name|'updates'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_allowed_keys_are_real
dedent|''
name|'def'
name|'test_allowed_keys_are_real'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
name|'models'
op|'.'
name|'Instance'
op|'('
op|')'
newline|'\n'
name|'keys'
op|'='
name|'list'
op|'('
name|'conductor_manager'
op|'.'
name|'allowed_updates'
op|')'
newline|'\n'
nl|'\n'
comment|'# NOTE(danms): expected_task_state is a parameter that gets'
nl|'\n'
comment|'# passed to the db layer, but is not actually an instance attribute'
nl|'\n'
name|'del'
name|'keys'
op|'['
name|'keys'
op|'.'
name|'index'
op|'('
string|"'expected_task_state'"
op|')'
op|']'
newline|'\n'
nl|'\n'
name|'for'
name|'key'
name|'in'
name|'keys'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'hasattr'
op|'('
name|'instance'
op|','
name|'key'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|_BaseTaskTestCase
dedent|''
dedent|''
dedent|''
name|'class'
name|'_BaseTaskTestCase'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'_BaseTaskTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'user_id'
op|'='
string|"'fake'"
newline|'\n'
name|'self'
op|'.'
name|'project_id'
op|'='
string|"'fake'"
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'FakeContext'
op|'('
name|'self'
op|'.'
name|'user_id'
op|','
name|'self'
op|'.'
name|'project_id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_migrate_server
dedent|''
name|'def'
name|'test_migrate_server'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'scheduler_rpcapi'
op|','
nl|'\n'
string|"'live_migration'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'.'
name|'scheduler_rpcapi'
op|'.'
name|'live_migration'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'block_migration'"
op|','
string|"'disk_over_commit'"
op|','
string|"'instance'"
op|','
string|"'destination'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'migrate_server'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|"'instance'"
op|','
nl|'\n'
op|'{'
string|"'host'"
op|':'
string|"'destination'"
op|'}'
op|','
name|'True'
op|','
name|'False'
op|','
name|'None'
op|','
string|"'block_migration'"
op|','
nl|'\n'
string|"'disk_over_commit'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_migrate_server_fails_with_non_live
dedent|''
name|'def'
name|'test_migrate_server_fails_with_non_live'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'NotImplementedError'
op|','
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'migrate_server'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'None'
op|','
name|'None'
op|','
name|'False'
op|','
name|'False'
op|','
name|'None'
op|','
name|'None'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_migrate_server_fails_with_rebuild
dedent|''
name|'def'
name|'test_migrate_server_fails_with_rebuild'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'NotImplementedError'
op|','
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'migrate_server'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'None'
op|','
name|'None'
op|','
name|'True'
op|','
name|'True'
op|','
name|'None'
op|','
name|'None'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_migrate_server_fails_with_flavor
dedent|''
name|'def'
name|'test_migrate_server_fails_with_flavor'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'NotImplementedError'
op|','
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'migrate_server'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'None'
op|','
name|'None'
op|','
name|'True'
op|','
name|'False'
op|','
string|'"dummy"'
op|','
name|'None'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ConductorTaskTestCase
dedent|''
dedent|''
name|'class'
name|'ConductorTaskTestCase'
op|'('
name|'_BaseTaskTestCase'
op|','
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""ComputeTaskManager Tests."""'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'ConductorTaskTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'='
name|'conductor_manager'
op|'.'
name|'ComputeTaskManager'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'='
name|'self'
op|'.'
name|'conductor'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ConductorTaskRPCAPITestCase
dedent|''
dedent|''
name|'class'
name|'ConductorTaskRPCAPITestCase'
op|'('
name|'_BaseTaskTestCase'
op|','
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Conductor compute_task RPC namespace Tests."""'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'ConductorTaskRPCAPITestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_service'
op|'='
name|'self'
op|'.'
name|'start_service'
op|'('
nl|'\n'
string|"'conductor'"
op|','
name|'manager'
op|'='
string|"'nova.conductor.manager.ConductorManager'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'='
name|'conductor_rpcapi'
op|'.'
name|'ComputeTaskAPI'
op|'('
op|')'
newline|'\n'
name|'service_manager'
op|'='
name|'self'
op|'.'
name|'conductor_service'
op|'.'
name|'manager'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'='
name|'service_manager'
op|'.'
name|'compute_task_mgr'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ConductorTaskAPITestCase
dedent|''
dedent|''
name|'class'
name|'ConductorTaskAPITestCase'
op|'('
name|'_BaseTaskTestCase'
op|','
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Compute task API Tests."""'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'ConductorTaskAPITestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_service'
op|'='
name|'self'
op|'.'
name|'start_service'
op|'('
nl|'\n'
string|"'conductor'"
op|','
name|'manager'
op|'='
string|"'nova.conductor.manager.ConductorManager'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'='
name|'conductor_api'
op|'.'
name|'ComputeTaskAPI'
op|'('
op|')'
newline|'\n'
name|'service_manager'
op|'='
name|'self'
op|'.'
name|'conductor_service'
op|'.'
name|'manager'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'='
name|'service_manager'
op|'.'
name|'compute_task_mgr'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ConductorLocalComputeTaskAPITestCase
dedent|''
dedent|''
name|'class'
name|'ConductorLocalComputeTaskAPITestCase'
op|'('
name|'ConductorTaskAPITestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Conductor LocalComputeTaskAPI Tests."""'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'ConductorLocalComputeTaskAPITestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor'
op|'='
name|'conductor_api'
op|'.'
name|'LocalComputeTaskAPI'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'conductor_manager'
op|'='
name|'self'
op|'.'
name|'conductor'
op|'.'
name|'_manager'
op|'.'
name|'_target'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
