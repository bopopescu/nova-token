begin_unit
comment|'# Copyright 2011 OpenStack Foundation  # All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
string|'"""\nTests For Scheduler Host Filters.\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'httplib'
newline|'\n'
nl|'\n'
name|'from'
name|'oslo'
op|'.'
name|'config'
name|'import'
name|'cfg'
newline|'\n'
name|'import'
name|'stubout'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'context'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'db'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'jsonutils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'timeutils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'scheduler'
name|'import'
name|'filters'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'scheduler'
op|'.'
name|'filters'
name|'import'
name|'extra_specs_ops'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'scheduler'
op|'.'
name|'filters'
name|'import'
name|'trusted_filter'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'servicegroup'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'scheduler'
name|'import'
name|'fakes'
newline|'\n'
nl|'\n'
DECL|variable|CONF
name|'CONF'
op|'='
name|'cfg'
op|'.'
name|'CONF'
newline|'\n'
name|'CONF'
op|'.'
name|'import_opt'
op|'('
string|"'my_ip'"
op|','
string|"'nova.netconf'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestFilter
name|'class'
name|'TestFilter'
op|'('
name|'filters'
op|'.'
name|'BaseHostFilter'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestBogusFilter
dedent|''
name|'class'
name|'TestBogusFilter'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Class that doesn\'t inherit from BaseHostFilter."""'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ExtraSpecsOpsTestCase
dedent|''
name|'class'
name|'ExtraSpecsOpsTestCase'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
DECL|member|_do_extra_specs_ops_test
indent|'    '
name|'def'
name|'_do_extra_specs_ops_test'
op|'('
name|'self'
op|','
name|'value'
op|','
name|'req'
op|','
name|'matches'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'assertion'
op|'='
name|'self'
op|'.'
name|'assertTrue'
name|'if'
name|'matches'
name|'else'
name|'self'
op|'.'
name|'assertFalse'
newline|'\n'
name|'assertion'
op|'('
name|'extra_specs_ops'
op|'.'
name|'match'
op|'('
name|'value'
op|','
name|'req'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_matches_simple
dedent|''
name|'def'
name|'test_extra_specs_matches_simple'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'1'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'1'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_simple
dedent|''
name|'def'
name|'test_extra_specs_fails_simple'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"''"
op|','
nl|'\n'
name|'req'
op|'='
string|"'1'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_simple2
dedent|''
name|'def'
name|'test_extra_specs_fails_simple2'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'3'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'1'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_simple3
dedent|''
name|'def'
name|'test_extra_specs_fails_simple3'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'222'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'2'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_bogus_ops
dedent|''
name|'def'
name|'test_extra_specs_fails_with_bogus_ops'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'4'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'> 2'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_matches_with_op_eq
dedent|''
name|'def'
name|'test_extra_specs_matches_with_op_eq'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'123'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'= 123'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_matches_with_op_eq2
dedent|''
name|'def'
name|'test_extra_specs_matches_with_op_eq2'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'124'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'= 123'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_op_eq
dedent|''
name|'def'
name|'test_extra_specs_fails_with_op_eq'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'34'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'= 234'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_op_eq3
dedent|''
name|'def'
name|'test_extra_specs_fails_with_op_eq3'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'34'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'='"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_matches_with_op_seq
dedent|''
name|'def'
name|'test_extra_specs_matches_with_op_seq'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'123'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'s== 123'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_op_seq
dedent|''
name|'def'
name|'test_extra_specs_fails_with_op_seq'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'1234'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'s== 123'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_matches_with_op_sneq
dedent|''
name|'def'
name|'test_extra_specs_matches_with_op_sneq'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'1234'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'s!= 123'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_op_sneq
dedent|''
name|'def'
name|'test_extra_specs_fails_with_op_sneq'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'123'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'s!= 123'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_op_sge
dedent|''
name|'def'
name|'test_extra_specs_fails_with_op_sge'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'1000'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'s>= 234'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_op_sle
dedent|''
name|'def'
name|'test_extra_specs_fails_with_op_sle'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'1234'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'s<= 1000'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_op_sl
dedent|''
name|'def'
name|'test_extra_specs_fails_with_op_sl'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'2'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'s< 12'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_op_sg
dedent|''
name|'def'
name|'test_extra_specs_fails_with_op_sg'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'12'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'s> 2'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_matches_with_op_in
dedent|''
name|'def'
name|'test_extra_specs_matches_with_op_in'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'12311321'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'<in> 11'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_matches_with_op_in2
dedent|''
name|'def'
name|'test_extra_specs_matches_with_op_in2'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'12311321'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'<in> 12311321'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_matches_with_op_in3
dedent|''
name|'def'
name|'test_extra_specs_matches_with_op_in3'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'12311321'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'<in> 12311321 <in>'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_op_in
dedent|''
name|'def'
name|'test_extra_specs_fails_with_op_in'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'12310321'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'<in> 11'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_op_in2
dedent|''
name|'def'
name|'test_extra_specs_fails_with_op_in2'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'12310321'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'<in> 11 <in>'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_matches_with_op_or
dedent|''
name|'def'
name|'test_extra_specs_matches_with_op_or'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'12'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'<or> 11 <or> 12'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_matches_with_op_or2
dedent|''
name|'def'
name|'test_extra_specs_matches_with_op_or2'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'12'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'<or> 11 <or> 12 <or>'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_op_or
dedent|''
name|'def'
name|'test_extra_specs_fails_with_op_or'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'13'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'<or> 11 <or> 12'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_op_or2
dedent|''
name|'def'
name|'test_extra_specs_fails_with_op_or2'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'13'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'<or> 11 <or> 12 <or>'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_matches_with_op_le
dedent|''
name|'def'
name|'test_extra_specs_matches_with_op_le'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'2'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'<= 10'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_op_le
dedent|''
name|'def'
name|'test_extra_specs_fails_with_op_le'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'3'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'<= 2'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_matches_with_op_ge
dedent|''
name|'def'
name|'test_extra_specs_matches_with_op_ge'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'3'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'>= 1'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_fails_with_op_ge
dedent|''
name|'def'
name|'test_extra_specs_fails_with_op_ge'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_extra_specs_ops_test'
op|'('
nl|'\n'
name|'value'
op|'='
string|"'2'"
op|','
nl|'\n'
name|'req'
op|'='
string|"'>= 3'"
op|','
nl|'\n'
name|'matches'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|HostFiltersTestCase
dedent|''
dedent|''
name|'class'
name|'HostFiltersTestCase'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Test case for host filters."""'
newline|'\n'
comment|'# FIXME(sirp): These tests still require DB access until we can separate'
nl|'\n'
comment|'# the testing of the DB API code from the host-filter code.'
nl|'\n'
DECL|variable|USES_DB
name|'USES_DB'
op|'='
name|'True'
newline|'\n'
nl|'\n'
DECL|member|fake_oat_request
name|'def'
name|'fake_oat_request'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Stubs out the response from OAT service."""'
newline|'\n'
name|'self'
op|'.'
name|'oat_attested'
op|'='
name|'True'
newline|'\n'
name|'return'
name|'httplib'
op|'.'
name|'OK'
op|','
name|'self'
op|'.'
name|'oat_data'
newline|'\n'
nl|'\n'
DECL|member|setUp
dedent|''
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'HostFiltersTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'oat_data'
op|'='
string|"''"
newline|'\n'
name|'self'
op|'.'
name|'oat_attested'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'='
name|'stubout'
op|'.'
name|'StubOutForTesting'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'trusted_filter'
op|'.'
name|'AttestationService'
op|','
string|"'_request'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'fake_oat_request'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'context'
op|'.'
name|'RequestContext'
op|'('
string|"'fake'"
op|','
string|"'fake'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'json_query'
op|'='
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
nl|'\n'
op|'['
string|"'and'"
op|','
op|'['
string|"'>='"
op|','
string|"'$free_ram_mb'"
op|','
number|'1024'
op|']'
op|','
nl|'\n'
op|'['
string|"'>='"
op|','
string|"'$free_disk_mb'"
op|','
number|'200'
op|'*'
number|'1024'
op|']'
op|']'
op|')'
newline|'\n'
name|'filter_handler'
op|'='
name|'filters'
op|'.'
name|'HostFilterHandler'
op|'('
op|')'
newline|'\n'
name|'classes'
op|'='
name|'filter_handler'
op|'.'
name|'get_matching_classes'
op|'('
nl|'\n'
op|'['
string|"'nova.scheduler.filters.all_filters'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'class_map'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'cls'
name|'in'
name|'classes'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'class_map'
op|'['
name|'cls'
op|'.'
name|'__name__'
op|']'
op|'='
name|'cls'
newline|'\n'
nl|'\n'
DECL|member|test_all_filters
dedent|''
dedent|''
name|'def'
name|'test_all_filters'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Double check at least a couple of known filters exist'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'AllHostsFilter'"
op|','
name|'self'
op|'.'
name|'class_map'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'ComputeFilter'"
op|','
name|'self'
op|'.'
name|'class_map'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_all_host_filter
dedent|''
name|'def'
name|'test_all_host_filter'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AllHostsFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
op|'{'
op|'}'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_stub_service_is_up
dedent|''
name|'def'
name|'_stub_service_is_up'
op|'('
name|'self'
op|','
name|'ret_value'
op|')'
op|':'
newline|'\n'
DECL|function|fake_service_is_up
indent|'        '
name|'def'
name|'fake_service_is_up'
op|'('
name|'self'
op|','
name|'service'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'ret_value'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'servicegroup'
op|'.'
name|'API'
op|','
string|"'service_is_up'"
op|','
name|'fake_service_is_up'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_affinity_different_filter_passes
dedent|''
name|'def'
name|'test_affinity_different_filter_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'DifferentHostFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'instance'
op|'='
name|'fakes'
op|'.'
name|'FakeInstance'
op|'('
name|'context'
op|'='
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'params'
op|'='
op|'{'
string|"'host'"
op|':'
string|"'host2'"
op|'}'
op|')'
newline|'\n'
name|'instance_uuid'
op|'='
name|'instance'
op|'.'
name|'uuid'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'different_host'"
op|':'
op|'['
name|'instance_uuid'
op|']'
op|','
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_affinity_different_filter_no_list_passes
dedent|''
name|'def'
name|'test_affinity_different_filter_no_list_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'DifferentHostFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'instance'
op|'='
name|'fakes'
op|'.'
name|'FakeInstance'
op|'('
name|'context'
op|'='
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'params'
op|'='
op|'{'
string|"'host'"
op|':'
string|"'host2'"
op|'}'
op|')'
newline|'\n'
name|'instance_uuid'
op|'='
name|'instance'
op|'.'
name|'uuid'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'different_host'"
op|':'
name|'instance_uuid'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_affinity_different_filter_fails
dedent|''
name|'def'
name|'test_affinity_different_filter_fails'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'DifferentHostFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'instance'
op|'='
name|'fakes'
op|'.'
name|'FakeInstance'
op|'('
name|'context'
op|'='
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'params'
op|'='
op|'{'
string|"'host'"
op|':'
string|"'host1'"
op|'}'
op|')'
newline|'\n'
name|'instance_uuid'
op|'='
name|'instance'
op|'.'
name|'uuid'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'different_host'"
op|':'
op|'['
name|'instance_uuid'
op|']'
op|','
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_affinity_different_filter_handles_none
dedent|''
name|'def'
name|'test_affinity_different_filter_handles_none'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'DifferentHostFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
name|'None'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_affinity_different_filter_handles_deleted_instance
dedent|''
name|'def'
name|'test_affinity_different_filter_handles_deleted_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'DifferentHostFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'instance'
op|'='
name|'fakes'
op|'.'
name|'FakeInstance'
op|'('
name|'context'
op|'='
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'params'
op|'='
op|'{'
string|"'host'"
op|':'
string|"'host1'"
op|'}'
op|')'
newline|'\n'
name|'instance_uuid'
op|'='
name|'instance'
op|'.'
name|'uuid'
newline|'\n'
name|'db'
op|'.'
name|'instance_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'instance_uuid'
op|')'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'different_host'"
op|':'
op|'['
name|'instance_uuid'
op|']'
op|','
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_affinity_same_filter_no_list_passes
dedent|''
name|'def'
name|'test_affinity_same_filter_no_list_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'SameHostFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'instance'
op|'='
name|'fakes'
op|'.'
name|'FakeInstance'
op|'('
name|'context'
op|'='
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'params'
op|'='
op|'{'
string|"'host'"
op|':'
string|"'host1'"
op|'}'
op|')'
newline|'\n'
name|'instance_uuid'
op|'='
name|'instance'
op|'.'
name|'uuid'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'same_host'"
op|':'
name|'instance_uuid'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_affinity_same_filter_passes
dedent|''
name|'def'
name|'test_affinity_same_filter_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'SameHostFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'instance'
op|'='
name|'fakes'
op|'.'
name|'FakeInstance'
op|'('
name|'context'
op|'='
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'params'
op|'='
op|'{'
string|"'host'"
op|':'
string|"'host1'"
op|'}'
op|')'
newline|'\n'
name|'instance_uuid'
op|'='
name|'instance'
op|'.'
name|'uuid'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'same_host'"
op|':'
op|'['
name|'instance_uuid'
op|']'
op|','
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_affinity_same_filter_fails
dedent|''
name|'def'
name|'test_affinity_same_filter_fails'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'SameHostFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'instance'
op|'='
name|'fakes'
op|'.'
name|'FakeInstance'
op|'('
name|'context'
op|'='
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'params'
op|'='
op|'{'
string|"'host'"
op|':'
string|"'host2'"
op|'}'
op|')'
newline|'\n'
name|'instance_uuid'
op|'='
name|'instance'
op|'.'
name|'uuid'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'same_host'"
op|':'
op|'['
name|'instance_uuid'
op|']'
op|','
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_affinity_same_filter_handles_none
dedent|''
name|'def'
name|'test_affinity_same_filter_handles_none'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'SameHostFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
name|'None'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_affinity_same_filter_handles_deleted_instance
dedent|''
name|'def'
name|'test_affinity_same_filter_handles_deleted_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'SameHostFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'instance'
op|'='
name|'fakes'
op|'.'
name|'FakeInstance'
op|'('
name|'context'
op|'='
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'params'
op|'='
op|'{'
string|"'host'"
op|':'
string|"'host1'"
op|'}'
op|')'
newline|'\n'
name|'instance_uuid'
op|'='
name|'instance'
op|'.'
name|'uuid'
newline|'\n'
name|'db'
op|'.'
name|'instance_destroy'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'instance_uuid'
op|')'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'same_host'"
op|':'
op|'['
name|'instance_uuid'
op|']'
op|','
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_affinity_simple_cidr_filter_passes
dedent|''
name|'def'
name|'test_affinity_simple_cidr_filter_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'SimpleCIDRAffinityFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'host'
op|'.'
name|'capabilities'
op|'='
op|'{'
string|"'host_ip'"
op|':'
string|"'10.8.1.1'"
op|'}'
newline|'\n'
nl|'\n'
name|'affinity_ip'
op|'='
string|'"10.8.1.100"'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'cidr'"
op|':'
string|"'/24'"
op|','
nl|'\n'
string|"'build_near_host_ip'"
op|':'
name|'affinity_ip'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_affinity_simple_cidr_filter_fails
dedent|''
name|'def'
name|'test_affinity_simple_cidr_filter_fails'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'SimpleCIDRAffinityFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'host'
op|'.'
name|'capabilities'
op|'='
op|'{'
string|"'host_ip'"
op|':'
string|"'10.8.1.1'"
op|'}'
newline|'\n'
nl|'\n'
name|'affinity_ip'
op|'='
string|'"10.8.1.100"'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'cidr'"
op|':'
string|"'/32'"
op|','
nl|'\n'
string|"'build_near_host_ip'"
op|':'
name|'affinity_ip'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_affinity_simple_cidr_filter_handles_none
dedent|''
name|'def'
name|'test_affinity_simple_cidr_filter_handles_none'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'SimpleCIDRAffinityFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'affinity_ip'
op|'='
name|'CONF'
op|'.'
name|'my_ip'
op|'.'
name|'split'
op|'('
string|"'.'"
op|')'
op|'['
number|'0'
op|':'
number|'3'
op|']'
newline|'\n'
name|'affinity_ip'
op|'.'
name|'append'
op|'('
string|"'100'"
op|')'
newline|'\n'
name|'affinity_ip'
op|'='
name|'str'
op|'.'
name|'join'
op|'('
string|"'.'"
op|','
name|'affinity_ip'
op|')'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
name|'None'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_filter_passes
dedent|''
name|'def'
name|'test_compute_filter_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'ComputeFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1024'
op|','
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
nl|'\n'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_type_filter
dedent|''
name|'def'
name|'test_type_filter'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'TypeAffinityFilter'"
op|']'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'id'"
op|':'
number|'1'
op|'}'
op|'}'
newline|'\n'
name|'filter2_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'id'"
op|':'
number|'2'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'fake_host'"
op|','
string|"'fake_node'"
op|','
nl|'\n'
op|'{'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
nl|'\n'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
comment|'#True since empty'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
name|'fakes'
op|'.'
name|'FakeInstance'
op|'('
name|'context'
op|'='
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'params'
op|'='
op|'{'
string|"'host'"
op|':'
string|"'fake_host'"
op|','
string|"'instance_type_id'"
op|':'
number|'1'
op|'}'
op|')'
newline|'\n'
comment|'#True since same type'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
comment|'#False since different type'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter2_properties'
op|')'
op|')'
newline|'\n'
comment|'#False since node not homogeneous'
nl|'\n'
name|'fakes'
op|'.'
name|'FakeInstance'
op|'('
name|'context'
op|'='
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'params'
op|'='
op|'{'
string|"'host'"
op|':'
string|"'fake_host'"
op|','
string|"'instance_type_id'"
op|':'
number|'2'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_type_filter
dedent|''
name|'def'
name|'test_aggregate_type_filter'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AggregateTypeAffinityFilter'"
op|']'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'name'"
op|':'
string|"'fake1'"
op|'}'
op|'}'
newline|'\n'
name|'filter2_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'name'"
op|':'
string|"'fake2'"
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'fake_host'"
op|','
string|"'fake_node'"
op|','
nl|'\n'
op|'{'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
nl|'\n'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
comment|'#True since no aggregates'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
comment|'#True since type matches aggregate, metadata'
nl|'\n'
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'name'
op|'='
string|"'fake_aggregate'"
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
string|"'fake_host'"
op|']'
op|','
name|'metadata'
op|'='
op|'{'
string|"'instance_type'"
op|':'
string|"'fake1'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
comment|'#False since type matches aggregate, metadata'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter2_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_ram_filter_fails_on_memory
dedent|''
name|'def'
name|'test_ram_filter_fails_on_memory'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'RamFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'ram_allocation_ratio'
op|'='
number|'1.0'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1023'
op|','
string|"'total_usable_ram_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_ram_filter_passes
dedent|''
name|'def'
name|'test_ram_filter_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'RamFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'ram_allocation_ratio'
op|'='
number|'1.0'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1024'
op|','
string|"'total_usable_ram_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_ram_filter_oversubscribe
dedent|''
name|'def'
name|'test_ram_filter_oversubscribe'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'RamFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'ram_allocation_ratio'
op|'='
number|'2.0'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
op|'-'
number|'1024'
op|','
string|"'total_usable_ram_mb'"
op|':'
number|'2048'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'2048'
op|'*'
number|'2.0'
op|','
name|'host'
op|'.'
name|'limits'
op|'['
string|"'memory_mb'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_ram_filter_value_error
dedent|''
name|'def'
name|'test_aggregate_ram_filter_value_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AggregateRamFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'ram_allocation_ratio'
op|'='
number|'1.0'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1024'
op|','
string|"'total_usable_ram_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'name'
op|'='
string|"'fake_aggregate'"
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
string|"'host1'"
op|']'
op|','
nl|'\n'
name|'metadata'
op|'='
op|'{'
string|"'ram_allocation_ratio'"
op|':'
string|"'XXX'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1024'
op|'*'
number|'1.0'
op|','
name|'host'
op|'.'
name|'limits'
op|'['
string|"'memory_mb'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_ram_filter_default_value
dedent|''
name|'def'
name|'test_aggregate_ram_filter_default_value'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AggregateRamFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'ram_allocation_ratio'
op|'='
number|'1.0'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1023'
op|','
string|"'total_usable_ram_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
comment|'# False: fallback to default flag w/o aggregates'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'name'
op|'='
string|"'fake_aggregate'"
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
string|"'host1'"
op|']'
op|','
nl|'\n'
name|'metadata'
op|'='
op|'{'
string|"'ram_allocation_ratio'"
op|':'
string|"'2.0'"
op|'}'
op|')'
newline|'\n'
comment|'# True: use ratio from aggregates'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1024'
op|'*'
number|'2.0'
op|','
name|'host'
op|'.'
name|'limits'
op|'['
string|"'memory_mb'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_ram_filter_conflict_values
dedent|''
name|'def'
name|'test_aggregate_ram_filter_conflict_values'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AggregateRamFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'ram_allocation_ratio'
op|'='
number|'1.0'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1023'
op|','
string|"'total_usable_ram_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'name'
op|'='
string|"'fake_aggregate1'"
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
string|"'host1'"
op|']'
op|','
nl|'\n'
name|'metadata'
op|'='
op|'{'
string|"'ram_allocation_ratio'"
op|':'
string|"'1.5'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'name'
op|'='
string|"'fake_aggregate2'"
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
string|"'host1'"
op|']'
op|','
nl|'\n'
name|'metadata'
op|'='
op|'{'
string|"'ram_allocation_ratio'"
op|':'
string|"'2.0'"
op|'}'
op|')'
newline|'\n'
comment|'# use the minimum ratio from aggregates'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1024'
op|'*'
number|'1.5'
op|','
name|'host'
op|'.'
name|'limits'
op|'['
string|"'memory_mb'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_disk_filter_passes
dedent|''
name|'def'
name|'test_disk_filter_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'DiskFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'disk_allocation_ratio'
op|'='
number|'1.0'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'root_gb'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'ephemeral_gb'"
op|':'
number|'1'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_disk_mb'"
op|':'
number|'11'
op|'*'
number|'1024'
op|','
string|"'total_usable_disk_gb'"
op|':'
number|'13'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_disk_filter_fails
dedent|''
name|'def'
name|'test_disk_filter_fails'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'DiskFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'disk_allocation_ratio'
op|'='
number|'1.0'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'root_gb'"
op|':'
number|'11'
op|','
nl|'\n'
string|"'ephemeral_gb'"
op|':'
number|'1'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_disk_mb'"
op|':'
number|'11'
op|'*'
number|'1024'
op|','
string|"'total_usable_disk_gb'"
op|':'
number|'13'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_disk_filter_oversubscribe
dedent|''
name|'def'
name|'test_disk_filter_oversubscribe'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'DiskFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'disk_allocation_ratio'
op|'='
number|'10.0'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'root_gb'"
op|':'
number|'100'
op|','
nl|'\n'
string|"'ephemeral_gb'"
op|':'
number|'19'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
comment|'# 1GB used... so 119GB allowed...'
nl|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_disk_mb'"
op|':'
number|'11'
op|'*'
number|'1024'
op|','
string|"'total_usable_disk_gb'"
op|':'
number|'12'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'12'
op|'*'
number|'10.0'
op|','
name|'host'
op|'.'
name|'limits'
op|'['
string|"'disk_gb'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_disk_filter_oversubscribe_fail
dedent|''
name|'def'
name|'test_disk_filter_oversubscribe_fail'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'DiskFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'disk_allocation_ratio'
op|'='
number|'10.0'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'root_gb'"
op|':'
number|'100'
op|','
nl|'\n'
string|"'ephemeral_gb'"
op|':'
number|'20'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
comment|'# 1GB used... so 119GB allowed...'
nl|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_disk_mb'"
op|':'
number|'11'
op|'*'
number|'1024'
op|','
string|"'total_usable_disk_gb'"
op|':'
number|'12'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_filter_fails_on_service_disabled
dedent|''
name|'def'
name|'test_compute_filter_fails_on_service_disabled'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'ComputeFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1024'
op|','
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
nl|'\n'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_filter_fails_on_service_down
dedent|''
name|'def'
name|'test_compute_filter_fails_on_service_down'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'False'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'ComputeFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1024'
op|','
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
nl|'\n'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_filter_fails_on_capability_disabled
dedent|''
name|'def'
name|'test_compute_filter_fails_on_capability_disabled'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'ComputeFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1024'
op|','
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
nl|'\n'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_image_properties_filter_passes_same_inst_props
dedent|''
name|'def'
name|'test_image_properties_filter_passes_same_inst_props'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'ImagePropertiesFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'img_props'
op|'='
op|'{'
string|"'properties'"
op|':'
op|'{'
string|"'_architecture'"
op|':'
string|"'x86_64'"
op|','
nl|'\n'
string|"'hypervisor_type'"
op|':'
string|"'kvm'"
op|','
nl|'\n'
string|"'vm_mode'"
op|':'
string|"'hvm'"
op|'}'
op|'}'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'request_spec'"
op|':'
op|'{'
string|"'image'"
op|':'
name|'img_props'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|','
nl|'\n'
string|"'supported_instances'"
op|':'
op|'['
nl|'\n'
op|'('
string|"'x86_64'"
op|','
string|"'kvm'"
op|','
string|"'hvm'"
op|')'
op|']'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'capabilities'"
op|':'
name|'capabilities'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_image_properties_filter_fails_different_inst_props
dedent|''
name|'def'
name|'test_image_properties_filter_fails_different_inst_props'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'ImagePropertiesFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'img_props'
op|'='
op|'{'
string|"'properties'"
op|':'
op|'{'
string|"'architecture'"
op|':'
string|"'arm'"
op|','
nl|'\n'
string|"'hypervisor_type'"
op|':'
string|"'qemu'"
op|','
nl|'\n'
string|"'vm_mode'"
op|':'
string|"'hvm'"
op|'}'
op|'}'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'request_spec'"
op|':'
op|'{'
string|"'image'"
op|':'
name|'img_props'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|','
nl|'\n'
string|"'supported_instances'"
op|':'
op|'['
nl|'\n'
op|'('
string|"'x86_64'"
op|','
string|"'kvm'"
op|','
string|"'hvm'"
op|')'
op|']'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'capabilities'"
op|':'
name|'capabilities'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_image_properties_filter_passes_partial_inst_props
dedent|''
name|'def'
name|'test_image_properties_filter_passes_partial_inst_props'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'ImagePropertiesFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'img_props'
op|'='
op|'{'
string|"'properties'"
op|':'
op|'{'
string|"'architecture'"
op|':'
string|"'x86_64'"
op|','
nl|'\n'
string|"'vm_mode'"
op|':'
string|"'hvm'"
op|'}'
op|'}'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'request_spec'"
op|':'
op|'{'
string|"'image'"
op|':'
name|'img_props'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|','
nl|'\n'
string|"'supported_instances'"
op|':'
op|'['
nl|'\n'
op|'('
string|"'x86_64'"
op|','
string|"'kvm'"
op|','
string|"'hvm'"
op|')'
op|']'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'capabilities'"
op|':'
name|'capabilities'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_image_properties_filter_fails_partial_inst_props
dedent|''
name|'def'
name|'test_image_properties_filter_fails_partial_inst_props'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'ImagePropertiesFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'img_props'
op|'='
op|'{'
string|"'properties'"
op|':'
op|'{'
string|"'architecture'"
op|':'
string|"'x86_64'"
op|','
nl|'\n'
string|"'vm_mode'"
op|':'
string|"'hvm'"
op|'}'
op|'}'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'request_spec'"
op|':'
op|'{'
string|"'image'"
op|':'
name|'img_props'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|','
nl|'\n'
string|"'supported_instances'"
op|':'
op|'['
nl|'\n'
op|'('
string|"'x86_64'"
op|','
string|"'xen'"
op|','
string|"'xen'"
op|')'
op|']'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'capabilities'"
op|':'
name|'capabilities'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_image_properties_filter_passes_without_inst_props
dedent|''
name|'def'
name|'test_image_properties_filter_passes_without_inst_props'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'ImagePropertiesFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'request_spec'"
op|':'
op|'{'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|','
nl|'\n'
string|"'supported_instances'"
op|':'
op|'['
nl|'\n'
op|'('
string|"'x86_64'"
op|','
string|"'kvm'"
op|','
string|"'hvm'"
op|')'
op|']'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'capabilities'"
op|':'
name|'capabilities'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_image_properties_filter_fails_without_host_props
dedent|''
name|'def'
name|'test_image_properties_filter_fails_without_host_props'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'ImagePropertiesFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'img_props'
op|'='
op|'{'
string|"'properties'"
op|':'
op|'{'
string|"'architecture'"
op|':'
string|"'x86_64'"
op|','
nl|'\n'
string|"'hypervisor_type'"
op|':'
string|"'kvm'"
op|','
nl|'\n'
string|"'vm_mode'"
op|':'
string|"'hvm'"
op|'}'
op|'}'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'request_spec'"
op|':'
op|'{'
string|"'image'"
op|':'
name|'img_props'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'capabilities'"
op|':'
name|'capabilities'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_do_test_compute_filter_extra_specs
dedent|''
name|'def'
name|'_do_test_compute_filter_extra_specs'
op|'('
name|'self'
op|','
name|'ecaps'
op|','
name|'especs'
op|','
name|'passes'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""In real Openstack runtime environment,compute capabilities\n        value may be number, so we should use number to do unit test.\n        """'
newline|'\n'
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'ComputeCapabilitiesFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'capabilities'
op|'.'
name|'update'
op|'('
name|'ecaps'
op|')'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'extra_specs'"
op|':'
name|'especs'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1024'
op|','
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
nl|'\n'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'assertion'
op|'='
name|'self'
op|'.'
name|'assertTrue'
name|'if'
name|'passes'
name|'else'
name|'self'
op|'.'
name|'assertFalse'
newline|'\n'
name|'assertion'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_filter_passes_extra_specs_simple
dedent|''
name|'def'
name|'test_compute_filter_passes_extra_specs_simple'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_test_compute_filter_extra_specs'
op|'('
nl|'\n'
name|'ecaps'
op|'='
op|'{'
string|"'opt1'"
op|':'
number|'1'
op|','
string|"'opt2'"
op|':'
number|'2'
op|'}'
op|','
nl|'\n'
name|'especs'
op|'='
op|'{'
string|"'opt1'"
op|':'
string|"'1'"
op|','
string|"'opt2'"
op|':'
string|"'2'"
op|','
string|"'trust:trusted_host'"
op|':'
string|"'true'"
op|'}'
op|','
nl|'\n'
name|'passes'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_filter_fails_extra_specs_simple
dedent|''
name|'def'
name|'test_compute_filter_fails_extra_specs_simple'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_test_compute_filter_extra_specs'
op|'('
nl|'\n'
name|'ecaps'
op|'='
op|'{'
string|"'opt1'"
op|':'
number|'1'
op|','
string|"'opt2'"
op|':'
number|'2'
op|'}'
op|','
nl|'\n'
name|'especs'
op|'='
op|'{'
string|"'opt1'"
op|':'
string|"'1'"
op|','
string|"'opt2'"
op|':'
string|"'222'"
op|','
string|"'trust:trusted_host'"
op|':'
string|"'true'"
op|'}'
op|','
nl|'\n'
name|'passes'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_filter_pass_extra_specs_simple_with_scope
dedent|''
name|'def'
name|'test_compute_filter_pass_extra_specs_simple_with_scope'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_test_compute_filter_extra_specs'
op|'('
nl|'\n'
name|'ecaps'
op|'='
op|'{'
string|"'opt1'"
op|':'
number|'1'
op|','
string|"'opt2'"
op|':'
number|'2'
op|'}'
op|','
nl|'\n'
name|'especs'
op|'='
op|'{'
string|"'capabilities:opt1'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'trust:trusted_host'"
op|':'
string|"'true'"
op|'}'
op|','
nl|'\n'
name|'passes'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_filter_extra_specs_simple_with_wrong_scope
dedent|''
name|'def'
name|'test_compute_filter_extra_specs_simple_with_wrong_scope'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_test_compute_filter_extra_specs'
op|'('
nl|'\n'
name|'ecaps'
op|'='
op|'{'
string|"'opt1'"
op|':'
number|'1'
op|','
string|"'opt2'"
op|':'
number|'2'
op|'}'
op|','
nl|'\n'
name|'especs'
op|'='
op|'{'
string|"'wrong_scope:opt1'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'trust:trusted_host'"
op|':'
string|"'true'"
op|'}'
op|','
nl|'\n'
name|'passes'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_compute_filter_extra_specs_pass_multi_level_with_scope
dedent|''
name|'def'
name|'test_compute_filter_extra_specs_pass_multi_level_with_scope'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_test_compute_filter_extra_specs'
op|'('
nl|'\n'
name|'ecaps'
op|'='
op|'{'
string|"'opt1'"
op|':'
op|'{'
string|"'a'"
op|':'
number|'1'
op|','
string|"'b'"
op|':'
op|'{'
string|"'aa'"
op|':'
number|'2'
op|'}'
op|'}'
op|','
string|"'opt2'"
op|':'
number|'2'
op|'}'
op|','
nl|'\n'
name|'especs'
op|'='
op|'{'
string|"'opt1:a'"
op|':'
string|"'1'"
op|','
string|"'capabilities:opt1:b:aa'"
op|':'
string|"'2'"
op|','
nl|'\n'
string|"'trust:trusted_host'"
op|':'
string|"'true'"
op|'}'
op|','
nl|'\n'
name|'passes'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_filter_passes_no_extra_specs
dedent|''
name|'def'
name|'test_aggregate_filter_passes_no_extra_specs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AggregateInstanceExtraSpecsFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|','
string|"'opt1'"
op|':'
number|'1'
op|','
string|"'opt2'"
op|':'
number|'2'
op|'}'
newline|'\n'
nl|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
string|"'instance_type'"
op|':'
nl|'\n'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'capabilities'"
op|':'
name|'capabilities'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_create_aggregate_with_host
dedent|''
name|'def'
name|'_create_aggregate_with_host'
op|'('
name|'self'
op|','
name|'name'
op|'='
string|"'fake_aggregate'"
op|','
nl|'\n'
name|'metadata'
op|'='
name|'None'
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
string|"'host1'"
op|']'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'values'
op|'='
op|'{'
string|"'name'"
op|':'
name|'name'
op|'}'
newline|'\n'
name|'if'
name|'metadata'
op|':'
newline|'\n'
indent|'            '
name|'metadata'
op|'['
string|"'availability_zone'"
op|']'
op|'='
string|"'fake_avail_zone'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'metadata'
op|'='
op|'{'
string|"'availability_zone'"
op|':'
string|"'fake_avail_zone'"
op|'}'
newline|'\n'
dedent|''
name|'result'
op|'='
name|'db'
op|'.'
name|'aggregate_create'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
name|'values'
op|','
name|'metadata'
op|')'
newline|'\n'
name|'for'
name|'host'
name|'in'
name|'hosts'
op|':'
newline|'\n'
indent|'            '
name|'db'
op|'.'
name|'aggregate_host_add'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
name|'result'
op|'['
string|"'id'"
op|']'
op|','
name|'host'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'result'
newline|'\n'
nl|'\n'
DECL|member|_do_test_aggregate_filter_extra_specs
dedent|''
name|'def'
name|'_do_test_aggregate_filter_extra_specs'
op|'('
name|'self'
op|','
name|'emeta'
op|','
name|'especs'
op|','
name|'passes'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AggregateInstanceExtraSpecsFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'name'
op|'='
string|"'fake2'"
op|','
name|'metadata'
op|'='
name|'emeta'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
string|"'extra_specs'"
op|':'
name|'especs'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1024'
op|'}'
op|')'
newline|'\n'
name|'assertion'
op|'='
name|'self'
op|'.'
name|'assertTrue'
name|'if'
name|'passes'
name|'else'
name|'self'
op|'.'
name|'assertFalse'
newline|'\n'
name|'assertion'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_filter_fails_extra_specs_deleted_host
dedent|''
name|'def'
name|'test_aggregate_filter_fails_extra_specs_deleted_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AggregateInstanceExtraSpecsFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'extra_specs'
op|'='
op|'{'
string|"'opt1'"
op|':'
string|"'s== 1'"
op|','
string|"'opt2'"
op|':'
string|"'s== 2'"
op|','
nl|'\n'
string|"'trust:trusted_host'"
op|':'
string|"'true'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'metadata'
op|'='
op|'{'
string|"'opt1'"
op|':'
string|"'1'"
op|'}'
op|')'
newline|'\n'
name|'agg2'
op|'='
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'name'
op|'='
string|"'fake2'"
op|','
nl|'\n'
name|'metadata'
op|'='
op|'{'
string|"'opt2'"
op|':'
string|"'2'"
op|'}'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
string|"'instance_type'"
op|':'
nl|'\n'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
string|"'extra_specs'"
op|':'
name|'extra_specs'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1024'
op|'}'
op|')'
newline|'\n'
name|'db'
op|'.'
name|'aggregate_host_delete'
op|'('
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
name|'agg2'
op|'['
string|"'id'"
op|']'
op|','
string|"'host1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_filter_passes_extra_specs_simple
dedent|''
name|'def'
name|'test_aggregate_filter_passes_extra_specs_simple'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_test_aggregate_filter_extra_specs'
op|'('
nl|'\n'
name|'emeta'
op|'='
op|'{'
string|"'opt1'"
op|':'
string|"'1'"
op|','
string|"'opt2'"
op|':'
string|"'2'"
op|'}'
op|','
nl|'\n'
name|'especs'
op|'='
op|'{'
string|"'opt1'"
op|':'
string|"'1'"
op|','
string|"'opt2'"
op|':'
string|"'2'"
op|','
nl|'\n'
string|"'trust:trusted_host'"
op|':'
string|"'true'"
op|'}'
op|','
nl|'\n'
name|'passes'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_filter_fails_extra_specs_simple
dedent|''
name|'def'
name|'test_aggregate_filter_fails_extra_specs_simple'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_test_aggregate_filter_extra_specs'
op|'('
nl|'\n'
name|'emeta'
op|'='
op|'{'
string|"'opt1'"
op|':'
string|"'1'"
op|','
string|"'opt2'"
op|':'
string|"'2'"
op|'}'
op|','
nl|'\n'
name|'especs'
op|'='
op|'{'
string|"'opt1'"
op|':'
string|"'1'"
op|','
string|"'opt2'"
op|':'
string|"'222'"
op|','
nl|'\n'
string|"'trust:trusted_host'"
op|':'
string|"'true'"
op|'}'
op|','
nl|'\n'
name|'passes'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_do_test_isolated_hosts
dedent|''
name|'def'
name|'_do_test_isolated_hosts'
op|'('
name|'self'
op|','
name|'host_in_list'
op|','
name|'image_in_list'
op|','
nl|'\n'
name|'set_flags'
op|'='
name|'True'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'set_flags'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'flags'
op|'('
name|'isolated_images'
op|'='
op|'['
string|"'isolated_image'"
op|']'
op|','
nl|'\n'
name|'isolated_hosts'
op|'='
op|'['
string|"'isolated_host'"
op|']'
op|')'
newline|'\n'
dedent|''
name|'host_name'
op|'='
string|"'isolated_host'"
name|'if'
name|'host_in_list'
name|'else'
string|"'free_host'"
newline|'\n'
name|'image_ref'
op|'='
string|"'isolated_image'"
name|'if'
name|'image_in_list'
name|'else'
string|"'free_image'"
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
nl|'\n'
string|"'request_spec'"
op|':'
op|'{'
nl|'\n'
string|"'instance_properties'"
op|':'
op|'{'
string|"'image_ref'"
op|':'
name|'image_ref'
op|'}'
nl|'\n'
op|'}'
nl|'\n'
op|'}'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'IsolatedHostsFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
name|'host_name'
op|','
string|"'node'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_isolated_hosts_fails_isolated_on_non_isolated
dedent|''
name|'def'
name|'test_isolated_hosts_fails_isolated_on_non_isolated'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'False'
op|','
name|'True'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_isolated_hosts_fails_non_isolated_on_isolated
dedent|''
name|'def'
name|'test_isolated_hosts_fails_non_isolated_on_isolated'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'True'
op|','
name|'False'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_isolated_hosts_passes_isolated_on_isolated
dedent|''
name|'def'
name|'test_isolated_hosts_passes_isolated_on_isolated'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'True'
op|','
name|'True'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_isolated_hosts_passes_non_isolated_on_non_isolated
dedent|''
name|'def'
name|'test_isolated_hosts_passes_non_isolated_on_non_isolated'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'False'
op|','
name|'False'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_isolated_hosts_no_config
dedent|''
name|'def'
name|'test_isolated_hosts_no_config'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# If there are no hosts nor isolated images in the config, it should'
nl|'\n'
comment|'# not filter at all. This is the default config.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'False'
op|','
name|'True'
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'True'
op|','
name|'False'
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'True'
op|','
name|'True'
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'False'
op|','
name|'False'
op|','
name|'False'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_isolated_hosts_no_hosts_config
dedent|''
name|'def'
name|'test_isolated_hosts_no_hosts_config'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'isolated_images'
op|'='
op|'['
string|"'isolated_image'"
op|']'
op|')'
newline|'\n'
comment|'# If there are no hosts in the config, it should only filter out'
nl|'\n'
comment|'# images that are listed'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'False'
op|','
name|'True'
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'True'
op|','
name|'False'
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'True'
op|','
name|'True'
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'False'
op|','
name|'False'
op|','
name|'False'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_isolated_hosts_no_images_config
dedent|''
name|'def'
name|'test_isolated_hosts_no_images_config'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'isolated_hosts'
op|'='
op|'['
string|"'isolated_host'"
op|']'
op|')'
newline|'\n'
comment|'# If there are no images in the config, it should only filter out'
nl|'\n'
comment|'# isolated_hosts'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'False'
op|','
name|'True'
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'True'
op|','
name|'False'
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'True'
op|','
name|'True'
op|','
name|'False'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_do_test_isolated_hosts'
op|'('
name|'False'
op|','
name|'False'
op|','
name|'False'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_json_filter_passes
dedent|''
name|'def'
name|'test_json_filter_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'JsonFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'root_gb'"
op|':'
number|'200'
op|','
nl|'\n'
string|"'ephemeral_gb'"
op|':'
number|'0'
op|'}'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
string|"'query'"
op|':'
name|'self'
op|'.'
name|'json_query'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'free_disk_mb'"
op|':'
number|'200'
op|'*'
number|'1024'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_json_filter_passes_with_no_query
dedent|''
name|'def'
name|'test_json_filter_passes_with_no_query'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'JsonFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'root_gb'"
op|':'
number|'200'
op|','
nl|'\n'
string|"'ephemeral_gb'"
op|':'
number|'0'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'free_disk_mb'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_json_filter_fails_on_memory
dedent|''
name|'def'
name|'test_json_filter_fails_on_memory'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'JsonFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'root_gb'"
op|':'
number|'200'
op|','
nl|'\n'
string|"'ephemeral_gb'"
op|':'
number|'0'
op|'}'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
string|"'query'"
op|':'
name|'self'
op|'.'
name|'json_query'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1023'
op|','
nl|'\n'
string|"'free_disk_mb'"
op|':'
number|'200'
op|'*'
number|'1024'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_json_filter_fails_on_disk
dedent|''
name|'def'
name|'test_json_filter_fails_on_disk'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'JsonFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'root_gb'"
op|':'
number|'200'
op|','
nl|'\n'
string|"'ephemeral_gb'"
op|':'
number|'0'
op|'}'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
string|"'query'"
op|':'
name|'self'
op|'.'
name|'json_query'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'free_disk_mb'"
op|':'
op|'('
number|'200'
op|'*'
number|'1024'
op|')'
op|'-'
number|'1'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_json_filter_fails_on_caps_disabled
dedent|''
name|'def'
name|'test_json_filter_fails_on_caps_disabled'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'JsonFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'json_query'
op|'='
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
nl|'\n'
op|'['
string|"'and'"
op|','
op|'['
string|"'>='"
op|','
string|"'$free_ram_mb'"
op|','
number|'1024'
op|']'
op|','
nl|'\n'
op|'['
string|"'>='"
op|','
string|"'$free_disk_mb'"
op|','
number|'200'
op|'*'
number|'1024'
op|']'
op|','
nl|'\n'
string|"'$capabilities.enabled'"
op|']'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'root_gb'"
op|':'
number|'200'
op|','
nl|'\n'
string|"'ephemeral_gb'"
op|':'
number|'0'
op|'}'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
string|"'query'"
op|':'
name|'json_query'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'free_disk_mb'"
op|':'
number|'200'
op|'*'
number|'1024'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_json_filter_fails_on_service_disabled
dedent|''
name|'def'
name|'test_json_filter_fails_on_service_disabled'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'JsonFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'json_query'
op|'='
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
nl|'\n'
op|'['
string|"'and'"
op|','
op|'['
string|"'>='"
op|','
string|"'$free_ram_mb'"
op|','
number|'1024'
op|']'
op|','
nl|'\n'
op|'['
string|"'>='"
op|','
string|"'$free_disk_mb'"
op|','
number|'200'
op|'*'
number|'1024'
op|']'
op|','
nl|'\n'
op|'['
string|"'not'"
op|','
string|"'$service.disabled'"
op|']'
op|']'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'local_gb'"
op|':'
number|'200'
op|'}'
op|','
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
string|"'query'"
op|':'
name|'json_query'
op|'}'
op|'}'
newline|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'free_disk_mb'"
op|':'
number|'200'
op|'*'
number|'1024'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_json_filter_happy_day
dedent|''
name|'def'
name|'test_json_filter_happy_day'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test json filter more thoroughly.'
nl|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'JsonFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'raw'
op|'='
op|'['
string|"'and'"
op|','
nl|'\n'
string|"'$capabilities.enabled'"
op|','
nl|'\n'
op|'['
string|"'='"
op|','
string|"'$capabilities.opt1'"
op|','
string|"'match'"
op|']'
op|','
nl|'\n'
op|'['
string|"'or'"
op|','
nl|'\n'
op|'['
string|"'and'"
op|','
nl|'\n'
op|'['
string|"'<'"
op|','
string|"'$free_ram_mb'"
op|','
number|'30'
op|']'
op|','
nl|'\n'
op|'['
string|"'<'"
op|','
string|"'$free_disk_mb'"
op|','
number|'300'
op|']'
op|']'
op|','
nl|'\n'
op|'['
string|"'and'"
op|','
nl|'\n'
op|'['
string|"'>'"
op|','
string|"'$free_ram_mb'"
op|','
number|'30'
op|']'
op|','
nl|'\n'
op|'['
string|"'>'"
op|','
string|"'$free_disk_mb'"
op|','
number|'300'
op|']'
op|']'
op|']'
op|']'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'query'"
op|':'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
name|'raw'
op|')'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
comment|'# Passes'
nl|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|','
string|"'opt1'"
op|':'
string|"'match'"
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'10'
op|','
nl|'\n'
string|"'free_disk_mb'"
op|':'
number|'200'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
nl|'\n'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# Passes'
nl|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|','
string|"'opt1'"
op|':'
string|"'match'"
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'40'
op|','
nl|'\n'
string|"'free_disk_mb'"
op|':'
number|'400'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
nl|'\n'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# Fails due to capabilities being disabled'
nl|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'False'
op|','
string|"'opt1'"
op|':'
string|"'match'"
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'40'
op|','
nl|'\n'
string|"'free_disk_mb'"
op|':'
number|'400'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
nl|'\n'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|"# Fails due to being exact memory/disk we don't want"
nl|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|','
string|"'opt1'"
op|':'
string|"'match'"
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'30'
op|','
nl|'\n'
string|"'free_disk_mb'"
op|':'
number|'300'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
nl|'\n'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# Fails due to memory lower but disk higher'
nl|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|','
string|"'opt1'"
op|':'
string|"'match'"
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'disabled'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'20'
op|','
nl|'\n'
string|"'free_disk_mb'"
op|':'
number|'400'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
nl|'\n'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|"# Fails due to capabilities 'opt1' not equal"
nl|'\n'
name|'capabilities'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|','
string|"'opt1'"
op|':'
string|"'no-match'"
op|'}'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'free_ram_mb'"
op|':'
number|'20'
op|','
nl|'\n'
string|"'free_disk_mb'"
op|':'
number|'400'
op|','
nl|'\n'
string|"'capabilities'"
op|':'
name|'capabilities'
op|','
nl|'\n'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_json_filter_basic_operators
dedent|''
name|'def'
name|'test_json_filter_basic_operators'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'JsonFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'capabilities'"
op|':'
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
op|'}'
op|')'
newline|'\n'
comment|'# (operator, arguments, expected_result)'
nl|'\n'
name|'ops_to_test'
op|'='
op|'['
nl|'\n'
op|'['
string|"'='"
op|','
op|'['
number|'1'
op|','
number|'1'
op|']'
op|','
name|'True'
op|']'
op|','
nl|'\n'
op|'['
string|"'='"
op|','
op|'['
number|'1'
op|','
number|'2'
op|']'
op|','
name|'False'
op|']'
op|','
nl|'\n'
op|'['
string|"'<'"
op|','
op|'['
number|'1'
op|','
number|'2'
op|']'
op|','
name|'True'
op|']'
op|','
nl|'\n'
op|'['
string|"'<'"
op|','
op|'['
number|'1'
op|','
number|'1'
op|']'
op|','
name|'False'
op|']'
op|','
nl|'\n'
op|'['
string|"'<'"
op|','
op|'['
number|'2'
op|','
number|'1'
op|']'
op|','
name|'False'
op|']'
op|','
nl|'\n'
op|'['
string|"'>'"
op|','
op|'['
number|'2'
op|','
number|'1'
op|']'
op|','
name|'True'
op|']'
op|','
nl|'\n'
op|'['
string|"'>'"
op|','
op|'['
number|'2'
op|','
number|'2'
op|']'
op|','
name|'False'
op|']'
op|','
nl|'\n'
op|'['
string|"'>'"
op|','
op|'['
number|'2'
op|','
number|'3'
op|']'
op|','
name|'False'
op|']'
op|','
nl|'\n'
op|'['
string|"'<='"
op|','
op|'['
number|'1'
op|','
number|'2'
op|']'
op|','
name|'True'
op|']'
op|','
nl|'\n'
op|'['
string|"'<='"
op|','
op|'['
number|'1'
op|','
number|'1'
op|']'
op|','
name|'True'
op|']'
op|','
nl|'\n'
op|'['
string|"'<='"
op|','
op|'['
number|'2'
op|','
number|'1'
op|']'
op|','
name|'False'
op|']'
op|','
nl|'\n'
op|'['
string|"'>='"
op|','
op|'['
number|'2'
op|','
number|'1'
op|']'
op|','
name|'True'
op|']'
op|','
nl|'\n'
op|'['
string|"'>='"
op|','
op|'['
number|'2'
op|','
number|'2'
op|']'
op|','
name|'True'
op|']'
op|','
nl|'\n'
op|'['
string|"'>='"
op|','
op|'['
number|'2'
op|','
number|'3'
op|']'
op|','
name|'False'
op|']'
op|','
nl|'\n'
op|'['
string|"'in'"
op|','
op|'['
number|'1'
op|','
number|'1'
op|']'
op|','
name|'True'
op|']'
op|','
nl|'\n'
op|'['
string|"'in'"
op|','
op|'['
number|'1'
op|','
number|'1'
op|','
number|'2'
op|','
number|'3'
op|']'
op|','
name|'True'
op|']'
op|','
nl|'\n'
op|'['
string|"'in'"
op|','
op|'['
number|'4'
op|','
number|'1'
op|','
number|'2'
op|','
number|'3'
op|']'
op|','
name|'False'
op|']'
op|','
nl|'\n'
op|'['
string|"'not'"
op|','
op|'['
name|'True'
op|']'
op|','
name|'False'
op|']'
op|','
nl|'\n'
op|'['
string|"'not'"
op|','
op|'['
name|'False'
op|']'
op|','
name|'True'
op|']'
op|','
nl|'\n'
op|'['
string|"'or'"
op|','
op|'['
name|'True'
op|','
name|'False'
op|']'
op|','
name|'True'
op|']'
op|','
nl|'\n'
op|'['
string|"'or'"
op|','
op|'['
name|'False'
op|','
name|'False'
op|']'
op|','
name|'False'
op|']'
op|','
nl|'\n'
op|'['
string|"'and'"
op|','
op|'['
name|'True'
op|','
name|'True'
op|']'
op|','
name|'True'
op|']'
op|','
nl|'\n'
op|'['
string|"'and'"
op|','
op|'['
name|'False'
op|','
name|'False'
op|']'
op|','
name|'False'
op|']'
op|','
nl|'\n'
op|'['
string|"'and'"
op|','
op|'['
name|'True'
op|','
name|'False'
op|']'
op|','
name|'False'
op|']'
op|','
nl|'\n'
comment|'# Nested ((True or False) and (2 > 1)) == Passes'
nl|'\n'
op|'['
string|"'and'"
op|','
op|'['
op|'['
string|"'or'"
op|','
name|'True'
op|','
name|'False'
op|']'
op|','
op|'['
string|"'>'"
op|','
number|'2'
op|','
number|'1'
op|']'
op|']'
op|','
name|'True'
op|']'
op|']'
newline|'\n'
nl|'\n'
name|'for'
op|'('
name|'op'
op|','
name|'args'
op|','
name|'expected'
op|')'
name|'in'
name|'ops_to_test'
op|':'
newline|'\n'
indent|'            '
name|'raw'
op|'='
op|'['
name|'op'
op|']'
op|'+'
name|'args'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'query'"
op|':'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
name|'raw'
op|')'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
nl|'\n'
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# This results in [False, True, False, True] and if any are True'
nl|'\n'
comment|'# then it passes...'
nl|'\n'
dedent|''
name|'raw'
op|'='
op|'['
string|"'not'"
op|','
name|'True'
op|','
name|'False'
op|','
name|'True'
op|','
name|'False'
op|']'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'query'"
op|':'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
name|'raw'
op|')'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# This results in [False, False, False] and if any are True'
nl|'\n'
comment|"# then it passes...which this doesn't"
nl|'\n'
name|'raw'
op|'='
op|'['
string|"'not'"
op|','
name|'True'
op|','
name|'True'
op|','
name|'True'
op|']'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'query'"
op|':'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
name|'raw'
op|')'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_json_filter_unknown_operator_raises
dedent|''
name|'def'
name|'test_json_filter_unknown_operator_raises'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'JsonFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'raw'
op|'='
op|'['
string|"'!='"
op|','
number|'1'
op|','
number|'2'
op|']'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'query'"
op|':'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
name|'raw'
op|')'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'capabilities'"
op|':'
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'KeyError'
op|','
nl|'\n'
name|'filt_cls'
op|'.'
name|'host_passes'
op|','
name|'host'
op|','
name|'filter_properties'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_json_filter_empty_filters_pass
dedent|''
name|'def'
name|'test_json_filter_empty_filters_pass'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'JsonFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'capabilities'"
op|':'
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'raw'
op|'='
op|'['
op|']'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'query'"
op|':'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
name|'raw'
op|')'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
name|'raw'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'query'"
op|':'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
name|'raw'
op|')'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_json_filter_invalid_num_arguments_fails
dedent|''
name|'def'
name|'test_json_filter_invalid_num_arguments_fails'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'JsonFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'capabilities'"
op|':'
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'raw'
op|'='
op|'['
string|"'>'"
op|','
op|'['
string|"'and'"
op|','
op|'['
string|"'or'"
op|','
op|'['
string|"'not'"
op|','
op|'['
string|"'<'"
op|','
op|'['
string|"'>='"
op|','
op|'['
string|"'<='"
op|','
op|'['
string|"'in'"
op|','
op|']'
op|']'
op|']'
op|']'
op|']'
op|']'
op|']'
op|']'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'query'"
op|':'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
name|'raw'
op|')'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'raw'
op|'='
op|'['
string|"'>'"
op|','
number|'1'
op|']'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'query'"
op|':'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
name|'raw'
op|')'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_json_filter_unknown_variable_ignored
dedent|''
name|'def'
name|'test_json_filter_unknown_variable_ignored'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'JsonFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'capabilities'"
op|':'
op|'{'
string|"'enabled'"
op|':'
name|'True'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'raw'
op|'='
op|'['
string|"'='"
op|','
string|"'$........'"
op|','
number|'1'
op|','
number|'1'
op|']'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'query'"
op|':'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
name|'raw'
op|')'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'raw'
op|'='
op|'['
string|"'='"
op|','
string|"'$foo'"
op|','
number|'2'
op|','
number|'2'
op|']'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
nl|'\n'
string|"'scheduler_hints'"
op|':'
op|'{'
nl|'\n'
string|"'query'"
op|':'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
name|'raw'
op|')'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_trusted_filter_default_passes
dedent|''
name|'def'
name|'test_trusted_filter_default_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'TrustedFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_trusted_filter_trusted_and_trusted_passes
dedent|''
name|'def'
name|'test_trusted_filter_trusted_and_trusted_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'oat_data'
op|'='
op|'{'
string|'"hosts"'
op|':'
op|'['
op|'{'
string|'"host_name"'
op|':'
string|'"host1"'
op|','
nl|'\n'
string|'"trust_lvl"'
op|':'
string|'"trusted"'
op|','
nl|'\n'
string|'"vtime"'
op|':'
name|'timeutils'
op|'.'
name|'isotime'
op|'('
op|')'
op|'}'
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'TrustedFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'extra_specs'
op|'='
op|'{'
string|"'trust:trusted_host'"
op|':'
string|"'trusted'"
op|'}'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'extra_specs'"
op|':'
name|'extra_specs'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_trusted_filter_trusted_and_untrusted_fails
dedent|''
name|'def'
name|'test_trusted_filter_trusted_and_untrusted_fails'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'oat_data'
op|'='
op|'{'
string|'"hosts"'
op|':'
op|'['
op|'{'
string|'"host_name"'
op|':'
string|'"host1"'
op|','
nl|'\n'
string|'"trust_lvl"'
op|':'
string|'"untrusted"'
op|','
nl|'\n'
string|'"vtime"'
op|':'
name|'timeutils'
op|'.'
name|'isotime'
op|'('
op|')'
op|'}'
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'TrustedFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'extra_specs'
op|'='
op|'{'
string|"'trust:trusted_host'"
op|':'
string|"'trusted'"
op|'}'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'extra_specs'"
op|':'
name|'extra_specs'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_trusted_filter_untrusted_and_trusted_fails
dedent|''
name|'def'
name|'test_trusted_filter_untrusted_and_trusted_fails'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'oat_data'
op|'='
op|'{'
string|'"hosts"'
op|':'
op|'['
op|'{'
string|'"host_name"'
op|':'
string|'"host1"'
op|','
nl|'\n'
string|'"trust_lvl"'
op|':'
string|'"trusted"'
op|','
nl|'\n'
string|'"vtime"'
op|':'
name|'timeutils'
op|'.'
name|'isotime'
op|'('
op|')'
op|'}'
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'TrustedFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'extra_specs'
op|'='
op|'{'
string|"'trust:trusted_host'"
op|':'
string|"'untrusted'"
op|'}'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'extra_specs'"
op|':'
name|'extra_specs'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_trusted_filter_untrusted_and_untrusted_passes
dedent|''
name|'def'
name|'test_trusted_filter_untrusted_and_untrusted_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'oat_data'
op|'='
op|'{'
string|'"hosts"'
op|':'
op|'['
op|'{'
string|'"host_name"'
op|':'
string|'"host1"'
op|','
nl|'\n'
string|'"trust_lvl"'
op|':'
string|'"untrusted"'
op|','
nl|'\n'
string|'"vtime"'
op|':'
name|'timeutils'
op|'.'
name|'isotime'
op|'('
op|')'
op|'}'
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'TrustedFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'extra_specs'
op|'='
op|'{'
string|"'trust:trusted_host'"
op|':'
string|"'untrusted'"
op|'}'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'extra_specs'"
op|':'
name|'extra_specs'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_trusted_filter_update_cache
dedent|''
name|'def'
name|'test_trusted_filter_update_cache'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'oat_data'
op|'='
op|'{'
string|'"hosts"'
op|':'
op|'['
op|'{'
string|'"host_name"'
op|':'
nl|'\n'
string|'"host1"'
op|','
string|'"trust_lvl"'
op|':'
string|'"untrusted"'
op|','
nl|'\n'
string|'"vtime"'
op|':'
name|'timeutils'
op|'.'
name|'isotime'
op|'('
op|')'
op|'}'
op|']'
op|'}'
newline|'\n'
nl|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'TrustedFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'extra_specs'
op|'='
op|'{'
string|"'trust:trusted_host'"
op|':'
string|"'untrusted'"
op|'}'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'extra_specs'"
op|':'
name|'extra_specs'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
comment|'# Fill the caches'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'oat_attested'
op|'='
name|'False'
newline|'\n'
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'oat_attested'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'oat_attested'
op|'='
name|'False'
newline|'\n'
nl|'\n'
name|'timeutils'
op|'.'
name|'set_time_override'
op|'('
name|'timeutils'
op|'.'
name|'utcnow'
op|'('
op|')'
op|')'
newline|'\n'
name|'timeutils'
op|'.'
name|'advance_time_seconds'
op|'('
nl|'\n'
name|'CONF'
op|'.'
name|'trusted_computing'
op|'.'
name|'attestation_auth_timeout'
op|'+'
number|'80'
op|')'
newline|'\n'
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'oat_attested'
op|')'
newline|'\n'
nl|'\n'
name|'timeutils'
op|'.'
name|'clear_time_override'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_trusted_filter_update_cache_timezone
dedent|''
name|'def'
name|'test_trusted_filter_update_cache_timezone'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'oat_data'
op|'='
op|'{'
string|'"hosts"'
op|':'
op|'['
op|'{'
string|'"host_name"'
op|':'
string|'"host1"'
op|','
nl|'\n'
string|'"trust_lvl"'
op|':'
string|'"untrusted"'
op|','
nl|'\n'
string|'"vtime"'
op|':'
string|'"2012-09-09T05:10:40-04:00"'
op|'}'
op|']'
op|'}'
newline|'\n'
nl|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'TrustedFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'extra_specs'
op|'='
op|'{'
string|"'trust:trusted_host'"
op|':'
string|"'untrusted'"
op|'}'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|'.'
name|'elevated'
op|'('
op|')'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'extra_specs'"
op|':'
name|'extra_specs'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'timeutils'
op|'.'
name|'set_time_override'
op|'('
nl|'\n'
name|'timeutils'
op|'.'
name|'normalize_time'
op|'('
nl|'\n'
name|'timeutils'
op|'.'
name|'parse_isotime'
op|'('
string|'"2012-09-09T09:10:40Z"'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
comment|'# Fill the caches'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'oat_attested'
op|'='
name|'False'
newline|'\n'
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'oat_attested'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'oat_attested'
op|'='
name|'False'
newline|'\n'
name|'timeutils'
op|'.'
name|'advance_time_seconds'
op|'('
nl|'\n'
name|'CONF'
op|'.'
name|'trusted_computing'
op|'.'
name|'attestation_auth_timeout'
op|'-'
number|'10'
op|')'
newline|'\n'
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'oat_attested'
op|')'
newline|'\n'
nl|'\n'
name|'timeutils'
op|'.'
name|'clear_time_override'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_core_filter_passes
dedent|''
name|'def'
name|'test_core_filter_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'CoreFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'vcpus'"
op|':'
number|'1'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'cpu_allocation_ratio'
op|'='
number|'2'
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'vcpus_total'"
op|':'
number|'4'
op|','
string|"'vcpus_used'"
op|':'
number|'7'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_core_filter_fails_safe
dedent|''
name|'def'
name|'test_core_filter_fails_safe'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'CoreFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'vcpus'"
op|':'
number|'1'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_core_filter_fails
dedent|''
name|'def'
name|'test_core_filter_fails'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'CoreFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'instance_type'"
op|':'
op|'{'
string|"'vcpus'"
op|':'
number|'1'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'cpu_allocation_ratio'
op|'='
number|'2'
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'vcpus_total'"
op|':'
number|'4'
op|','
string|"'vcpus_used'"
op|':'
number|'8'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_core_filter_value_error
dedent|''
name|'def'
name|'test_aggregate_core_filter_value_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AggregateCoreFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'vcpus'"
op|':'
number|'1'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'cpu_allocation_ratio'
op|'='
number|'2'
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'vcpus_total'"
op|':'
number|'4'
op|','
string|"'vcpus_used'"
op|':'
number|'7'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'name'
op|'='
string|"'fake_aggregate'"
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
string|"'host1'"
op|']'
op|','
nl|'\n'
name|'metadata'
op|'='
op|'{'
string|"'cpu_allocation_ratio'"
op|':'
string|"'XXX'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'4'
op|'*'
number|'2'
op|','
name|'host'
op|'.'
name|'limits'
op|'['
string|"'vcpu'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_core_filter_default_value
dedent|''
name|'def'
name|'test_aggregate_core_filter_default_value'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AggregateCoreFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'vcpus'"
op|':'
number|'1'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'cpu_allocation_ratio'
op|'='
number|'2'
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'vcpus_total'"
op|':'
number|'4'
op|','
string|"'vcpus_used'"
op|':'
number|'8'
op|'}'
op|')'
newline|'\n'
comment|'# False: fallback to default flag w/o aggregates'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'name'
op|'='
string|"'fake_aggregate'"
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
string|"'host1'"
op|']'
op|','
nl|'\n'
name|'metadata'
op|'='
op|'{'
string|"'cpu_allocation_ratio'"
op|':'
string|"'3'"
op|'}'
op|')'
newline|'\n'
comment|'# True: use ratio from aggregates'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'4'
op|'*'
number|'3'
op|','
name|'host'
op|'.'
name|'limits'
op|'['
string|"'vcpu'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_core_filter_conflict_values
dedent|''
name|'def'
name|'test_aggregate_core_filter_conflict_values'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AggregateCoreFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'instance_type'"
op|':'
op|'{'
string|"'vcpus'"
op|':'
number|'1'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'cpu_allocation_ratio'
op|'='
number|'1'
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'vcpus_total'"
op|':'
number|'4'
op|','
string|"'vcpus_used'"
op|':'
number|'8'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'name'
op|'='
string|"'fake_aggregate1'"
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
string|"'host1'"
op|']'
op|','
nl|'\n'
name|'metadata'
op|'='
op|'{'
string|"'cpu_allocation_ratio'"
op|':'
string|"'2'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'name'
op|'='
string|"'fake_aggregate2'"
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
string|"'host1'"
op|']'
op|','
nl|'\n'
name|'metadata'
op|'='
op|'{'
string|"'cpu_allocation_ratio'"
op|':'
string|"'3'"
op|'}'
op|')'
newline|'\n'
comment|'# use the minimum ratio from aggregates'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'4'
op|'*'
number|'2'
op|','
name|'host'
op|'.'
name|'limits'
op|'['
string|"'vcpu'"
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'staticmethod'
newline|'\n'
DECL|member|_make_zone_request
name|'def'
name|'_make_zone_request'
op|'('
name|'zone'
op|','
name|'is_admin'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ctxt'
op|'='
name|'context'
op|'.'
name|'RequestContext'
op|'('
string|"'fake'"
op|','
string|"'fake'"
op|','
name|'is_admin'
op|'='
name|'is_admin'
op|')'
newline|'\n'
name|'return'
op|'{'
nl|'\n'
string|"'context'"
op|':'
name|'ctxt'
op|','
nl|'\n'
string|"'request_spec'"
op|':'
op|'{'
nl|'\n'
string|"'instance_properties'"
op|':'
op|'{'
nl|'\n'
string|"'availability_zone'"
op|':'
name|'zone'
nl|'\n'
op|'}'
nl|'\n'
op|'}'
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|test_availability_zone_filter_same
dedent|''
name|'def'
name|'test_availability_zone_filter_same'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AvailabilityZoneFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'availability_zone'"
op|':'
string|"'nova'"
op|'}'
newline|'\n'
name|'request'
op|'='
name|'self'
op|'.'
name|'_make_zone_request'
op|'('
string|"'nova'"
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'request'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_availability_zone_filter_different
dedent|''
name|'def'
name|'test_availability_zone_filter_different'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AvailabilityZoneFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'service'
op|'='
op|'{'
string|"'availability_zone'"
op|':'
string|"'nova'"
op|'}'
newline|'\n'
name|'request'
op|'='
name|'self'
op|'.'
name|'_make_zone_request'
op|'('
string|"'bad'"
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'service'"
op|':'
name|'service'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'request'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_retry_filter_disabled
dedent|''
name|'def'
name|'test_retry_filter_disabled'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test case where retry/re-scheduling is disabled.'
nl|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'RetryFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_retry_filter_pass
dedent|''
name|'def'
name|'test_retry_filter_pass'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Node not previously tried.'
nl|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'RetryFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'nodeX'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'retry'
op|'='
name|'dict'
op|'('
name|'num_attempts'
op|'='
number|'2'
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
op|'['
string|"'host1'"
op|','
string|"'node1'"
op|']'
op|','
comment|'# same host, different node'
nl|'\n'
op|'['
string|"'host2'"
op|','
string|"'node2'"
op|']'
op|','
comment|'# different host and node'
nl|'\n'
op|']'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
name|'dict'
op|'('
name|'retry'
op|'='
name|'retry'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_retry_filter_fail
dedent|''
name|'def'
name|'test_retry_filter_fail'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Node was already tried.'
nl|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'RetryFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'retry'
op|'='
name|'dict'
op|'('
name|'num_attempts'
op|'='
number|'1'
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
op|'['
string|"'host1'"
op|','
string|"'node1'"
op|']'
op|']'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
name|'dict'
op|'('
name|'retry'
op|'='
name|'retry'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_filter_num_iops_passes
dedent|''
name|'def'
name|'test_filter_num_iops_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'max_io_ops_per_host'
op|'='
number|'8'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'IoOpsFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'num_io_ops'"
op|':'
number|'7'
op|'}'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_filter_num_iops_fails
dedent|''
name|'def'
name|'test_filter_num_iops_fails'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'max_io_ops_per_host'
op|'='
number|'8'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'IoOpsFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'num_io_ops'"
op|':'
number|'8'
op|'}'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_filter_num_instances_passes
dedent|''
name|'def'
name|'test_filter_num_instances_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'max_instances_per_host'
op|'='
number|'5'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'NumInstancesFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'num_instances'"
op|':'
number|'4'
op|'}'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_filter_num_instances_fails
dedent|''
name|'def'
name|'test_filter_num_instances_fails'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'max_instances_per_host'
op|'='
number|'5'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'NumInstancesFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
nl|'\n'
op|'{'
string|"'num_instances'"
op|':'
number|'5'
op|'}'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_group_anti_affinity_filter_passes
dedent|''
name|'def'
name|'test_group_anti_affinity_filter_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'GroupAntiAffinityFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'group_hosts'"
op|':'
op|'['
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'group_hosts'"
op|':'
op|'['
string|"'host2'"
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_group_anti_affinity_filter_fails
dedent|''
name|'def'
name|'test_group_anti_affinity_filter_fails'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'GroupAntiAffinityFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'group_hosts'"
op|':'
op|'['
string|"'host1'"
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_group_affinity_filter_passes
dedent|''
name|'def'
name|'test_group_affinity_filter_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'GroupAffinityFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'group_hosts'"
op|':'
op|'['
string|"'host1'"
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_group_affinity_filter_fails
dedent|''
name|'def'
name|'test_group_affinity_filter_fails'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'GroupAffinityFilter'"
op|']'
op|'('
op|')'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'node1'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'group_hosts'"
op|':'
op|'['
string|"'host2'"
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_multi_tenancy_isolation_with_meta_passes
dedent|''
name|'def'
name|'test_aggregate_multi_tenancy_isolation_with_meta_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AggregateMultiTenancyIsolation'"
op|']'
op|'('
op|')'
newline|'\n'
name|'aggr_meta'
op|'='
op|'{'
string|"'filter_tenant_id'"
op|':'
string|"'my_tenantid'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'name'
op|'='
string|"'fake1'"
op|','
name|'metadata'
op|'='
name|'aggr_meta'
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
string|"'host1'"
op|']'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'request_spec'"
op|':'
op|'{'
nl|'\n'
string|"'instance_properties'"
op|':'
op|'{'
nl|'\n'
string|"'project_id'"
op|':'
string|"'my_tenantid'"
op|'}'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'compute'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_multi_tenancy_isolation_fails
dedent|''
name|'def'
name|'test_aggregate_multi_tenancy_isolation_fails'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AggregateMultiTenancyIsolation'"
op|']'
op|'('
op|')'
newline|'\n'
name|'aggr_meta'
op|'='
op|'{'
string|"'filter_tenant_id'"
op|':'
string|"'other_tenantid'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'name'
op|'='
string|"'fake1'"
op|','
name|'metadata'
op|'='
name|'aggr_meta'
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
string|"'host1'"
op|']'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'request_spec'"
op|':'
op|'{'
nl|'\n'
string|"'instance_properties'"
op|':'
op|'{'
nl|'\n'
string|"'project_id'"
op|':'
string|"'my_tenantid'"
op|'}'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'compute'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_aggregate_multi_tenancy_isolation_no_meta_passes
dedent|''
name|'def'
name|'test_aggregate_multi_tenancy_isolation_no_meta_passes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_stub_service_is_up'
op|'('
name|'True'
op|')'
newline|'\n'
name|'filt_cls'
op|'='
name|'self'
op|'.'
name|'class_map'
op|'['
string|"'AggregateMultiTenancyIsolation'"
op|']'
op|'('
op|')'
newline|'\n'
name|'aggr_meta'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_create_aggregate_with_host'
op|'('
name|'name'
op|'='
string|"'fake1'"
op|','
name|'metadata'
op|'='
name|'aggr_meta'
op|','
nl|'\n'
name|'hosts'
op|'='
op|'['
string|"'host1'"
op|']'
op|')'
newline|'\n'
name|'filter_properties'
op|'='
op|'{'
string|"'context'"
op|':'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
string|"'request_spec'"
op|':'
op|'{'
nl|'\n'
string|"'instance_properties'"
op|':'
op|'{'
nl|'\n'
string|"'project_id'"
op|':'
string|"'my_tenantid'"
op|'}'
op|'}'
op|'}'
newline|'\n'
name|'host'
op|'='
name|'fakes'
op|'.'
name|'FakeHostState'
op|'('
string|"'host1'"
op|','
string|"'compute'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'filt_cls'
op|'.'
name|'host_passes'
op|'('
name|'host'
op|','
name|'filter_properties'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
