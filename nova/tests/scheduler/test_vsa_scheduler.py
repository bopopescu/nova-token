begin_unit
comment|'# Copyright 2011 OpenStack LLC.'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'nova'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'context'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'flags'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'log'
name|'as'
name|'logging'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'rpc'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'utils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'volume'
name|'import'
name|'volume_types'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
op|'.'
name|'scheduler'
name|'import'
name|'vsa'
name|'as'
name|'vsa_sched'
newline|'\n'
nl|'\n'
DECL|variable|FLAGS
name|'FLAGS'
op|'='
name|'flags'
op|'.'
name|'FLAGS'
newline|'\n'
DECL|variable|LOG
name|'LOG'
op|'='
name|'logging'
op|'.'
name|'getLogger'
op|'('
string|"'nova.tests.scheduler.vsa'"
op|')'
newline|'\n'
nl|'\n'
DECL|variable|scheduled_volumes
name|'scheduled_volumes'
op|'='
op|'['
op|']'
newline|'\n'
DECL|variable|scheduled_volume
name|'scheduled_volume'
op|'='
op|'{'
op|'}'
newline|'\n'
DECL|variable|global_volume
name|'global_volume'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|fake_rpc_cast
name|'def'
name|'fake_rpc_cast'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
name|'class'
name|'FakeVsaLeastUsedScheduler'
op|'('
nl|'\n'
DECL|class|FakeVsaLeastUsedScheduler
name|'vsa_sched'
op|'.'
name|'VsaSchedulerLeastUsedHost'
op|')'
op|':'
newline|'\n'
comment|'# No need to stub anything at the moment'
nl|'\n'
indent|'    '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
name|'class'
name|'FakeVsaMostAvailCapacityScheduler'
op|'('
nl|'\n'
DECL|class|FakeVsaMostAvailCapacityScheduler
name|'vsa_sched'
op|'.'
name|'VsaSchedulerMostAvailCapacity'
op|')'
op|':'
newline|'\n'
comment|'# No need to stub anything at the moment'
nl|'\n'
indent|'    '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VsaSchedulerTestCase
dedent|''
name|'class'
name|'VsaSchedulerTestCase'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|_get_vol_creation_request
indent|'    '
name|'def'
name|'_get_vol_creation_request'
op|'('
name|'self'
op|','
name|'num_vols'
op|','
name|'drive_ix'
op|','
name|'size'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'volume_params'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'num_vols'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'            '
name|'name'
op|'='
string|"'name_'"
op|'+'
name|'str'
op|'('
name|'i'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'volume_types'
op|'.'
name|'create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'name'
op|','
nl|'\n'
name|'extra_specs'
op|'='
op|'{'
string|"'type'"
op|':'
string|"'vsa_drive'"
op|','
nl|'\n'
string|"'drive_name'"
op|':'
name|'name'
op|','
nl|'\n'
string|"'drive_type'"
op|':'
string|"'type_'"
op|'+'
name|'str'
op|'('
name|'drive_ix'
op|')'
op|','
nl|'\n'
string|"'drive_size'"
op|':'
number|'1'
op|'+'
number|'100'
op|'*'
op|'('
name|'drive_ix'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'created_types_lst'
op|'.'
name|'append'
op|'('
name|'name'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'exception'
op|'.'
name|'ApiError'
op|':'
newline|'\n'
comment|'# type is already created'
nl|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
dedent|''
name|'volume_type'
op|'='
name|'volume_types'
op|'.'
name|'get_volume_type_by_name'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'name'
op|')'
newline|'\n'
name|'volume'
op|'='
op|'{'
string|"'size'"
op|':'
name|'size'
op|','
nl|'\n'
string|"'snapshot_id'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'name'"
op|':'
string|"'vol_'"
op|'+'
name|'str'
op|'('
name|'i'
op|')'
op|','
nl|'\n'
string|"'description'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'volume_type_id'"
op|':'
name|'volume_type'
op|'['
string|"'id'"
op|']'
op|'}'
newline|'\n'
name|'volume_params'
op|'.'
name|'append'
op|'('
name|'volume'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
op|'{'
string|"'num_volumes'"
op|':'
name|'len'
op|'('
name|'volume_params'
op|')'
op|','
nl|'\n'
string|"'vsa_id'"
op|':'
number|'123'
op|','
nl|'\n'
string|"'volumes'"
op|':'
name|'volume_params'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|_generate_default_service_states
dedent|''
name|'def'
name|'_generate_default_service_states'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'service_states'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'self'
op|'.'
name|'host_num'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'host'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'hostname'
op|'='
string|"'host_'"
op|'+'
name|'str'
op|'('
name|'i'
op|')'
newline|'\n'
name|'if'
name|'hostname'
name|'in'
name|'self'
op|'.'
name|'exclude_host_list'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'host'
op|'['
string|"'volume'"
op|']'
op|'='
op|'{'
string|"'timestamp'"
op|':'
name|'utils'
op|'.'
name|'utcnow'
op|'('
op|')'
op|','
nl|'\n'
string|"'drive_qos_info'"
op|':'
op|'{'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'for'
name|'j'
name|'in'
name|'range'
op|'('
name|'self'
op|'.'
name|'drive_type_start_ix'
op|','
nl|'\n'
name|'self'
op|'.'
name|'drive_type_start_ix'
op|'+'
name|'self'
op|'.'
name|'drive_type_num'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'dtype'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'dtype'
op|'['
string|"'Name'"
op|']'
op|'='
string|"'name_'"
op|'+'
name|'str'
op|'('
name|'j'
op|')'
newline|'\n'
name|'dtype'
op|'['
string|"'DriveType'"
op|']'
op|'='
string|"'type_'"
op|'+'
name|'str'
op|'('
name|'j'
op|')'
newline|'\n'
name|'dtype'
op|'['
string|"'TotalDrives'"
op|']'
op|'='
number|'2'
op|'*'
op|'('
name|'self'
op|'.'
name|'init_num_drives'
op|'+'
name|'i'
op|')'
newline|'\n'
name|'dtype'
op|'['
string|"'DriveCapacity'"
op|']'
op|'='
name|'vsa_sched'
op|'.'
name|'GB_TO_BYTES'
op|'('
number|'1'
op|'+'
number|'100'
op|'*'
name|'j'
op|')'
newline|'\n'
name|'dtype'
op|'['
string|"'TotalCapacity'"
op|']'
op|'='
name|'dtype'
op|'['
string|"'TotalDrives'"
op|']'
op|'*'
name|'dtype'
op|'['
string|"'DriveCapacity'"
op|']'
newline|'\n'
name|'dtype'
op|'['
string|"'AvailableCapacity'"
op|']'
op|'='
op|'('
name|'dtype'
op|'['
string|"'TotalDrives'"
op|']'
op|'-'
name|'i'
op|')'
op|'*'
name|'dtype'
op|'['
string|"'DriveCapacity'"
op|']'
newline|'\n'
name|'dtype'
op|'['
string|"'DriveRpm'"
op|']'
op|'='
number|'7200'
newline|'\n'
name|'dtype'
op|'['
string|"'DifCapable'"
op|']'
op|'='
number|'0'
newline|'\n'
name|'dtype'
op|'['
string|"'SedCapable'"
op|']'
op|'='
number|'0'
newline|'\n'
name|'dtype'
op|'['
string|"'PartitionDrive'"
op|']'
op|'='
op|'{'
nl|'\n'
string|"'PartitionSize'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'NumOccupiedPartitions'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'NumFreePartitions'"
op|':'
number|'0'
op|'}'
newline|'\n'
name|'dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'='
op|'{'
nl|'\n'
string|"'NumFreeDrives'"
op|':'
name|'dtype'
op|'['
string|"'TotalDrives'"
op|']'
op|'-'
name|'i'
op|','
nl|'\n'
string|"'NumOccupiedDrives'"
op|':'
name|'i'
op|'}'
newline|'\n'
name|'host'
op|'['
string|"'volume'"
op|']'
op|'['
string|"'drive_qos_info'"
op|']'
op|'['
name|'dtype'
op|'['
string|"'Name'"
op|']'
op|']'
op|'='
name|'dtype'
newline|'\n'
nl|'\n'
dedent|''
name|'service_states'
op|'['
name|'hostname'
op|']'
op|'='
name|'host'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'service_states'
newline|'\n'
nl|'\n'
DECL|member|_print_service_states
dedent|''
name|'def'
name|'_print_service_states'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'host'
op|','
name|'host_val'
name|'in'
name|'self'
op|'.'
name|'service_states'
op|'.'
name|'iteritems'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'LOG'
op|'.'
name|'info'
op|'('
name|'_'
op|'('
string|'"Host %s"'
op|')'
op|','
name|'host'
op|')'
newline|'\n'
name|'total_used'
op|'='
number|'0'
newline|'\n'
name|'total_available'
op|'='
number|'0'
newline|'\n'
name|'qos'
op|'='
name|'host_val'
op|'['
string|"'volume'"
op|']'
op|'['
string|"'drive_qos_info'"
op|']'
newline|'\n'
nl|'\n'
name|'for'
name|'k'
op|','
name|'d'
name|'in'
name|'qos'
op|'.'
name|'iteritems'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'LOG'
op|'.'
name|'info'
op|'('
string|'"\\t%s: type %s: drives (used %2d, total %2d) "'
string|'"size %3d, total %4d, used %4d, avail %d"'
op|','
nl|'\n'
name|'k'
op|','
name|'d'
op|'['
string|"'DriveType'"
op|']'
op|','
nl|'\n'
name|'d'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumOccupiedDrives'"
op|']'
op|','
name|'d'
op|'['
string|"'TotalDrives'"
op|']'
op|','
nl|'\n'
name|'vsa_sched'
op|'.'
name|'BYTES_TO_GB'
op|'('
name|'d'
op|'['
string|"'DriveCapacity'"
op|']'
op|')'
op|','
nl|'\n'
name|'vsa_sched'
op|'.'
name|'BYTES_TO_GB'
op|'('
name|'d'
op|'['
string|"'TotalCapacity'"
op|']'
op|')'
op|','
nl|'\n'
name|'vsa_sched'
op|'.'
name|'BYTES_TO_GB'
op|'('
name|'d'
op|'['
string|"'TotalCapacity'"
op|']'
op|'-'
name|'d'
op|'['
string|"'AvailableCapacity'"
op|']'
op|')'
op|','
nl|'\n'
name|'vsa_sched'
op|'.'
name|'BYTES_TO_GB'
op|'('
name|'d'
op|'['
string|"'AvailableCapacity'"
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'total_used'
op|'+='
name|'vsa_sched'
op|'.'
name|'BYTES_TO_GB'
op|'('
name|'d'
op|'['
string|"'TotalCapacity'"
op|']'
op|'-'
name|'d'
op|'['
string|"'AvailableCapacity'"
op|']'
op|')'
newline|'\n'
name|'total_available'
op|'+='
name|'vsa_sched'
op|'.'
name|'BYTES_TO_GB'
op|'('
nl|'\n'
name|'d'
op|'['
string|"'AvailableCapacity'"
op|']'
op|')'
newline|'\n'
dedent|''
name|'LOG'
op|'.'
name|'info'
op|'('
string|'"Host %s: used %d, avail %d"'
op|','
nl|'\n'
name|'host'
op|','
name|'total_used'
op|','
name|'total_available'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_set_service_states
dedent|''
dedent|''
name|'def'
name|'_set_service_states'
op|'('
name|'self'
op|','
name|'host_num'
op|','
nl|'\n'
name|'drive_type_start_ix'
op|','
name|'drive_type_num'
op|','
nl|'\n'
name|'init_num_drives'
op|'='
number|'10'
op|','
nl|'\n'
name|'exclude_host_list'
op|'='
op|'['
op|']'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'host_num'
op|'='
name|'host_num'
newline|'\n'
name|'self'
op|'.'
name|'drive_type_start_ix'
op|'='
name|'drive_type_start_ix'
newline|'\n'
name|'self'
op|'.'
name|'drive_type_num'
op|'='
name|'drive_type_num'
newline|'\n'
name|'self'
op|'.'
name|'exclude_host_list'
op|'='
name|'exclude_host_list'
newline|'\n'
name|'self'
op|'.'
name|'init_num_drives'
op|'='
name|'init_num_drives'
newline|'\n'
name|'self'
op|'.'
name|'service_states'
op|'='
name|'self'
op|'.'
name|'_generate_default_service_states'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_service_states
dedent|''
name|'def'
name|'_get_service_states'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'service_states'
newline|'\n'
nl|'\n'
DECL|member|_fake_get_service_states
dedent|''
name|'def'
name|'_fake_get_service_states'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'_get_service_states'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_fake_provision_volume
dedent|''
name|'def'
name|'_fake_provision_volume'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'vol'
op|','
name|'vsa_id'
op|','
name|'availability_zone'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'scheduled_volumes'
newline|'\n'
name|'scheduled_volumes'
op|'.'
name|'append'
op|'('
name|'dict'
op|'('
name|'vol'
op|'='
name|'vol'
op|','
nl|'\n'
name|'vsa_id'
op|'='
name|'vsa_id'
op|','
nl|'\n'
name|'az'
op|'='
name|'availability_zone'
op|')'
op|')'
newline|'\n'
name|'name'
op|'='
name|'vol'
op|'['
string|"'name'"
op|']'
newline|'\n'
name|'host'
op|'='
name|'vol'
op|'['
string|"'host'"
op|']'
newline|'\n'
name|'LOG'
op|'.'
name|'debug'
op|'('
name|'_'
op|'('
string|'"Test: provision vol %(name)s on host %(host)s"'
op|')'
op|','
nl|'\n'
name|'locals'
op|'('
op|')'
op|')'
newline|'\n'
name|'LOG'
op|'.'
name|'debug'
op|'('
name|'_'
op|'('
string|'"\\t vol=%(vol)s"'
op|')'
op|','
name|'locals'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_fake_vsa_update
dedent|''
name|'def'
name|'_fake_vsa_update'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'vsa_id'
op|','
name|'values'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'LOG'
op|'.'
name|'debug'
op|'('
name|'_'
op|'('
string|'"Test: VSA update request: vsa_id=%(vsa_id)s "'
string|'"values=%(values)s"'
op|')'
op|','
name|'locals'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_fake_volume_create
dedent|''
name|'def'
name|'_fake_volume_create'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'options'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'LOG'
op|'.'
name|'debug'
op|'('
name|'_'
op|'('
string|'"Test: Volume create: %s"'
op|')'
op|','
name|'options'
op|')'
newline|'\n'
name|'options'
op|'['
string|"'id'"
op|']'
op|'='
number|'123'
newline|'\n'
name|'global'
name|'global_volume'
newline|'\n'
name|'global_volume'
op|'='
name|'options'
newline|'\n'
name|'return'
name|'options'
newline|'\n'
nl|'\n'
DECL|member|_fake_volume_get
dedent|''
name|'def'
name|'_fake_volume_get'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'LOG'
op|'.'
name|'debug'
op|'('
name|'_'
op|'('
string|'"Test: Volume get request: id=%(volume_id)s"'
op|')'
op|','
name|'locals'
op|'('
op|')'
op|')'
newline|'\n'
name|'global'
name|'global_volume'
newline|'\n'
name|'global_volume'
op|'['
string|"'id'"
op|']'
op|'='
name|'volume_id'
newline|'\n'
name|'global_volume'
op|'['
string|"'availability_zone'"
op|']'
op|'='
name|'None'
newline|'\n'
name|'return'
name|'global_volume'
newline|'\n'
nl|'\n'
DECL|member|_fake_volume_update
dedent|''
name|'def'
name|'_fake_volume_update'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|','
name|'values'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'LOG'
op|'.'
name|'debug'
op|'('
name|'_'
op|'('
string|'"Test: Volume update request: id=%(volume_id)s "'
string|'"values=%(values)s"'
op|')'
op|','
name|'locals'
op|'('
op|')'
op|')'
newline|'\n'
name|'global'
name|'scheduled_volume'
newline|'\n'
name|'scheduled_volume'
op|'='
op|'{'
string|"'id'"
op|':'
name|'volume_id'
op|','
string|"'host'"
op|':'
name|'values'
op|'['
string|"'host'"
op|']'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|_fake_service_get_by_args
dedent|''
name|'def'
name|'_fake_service_get_by_args'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'host'
op|','
name|'binary'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
string|'"service"'
newline|'\n'
nl|'\n'
DECL|member|_fake_service_is_up_True
dedent|''
name|'def'
name|'_fake_service_is_up_True'
op|'('
name|'self'
op|','
name|'service'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'True'
newline|'\n'
nl|'\n'
DECL|member|_fake_service_is_up_False
dedent|''
name|'def'
name|'_fake_service_is_up_False'
op|'('
name|'self'
op|','
name|'service'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'False'
newline|'\n'
nl|'\n'
DECL|member|setUp
dedent|''
name|'def'
name|'setUp'
op|'('
name|'self'
op|','
name|'sched_class'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'VsaSchedulerTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'context'
op|'.'
name|'get_admin_context'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'sched_class'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sched'
op|'='
name|'FakeVsaLeastUsedScheduler'
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'sched'
op|'='
name|'sched_class'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'host_num'
op|'='
number|'10'
newline|'\n'
name|'self'
op|'.'
name|'drive_type_num'
op|'='
number|'5'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'rpc'
op|','
string|"'cast'"
op|','
name|'fake_rpc_cast'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'sched'
op|','
nl|'\n'
string|"'_get_service_states'"
op|','
name|'self'
op|'.'
name|'_fake_get_service_states'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'sched'
op|','
nl|'\n'
string|"'_provision_volume'"
op|','
name|'self'
op|'.'
name|'_fake_provision_volume'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'db'
op|','
string|"'vsa_update'"
op|','
name|'self'
op|'.'
name|'_fake_vsa_update'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'db'
op|','
string|"'volume_get'"
op|','
name|'self'
op|'.'
name|'_fake_volume_get'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'db'
op|','
string|"'volume_update'"
op|','
name|'self'
op|'.'
name|'_fake_volume_update'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'created_types_lst'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'name'
name|'in'
name|'self'
op|'.'
name|'created_types_lst'
op|':'
newline|'\n'
indent|'            '
name|'volume_types'
op|'.'
name|'purge'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'name'
op|')'
newline|'\n'
dedent|''
name|'super'
op|'('
name|'VsaSchedulerTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'tearDown'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vsa_sched_create_volumes_simple
dedent|''
name|'def'
name|'test_vsa_sched_create_volumes_simple'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'scheduled_volumes'
newline|'\n'
name|'scheduled_volumes'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_set_service_states'
op|'('
name|'host_num'
op|'='
number|'10'
op|','
nl|'\n'
name|'drive_type_start_ix'
op|'='
number|'0'
op|','
nl|'\n'
name|'drive_type_num'
op|'='
number|'5'
op|','
nl|'\n'
name|'init_num_drives'
op|'='
number|'10'
op|','
nl|'\n'
name|'exclude_host_list'
op|'='
op|'['
string|"'host_1'"
op|','
string|"'host_3'"
op|']'
op|')'
newline|'\n'
name|'prev'
op|'='
name|'self'
op|'.'
name|'_generate_default_service_states'
op|'('
op|')'
newline|'\n'
name|'request_spec'
op|'='
name|'self'
op|'.'
name|'_get_vol_creation_request'
op|'('
name|'num_vols'
op|'='
number|'3'
op|','
name|'drive_ix'
op|'='
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volumes'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'request_spec'
op|','
nl|'\n'
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'scheduled_volumes'
op|')'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'0'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_0'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'1'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_2'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'2'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_4'"
op|')'
newline|'\n'
nl|'\n'
name|'cur'
op|'='
name|'self'
op|'.'
name|'_get_service_states'
op|'('
op|')'
newline|'\n'
name|'for'
name|'host'
name|'in'
op|'['
string|"'host_0'"
op|','
string|"'host_2'"
op|','
string|"'host_4'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'cur_dtype'
op|'='
name|'cur'
op|'['
name|'host'
op|']'
op|'['
string|"'volume'"
op|']'
op|'['
string|"'drive_qos_info'"
op|']'
op|'['
string|"'name_2'"
op|']'
newline|'\n'
name|'prev_dtype'
op|'='
name|'prev'
op|'['
name|'host'
op|']'
op|'['
string|"'volume'"
op|']'
op|'['
string|"'drive_qos_info'"
op|']'
op|'['
string|"'name_2'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'DriveType'"
op|']'
op|','
name|'prev_dtype'
op|'['
string|"'DriveType'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumFreeDrives'"
op|']'
op|','
nl|'\n'
name|'prev_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumFreeDrives'"
op|']'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumOccupiedDrives'"
op|']'
op|','
nl|'\n'
name|'prev_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumOccupiedDrives'"
op|']'
op|'+'
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vsa_sched_no_drive_type
dedent|''
dedent|''
name|'def'
name|'test_vsa_sched_no_drive_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_set_service_states'
op|'('
name|'host_num'
op|'='
number|'10'
op|','
nl|'\n'
name|'drive_type_start_ix'
op|'='
number|'0'
op|','
nl|'\n'
name|'drive_type_num'
op|'='
number|'5'
op|','
nl|'\n'
name|'init_num_drives'
op|'='
number|'1'
op|')'
newline|'\n'
name|'request_spec'
op|'='
name|'self'
op|'.'
name|'_get_vol_creation_request'
op|'('
name|'num_vols'
op|'='
number|'1'
op|','
name|'drive_ix'
op|'='
number|'6'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NoValidHost'
op|','
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volumes'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'request_spec'
op|','
nl|'\n'
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vsa_sched_no_enough_drives
dedent|''
name|'def'
name|'test_vsa_sched_no_enough_drives'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'scheduled_volumes'
newline|'\n'
name|'scheduled_volumes'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_set_service_states'
op|'('
name|'host_num'
op|'='
number|'3'
op|','
nl|'\n'
name|'drive_type_start_ix'
op|'='
number|'0'
op|','
nl|'\n'
name|'drive_type_num'
op|'='
number|'1'
op|','
nl|'\n'
name|'init_num_drives'
op|'='
number|'0'
op|')'
newline|'\n'
name|'prev'
op|'='
name|'self'
op|'.'
name|'_generate_default_service_states'
op|'('
op|')'
newline|'\n'
name|'request_spec'
op|'='
name|'self'
op|'.'
name|'_get_vol_creation_request'
op|'('
name|'num_vols'
op|'='
number|'3'
op|','
name|'drive_ix'
op|'='
number|'0'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NoValidHost'
op|','
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volumes'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'request_spec'
op|','
nl|'\n'
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
comment|'# check that everything was returned back'
nl|'\n'
name|'cur'
op|'='
name|'self'
op|'.'
name|'_get_service_states'
op|'('
op|')'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'prev'
op|'.'
name|'iteritems'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'prev'
op|'['
name|'k'
op|']'
op|'['
string|"'volume'"
op|']'
op|'['
string|"'drive_qos_info'"
op|']'
op|','
nl|'\n'
name|'cur'
op|'['
name|'k'
op|']'
op|'['
string|"'volume'"
op|']'
op|'['
string|"'drive_qos_info'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vsa_sched_wrong_topic
dedent|''
dedent|''
name|'def'
name|'test_vsa_sched_wrong_topic'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_set_service_states'
op|'('
name|'host_num'
op|'='
number|'1'
op|','
nl|'\n'
name|'drive_type_start_ix'
op|'='
number|'0'
op|','
nl|'\n'
name|'drive_type_num'
op|'='
number|'5'
op|','
nl|'\n'
name|'init_num_drives'
op|'='
number|'1'
op|')'
newline|'\n'
name|'states'
op|'='
name|'self'
op|'.'
name|'_get_service_states'
op|'('
op|')'
newline|'\n'
name|'new_states'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'new_states'
op|'['
string|"'host_0'"
op|']'
op|'='
op|'{'
string|"'compute'"
op|':'
name|'states'
op|'['
string|"'host_0'"
op|']'
op|'['
string|"'volume'"
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'service_states'
op|'='
name|'new_states'
newline|'\n'
name|'request_spec'
op|'='
name|'self'
op|'.'
name|'_get_vol_creation_request'
op|'('
name|'num_vols'
op|'='
number|'1'
op|','
name|'drive_ix'
op|'='
number|'0'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NoValidHost'
op|','
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volumes'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'request_spec'
op|','
nl|'\n'
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vsa_sched_provision_volume
dedent|''
name|'def'
name|'test_vsa_sched_provision_volume'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'global_volume'
newline|'\n'
name|'global_volume'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_set_service_states'
op|'('
name|'host_num'
op|'='
number|'1'
op|','
nl|'\n'
name|'drive_type_start_ix'
op|'='
number|'0'
op|','
nl|'\n'
name|'drive_type_num'
op|'='
number|'1'
op|','
nl|'\n'
name|'init_num_drives'
op|'='
number|'1'
op|')'
newline|'\n'
name|'request_spec'
op|'='
name|'self'
op|'.'
name|'_get_vol_creation_request'
op|'('
name|'num_vols'
op|'='
number|'1'
op|','
name|'drive_ix'
op|'='
number|'0'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'UnsetAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'sched'
op|','
nl|'\n'
string|"'_get_service_states'"
op|','
name|'self'
op|'.'
name|'_fake_get_service_states'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'db'
op|','
string|"'volume_create'"
op|','
name|'self'
op|'.'
name|'_fake_volume_create'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'db'
op|','
string|"'volume_update'"
op|','
name|'self'
op|'.'
name|'_fake_volume_update'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'rpc'
op|','
string|"'cast'"
op|','
name|'fake_rpc_cast'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volumes'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'request_spec'
op|','
nl|'\n'
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'request_spec'
op|'['
string|"'volumes'"
op|']'
op|'['
number|'0'
op|']'
op|'['
string|"'name'"
op|']'
op|','
nl|'\n'
name|'global_volume'
op|'['
string|"'display_name'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vsa_sched_no_free_drives
dedent|''
name|'def'
name|'test_vsa_sched_no_free_drives'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_set_service_states'
op|'('
name|'host_num'
op|'='
number|'1'
op|','
nl|'\n'
name|'drive_type_start_ix'
op|'='
number|'0'
op|','
nl|'\n'
name|'drive_type_num'
op|'='
number|'1'
op|','
nl|'\n'
name|'init_num_drives'
op|'='
number|'1'
op|')'
newline|'\n'
name|'request_spec'
op|'='
name|'self'
op|'.'
name|'_get_vol_creation_request'
op|'('
name|'num_vols'
op|'='
number|'1'
op|','
name|'drive_ix'
op|'='
number|'0'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volumes'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'request_spec'
op|','
nl|'\n'
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'cur'
op|'='
name|'self'
op|'.'
name|'_get_service_states'
op|'('
op|')'
newline|'\n'
name|'cur_dtype'
op|'='
name|'cur'
op|'['
string|"'host_0'"
op|']'
op|'['
string|"'volume'"
op|']'
op|'['
string|"'drive_qos_info'"
op|']'
op|'['
string|"'name_0'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumFreeDrives'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
name|'new_request'
op|'='
name|'self'
op|'.'
name|'_get_vol_creation_request'
op|'('
name|'num_vols'
op|'='
number|'1'
op|','
name|'drive_ix'
op|'='
number|'0'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volumes'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'request_spec'
op|','
nl|'\n'
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_print_service_states'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NoValidHost'
op|','
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volumes'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'new_request'
op|','
nl|'\n'
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vsa_sched_forced_host
dedent|''
name|'def'
name|'test_vsa_sched_forced_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'scheduled_volumes'
newline|'\n'
name|'scheduled_volumes'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_set_service_states'
op|'('
name|'host_num'
op|'='
number|'10'
op|','
nl|'\n'
name|'drive_type_start_ix'
op|'='
number|'0'
op|','
nl|'\n'
name|'drive_type_num'
op|'='
number|'5'
op|','
nl|'\n'
name|'init_num_drives'
op|'='
number|'10'
op|')'
newline|'\n'
nl|'\n'
name|'request_spec'
op|'='
name|'self'
op|'.'
name|'_get_vol_creation_request'
op|'('
name|'num_vols'
op|'='
number|'3'
op|','
name|'drive_ix'
op|'='
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'HostBinaryNotFound'
op|','
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volumes'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'request_spec'
op|','
nl|'\n'
name|'availability_zone'
op|'='
string|'"nova:host_5"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'db'
op|','
nl|'\n'
string|"'service_get_by_args'"
op|','
name|'self'
op|'.'
name|'_fake_service_get_by_args'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'sched'
op|','
nl|'\n'
string|"'service_is_up'"
op|','
name|'self'
op|'.'
name|'_fake_service_is_up_False'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'WillNotSchedule'
op|','
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volumes'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'request_spec'
op|','
nl|'\n'
name|'availability_zone'
op|'='
string|'"nova:host_5"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'sched'
op|','
nl|'\n'
string|"'service_is_up'"
op|','
name|'self'
op|'.'
name|'_fake_service_is_up_True'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volumes'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'request_spec'
op|','
nl|'\n'
name|'availability_zone'
op|'='
string|'"nova:host_5"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'scheduled_volumes'
op|')'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'0'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_5'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'1'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_5'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'2'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_5'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vsa_sched_create_volumes_partition
dedent|''
name|'def'
name|'test_vsa_sched_create_volumes_partition'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'scheduled_volumes'
newline|'\n'
name|'scheduled_volumes'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_set_service_states'
op|'('
name|'host_num'
op|'='
number|'5'
op|','
nl|'\n'
name|'drive_type_start_ix'
op|'='
number|'0'
op|','
nl|'\n'
name|'drive_type_num'
op|'='
number|'5'
op|','
nl|'\n'
name|'init_num_drives'
op|'='
number|'1'
op|','
nl|'\n'
name|'exclude_host_list'
op|'='
op|'['
string|"'host_0'"
op|','
string|"'host_2'"
op|']'
op|')'
newline|'\n'
name|'prev'
op|'='
name|'self'
op|'.'
name|'_generate_default_service_states'
op|'('
op|')'
newline|'\n'
name|'request_spec'
op|'='
name|'self'
op|'.'
name|'_get_vol_creation_request'
op|'('
name|'num_vols'
op|'='
number|'3'
op|','
nl|'\n'
name|'drive_ix'
op|'='
number|'3'
op|','
nl|'\n'
name|'size'
op|'='
number|'50'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volumes'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'request_spec'
op|','
nl|'\n'
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'scheduled_volumes'
op|')'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'0'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'1'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_3'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'2'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_4'"
op|')'
newline|'\n'
nl|'\n'
name|'cur'
op|'='
name|'self'
op|'.'
name|'_get_service_states'
op|'('
op|')'
newline|'\n'
name|'for'
name|'host'
name|'in'
op|'['
string|"'host_1'"
op|','
string|"'host_3'"
op|','
string|"'host_4'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'cur_dtype'
op|'='
name|'cur'
op|'['
name|'host'
op|']'
op|'['
string|"'volume'"
op|']'
op|'['
string|"'drive_qos_info'"
op|']'
op|'['
string|"'name_3'"
op|']'
newline|'\n'
name|'prev_dtype'
op|'='
name|'prev'
op|'['
name|'host'
op|']'
op|'['
string|"'volume'"
op|']'
op|'['
string|"'drive_qos_info'"
op|']'
op|'['
string|"'name_3'"
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'DriveType'"
op|']'
op|','
name|'prev_dtype'
op|'['
string|"'DriveType'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumFreeDrives'"
op|']'
op|','
nl|'\n'
name|'prev_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumFreeDrives'"
op|']'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumOccupiedDrives'"
op|']'
op|','
nl|'\n'
name|'prev_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumOccupiedDrives'"
op|']'
op|'+'
number|'1'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'prev_dtype'
op|'['
string|"'PartitionDrive'"
op|']'
nl|'\n'
op|'['
string|"'NumOccupiedPartitions'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'PartitionDrive'"
op|']'
nl|'\n'
op|'['
string|"'NumOccupiedPartitions'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'PartitionDrive'"
op|']'
nl|'\n'
op|'['
string|"'NumFreePartitions'"
op|']'
op|','
number|'5'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'prev_dtype'
op|'['
string|"'PartitionDrive'"
op|']'
nl|'\n'
op|'['
string|"'NumFreePartitions'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'prev_dtype'
op|'['
string|"'PartitionDrive'"
op|']'
nl|'\n'
op|'['
string|"'PartitionSize'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vsa_sched_create_single_volume_az
dedent|''
dedent|''
name|'def'
name|'test_vsa_sched_create_single_volume_az'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'scheduled_volume'
newline|'\n'
name|'scheduled_volume'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|_fake_volume_get_az
name|'def'
name|'_fake_volume_get_az'
op|'('
name|'context'
op|','
name|'volume_id'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'LOG'
op|'.'
name|'debug'
op|'('
name|'_'
op|'('
string|'"Test: Volume get: id=%(volume_id)s"'
op|')'
op|','
name|'locals'
op|'('
op|')'
op|')'
newline|'\n'
name|'return'
op|'{'
string|"'id'"
op|':'
name|'volume_id'
op|','
string|"'availability_zone'"
op|':'
string|"'nova:host_3'"
op|'}'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'db'
op|','
string|"'volume_get'"
op|','
name|'_fake_volume_get_az'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'db'
op|','
nl|'\n'
string|"'service_get_by_args'"
op|','
name|'self'
op|'.'
name|'_fake_service_get_by_args'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'sched'
op|','
nl|'\n'
string|"'service_is_up'"
op|','
name|'self'
op|'.'
name|'_fake_service_is_up_True'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volume'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
number|'123'
op|','
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volume'
op|'['
string|"'id'"
op|']'
op|','
number|'123'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volume'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_3'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vsa_sched_create_single_non_vsa_volume
dedent|''
name|'def'
name|'test_vsa_sched_create_single_non_vsa_volume'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'scheduled_volume'
newline|'\n'
name|'scheduled_volume'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
name|'global'
name|'global_volume'
newline|'\n'
name|'global_volume'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'global_volume'
op|'['
string|"'volume_type_id'"
op|']'
op|'='
name|'None'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NoValidHost'
op|','
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volume'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
number|'123'
op|','
nl|'\n'
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vsa_sched_create_single_volume
dedent|''
name|'def'
name|'test_vsa_sched_create_single_volume'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'scheduled_volume'
newline|'\n'
name|'scheduled_volume'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_set_service_states'
op|'('
name|'host_num'
op|'='
number|'10'
op|','
nl|'\n'
name|'drive_type_start_ix'
op|'='
number|'0'
op|','
nl|'\n'
name|'drive_type_num'
op|'='
number|'5'
op|','
nl|'\n'
name|'init_num_drives'
op|'='
number|'10'
op|','
nl|'\n'
name|'exclude_host_list'
op|'='
op|'['
string|"'host_0'"
op|','
string|"'host_1'"
op|']'
op|')'
newline|'\n'
name|'prev'
op|'='
name|'self'
op|'.'
name|'_generate_default_service_states'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'global'
name|'global_volume'
newline|'\n'
name|'global_volume'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
name|'drive_ix'
op|'='
number|'2'
newline|'\n'
name|'name'
op|'='
string|"'name_'"
op|'+'
name|'str'
op|'('
name|'drive_ix'
op|')'
newline|'\n'
name|'volume_types'
op|'.'
name|'create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'name'
op|','
nl|'\n'
name|'extra_specs'
op|'='
op|'{'
string|"'type'"
op|':'
string|"'vsa_drive'"
op|','
nl|'\n'
string|"'drive_name'"
op|':'
name|'name'
op|','
nl|'\n'
string|"'drive_type'"
op|':'
string|"'type_'"
op|'+'
name|'str'
op|'('
name|'drive_ix'
op|')'
op|','
nl|'\n'
string|"'drive_size'"
op|':'
number|'1'
op|'+'
number|'100'
op|'*'
op|'('
name|'drive_ix'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'created_types_lst'
op|'.'
name|'append'
op|'('
name|'name'
op|')'
newline|'\n'
name|'volume_type'
op|'='
name|'volume_types'
op|'.'
name|'get_volume_type_by_name'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'name'
op|')'
newline|'\n'
nl|'\n'
name|'global_volume'
op|'['
string|"'volume_type_id'"
op|']'
op|'='
name|'volume_type'
op|'['
string|"'id'"
op|']'
newline|'\n'
name|'global_volume'
op|'['
string|"'size'"
op|']'
op|'='
number|'0'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volume'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
number|'123'
op|','
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volume'
op|'['
string|"'id'"
op|']'
op|','
number|'123'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volume'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_2'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VsaSchedulerTestCaseMostAvail
dedent|''
dedent|''
name|'class'
name|'VsaSchedulerTestCaseMostAvail'
op|'('
name|'VsaSchedulerTestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'VsaSchedulerTestCaseMostAvail'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
nl|'\n'
name|'FakeVsaMostAvailCapacityScheduler'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'VsaSchedulerTestCaseMostAvail'
op|','
name|'self'
op|')'
op|'.'
name|'tearDown'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vsa_sched_create_single_volume
dedent|''
name|'def'
name|'test_vsa_sched_create_single_volume'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'scheduled_volume'
newline|'\n'
name|'scheduled_volume'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_set_service_states'
op|'('
name|'host_num'
op|'='
number|'10'
op|','
nl|'\n'
name|'drive_type_start_ix'
op|'='
number|'0'
op|','
nl|'\n'
name|'drive_type_num'
op|'='
number|'5'
op|','
nl|'\n'
name|'init_num_drives'
op|'='
number|'10'
op|','
nl|'\n'
name|'exclude_host_list'
op|'='
op|'['
string|"'host_0'"
op|','
string|"'host_1'"
op|']'
op|')'
newline|'\n'
name|'prev'
op|'='
name|'self'
op|'.'
name|'_generate_default_service_states'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'global'
name|'global_volume'
newline|'\n'
name|'global_volume'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
name|'drive_ix'
op|'='
number|'2'
newline|'\n'
name|'name'
op|'='
string|"'name_'"
op|'+'
name|'str'
op|'('
name|'drive_ix'
op|')'
newline|'\n'
name|'volume_types'
op|'.'
name|'create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'name'
op|','
nl|'\n'
name|'extra_specs'
op|'='
op|'{'
string|"'type'"
op|':'
string|"'vsa_drive'"
op|','
nl|'\n'
string|"'drive_name'"
op|':'
name|'name'
op|','
nl|'\n'
string|"'drive_type'"
op|':'
string|"'type_'"
op|'+'
name|'str'
op|'('
name|'drive_ix'
op|')'
op|','
nl|'\n'
string|"'drive_size'"
op|':'
number|'1'
op|'+'
number|'100'
op|'*'
op|'('
name|'drive_ix'
op|')'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'created_types_lst'
op|'.'
name|'append'
op|'('
name|'name'
op|')'
newline|'\n'
name|'volume_type'
op|'='
name|'volume_types'
op|'.'
name|'get_volume_type_by_name'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'name'
op|')'
newline|'\n'
nl|'\n'
name|'global_volume'
op|'['
string|"'volume_type_id'"
op|']'
op|'='
name|'volume_type'
op|'['
string|"'id'"
op|']'
newline|'\n'
name|'global_volume'
op|'['
string|"'size'"
op|']'
op|'='
number|'0'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volume'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
number|'123'
op|','
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volume'
op|'['
string|"'id'"
op|']'
op|','
number|'123'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volume'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_9'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vsa_sched_create_volumes_simple
dedent|''
name|'def'
name|'test_vsa_sched_create_volumes_simple'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'scheduled_volumes'
newline|'\n'
name|'scheduled_volumes'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_set_service_states'
op|'('
name|'host_num'
op|'='
number|'10'
op|','
nl|'\n'
name|'drive_type_start_ix'
op|'='
number|'0'
op|','
nl|'\n'
name|'drive_type_num'
op|'='
number|'5'
op|','
nl|'\n'
name|'init_num_drives'
op|'='
number|'10'
op|','
nl|'\n'
name|'exclude_host_list'
op|'='
op|'['
string|"'host_1'"
op|','
string|"'host_3'"
op|']'
op|')'
newline|'\n'
name|'prev'
op|'='
name|'self'
op|'.'
name|'_generate_default_service_states'
op|'('
op|')'
newline|'\n'
name|'request_spec'
op|'='
name|'self'
op|'.'
name|'_get_vol_creation_request'
op|'('
name|'num_vols'
op|'='
number|'3'
op|','
name|'drive_ix'
op|'='
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_print_service_states'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volumes'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'request_spec'
op|','
nl|'\n'
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'scheduled_volumes'
op|')'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'0'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_9'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'1'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_8'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'2'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_7'"
op|')'
newline|'\n'
nl|'\n'
name|'cur'
op|'='
name|'self'
op|'.'
name|'_get_service_states'
op|'('
op|')'
newline|'\n'
name|'for'
name|'host'
name|'in'
op|'['
string|"'host_9'"
op|','
string|"'host_8'"
op|','
string|"'host_7'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'cur_dtype'
op|'='
name|'cur'
op|'['
name|'host'
op|']'
op|'['
string|"'volume'"
op|']'
op|'['
string|"'drive_qos_info'"
op|']'
op|'['
string|"'name_2'"
op|']'
newline|'\n'
name|'prev_dtype'
op|'='
name|'prev'
op|'['
name|'host'
op|']'
op|'['
string|"'volume'"
op|']'
op|'['
string|"'drive_qos_info'"
op|']'
op|'['
string|"'name_2'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'DriveType'"
op|']'
op|','
name|'prev_dtype'
op|'['
string|"'DriveType'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumFreeDrives'"
op|']'
op|','
nl|'\n'
name|'prev_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumFreeDrives'"
op|']'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumOccupiedDrives'"
op|']'
op|','
nl|'\n'
name|'prev_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumOccupiedDrives'"
op|']'
op|'+'
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vsa_sched_create_volumes_partition
dedent|''
dedent|''
name|'def'
name|'test_vsa_sched_create_volumes_partition'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'scheduled_volumes'
newline|'\n'
name|'scheduled_volumes'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_set_service_states'
op|'('
name|'host_num'
op|'='
number|'5'
op|','
nl|'\n'
name|'drive_type_start_ix'
op|'='
number|'0'
op|','
nl|'\n'
name|'drive_type_num'
op|'='
number|'5'
op|','
nl|'\n'
name|'init_num_drives'
op|'='
number|'1'
op|','
nl|'\n'
name|'exclude_host_list'
op|'='
op|'['
string|"'host_0'"
op|','
string|"'host_2'"
op|']'
op|')'
newline|'\n'
name|'prev'
op|'='
name|'self'
op|'.'
name|'_generate_default_service_states'
op|'('
op|')'
newline|'\n'
name|'request_spec'
op|'='
name|'self'
op|'.'
name|'_get_vol_creation_request'
op|'('
name|'num_vols'
op|'='
number|'3'
op|','
nl|'\n'
name|'drive_ix'
op|'='
number|'3'
op|','
nl|'\n'
name|'size'
op|'='
number|'50'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sched'
op|'.'
name|'schedule_create_volumes'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'request_spec'
op|','
nl|'\n'
name|'availability_zone'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'scheduled_volumes'
op|')'
op|','
number|'3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'0'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_4'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'1'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_3'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'scheduled_volumes'
op|'['
number|'2'
op|']'
op|'['
string|"'vol'"
op|']'
op|'['
string|"'host'"
op|']'
op|','
string|"'host_1'"
op|')'
newline|'\n'
nl|'\n'
name|'cur'
op|'='
name|'self'
op|'.'
name|'_get_service_states'
op|'('
op|')'
newline|'\n'
name|'for'
name|'host'
name|'in'
op|'['
string|"'host_1'"
op|','
string|"'host_3'"
op|','
string|"'host_4'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'cur_dtype'
op|'='
name|'cur'
op|'['
name|'host'
op|']'
op|'['
string|"'volume'"
op|']'
op|'['
string|"'drive_qos_info'"
op|']'
op|'['
string|"'name_3'"
op|']'
newline|'\n'
name|'prev_dtype'
op|'='
name|'prev'
op|'['
name|'host'
op|']'
op|'['
string|"'volume'"
op|']'
op|'['
string|"'drive_qos_info'"
op|']'
op|'['
string|"'name_3'"
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'DriveType'"
op|']'
op|','
name|'prev_dtype'
op|'['
string|"'DriveType'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumFreeDrives'"
op|']'
op|','
nl|'\n'
name|'prev_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumFreeDrives'"
op|']'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumOccupiedDrives'"
op|']'
op|','
nl|'\n'
name|'prev_dtype'
op|'['
string|"'FullDrive'"
op|']'
op|'['
string|"'NumOccupiedDrives'"
op|']'
op|'+'
number|'1'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'prev_dtype'
op|'['
string|"'PartitionDrive'"
op|']'
nl|'\n'
op|'['
string|"'NumOccupiedPartitions'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'PartitionDrive'"
op|']'
nl|'\n'
op|'['
string|"'NumOccupiedPartitions'"
op|']'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cur_dtype'
op|'['
string|"'PartitionDrive'"
op|']'
nl|'\n'
op|'['
string|"'NumFreePartitions'"
op|']'
op|','
number|'5'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'prev_dtype'
op|'['
string|"'PartitionDrive'"
op|']'
nl|'\n'
op|'['
string|"'NumFreePartitions'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'prev_dtype'
op|'['
string|"'PartitionDrive'"
op|']'
nl|'\n'
op|'['
string|"'PartitionSize'"
op|']'
op|','
number|'0'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
endmarker|''
end_unit
