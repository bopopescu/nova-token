begin_unit
name|'import'
name|'mox'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'context'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'db'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'xenapi'
name|'import'
name|'stubs'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'xenapi'
name|'import'
name|'driver'
name|'as'
name|'xenapi_conn'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'xenapi'
name|'import'
name|'fake'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'xenapi'
name|'import'
name|'vm_utils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'xenapi'
name|'import'
name|'volume_utils'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|XENSM_TYPE
name|'XENSM_TYPE'
op|'='
string|"'xensm'"
newline|'\n'
DECL|variable|ISCSI_TYPE
name|'ISCSI_TYPE'
op|'='
string|"'iscsi'"
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeSession
name|'class'
name|'FakeSession'
op|'('
op|')'
op|':'
newline|'\n'
DECL|member|call_xenapi
indent|'    '
name|'def'
name|'call_xenapi'
op|'('
name|'self'
op|','
name|'operation'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
comment|'# VDI.add_to_other_config -> VDI_add_to_other_config'
nl|'\n'
indent|'        '
name|'method'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
name|'operation'
op|'.'
name|'replace'
op|'('
string|"'.'"
op|','
string|"'_'"
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'method'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'method'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'operation'
op|'='
name|'operation'
newline|'\n'
name|'self'
op|'.'
name|'args'
op|'='
name|'args'
newline|'\n'
name|'self'
op|'.'
name|'kwargs'
op|'='
name|'kwargs'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|get_fake_connection_data
dedent|''
dedent|''
name|'def'
name|'get_fake_connection_data'
op|'('
name|'sr_type'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'fakes'
op|'='
op|'{'
name|'XENSM_TYPE'
op|':'
op|'{'
string|"'sr_uuid'"
op|':'
string|"'falseSR'"
op|','
nl|'\n'
string|"'name_label'"
op|':'
string|"'fake_storage'"
op|','
nl|'\n'
string|"'name_description'"
op|':'
string|"'test purposes'"
op|','
nl|'\n'
string|"'server'"
op|':'
string|"'myserver'"
op|','
nl|'\n'
string|"'serverpath'"
op|':'
string|"'/local/scratch/myname'"
op|','
nl|'\n'
string|"'sr_type'"
op|':'
string|"'nfs'"
op|','
nl|'\n'
string|"'introduce_sr_keys'"
op|':'
op|'['
string|"'server'"
op|','
nl|'\n'
string|"'serverpath'"
op|','
nl|'\n'
string|"'sr_type'"
op|']'
op|','
nl|'\n'
string|"'vdi_uuid'"
op|':'
string|"'falseVDI'"
op|'}'
op|','
nl|'\n'
name|'ISCSI_TYPE'
op|':'
op|'{'
string|"'volume_id'"
op|':'
string|"'fake_volume_id'"
op|','
nl|'\n'
string|"'target_lun'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'target_iqn'"
op|':'
string|"'fake_iqn:volume-fake_volume_id'"
op|','
nl|'\n'
string|"'target_portal'"
op|':'
string|"u'localhost:3260'"
op|','
nl|'\n'
string|"'target_discovered'"
op|':'
name|'False'
op|'}'
op|','
op|'}'
newline|'\n'
name|'return'
name|'fakes'
op|'['
name|'sr_type'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|GetInstanceForVdisForSrTestCase
dedent|''
name|'class'
name|'GetInstanceForVdisForSrTestCase'
op|'('
name|'stubs'
op|'.'
name|'XenAPITestBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'GetInstanceForVdisForSrTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'disable_process_locking'
op|'='
name|'True'
op|','
nl|'\n'
name|'instance_name_template'
op|'='
string|"'%d'"
op|','
nl|'\n'
name|'firewall_driver'
op|'='
string|"'nova.virt.xenapi.firewall.'"
nl|'\n'
string|"'Dom0IptablesFirewallDriver'"
op|','
nl|'\n'
name|'xenapi_connection_url'
op|'='
string|"'test_url'"
op|','
nl|'\n'
name|'xenapi_connection_password'
op|'='
string|"'test_pass'"
op|','
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_instance_vdis_for_sr
dedent|''
name|'def'
name|'test_get_instance_vdis_for_sr'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vm_ref'
op|'='
name|'fake'
op|'.'
name|'create_vm'
op|'('
string|'"foo"'
op|','
string|'"Running"'
op|')'
newline|'\n'
name|'sr_ref'
op|'='
name|'fake'
op|'.'
name|'create_sr'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vdi_1'
op|'='
name|'fake'
op|'.'
name|'create_vdi'
op|'('
string|"'vdiname1'"
op|','
name|'sr_ref'
op|')'
newline|'\n'
name|'vdi_2'
op|'='
name|'fake'
op|'.'
name|'create_vdi'
op|'('
string|"'vdiname2'"
op|','
name|'sr_ref'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'vdi_ref'
name|'in'
op|'['
name|'vdi_1'
op|','
name|'vdi_2'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'fake'
op|'.'
name|'create_vbd'
op|'('
name|'vm_ref'
op|','
name|'vdi_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'stubs'
op|'.'
name|'stubout_session'
op|'('
name|'self'
op|'.'
name|'stubs'
op|','
name|'fake'
op|'.'
name|'SessionBase'
op|')'
newline|'\n'
name|'driver'
op|'='
name|'xenapi_conn'
op|'.'
name|'XenAPIDriver'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'list'
op|'('
name|'vm_utils'
op|'.'
name|'get_instance_vdis_for_sr'
op|'('
nl|'\n'
name|'driver'
op|'.'
name|'_session'
op|','
name|'vm_ref'
op|','
name|'sr_ref'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
op|'['
name|'vdi_1'
op|','
name|'vdi_2'
op|']'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_instance_vdis_for_sr_no_vbd
dedent|''
name|'def'
name|'test_get_instance_vdis_for_sr_no_vbd'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vm_ref'
op|'='
name|'fake'
op|'.'
name|'create_vm'
op|'('
string|'"foo"'
op|','
string|'"Running"'
op|')'
newline|'\n'
name|'sr_ref'
op|'='
name|'fake'
op|'.'
name|'create_sr'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'stubs'
op|'.'
name|'stubout_session'
op|'('
name|'self'
op|'.'
name|'stubs'
op|','
name|'fake'
op|'.'
name|'SessionBase'
op|')'
newline|'\n'
name|'driver'
op|'='
name|'xenapi_conn'
op|'.'
name|'XenAPIDriver'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'list'
op|'('
name|'vm_utils'
op|'.'
name|'get_instance_vdis_for_sr'
op|'('
nl|'\n'
name|'driver'
op|'.'
name|'_session'
op|','
name|'vm_ref'
op|','
name|'sr_ref'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
op|'['
op|']'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vdi_uuid_for_volume_with_sr_uuid
dedent|''
name|'def'
name|'test_get_vdi_uuid_for_volume_with_sr_uuid'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'connection_data'
op|'='
name|'get_fake_connection_data'
op|'('
name|'XENSM_TYPE'
op|')'
newline|'\n'
name|'stubs'
op|'.'
name|'stubout_session'
op|'('
name|'self'
op|'.'
name|'stubs'
op|','
name|'fake'
op|'.'
name|'SessionBase'
op|')'
newline|'\n'
name|'driver'
op|'='
name|'xenapi_conn'
op|'.'
name|'XenAPIDriver'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'vdi_uuid'
op|'='
name|'vm_utils'
op|'.'
name|'get_vdi_uuid_for_volume'
op|'('
nl|'\n'
name|'driver'
op|'.'
name|'_session'
op|','
name|'connection_data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'vdi_uuid'
op|','
string|"'falseVDI'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vdi_uuid_for_volume_failure
dedent|''
name|'def'
name|'test_get_vdi_uuid_for_volume_failure'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'stubs'
op|'.'
name|'stubout_session'
op|'('
name|'self'
op|'.'
name|'stubs'
op|','
name|'fake'
op|'.'
name|'SessionBase'
op|')'
newline|'\n'
name|'driver'
op|'='
name|'xenapi_conn'
op|'.'
name|'XenAPIDriver'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|function|bad_introduce_sr
name|'def'
name|'bad_introduce_sr'
op|'('
name|'session'
op|','
name|'sr_uuid'
op|','
name|'label'
op|','
name|'sr_params'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'None'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'volume_utils'
op|','
string|"'introduce_sr'"
op|','
name|'bad_introduce_sr'
op|')'
newline|'\n'
name|'connection_data'
op|'='
name|'get_fake_connection_data'
op|'('
name|'XENSM_TYPE'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NovaException'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'get_vdi_uuid_for_volume'
op|','
nl|'\n'
name|'driver'
op|'.'
name|'_session'
op|','
name|'connection_data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vdi_uuid_for_volume_from_iscsi_vol_missing_sr_uuid
dedent|''
name|'def'
name|'test_get_vdi_uuid_for_volume_from_iscsi_vol_missing_sr_uuid'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'connection_data'
op|'='
name|'get_fake_connection_data'
op|'('
name|'ISCSI_TYPE'
op|')'
newline|'\n'
name|'stubs'
op|'.'
name|'stubout_session'
op|'('
name|'self'
op|'.'
name|'stubs'
op|','
name|'fake'
op|'.'
name|'SessionBase'
op|')'
newline|'\n'
name|'driver'
op|'='
name|'xenapi_conn'
op|'.'
name|'XenAPIDriver'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'vdi_uuid'
op|'='
name|'vm_utils'
op|'.'
name|'get_vdi_uuid_for_volume'
op|'('
nl|'\n'
name|'driver'
op|'.'
name|'_session'
op|','
name|'connection_data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotEquals'
op|'('
name|'vdi_uuid'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VMRefOrRaiseVMFoundTestCase
dedent|''
dedent|''
name|'class'
name|'VMRefOrRaiseVMFoundTestCase'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|test_lookup_call
indent|'    '
name|'def'
name|'test_lookup_call'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock'
op|'='
name|'mox'
op|'.'
name|'Mox'
op|'('
op|')'
newline|'\n'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'lookup'"
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'lookup'
op|'('
string|"'session'"
op|','
string|"'somename'"
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'ignored'"
op|')'
newline|'\n'
nl|'\n'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'vm_ref_or_raise'
op|'('
string|"'session'"
op|','
string|"'somename'"
op|')'
newline|'\n'
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_return_value
dedent|''
name|'def'
name|'test_return_value'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock'
op|'='
name|'mox'
op|'.'
name|'Mox'
op|'('
op|')'
newline|'\n'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'lookup'"
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'lookup'
op|'('
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|','
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'vmref'"
op|')'
newline|'\n'
nl|'\n'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
nl|'\n'
string|"'vmref'"
op|','
name|'vm_utils'
op|'.'
name|'vm_ref_or_raise'
op|'('
string|"'session'"
op|','
string|"'somename'"
op|')'
op|')'
newline|'\n'
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VMRefOrRaiseVMNotFoundTestCase
dedent|''
dedent|''
name|'class'
name|'VMRefOrRaiseVMNotFoundTestCase'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|test_exception_raised
indent|'    '
name|'def'
name|'test_exception_raised'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock'
op|'='
name|'mox'
op|'.'
name|'Mox'
op|'('
op|')'
newline|'\n'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'lookup'"
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'lookup'
op|'('
string|"'session'"
op|','
string|"'somename'"
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
nl|'\n'
name|'exception'
op|'.'
name|'InstanceNotFound'
op|','
nl|'\n'
name|'lambda'
op|':'
name|'vm_utils'
op|'.'
name|'vm_ref_or_raise'
op|'('
string|"'session'"
op|','
string|"'somename'"
op|')'
nl|'\n'
op|')'
newline|'\n'
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_exception_msg_contains_vm_name
dedent|''
name|'def'
name|'test_exception_msg_contains_vm_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock'
op|'='
name|'mox'
op|'.'
name|'Mox'
op|'('
op|')'
newline|'\n'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'lookup'"
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'lookup'
op|'('
string|"'session'"
op|','
string|"'somename'"
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'vm_utils'
op|'.'
name|'vm_ref_or_raise'
op|'('
string|"'session'"
op|','
string|"'somename'"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'exception'
op|'.'
name|'InstanceNotFound'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
string|"'somename'"
name|'in'
name|'str'
op|'('
name|'e'
op|')'
op|')'
newline|'\n'
dedent|''
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|BittorrentTestCase
dedent|''
dedent|''
name|'class'
name|'BittorrentTestCase'
op|'('
name|'stubs'
op|'.'
name|'XenAPITestBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'BittorrentTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'context'
op|'.'
name|'get_admin_context'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_image_uses_bittorrent
dedent|''
name|'def'
name|'test_image_uses_bittorrent'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'sys_meta'
op|'='
op|'{'
string|"'image_bittorrent'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'instance'
op|'='
name|'db'
op|'.'
name|'instance_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
op|'{'
string|"'system_metadata'"
op|':'
name|'sys_meta'
op|'}'
op|')'
newline|'\n'
name|'instance'
op|'='
name|'db'
op|'.'
name|'instance_get_by_uuid'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'instance'
op|'['
string|"'uuid'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'xenapi_torrent_images'
op|'='
string|"'some'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'vm_utils'
op|'.'
name|'_image_uses_bittorrent'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'instance'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_create_image
dedent|''
name|'def'
name|'_test_create_image'
op|'('
name|'self'
op|','
name|'cache_type'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'sys_meta'
op|'='
op|'{'
string|"'image_cache_in_nova'"
op|':'
name|'True'
op|'}'
newline|'\n'
name|'instance'
op|'='
name|'db'
op|'.'
name|'instance_create'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
op|'{'
string|"'system_metadata'"
op|':'
name|'sys_meta'
op|'}'
op|')'
newline|'\n'
name|'instance'
op|'='
name|'db'
op|'.'
name|'instance_get_by_uuid'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'instance'
op|'['
string|"'uuid'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'cache_images'
op|'='
name|'cache_type'
op|')'
newline|'\n'
nl|'\n'
name|'was'
op|'='
op|'{'
string|"'called'"
op|':'
name|'None'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|fake_create_cached_image
name|'def'
name|'fake_create_cached_image'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'was'
op|'['
string|"'called'"
op|']'
op|'='
string|"'some'"
newline|'\n'
name|'return'
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'vm_utils'
op|','
string|"'_create_cached_image'"
op|','
nl|'\n'
name|'fake_create_cached_image'
op|')'
newline|'\n'
nl|'\n'
DECL|function|fake_fetch_image
name|'def'
name|'fake_fetch_image'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'was'
op|'['
string|"'called'"
op|']'
op|'='
string|"'none'"
newline|'\n'
name|'return'
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'vm_utils'
op|','
string|"'_fetch_image'"
op|','
nl|'\n'
name|'fake_fetch_image'
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_create_image'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'None'
op|','
name|'instance'
op|','
nl|'\n'
string|"'foo'"
op|','
string|"'bar'"
op|','
string|"'baz'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'was'
op|'['
string|"'called'"
op|']'
op|','
name|'cache_type'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_image_cached
dedent|''
name|'def'
name|'test_create_image_cached'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_image'
op|'('
string|"'some'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_image_uncached
dedent|''
name|'def'
name|'test_create_image_uncached'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_image'
op|'('
string|"'none'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|CreateVBDTestCase
dedent|''
dedent|''
name|'class'
name|'CreateVBDTestCase'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'CreateVBDTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'='
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'='
name|'mox'
op|'.'
name|'Mox'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|"'call_xenapi'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|'='
name|'self'
op|'.'
name|'_generate_vbd_rec'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_generate_vbd_rec
dedent|''
name|'def'
name|'_generate_vbd_rec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vbd_rec'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'VM'"
op|']'
op|'='
string|"'vm_ref'"
newline|'\n'
name|'vbd_rec'
op|'['
string|"'VDI'"
op|']'
op|'='
string|"'vdi_ref'"
newline|'\n'
name|'vbd_rec'
op|'['
string|"'userdevice'"
op|']'
op|'='
string|"'0'"
newline|'\n'
name|'vbd_rec'
op|'['
string|"'bootable'"
op|']'
op|'='
name|'False'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'mode'"
op|']'
op|'='
string|"'RW'"
newline|'\n'
name|'vbd_rec'
op|'['
string|"'type'"
op|']'
op|'='
string|"'disk'"
newline|'\n'
name|'vbd_rec'
op|'['
string|"'unpluggable'"
op|']'
op|'='
name|'True'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'empty'"
op|']'
op|'='
name|'False'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'other_config'"
op|']'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'qos_algorithm_type'"
op|']'
op|'='
string|"''"
newline|'\n'
name|'vbd_rec'
op|'['
string|"'qos_algorithm_params'"
op|']'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'qos_supported_algorithms'"
op|']'
op|'='
op|'['
op|']'
newline|'\n'
name|'return'
name|'vbd_rec'
newline|'\n'
nl|'\n'
DECL|member|test_create_vbd_default_args
dedent|''
name|'def'
name|'test_create_vbd_default_args'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|"'VBD.create'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'create_vbd'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"vm_ref"'
op|','
string|'"vdi_ref"'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'result'
op|','
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_vbd_osvol
dedent|''
name|'def'
name|'test_create_vbd_osvol'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|"'VBD.create'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|"'VBD.add_to_other_config'"
op|','
string|'"vbd_ref"'
op|','
nl|'\n'
string|'"osvol"'
op|','
string|'"True"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'create_vbd'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"vm_ref"'
op|','
string|'"vdi_ref"'
op|','
number|'0'
op|','
nl|'\n'
name|'osvol'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'result'
op|','
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_vbd_extra_args
dedent|''
name|'def'
name|'test_create_vbd_extra_args'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'vbd_rec'
op|'['
string|"'VDI'"
op|']'
op|'='
string|"'OpaqueRef:NULL'"
newline|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|'['
string|"'type'"
op|']'
op|'='
string|"'a'"
newline|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|'['
string|"'mode'"
op|']'
op|'='
string|"'RO'"
newline|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|'['
string|"'bootable'"
op|']'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|'['
string|"'empty'"
op|']'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|'['
string|"'unpluggable'"
op|']'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|"'VBD.create'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'create_vbd'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"vm_ref"'
op|','
name|'None'
op|','
number|'0'
op|','
nl|'\n'
name|'vbd_type'
op|'='
string|'"a"'
op|','
name|'read_only'
op|'='
name|'True'
op|','
name|'bootable'
op|'='
name|'True'
op|','
nl|'\n'
name|'empty'
op|'='
name|'True'
op|','
name|'unpluggable'
op|'='
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'result'
op|','
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_attach_cd
dedent|''
name|'def'
name|'test_attach_cd'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'create_vbd'"
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'create_vbd'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"vm_ref"'
op|','
name|'None'
op|','
number|'1'
op|','
nl|'\n'
name|'vbd_type'
op|'='
string|"'cd'"
op|','
name|'read_only'
op|'='
name|'True'
op|','
name|'bootable'
op|'='
name|'True'
op|','
nl|'\n'
name|'empty'
op|'='
name|'True'
op|','
name|'unpluggable'
op|'='
name|'False'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|"'VBD.insert'"
op|','
string|'"vbd_ref"'
op|','
string|'"vdi_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'attach_cd'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"vm_ref"'
op|','
string|'"vdi_ref"'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'result'
op|','
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VDIOtherConfigTestCase
dedent|''
dedent|''
name|'class'
name|'VDIOtherConfigTestCase'
op|'('
name|'stubs'
op|'.'
name|'XenAPITestBase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Tests to ensure that the code is populating VDI\'s `other_config`\n    attribute with the correct metadta.\n    """'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'VDIOtherConfigTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'='
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'context'
op|'.'
name|'get_admin_context'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'fake_instance'
op|'='
op|'{'
string|"'uuid'"
op|':'
string|"'aaaa-bbbb-cccc-dddd'"
op|','
nl|'\n'
string|"'name'"
op|':'
string|"'myinstance'"
op|'}'
newline|'\n'
nl|'\n'
DECL|member|test_create_vdi
dedent|''
name|'def'
name|'test_create_vdi'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Some images are registered with XenServer explicitly by calling'
nl|'\n'
comment|'# `create_vdi`'
nl|'\n'
indent|'        '
name|'vm_utils'
op|'.'
name|'create_vdi'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|"'sr_ref'"
op|','
name|'self'
op|'.'
name|'fake_instance'
op|','
nl|'\n'
string|"'myvdi'"
op|','
string|"'root'"
op|','
number|'1024'
op|','
name|'read_only'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'{'
string|"'nova_disk_type'"
op|':'
string|"'root'"
op|','
nl|'\n'
string|"'nova_instance_uuid'"
op|':'
string|"'aaaa-bbbb-cccc-dddd'"
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'self'
op|'.'
name|'session'
op|'.'
name|'args'
op|'['
number|'0'
op|']'
op|'['
string|"'other_config'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_image
dedent|''
name|'def'
name|'test_create_image'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Other images are registered implicitly when they are dropped into'
nl|'\n'
comment|'# the SR by a dom0 plugin or some other process'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'cache_images'
op|'='
string|"'none'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|fake_fetch_image
name|'def'
name|'fake_fetch_image'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'{'
string|"'root'"
op|':'
op|'{'
string|"'uuid'"
op|':'
string|"'fake-uuid'"
op|'}'
op|'}'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'vm_utils'
op|','
string|"'_fetch_image'"
op|','
name|'fake_fetch_image'
op|')'
newline|'\n'
nl|'\n'
name|'other_config'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|VDI_add_to_other_config
name|'def'
name|'VDI_add_to_other_config'
op|'('
name|'ref'
op|','
name|'key'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'other_config'
op|'['
name|'key'
op|']'
op|'='
name|'value'
newline|'\n'
nl|'\n'
DECL|function|VDI_get_record
dedent|''
name|'def'
name|'VDI_get_record'
op|'('
name|'ref'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'{'
string|"'other_config'"
op|':'
op|'{'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
comment|"# Stubbing on the session object and not class so we don't pollute"
nl|'\n'
comment|'# other tests'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'session'
op|'.'
name|'VDI_add_to_other_config'
op|'='
name|'VDI_add_to_other_config'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'VDI_get_record'
op|'='
name|'VDI_get_record'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_create_image'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'fake_instance'
op|','
nl|'\n'
string|"'myvdi'"
op|','
string|"'image1'"
op|','
name|'vm_utils'
op|'.'
name|'ImageType'
op|'.'
name|'DISK_VHD'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'{'
string|"'nova_disk_type'"
op|':'
string|"'root'"
op|','
nl|'\n'
string|"'nova_instance_uuid'"
op|':'
string|"'aaaa-bbbb-cccc-dddd'"
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'other_config'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_move_disks
dedent|''
name|'def'
name|'test_move_disks'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Migrated images should preserve the `other_config`'
nl|'\n'
indent|'        '
name|'other_config'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|VDI_add_to_other_config
name|'def'
name|'VDI_add_to_other_config'
op|'('
name|'ref'
op|','
name|'key'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'other_config'
op|'['
name|'key'
op|']'
op|'='
name|'value'
newline|'\n'
nl|'\n'
DECL|function|VDI_get_record
dedent|''
name|'def'
name|'VDI_get_record'
op|'('
name|'ref'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'{'
string|"'other_config'"
op|':'
op|'{'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|call_plugin_serialized
dedent|''
name|'def'
name|'call_plugin_serialized'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'{'
string|"'root'"
op|':'
op|'{'
string|"'uuid'"
op|':'
string|"'aaaa-bbbb-cccc-dddd'"
op|'}'
op|'}'
newline|'\n'
nl|'\n'
comment|"# Stubbing on the session object and not class so we don't pollute"
nl|'\n'
comment|'# other tests'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'session'
op|'.'
name|'VDI_add_to_other_config'
op|'='
name|'VDI_add_to_other_config'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'VDI_get_record'
op|'='
name|'VDI_get_record'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_plugin_serialized'
op|'='
name|'call_plugin_serialized'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'vm_utils'
op|','
string|"'get_sr_path'"
op|','
name|'lambda'
op|'*'
name|'a'
op|','
op|'**'
name|'k'
op|':'
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'vm_utils'
op|','
string|"'scan_default_sr'"
op|','
name|'lambda'
op|'*'
name|'a'
op|','
op|'**'
name|'k'
op|':'
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'move_disks'
op|'('
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'fake_instance'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'{'
string|"'nova_disk_type'"
op|':'
string|"'root'"
op|','
nl|'\n'
string|"'nova_instance_uuid'"
op|':'
string|"'aaaa-bbbb-cccc-dddd'"
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'other_config'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
