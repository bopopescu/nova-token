begin_unit
comment|'# Copyright (c) 2013 Hewlett-Packard Development Company, L.P.'
nl|'\n'
comment|'# Copyright 2013 Canonical Corp.'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'collections'
newline|'\n'
name|'import'
name|'contextlib'
newline|'\n'
nl|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'from'
name|'oslo_utils'
name|'import'
name|'uuidutils'
newline|'\n'
name|'from'
name|'oslo_vmware'
name|'import'
name|'exceptions'
name|'as'
name|'vexc'
newline|'\n'
name|'from'
name|'oslo_vmware'
op|'.'
name|'objects'
name|'import'
name|'datastore'
name|'as'
name|'ds_obj'
newline|'\n'
name|'from'
name|'oslo_vmware'
name|'import'
name|'pbm'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'network'
name|'import'
name|'model'
name|'as'
name|'network_model'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
name|'import'
name|'fake_instance'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'fake'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'stubs'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'constants'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'driver'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'vm_util'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|partialObject
name|'class'
name|'partialObject'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'path'
op|'='
string|"'fake-path'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'fault'
op|'='
name|'fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VMwareVMUtilTestCase
dedent|''
dedent|''
name|'class'
name|'VMwareVMUtilTestCase'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'VMwareVMUtilTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'fake'
op|'.'
name|'reset'
op|'('
op|')'
newline|'\n'
name|'stubs'
op|'.'
name|'set_stubs'
op|'('
name|'self'
op|'.'
name|'stubs'
op|')'
newline|'\n'
name|'vm_util'
op|'.'
name|'vm_refs_cache_reset'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
nl|'\n'
name|'None'
op|','
nl|'\n'
op|'**'
op|'{'
string|"'id'"
op|':'
number|'7'
op|','
string|"'name'"
op|':'
string|"'fake!'"
op|','
nl|'\n'
string|"'uuid'"
op|':'
name|'uuidutils'
op|'.'
name|'generate_uuid'
op|'('
op|')'
op|','
nl|'\n'
string|"'vcpus'"
op|':'
number|'2'
op|','
string|"'memory_mb'"
op|':'
number|'2048'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_get_stats_from_cluster
dedent|''
name|'def'
name|'_test_get_stats_from_cluster'
op|'('
name|'self'
op|','
name|'connection_state'
op|'='
string|'"connected"'
op|','
nl|'\n'
name|'maintenance_mode'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ManagedObjectRefs'
op|'='
op|'['
name|'fake'
op|'.'
name|'ManagedObjectReference'
op|'('
string|'"host1"'
op|','
nl|'\n'
string|'"HostSystem"'
op|')'
op|','
nl|'\n'
name|'fake'
op|'.'
name|'ManagedObjectReference'
op|'('
string|'"host2"'
op|','
nl|'\n'
string|'"HostSystem"'
op|')'
op|']'
newline|'\n'
name|'hosts'
op|'='
name|'fake'
op|'.'
name|'_convert_to_array_of_mor'
op|'('
name|'ManagedObjectRefs'
op|')'
newline|'\n'
name|'respool'
op|'='
name|'fake'
op|'.'
name|'ManagedObjectReference'
op|'('
string|'"resgroup-11"'
op|','
string|'"ResourcePool"'
op|')'
newline|'\n'
name|'prop_dict'
op|'='
op|'{'
string|"'host'"
op|':'
name|'hosts'
op|','
string|"'resourcePool'"
op|':'
name|'respool'
op|'}'
newline|'\n'
nl|'\n'
name|'hardware'
op|'='
name|'fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'hardware'
op|'.'
name|'numCpuCores'
op|'='
number|'8'
newline|'\n'
name|'hardware'
op|'.'
name|'numCpuThreads'
op|'='
number|'16'
newline|'\n'
name|'hardware'
op|'.'
name|'vendor'
op|'='
string|'"Intel"'
newline|'\n'
name|'hardware'
op|'.'
name|'cpuModel'
op|'='
string|'"Intel(R) Xeon(R)"'
newline|'\n'
nl|'\n'
name|'runtime_host_1'
op|'='
name|'fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'runtime_host_1'
op|'.'
name|'connectionState'
op|'='
string|'"connected"'
newline|'\n'
name|'runtime_host_1'
op|'.'
name|'inMaintenanceMode'
op|'='
name|'False'
newline|'\n'
nl|'\n'
name|'runtime_host_2'
op|'='
name|'fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'runtime_host_2'
op|'.'
name|'connectionState'
op|'='
name|'connection_state'
newline|'\n'
name|'runtime_host_2'
op|'.'
name|'inMaintenanceMode'
op|'='
name|'maintenance_mode'
newline|'\n'
nl|'\n'
name|'prop_list_host_1'
op|'='
op|'['
name|'fake'
op|'.'
name|'Prop'
op|'('
name|'name'
op|'='
string|'"hardware_summary"'
op|','
name|'val'
op|'='
name|'hardware'
op|')'
op|','
nl|'\n'
name|'fake'
op|'.'
name|'Prop'
op|'('
name|'name'
op|'='
string|'"runtime_summary"'
op|','
nl|'\n'
name|'val'
op|'='
name|'runtime_host_1'
op|')'
op|']'
newline|'\n'
name|'prop_list_host_2'
op|'='
op|'['
name|'fake'
op|'.'
name|'Prop'
op|'('
name|'name'
op|'='
string|'"hardware_summary"'
op|','
name|'val'
op|'='
name|'hardware'
op|')'
op|','
nl|'\n'
name|'fake'
op|'.'
name|'Prop'
op|'('
name|'name'
op|'='
string|'"runtime_summary"'
op|','
nl|'\n'
name|'val'
op|'='
name|'runtime_host_2'
op|')'
op|']'
newline|'\n'
nl|'\n'
name|'fake_objects'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'fake'
op|'.'
name|'ObjectContent'
op|'('
string|'"prop_list_host1"'
op|','
nl|'\n'
name|'prop_list_host_1'
op|')'
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'fake'
op|'.'
name|'ObjectContent'
op|'('
string|'"prop_list_host1"'
op|','
nl|'\n'
name|'prop_list_host_2'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'respool_resource_usage'
op|'='
name|'fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'respool_resource_usage'
op|'.'
name|'maxUsage'
op|'='
number|'5368709120'
newline|'\n'
name|'respool_resource_usage'
op|'.'
name|'overallUsage'
op|'='
number|'2147483648'
newline|'\n'
nl|'\n'
DECL|function|fake_call_method
name|'def'
name|'fake_call_method'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
string|'"get_dynamic_properties"'
name|'in'
name|'args'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'prop_dict'
newline|'\n'
dedent|''
name|'elif'
string|'"get_properties_for_a_collection_of_objects"'
name|'in'
name|'args'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'fake_objects'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'respool_resource_usage'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
name|'fake_call_method'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_stats_from_cluster'
op|'('
name|'session'
op|','
string|'"cluster1"'
op|')'
newline|'\n'
name|'mem_info'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'if'
name|'connection_state'
op|'=='
string|'"connected"'
name|'and'
name|'not'
name|'maintenance_mode'
op|':'
newline|'\n'
indent|'                '
name|'vcpus'
op|'='
number|'32'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'vcpus'
op|'='
number|'16'
newline|'\n'
dedent|''
name|'mem_info'
op|'['
string|"'total'"
op|']'
op|'='
number|'5120'
newline|'\n'
name|'mem_info'
op|'['
string|"'free'"
op|']'
op|'='
number|'3072'
newline|'\n'
name|'expected_stats'
op|'='
op|'{'
string|"'vcpus'"
op|':'
name|'vcpus'
op|','
string|"'mem'"
op|':'
name|'mem_info'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_stats'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_stats_from_cluster_hosts_connected_and_active
dedent|''
dedent|''
name|'def'
name|'test_get_stats_from_cluster_hosts_connected_and_active'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_get_stats_from_cluster'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_stats_from_cluster_hosts_disconnected_and_active
dedent|''
name|'def'
name|'test_get_stats_from_cluster_hosts_disconnected_and_active'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_get_stats_from_cluster'
op|'('
name|'connection_state'
op|'='
string|'"disconnected"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_stats_from_cluster_hosts_connected_and_maintenance
dedent|''
name|'def'
name|'test_get_stats_from_cluster_hosts_connected_and_maintenance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_get_stats_from_cluster'
op|'('
name|'maintenance_mode'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_host_ref_no_hosts_in_cluster
dedent|''
name|'def'
name|'test_get_host_ref_no_hosts_in_cluster'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NoValidHost'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'get_host_ref'
op|','
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
string|'""'
op|')'
op|','
string|"'fake_cluster'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_resize_spec
dedent|''
name|'def'
name|'test_get_resize_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vcpus'
op|'='
number|'2'
newline|'\n'
name|'memory_mb'
op|'='
number|'2048'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
op|')'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_resize_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'vcpus'
op|','
name|'memory_mb'
op|','
name|'extra_specs'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'memoryMB'
op|'='
name|'memory_mb'
newline|'\n'
name|'expected'
op|'.'
name|'numCPUs'
op|'='
name|'vcpus'
newline|'\n'
name|'cpuAllocation'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ResourceAllocationInfo'"
op|')'
newline|'\n'
name|'cpuAllocation'
op|'.'
name|'reservation'
op|'='
number|'0'
newline|'\n'
name|'cpuAllocation'
op|'.'
name|'limit'
op|'='
op|'-'
number|'1'
newline|'\n'
name|'cpuAllocation'
op|'.'
name|'shares'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:SharesInfo'"
op|')'
newline|'\n'
name|'cpuAllocation'
op|'.'
name|'shares'
op|'.'
name|'level'
op|'='
string|"'normal'"
newline|'\n'
name|'cpuAllocation'
op|'.'
name|'shares'
op|'.'
name|'shares'
op|'='
number|'0'
newline|'\n'
name|'expected'
op|'.'
name|'cpuAllocation'
op|'='
name|'cpuAllocation'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_resize_spec_with_limits
dedent|''
name|'def'
name|'test_get_resize_spec_with_limits'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vcpus'
op|'='
number|'2'
newline|'\n'
name|'memory_mb'
op|'='
number|'2048'
newline|'\n'
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'Limits'
op|'('
name|'limit'
op|'='
number|'7'
op|','
nl|'\n'
name|'reservation'
op|'='
number|'6'
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_resize_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'vcpus'
op|','
name|'memory_mb'
op|','
name|'extra_specs'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'memoryMB'
op|'='
name|'memory_mb'
newline|'\n'
name|'expected'
op|'.'
name|'numCPUs'
op|'='
name|'vcpus'
newline|'\n'
name|'cpuAllocation'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ResourceAllocationInfo'"
op|')'
newline|'\n'
name|'cpuAllocation'
op|'.'
name|'reservation'
op|'='
number|'6'
newline|'\n'
name|'cpuAllocation'
op|'.'
name|'limit'
op|'='
number|'7'
newline|'\n'
name|'cpuAllocation'
op|'.'
name|'shares'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:SharesInfo'"
op|')'
newline|'\n'
name|'cpuAllocation'
op|'.'
name|'shares'
op|'.'
name|'level'
op|'='
string|"'normal'"
newline|'\n'
name|'cpuAllocation'
op|'.'
name|'shares'
op|'.'
name|'shares'
op|'='
number|'0'
newline|'\n'
name|'expected'
op|'.'
name|'cpuAllocation'
op|'='
name|'cpuAllocation'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_cdrom_attach_config_spec
dedent|''
name|'def'
name|'test_get_cdrom_attach_config_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'datastore'
op|'='
name|'fake'
op|'.'
name|'Datastore'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_cdrom_attach_config_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'datastore'
op|','
nl|'\n'
string|'"/tmp/foo.iso"'
op|','
nl|'\n'
number|'200'
op|','
number|'0'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'='
op|'['
op|']'
newline|'\n'
name|'device_change'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualDeviceConfigSpec'"
op|')'
newline|'\n'
name|'device_change'
op|'.'
name|'operation'
op|'='
string|"'add'"
newline|'\n'
nl|'\n'
name|'device_change'
op|'.'
name|'device'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualCdrom'"
op|')'
newline|'\n'
name|'device_change'
op|'.'
name|'device'
op|'.'
name|'controllerKey'
op|'='
number|'200'
newline|'\n'
name|'device_change'
op|'.'
name|'device'
op|'.'
name|'unitNumber'
op|'='
number|'0'
newline|'\n'
name|'device_change'
op|'.'
name|'device'
op|'.'
name|'key'
op|'='
op|'-'
number|'1'
newline|'\n'
nl|'\n'
name|'connectable'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualDeviceConnectInfo'"
op|')'
newline|'\n'
name|'connectable'
op|'.'
name|'allowGuestControl'
op|'='
name|'False'
newline|'\n'
name|'connectable'
op|'.'
name|'startConnected'
op|'='
name|'True'
newline|'\n'
name|'connectable'
op|'.'
name|'connected'
op|'='
name|'True'
newline|'\n'
name|'device_change'
op|'.'
name|'device'
op|'.'
name|'connectable'
op|'='
name|'connectable'
newline|'\n'
nl|'\n'
name|'backing'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualCdromIsoBackingInfo'"
op|')'
newline|'\n'
name|'backing'
op|'.'
name|'fileName'
op|'='
string|"'/tmp/foo.iso'"
newline|'\n'
name|'backing'
op|'.'
name|'datastore'
op|'='
name|'datastore'
newline|'\n'
name|'device_change'
op|'.'
name|'device'
op|'.'
name|'backing'
op|'='
name|'backing'
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'.'
name|'append'
op|'('
name|'device_change'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_lsilogic_controller_spec
dedent|''
name|'def'
name|'test_lsilogic_controller_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test controller spec returned for lsiLogic sas adapter type'
nl|'\n'
indent|'        '
name|'config_spec'
op|'='
name|'vm_util'
op|'.'
name|'create_controller_spec'
op|'('
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
op|'-'
number|'101'
op|','
nl|'\n'
name|'adapter_type'
op|'='
name|'constants'
op|'.'
name|'ADAPTER_TYPE_LSILOGICSAS'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"ns0:VirtualLsiLogicSASController"'
op|','
nl|'\n'
name|'config_spec'
op|'.'
name|'device'
op|'.'
name|'obj_name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_paravirtual_controller_spec
dedent|''
name|'def'
name|'test_paravirtual_controller_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test controller spec returned for paraVirtual adapter type'
nl|'\n'
indent|'        '
name|'config_spec'
op|'='
name|'vm_util'
op|'.'
name|'create_controller_spec'
op|'('
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
op|'-'
number|'101'
op|','
nl|'\n'
name|'adapter_type'
op|'='
name|'constants'
op|'.'
name|'ADAPTER_TYPE_PARAVIRTUAL'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"ns0:ParaVirtualSCSIController"'
op|','
nl|'\n'
name|'config_spec'
op|'.'
name|'device'
op|'.'
name|'obj_name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_vmdk_path_and_adapter_type_devices
dedent|''
name|'def'
name|'_vmdk_path_and_adapter_type_devices'
op|'('
name|'self'
op|','
name|'filename'
op|','
name|'parent'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# Test the adapter_type returned for a lsiLogic sas controller'
nl|'\n'
indent|'        '
name|'controller_key'
op|'='
number|'1000'
newline|'\n'
name|'disk'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
op|')'
newline|'\n'
name|'disk'
op|'.'
name|'controllerKey'
op|'='
name|'controller_key'
newline|'\n'
name|'disk_backing'
op|'='
name|'fake'
op|'.'
name|'VirtualDiskFlatVer2BackingInfo'
op|'('
op|')'
newline|'\n'
name|'disk_backing'
op|'.'
name|'fileName'
op|'='
name|'filename'
newline|'\n'
name|'disk'
op|'.'
name|'capacityInBytes'
op|'='
number|'1024'
newline|'\n'
name|'if'
name|'parent'
op|':'
newline|'\n'
indent|'            '
name|'disk_backing'
op|'.'
name|'parent'
op|'='
name|'parent'
newline|'\n'
dedent|''
name|'disk'
op|'.'
name|'backing'
op|'='
name|'disk_backing'
newline|'\n'
comment|'# Ephemeral disk'
nl|'\n'
name|'e_disk'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
op|')'
newline|'\n'
name|'e_disk'
op|'.'
name|'controllerKey'
op|'='
name|'controller_key'
newline|'\n'
name|'disk_backing'
op|'='
name|'fake'
op|'.'
name|'VirtualDiskFlatVer2BackingInfo'
op|'('
op|')'
newline|'\n'
name|'disk_backing'
op|'.'
name|'fileName'
op|'='
string|"'[test_datastore] uuid/ephemeral_0.vmdk'"
newline|'\n'
name|'e_disk'
op|'.'
name|'capacityInBytes'
op|'='
number|'512'
newline|'\n'
name|'e_disk'
op|'.'
name|'backing'
op|'='
name|'disk_backing'
newline|'\n'
name|'controller'
op|'='
name|'fake'
op|'.'
name|'VirtualLsiLogicSASController'
op|'('
op|')'
newline|'\n'
name|'controller'
op|'.'
name|'key'
op|'='
name|'controller_key'
newline|'\n'
name|'devices'
op|'='
op|'['
name|'disk'
op|','
name|'e_disk'
op|','
name|'controller'
op|']'
newline|'\n'
name|'return'
name|'devices'
newline|'\n'
nl|'\n'
DECL|member|test_get_vmdk_path_and_adapter_type
dedent|''
name|'def'
name|'test_get_vmdk_path_and_adapter_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filename'
op|'='
string|"'[test_datastore] uuid/uuid.vmdk'"
newline|'\n'
name|'devices'
op|'='
name|'self'
op|'.'
name|'_vmdk_path_and_adapter_type_devices'
op|'('
name|'filename'
op|')'
newline|'\n'
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
name|'return_value'
op|'='
name|'devices'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vmdk'
op|'='
name|'vm_util'
op|'.'
name|'get_vmdk_info'
op|'('
name|'session'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'constants'
op|'.'
name|'ADAPTER_TYPE_LSILOGICSAS'
op|','
nl|'\n'
name|'vmdk'
op|'.'
name|'adapter_type'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'[test_datastore] uuid/ephemeral_0.vmdk'"
op|','
nl|'\n'
name|'vmdk'
op|'.'
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'512'
op|','
name|'vmdk'
op|'.'
name|'capacity_in_bytes'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'devices'
op|'['
number|'1'
op|']'
op|','
name|'vmdk'
op|'.'
name|'device'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vmdk_path_and_adapter_type_with_match
dedent|''
dedent|''
name|'def'
name|'test_get_vmdk_path_and_adapter_type_with_match'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'n_filename'
op|'='
string|"'[test_datastore] uuid/uuid.vmdk'"
newline|'\n'
name|'devices'
op|'='
name|'self'
op|'.'
name|'_vmdk_path_and_adapter_type_devices'
op|'('
name|'n_filename'
op|')'
newline|'\n'
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
name|'return_value'
op|'='
name|'devices'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vmdk'
op|'='
name|'vm_util'
op|'.'
name|'get_vmdk_info'
op|'('
name|'session'
op|','
name|'None'
op|','
name|'uuid'
op|'='
string|"'uuid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'constants'
op|'.'
name|'ADAPTER_TYPE_LSILOGICSAS'
op|','
nl|'\n'
name|'vmdk'
op|'.'
name|'adapter_type'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'n_filename'
op|','
name|'vmdk'
op|'.'
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1024'
op|','
name|'vmdk'
op|'.'
name|'capacity_in_bytes'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'devices'
op|'['
number|'0'
op|']'
op|','
name|'vmdk'
op|'.'
name|'device'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vmdk_path_and_adapter_type_with_nomatch
dedent|''
dedent|''
name|'def'
name|'test_get_vmdk_path_and_adapter_type_with_nomatch'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'n_filename'
op|'='
string|"'[test_datastore] diuu/diuu.vmdk'"
newline|'\n'
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'devices'
op|'='
name|'self'
op|'.'
name|'_vmdk_path_and_adapter_type_devices'
op|'('
name|'n_filename'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
name|'return_value'
op|'='
name|'devices'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vmdk'
op|'='
name|'vm_util'
op|'.'
name|'get_vmdk_info'
op|'('
name|'session'
op|','
name|'None'
op|','
name|'uuid'
op|'='
string|"'uuid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'vmdk'
op|'.'
name|'adapter_type'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'vmdk'
op|'.'
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'vmdk'
op|'.'
name|'capacity_in_bytes'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'vmdk'
op|'.'
name|'device'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vmdk_adapter_type
dedent|''
dedent|''
name|'def'
name|'test_get_vmdk_adapter_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test for the adapter_type to be used in vmdk descriptor'
nl|'\n'
comment|'# Adapter type in vmdk descriptor is same for LSI-SAS, LSILogic'
nl|'\n'
comment|'# and ParaVirtual'
nl|'\n'
indent|'        '
name|'vmdk_adapter_type'
op|'='
name|'vm_util'
op|'.'
name|'get_vmdk_adapter_type'
op|'('
nl|'\n'
name|'constants'
op|'.'
name|'DEFAULT_ADAPTER_TYPE'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'constants'
op|'.'
name|'DEFAULT_ADAPTER_TYPE'
op|','
name|'vmdk_adapter_type'
op|')'
newline|'\n'
name|'vmdk_adapter_type'
op|'='
name|'vm_util'
op|'.'
name|'get_vmdk_adapter_type'
op|'('
nl|'\n'
name|'constants'
op|'.'
name|'ADAPTER_TYPE_LSILOGICSAS'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'constants'
op|'.'
name|'DEFAULT_ADAPTER_TYPE'
op|','
name|'vmdk_adapter_type'
op|')'
newline|'\n'
name|'vmdk_adapter_type'
op|'='
name|'vm_util'
op|'.'
name|'get_vmdk_adapter_type'
op|'('
nl|'\n'
name|'constants'
op|'.'
name|'ADAPTER_TYPE_PARAVIRTUAL'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'constants'
op|'.'
name|'DEFAULT_ADAPTER_TYPE'
op|','
name|'vmdk_adapter_type'
op|')'
newline|'\n'
name|'vmdk_adapter_type'
op|'='
name|'vm_util'
op|'.'
name|'get_vmdk_adapter_type'
op|'('
string|'"dummyAdapter"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"dummyAdapter"'
op|','
name|'vmdk_adapter_type'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_scsi_adapter_type
dedent|''
name|'def'
name|'test_get_scsi_adapter_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vm'
op|'='
name|'fake'
op|'.'
name|'VirtualMachine'
op|'('
op|')'
newline|'\n'
name|'devices'
op|'='
name|'vm'
op|'.'
name|'get'
op|'('
string|'"config.hardware.device"'
op|')'
op|'.'
name|'VirtualDevice'
newline|'\n'
name|'scsi_controller'
op|'='
name|'fake'
op|'.'
name|'VirtualLsiLogicController'
op|'('
op|')'
newline|'\n'
name|'ide_controller'
op|'='
name|'fake'
op|'.'
name|'VirtualIDEController'
op|'('
op|')'
newline|'\n'
name|'devices'
op|'.'
name|'append'
op|'('
name|'scsi_controller'
op|')'
newline|'\n'
name|'devices'
op|'.'
name|'append'
op|'('
name|'ide_controller'
op|')'
newline|'\n'
name|'fake'
op|'.'
name|'_update_object'
op|'('
string|'"VirtualMachine"'
op|','
name|'vm'
op|')'
newline|'\n'
comment|'# return the scsi type, not ide'
nl|'\n'
name|'hardware_device'
op|'='
name|'vm'
op|'.'
name|'get'
op|'('
string|'"config.hardware.device"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'constants'
op|'.'
name|'DEFAULT_ADAPTER_TYPE'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'get_scsi_adapter_type'
op|'('
name|'hardware_device'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_scsi_adapter_type_with_error
dedent|''
name|'def'
name|'test_get_scsi_adapter_type_with_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vm'
op|'='
name|'fake'
op|'.'
name|'VirtualMachine'
op|'('
op|')'
newline|'\n'
name|'devices'
op|'='
name|'vm'
op|'.'
name|'get'
op|'('
string|'"config.hardware.device"'
op|')'
op|'.'
name|'VirtualDevice'
newline|'\n'
name|'scsi_controller'
op|'='
name|'fake'
op|'.'
name|'VirtualLsiLogicController'
op|'('
op|')'
newline|'\n'
name|'ide_controller'
op|'='
name|'fake'
op|'.'
name|'VirtualIDEController'
op|'('
op|')'
newline|'\n'
name|'devices'
op|'.'
name|'append'
op|'('
name|'scsi_controller'
op|')'
newline|'\n'
name|'devices'
op|'.'
name|'append'
op|'('
name|'ide_controller'
op|')'
newline|'\n'
name|'fake'
op|'.'
name|'_update_object'
op|'('
string|'"VirtualMachine"'
op|','
name|'vm'
op|')'
newline|'\n'
comment|'# the controller is not suitable since the device under this controller'
nl|'\n'
comment|'# has exceeded SCSI_MAX_CONNECT_NUMBER'
nl|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'0'
op|','
name|'constants'
op|'.'
name|'SCSI_MAX_CONNECT_NUMBER'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'scsi_controller'
op|'.'
name|'device'
op|'.'
name|'append'
op|'('
string|"'device'"
op|'+'
name|'str'
op|'('
name|'i'
op|')'
op|')'
newline|'\n'
dedent|''
name|'hardware_device'
op|'='
name|'vm'
op|'.'
name|'get'
op|'('
string|'"config.hardware.device"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'StorageError'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'get_scsi_adapter_type'
op|','
nl|'\n'
name|'hardware_device'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_find_allocated_slots
dedent|''
name|'def'
name|'test_find_allocated_slots'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'disk1'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
number|'200'
op|','
number|'0'
op|')'
newline|'\n'
name|'disk2'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
number|'200'
op|','
number|'1'
op|')'
newline|'\n'
name|'disk3'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
number|'201'
op|','
number|'1'
op|')'
newline|'\n'
name|'ide0'
op|'='
name|'fake'
op|'.'
name|'VirtualIDEController'
op|'('
number|'200'
op|')'
newline|'\n'
name|'ide1'
op|'='
name|'fake'
op|'.'
name|'VirtualIDEController'
op|'('
number|'201'
op|')'
newline|'\n'
name|'scsi0'
op|'='
name|'fake'
op|'.'
name|'VirtualLsiLogicController'
op|'('
name|'key'
op|'='
number|'1000'
op|','
name|'scsiCtlrUnitNumber'
op|'='
number|'7'
op|')'
newline|'\n'
name|'devices'
op|'='
op|'['
name|'disk1'
op|','
name|'disk2'
op|','
name|'disk3'
op|','
name|'ide0'
op|','
name|'ide1'
op|','
name|'scsi0'
op|']'
newline|'\n'
name|'taken'
op|'='
name|'vm_util'
op|'.'
name|'_find_allocated_slots'
op|'('
name|'devices'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
number|'0'
op|','
number|'1'
op|']'
op|','
name|'sorted'
op|'('
name|'taken'
op|'['
number|'200'
op|']'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
number|'1'
op|']'
op|','
name|'taken'
op|'['
number|'201'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
number|'7'
op|']'
op|','
name|'taken'
op|'['
number|'1000'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_allocate_controller_key_and_unit_number_ide_default
dedent|''
name|'def'
name|'test_allocate_controller_key_and_unit_number_ide_default'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test that default IDE controllers are used when there is a free slot'
nl|'\n'
comment|'# on them'
nl|'\n'
indent|'        '
name|'disk1'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
number|'200'
op|','
number|'0'
op|')'
newline|'\n'
name|'disk2'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
number|'200'
op|','
number|'1'
op|')'
newline|'\n'
name|'ide0'
op|'='
name|'fake'
op|'.'
name|'VirtualIDEController'
op|'('
number|'200'
op|')'
newline|'\n'
name|'ide1'
op|'='
name|'fake'
op|'.'
name|'VirtualIDEController'
op|'('
number|'201'
op|')'
newline|'\n'
name|'devices'
op|'='
op|'['
name|'disk1'
op|','
name|'disk2'
op|','
name|'ide0'
op|','
name|'ide1'
op|']'
newline|'\n'
op|'('
name|'controller_key'
op|','
name|'unit_number'
op|','
nl|'\n'
name|'controller_spec'
op|')'
op|'='
name|'vm_util'
op|'.'
name|'allocate_controller_key_and_unit_number'
op|'('
nl|'\n'
name|'None'
op|','
nl|'\n'
name|'devices'
op|','
nl|'\n'
string|"'ide'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'201'
op|','
name|'controller_key'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'unit_number'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'controller_spec'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_allocate_controller_key_and_unit_number_ide
dedent|''
name|'def'
name|'test_allocate_controller_key_and_unit_number_ide'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test that a new controller is created when there is no free slot on'
nl|'\n'
comment|'# the default IDE controllers'
nl|'\n'
indent|'        '
name|'ide0'
op|'='
name|'fake'
op|'.'
name|'VirtualIDEController'
op|'('
number|'200'
op|')'
newline|'\n'
name|'ide1'
op|'='
name|'fake'
op|'.'
name|'VirtualIDEController'
op|'('
number|'201'
op|')'
newline|'\n'
name|'devices'
op|'='
op|'['
name|'ide0'
op|','
name|'ide1'
op|']'
newline|'\n'
name|'for'
name|'controller_key'
name|'in'
op|'['
number|'200'
op|','
number|'201'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'unit_number'
name|'in'
op|'['
number|'0'
op|','
number|'1'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'disk'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
name|'controller_key'
op|','
name|'unit_number'
op|')'
newline|'\n'
name|'devices'
op|'.'
name|'append'
op|'('
name|'disk'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
op|'('
name|'controller_key'
op|','
name|'unit_number'
op|','
nl|'\n'
name|'controller_spec'
op|')'
op|'='
name|'vm_util'
op|'.'
name|'allocate_controller_key_and_unit_number'
op|'('
nl|'\n'
name|'factory'
op|','
nl|'\n'
name|'devices'
op|','
nl|'\n'
string|"'ide'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'-'
number|'101'
op|','
name|'controller_key'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'unit_number'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNotNone'
op|'('
name|'controller_spec'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_allocate_controller_key_and_unit_number_scsi
dedent|''
name|'def'
name|'test_allocate_controller_key_and_unit_number_scsi'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test that we allocate on existing SCSI controller if there is a free'
nl|'\n'
comment|'# slot on it'
nl|'\n'
indent|'        '
name|'devices'
op|'='
op|'['
name|'fake'
op|'.'
name|'VirtualLsiLogicController'
op|'('
number|'1000'
op|','
name|'scsiCtlrUnitNumber'
op|'='
number|'7'
op|')'
op|']'
newline|'\n'
name|'for'
name|'unit_number'
name|'in'
name|'range'
op|'('
number|'7'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'disk'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
number|'1000'
op|','
name|'unit_number'
op|')'
newline|'\n'
name|'devices'
op|'.'
name|'append'
op|'('
name|'disk'
op|')'
newline|'\n'
dedent|''
name|'factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
op|'('
name|'controller_key'
op|','
name|'unit_number'
op|','
nl|'\n'
name|'controller_spec'
op|')'
op|'='
name|'vm_util'
op|'.'
name|'allocate_controller_key_and_unit_number'
op|'('
nl|'\n'
name|'factory'
op|','
nl|'\n'
name|'devices'
op|','
nl|'\n'
name|'constants'
op|'.'
name|'DEFAULT_ADAPTER_TYPE'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1000'
op|','
name|'controller_key'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'8'
op|','
name|'unit_number'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'controller_spec'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vnc_config_spec
dedent|''
name|'def'
name|'test_get_vnc_config_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vnc_config_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
number|'7'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'remote_display_vnc_enabled'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:OptionValue'"
op|')'
newline|'\n'
name|'remote_display_vnc_enabled'
op|'.'
name|'value'
op|'='
string|"'true'"
newline|'\n'
name|'remote_display_vnc_enabled'
op|'.'
name|'key'
op|'='
string|"'RemoteDisplay.vnc.enabled'"
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'remote_display_vnc_enabled'
op|')'
newline|'\n'
nl|'\n'
name|'remote_display_vnc_port'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:OptionValue'"
op|')'
newline|'\n'
name|'remote_display_vnc_port'
op|'.'
name|'value'
op|'='
number|'7'
newline|'\n'
name|'remote_display_vnc_port'
op|'.'
name|'key'
op|'='
string|"'RemoteDisplay.vnc.port'"
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'remote_display_vnc_port'
op|')'
newline|'\n'
nl|'\n'
name|'remote_display_vnc_keymap'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:OptionValue'"
op|')'
newline|'\n'
name|'remote_display_vnc_keymap'
op|'.'
name|'value'
op|'='
string|"'en-us'"
newline|'\n'
name|'remote_display_vnc_keymap'
op|'.'
name|'key'
op|'='
string|"'RemoteDisplay.vnc.keyMap'"
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'remote_display_vnc_keymap'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_create_fake_vms
dedent|''
name|'def'
name|'_create_fake_vms'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_vms'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'OptionValue'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'OptionValue'"
op|','
op|'['
string|"'key'"
op|','
string|"'value'"
op|']'
op|')'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm'
op|'='
name|'fake'
op|'.'
name|'ManagedObject'
op|'('
op|')'
newline|'\n'
name|'opt_val'
op|'='
name|'OptionValue'
op|'('
name|'key'
op|'='
string|"''"
op|','
name|'value'
op|'='
number|'5900'
op|'+'
name|'i'
op|')'
newline|'\n'
name|'vm'
op|'.'
name|'set'
op|'('
name|'vm_util'
op|'.'
name|'VNC_CONFIG_KEY'
op|','
name|'opt_val'
op|')'
newline|'\n'
name|'fake_vms'
op|'.'
name|'add_object'
op|'('
name|'vm'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'fake_vms'
newline|'\n'
nl|'\n'
DECL|member|test_get_vnc_port
dedent|''
name|'def'
name|'test_get_vnc_port'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_vms'
op|'='
name|'self'
op|'.'
name|'_create_fake_vms'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'vnc_port'
op|'='
number|'5900'
op|','
name|'group'
op|'='
string|"'vmware'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'vnc_port_total'
op|'='
number|'10000'
op|','
name|'group'
op|'='
string|"'vmware'"
op|')'
newline|'\n'
name|'actual'
op|'='
name|'vm_util'
op|'.'
name|'get_vnc_port'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'fake_vms'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'actual'
op|','
number|'5910'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vnc_port_exhausted
dedent|''
name|'def'
name|'test_get_vnc_port_exhausted'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_vms'
op|'='
name|'self'
op|'.'
name|'_create_fake_vms'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'vnc_port'
op|'='
number|'5900'
op|','
name|'group'
op|'='
string|"'vmware'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'vnc_port_total'
op|'='
number|'10'
op|','
name|'group'
op|'='
string|"'vmware'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'ConsolePortRangeExhausted'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'get_vnc_port'
op|','
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'fake_vms'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_all_cluster_refs_by_name_none
dedent|''
name|'def'
name|'test_get_all_cluster_refs_by_name_none'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_objects'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'refs'
op|'='
name|'vm_util'
op|'.'
name|'get_all_cluster_refs_by_name'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'fake_objects'
op|')'
op|','
op|'['
string|"'fake_cluster'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'{'
op|'}'
op|','
name|'refs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_all_cluster_refs_by_name_exists
dedent|''
name|'def'
name|'test_get_all_cluster_refs_by_name_exists'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_objects'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'fake'
op|'.'
name|'ClusterComputeResource'
op|'('
name|'name'
op|'='
string|"'cluster'"
op|')'
op|')'
newline|'\n'
name|'refs'
op|'='
name|'vm_util'
op|'.'
name|'get_all_cluster_refs_by_name'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'fake_objects'
op|')'
op|','
op|'['
string|"'cluster'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'refs'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_all_cluster_refs_by_name_missing
dedent|''
name|'def'
name|'test_get_all_cluster_refs_by_name_missing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_objects'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'partialObject'
op|'('
name|'path'
op|'='
string|"'cluster'"
op|')'
op|')'
newline|'\n'
name|'refs'
op|'='
name|'vm_util'
op|'.'
name|'get_all_cluster_refs_by_name'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'fake_objects'
op|')'
op|','
op|'['
string|"'cluster'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'{'
op|'}'
op|','
name|'refs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_propset_dict_simple
dedent|''
name|'def'
name|'test_propset_dict_simple'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ObjectContent'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'ObjectContent'"
op|','
op|'['
string|"'propSet'"
op|']'
op|')'
newline|'\n'
name|'DynamicProperty'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'Property'"
op|','
op|'['
string|"'name'"
op|','
string|"'val'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'object'
op|'='
name|'ObjectContent'
op|'('
name|'propSet'
op|'='
op|'['
nl|'\n'
name|'DynamicProperty'
op|'('
name|'name'
op|'='
string|"'foo'"
op|','
name|'val'
op|'='
string|'"bar"'
op|')'
op|']'
op|')'
newline|'\n'
name|'propdict'
op|'='
name|'vm_util'
op|'.'
name|'propset_dict'
op|'('
name|'object'
op|'.'
name|'propSet'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"bar"'
op|','
name|'propdict'
op|'['
string|"'foo'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_propset_dict_complex
dedent|''
name|'def'
name|'test_propset_dict_complex'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ObjectContent'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'ObjectContent'"
op|','
op|'['
string|"'propSet'"
op|']'
op|')'
newline|'\n'
name|'DynamicProperty'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'Property'"
op|','
op|'['
string|"'name'"
op|','
string|"'val'"
op|']'
op|')'
newline|'\n'
name|'MoRef'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'Val'"
op|','
op|'['
string|"'value'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'object'
op|'='
name|'ObjectContent'
op|'('
name|'propSet'
op|'='
op|'['
nl|'\n'
name|'DynamicProperty'
op|'('
name|'name'
op|'='
string|"'foo'"
op|','
name|'val'
op|'='
string|'"bar"'
op|')'
op|','
nl|'\n'
name|'DynamicProperty'
op|'('
name|'name'
op|'='
string|"'some.thing'"
op|','
nl|'\n'
name|'val'
op|'='
name|'MoRef'
op|'('
name|'value'
op|'='
string|"'else'"
op|')'
op|')'
op|','
nl|'\n'
name|'DynamicProperty'
op|'('
name|'name'
op|'='
string|"'another.thing'"
op|','
name|'val'
op|'='
string|"'value'"
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'propdict'
op|'='
name|'vm_util'
op|'.'
name|'propset_dict'
op|'('
name|'object'
op|'.'
name|'propSet'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"bar"'
op|','
name|'propdict'
op|'['
string|"'foo'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'hasattr'
op|'('
name|'propdict'
op|'['
string|"'some.thing'"
op|']'
op|','
string|"'value'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"else"'
op|','
name|'propdict'
op|'['
string|"'some.thing'"
op|']'
op|'.'
name|'value'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"value"'
op|','
name|'propdict'
op|'['
string|"'another.thing'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_detach_virtual_disk_spec
dedent|''
name|'def'
name|'_test_detach_virtual_disk_spec'
op|'('
name|'self'
op|','
name|'destroy_disk'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'virtual_device_config'
op|'='
name|'vm_util'
op|'.'
name|'detach_virtual_disk_spec'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
nl|'\n'
string|"'fake_device'"
op|','
nl|'\n'
name|'destroy_disk'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'remove'"
op|','
name|'virtual_device_config'
op|'.'
name|'operation'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'fake_device'"
op|','
name|'virtual_device_config'
op|'.'
name|'device'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'ns0:VirtualDeviceConfigSpec'"
op|','
nl|'\n'
name|'virtual_device_config'
op|'.'
name|'obj_name'
op|')'
newline|'\n'
name|'if'
name|'destroy_disk'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'destroy'"
op|','
name|'virtual_device_config'
op|'.'
name|'fileOperation'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'hasattr'
op|'('
name|'virtual_device_config'
op|','
string|"'fileOperation'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_detach_virtual_disk_spec
dedent|''
dedent|''
name|'def'
name|'test_detach_virtual_disk_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_detach_virtual_disk_spec'
op|'('
name|'destroy_disk'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_detach_virtual_disk_destroy_spec
dedent|''
name|'def'
name|'test_detach_virtual_disk_destroy_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_detach_virtual_disk_spec'
op|'('
name|'destroy_disk'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_create_vm_config_spec
dedent|''
name|'def'
name|'_create_vm_config_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'spec'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'spec'
op|'.'
name|'name'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'spec'
op|'.'
name|'instanceUuid'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'spec'
op|'.'
name|'deviceChange'
op|'='
op|'['
op|']'
newline|'\n'
name|'spec'
op|'.'
name|'numCPUs'
op|'='
number|'2'
newline|'\n'
nl|'\n'
name|'spec'
op|'.'
name|'version'
op|'='
name|'None'
newline|'\n'
name|'spec'
op|'.'
name|'memoryMB'
op|'='
number|'2048'
newline|'\n'
name|'spec'
op|'.'
name|'guestId'
op|'='
string|"'otherGuest'"
newline|'\n'
name|'spec'
op|'.'
name|'extraConfig'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'extra_config'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|'"ns0:OptionValue"'
op|')'
newline|'\n'
name|'extra_config'
op|'.'
name|'value'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'extra_config'
op|'.'
name|'key'
op|'='
string|"'nvp.vm-uuid'"
newline|'\n'
name|'spec'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'extra_config'
op|')'
newline|'\n'
name|'spec'
op|'.'
name|'files'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineFileInfo'"
op|')'
newline|'\n'
name|'spec'
op|'.'
name|'files'
op|'.'
name|'vmPathName'
op|'='
string|"'[fake-datastore]'"
newline|'\n'
nl|'\n'
name|'spec'
op|'.'
name|'managedBy'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ManagedByInfo'"
op|')'
newline|'\n'
name|'spec'
op|'.'
name|'managedBy'
op|'.'
name|'extensionKey'
op|'='
string|"'org.openstack.compute'"
newline|'\n'
name|'spec'
op|'.'
name|'managedBy'
op|'.'
name|'type'
op|'='
string|"'instance'"
newline|'\n'
nl|'\n'
name|'spec'
op|'.'
name|'tools'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ToolsConfigInfo'"
op|')'
newline|'\n'
name|'spec'
op|'.'
name|'tools'
op|'.'
name|'afterPowerOn'
op|'='
name|'True'
newline|'\n'
name|'spec'
op|'.'
name|'tools'
op|'.'
name|'afterResume'
op|'='
name|'True'
newline|'\n'
name|'spec'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestReboot'
op|'='
name|'True'
newline|'\n'
name|'spec'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestShutdown'
op|'='
name|'True'
newline|'\n'
name|'spec'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestStandby'
op|'='
name|'True'
newline|'\n'
name|'return'
name|'spec'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec
dedent|''
name|'def'
name|'test_get_vm_create_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
op|')'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
name|'self'
op|'.'
name|'_create_vm_config_spec'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'version'
op|'='
name|'None'
newline|'\n'
name|'expected'
op|'.'
name|'memoryMB'
op|'='
number|'2048'
newline|'\n'
name|'expected'
op|'.'
name|'guestId'
op|'='
name|'constants'
op|'.'
name|'DEFAULT_OS_TYPE'
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec_with_serial_port
dedent|''
name|'def'
name|'test_get_vm_create_spec_with_serial_port'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
op|')'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'serial_port_service_uri'
op|'='
string|"'foobar'"
op|','
name|'group'
op|'='
string|"'vmware'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'serial_port_proxy_uri'
op|'='
string|"'telnet://example.com:31337'"
op|','
nl|'\n'
name|'group'
op|'='
string|"'vmware'"
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
name|'serial_port_spec'
op|'='
name|'vm_util'
op|'.'
name|'create_serial_port_spec'
op|'('
name|'fake_factory'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'self'
op|'.'
name|'_create_vm_config_spec'
op|'('
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'='
op|'['
name|'serial_port_spec'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec_with_allocations
dedent|''
name|'def'
name|'test_get_vm_create_spec_with_allocations'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'Limits'
op|'('
name|'limit'
op|'='
number|'7'
op|','
nl|'\n'
name|'reservation'
op|'='
number|'6'
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'='
op|'['
op|']'
newline|'\n'
name|'expected'
op|'.'
name|'guestId'
op|'='
name|'constants'
op|'.'
name|'DEFAULT_OS_TYPE'
newline|'\n'
name|'expected'
op|'.'
name|'instanceUuid'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'memoryMB'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'memory_mb'
newline|'\n'
name|'expected'
op|'.'
name|'name'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'numCPUs'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'vcpus'
newline|'\n'
name|'expected'
op|'.'
name|'version'
op|'='
name|'None'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'files'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineFileInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'files'
op|'.'
name|'vmPathName'
op|'='
string|"'[fake-datastore]'"
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'tools'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ToolsConfigInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterPowerOn'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterResume'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestReboot'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestShutdown'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestStandby'
op|'='
name|'True'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ManagedByInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'extensionKey'
op|'='
string|"'org.openstack.compute'"
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'type'
op|'='
string|"'instance'"
newline|'\n'
nl|'\n'
name|'cpu_allocation'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ResourceAllocationInfo'"
op|')'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'limit'
op|'='
number|'7'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'reservation'
op|'='
number|'6'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'shares'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:SharesInfo'"
op|')'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'shares'
op|'.'
name|'level'
op|'='
string|"'normal'"
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'shares'
op|'.'
name|'shares'
op|'='
number|'0'
newline|'\n'
name|'expected'
op|'.'
name|'cpuAllocation'
op|'='
name|'cpu_allocation'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'='
op|'['
op|']'
newline|'\n'
name|'extra_config'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:OptionValue'"
op|')'
newline|'\n'
name|'extra_config'
op|'.'
name|'key'
op|'='
string|"'nvp.vm-uuid'"
newline|'\n'
name|'extra_config'
op|'.'
name|'value'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'extra_config'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec_with_limit
dedent|''
name|'def'
name|'test_get_vm_create_spec_with_limit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'Limits'
op|'('
name|'limit'
op|'='
number|'7'
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'files'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineFileInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'files'
op|'.'
name|'vmPathName'
op|'='
string|"'[fake-datastore]'"
newline|'\n'
name|'expected'
op|'.'
name|'instanceUuid'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'name'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'='
op|'['
op|']'
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'extra_config'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|'"ns0:OptionValue"'
op|')'
newline|'\n'
name|'extra_config'
op|'.'
name|'value'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'extra_config'
op|'.'
name|'key'
op|'='
string|"'nvp.vm-uuid'"
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'extra_config'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'memoryMB'
op|'='
number|'2048'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ManagedByInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'extensionKey'
op|'='
string|"'org.openstack.compute'"
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'type'
op|'='
string|"'instance'"
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'version'
op|'='
name|'None'
newline|'\n'
name|'expected'
op|'.'
name|'guestId'
op|'='
name|'constants'
op|'.'
name|'DEFAULT_OS_TYPE'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'tools'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ToolsConfigInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterPowerOn'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterResume'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestReboot'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestShutdown'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestStandby'
op|'='
name|'True'
newline|'\n'
nl|'\n'
name|'cpu_allocation'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ResourceAllocationInfo'"
op|')'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'limit'
op|'='
number|'7'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'reservation'
op|'='
number|'0'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'shares'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:SharesInfo'"
op|')'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'shares'
op|'.'
name|'level'
op|'='
string|"'normal'"
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'shares'
op|'.'
name|'shares'
op|'='
number|'0'
newline|'\n'
name|'expected'
op|'.'
name|'cpuAllocation'
op|'='
name|'cpu_allocation'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'numCPUs'
op|'='
number|'2'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec_with_share
dedent|''
name|'def'
name|'test_get_vm_create_spec_with_share'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'Limits'
op|'('
name|'shares_level'
op|'='
string|"'high'"
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'files'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineFileInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'files'
op|'.'
name|'vmPathName'
op|'='
string|"'[fake-datastore]'"
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'instanceUuid'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'name'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'='
op|'['
op|']'
newline|'\n'
name|'extra_config'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:OptionValue'"
op|')'
newline|'\n'
name|'extra_config'
op|'.'
name|'value'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'extra_config'
op|'.'
name|'key'
op|'='
string|"'nvp.vm-uuid'"
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'extra_config'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'memoryMB'
op|'='
number|'2048'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ManagedByInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'type'
op|'='
string|"'instance'"
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'extensionKey'
op|'='
string|"'org.openstack.compute'"
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'version'
op|'='
name|'None'
newline|'\n'
name|'expected'
op|'.'
name|'guestId'
op|'='
name|'constants'
op|'.'
name|'DEFAULT_OS_TYPE'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'tools'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ToolsConfigInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestStandby'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestReboot'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestShutdown'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterResume'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterPowerOn'
op|'='
name|'True'
newline|'\n'
nl|'\n'
name|'cpu_allocation'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ResourceAllocationInfo'"
op|')'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'reservation'
op|'='
number|'0'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'limit'
op|'='
op|'-'
number|'1'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'shares'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:SharesInfo'"
op|')'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'shares'
op|'.'
name|'level'
op|'='
string|"'high'"
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'shares'
op|'.'
name|'shares'
op|'='
number|'0'
newline|'\n'
name|'expected'
op|'.'
name|'cpuAllocation'
op|'='
name|'cpu_allocation'
newline|'\n'
name|'expected'
op|'.'
name|'numCPUs'
op|'='
number|'2'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec_with_share_custom
dedent|''
name|'def'
name|'test_get_vm_create_spec_with_share_custom'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'Limits'
op|'('
name|'shares_level'
op|'='
string|"'custom'"
op|','
nl|'\n'
name|'shares_share'
op|'='
number|'1948'
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'files'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineFileInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'files'
op|'.'
name|'vmPathName'
op|'='
string|"'[fake-datastore]'"
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'instanceUuid'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'name'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'='
op|'['
op|']'
newline|'\n'
name|'extra_config'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:OptionValue'"
op|')'
newline|'\n'
name|'extra_config'
op|'.'
name|'key'
op|'='
string|"'nvp.vm-uuid'"
newline|'\n'
name|'extra_config'
op|'.'
name|'value'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'extra_config'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'memoryMB'
op|'='
number|'2048'
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ManagedByInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'extensionKey'
op|'='
string|"'org.openstack.compute'"
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'type'
op|'='
string|"'instance'"
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'version'
op|'='
name|'None'
newline|'\n'
name|'expected'
op|'.'
name|'guestId'
op|'='
name|'constants'
op|'.'
name|'DEFAULT_OS_TYPE'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ToolsConfigInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestStandby'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestReboot'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestShutdown'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterResume'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterPowerOn'
op|'='
name|'True'
newline|'\n'
nl|'\n'
name|'cpu_allocation'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ResourceAllocationInfo'"
op|')'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'reservation'
op|'='
number|'0'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'limit'
op|'='
op|'-'
number|'1'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'shares'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:SharesInfo'"
op|')'
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'shares'
op|'.'
name|'level'
op|'='
string|"'custom'"
newline|'\n'
name|'cpu_allocation'
op|'.'
name|'shares'
op|'.'
name|'shares'
op|'='
number|'1948'
newline|'\n'
name|'expected'
op|'.'
name|'cpuAllocation'
op|'='
name|'cpu_allocation'
newline|'\n'
name|'expected'
op|'.'
name|'numCPUs'
op|'='
number|'2'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec_with_metadata
dedent|''
name|'def'
name|'test_get_vm_create_spec_with_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
op|')'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|','
nl|'\n'
name|'metadata'
op|'='
string|"'fake-metadata'"
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'name'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'instanceUuid'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'='
op|'['
op|']'
newline|'\n'
name|'expected'
op|'.'
name|'numCPUs'
op|'='
number|'2'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'version'
op|'='
name|'None'
newline|'\n'
name|'expected'
op|'.'
name|'memoryMB'
op|'='
number|'2048'
newline|'\n'
name|'expected'
op|'.'
name|'guestId'
op|'='
string|"'otherGuest'"
newline|'\n'
name|'expected'
op|'.'
name|'annotation'
op|'='
string|"'fake-metadata'"
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'extra_config'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|'"ns0:OptionValue"'
op|')'
newline|'\n'
name|'extra_config'
op|'.'
name|'value'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'extra_config'
op|'.'
name|'key'
op|'='
string|"'nvp.vm-uuid'"
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'extra_config'
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'files'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineFileInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'files'
op|'.'
name|'vmPathName'
op|'='
string|"'[fake-datastore]'"
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ManagedByInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'extensionKey'
op|'='
string|"'org.openstack.compute'"
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'type'
op|'='
string|"'instance'"
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'tools'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ToolsConfigInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterPowerOn'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterResume'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestReboot'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestShutdown'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestStandby'
op|'='
name|'True'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_vm
dedent|''
name|'def'
name|'test_create_vm'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'method_list'
op|'='
op|'['
string|"'CreateVM_Task'"
op|','
string|"'get_dynamic_property'"
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_call_method
name|'def'
name|'fake_call_method'
op|'('
name|'module'
op|','
name|'method'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'expected_method'
op|'='
name|'method_list'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_method'
op|','
name|'method'
op|')'
newline|'\n'
name|'if'
op|'('
name|'expected_method'
op|'=='
string|"'CreateVM_Task'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
string|"'fake_create_vm_task'"
newline|'\n'
dedent|''
name|'elif'
op|'('
name|'expected_method'
op|'=='
string|"'get_dynamic_property'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'task_info'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
name|'state'
op|'='
string|'"success"'
op|','
name|'result'
op|'='
string|'"fake_vm_ref"'
op|')'
newline|'\n'
name|'return'
name|'task_info'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'Should not get here....'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|fake_wait_for_task
dedent|''
dedent|''
name|'def'
name|'fake_wait_for_task'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'task_info'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
name|'state'
op|'='
string|'"success"'
op|','
name|'result'
op|'='
string|'"fake_vm_ref"'
op|')'
newline|'\n'
name|'return'
name|'task_info'
newline|'\n'
nl|'\n'
dedent|''
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'fake_call_mock'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
name|'side_effect'
op|'='
name|'fake_call_method'
op|')'
newline|'\n'
name|'fake_wait_mock'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
name|'side_effect'
op|'='
name|'fake_wait_for_task'
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_wait_for_task'"
op|','
nl|'\n'
name|'fake_wait_mock'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'fake_call_mock'
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'wait_for_task'
op|','
name|'call_method'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_ref'
op|'='
name|'vm_util'
op|'.'
name|'create_vm'
op|'('
nl|'\n'
name|'session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake_vm_folder'"
op|','
nl|'\n'
string|"'fake_config_spec'"
op|','
nl|'\n'
string|"'fake_res_pool_ref'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'fake_vm_ref'"
op|','
name|'vm_ref'
op|')'
newline|'\n'
nl|'\n'
name|'call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'ANY'
op|','
string|"'CreateVM_Task'"
op|','
nl|'\n'
string|"'fake_vm_folder'"
op|','
name|'config'
op|'='
string|"'fake_config_spec'"
op|','
nl|'\n'
name|'pool'
op|'='
string|"'fake_res_pool_ref'"
op|')'
newline|'\n'
name|'wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake_create_vm_task'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|'.'
name|'LOG'
op|','
string|"'warning'"
op|')'
newline|'\n'
DECL|member|test_create_vm_invalid_guestid
name|'def'
name|'test_create_vm_invalid_guestid'
op|'('
name|'self'
op|','
name|'mock_log_warn'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Ensure we warn when create_vm() fails after we passed an\n        unrecognised guestId\n        """'
newline|'\n'
nl|'\n'
name|'found'
op|'='
op|'['
name|'False'
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_log_warn
name|'def'
name|'fake_log_warn'
op|'('
name|'msg'
op|','
name|'values'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'isinstance'
op|'('
name|'values'
op|','
name|'dict'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
newline|'\n'
dedent|''
name|'if'
name|'values'
op|'.'
name|'get'
op|'('
string|"'ostype'"
op|')'
op|'=='
string|"'invalid_os_type'"
op|':'
newline|'\n'
indent|'                '
name|'found'
op|'['
number|'0'
op|']'
op|'='
name|'True'
newline|'\n'
dedent|''
dedent|''
name|'mock_log_warn'
op|'.'
name|'side_effect'
op|'='
name|'fake_log_warn'
newline|'\n'
nl|'\n'
name|'session'
op|'='
name|'driver'
op|'.'
name|'VMwareAPISession'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'config_spec'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
nl|'\n'
name|'session'
op|'.'
name|'vim'
op|'.'
name|'client'
op|'.'
name|'factory'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
op|')'
op|','
nl|'\n'
name|'os_type'
op|'='
string|"'invalid_os_type'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'vexc'
op|'.'
name|'VMwareDriverException'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'create_vm'
op|','
name|'session'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'folder'"
op|','
name|'config_spec'
op|','
string|"'res-pool'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'found'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_convert_vif_model
dedent|''
name|'def'
name|'test_convert_vif_model'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expected'
op|'='
string|'"VirtualE1000"'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'convert_vif_model'
op|'('
name|'network_model'
op|'.'
name|'VIF_MODEL_E1000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
name|'expected'
op|'='
string|'"VirtualE1000e"'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'convert_vif_model'
op|'('
name|'network_model'
op|'.'
name|'VIF_MODEL_E1000E'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
name|'types'
op|'='
op|'['
string|'"VirtualE1000"'
op|','
string|'"VirtualE1000e"'
op|','
string|'"VirtualPCNet32"'
op|','
nl|'\n'
string|'"VirtualVmxnet"'
op|','
string|'"VirtualVmxnet3"'
op|']'
newline|'\n'
name|'for'
name|'type'
name|'in'
name|'types'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'type'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'convert_vif_model'
op|'('
name|'type'
op|')'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'Invalid'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'convert_vif_model'
op|','
nl|'\n'
string|'"InvalidVifModel"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_power_on_instance_with_vm_ref
dedent|''
name|'def'
name|'test_power_on_instance_with_vm_ref'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_call_method"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_wait_for_task"'
op|')'
op|','
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'power_on_instance'
op|'('
name|'session'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'vm_ref'
op|'='
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'vim'
op|','
nl|'\n'
string|'"PowerOnVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_power_on_instance_without_vm_ref
dedent|''
dedent|''
name|'def'
name|'test_power_on_instance_without_vm_ref'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_vm_ref"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-vm-ref'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_call_method"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_wait_for_task"'
op|')'
op|','
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_get_vm_ref'
op|','
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'power_on_instance'
op|'('
name|'session'
op|','
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
name|'fake_get_vm_ref'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'vim'
op|','
nl|'\n'
string|'"PowerOnVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_power_on_instance_with_exception
dedent|''
dedent|''
name|'def'
name|'test_power_on_instance_with_exception'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_call_method"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_wait_for_task"'
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'exception'
op|'.'
name|'NovaException'
op|'('
string|"'fake'"
op|')'
op|')'
op|','
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NovaException'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'power_on_instance'
op|','
nl|'\n'
name|'session'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'vm_ref'
op|'='
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'vim'
op|','
nl|'\n'
string|'"PowerOnVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_power_on_instance_with_power_state_exception
dedent|''
dedent|''
name|'def'
name|'test_power_on_instance_with_power_state_exception'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_call_method"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'session'
op|','
string|'"_wait_for_task"'
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'vexc'
op|'.'
name|'InvalidPowerStateException'
op|')'
op|','
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'power_on_instance'
op|'('
name|'session'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'vm_ref'
op|'='
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'vim'
op|','
nl|'\n'
string|'"PowerOnVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_virtual_disk
dedent|''
dedent|''
name|'def'
name|'test_create_virtual_disk'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'dm'
op|'='
name|'session'
op|'.'
name|'vim'
op|'.'
name|'service_content'
op|'.'
name|'virtualDiskManager'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_vmdk_create_spec"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-spec'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_call_method"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_wait_for_task"'
op|')'
op|','
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_get_spec'
op|','
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'create_virtual_disk'
op|'('
name|'session'
op|','
string|"'fake-dc-ref'"
op|','
nl|'\n'
string|"'fake-adapter-type'"
op|','
string|"'fake-disk-type'"
op|','
nl|'\n'
string|"'fake-path'"
op|','
number|'7'
op|')'
newline|'\n'
name|'fake_get_spec'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'session'
op|'.'
name|'vim'
op|'.'
name|'client'
op|'.'
name|'factory'
op|','
number|'7'
op|','
nl|'\n'
string|"'fake-adapter-type'"
op|','
nl|'\n'
string|"'fake-disk-type'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'session'
op|'.'
name|'vim'
op|','
nl|'\n'
string|'"CreateVirtualDisk_Task"'
op|','
nl|'\n'
name|'dm'
op|','
nl|'\n'
name|'name'
op|'='
string|"'fake-path'"
op|','
nl|'\n'
name|'datacenter'
op|'='
string|"'fake-dc-ref'"
op|','
nl|'\n'
name|'spec'
op|'='
string|"'fake-spec'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_copy_virtual_disk
dedent|''
dedent|''
name|'def'
name|'test_copy_virtual_disk'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'dm'
op|'='
name|'session'
op|'.'
name|'vim'
op|'.'
name|'service_content'
op|'.'
name|'virtualDiskManager'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_call_method"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_wait_for_task"'
op|')'
op|','
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'copy_virtual_disk'
op|'('
name|'session'
op|','
string|"'fake-dc-ref'"
op|','
nl|'\n'
string|"'fake-source'"
op|','
string|"'fake-dest'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'session'
op|'.'
name|'vim'
op|','
nl|'\n'
string|'"CopyVirtualDisk_Task"'
op|','
nl|'\n'
name|'dm'
op|','
nl|'\n'
name|'sourceName'
op|'='
string|"'fake-source'"
op|','
nl|'\n'
name|'sourceDatacenter'
op|'='
string|"'fake-dc-ref'"
op|','
nl|'\n'
name|'destName'
op|'='
string|"'fake-dest'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_create_fake_vm_objects
dedent|''
dedent|''
name|'def'
name|'_create_fake_vm_objects'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_objects'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'fake'
op|'.'
name|'VirtualMachine'
op|'('
op|')'
op|')'
newline|'\n'
name|'return'
name|'fake_objects'
newline|'\n'
nl|'\n'
DECL|member|test_get_values
dedent|''
name|'def'
name|'test_get_values'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'objects'
op|'='
name|'self'
op|'.'
name|'_create_fake_vm_objects'
op|'('
op|')'
newline|'\n'
name|'query'
op|'='
name|'vm_util'
op|'.'
name|'get_values_from_object_properties'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'objects'
op|')'
op|','
name|'objects'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'poweredOn'"
op|','
name|'query'
op|'['
string|"'runtime.powerState'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'guestToolsRunning'"
op|','
nl|'\n'
name|'query'
op|'['
string|"'summary.guest.toolsRunningStatus'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'toolsOk'"
op|','
name|'query'
op|'['
string|"'summary.guest.toolsStatus'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_reconfigure_vm
dedent|''
name|'def'
name|'test_reconfigure_vm'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake_reconfigure_task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_wait_for_task'"
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'_call_method'
op|','
name|'_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'reconfigure_vm'
op|'('
name|'session'
op|','
string|"'fake-ref'"
op|','
string|"'fake-spec'"
op|')'
newline|'\n'
name|'_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'ANY'
op|','
nl|'\n'
string|"'ReconfigVM_Task'"
op|','
string|"'fake-ref'"
op|','
name|'spec'
op|'='
string|"'fake-spec'"
op|')'
newline|'\n'
name|'_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
string|"'fake_reconfigure_task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_network_attach_config_spec_opaque
dedent|''
dedent|''
name|'def'
name|'test_get_network_attach_config_spec_opaque'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vif_info'
op|'='
op|'{'
string|"'network_name'"
op|':'
string|"'br-int'"
op|','
nl|'\n'
string|"'mac_address'"
op|':'
string|"'00:00:00:ca:fe:01'"
op|','
nl|'\n'
string|"'network_ref'"
op|':'
op|'{'
string|"'type'"
op|':'
string|"'OpaqueNetwork'"
op|','
nl|'\n'
string|"'network-id'"
op|':'
string|"'fake-network-id'"
op|','
nl|'\n'
string|"'network-type'"
op|':'
string|"'opaque'"
op|'}'
op|','
nl|'\n'
string|"'iface_id'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'vif_model'"
op|':'
string|"'VirtualE1000'"
op|'}'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_network_attach_config_spec'
op|'('
nl|'\n'
name|'fake_factory'
op|','
name|'vif_info'
op|','
number|'1'
op|')'
newline|'\n'
name|'card'
op|'='
string|"'ns0:VirtualEthernetCardOpaqueNetworkBackingInfo'"
newline|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'extra_config'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:OptionValue'"
op|')'
newline|'\n'
name|'extra_config'
op|'.'
name|'value'
op|'='
name|'vif_info'
op|'['
string|"'iface_id'"
op|']'
newline|'\n'
name|'extra_config'
op|'.'
name|'key'
op|'='
string|"'nvp.iface-id.1'"
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'extra_config'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'='
op|'['
op|']'
newline|'\n'
name|'device_change'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualDeviceConfigSpec'"
op|')'
newline|'\n'
name|'device_change'
op|'.'
name|'operation'
op|'='
string|"'add'"
newline|'\n'
nl|'\n'
name|'device'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualE1000'"
op|')'
newline|'\n'
name|'device'
op|'.'
name|'macAddress'
op|'='
name|'vif_info'
op|'['
string|"'mac_address'"
op|']'
newline|'\n'
name|'device'
op|'.'
name|'addressType'
op|'='
string|"'manual'"
newline|'\n'
name|'connectable'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualDeviceConnectInfo'"
op|')'
newline|'\n'
name|'connectable'
op|'.'
name|'allowGuestControl'
op|'='
name|'True'
newline|'\n'
name|'connectable'
op|'.'
name|'startConnected'
op|'='
name|'True'
newline|'\n'
name|'connectable'
op|'.'
name|'connected'
op|'='
name|'True'
newline|'\n'
name|'device'
op|'.'
name|'connectable'
op|'='
name|'connectable'
newline|'\n'
name|'backing'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
name|'card'
op|')'
newline|'\n'
name|'backing'
op|'.'
name|'opaqueNetworkType'
op|'='
name|'vif_info'
op|'['
string|"'network_ref'"
op|']'
op|'['
string|"'network-type'"
op|']'
newline|'\n'
name|'backing'
op|'.'
name|'opaqueNetworkId'
op|'='
name|'vif_info'
op|'['
string|"'network_ref'"
op|']'
op|'['
string|"'network-id'"
op|']'
newline|'\n'
name|'device'
op|'.'
name|'backing'
op|'='
name|'backing'
newline|'\n'
name|'device'
op|'.'
name|'key'
op|'='
op|'-'
number|'47'
newline|'\n'
name|'device'
op|'.'
name|'wakeOnLanEnabled'
op|'='
name|'True'
newline|'\n'
name|'device_change'
op|'.'
name|'device'
op|'='
name|'device'
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'.'
name|'append'
op|'('
name|'device_change'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_network_attach_config_spec_dvs
dedent|''
name|'def'
name|'test_get_network_attach_config_spec_dvs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vif_info'
op|'='
op|'{'
string|"'network_name'"
op|':'
string|"'br100'"
op|','
nl|'\n'
string|"'mac_address'"
op|':'
string|"'00:00:00:ca:fe:01'"
op|','
nl|'\n'
string|"'network_ref'"
op|':'
op|'{'
string|"'type'"
op|':'
string|"'DistributedVirtualPortgroup'"
op|','
nl|'\n'
string|"'dvsw'"
op|':'
string|"'fake-network-id'"
op|','
nl|'\n'
string|"'dvpg'"
op|':'
string|"'fake-group'"
op|'}'
op|','
nl|'\n'
string|"'iface_id'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'vif_model'"
op|':'
string|"'VirtualE1000'"
op|'}'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_network_attach_config_spec'
op|'('
nl|'\n'
name|'fake_factory'
op|','
name|'vif_info'
op|','
number|'1'
op|')'
newline|'\n'
name|'port'
op|'='
string|"'ns0:DistributedVirtualSwitchPortConnection'"
newline|'\n'
name|'backing'
op|'='
string|"'ns0:VirtualEthernetCardDistributedVirtualPortBackingInfo'"
newline|'\n'
nl|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'extra_config'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:OptionValue'"
op|')'
newline|'\n'
name|'extra_config'
op|'.'
name|'value'
op|'='
name|'vif_info'
op|'['
string|"'iface_id'"
op|']'
newline|'\n'
name|'extra_config'
op|'.'
name|'key'
op|'='
string|"'nvp.iface-id.1'"
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'extra_config'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'device_change'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualDeviceConfigSpec'"
op|')'
newline|'\n'
name|'device_change'
op|'.'
name|'operation'
op|'='
string|"'add'"
newline|'\n'
nl|'\n'
name|'device'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualE1000'"
op|')'
newline|'\n'
name|'device'
op|'.'
name|'macAddress'
op|'='
name|'vif_info'
op|'['
string|"'mac_address'"
op|']'
newline|'\n'
name|'device'
op|'.'
name|'key'
op|'='
op|'-'
number|'47'
newline|'\n'
name|'device'
op|'.'
name|'addressType'
op|'='
string|"'manual'"
newline|'\n'
name|'device'
op|'.'
name|'wakeOnLanEnabled'
op|'='
name|'True'
newline|'\n'
nl|'\n'
name|'device'
op|'.'
name|'backing'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
name|'backing'
op|')'
newline|'\n'
name|'device'
op|'.'
name|'backing'
op|'.'
name|'port'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
name|'port'
op|')'
newline|'\n'
name|'device'
op|'.'
name|'backing'
op|'.'
name|'port'
op|'.'
name|'portgroupKey'
op|'='
name|'vif_info'
op|'['
string|"'network_ref'"
op|']'
op|'['
string|"'dvpg'"
op|']'
newline|'\n'
name|'device'
op|'.'
name|'backing'
op|'.'
name|'port'
op|'.'
name|'switchUuid'
op|'='
name|'vif_info'
op|'['
string|"'network_ref'"
op|']'
op|'['
string|"'dvsw'"
op|']'
newline|'\n'
nl|'\n'
name|'connectable'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualDeviceConnectInfo'"
op|')'
newline|'\n'
name|'connectable'
op|'.'
name|'allowGuestControl'
op|'='
name|'True'
newline|'\n'
name|'connectable'
op|'.'
name|'connected'
op|'='
name|'True'
newline|'\n'
name|'connectable'
op|'.'
name|'startConnected'
op|'='
name|'True'
newline|'\n'
name|'device'
op|'.'
name|'connectable'
op|'='
name|'connectable'
newline|'\n'
name|'device_change'
op|'.'
name|'device'
op|'='
name|'device'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'.'
name|'append'
op|'('
name|'device_change'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_network_detach_config_spec
dedent|''
name|'def'
name|'test_get_network_detach_config_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_network_detach_config_spec'
op|'('
nl|'\n'
name|'fake_factory'
op|','
string|"'fake-device'"
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'extra_config'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:OptionValue'"
op|')'
newline|'\n'
name|'extra_config'
op|'.'
name|'value'
op|'='
string|"'free'"
newline|'\n'
name|'extra_config'
op|'.'
name|'key'
op|'='
string|"'nvp.iface-id.2'"
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'extra_config'
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'='
op|'['
op|']'
newline|'\n'
name|'device_change'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualDeviceConfigSpec'"
op|')'
newline|'\n'
name|'device_change'
op|'.'
name|'device'
op|'='
string|"'fake-device'"
newline|'\n'
name|'device_change'
op|'.'
name|'operation'
op|'='
string|"'remove'"
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'.'
name|'append'
op|'('
name|'device_change'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_vm_ref"'
op|')'
newline|'\n'
DECL|member|test_power_off_instance
name|'def'
name|'test_power_off_instance'
op|'('
name|'self'
op|','
name|'fake_get_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_wait_for_task'"
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'power_off_instance'
op|'('
name|'session'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'vim'
op|','
nl|'\n'
string|'"PowerOffVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'fake_get_ref'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_vm_ref"'
op|','
name|'return_value'
op|'='
string|'"fake-vm-ref"'
op|')'
newline|'\n'
DECL|member|test_power_off_instance_no_vm_ref
name|'def'
name|'test_power_off_instance_no_vm_ref'
op|'('
name|'self'
op|','
name|'fake_get_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_wait_for_task'"
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'power_off_instance'
op|'('
name|'session'
op|','
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
name|'fake_get_ref'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'vim'
op|','
nl|'\n'
string|'"PowerOffVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_vm_ref"'
op|')'
newline|'\n'
DECL|member|test_power_off_instance_with_exception
name|'def'
name|'test_power_off_instance_with_exception'
op|'('
name|'self'
op|','
name|'fake_get_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_wait_for_task'"
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'exception'
op|'.'
name|'NovaException'
op|'('
string|"'fake'"
op|')'
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NovaException'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'power_off_instance'
op|','
nl|'\n'
name|'session'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'vim'
op|','
nl|'\n'
string|'"PowerOffVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'fake_get_ref'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_vm_ref"'
op|')'
newline|'\n'
DECL|member|test_power_off_instance_power_state_exception
name|'def'
name|'test_power_off_instance_power_state_exception'
op|'('
name|'self'
op|','
name|'fake_get_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'session'
op|','
string|"'_wait_for_task'"
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'vexc'
op|'.'
name|'InvalidPowerStateException'
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'power_off_instance'
op|'('
name|'session'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'vim'
op|','
nl|'\n'
string|'"PowerOffVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'fake_get_ref'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec_updated_hw_version
dedent|''
dedent|''
name|'def'
name|'test_get_vm_create_spec_updated_hw_version'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'hw_version'
op|'='
string|"'vmx-08'"
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|'='
name|'extra_specs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'vmx-08'"
op|','
name|'result'
op|'.'
name|'version'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vm_create_spec_with_profile_spec
dedent|''
name|'def'
name|'test_vm_create_spec_with_profile_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'datastore'
op|'='
name|'ds_obj'
op|'.'
name|'Datastore'
op|'('
string|"'fake-ds-ref'"
op|','
string|"'fake-ds-name'"
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
op|')'
newline|'\n'
name|'create_spec'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'datastore'
op|'.'
name|'name'
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|','
nl|'\n'
name|'profile_spec'
op|'='
string|"'fake_profile_spec'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
string|"'fake_profile_spec'"
op|']'
op|','
name|'create_spec'
op|'.'
name|'vmProfile'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'pbm'
op|','
string|"'get_profile_id_by_name'"
op|')'
newline|'\n'
DECL|member|test_get_storage_profile_spec
name|'def'
name|'test_get_storage_profile_spec'
op|'('
name|'self'
op|','
name|'mock_retrieve_profile_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_profile_id'
op|'='
name|'fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'fake_profile_id'
op|'.'
name|'uniqueId'
op|'='
string|"'fake_unique_id'"
newline|'\n'
name|'mock_retrieve_profile_id'
op|'.'
name|'return_value'
op|'='
name|'fake_profile_id'
newline|'\n'
name|'profile_spec'
op|'='
name|'vm_util'
op|'.'
name|'get_storage_profile_spec'
op|'('
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
op|','
nl|'\n'
string|"'fake_policy'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'ns0:VirtualMachineDefinedProfileSpec'"
op|','
nl|'\n'
name|'profile_spec'
op|'.'
name|'obj_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'fake_profile_id'
op|'.'
name|'uniqueId'
op|','
name|'profile_spec'
op|'.'
name|'profileId'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'pbm'
op|','
string|"'get_profile_id_by_name'"
op|')'
newline|'\n'
DECL|member|test_storage_spec_empty_profile
name|'def'
name|'test_storage_spec_empty_profile'
op|'('
name|'self'
op|','
name|'mock_retrieve_profile_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_retrieve_profile_id'
op|'.'
name|'return_value'
op|'='
name|'None'
newline|'\n'
name|'profile_spec'
op|'='
name|'vm_util'
op|'.'
name|'get_storage_profile_spec'
op|'('
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
op|','
nl|'\n'
string|"'fake_policy'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'profile_spec'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_ephemeral_name
dedent|''
name|'def'
name|'test_get_ephemeral_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filename'
op|'='
name|'vm_util'
op|'.'
name|'get_ephemeral_name'
op|'('
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'ephemeral_0.vmdk'"
op|','
name|'filename'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_detach_and_delete_devices_config_spec
dedent|''
name|'def'
name|'test_detach_and_delete_devices_config_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_devices'
op|'='
op|'['
string|"'device1'"
op|','
string|"'device2'"
op|']'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'_detach_and_delete_devices_config_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'fake_devices'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'='
op|'['
op|']'
newline|'\n'
name|'device1'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualDeviceConfigSpec'"
op|')'
newline|'\n'
name|'device1'
op|'.'
name|'device'
op|'='
string|"'device1'"
newline|'\n'
name|'device1'
op|'.'
name|'operation'
op|'='
string|"'remove'"
newline|'\n'
name|'device1'
op|'.'
name|'fileOperation'
op|'='
string|"'destroy'"
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'.'
name|'append'
op|'('
name|'device1'
op|')'
newline|'\n'
nl|'\n'
name|'device2'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualDeviceConfigSpec'"
op|')'
newline|'\n'
name|'device2'
op|'.'
name|'device'
op|'='
string|"'device2'"
newline|'\n'
name|'device2'
op|'.'
name|'operation'
op|'='
string|"'remove'"
newline|'\n'
name|'device2'
op|'.'
name|'fileOperation'
op|'='
string|"'destroy'"
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'.'
name|'append'
op|'('
name|'device2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'reconfigure_vm'"
op|')'
newline|'\n'
DECL|member|test_detach_devices_from_vm
name|'def'
name|'test_detach_devices_from_vm'
op|'('
name|'self'
op|','
name|'mock_reconfigure'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_devices'
op|'='
op|'['
string|"'device1'"
op|','
string|"'device2'"
op|']'
newline|'\n'
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'vm_util'
op|'.'
name|'detach_devices_from_vm'
op|'('
name|'session'
op|','
nl|'\n'
string|"'fake-ref'"
op|','
nl|'\n'
name|'fake_devices'
op|')'
newline|'\n'
name|'mock_reconfigure'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
string|"'fake-ref'"
op|','
name|'mock'
op|'.'
name|'ANY'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_boot_spec
dedent|''
name|'def'
name|'test_get_vm_boot_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'disk'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
op|')'
newline|'\n'
name|'disk'
op|'.'
name|'key'
op|'='
number|'7'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_boot_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'disk'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'boot_disk'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
nl|'\n'
string|"'ns0:VirtualMachineBootOptionsBootableDiskDevice'"
op|')'
newline|'\n'
name|'boot_disk'
op|'.'
name|'deviceKey'
op|'='
name|'disk'
op|'.'
name|'key'
newline|'\n'
name|'boot_options'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineBootOptions'"
op|')'
newline|'\n'
name|'boot_options'
op|'.'
name|'bootOrder'
op|'='
op|'['
name|'boot_disk'
op|']'
newline|'\n'
name|'expected'
op|'.'
name|'bootOptions'
op|'='
name|'boot_options'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_devices
dedent|''
name|'def'
name|'_get_devices'
op|'('
name|'self'
op|','
name|'filename'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'devices'
op|'='
name|'fake'
op|'.'
name|'_create_array_of_type'
op|'('
string|"'VirtualDevice'"
op|')'
newline|'\n'
name|'devices'
op|'.'
name|'VirtualDevice'
op|'='
name|'self'
op|'.'
name|'_vmdk_path_and_adapter_type_devices'
op|'('
nl|'\n'
name|'filename'
op|')'
newline|'\n'
name|'return'
name|'devices'
newline|'\n'
nl|'\n'
DECL|member|test_find_rescue_device
dedent|''
name|'def'
name|'test_find_rescue_device'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filename'
op|'='
string|"'[test_datastore] uuid/uuid-rescue.vmdk'"
newline|'\n'
name|'devices'
op|'='
name|'self'
op|'.'
name|'_get_devices'
op|'('
name|'filename'
op|')'
newline|'\n'
name|'device'
op|'='
name|'vm_util'
op|'.'
name|'find_rescue_device'
op|'('
name|'devices'
op|','
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'filename'
op|','
name|'device'
op|'.'
name|'backing'
op|'.'
name|'fileName'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_find_rescue_device_not_found
dedent|''
name|'def'
name|'test_find_rescue_device_not_found'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filename'
op|'='
string|"'[test_datastore] uuid/uuid.vmdk'"
newline|'\n'
name|'devices'
op|'='
name|'self'
op|'.'
name|'_get_devices'
op|'('
name|'filename'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NotFound'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'find_rescue_device'
op|','
nl|'\n'
name|'devices'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_validate_limits
dedent|''
name|'def'
name|'test_validate_limits'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'limits'
op|'='
name|'vm_util'
op|'.'
name|'Limits'
op|'('
name|'shares_level'
op|'='
string|"'high'"
op|','
nl|'\n'
name|'shares_share'
op|'='
number|'1948'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'InvalidInput'
op|','
nl|'\n'
name|'limits'
op|'.'
name|'validate'
op|')'
newline|'\n'
name|'limits'
op|'='
name|'vm_util'
op|'.'
name|'Limits'
op|'('
name|'shares_level'
op|'='
string|"'fira'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'InvalidInput'
op|','
nl|'\n'
name|'limits'
op|'.'
name|'validate'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec_with_console_delay
dedent|''
name|'def'
name|'test_get_vm_create_spec_with_console_delay'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'console_delay_seconds'
op|'='
number|'2'
op|','
name|'group'
op|'='
string|"'vmware'"
op|')'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'name'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'instanceUuid'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'='
op|'['
op|']'
newline|'\n'
name|'expected'
op|'.'
name|'numCPUs'
op|'='
number|'2'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'version'
op|'='
name|'None'
newline|'\n'
name|'expected'
op|'.'
name|'memoryMB'
op|'='
number|'2048'
newline|'\n'
name|'expected'
op|'.'
name|'guestId'
op|'='
name|'constants'
op|'.'
name|'DEFAULT_OS_TYPE'
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'extra_config'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|'"ns0:OptionValue"'
op|')'
newline|'\n'
name|'extra_config'
op|'.'
name|'value'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'extra_config'
op|'.'
name|'key'
op|'='
string|"'nvp.vm-uuid'"
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'extra_config'
op|')'
newline|'\n'
name|'extra_config'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|'"ns0:OptionValue"'
op|')'
newline|'\n'
name|'extra_config'
op|'.'
name|'value'
op|'='
number|'2000000'
newline|'\n'
name|'extra_config'
op|'.'
name|'key'
op|'='
string|"'keyboard.typematicMinDelay'"
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'extra_config'
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'files'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineFileInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'files'
op|'.'
name|'vmPathName'
op|'='
string|"'[fake-datastore]'"
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ManagedByInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'extensionKey'
op|'='
string|"'org.openstack.compute'"
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'type'
op|'='
string|"'instance'"
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'tools'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ToolsConfigInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterPowerOn'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterResume'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestReboot'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestShutdown'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestStandby'
op|'='
name|'True'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec_with_cores_per_socket
dedent|''
name|'def'
name|'test_get_vm_create_spec_with_cores_per_socket'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cores_per_socket'
op|'='
number|'4'
op|')'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'='
op|'['
op|']'
newline|'\n'
name|'expected'
op|'.'
name|'guestId'
op|'='
string|"'otherGuest'"
newline|'\n'
name|'expected'
op|'.'
name|'instanceUuid'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'memoryMB'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'memory_mb'
newline|'\n'
name|'expected'
op|'.'
name|'name'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'numCPUs'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'vcpus'
newline|'\n'
name|'expected'
op|'.'
name|'numCoresPerSocket'
op|'='
number|'4'
newline|'\n'
name|'expected'
op|'.'
name|'version'
op|'='
name|'None'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'files'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineFileInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'files'
op|'.'
name|'vmPathName'
op|'='
string|"'[fake-datastore]'"
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'tools'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ToolsConfigInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterPowerOn'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterResume'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestReboot'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestShutdown'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestStandby'
op|'='
name|'True'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ManagedByInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'extensionKey'
op|'='
string|"'org.openstack.compute'"
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'type'
op|'='
string|"'instance'"
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'='
op|'['
op|']'
newline|'\n'
name|'extra_config'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:OptionValue'"
op|')'
newline|'\n'
name|'extra_config'
op|'.'
name|'key'
op|'='
string|"'nvp.vm-uuid'"
newline|'\n'
name|'extra_config'
op|'.'
name|'value'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'extra_config'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec_with_memory_allocations
dedent|''
name|'def'
name|'test_get_vm_create_spec_with_memory_allocations'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'memory_limits'
op|'='
name|'vm_util'
op|'.'
name|'Limits'
op|'('
name|'limit'
op|'='
number|'7'
op|','
nl|'\n'
name|'reservation'
op|'='
number|'6'
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'memory_limits'
op|'='
name|'memory_limits'
op|')'
newline|'\n'
name|'fake_factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake_factory'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineConfigSpec'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'deviceChange'
op|'='
op|'['
op|']'
newline|'\n'
name|'expected'
op|'.'
name|'guestId'
op|'='
string|"'otherGuest'"
newline|'\n'
name|'expected'
op|'.'
name|'instanceUuid'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'memoryMB'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'memory_mb'
newline|'\n'
name|'expected'
op|'.'
name|'name'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'numCPUs'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'vcpus'
newline|'\n'
name|'expected'
op|'.'
name|'version'
op|'='
name|'None'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'files'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:VirtualMachineFileInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'files'
op|'.'
name|'vmPathName'
op|'='
string|"'[fake-datastore]'"
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'tools'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ToolsConfigInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterPowerOn'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'afterResume'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestReboot'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestShutdown'
op|'='
name|'True'
newline|'\n'
name|'expected'
op|'.'
name|'tools'
op|'.'
name|'beforeGuestStandby'
op|'='
name|'True'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ManagedByInfo'"
op|')'
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'extensionKey'
op|'='
string|"'org.openstack.compute'"
newline|'\n'
name|'expected'
op|'.'
name|'managedBy'
op|'.'
name|'type'
op|'='
string|"'instance'"
newline|'\n'
nl|'\n'
name|'memory_allocation'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:ResourceAllocationInfo'"
op|')'
newline|'\n'
name|'memory_allocation'
op|'.'
name|'limit'
op|'='
number|'7'
newline|'\n'
name|'memory_allocation'
op|'.'
name|'reservation'
op|'='
number|'6'
newline|'\n'
name|'memory_allocation'
op|'.'
name|'shares'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:SharesInfo'"
op|')'
newline|'\n'
name|'memory_allocation'
op|'.'
name|'shares'
op|'.'
name|'level'
op|'='
string|"'normal'"
newline|'\n'
name|'memory_allocation'
op|'.'
name|'shares'
op|'.'
name|'shares'
op|'='
number|'0'
newline|'\n'
name|'expected'
op|'.'
name|'memoryAllocation'
op|'='
name|'memory_allocation'
newline|'\n'
nl|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'='
op|'['
op|']'
newline|'\n'
name|'extra_config'
op|'='
name|'fake_factory'
op|'.'
name|'create'
op|'('
string|"'ns0:OptionValue'"
op|')'
newline|'\n'
name|'extra_config'
op|'.'
name|'key'
op|'='
string|"'nvp.vm-uuid'"
newline|'\n'
name|'extra_config'
op|'.'
name|'value'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
newline|'\n'
name|'expected'
op|'.'
name|'extraConfig'
op|'.'
name|'append'
op|'('
name|'extra_config'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_swap
dedent|''
name|'def'
name|'test_get_swap'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vm_ref'
op|'='
string|"'fake-vm-ref'"
newline|'\n'
nl|'\n'
comment|'# Root disk'
nl|'\n'
name|'controller_key'
op|'='
number|'1000'
newline|'\n'
name|'root_disk'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
op|')'
newline|'\n'
name|'root_disk'
op|'.'
name|'controllerKey'
op|'='
name|'controller_key'
newline|'\n'
name|'disk_backing'
op|'='
name|'fake'
op|'.'
name|'VirtualDiskFlatVer2BackingInfo'
op|'('
op|')'
newline|'\n'
name|'disk_backing'
op|'.'
name|'fileName'
op|'='
string|"'[test_datastore] uuid/uuid.vmdk'"
newline|'\n'
name|'root_disk'
op|'.'
name|'capacityInBytes'
op|'='
number|'1048576'
newline|'\n'
name|'root_disk'
op|'.'
name|'backing'
op|'='
name|'disk_backing'
newline|'\n'
nl|'\n'
comment|'# Swap disk'
nl|'\n'
name|'swap_disk'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
op|')'
newline|'\n'
name|'swap_disk'
op|'.'
name|'controllerKey'
op|'='
name|'controller_key'
newline|'\n'
name|'disk_backing'
op|'='
name|'fake'
op|'.'
name|'VirtualDiskFlatVer2BackingInfo'
op|'('
op|')'
newline|'\n'
name|'disk_backing'
op|'.'
name|'fileName'
op|'='
string|'"swap"'
newline|'\n'
name|'swap_disk'
op|'.'
name|'capacityInBytes'
op|'='
number|'1024'
newline|'\n'
name|'swap_disk'
op|'.'
name|'backing'
op|'='
name|'disk_backing'
newline|'\n'
name|'devices'
op|'='
op|'['
name|'root_disk'
op|','
name|'swap_disk'
op|']'
newline|'\n'
nl|'\n'
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'return_value'
op|'='
name|'devices'
op|')'
name|'as'
name|'mock_call'
op|':'
newline|'\n'
indent|'            '
name|'device'
op|'='
name|'vm_util'
op|'.'
name|'get_swap'
op|'('
name|'session'
op|','
name|'vm_ref'
op|')'
newline|'\n'
nl|'\n'
name|'mock_call'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'ANY'
op|','
nl|'\n'
string|'"get_dynamic_property"'
op|','
name|'vm_ref'
op|','
string|'"VirtualMachine"'
op|','
nl|'\n'
string|'"config.hardware.device"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'swap_disk'
op|','
name|'device'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'driver'
op|'.'
name|'VMwareAPISession'
op|','
string|"'vim'"
op|','
name|'stubs'
op|'.'
name|'fake_vim_prop'
op|')'
newline|'\n'
DECL|class|VMwareVMUtilGetHostRefTestCase
name|'class'
name|'VMwareVMUtilGetHostRefTestCase'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
comment|'# N.B. Mocking on the class only mocks test_*(), but we need'
nl|'\n'
comment|'# VMwareAPISession.vim to be mocked in both setUp and tests. Not mocking in'
nl|'\n'
comment|'# setUp causes object initialisation to fail. Not mocking in tests results'
nl|'\n'
comment|'# in vim calls not using FakeVim.'
nl|'\n'
indent|'    '
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'driver'
op|'.'
name|'VMwareAPISession'
op|','
string|"'vim'"
op|','
name|'stubs'
op|'.'
name|'fake_vim_prop'
op|')'
newline|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'VMwareVMUtilGetHostRefTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'fake'
op|'.'
name|'reset'
op|'('
op|')'
newline|'\n'
name|'vm_util'
op|'.'
name|'vm_refs_cache_reset'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'session'
op|'='
name|'driver'
op|'.'
name|'VMwareAPISession'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# Create a fake VirtualMachine running on a known host'
nl|'\n'
name|'self'
op|'.'
name|'host_ref'
op|'='
name|'fake'
op|'.'
name|'_db_content'
op|'['
string|"'HostSystem'"
op|']'
op|'.'
name|'keys'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'vm_ref'
op|'='
name|'fake'
op|'.'
name|'create_vm'
op|'('
name|'host_ref'
op|'='
name|'self'
op|'.'
name|'host_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vm_ref'"
op|')'
newline|'\n'
DECL|member|test_get_host_ref_for_vm
name|'def'
name|'test_get_host_ref_for_vm'
op|'('
name|'self'
op|','
name|'mock_get_vm_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_get_vm_ref'
op|'.'
name|'return_value'
op|'='
name|'self'
op|'.'
name|'vm_ref'
newline|'\n'
nl|'\n'
name|'ret'
op|'='
name|'vm_util'
op|'.'
name|'get_host_ref_for_vm'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|"'fake-instance'"
op|')'
newline|'\n'
nl|'\n'
name|'mock_get_vm_ref'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|"'fake-instance'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'host_ref'
op|','
name|'ret'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vm_ref'"
op|')'
newline|'\n'
DECL|member|test_get_host_name_for_vm
name|'def'
name|'test_get_host_name_for_vm'
op|'('
name|'self'
op|','
name|'mock_get_vm_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_get_vm_ref'
op|'.'
name|'return_value'
op|'='
name|'self'
op|'.'
name|'vm_ref'
newline|'\n'
nl|'\n'
name|'host'
op|'='
name|'fake'
op|'.'
name|'_get_object'
op|'('
name|'self'
op|'.'
name|'host_ref'
op|')'
newline|'\n'
nl|'\n'
name|'ret'
op|'='
name|'vm_util'
op|'.'
name|'get_host_name_for_vm'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|"'fake-instance'"
op|')'
newline|'\n'
nl|'\n'
name|'mock_get_vm_ref'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|"'fake-instance'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'host'
op|'.'
name|'name'
op|','
name|'ret'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
