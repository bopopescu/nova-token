begin_unit
comment|'# Copyright 2013 OpenStack Foundation'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
name|'import'
name|'contextlib'
newline|'\n'
nl|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'from'
name|'oslo_utils'
name|'import'
name|'units'
newline|'\n'
name|'from'
name|'oslo_utils'
name|'import'
name|'uuidutils'
newline|'\n'
name|'from'
name|'oslo_vmware'
name|'import'
name|'exceptions'
name|'as'
name|'vexc'
newline|'\n'
name|'from'
name|'oslo_vmware'
op|'.'
name|'objects'
name|'import'
name|'datastore'
name|'as'
name|'ds_obj'
newline|'\n'
name|'from'
name|'oslo_vmware'
name|'import'
name|'vim_util'
name|'as'
name|'vutil'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
op|'.'
name|'compute'
name|'import'
name|'power_state'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'context'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'network'
name|'import'
name|'model'
name|'as'
name|'network_model'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'objects'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
name|'import'
name|'fake_instance'
newline|'\n'
name|'import'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
op|'.'
name|'image'
op|'.'
name|'fake'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'fake'
name|'as'
name|'vmwareapi_fake'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'stubs'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
name|'import'
name|'hardware'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'constants'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'driver'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'ds_util'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'images'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'vim_util'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'vm_util'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'vmops'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|DsPathMatcher
name|'class'
name|'DsPathMatcher'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'expected_ds_path_str'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'expected_ds_path_str'
op|'='
name|'expected_ds_path_str'
newline|'\n'
nl|'\n'
DECL|member|__eq__
dedent|''
name|'def'
name|'__eq__'
op|'('
name|'self'
op|','
name|'ds_path_param'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'str'
op|'('
name|'ds_path_param'
op|')'
op|'=='
name|'self'
op|'.'
name|'expected_ds_path_str'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VMwareVMOpsTestCase
dedent|''
dedent|''
name|'class'
name|'VMwareVMOpsTestCase'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'VMwareVMOpsTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'vmwareapi_fake'
op|'.'
name|'reset'
op|'('
op|')'
newline|'\n'
name|'stubs'
op|'.'
name|'set_stubs'
op|'('
name|'self'
op|'.'
name|'stubs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'image_cache_subdirectory_name'
op|'='
string|"'vmware_base'"
op|','
nl|'\n'
name|'my_ip'
op|'='
string|"''"
op|','
nl|'\n'
name|'flat_injected'
op|'='
name|'True'
op|','
nl|'\n'
name|'vnc_enabled'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_context'
op|'='
name|'context'
op|'.'
name|'RequestContext'
op|'('
string|"'fake_user'"
op|','
string|"'fake_project'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_session'
op|'='
name|'driver'
op|'.'
name|'VMwareAPISession'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_virtapi'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_image_id'
op|'='
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
op|'.'
name|'image'
op|'.'
name|'fake'
op|'.'
name|'get_valid_image_id'
op|'('
op|')'
newline|'\n'
name|'fake_ds_ref'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'ManagedObjectReference'
op|'('
string|"'fake-ds'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ds'
op|'='
name|'ds_obj'
op|'.'
name|'Datastore'
op|'('
nl|'\n'
name|'ref'
op|'='
name|'fake_ds_ref'
op|','
name|'name'
op|'='
string|"'fake_ds'"
op|','
nl|'\n'
name|'capacity'
op|'='
number|'10'
op|'*'
name|'units'
op|'.'
name|'Gi'
op|','
nl|'\n'
name|'freespace'
op|'='
number|'10'
op|'*'
name|'units'
op|'.'
name|'Gi'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_dc_info'
op|'='
name|'vmops'
op|'.'
name|'DcInfo'
op|'('
nl|'\n'
name|'ref'
op|'='
string|"'fake_dc_ref'"
op|','
name|'name'
op|'='
string|"'fake_dc'"
op|','
nl|'\n'
name|'vmFolder'
op|'='
string|"'fake_vm_folder'"
op|')'
newline|'\n'
name|'cluster'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'create_cluster'
op|'('
string|"'fake_cluster'"
op|','
name|'fake_ds_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_instance_values'
op|'='
op|'{'
nl|'\n'
string|"'name'"
op|':'
string|"'fake_name'"
op|','
nl|'\n'
string|"'uuid'"
op|':'
string|"'fake_uuid'"
op|','
nl|'\n'
string|"'vcpus'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'memory_mb'"
op|':'
number|'512'
op|','
nl|'\n'
string|"'image_ref'"
op|':'
name|'self'
op|'.'
name|'_image_id'
op|','
nl|'\n'
string|"'root_gb'"
op|':'
number|'10'
op|','
nl|'\n'
string|"'node'"
op|':'
string|"'%s(%s)'"
op|'%'
op|'('
name|'cluster'
op|'.'
name|'mo_id'
op|','
name|'cluster'
op|'.'
name|'name'
op|')'
op|','
nl|'\n'
string|"'expected_attrs'"
op|':'
op|'['
string|"'system_metadata'"
op|']'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_context'
op|','
op|'**'
name|'self'
op|'.'
name|'_instance_values'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_flavor'
op|'='
name|'objects'
op|'.'
name|'Flavor'
op|'('
name|'name'
op|'='
string|"'m1.small'"
op|','
name|'memory_mb'
op|'='
number|'512'
op|','
name|'vcpus'
op|'='
number|'1'
op|','
nl|'\n'
name|'root_gb'
op|'='
number|'10'
op|','
name|'ephemeral_gb'
op|'='
number|'0'
op|','
name|'swap'
op|'='
number|'0'
op|','
nl|'\n'
name|'extra_specs'
op|'='
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'flavor'
op|'='
name|'self'
op|'.'
name|'_flavor'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'='
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
name|'self'
op|'.'
name|'_virtapi'
op|','
name|'None'
op|','
nl|'\n'
name|'cluster'
op|'='
name|'cluster'
op|'.'
name|'obj'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_cluster'
op|'='
name|'cluster'
newline|'\n'
nl|'\n'
name|'subnet_4'
op|'='
name|'network_model'
op|'.'
name|'Subnet'
op|'('
name|'cidr'
op|'='
string|"'192.168.0.1/24'"
op|','
nl|'\n'
name|'dns'
op|'='
op|'['
name|'network_model'
op|'.'
name|'IP'
op|'('
string|"'192.168.0.1'"
op|')'
op|']'
op|','
nl|'\n'
name|'gateway'
op|'='
nl|'\n'
name|'network_model'
op|'.'
name|'IP'
op|'('
string|"'192.168.0.1'"
op|')'
op|','
nl|'\n'
name|'ips'
op|'='
op|'['
nl|'\n'
name|'network_model'
op|'.'
name|'IP'
op|'('
string|"'192.168.0.100'"
op|')'
op|']'
op|','
nl|'\n'
name|'routes'
op|'='
name|'None'
op|')'
newline|'\n'
name|'subnet_6'
op|'='
name|'network_model'
op|'.'
name|'Subnet'
op|'('
name|'cidr'
op|'='
string|"'dead:beef::1/64'"
op|','
nl|'\n'
name|'dns'
op|'='
name|'None'
op|','
nl|'\n'
name|'gateway'
op|'='
nl|'\n'
name|'network_model'
op|'.'
name|'IP'
op|'('
string|"'dead:beef::1'"
op|')'
op|','
nl|'\n'
name|'ips'
op|'='
op|'['
name|'network_model'
op|'.'
name|'IP'
op|'('
nl|'\n'
string|"'dead:beef::dcad:beff:feef:0'"
op|')'
op|']'
op|','
nl|'\n'
name|'routes'
op|'='
name|'None'
op|')'
newline|'\n'
name|'network'
op|'='
name|'network_model'
op|'.'
name|'Network'
op|'('
name|'id'
op|'='
number|'0'
op|','
nl|'\n'
name|'bridge'
op|'='
string|"'fa0'"
op|','
nl|'\n'
name|'label'
op|'='
string|"'fake'"
op|','
nl|'\n'
name|'subnets'
op|'='
op|'['
name|'subnet_4'
op|','
name|'subnet_6'
op|']'
op|','
nl|'\n'
name|'vlan'
op|'='
name|'None'
op|','
nl|'\n'
name|'bridge_interface'
op|'='
name|'None'
op|','
nl|'\n'
name|'injected'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_network_values'
op|'='
op|'{'
nl|'\n'
string|"'id'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'address'"
op|':'
string|"'DE:AD:BE:EF:00:00'"
op|','
nl|'\n'
string|"'network'"
op|':'
name|'network'
op|','
nl|'\n'
string|"'type'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'devname'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'ovs_interfaceid'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'rxtx_cap'"
op|':'
number|'3'
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'network_info'
op|'='
name|'network_model'
op|'.'
name|'NetworkInfo'
op|'('
op|'['
nl|'\n'
name|'network_model'
op|'.'
name|'VIF'
op|'('
op|'**'
name|'self'
op|'.'
name|'_network_values'
op|')'
nl|'\n'
op|']'
op|')'
newline|'\n'
name|'pure_IPv6_network'
op|'='
name|'network_model'
op|'.'
name|'Network'
op|'('
name|'id'
op|'='
number|'0'
op|','
nl|'\n'
name|'bridge'
op|'='
string|"'fa0'"
op|','
nl|'\n'
name|'label'
op|'='
string|"'fake'"
op|','
nl|'\n'
name|'subnets'
op|'='
op|'['
name|'subnet_6'
op|']'
op|','
nl|'\n'
name|'vlan'
op|'='
name|'None'
op|','
nl|'\n'
name|'bridge_interface'
op|'='
name|'None'
op|','
nl|'\n'
name|'injected'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'pure_IPv6_network_info'
op|'='
name|'network_model'
op|'.'
name|'NetworkInfo'
op|'('
op|'['
nl|'\n'
name|'network_model'
op|'.'
name|'VIF'
op|'('
name|'id'
op|'='
name|'None'
op|','
nl|'\n'
name|'address'
op|'='
string|"'DE:AD:BE:EF:00:00'"
op|','
nl|'\n'
name|'network'
op|'='
name|'pure_IPv6_network'
op|','
nl|'\n'
name|'type'
op|'='
name|'None'
op|','
nl|'\n'
name|'devname'
op|'='
name|'None'
op|','
nl|'\n'
name|'ovs_interfaceid'
op|'='
name|'None'
op|','
nl|'\n'
name|'rxtx_cap'
op|'='
number|'3'
op|')'
nl|'\n'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_machine_id_str
dedent|''
name|'def'
name|'test_get_machine_id_str'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'result'
op|'='
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|'.'
name|'_get_machine_id_str'
op|'('
name|'self'
op|'.'
name|'network_info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'DE:AD:BE:EF:00:00;192.168.0.100;255.255.255.0;'"
nl|'\n'
string|"'192.168.0.1;192.168.0.255;192.168.0.1#'"
op|','
name|'result'
op|')'
newline|'\n'
name|'result'
op|'='
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|'.'
name|'_get_machine_id_str'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'pure_IPv6_network_info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'DE:AD:BE:EF:00:00;;;;;#'"
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_setup_create_folder_mocks
dedent|''
name|'def'
name|'_setup_create_folder_mocks'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ops'
op|'='
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|'('
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
op|','
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
op|','
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
op|')'
newline|'\n'
name|'base_name'
op|'='
string|"'folder'"
newline|'\n'
name|'ds_name'
op|'='
string|'"datastore"'
newline|'\n'
name|'ds_ref'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'ds_ref'
op|'.'
name|'value'
op|'='
number|'1'
newline|'\n'
name|'dc_ref'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'ops'
op|'.'
name|'_datastore_dc_mapping'
op|'['
name|'ds_ref'
op|'.'
name|'value'
op|']'
op|'='
name|'vmops'
op|'.'
name|'DcInfo'
op|'('
nl|'\n'
name|'ref'
op|'='
name|'dc_ref'
op|','
nl|'\n'
name|'name'
op|'='
string|"'fake-name'"
op|','
nl|'\n'
name|'vmFolder'
op|'='
string|"'fake-folder'"
op|')'
newline|'\n'
name|'path'
op|'='
name|'ds_obj'
op|'.'
name|'DatastorePath'
op|'('
name|'ds_name'
op|','
name|'base_name'
op|')'
newline|'\n'
name|'return'
name|'ds_name'
op|','
name|'ds_ref'
op|','
name|'ops'
op|','
name|'path'
op|','
name|'dc_ref'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'mkdir'"
op|')'
newline|'\n'
DECL|member|test_create_folder_if_missing
name|'def'
name|'test_create_folder_if_missing'
op|'('
name|'self'
op|','
name|'mock_mkdir'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ds_name'
op|','
name|'ds_ref'
op|','
name|'ops'
op|','
name|'path'
op|','
name|'dc'
op|'='
name|'self'
op|'.'
name|'_setup_create_folder_mocks'
op|'('
op|')'
newline|'\n'
name|'ops'
op|'.'
name|'_create_folder_if_missing'
op|'('
name|'ds_name'
op|','
name|'ds_ref'
op|','
string|"'folder'"
op|')'
newline|'\n'
name|'mock_mkdir'
op|'.'
name|'assert_called_with'
op|'('
name|'ops'
op|'.'
name|'_session'
op|','
name|'path'
op|','
name|'dc'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'mkdir'"
op|')'
newline|'\n'
DECL|member|test_create_folder_if_missing_exception
name|'def'
name|'test_create_folder_if_missing_exception'
op|'('
name|'self'
op|','
name|'mock_mkdir'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ds_name'
op|','
name|'ds_ref'
op|','
name|'ops'
op|','
name|'path'
op|','
name|'dc'
op|'='
name|'self'
op|'.'
name|'_setup_create_folder_mocks'
op|'('
op|')'
newline|'\n'
name|'ds_util'
op|'.'
name|'mkdir'
op|'.'
name|'side_effect'
op|'='
name|'vexc'
op|'.'
name|'FileAlreadyExistsException'
op|'('
op|')'
newline|'\n'
name|'ops'
op|'.'
name|'_create_folder_if_missing'
op|'('
name|'ds_name'
op|','
name|'ds_ref'
op|','
string|"'folder'"
op|')'
newline|'\n'
name|'mock_mkdir'
op|'.'
name|'assert_called_with'
op|'('
name|'ops'
op|'.'
name|'_session'
op|','
name|'path'
op|','
name|'dc'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vutil'
op|','
string|"'continue_retrieval'"
op|','
name|'return_value'
op|'='
name|'None'
op|')'
newline|'\n'
DECL|member|test_get_valid_vms_from_retrieve_result
name|'def'
name|'test_get_valid_vms_from_retrieve_result'
op|'('
name|'self'
op|','
name|'_mock_cont'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ops'
op|'='
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
op|','
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
op|')'
newline|'\n'
name|'fake_objects'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'vmwareapi_fake'
op|'.'
name|'VirtualMachine'
op|'('
nl|'\n'
name|'name'
op|'='
name|'uuidutils'
op|'.'
name|'generate_uuid'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'vmwareapi_fake'
op|'.'
name|'VirtualMachine'
op|'('
nl|'\n'
name|'name'
op|'='
name|'uuidutils'
op|'.'
name|'generate_uuid'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'vmwareapi_fake'
op|'.'
name|'VirtualMachine'
op|'('
nl|'\n'
name|'name'
op|'='
name|'uuidutils'
op|'.'
name|'generate_uuid'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'vms'
op|'='
name|'ops'
op|'.'
name|'_get_valid_vms_from_retrieve_result'
op|'('
name|'fake_objects'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'3'
op|','
name|'len'
op|'('
name|'vms'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vutil'
op|','
string|"'continue_retrieval'"
op|','
name|'return_value'
op|'='
name|'None'
op|')'
newline|'\n'
DECL|member|test_get_valid_vms_from_retrieve_result_with_invalid
name|'def'
name|'test_get_valid_vms_from_retrieve_result_with_invalid'
op|'('
name|'self'
op|','
nl|'\n'
name|'_mock_cont'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ops'
op|'='
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
op|','
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
op|')'
newline|'\n'
name|'fake_objects'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'vmwareapi_fake'
op|'.'
name|'VirtualMachine'
op|'('
nl|'\n'
name|'name'
op|'='
name|'uuidutils'
op|'.'
name|'generate_uuid'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'invalid_vm1'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'VirtualMachine'
op|'('
nl|'\n'
name|'name'
op|'='
name|'uuidutils'
op|'.'
name|'generate_uuid'
op|'('
op|')'
op|')'
newline|'\n'
name|'invalid_vm1'
op|'.'
name|'set'
op|'('
string|"'runtime.connectionState'"
op|','
string|"'orphaned'"
op|')'
newline|'\n'
name|'invalid_vm2'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'VirtualMachine'
op|'('
nl|'\n'
name|'name'
op|'='
name|'uuidutils'
op|'.'
name|'generate_uuid'
op|'('
op|')'
op|')'
newline|'\n'
name|'invalid_vm2'
op|'.'
name|'set'
op|'('
string|"'runtime.connectionState'"
op|','
string|"'inaccessible'"
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'invalid_vm1'
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'invalid_vm2'
op|')'
newline|'\n'
name|'vms'
op|'='
name|'ops'
op|'.'
name|'_get_valid_vms_from_retrieve_result'
op|'('
name|'fake_objects'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'vms'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_vm_snapshot
dedent|''
name|'def'
name|'test_delete_vm_snapshot'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|fake_call_method
indent|'        '
name|'def'
name|'fake_call_method'
op|'('
name|'module'
op|','
name|'method'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'RemoveSnapshot_Task'"
op|','
name|'method'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'fake_vm_snapshot'"
op|','
name|'args'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'kwargs'
op|'['
string|"'removeChildren'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'kwargs'
op|'['
string|"'consolidate'"
op|']'
op|')'
newline|'\n'
name|'return'
string|"'fake_remove_snapshot_task'"
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
string|"'_wait_for_task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
string|"'_call_method'"
op|','
name|'fake_call_method'
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'_wait_for_task'
op|','
name|'_call_method'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_delete_vm_snapshot'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|'"fake_vm_ref"'
op|','
string|'"fake_vm_snapshot"'
op|')'
newline|'\n'
name|'_wait_for_task'
op|'.'
name|'assert_has_calls'
op|'('
op|'['
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
string|"'fake_remove_snapshot_task'"
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_vm_snapshot
dedent|''
dedent|''
name|'def'
name|'test_create_vm_snapshot'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'method_list'
op|'='
op|'['
string|"'CreateSnapshot_Task'"
op|','
string|"'get_dynamic_property'"
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_call_method
name|'def'
name|'fake_call_method'
op|'('
name|'module'
op|','
name|'method'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'expected_method'
op|'='
name|'method_list'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_method'
op|','
name|'method'
op|')'
newline|'\n'
name|'if'
op|'('
name|'expected_method'
op|'=='
string|"'CreateSnapshot_Task'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'fake_vm_ref'"
op|','
name|'args'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'kwargs'
op|'['
string|"'memory'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'kwargs'
op|'['
string|"'quiesce'"
op|']'
op|')'
newline|'\n'
name|'return'
string|"'fake_snapshot_task'"
newline|'\n'
dedent|''
name|'elif'
op|'('
name|'expected_method'
op|'=='
string|"'get_dynamic_property'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'task_info'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'task_info'
op|'.'
name|'result'
op|'='
string|'"fake_snapshot_ref"'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'('
string|"'fake_snapshot_task'"
op|','
string|"'Task'"
op|','
string|"'info'"
op|')'
op|','
name|'args'
op|')'
newline|'\n'
name|'return'
name|'task_info'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
string|"'_wait_for_task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
string|"'_call_method'"
op|','
name|'fake_call_method'
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'_wait_for_task'
op|','
name|'_call_method'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'snap'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_create_vm_snapshot'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|'"fake_vm_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"fake_snapshot_ref"'
op|','
name|'snap'
op|')'
newline|'\n'
name|'_wait_for_task'
op|'.'
name|'assert_has_calls'
op|'('
op|'['
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
string|"'fake_snapshot_task'"
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update_instance_progress
dedent|''
dedent|''
name|'def'
name|'test_update_instance_progress'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
string|"'save'"
op|')'
name|'as'
name|'mock_save'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_update_instance_progress'
op|'('
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'_context'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
number|'5'
op|','
number|'10'
op|')'
newline|'\n'
name|'mock_save'
op|'.'
name|'assert_called_once_with'
op|'('
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'50'
op|','
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'progress'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vm_ref'"
op|','
name|'return_value'
op|'='
string|"'fake_ref'"
op|')'
newline|'\n'
DECL|member|test_get_info
name|'def'
name|'test_get_info'
op|'('
name|'self'
op|','
name|'mock_get_vm_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'props'
op|'='
op|'['
string|"'summary.config.numCpu'"
op|','
string|"'summary.config.memorySizeMB'"
op|','
nl|'\n'
string|"'runtime.powerState'"
op|']'
newline|'\n'
name|'prop_cpu'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'Prop'
op|'('
name|'props'
op|'['
number|'0'
op|']'
op|','
number|'4'
op|')'
newline|'\n'
name|'prop_mem'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'Prop'
op|'('
name|'props'
op|'['
number|'1'
op|']'
op|','
number|'128'
op|')'
newline|'\n'
name|'prop_state'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'Prop'
op|'('
name|'props'
op|'['
number|'2'
op|']'
op|','
string|"'poweredOn'"
op|')'
newline|'\n'
name|'prop_list'
op|'='
op|'['
name|'prop_state'
op|','
name|'prop_mem'
op|','
name|'prop_cpu'
op|']'
newline|'\n'
name|'obj_content'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'ObjectContent'
op|'('
name|'None'
op|','
name|'prop_list'
op|'='
name|'prop_list'
op|')'
newline|'\n'
name|'result'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'result'
op|'.'
name|'add_object'
op|'('
name|'obj_content'
op|')'
newline|'\n'
nl|'\n'
DECL|function|mock_call_method
name|'def'
name|'mock_call_method'
op|'('
name|'module'
op|','
name|'method'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'method'
op|'=='
string|"'continue_retrieval'"
op|':'
newline|'\n'
indent|'                '
name|'return'
newline|'\n'
dedent|''
name|'return'
name|'result'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'mock_call_method'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'info'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'get_info'
op|'('
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
name|'mock_get_vm_ref'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
name|'expected'
op|'='
name|'hardware'
op|'.'
name|'InstanceInfo'
op|'('
name|'state'
op|'='
name|'power_state'
op|'.'
name|'RUNNING'
op|','
nl|'\n'
name|'max_mem_kb'
op|'='
number|'128'
op|'*'
number|'1024'
op|','
nl|'\n'
name|'mem_kb'
op|'='
number|'128'
op|'*'
number|'1024'
op|','
nl|'\n'
name|'num_cpu'
op|'='
number|'4'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'info'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vm_ref'"
op|','
name|'return_value'
op|'='
string|"'fake_ref'"
op|')'
newline|'\n'
DECL|member|test_get_info_when_ds_unavailable
name|'def'
name|'test_get_info_when_ds_unavailable'
op|'('
name|'self'
op|','
name|'mock_get_vm_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'props'
op|'='
op|'['
string|"'summary.config.numCpu'"
op|','
string|"'summary.config.memorySizeMB'"
op|','
nl|'\n'
string|"'runtime.powerState'"
op|']'
newline|'\n'
name|'prop_state'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'Prop'
op|'('
name|'props'
op|'['
number|'2'
op|']'
op|','
string|"'poweredOff'"
op|')'
newline|'\n'
comment|"# when vm's ds not available, only power state can be received"
nl|'\n'
name|'prop_list'
op|'='
op|'['
name|'prop_state'
op|']'
newline|'\n'
name|'obj_content'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'ObjectContent'
op|'('
name|'None'
op|','
name|'prop_list'
op|'='
name|'prop_list'
op|')'
newline|'\n'
name|'result'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'result'
op|'.'
name|'add_object'
op|'('
name|'obj_content'
op|')'
newline|'\n'
nl|'\n'
DECL|function|mock_call_method
name|'def'
name|'mock_call_method'
op|'('
name|'module'
op|','
name|'method'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'method'
op|'=='
string|"'continue_retrieval'"
op|':'
newline|'\n'
indent|'                '
name|'return'
newline|'\n'
dedent|''
name|'return'
name|'result'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'mock_call_method'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'info'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'get_info'
op|'('
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
name|'mock_get_vm_ref'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'hardware'
op|'.'
name|'InstanceInfo'
op|'('
name|'state'
op|'='
name|'power_state'
op|'.'
name|'SHUTDOWN'
op|')'
op|','
nl|'\n'
name|'info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_get_datacenter_ref_and_name
dedent|''
dedent|''
name|'def'
name|'_test_get_datacenter_ref_and_name'
op|'('
name|'self'
op|','
name|'ds_ref_exists'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ds_ref'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'instance_ds_ref'
op|'.'
name|'value'
op|'='
string|'"ds-1"'
newline|'\n'
name|'_vcvmops'
op|'='
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
name|'None'
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'ds_ref_exists'
op|':'
newline|'\n'
indent|'            '
name|'ds_ref'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'ds_ref'
op|'.'
name|'value'
op|'='
string|'"ds-1"'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'ds_ref'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'_continue_retrieval'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'_fake_object1'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_fake_object2'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|fake_call_method
name|'def'
name|'fake_call_method'
op|'('
name|'module'
op|','
name|'method'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_fake_object1'
op|'.'
name|'add_object'
op|'('
name|'vmwareapi_fake'
op|'.'
name|'Datacenter'
op|'('
nl|'\n'
name|'ds_ref'
op|'='
name|'ds_ref'
op|')'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'ds_ref'
op|':'
newline|'\n'
comment|'# Token is set for the fake_object1, so it will continue to'
nl|'\n'
comment|'# fetch the next object.'
nl|'\n'
indent|'                '
name|'setattr'
op|'('
name|'self'
op|'.'
name|'_fake_object1'
op|','
string|"'token'"
op|','
string|"'token-0'"
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'_continue_retrieval'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'self'
op|'.'
name|'_continue_retrieval'
op|':'
newline|'\n'
indent|'                        '
name|'self'
op|'.'
name|'_continue_retrieval'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'_fake_object2'
op|'.'
name|'add_object'
op|'('
nl|'\n'
name|'vmwareapi_fake'
op|'.'
name|'Datacenter'
op|'('
op|')'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'_fake_object2'
newline|'\n'
dedent|''
name|'return'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'method'
op|'=='
string|'"continue_retrieval"'
op|':'
newline|'\n'
indent|'                '
name|'return'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'_fake_object1'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'fake_call_method'
op|')'
name|'as'
name|'fake_call'
op|':'
newline|'\n'
indent|'            '
name|'dc_info'
op|'='
name|'_vcvmops'
op|'.'
name|'get_datacenter_ref_and_name'
op|'('
name|'instance_ds_ref'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'ds_ref'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'_vcvmops'
op|'.'
name|'_datastore_dc_mapping'
op|')'
op|')'
newline|'\n'
name|'calls'
op|'='
op|'['
name|'mock'
op|'.'
name|'call'
op|'('
name|'vim_util'
op|','
string|'"get_objects"'
op|','
string|'"Datacenter"'
op|','
nl|'\n'
op|'['
string|'"name"'
op|','
string|'"datastore"'
op|','
string|'"vmFolder"'
op|']'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
name|'vutil'
op|','
string|"'continue_retrieval'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_fake_object1'
op|')'
op|']'
newline|'\n'
name|'fake_call'
op|'.'
name|'assert_has_calls'
op|'('
name|'calls'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"ha-datacenter"'
op|','
name|'dc_info'
op|'.'
name|'name'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'calls'
op|'='
op|'['
name|'mock'
op|'.'
name|'call'
op|'('
name|'vim_util'
op|','
string|'"get_objects"'
op|','
string|'"Datacenter"'
op|','
nl|'\n'
op|'['
string|'"name"'
op|','
string|'"datastore"'
op|','
string|'"vmFolder"'
op|']'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
name|'vutil'
op|','
string|"'continue_retrieval'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_fake_object2'
op|')'
op|']'
newline|'\n'
name|'fake_call'
op|'.'
name|'assert_has_calls'
op|'('
name|'calls'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'dc_info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_datacenter_ref_and_name
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_get_datacenter_ref_and_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_get_datacenter_ref_and_name'
op|'('
name|'ds_ref_exists'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_datacenter_ref_and_name_with_no_datastore
dedent|''
name|'def'
name|'test_get_datacenter_ref_and_name_with_no_datastore'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_get_datacenter_ref_and_name'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'power_off_instance'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'disk_copy'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vm_ref'"
op|','
name|'return_value'
op|'='
string|"'fake-ref'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_values_from_object_properties'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'find_rescue_device'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vm_boot_spec'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'reconfigure_vm'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'power_on_instance'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'get_datastore_by_ref'"
op|')'
newline|'\n'
DECL|member|test_rescue
name|'def'
name|'test_rescue'
op|'('
name|'self'
op|','
name|'mock_get_ds_by_ref'
op|','
name|'mock_power_on'
op|','
name|'mock_reconfigure'
op|','
nl|'\n'
name|'mock_get_boot_spec'
op|','
name|'mock_find_rescue'
op|','
nl|'\n'
name|'mock_get_values'
op|','
name|'mock_get_vm_ref'
op|','
name|'mock_disk_copy'
op|','
nl|'\n'
name|'mock_power_off'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'_volumeops'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'='
name|'_volumeops'
newline|'\n'
nl|'\n'
name|'ds'
op|'='
name|'ds_obj'
op|'.'
name|'Datastore'
op|'('
string|"'fake-ref'"
op|','
string|"'ds1'"
op|')'
newline|'\n'
name|'mock_get_ds_by_ref'
op|'.'
name|'return_value'
op|'='
name|'ds'
newline|'\n'
name|'mock_find_rescue'
op|'.'
name|'return_value'
op|'='
string|"'fake-rescue-device'"
newline|'\n'
name|'mock_get_boot_spec'
op|'.'
name|'return_value'
op|'='
string|"'fake-boot-spec'"
newline|'\n'
nl|'\n'
name|'device'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'backing'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'backing'
op|'.'
name|'datastore'
op|'='
name|'ds'
op|'.'
name|'ref'
newline|'\n'
name|'device'
op|'.'
name|'backing'
op|'='
name|'backing'
newline|'\n'
name|'vmdk'
op|'='
name|'vm_util'
op|'.'
name|'VmdkInfo'
op|'('
string|"'[fake] uuid/root.vmdk'"
op|','
nl|'\n'
string|"'fake-adapter'"
op|','
nl|'\n'
string|"'fake-disk'"
op|','
nl|'\n'
string|"'fake-capacity'"
op|','
nl|'\n'
name|'device'
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|','
string|"'get_datacenter_ref_and_name'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vmdk_info'"
op|','
nl|'\n'
name|'return_value'
op|'='
name|'vmdk'
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'_get_dc_ref_and_name'
op|','
name|'fake_vmdk_info'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'dc_info'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'_get_dc_ref_and_name'
op|'.'
name|'return_value'
op|'='
name|'dc_info'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'rescue'
op|'('
name|'self'
op|'.'
name|'_context'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
name|'None'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'mock_power_off'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-ref'"
op|')'
newline|'\n'
nl|'\n'
name|'uuid'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'image_ref'
newline|'\n'
name|'cache_path'
op|'='
name|'ds'
op|'.'
name|'build_path'
op|'('
string|"'vmware_base'"
op|','
name|'uuid'
op|','
name|'uuid'
op|'+'
string|"'.vmdk'"
op|')'
newline|'\n'
name|'rescue_path'
op|'='
name|'ds'
op|'.'
name|'build_path'
op|'('
string|"'fake_uuid'"
op|','
name|'uuid'
op|'+'
string|"'-rescue.vmdk'"
op|')'
newline|'\n'
nl|'\n'
name|'mock_disk_copy'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
name|'dc_info'
op|'.'
name|'ref'
op|','
nl|'\n'
name|'cache_path'
op|','
name|'rescue_path'
op|')'
newline|'\n'
name|'_volumeops'
op|'.'
name|'attach_disk_to_vm'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-ref'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
name|'mock'
op|'.'
name|'ANY'
op|','
name|'mock'
op|'.'
name|'ANY'
op|','
name|'rescue_path'
op|')'
newline|'\n'
name|'mock_get_boot_spec'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'ANY'
op|','
nl|'\n'
string|"'fake-rescue-device'"
op|')'
newline|'\n'
name|'mock_reconfigure'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
string|"'fake-ref'"
op|','
nl|'\n'
string|"'fake-boot-spec'"
op|')'
newline|'\n'
name|'mock_power_on'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'vm_ref'
op|'='
string|"'fake-ref'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_unrescue_power_on
dedent|''
dedent|''
name|'def'
name|'test_unrescue_power_on'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_unrescue'
op|'('
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_unrescue_power_off
dedent|''
name|'def'
name|'test_unrescue_power_off'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_unrescue'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_unrescue
dedent|''
name|'def'
name|'_test_unrescue'
op|'('
name|'self'
op|','
name|'power_on'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'_volumeops'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'='
name|'_volumeops'
newline|'\n'
name|'vm_ref'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|fake_call_method
name|'def'
name|'fake_call_method'
op|'('
name|'module'
op|','
name|'method'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'expected_args'
op|'='
op|'('
name|'vm_ref'
op|','
string|"'VirtualMachine'"
op|','
nl|'\n'
string|"'config.hardware.device'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'get_dynamic_property'"
op|','
name|'method'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_args'
op|','
name|'args'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'power_on_instance'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'find_rescue_device'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vm_ref'"
op|','
name|'return_value'
op|'='
name|'vm_ref'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'fake_call_method'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'power_off_instance'"
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'_power_on_instance'
op|','
name|'_find_rescue'
op|','
name|'_get_vm_ref'
op|','
nl|'\n'
name|'_call_method'
op|','
name|'_power_off'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'unrescue'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
name|'power_on'
op|'='
name|'power_on'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'power_on'
op|':'
newline|'\n'
indent|'                '
name|'_power_on_instance'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
name|'vm_ref'
op|'='
name|'vm_ref'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'_power_on_instance'
op|'.'
name|'called'
op|')'
newline|'\n'
dedent|''
name|'_get_vm_ref'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
name|'_power_off'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'vm_ref'
op|')'
newline|'\n'
name|'_volumeops'
op|'.'
name|'detach_disk_from_vm'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'vm_ref'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
name|'mock'
op|'.'
name|'ANY'
op|','
name|'destroy_disk'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_finish_migration
dedent|''
dedent|''
name|'def'
name|'_test_finish_migration'
op|'('
name|'self'
op|','
name|'power_on'
op|'='
name|'True'
op|','
name|'resize_instance'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|','
string|"'_resize_create_ephemerals'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|','
string|'"_update_instance_progress"'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"power_on_instance"'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_vm_ref"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-ref'"
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_resize_create_ephemerals'
op|','
name|'fake_update_instance_progress'
op|','
nl|'\n'
name|'fake_power_on'
op|','
name|'fake_get_vm_ref'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'finish_migration'
op|'('
name|'context'
op|'='
name|'self'
op|'.'
name|'_context'
op|','
nl|'\n'
name|'migration'
op|'='
name|'None'
op|','
nl|'\n'
name|'instance'
op|'='
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'disk_info'
op|'='
name|'None'
op|','
nl|'\n'
name|'network_info'
op|'='
name|'None'
op|','
nl|'\n'
name|'block_device_info'
op|'='
name|'None'
op|','
nl|'\n'
name|'resize_instance'
op|'='
name|'resize_instance'
op|','
nl|'\n'
name|'image_meta'
op|'='
name|'None'
op|','
nl|'\n'
name|'power_on'
op|'='
name|'power_on'
op|')'
newline|'\n'
name|'fake_resize_create_ephemerals'
op|'.'
name|'called_once_with'
op|'('
string|"'fake-ref'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'None'
op|')'
newline|'\n'
name|'if'
name|'power_on'
op|':'
newline|'\n'
indent|'                '
name|'fake_power_on'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'vm_ref'
op|'='
string|"'fake-ref'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'fake_power_on'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'calls'
op|'='
op|'['
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
name|'self'
op|'.'
name|'_context'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
name|'step'
op|'='
number|'5'
op|','
nl|'\n'
name|'total_steps'
op|'='
name|'vmops'
op|'.'
name|'RESIZE_TOTAL_STEPS'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
name|'self'
op|'.'
name|'_context'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
name|'step'
op|'='
number|'6'
op|','
nl|'\n'
name|'total_steps'
op|'='
name|'vmops'
op|'.'
name|'RESIZE_TOTAL_STEPS'
op|')'
op|']'
newline|'\n'
name|'fake_update_instance_progress'
op|'.'
name|'assert_has_calls'
op|'('
name|'calls'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_finish_migration_power_on
dedent|''
name|'def'
name|'test_finish_migration_power_on'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_finish_migration'
op|'('
name|'power_on'
op|'='
name|'True'
op|','
name|'resize_instance'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_finish_migration_power_off
dedent|''
name|'def'
name|'test_finish_migration_power_off'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_finish_migration'
op|'('
name|'power_on'
op|'='
name|'False'
op|','
name|'resize_instance'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_finish_migration_power_on_resize
dedent|''
name|'def'
name|'test_finish_migration_power_on_resize'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_finish_migration'
op|'('
name|'power_on'
op|'='
name|'True'
op|','
name|'resize_instance'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_get_extra_specs'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_resize_create_ephemerals'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_remove_ephemerals'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'disk_delete'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'disk_move'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'file_exists'"
op|','
nl|'\n'
name|'return_value'
op|'='
name|'True'
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_get_ds_browser'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-browser'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'reconfigure_vm'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vm_resize_spec'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-spec'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'power_off_instance'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vm_ref'"
op|','
name|'return_value'
op|'='
string|"'fake-ref'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'power_on_instance'"
op|')'
newline|'\n'
DECL|member|_test_finish_revert_migration
name|'def'
name|'_test_finish_revert_migration'
op|'('
name|'self'
op|','
name|'fake_power_on'
op|','
nl|'\n'
name|'fake_get_vm_ref'
op|','
name|'fake_power_off'
op|','
nl|'\n'
name|'fake_resize_spec'
op|','
name|'fake_reconfigure_vm'
op|','
nl|'\n'
name|'fake_get_browser'
op|','
nl|'\n'
name|'fake_original_exists'
op|','
name|'fake_disk_move'
op|','
nl|'\n'
name|'fake_disk_delete'
op|','
nl|'\n'
name|'fake_remove_ephemerals'
op|','
nl|'\n'
name|'fake_resize_create_ephemerals'
op|','
nl|'\n'
name|'fake_get_extra_specs'
op|','
nl|'\n'
name|'power_on'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Tests the finish_revert_migration method on vmops."""'
newline|'\n'
name|'datastore'
op|'='
name|'ds_obj'
op|'.'
name|'Datastore'
op|'('
name|'ref'
op|'='
string|"'fake-ref'"
op|','
name|'name'
op|'='
string|"'fake'"
op|')'
newline|'\n'
name|'device'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'backing'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'backing'
op|'.'
name|'datastore'
op|'='
name|'datastore'
op|'.'
name|'ref'
newline|'\n'
name|'device'
op|'.'
name|'backing'
op|'='
name|'backing'
newline|'\n'
name|'vmdk'
op|'='
name|'vm_util'
op|'.'
name|'VmdkInfo'
op|'('
string|"'[fake] uuid/root.vmdk'"
op|','
nl|'\n'
string|"'fake-adapter'"
op|','
nl|'\n'
string|"'fake-disk'"
op|','
nl|'\n'
string|"'fake-capacity'"
op|','
nl|'\n'
name|'device'
op|')'
newline|'\n'
name|'dc_info'
op|'='
name|'vmops'
op|'.'
name|'DcInfo'
op|'('
name|'ref'
op|'='
string|"'fake_ref'"
op|','
name|'name'
op|'='
string|"'fake'"
op|','
nl|'\n'
name|'vmFolder'
op|'='
string|"'fake_folder'"
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
op|')'
newline|'\n'
name|'fake_get_extra_specs'
op|'.'
name|'return_value'
op|'='
name|'extra_specs'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|','
string|"'get_datacenter_ref_and_name'"
op|','
nl|'\n'
name|'return_value'
op|'='
name|'dc_info'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vmdk_info'"
op|','
nl|'\n'
name|'return_value'
op|'='
name|'vmdk'
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_get_dc_ref_and_name'
op|','
name|'fake_get_vmdk_info'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'mock_attach_disk'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'.'
name|'attach_disk_to_vm'
newline|'\n'
name|'mock_detach_disk'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'.'
name|'detach_disk_from_vm'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'finish_revert_migration'
op|'('
name|'self'
op|'.'
name|'_context'
op|','
nl|'\n'
name|'instance'
op|'='
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'network_info'
op|'='
name|'None'
op|','
nl|'\n'
name|'block_device_info'
op|'='
name|'None'
op|','
nl|'\n'
name|'power_on'
op|'='
name|'power_on'
op|')'
newline|'\n'
name|'fake_get_vm_ref'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
name|'fake_power_off'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-ref'"
op|')'
newline|'\n'
comment|'# Validate VM reconfiguration'
nl|'\n'
name|'fake_resize_spec'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|'.'
name|'vim'
op|'.'
name|'client'
op|'.'
name|'factory'
op|','
nl|'\n'
name|'int'
op|'('
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'vcpus'
op|')'
op|','
nl|'\n'
name|'int'
op|'('
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'memory_mb'
op|')'
op|','
nl|'\n'
name|'extra_specs'
op|')'
newline|'\n'
name|'fake_reconfigure_vm'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
string|"'fake-ref'"
op|','
nl|'\n'
string|"'fake-spec'"
op|')'
newline|'\n'
comment|'# Validate disk configuration'
nl|'\n'
name|'fake_get_vmdk_info'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
string|"'fake-ref'"
op|','
name|'uuid'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
op|')'
newline|'\n'
name|'fake_get_browser'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-ref'"
op|')'
newline|'\n'
name|'fake_original_exists'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
string|"'fake-browser'"
op|','
nl|'\n'
name|'ds_obj'
op|'.'
name|'DatastorePath'
op|'('
name|'datastore'
op|'.'
name|'name'
op|','
string|"'uuid'"
op|')'
op|','
nl|'\n'
string|"'original.vmdk'"
op|')'
newline|'\n'
nl|'\n'
name|'mock_detach_disk'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-ref'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'device'
op|')'
newline|'\n'
name|'fake_disk_delete'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'dc_info'
op|'.'
name|'ref'
op|','
string|"'[fake] uuid/root.vmdk'"
op|')'
newline|'\n'
name|'fake_disk_move'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'dc_info'
op|'.'
name|'ref'
op|','
nl|'\n'
string|"'[fake] uuid/original.vmdk'"
op|','
nl|'\n'
string|"'[fake] uuid/root.vmdk'"
op|')'
newline|'\n'
name|'mock_attach_disk'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
string|"'fake-ref'"
op|','
name|'self'
op|'.'
name|'_instance'
op|','
string|"'fake-adapter'"
op|','
string|"'fake-disk'"
op|','
nl|'\n'
string|"'[fake] uuid/root.vmdk'"
op|')'
newline|'\n'
name|'fake_remove_ephemerals'
op|'.'
name|'called_once_with'
op|'('
string|"'fake-ref'"
op|')'
newline|'\n'
name|'fake_resize_create_ephemerals'
op|'.'
name|'called_once_with'
op|'('
string|"'fake-ref'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'None'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'power_on'
op|':'
newline|'\n'
indent|'            '
name|'fake_power_on'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'fake_power_on'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_finish_revert_migration_power_on
dedent|''
dedent|''
name|'def'
name|'test_finish_revert_migration_power_on'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_finish_revert_migration'
op|'('
name|'power_on'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_finish_revert_migration_power_off
dedent|''
name|'def'
name|'test_finish_revert_migration_power_off'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_finish_revert_migration'
op|'('
name|'power_on'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_get_extra_specs'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'reconfigure_vm'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vm_resize_spec'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-spec'"
op|')'
newline|'\n'
DECL|member|test_resize_vm
name|'def'
name|'test_resize_vm'
op|'('
name|'self'
op|','
name|'fake_resize_spec'
op|','
name|'fake_reconfigure'
op|','
nl|'\n'
name|'fake_get_extra_specs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
op|')'
newline|'\n'
name|'fake_get_extra_specs'
op|'.'
name|'return_value'
op|'='
name|'extra_specs'
newline|'\n'
name|'flavor'
op|'='
op|'{'
string|"'vcpus'"
op|':'
number|'2'
op|','
string|"'memory_mb'"
op|':'
number|'1024'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_resize_vm'
op|'('
string|"'vm-ref'"
op|','
name|'flavor'
op|')'
newline|'\n'
name|'fake_resize_spec'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|'.'
name|'vim'
op|'.'
name|'client'
op|'.'
name|'factory'
op|','
number|'2'
op|','
number|'1024'
op|','
name|'extra_specs'
op|')'
newline|'\n'
name|'fake_reconfigure'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
string|"'vm-ref'"
op|','
string|"'fake-spec'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_extend_virtual_disk'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'disk_move'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'disk_copy'"
op|')'
newline|'\n'
DECL|member|test_resize_disk
name|'def'
name|'test_resize_disk'
op|'('
name|'self'
op|','
name|'fake_disk_copy'
op|','
name|'fake_disk_move'
op|','
nl|'\n'
name|'fake_extend'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'datastore'
op|'='
name|'ds_obj'
op|'.'
name|'Datastore'
op|'('
name|'ref'
op|'='
string|"'fake-ref'"
op|','
name|'name'
op|'='
string|"'fake'"
op|')'
newline|'\n'
name|'device'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'backing'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'backing'
op|'.'
name|'datastore'
op|'='
name|'datastore'
op|'.'
name|'ref'
newline|'\n'
name|'device'
op|'.'
name|'backing'
op|'='
name|'backing'
newline|'\n'
name|'vmdk'
op|'='
name|'vm_util'
op|'.'
name|'VmdkInfo'
op|'('
string|"'[fake] uuid/root.vmdk'"
op|','
nl|'\n'
string|"'fake-adapter'"
op|','
nl|'\n'
string|"'fake-disk'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'root_gb'
op|'*'
name|'units'
op|'.'
name|'Gi'
op|','
nl|'\n'
name|'device'
op|')'
newline|'\n'
name|'dc_info'
op|'='
name|'vmops'
op|'.'
name|'DcInfo'
op|'('
name|'ref'
op|'='
string|"'fake_ref'"
op|','
name|'name'
op|'='
string|"'fake'"
op|','
nl|'\n'
name|'vmFolder'
op|'='
string|"'fake_folder'"
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|','
string|"'get_datacenter_ref_and_name'"
op|','
nl|'\n'
name|'return_value'
op|'='
name|'dc_info'
op|')'
name|'as'
name|'fake_get_dc_ref_and_name'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'mock_attach_disk'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'.'
name|'attach_disk_to_vm'
newline|'\n'
name|'mock_detach_disk'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'.'
name|'detach_disk_from_vm'
newline|'\n'
nl|'\n'
name|'flavor'
op|'='
op|'{'
string|"'root_gb'"
op|':'
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'root_gb'
op|'+'
number|'1'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_resize_disk'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
string|"'fake-ref'"
op|','
name|'vmdk'
op|','
name|'flavor'
op|')'
newline|'\n'
name|'fake_get_dc_ref_and_name'
op|'.'
name|'assert_called_once_with'
op|'('
name|'datastore'
op|'.'
name|'ref'
op|')'
newline|'\n'
name|'fake_disk_copy'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'dc_info'
op|'.'
name|'ref'
op|','
string|"'[fake] uuid/root.vmdk'"
op|','
nl|'\n'
string|"'[fake] uuid/resized.vmdk'"
op|')'
newline|'\n'
name|'mock_detach_disk'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-ref'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'device'
op|')'
newline|'\n'
name|'fake_extend'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
name|'flavor'
op|'['
string|"'root_gb'"
op|']'
op|'*'
name|'units'
op|'.'
name|'Mi'
op|','
nl|'\n'
string|"'[fake] uuid/resized.vmdk'"
op|','
name|'dc_info'
op|'.'
name|'ref'
op|')'
newline|'\n'
name|'calls'
op|'='
op|'['
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
name|'dc_info'
op|'.'
name|'ref'
op|','
nl|'\n'
string|"'[fake] uuid/root.vmdk'"
op|','
nl|'\n'
string|"'[fake] uuid/original.vmdk'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
name|'dc_info'
op|'.'
name|'ref'
op|','
nl|'\n'
string|"'[fake] uuid/resized.vmdk'"
op|','
nl|'\n'
string|"'[fake] uuid/root.vmdk'"
op|')'
op|']'
newline|'\n'
name|'fake_disk_move'
op|'.'
name|'assert_has_calls'
op|'('
name|'calls'
op|')'
newline|'\n'
nl|'\n'
name|'mock_attach_disk'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
string|"'fake-ref'"
op|','
name|'self'
op|'.'
name|'_instance'
op|','
string|"'fake-adapter'"
op|','
string|"'fake-disk'"
op|','
nl|'\n'
string|"'[fake] uuid/root.vmdk'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'disk_delete'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'file_exists'"
op|','
nl|'\n'
name|'return_value'
op|'='
name|'True'
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_get_ds_browser'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-browser'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vm_ref'"
op|','
name|'return_value'
op|'='
string|"'fake-ref'"
op|')'
newline|'\n'
DECL|member|test_confirm_migration
name|'def'
name|'test_confirm_migration'
op|'('
name|'self'
op|','
name|'fake_get_vm_ref'
op|','
name|'fake_get_browser'
op|','
nl|'\n'
name|'fake_original_exists'
op|','
nl|'\n'
name|'fake_disk_delete'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Tests the confirm_migration method on vmops."""'
newline|'\n'
name|'datastore'
op|'='
name|'ds_obj'
op|'.'
name|'Datastore'
op|'('
name|'ref'
op|'='
string|"'fake-ref'"
op|','
name|'name'
op|'='
string|"'fake'"
op|')'
newline|'\n'
name|'device'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'backing'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'backing'
op|'.'
name|'datastore'
op|'='
name|'datastore'
op|'.'
name|'ref'
newline|'\n'
name|'device'
op|'.'
name|'backing'
op|'='
name|'backing'
newline|'\n'
name|'vmdk'
op|'='
name|'vm_util'
op|'.'
name|'VmdkInfo'
op|'('
string|"'[fake] uuid/root.vmdk'"
op|','
nl|'\n'
string|"'fake-adapter'"
op|','
nl|'\n'
string|"'fake-disk'"
op|','
nl|'\n'
string|"'fake-capacity'"
op|','
nl|'\n'
name|'device'
op|')'
newline|'\n'
name|'dc_info'
op|'='
name|'vmops'
op|'.'
name|'DcInfo'
op|'('
name|'ref'
op|'='
string|"'fake_ref'"
op|','
name|'name'
op|'='
string|"'fake'"
op|','
nl|'\n'
name|'vmFolder'
op|'='
string|"'fake_folder'"
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|','
string|"'get_datacenter_ref_and_name'"
op|','
nl|'\n'
name|'return_value'
op|'='
name|'dc_info'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vmdk_info'"
op|','
nl|'\n'
name|'return_value'
op|'='
name|'vmdk'
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_get_dc_ref_and_name'
op|','
name|'fake_get_vmdk_info'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'confirm_migration'
op|'('
name|'None'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'None'
op|')'
newline|'\n'
name|'fake_get_vm_ref'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
name|'fake_get_vmdk_info'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
string|"'fake-ref'"
op|','
name|'uuid'
op|'='
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
op|')'
newline|'\n'
name|'fake_get_browser'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-ref'"
op|')'
newline|'\n'
name|'fake_original_exists'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
string|"'fake-browser'"
op|','
nl|'\n'
name|'ds_obj'
op|'.'
name|'DatastorePath'
op|'('
name|'datastore'
op|'.'
name|'name'
op|','
string|"'uuid'"
op|')'
op|','
nl|'\n'
string|"'original.vmdk'"
op|')'
newline|'\n'
name|'fake_disk_delete'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'dc_info'
op|'.'
name|'ref'
op|','
string|"'[fake] uuid/original.vmdk'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|'"_remove_ephemerals"'
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vmdk_info'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|'"_resize_disk"'
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|'"_resize_vm"'
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'power_off_instance'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|'"_update_instance_progress"'
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'get_vm_ref'"
op|','
name|'return_value'
op|'='
string|"'fake-ref'"
op|')'
newline|'\n'
DECL|member|test_migrate_disk_and_power_off
name|'def'
name|'test_migrate_disk_and_power_off'
op|'('
name|'self'
op|','
name|'fake_get_vm_ref'
op|','
name|'fake_progress'
op|','
nl|'\n'
name|'fake_power_off'
op|','
name|'fake_resize_vm'
op|','
nl|'\n'
name|'fake_resize_disk'
op|','
name|'fake_get_vmdk_info'
op|','
nl|'\n'
name|'fake_remove_ephemerals'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vmdk'
op|'='
name|'vm_util'
op|'.'
name|'VmdkInfo'
op|'('
string|"'[fake] uuid/root.vmdk'"
op|','
nl|'\n'
string|"'fake-adapter'"
op|','
nl|'\n'
string|"'fake-disk'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'root_gb'
op|'*'
name|'units'
op|'.'
name|'Gi'
op|','
nl|'\n'
string|"'fake-device'"
op|')'
newline|'\n'
name|'fake_get_vmdk_info'
op|'.'
name|'return_value'
op|'='
name|'vmdk'
newline|'\n'
name|'flavor'
op|'='
op|'{'
string|"'root_gb'"
op|':'
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'root_gb'
op|'+'
number|'1'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'migrate_disk_and_power_off'
op|'('
name|'self'
op|'.'
name|'_context'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'None'
op|','
nl|'\n'
name|'flavor'
op|')'
newline|'\n'
nl|'\n'
name|'fake_get_vm_ref'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
nl|'\n'
name|'fake_power_off'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-ref'"
op|')'
newline|'\n'
name|'fake_resize_vm'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-ref'"
op|','
name|'flavor'
op|')'
newline|'\n'
name|'fake_resize_disk'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
string|"'fake-ref'"
op|','
nl|'\n'
name|'vmdk'
op|','
name|'flavor'
op|')'
newline|'\n'
name|'calls'
op|'='
op|'['
name|'mock'
op|'.'
name|'call'
op|'('
name|'self'
op|'.'
name|'_context'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
name|'step'
op|'='
name|'i'
op|','
nl|'\n'
name|'total_steps'
op|'='
name|'vmops'
op|'.'
name|'RESIZE_TOTAL_STEPS'
op|')'
nl|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'4'
op|')'
op|']'
newline|'\n'
name|'fake_progress'
op|'.'
name|'assert_has_calls'
op|'('
name|'calls'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_attach_cdrom_to_vm'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_create_config_drive'"
op|')'
newline|'\n'
DECL|member|test_configure_config_drive
name|'def'
name|'test_configure_config_drive'
op|'('
name|'self'
op|','
nl|'\n'
name|'mock_create_config_drive'
op|','
nl|'\n'
name|'mock_attach_cdrom_to_vm'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'injected_files'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'admin_password'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'vm_ref'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'mock_create_config_drive'
op|'.'
name|'return_value'
op|'='
string|'"fake_iso_path"'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_configure_config_drive'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
name|'vm_ref'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|','
name|'self'
op|'.'
name|'_ds'
op|','
nl|'\n'
name|'injected_files'
op|','
name|'admin_password'
op|')'
newline|'\n'
nl|'\n'
name|'upload_iso_path'
op|'='
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'build_path'
op|'('
string|'"fake_iso_path"'
op|')'
newline|'\n'
name|'mock_create_config_drive'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'injected_files'
op|','
name|'admin_password'
op|','
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
op|','
string|'"Fake-CookieJar"'
op|')'
newline|'\n'
name|'mock_attach_cdrom_to_vm'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'vm_ref'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'ref'
op|','
name|'str'
op|'('
name|'upload_iso_path'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'LOG'
op|','
string|"'debug'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_fetch_image_if_missing'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_get_vm_config_info'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'build_virtual_machine'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'lockutils'
op|','
string|"'lock'"
op|')'
newline|'\n'
DECL|member|test_spawn_mask_block_device_info_password
name|'def'
name|'test_spawn_mask_block_device_info_password'
op|'('
name|'self'
op|','
name|'mock_lock'
op|','
nl|'\n'
name|'mock_build_virtual_machine'
op|','
name|'mock_get_vm_config_info'
op|','
nl|'\n'
name|'mock_fetch_image_if_missing'
op|','
name|'mock_debug'
op|')'
op|':'
newline|'\n'
comment|'# Very simple test that just ensures block_device_info auth_password'
nl|'\n'
comment|'# is masked when logged; the rest of the test just fails out early.'
nl|'\n'
indent|'        '
name|'data'
op|'='
op|'{'
string|"'auth_password'"
op|':'
string|"'scrubme'"
op|'}'
newline|'\n'
name|'bdm'
op|'='
op|'['
op|'{'
string|"'boot_index'"
op|':'
number|'0'
op|','
string|"'disk_bus'"
op|':'
name|'constants'
op|'.'
name|'DEFAULT_ADAPTER_TYPE'
op|','
nl|'\n'
string|"'connection_info'"
op|':'
op|'{'
string|"'data'"
op|':'
name|'data'
op|'}'
op|'}'
op|']'
newline|'\n'
name|'bdi'
op|'='
op|'{'
string|"'block_device_mapping'"
op|':'
name|'bdm'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'password_logged'
op|'='
name|'False'
newline|'\n'
nl|'\n'
comment|'# Tests that the parameters to the to_xml method are sanitized for'
nl|'\n'
comment|'# passwords when logged.'
nl|'\n'
DECL|function|fake_debug
name|'def'
name|'fake_debug'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
string|"'auth_password'"
name|'in'
name|'args'
op|'['
number|'0'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'password_logged'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
string|"'scrubme'"
op|','
name|'args'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'mock_debug'
op|'.'
name|'side_effect'
op|'='
name|'fake_debug'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'flat_injected'
op|'='
name|'False'
op|','
name|'vnc_enabled'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
comment|"# Call spawn(). We don't care what it does as long as it generates"
nl|'\n'
comment|'# the log message, which we check below.'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|','
string|"'_volumeops'"
op|')'
name|'as'
name|'mock_vo'
op|':'
newline|'\n'
indent|'            '
name|'mock_vo'
op|'.'
name|'attach_root_volume'
op|'.'
name|'side_effect'
op|'='
name|'test'
op|'.'
name|'TestingException'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'spawn'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_context'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'injected_files'
op|'='
name|'None'
op|','
name|'admin_password'
op|'='
name|'None'
op|','
nl|'\n'
name|'network_info'
op|'='
op|'['
op|']'
op|','
name|'block_device_info'
op|'='
name|'bdi'
nl|'\n'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'test'
op|'.'
name|'TestingException'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
comment|'# Check that the relevant log message was generated, and therefore'
nl|'\n'
comment|'# that we checked it was scrubbed'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'password_logged'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.vmwareapi.vm_util.power_on_instance'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_use_disk_image_as_linked_clone'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_fetch_image_if_missing'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
nl|'\n'
string|"'nova.virt.vmwareapi.imagecache.ImageCacheManager.enlist_image'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'build_virtual_machine'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_get_vm_config_info'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_get_extra_specs'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
op|'.'
name|'images'
op|'.'
name|'VMwareImage'
op|','
nl|'\n'
string|"'from_image'"
op|')'
newline|'\n'
DECL|member|test_spawn_non_root_block_device
name|'def'
name|'test_spawn_non_root_block_device'
op|'('
name|'self'
op|','
name|'from_image'
op|','
nl|'\n'
name|'get_extra_specs'
op|','
nl|'\n'
name|'get_vm_config_info'
op|','
nl|'\n'
name|'build_virtual_machine'
op|','
nl|'\n'
name|'enlist_image'
op|','
name|'fetch_image'
op|','
nl|'\n'
name|'use_disk_image'
op|','
nl|'\n'
name|'power_on_instance'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'extra_specs'
op|'='
name|'get_extra_specs'
op|'.'
name|'return_value'
newline|'\n'
nl|'\n'
name|'connection_info1'
op|'='
op|'{'
string|"'data'"
op|':'
string|"'fake-data1'"
op|','
string|"'serial'"
op|':'
string|"'volume-fake-id1'"
op|'}'
newline|'\n'
name|'connection_info2'
op|'='
op|'{'
string|"'data'"
op|':'
string|"'fake-data2'"
op|','
string|"'serial'"
op|':'
string|"'volume-fake-id2'"
op|'}'
newline|'\n'
name|'bdm'
op|'='
op|'['
op|'{'
string|"'connection_info'"
op|':'
name|'connection_info1'
op|','
nl|'\n'
string|"'disk_bus'"
op|':'
name|'constants'
op|'.'
name|'ADAPTER_TYPE_IDE'
op|','
nl|'\n'
string|"'mount_device'"
op|':'
string|"'/dev/sdb'"
op|'}'
op|','
nl|'\n'
op|'{'
string|"'connection_info'"
op|':'
name|'connection_info2'
op|','
nl|'\n'
string|"'disk_bus'"
op|':'
name|'constants'
op|'.'
name|'DEFAULT_ADAPTER_TYPE'
op|','
nl|'\n'
string|"'mount_device'"
op|':'
string|"'/dev/sdc'"
op|'}'
op|']'
newline|'\n'
name|'bdi'
op|'='
op|'{'
string|"'block_device_mapping'"
op|':'
name|'bdm'
op|','
string|"'root_device_name'"
op|':'
string|"'/dev/sda'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'flat_injected'
op|'='
name|'False'
op|','
name|'vnc_enabled'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'image_size'
op|'='
op|'('
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'root_gb'
op|')'
op|'*'
name|'units'
op|'.'
name|'Gi'
op|'/'
number|'2'
newline|'\n'
name|'image_info'
op|'='
name|'images'
op|'.'
name|'VMwareImage'
op|'('
nl|'\n'
name|'image_id'
op|'='
name|'self'
op|'.'
name|'_image_id'
op|','
nl|'\n'
name|'file_size'
op|'='
name|'image_size'
op|')'
newline|'\n'
name|'vi'
op|'='
name|'get_vm_config_info'
op|'.'
name|'return_value'
newline|'\n'
name|'from_image'
op|'.'
name|'return_value'
op|'='
name|'image_info'
newline|'\n'
name|'build_virtual_machine'
op|'.'
name|'return_value'
op|'='
string|"'fake-vm-ref'"
newline|'\n'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|','
string|"'_volumeops'"
op|')'
name|'as'
name|'volumeops'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'spawn'
op|'('
name|'self'
op|'.'
name|'_context'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'injected_files'
op|'='
name|'None'
op|','
name|'admin_password'
op|'='
name|'None'
op|','
nl|'\n'
name|'network_info'
op|'='
op|'['
op|']'
op|','
name|'block_device_info'
op|'='
name|'bdi'
op|')'
newline|'\n'
nl|'\n'
name|'from_image'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'image_ref'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'get_vm_config_info'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'image_info'
op|','
name|'extra_specs'
op|'.'
name|'storage_policy'
op|')'
newline|'\n'
name|'build_virtual_machine'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'image_info'
op|','
name|'vi'
op|'.'
name|'dc_info'
op|','
name|'vi'
op|'.'
name|'datastore'
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|')'
newline|'\n'
name|'enlist_image'
op|'.'
name|'assert_called_once_with'
op|'('
name|'image_info'
op|'.'
name|'image_id'
op|','
nl|'\n'
name|'vi'
op|'.'
name|'datastore'
op|','
name|'vi'
op|'.'
name|'dc_info'
op|'.'
name|'ref'
op|')'
newline|'\n'
name|'fetch_image'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_context'
op|','
name|'vi'
op|')'
newline|'\n'
name|'use_disk_image'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-vm-ref'"
op|','
name|'vi'
op|')'
newline|'\n'
name|'volumeops'
op|'.'
name|'attach_volume'
op|'.'
name|'assert_any_call'
op|'('
nl|'\n'
name|'connection_info1'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
name|'constants'
op|'.'
name|'ADAPTER_TYPE_IDE'
op|')'
newline|'\n'
name|'volumeops'
op|'.'
name|'attach_volume'
op|'.'
name|'assert_any_call'
op|'('
nl|'\n'
name|'connection_info2'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'constants'
op|'.'
name|'DEFAULT_ADAPTER_TYPE'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.vmwareapi.vm_util.power_on_instance'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'build_virtual_machine'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_get_vm_config_info'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_get_extra_specs'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
op|'.'
name|'images'
op|'.'
name|'VMwareImage'
op|','
nl|'\n'
string|"'from_image'"
op|')'
newline|'\n'
DECL|member|test_spawn_with_no_image_and_block_devices
name|'def'
name|'test_spawn_with_no_image_and_block_devices'
op|'('
name|'self'
op|','
name|'from_image'
op|','
nl|'\n'
name|'get_extra_specs'
op|','
nl|'\n'
name|'get_vm_config_info'
op|','
nl|'\n'
name|'build_virtual_machine'
op|','
nl|'\n'
name|'power_on_instance'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'image_ref'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'flavor'
op|'='
name|'self'
op|'.'
name|'_flavor'
newline|'\n'
name|'extra_specs'
op|'='
name|'get_extra_specs'
op|'.'
name|'return_value'
newline|'\n'
nl|'\n'
name|'connection_info1'
op|'='
op|'{'
string|"'data'"
op|':'
string|"'fake-data1'"
op|','
string|"'serial'"
op|':'
string|"'volume-fake-id1'"
op|'}'
newline|'\n'
name|'connection_info2'
op|'='
op|'{'
string|"'data'"
op|':'
string|"'fake-data2'"
op|','
string|"'serial'"
op|':'
string|"'volume-fake-id2'"
op|'}'
newline|'\n'
name|'connection_info3'
op|'='
op|'{'
string|"'data'"
op|':'
string|"'fake-data3'"
op|','
string|"'serial'"
op|':'
string|"'volume-fake-id3'"
op|'}'
newline|'\n'
name|'bdm'
op|'='
op|'['
op|'{'
string|"'boot_index'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'connection_info'"
op|':'
name|'connection_info1'
op|','
nl|'\n'
string|"'disk_bus'"
op|':'
name|'constants'
op|'.'
name|'ADAPTER_TYPE_IDE'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'boot_index'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'connection_info'"
op|':'
name|'connection_info2'
op|','
nl|'\n'
string|"'disk_bus'"
op|':'
name|'constants'
op|'.'
name|'DEFAULT_ADAPTER_TYPE'
op|'}'
op|','
nl|'\n'
op|'{'
string|"'boot_index'"
op|':'
number|'2'
op|','
nl|'\n'
string|"'connection_info'"
op|':'
name|'connection_info3'
op|','
nl|'\n'
string|"'disk_bus'"
op|':'
name|'constants'
op|'.'
name|'ADAPTER_TYPE_LSILOGICSAS'
op|'}'
op|']'
newline|'\n'
name|'bdi'
op|'='
op|'{'
string|"'block_device_mapping'"
op|':'
name|'bdm'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'flat_injected'
op|'='
name|'False'
op|','
name|'vnc_enabled'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'image_info'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'image_info'
newline|'\n'
name|'vi'
op|'='
name|'get_vm_config_info'
op|'.'
name|'return_value'
newline|'\n'
name|'from_image'
op|'.'
name|'return_value'
op|'='
name|'image_info'
newline|'\n'
name|'build_virtual_machine'
op|'.'
name|'return_value'
op|'='
string|"'fake-vm-ref'"
newline|'\n'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|','
string|"'_volumeops'"
op|')'
name|'as'
name|'volumeops'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'spawn'
op|'('
name|'self'
op|'.'
name|'_context'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'injected_files'
op|'='
name|'None'
op|','
name|'admin_password'
op|'='
name|'None'
op|','
nl|'\n'
name|'network_info'
op|'='
op|'['
op|']'
op|','
name|'block_device_info'
op|'='
name|'bdi'
op|')'
newline|'\n'
nl|'\n'
name|'from_image'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'image_ref'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'get_vm_config_info'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'image_info'
op|','
name|'extra_specs'
op|'.'
name|'storage_policy'
op|')'
newline|'\n'
name|'build_virtual_machine'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'image_info'
op|','
name|'vi'
op|'.'
name|'dc_info'
op|','
name|'vi'
op|'.'
name|'datastore'
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|')'
newline|'\n'
name|'volumeops'
op|'.'
name|'attach_root_volume'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'connection_info1'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
name|'vi'
op|'.'
name|'datastore'
op|'.'
name|'ref'
op|','
nl|'\n'
name|'constants'
op|'.'
name|'ADAPTER_TYPE_IDE'
op|')'
newline|'\n'
name|'volumeops'
op|'.'
name|'attach_volume'
op|'.'
name|'assert_any_call'
op|'('
nl|'\n'
name|'connection_info2'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'constants'
op|'.'
name|'DEFAULT_ADAPTER_TYPE'
op|')'
newline|'\n'
name|'volumeops'
op|'.'
name|'attach_volume'
op|'.'
name|'assert_any_call'
op|'('
nl|'\n'
name|'connection_info3'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'constants'
op|'.'
name|'ADAPTER_TYPE_LSILOGICSAS'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.vmwareapi.vm_util.power_on_instance'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'build_virtual_machine'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_get_vm_config_info'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_get_extra_specs'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
op|'.'
name|'images'
op|'.'
name|'VMwareImage'
op|','
nl|'\n'
string|"'from_image'"
op|')'
newline|'\n'
DECL|member|test_spawn_unsupported_hardware
name|'def'
name|'test_spawn_unsupported_hardware'
op|'('
name|'self'
op|','
name|'from_image'
op|','
nl|'\n'
name|'get_extra_specs'
op|','
nl|'\n'
name|'get_vm_config_info'
op|','
nl|'\n'
name|'build_virtual_machine'
op|','
nl|'\n'
name|'power_on_instance'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'image_ref'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'flavor'
op|'='
name|'self'
op|'.'
name|'_flavor'
newline|'\n'
name|'extra_specs'
op|'='
name|'get_extra_specs'
op|'.'
name|'return_value'
newline|'\n'
nl|'\n'
name|'connection_info'
op|'='
op|'{'
string|"'data'"
op|':'
string|"'fake-data'"
op|','
string|"'serial'"
op|':'
string|"'volume-fake-id'"
op|'}'
newline|'\n'
name|'bdm'
op|'='
op|'['
op|'{'
string|"'boot_index'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'connection_info'"
op|':'
name|'connection_info'
op|','
nl|'\n'
string|"'disk_bus'"
op|':'
string|"'invalid_adapter_type'"
op|'}'
op|']'
newline|'\n'
name|'bdi'
op|'='
op|'{'
string|"'block_device_mapping'"
op|':'
name|'bdm'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'flat_injected'
op|'='
name|'False'
op|','
name|'vnc_enabled'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'image_info'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'image_info'
newline|'\n'
name|'vi'
op|'='
name|'get_vm_config_info'
op|'.'
name|'return_value'
newline|'\n'
name|'from_image'
op|'.'
name|'return_value'
op|'='
name|'image_info'
newline|'\n'
name|'build_virtual_machine'
op|'.'
name|'return_value'
op|'='
string|"'fake-vm-ref'"
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'UnsupportedHardware'
op|','
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'spawn'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_context'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
op|'{'
op|'}'
op|','
nl|'\n'
name|'injected_files'
op|'='
name|'None'
op|','
nl|'\n'
name|'admin_password'
op|'='
name|'None'
op|','
name|'network_info'
op|'='
op|'['
op|']'
op|','
nl|'\n'
name|'block_device_info'
op|'='
name|'bdi'
op|')'
newline|'\n'
nl|'\n'
name|'from_image'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'image_ref'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'get_vm_config_info'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
name|'image_info'
op|','
name|'extra_specs'
op|'.'
name|'storage_policy'
op|')'
newline|'\n'
name|'build_virtual_machine'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'image_info'
op|','
name|'vi'
op|'.'
name|'dc_info'
op|','
name|'vi'
op|'.'
name|'datastore'
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_ds_browser
dedent|''
name|'def'
name|'test_get_ds_browser'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cache'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_datastore_browser_mapping'
newline|'\n'
name|'ds_browser'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'moref'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'ManagedObjectReference'
op|'('
string|"'datastore-100'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'cache'
op|'.'
name|'get'
op|'('
name|'moref'
op|'.'
name|'value'
op|')'
op|')'
newline|'\n'
name|'mock_call_method'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
name|'return_value'
op|'='
name|'ds_browser'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'mock_call_method'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'ret'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_get_ds_browser'
op|'('
name|'moref'
op|')'
newline|'\n'
name|'mock_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'vim_util'
op|','
nl|'\n'
string|"'get_dynamic_property'"
op|','
name|'moref'
op|','
string|"'Datastore'"
op|','
string|"'browser'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIs'
op|'('
name|'ds_browser'
op|','
name|'ret'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIs'
op|'('
name|'ds_browser'
op|','
name|'cache'
op|'.'
name|'get'
op|'('
name|'moref'
op|'.'
name|'value'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_sized_image_exists'"
op|','
name|'return_value'
op|'='
name|'False'
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_extend_virtual_disk'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'copy_virtual_disk'"
op|')'
newline|'\n'
DECL|member|_test_use_disk_image_as_linked_clone
name|'def'
name|'_test_use_disk_image_as_linked_clone'
op|'('
name|'self'
op|','
nl|'\n'
name|'mock_copy_virtual_disk'
op|','
nl|'\n'
name|'mock_extend_virtual_disk'
op|','
nl|'\n'
name|'mock_sized_image_exists'
op|','
nl|'\n'
name|'flavor_fits_image'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_size'
op|'='
number|'10'
op|'*'
name|'units'
op|'.'
name|'Gi'
name|'if'
name|'flavor_fits_image'
name|'else'
number|'5'
op|'*'
name|'units'
op|'.'
name|'Gi'
newline|'\n'
name|'image_info'
op|'='
name|'images'
op|'.'
name|'VMwareImage'
op|'('
nl|'\n'
name|'image_id'
op|'='
name|'self'
op|'.'
name|'_image_id'
op|','
nl|'\n'
name|'file_size'
op|'='
name|'file_size'
op|','
nl|'\n'
name|'linked_clone'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'cache_root_folder'
op|'='
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'build_path'
op|'('
string|'"vmware_base"'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
newline|'\n'
name|'mock_imagecache'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'mock_imagecache'
op|'.'
name|'get_image_cache_folder'
op|'.'
name|'return_value'
op|'='
name|'cache_root_folder'
newline|'\n'
name|'vi'
op|'='
name|'vmops'
op|'.'
name|'VirtualMachineInstanceConfigInfo'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
name|'image_info'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|','
name|'mock_imagecache'
op|')'
newline|'\n'
nl|'\n'
name|'sized_cached_image_ds_loc'
op|'='
name|'cache_root_folder'
op|'.'
name|'join'
op|'('
nl|'\n'
string|'"%s.%s.vmdk"'
op|'%'
op|'('
name|'self'
op|'.'
name|'_image_id'
op|','
name|'vi'
op|'.'
name|'root_gb'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'mock_attach_disk_to_vm'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'.'
name|'attach_disk_to_vm'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_use_disk_image_as_linked_clone'
op|'('
string|'"fake_vm_ref"'
op|','
name|'vi'
op|')'
newline|'\n'
nl|'\n'
name|'mock_copy_virtual_disk'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|','
nl|'\n'
name|'str'
op|'('
name|'vi'
op|'.'
name|'cache_image_path'
op|')'
op|','
nl|'\n'
name|'str'
op|'('
name|'sized_cached_image_ds_loc'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'flavor_fits_image'
op|':'
newline|'\n'
indent|'            '
name|'mock_extend_virtual_disk'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
name|'vi'
op|'.'
name|'root_gb'
op|'*'
name|'units'
op|'.'
name|'Mi'
op|','
nl|'\n'
name|'str'
op|'('
name|'sized_cached_image_ds_loc'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'mock_attach_disk_to_vm'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
string|'"fake_vm_ref"'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
name|'vi'
op|'.'
name|'ii'
op|'.'
name|'adapter_type'
op|','
nl|'\n'
name|'vi'
op|'.'
name|'ii'
op|'.'
name|'disk_type'
op|','
nl|'\n'
name|'str'
op|'('
name|'sized_cached_image_ds_loc'
op|')'
op|','
nl|'\n'
name|'vi'
op|'.'
name|'root_gb'
op|'*'
name|'units'
op|'.'
name|'Mi'
op|','
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_use_disk_image_as_linked_clone
dedent|''
name|'def'
name|'test_use_disk_image_as_linked_clone'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_use_disk_image_as_linked_clone'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_use_disk_image_as_linked_clone_flavor_fits_image
dedent|''
name|'def'
name|'test_use_disk_image_as_linked_clone_flavor_fits_image'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_use_disk_image_as_linked_clone'
op|'('
name|'flavor_fits_image'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_extend_virtual_disk'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'copy_virtual_disk'"
op|')'
newline|'\n'
DECL|member|_test_use_disk_image_as_full_clone
name|'def'
name|'_test_use_disk_image_as_full_clone'
op|'('
name|'self'
op|','
nl|'\n'
name|'mock_copy_virtual_disk'
op|','
nl|'\n'
name|'mock_extend_virtual_disk'
op|','
nl|'\n'
name|'flavor_fits_image'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'file_size'
op|'='
number|'10'
op|'*'
name|'units'
op|'.'
name|'Gi'
name|'if'
name|'flavor_fits_image'
name|'else'
number|'5'
op|'*'
name|'units'
op|'.'
name|'Gi'
newline|'\n'
name|'image_info'
op|'='
name|'images'
op|'.'
name|'VMwareImage'
op|'('
nl|'\n'
name|'image_id'
op|'='
name|'self'
op|'.'
name|'_image_id'
op|','
nl|'\n'
name|'file_size'
op|'='
name|'file_size'
op|','
nl|'\n'
name|'linked_clone'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'cache_root_folder'
op|'='
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'build_path'
op|'('
string|'"vmware_base"'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
newline|'\n'
name|'mock_imagecache'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'mock_imagecache'
op|'.'
name|'get_image_cache_folder'
op|'.'
name|'return_value'
op|'='
name|'cache_root_folder'
newline|'\n'
name|'vi'
op|'='
name|'vmops'
op|'.'
name|'VirtualMachineInstanceConfigInfo'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
name|'image_info'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|','
name|'mock_imagecache'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'mock_attach_disk_to_vm'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'.'
name|'attach_disk_to_vm'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_use_disk_image_as_full_clone'
op|'('
string|'"fake_vm_ref"'
op|','
name|'vi'
op|')'
newline|'\n'
nl|'\n'
name|'mock_copy_virtual_disk'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|','
nl|'\n'
name|'str'
op|'('
name|'vi'
op|'.'
name|'cache_image_path'
op|')'
op|','
nl|'\n'
string|"'[fake_ds] fake_uuid/fake_uuid.vmdk'"
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'flavor_fits_image'
op|':'
newline|'\n'
indent|'            '
name|'mock_extend_virtual_disk'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
name|'vi'
op|'.'
name|'root_gb'
op|'*'
name|'units'
op|'.'
name|'Mi'
op|','
nl|'\n'
string|"'[fake_ds] fake_uuid/fake_uuid.vmdk'"
op|','
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'mock_attach_disk_to_vm'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
string|'"fake_vm_ref"'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
name|'vi'
op|'.'
name|'ii'
op|'.'
name|'adapter_type'
op|','
nl|'\n'
name|'vi'
op|'.'
name|'ii'
op|'.'
name|'disk_type'
op|','
string|"'[fake_ds] fake_uuid/fake_uuid.vmdk'"
op|','
nl|'\n'
name|'vi'
op|'.'
name|'root_gb'
op|'*'
name|'units'
op|'.'
name|'Mi'
op|','
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_use_disk_image_as_full_clone
dedent|''
name|'def'
name|'test_use_disk_image_as_full_clone'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_use_disk_image_as_full_clone'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_use_disk_image_as_full_clone_image_too_big
dedent|''
name|'def'
name|'test_use_disk_image_as_full_clone_image_too_big'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_use_disk_image_as_full_clone'
op|'('
name|'flavor_fits_image'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_attach_cdrom_to_vm'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'create_virtual_disk'"
op|')'
newline|'\n'
DECL|member|_test_use_iso_image
name|'def'
name|'_test_use_iso_image'
op|'('
name|'self'
op|','
nl|'\n'
name|'mock_create_virtual_disk'
op|','
nl|'\n'
name|'mock_attach_cdrom'
op|','
nl|'\n'
name|'with_root_disk'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'image_info'
op|'='
name|'images'
op|'.'
name|'VMwareImage'
op|'('
nl|'\n'
name|'image_id'
op|'='
name|'self'
op|'.'
name|'_image_id'
op|','
nl|'\n'
name|'file_size'
op|'='
number|'10'
op|'*'
name|'units'
op|'.'
name|'Mi'
op|','
nl|'\n'
name|'linked_clone'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'cache_root_folder'
op|'='
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'build_path'
op|'('
string|'"vmware_base"'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
newline|'\n'
name|'mock_imagecache'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'mock_imagecache'
op|'.'
name|'get_image_cache_folder'
op|'.'
name|'return_value'
op|'='
name|'cache_root_folder'
newline|'\n'
name|'vi'
op|'='
name|'vmops'
op|'.'
name|'VirtualMachineInstanceConfigInfo'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
name|'image_info'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|','
name|'mock_imagecache'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'mock_attach_disk_to_vm'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'.'
name|'attach_disk_to_vm'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_use_iso_image'
op|'('
string|'"fake_vm_ref"'
op|','
name|'vi'
op|')'
newline|'\n'
nl|'\n'
name|'mock_attach_cdrom'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
string|'"fake_vm_ref"'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'ref'
op|','
nl|'\n'
name|'str'
op|'('
name|'vi'
op|'.'
name|'cache_image_path'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'with_root_disk'
op|':'
newline|'\n'
indent|'            '
name|'mock_create_virtual_disk'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|','
nl|'\n'
name|'vi'
op|'.'
name|'ii'
op|'.'
name|'adapter_type'
op|','
name|'vi'
op|'.'
name|'ii'
op|'.'
name|'disk_type'
op|','
nl|'\n'
string|"'[fake_ds] fake_uuid/fake_uuid.vmdk'"
op|','
nl|'\n'
name|'vi'
op|'.'
name|'root_gb'
op|'*'
name|'units'
op|'.'
name|'Mi'
op|')'
newline|'\n'
name|'linked_clone'
op|'='
name|'False'
newline|'\n'
name|'mock_attach_disk_to_vm'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
string|'"fake_vm_ref"'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'vi'
op|'.'
name|'ii'
op|'.'
name|'adapter_type'
op|','
name|'vi'
op|'.'
name|'ii'
op|'.'
name|'disk_type'
op|','
nl|'\n'
string|"'[fake_ds] fake_uuid/fake_uuid.vmdk'"
op|','
nl|'\n'
name|'vi'
op|'.'
name|'root_gb'
op|'*'
name|'units'
op|'.'
name|'Mi'
op|','
name|'linked_clone'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_use_iso_image_with_root_disk
dedent|''
dedent|''
name|'def'
name|'test_use_iso_image_with_root_disk'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_use_iso_image'
op|'('
name|'with_root_disk'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_use_iso_image_without_root_disk
dedent|''
name|'def'
name|'test_use_iso_image_without_root_disk'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_use_iso_image'
op|'('
name|'with_root_disk'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_verify_spawn_method_calls
dedent|''
name|'def'
name|'_verify_spawn_method_calls'
op|'('
name|'self'
op|','
name|'mock_call_method'
op|','
name|'extras'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# TODO(vui): More explicit assertions of spawn() behavior'
nl|'\n'
comment|'# are waiting on additional refactoring pertaining to image'
nl|'\n'
comment|'# handling/manipulation. Till then, we continue to assert on the'
nl|'\n'
comment|'# sequence of VIM operations invoked.'
nl|'\n'
indent|'        '
name|'expected_methods'
op|'='
op|'['
string|"'get_dynamic_property'"
op|','
nl|'\n'
string|"'SearchDatastore_Task'"
op|','
nl|'\n'
string|"'CreateVirtualDisk_Task'"
op|','
nl|'\n'
string|"'DeleteDatastoreFile_Task'"
op|','
nl|'\n'
string|"'MoveDatastoreFile_Task'"
op|','
nl|'\n'
string|"'DeleteDatastoreFile_Task'"
op|','
nl|'\n'
string|"'SearchDatastore_Task'"
op|','
nl|'\n'
string|"'ExtendVirtualDisk_Task'"
op|','
nl|'\n'
op|']'
newline|'\n'
name|'if'
name|'extras'
op|':'
newline|'\n'
indent|'            '
name|'expected_methods'
op|'.'
name|'extend'
op|'('
name|'extras'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'recorded_methods'
op|'='
op|'['
name|'c'
op|'['
number|'1'
op|']'
op|'['
number|'1'
op|']'
name|'for'
name|'c'
name|'in'
name|'mock_call_method'
op|'.'
name|'mock_calls'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_methods'
op|','
name|'recorded_methods'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
nl|'\n'
string|"'nova.virt.vmwareapi.vmops.VMwareVMOps._configure_config_drive'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.vmwareapi.ds_util.get_datastore'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
nl|'\n'
string|"'nova.virt.vmwareapi.vmops.VMwareVMOps.get_datacenter_ref_and_name'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.vmwareapi.vif.get_vif_info'"
op|','
nl|'\n'
name|'return_value'
op|'='
op|'['
op|']'
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.utils.is_neutron'"
op|','
nl|'\n'
name|'return_value'
op|'='
name|'False'
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.vmwareapi.vm_util.get_vm_create_spec'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake_create_spec'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.vmwareapi.vm_util.create_vm'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake_vm_ref'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.vmwareapi.ds_util.mkdir'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.vmwareapi.vmops.VMwareVMOps._set_machine_id'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
nl|'\n'
string|"'nova.virt.vmwareapi.imagecache.ImageCacheManager.enlist_image'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_get_and_set_vnc_config'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.vmwareapi.vm_util.power_on_instance'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.vmwareapi.vm_util.copy_virtual_disk'"
op|')'
newline|'\n'
comment|'# TODO(dims): Need to add tests for create_virtual_disk after the'
nl|'\n'
comment|'#             disk/image code in spawn gets refactored'
nl|'\n'
DECL|member|_test_spawn
name|'def'
name|'_test_spawn'
op|'('
name|'self'
op|','
nl|'\n'
name|'mock_copy_virtual_disk'
op|','
nl|'\n'
name|'mock_power_on_instance'
op|','
nl|'\n'
name|'mock_get_and_set_vnc_config'
op|','
nl|'\n'
name|'mock_enlist_image'
op|','
nl|'\n'
name|'mock_set_machine_id'
op|','
nl|'\n'
name|'mock_mkdir'
op|','
nl|'\n'
name|'mock_create_vm'
op|','
nl|'\n'
name|'mock_get_create_spec'
op|','
nl|'\n'
name|'mock_is_neutron'
op|','
nl|'\n'
name|'mock_get_vif_info'
op|','
nl|'\n'
name|'mock_get_datacenter_ref_and_name'
op|','
nl|'\n'
name|'mock_get_datastore'
op|','
nl|'\n'
name|'mock_configure_config_drive'
op|','
nl|'\n'
name|'block_device_info'
op|'='
name|'None'
op|','
nl|'\n'
name|'power_on'
op|'='
name|'True'
op|','
nl|'\n'
name|'extra_specs'
op|'='
name|'None'
op|','
nl|'\n'
name|'config_drive'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'image_size'
op|'='
op|'('
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'root_gb'
op|')'
op|'*'
name|'units'
op|'.'
name|'Gi'
op|'/'
number|'2'
newline|'\n'
name|'image'
op|'='
op|'{'
nl|'\n'
string|"'id'"
op|':'
name|'self'
op|'.'
name|'_image_id'
op|','
nl|'\n'
string|"'disk_format'"
op|':'
string|"'vmdk'"
op|','
nl|'\n'
string|"'size'"
op|':'
name|'image_size'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'image_info'
op|'='
name|'images'
op|'.'
name|'VMwareImage'
op|'('
nl|'\n'
name|'image_id'
op|'='
name|'self'
op|'.'
name|'_image_id'
op|','
nl|'\n'
name|'file_size'
op|'='
name|'image_size'
op|')'
newline|'\n'
name|'vi'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_get_vm_config_info'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
name|'image_info'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'network_info'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'mock_get_datastore'
op|'.'
name|'return_value'
op|'='
name|'self'
op|'.'
name|'_ds'
newline|'\n'
name|'mock_get_datacenter_ref_and_name'
op|'.'
name|'return_value'
op|'='
name|'self'
op|'.'
name|'_dc_info'
newline|'\n'
name|'mock_call_method'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
name|'return_value'
op|'='
string|"'fake_task'"
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'extra_specs'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
string|"'_wait_for_task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'mock_call_method'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'uuidutils'
op|','
string|"'generate_uuid'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'tmp-uuid'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'images'
op|','
string|"'fetch_image'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|','
string|"'_get_extra_specs'"
op|','
nl|'\n'
name|'return_value'
op|'='
name|'extra_specs'
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'_wait_for_task'
op|','
name|'_call_method'
op|','
name|'_generate_uuid'
op|','
name|'_fetch_image'
op|','
nl|'\n'
name|'_get_extra_specs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'spawn'
op|'('
name|'self'
op|'.'
name|'_context'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
name|'image'
op|','
nl|'\n'
name|'injected_files'
op|'='
string|"'fake_files'"
op|','
nl|'\n'
name|'admin_password'
op|'='
string|"'password'"
op|','
nl|'\n'
name|'network_info'
op|'='
name|'network_info'
op|','
nl|'\n'
name|'block_device_info'
op|'='
name|'block_device_info'
op|','
nl|'\n'
name|'power_on'
op|'='
name|'power_on'
op|')'
newline|'\n'
nl|'\n'
name|'mock_is_neutron'
op|'.'
name|'assert_called_once_with'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'2'
op|','
name|'mock_mkdir'
op|'.'
name|'call_count'
op|')'
newline|'\n'
nl|'\n'
name|'mock_get_vif_info'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'self'
op|'.'
name|'_cluster'
op|'.'
name|'obj'
op|','
name|'False'
op|','
nl|'\n'
name|'constants'
op|'.'
name|'DEFAULT_VIF_MODEL'
op|','
name|'network_info'
op|')'
newline|'\n'
name|'mock_get_create_spec'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|'.'
name|'vim'
op|'.'
name|'client'
op|'.'
name|'factory'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake_ds'"
op|','
nl|'\n'
op|'['
op|']'
op|','
nl|'\n'
name|'extra_specs'
op|','
nl|'\n'
string|"'otherGuest'"
op|','
nl|'\n'
name|'profile_spec'
op|'='
name|'None'
op|')'
newline|'\n'
name|'mock_create_vm'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake_vm_folder'"
op|','
nl|'\n'
string|"'fake_create_spec'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_cluster'
op|'.'
name|'resourcePool'
op|')'
newline|'\n'
name|'mock_get_and_set_vnc_config'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|'.'
name|'vim'
op|'.'
name|'client'
op|'.'
name|'factory'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake_vm_ref'"
op|')'
newline|'\n'
name|'mock_set_machine_id'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|'.'
name|'vim'
op|'.'
name|'client'
op|'.'
name|'factory'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'network_info'
op|','
nl|'\n'
name|'vm_ref'
op|'='
string|"'fake_vm_ref'"
op|')'
newline|'\n'
name|'if'
name|'power_on'
op|':'
newline|'\n'
indent|'                '
name|'mock_power_on_instance'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
name|'vm_ref'
op|'='
string|"'fake_vm_ref'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'mock_power_on_instance'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
op|'('
name|'block_device_info'
name|'and'
nl|'\n'
string|"'block_device_mapping'"
name|'in'
name|'block_device_info'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'bdms'
op|'='
name|'block_device_info'
op|'['
string|"'block_device_mapping'"
op|']'
newline|'\n'
name|'for'
name|'bdm'
name|'in'
name|'bdms'
op|':'
newline|'\n'
indent|'                    '
name|'mock_attach_root'
op|'='
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'.'
name|'attach_root_volume'
op|')'
newline|'\n'
name|'mock_attach'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'.'
name|'attach_volume'
newline|'\n'
name|'adapter_type'
op|'='
name|'bdm'
op|'.'
name|'get'
op|'('
string|"'disk_bus'"
op|')'
name|'or'
name|'vi'
op|'.'
name|'ii'
op|'.'
name|'adapter_type'
newline|'\n'
name|'if'
name|'bdm'
op|'.'
name|'get'
op|'('
string|"'boot_index'"
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'                        '
name|'mock_attach_root'
op|'.'
name|'assert_any_call'
op|'('
nl|'\n'
name|'bdm'
op|'['
string|"'connection_info'"
op|']'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'ref'
op|','
name|'adapter_type'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'mock_attach'
op|'.'
name|'assert_any_call'
op|'('
nl|'\n'
name|'bdm'
op|'['
string|"'connection_info'"
op|']'
op|','
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'ref'
op|','
name|'adapter_type'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'mock_enlist_image'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_image_id'
op|','
name|'self'
op|'.'
name|'_ds'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|')'
newline|'\n'
nl|'\n'
name|'upload_file_name'
op|'='
string|"'vmware_temp/tmp-uuid/%s/%s-flat.vmdk'"
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_image_id'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
newline|'\n'
name|'_fetch_image'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_context'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|'.'
name|'_host'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|'.'
name|'_port'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'name'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
nl|'\n'
name|'upload_file_name'
op|','
nl|'\n'
name|'cookies'
op|'='
string|"'Fake-CookieJar'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'len'
op|'('
name|'_wait_for_task'
op|'.'
name|'mock_calls'
op|')'
op|'>'
number|'0'
op|')'
newline|'\n'
name|'extras'
op|'='
name|'None'
newline|'\n'
name|'if'
name|'block_device_info'
name|'and'
string|"'ephemerals'"
name|'in'
name|'block_device_info'
op|':'
newline|'\n'
indent|'                '
name|'extras'
op|'='
op|'['
string|"'CreateVirtualDisk_Task'"
op|']'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'_verify_spawn_method_calls'
op|'('
name|'_call_method'
op|','
name|'extras'
op|')'
newline|'\n'
nl|'\n'
name|'dc_ref'
op|'='
string|"'fake_dc_ref'"
newline|'\n'
name|'source_file'
op|'='
name|'unicode'
op|'('
string|"'[fake_ds] vmware_base/%s/%s.vmdk'"
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'_image_id'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
op|')'
newline|'\n'
name|'dest_file'
op|'='
name|'unicode'
op|'('
string|"'[fake_ds] vmware_base/%s/%s.%d.vmdk'"
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'_image_id'
op|','
name|'self'
op|'.'
name|'_image_id'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|'['
string|"'root_gb'"
op|']'
op|')'
op|')'
newline|'\n'
comment|'# TODO(dims): add more tests for copy_virtual_disk after'
nl|'\n'
comment|'# the disk/image code in spawn gets refactored'
nl|'\n'
name|'mock_copy_virtual_disk'
op|'.'
name|'assert_called_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'dc_ref'
op|','
nl|'\n'
name|'source_file'
op|','
nl|'\n'
name|'dest_file'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'config_drive'
op|':'
newline|'\n'
indent|'                '
name|'mock_configure_config_drive'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
string|"'fake_vm_ref'"
op|','
name|'self'
op|'.'
name|'_dc_info'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|','
string|"'fake_files'"
op|','
string|"'password'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'get_datastore'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'get_datacenter_ref_and_name'"
op|')'
newline|'\n'
DECL|member|_test_get_spawn_vm_config_info
name|'def'
name|'_test_get_spawn_vm_config_info'
op|'('
name|'self'
op|','
nl|'\n'
name|'mock_get_datacenter_ref_and_name'
op|','
nl|'\n'
name|'mock_get_datastore'
op|','
nl|'\n'
name|'image_size_bytes'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'image_info'
op|'='
name|'images'
op|'.'
name|'VMwareImage'
op|'('
nl|'\n'
name|'image_id'
op|'='
name|'self'
op|'.'
name|'_image_id'
op|','
nl|'\n'
name|'file_size'
op|'='
name|'image_size_bytes'
op|','
nl|'\n'
name|'linked_clone'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'mock_get_datastore'
op|'.'
name|'return_value'
op|'='
name|'self'
op|'.'
name|'_ds'
newline|'\n'
name|'mock_get_datacenter_ref_and_name'
op|'.'
name|'return_value'
op|'='
name|'self'
op|'.'
name|'_dc_info'
newline|'\n'
nl|'\n'
name|'vi'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_get_vm_config_info'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
name|'image_info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'image_info'
op|','
name|'vi'
op|'.'
name|'ii'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_ds'
op|','
name|'vi'
op|'.'
name|'datastore'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'root_gb'
op|','
name|'vi'
op|'.'
name|'root_gb'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
name|'vi'
op|'.'
name|'instance'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
op|','
name|'vi'
op|'.'
name|'instance'
op|'.'
name|'uuid'
op|')'
newline|'\n'
nl|'\n'
name|'cache_image_path'
op|'='
string|"'[%s] vmware_base/%s/%s.vmdk'"
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'_image_id'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cache_image_path'
op|','
name|'str'
op|'('
name|'vi'
op|'.'
name|'cache_image_path'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'cache_image_folder'
op|'='
string|"'[%s] vmware_base/%s'"
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cache_image_folder'
op|','
name|'str'
op|'('
name|'vi'
op|'.'
name|'cache_image_folder'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_spawn_vm_config_info
dedent|''
name|'def'
name|'test_get_spawn_vm_config_info'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'image_size'
op|'='
op|'('
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'root_gb'
op|')'
op|'*'
name|'units'
op|'.'
name|'Gi'
op|'/'
number|'2'
newline|'\n'
name|'self'
op|'.'
name|'_test_get_spawn_vm_config_info'
op|'('
name|'image_size_bytes'
op|'='
name|'image_size'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_spawn_vm_config_info_image_too_big
dedent|''
name|'def'
name|'test_get_spawn_vm_config_info_image_too_big'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'image_size'
op|'='
op|'('
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'root_gb'
op|'+'
number|'1'
op|')'
op|'*'
name|'units'
op|'.'
name|'Gi'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'InstanceUnacceptable'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_test_get_spawn_vm_config_info'
op|','
nl|'\n'
name|'image_size_bytes'
op|'='
name|'image_size'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn
dedent|''
name|'def'
name|'test_spawn'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_spawn'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_config_drive_enabled
dedent|''
name|'def'
name|'test_spawn_config_drive_enabled'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'force_config_drive'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'config_drive'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_no_power_on
dedent|''
name|'def'
name|'test_spawn_no_power_on'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'power_on'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_with_block_device_info
dedent|''
name|'def'
name|'test_spawn_with_block_device_info'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'block_device_info'
op|'='
op|'{'
nl|'\n'
string|"'block_device_mapping'"
op|':'
op|'['
op|'{'
string|"'boot_index'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'connection_info'"
op|':'
string|"'fake'"
op|','
nl|'\n'
string|"'mount_device'"
op|':'
string|"'/dev/vda'"
op|'}'
op|']'
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'block_device_info'
op|'='
name|'block_device_info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_with_block_device_info_with_config_drive
dedent|''
name|'def'
name|'test_spawn_with_block_device_info_with_config_drive'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'force_config_drive'
op|'='
name|'True'
op|')'
newline|'\n'
name|'block_device_info'
op|'='
op|'{'
nl|'\n'
string|"'block_device_mapping'"
op|':'
op|'['
op|'{'
string|"'boot_index'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'connection_info'"
op|':'
string|"'fake'"
op|','
nl|'\n'
string|"'mount_device'"
op|':'
string|"'/dev/vda'"
op|'}'
op|']'
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'block_device_info'
op|'='
name|'block_device_info'
op|','
nl|'\n'
name|'config_drive'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_spawn_with_block_device_info_ephemerals
dedent|''
name|'def'
name|'_spawn_with_block_device_info_ephemerals'
op|'('
name|'self'
op|','
name|'ephemerals'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'block_device_info'
op|'='
op|'{'
string|"'ephemerals'"
op|':'
name|'ephemerals'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'block_device_info'
op|'='
name|'block_device_info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_with_block_device_info_ephemerals
dedent|''
name|'def'
name|'test_spawn_with_block_device_info_ephemerals'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ephemerals'
op|'='
op|'['
op|'{'
string|"'device_type'"
op|':'
string|"'disk'"
op|','
nl|'\n'
string|"'disk_bus'"
op|':'
string|"'virtio'"
op|','
nl|'\n'
string|"'device_name'"
op|':'
string|"'/dev/vdb'"
op|','
nl|'\n'
string|"'size'"
op|':'
number|'1'
op|'}'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_spawn_with_block_device_info_ephemerals'
op|'('
name|'ephemerals'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_with_block_device_info_ephemerals_no_disk_bus
dedent|''
name|'def'
name|'test_spawn_with_block_device_info_ephemerals_no_disk_bus'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ephemerals'
op|'='
op|'['
op|'{'
string|"'device_type'"
op|':'
string|"'disk'"
op|','
nl|'\n'
string|"'disk_bus'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'device_name'"
op|':'
string|"'/dev/vdb'"
op|','
nl|'\n'
string|"'size'"
op|':'
number|'1'
op|'}'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_spawn_with_block_device_info_ephemerals'
op|'('
name|'ephemerals'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_fake_vi
dedent|''
name|'def'
name|'_get_fake_vi'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'image_info'
op|'='
name|'images'
op|'.'
name|'VMwareImage'
op|'('
nl|'\n'
name|'image_id'
op|'='
name|'self'
op|'.'
name|'_image_id'
op|','
nl|'\n'
name|'file_size'
op|'='
number|'7'
op|','
nl|'\n'
name|'linked_clone'
op|'='
name|'False'
op|')'
newline|'\n'
name|'vi'
op|'='
name|'vmops'
op|'.'
name|'VirtualMachineInstanceConfigInfo'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
name|'image_info'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|','
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
op|')'
newline|'\n'
name|'return'
name|'vi'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'create_virtual_disk'"
op|')'
newline|'\n'
DECL|member|test_create_and_attach_ephemeral_disk
name|'def'
name|'test_create_and_attach_ephemeral_disk'
op|'('
name|'self'
op|','
name|'mock_create'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vi'
op|'='
name|'self'
op|'.'
name|'_get_fake_vi'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'mock_attach_disk_to_vm'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_volumeops'
op|'.'
name|'attach_disk_to_vm'
newline|'\n'
nl|'\n'
name|'path'
op|'='
name|'str'
op|'('
name|'ds_obj'
op|'.'
name|'DatastorePath'
op|'('
name|'vi'
op|'.'
name|'datastore'
op|'.'
name|'name'
op|','
string|"'fake_uuid'"
op|','
nl|'\n'
string|"'fake-filename'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_create_and_attach_ephemeral_disk'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|','
nl|'\n'
name|'vi'
op|'.'
name|'dc_info'
op|','
number|'1'
op|','
nl|'\n'
string|"'fake-adapter-type'"
op|','
nl|'\n'
name|'path'
op|')'
newline|'\n'
name|'mock_create'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|','
string|"'fake-adapter-type'"
op|','
nl|'\n'
string|"'thin'"
op|','
name|'path'
op|','
number|'1'
op|')'
newline|'\n'
name|'mock_attach_disk_to_vm'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
string|"'fake-vm-ref'"
op|','
name|'self'
op|'.'
name|'_instance'
op|','
string|"'fake-adapter-type'"
op|','
nl|'\n'
string|"'thin'"
op|','
name|'path'
op|','
number|'1'
op|','
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_ephemeral_with_bdi
dedent|''
name|'def'
name|'test_create_ephemeral_with_bdi'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ephemerals'
op|'='
op|'['
op|'{'
string|"'device_type'"
op|':'
string|"'disk'"
op|','
nl|'\n'
string|"'disk_bus'"
op|':'
string|"'virtio'"
op|','
nl|'\n'
string|"'device_name'"
op|':'
string|"'/dev/vdb'"
op|','
nl|'\n'
string|"'size'"
op|':'
number|'1'
op|'}'
op|']'
newline|'\n'
name|'block_device_info'
op|'='
op|'{'
string|"'ephemerals'"
op|':'
name|'ephemerals'
op|'}'
newline|'\n'
name|'vi'
op|'='
name|'self'
op|'.'
name|'_get_fake_vi'
op|'('
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|','
string|"'_create_and_attach_ephemeral_disk'"
op|')'
name|'as'
name|'mock_caa'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_create_ephemeral'
op|'('
name|'block_device_info'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|','
nl|'\n'
name|'vi'
op|'.'
name|'dc_info'
op|','
name|'vi'
op|'.'
name|'datastore'
op|','
nl|'\n'
string|"'fake_uuid'"
op|','
nl|'\n'
name|'vi'
op|'.'
name|'ii'
op|'.'
name|'adapter_type'
op|')'
newline|'\n'
name|'mock_caa'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
string|"'fake-vm-ref'"
op|','
nl|'\n'
name|'vi'
op|'.'
name|'dc_info'
op|','
number|'1'
op|'*'
name|'units'
op|'.'
name|'Mi'
op|','
string|"'virtio'"
op|','
nl|'\n'
string|"'[fake_ds] fake_uuid/ephemeral_0.vmdk'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_create_ephemeral_from_instance
dedent|''
dedent|''
name|'def'
name|'_test_create_ephemeral_from_instance'
op|'('
name|'self'
op|','
name|'bdi'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vi'
op|'='
name|'self'
op|'.'
name|'_get_fake_vi'
op|'('
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|','
string|"'_create_and_attach_ephemeral_disk'"
op|')'
name|'as'
name|'mock_caa'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_create_ephemeral'
op|'('
name|'bdi'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|','
nl|'\n'
name|'vi'
op|'.'
name|'dc_info'
op|','
name|'vi'
op|'.'
name|'datastore'
op|','
nl|'\n'
string|"'fake_uuid'"
op|','
nl|'\n'
name|'vi'
op|'.'
name|'ii'
op|'.'
name|'adapter_type'
op|')'
newline|'\n'
name|'mock_caa'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
string|"'fake-vm-ref'"
op|','
nl|'\n'
name|'vi'
op|'.'
name|'dc_info'
op|','
number|'1'
op|'*'
name|'units'
op|'.'
name|'Mi'
op|','
string|"'lsiLogic'"
op|','
nl|'\n'
string|"'[fake_ds] fake_uuid/ephemeral_0.vmdk'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_ephemeral_with_bdi_but_no_ephemerals
dedent|''
dedent|''
name|'def'
name|'test_create_ephemeral_with_bdi_but_no_ephemerals'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'block_device_info'
op|'='
op|'{'
string|"'ephemerals'"
op|':'
op|'['
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'ephemeral_gb'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'_test_create_ephemeral_from_instance'
op|'('
name|'block_device_info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_ephemeral_with_no_bdi
dedent|''
name|'def'
name|'test_create_ephemeral_with_no_bdi'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'ephemeral_gb'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'_test_create_ephemeral_from_instance'
op|'('
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_build_virtual_machine
dedent|''
name|'def'
name|'test_build_virtual_machine'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'image_id'
op|'='
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
op|'.'
name|'image'
op|'.'
name|'fake'
op|'.'
name|'get_valid_image_id'
op|'('
op|')'
newline|'\n'
name|'image'
op|'='
name|'images'
op|'.'
name|'VMwareImage'
op|'('
name|'image_id'
op|'='
name|'image_id'
op|')'
newline|'\n'
nl|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vm_ref'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'build_virtual_machine'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
nl|'\n'
name|'image'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|','
nl|'\n'
name|'self'
op|'.'
name|'network_info'
op|','
nl|'\n'
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
name|'vm'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'_get_object'
op|'('
name|'vm_ref'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test basic VM parameters'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
op|','
name|'vm'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_instance'
op|'.'
name|'uuid'
op|','
nl|'\n'
name|'vm'
op|'.'
name|'get'
op|'('
string|"'summary.config.instanceUuid'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_instance_values'
op|'['
string|"'vcpus'"
op|']'
op|','
nl|'\n'
name|'vm'
op|'.'
name|'get'
op|'('
string|"'summary.config.numCpu'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_instance_values'
op|'['
string|"'memory_mb'"
op|']'
op|','
nl|'\n'
name|'vm'
op|'.'
name|'get'
op|'('
string|"'summary.config.memorySizeMB'"
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# Test NSX config'
nl|'\n'
name|'for'
name|'optval'
name|'in'
name|'vm'
op|'.'
name|'get'
op|'('
string|"'config.extraConfig'"
op|')'
op|'.'
name|'OptionValue'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'optval'
op|'.'
name|'key'
op|'=='
string|"'nvp.vm-uuid'"
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_instance_values'
op|'['
string|"'uuid'"
op|']'
op|','
name|'optval'
op|'.'
name|'value'
op|')'
newline|'\n'
name|'break'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'nvp.vm-uuid not found in extraConfig'"
op|')'
newline|'\n'
nl|'\n'
comment|'# Test that the VM is associated with the specified datastore'
nl|'\n'
dedent|''
name|'datastores'
op|'='
name|'vm'
op|'.'
name|'datastore'
op|'.'
name|'ManagedObjectReference'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'datastores'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'datastore'
op|'='
name|'vmwareapi_fake'
op|'.'
name|'_get_object'
op|'('
name|'datastores'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
name|'datastore'
op|'.'
name|'get'
op|'('
string|"'summary.name'"
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|"# Test that the VM's network is configured as specified"
nl|'\n'
name|'devices'
op|'='
name|'vm'
op|'.'
name|'get'
op|'('
string|"'config.hardware.device'"
op|')'
op|'.'
name|'VirtualDevice'
newline|'\n'
name|'for'
name|'device'
name|'in'
name|'devices'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'device'
op|'.'
name|'obj_name'
op|'!='
string|"'ns0:VirtualE1000'"
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_network_values'
op|'['
string|"'address'"
op|']'
op|','
nl|'\n'
name|'device'
op|'.'
name|'macAddress'
op|')'
newline|'\n'
name|'break'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'NIC not configured'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_cpu_limit
dedent|''
dedent|''
name|'def'
name|'test_spawn_cpu_limit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'CpuLimits'
op|'('
name|'cpu_limit'
op|'='
number|'7'
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'extra_specs'
op|'='
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_cpu_reservation
dedent|''
name|'def'
name|'test_spawn_cpu_reservation'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'CpuLimits'
op|'('
name|'cpu_reservation'
op|'='
number|'7'
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'extra_specs'
op|'='
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_cpu_allocations
dedent|''
name|'def'
name|'test_spawn_cpu_allocations'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'CpuLimits'
op|'('
name|'cpu_limit'
op|'='
number|'7'
op|','
nl|'\n'
name|'cpu_reservation'
op|'='
number|'6'
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'extra_specs'
op|'='
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_cpu_shares_level
dedent|''
name|'def'
name|'test_spawn_cpu_shares_level'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'CpuLimits'
op|'('
name|'cpu_shares_level'
op|'='
string|"'high'"
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'extra_specs'
op|'='
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_cpu_shares_custom
dedent|''
name|'def'
name|'test_spawn_cpu_shares_custom'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'CpuLimits'
op|'('
name|'cpu_shares_level'
op|'='
string|"'custom'"
op|','
nl|'\n'
name|'cpu_shares_share'
op|'='
number|'1948'
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'extra_specs'
op|'='
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_validate_extra_specs
dedent|''
name|'def'
name|'_validate_extra_specs'
op|'('
name|'self'
op|','
name|'expected'
op|','
name|'actual'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|'.'
name|'cpu_limits'
op|'.'
name|'cpu_limit'
op|','
nl|'\n'
name|'actual'
op|'.'
name|'cpu_limits'
op|'.'
name|'cpu_limit'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|'.'
name|'cpu_limits'
op|'.'
name|'cpu_reservation'
op|','
nl|'\n'
name|'actual'
op|'.'
name|'cpu_limits'
op|'.'
name|'cpu_reservation'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|'.'
name|'cpu_limits'
op|'.'
name|'cpu_shares_level'
op|','
nl|'\n'
name|'actual'
op|'.'
name|'cpu_limits'
op|'.'
name|'cpu_shares_level'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|'.'
name|'cpu_limits'
op|'.'
name|'cpu_shares_share'
op|','
nl|'\n'
name|'actual'
op|'.'
name|'cpu_limits'
op|'.'
name|'cpu_shares_share'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_validate_flavor_extra_specs
dedent|''
name|'def'
name|'_validate_flavor_extra_specs'
op|'('
name|'self'
op|','
name|'flavor_extra_specs'
op|','
name|'expected'
op|')'
op|':'
newline|'\n'
comment|'# Validate that the extra specs are parsed correctly'
nl|'\n'
indent|'        '
name|'flavor'
op|'='
name|'objects'
op|'.'
name|'Flavor'
op|'('
name|'extra_specs'
op|'='
name|'flavor_extra_specs'
op|')'
newline|'\n'
name|'flavor_extra_specs'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_get_extra_specs'
op|'('
name|'flavor'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_validate_extra_specs'
op|'('
name|'expected'
op|','
name|'flavor_extra_specs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_cpu_limit
dedent|''
name|'def'
name|'test_extra_specs_cpu_limit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'flavor_extra_specs'
op|'='
op|'{'
string|"'quota:cpu_limit'"
op|':'
number|'7'
op|'}'
newline|'\n'
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'CpuLimits'
op|'('
name|'cpu_limit'
op|'='
number|'7'
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_validate_flavor_extra_specs'
op|'('
name|'flavor_extra_specs'
op|','
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_cpu_reservations
dedent|''
name|'def'
name|'test_extra_specs_cpu_reservations'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'flavor_extra_specs'
op|'='
op|'{'
string|"'quota:cpu_reservation'"
op|':'
number|'7'
op|'}'
newline|'\n'
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'CpuLimits'
op|'('
name|'cpu_reservation'
op|'='
number|'7'
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_validate_flavor_extra_specs'
op|'('
name|'flavor_extra_specs'
op|','
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_cpu_allocations
dedent|''
name|'def'
name|'test_extra_specs_cpu_allocations'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'flavor_extra_specs'
op|'='
op|'{'
string|"'quota:cpu_limit'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'quota:cpu_reservation'"
op|':'
number|'6'
op|'}'
newline|'\n'
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'CpuLimits'
op|'('
name|'cpu_limit'
op|'='
number|'7'
op|','
nl|'\n'
name|'cpu_reservation'
op|'='
number|'6'
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_validate_flavor_extra_specs'
op|'('
name|'flavor_extra_specs'
op|','
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_cpu_shares_level
dedent|''
name|'def'
name|'test_extra_specs_cpu_shares_level'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'flavor_extra_specs'
op|'='
op|'{'
string|"'quota:cpu_shares_level'"
op|':'
string|"'high'"
op|'}'
newline|'\n'
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'CpuLimits'
op|'('
name|'cpu_shares_level'
op|'='
string|"'high'"
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_validate_flavor_extra_specs'
op|'('
name|'flavor_extra_specs'
op|','
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_extra_specs_cpu_shares_custom
dedent|''
name|'def'
name|'test_extra_specs_cpu_shares_custom'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'flavor_extra_specs'
op|'='
op|'{'
string|"'quota:cpu_shares_level'"
op|':'
string|"'custom'"
op|','
nl|'\n'
string|"'quota:cpu_shares_share'"
op|':'
number|'1948'
op|'}'
newline|'\n'
name|'cpu_limits'
op|'='
name|'vm_util'
op|'.'
name|'CpuLimits'
op|'('
name|'cpu_shares_level'
op|'='
string|"'custom'"
op|','
nl|'\n'
name|'cpu_shares_share'
op|'='
number|'1948'
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'vm_util'
op|'.'
name|'ExtraSpecs'
op|'('
name|'cpu_limits'
op|'='
name|'cpu_limits'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_validate_flavor_extra_specs'
op|'('
name|'flavor_extra_specs'
op|','
name|'extra_specs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_make_vm_config_info
dedent|''
name|'def'
name|'_make_vm_config_info'
op|'('
name|'self'
op|','
name|'is_iso'
op|'='
name|'False'
op|','
name|'is_sparse_disk'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'disk_type'
op|'='
op|'('
name|'constants'
op|'.'
name|'DISK_TYPE_SPARSE'
name|'if'
name|'is_sparse_disk'
nl|'\n'
name|'else'
name|'constants'
op|'.'
name|'DEFAULT_DISK_TYPE'
op|')'
newline|'\n'
name|'file_type'
op|'='
op|'('
name|'constants'
op|'.'
name|'DISK_FORMAT_ISO'
name|'if'
name|'is_iso'
nl|'\n'
name|'else'
name|'constants'
op|'.'
name|'DEFAULT_DISK_FORMAT'
op|')'
newline|'\n'
nl|'\n'
name|'image_info'
op|'='
name|'images'
op|'.'
name|'VMwareImage'
op|'('
nl|'\n'
name|'image_id'
op|'='
name|'self'
op|'.'
name|'_image_id'
op|','
nl|'\n'
name|'file_size'
op|'='
number|'10'
op|'*'
name|'units'
op|'.'
name|'Mi'
op|','
nl|'\n'
name|'file_type'
op|'='
name|'file_type'
op|','
nl|'\n'
name|'disk_type'
op|'='
name|'disk_type'
op|','
nl|'\n'
name|'linked_clone'
op|'='
name|'True'
op|')'
newline|'\n'
name|'cache_root_folder'
op|'='
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'build_path'
op|'('
string|'"vmware_base"'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
newline|'\n'
name|'mock_imagecache'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'mock_imagecache'
op|'.'
name|'get_image_cache_folder'
op|'.'
name|'return_value'
op|'='
name|'cache_root_folder'
newline|'\n'
name|'vi'
op|'='
name|'vmops'
op|'.'
name|'VirtualMachineInstanceConfigInfo'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|','
name|'image_info'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|','
name|'mock_imagecache'
op|')'
newline|'\n'
name|'return'
name|'vi'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'check_cache_folder'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_fetch_image_as_file'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_prepare_iso_image'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_prepare_sparse_image'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_prepare_flat_image'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_cache_iso_image'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_cache_sparse_image'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_cache_flat_image'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_delete_datastore_file'"
op|')'
newline|'\n'
DECL|member|_test_fetch_image_if_missing
name|'def'
name|'_test_fetch_image_if_missing'
op|'('
name|'self'
op|','
nl|'\n'
name|'mock_delete_datastore_file'
op|','
nl|'\n'
name|'mock_cache_flat_image'
op|','
nl|'\n'
name|'mock_cache_sparse_image'
op|','
nl|'\n'
name|'mock_cache_iso_image'
op|','
nl|'\n'
name|'mock_prepare_flat_image'
op|','
nl|'\n'
name|'mock_prepare_sparse_image'
op|','
nl|'\n'
name|'mock_prepare_iso_image'
op|','
nl|'\n'
name|'mock_fetch_image_as_file'
op|','
nl|'\n'
name|'mock_check_cache_folder'
op|','
nl|'\n'
name|'is_iso'
op|'='
name|'False'
op|','
nl|'\n'
name|'is_sparse_disk'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'tmp_dir_path'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'tmp_image_path'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'if'
name|'is_iso'
op|':'
newline|'\n'
indent|'            '
name|'mock_prepare'
op|'='
name|'mock_prepare_iso_image'
newline|'\n'
name|'mock_cache'
op|'='
name|'mock_cache_iso_image'
newline|'\n'
dedent|''
name|'elif'
name|'is_sparse_disk'
op|':'
newline|'\n'
indent|'            '
name|'mock_prepare'
op|'='
name|'mock_prepare_sparse_image'
newline|'\n'
name|'mock_cache'
op|'='
name|'mock_cache_sparse_image'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'mock_prepare'
op|'='
name|'mock_prepare_flat_image'
newline|'\n'
name|'mock_cache'
op|'='
name|'mock_cache_flat_image'
newline|'\n'
dedent|''
name|'mock_prepare'
op|'.'
name|'return_value'
op|'='
name|'tmp_dir_path'
op|','
name|'tmp_image_path'
newline|'\n'
nl|'\n'
name|'vi'
op|'='
name|'self'
op|'.'
name|'_make_vm_config_info'
op|'('
name|'is_iso'
op|','
name|'is_sparse_disk'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_fetch_image_if_missing'
op|'('
name|'self'
op|'.'
name|'_context'
op|','
name|'vi'
op|')'
newline|'\n'
nl|'\n'
name|'mock_check_cache_folder'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'ref'
op|')'
newline|'\n'
name|'mock_prepare'
op|'.'
name|'assert_called_once_with'
op|'('
name|'vi'
op|')'
newline|'\n'
name|'mock_fetch_image_as_file'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_context'
op|','
name|'vi'
op|','
name|'tmp_image_path'
op|')'
newline|'\n'
name|'mock_cache'
op|'.'
name|'assert_called_once_with'
op|'('
name|'vi'
op|','
name|'tmp_image_path'
op|')'
newline|'\n'
name|'mock_delete_datastore_file'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'str'
op|'('
name|'tmp_dir_path'
op|')'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_fetch_image_if_missing
dedent|''
name|'def'
name|'test_fetch_image_if_missing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_fetch_image_if_missing'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_fetch_image_if_missing_with_sparse
dedent|''
name|'def'
name|'test_fetch_image_if_missing_with_sparse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_fetch_image_if_missing'
op|'('
nl|'\n'
name|'is_sparse_disk'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_fetch_image_if_missing_with_iso
dedent|''
name|'def'
name|'test_fetch_image_if_missing_with_iso'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_fetch_image_if_missing'
op|'('
nl|'\n'
name|'is_iso'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'images'
op|','
string|"'fetch_image'"
op|')'
newline|'\n'
DECL|member|test_fetch_image_as_file
name|'def'
name|'test_fetch_image_as_file'
op|'('
name|'self'
op|','
name|'mock_fetch_image'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vi'
op|'='
name|'self'
op|'.'
name|'_make_vm_config_info'
op|'('
op|')'
newline|'\n'
name|'image_ds_loc'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_fetch_image_as_file'
op|'('
name|'self'
op|'.'
name|'_context'
op|','
name|'vi'
op|','
name|'image_ds_loc'
op|')'
newline|'\n'
name|'mock_fetch_image'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_context'
op|','
nl|'\n'
name|'vi'
op|'.'
name|'instance'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|'.'
name|'_host'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|'.'
name|'_port'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'name'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
nl|'\n'
name|'image_ds_loc'
op|'.'
name|'rel_path'
op|','
nl|'\n'
name|'cookies'
op|'='
string|"'Fake-CookieJar'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'images'
op|','
string|"'fetch_image_stream_optimized'"
op|')'
newline|'\n'
DECL|member|test_fetch_image_as_vapp
name|'def'
name|'test_fetch_image_as_vapp'
op|'('
name|'self'
op|','
name|'mock_fetch_image'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vi'
op|'='
name|'self'
op|'.'
name|'_make_vm_config_info'
op|'('
op|')'
newline|'\n'
name|'image_ds_loc'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'image_ds_loc'
op|'.'
name|'parent'
op|'.'
name|'basename'
op|'='
string|"'fake-name'"
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_fetch_image_as_vapp'
op|'('
name|'self'
op|'.'
name|'_context'
op|','
name|'vi'
op|','
name|'image_ds_loc'
op|')'
newline|'\n'
name|'mock_fetch_image'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_context'
op|','
nl|'\n'
name|'vi'
op|'.'
name|'instance'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
string|"'fake-name'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
nl|'\n'
name|'vi'
op|'.'
name|'dc_info'
op|'.'
name|'vmFolder'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_root_resource_pool'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'uuidutils'
op|','
string|"'generate_uuid'"
op|','
name|'return_value'
op|'='
string|"'tmp-uuid'"
op|')'
newline|'\n'
DECL|member|test_prepare_iso_image
name|'def'
name|'test_prepare_iso_image'
op|'('
name|'self'
op|','
name|'mock_generate_uuid'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vi'
op|'='
name|'self'
op|'.'
name|'_make_vm_config_info'
op|'('
name|'is_iso'
op|'='
name|'True'
op|')'
newline|'\n'
name|'tmp_dir_loc'
op|','
name|'tmp_image_ds_loc'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_prepare_iso_image'
op|'('
name|'vi'
op|')'
newline|'\n'
nl|'\n'
name|'expected_tmp_dir_path'
op|'='
string|"'[%s] vmware_temp/tmp-uuid'"
op|'%'
op|'('
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'expected_image_path'
op|'='
string|"'[%s] vmware_temp/tmp-uuid/%s/%s.iso'"
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'_image_id'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
name|'tmp_dir_loc'
op|')'
op|','
name|'expected_tmp_dir_path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
name|'tmp_image_ds_loc'
op|')'
op|','
name|'expected_image_path'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'uuidutils'
op|','
string|"'generate_uuid'"
op|','
name|'return_value'
op|'='
string|"'tmp-uuid'"
op|')'
newline|'\n'
DECL|member|test_prepare_sparse_image
name|'def'
name|'test_prepare_sparse_image'
op|'('
name|'self'
op|','
name|'mock_generate_uuid'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vi'
op|'='
name|'self'
op|'.'
name|'_make_vm_config_info'
op|'('
name|'is_sparse_disk'
op|'='
name|'True'
op|')'
newline|'\n'
name|'tmp_dir_loc'
op|','
name|'tmp_image_ds_loc'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_prepare_sparse_image'
op|'('
name|'vi'
op|')'
newline|'\n'
nl|'\n'
name|'expected_tmp_dir_path'
op|'='
string|"'[%s] vmware_temp/tmp-uuid'"
op|'%'
op|'('
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'expected_image_path'
op|'='
string|"'[%s] vmware_temp/tmp-uuid/%s/%s'"
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'_image_id'
op|','
string|'"tmp-sparse.vmdk"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
name|'tmp_dir_loc'
op|')'
op|','
name|'expected_tmp_dir_path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
name|'tmp_image_ds_loc'
op|')'
op|','
name|'expected_image_path'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'mkdir'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'create_virtual_disk'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_delete_datastore_file'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'uuidutils'
op|','
string|"'generate_uuid'"
op|','
name|'return_value'
op|'='
string|"'tmp-uuid'"
op|')'
newline|'\n'
DECL|member|test_prepare_flat_image
name|'def'
name|'test_prepare_flat_image'
op|'('
name|'self'
op|','
nl|'\n'
name|'mock_generate_uuid'
op|','
nl|'\n'
name|'mock_delete_datastore_file'
op|','
nl|'\n'
name|'mock_create_virtual_disk'
op|','
nl|'\n'
name|'mock_mkdir'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vi'
op|'='
name|'self'
op|'.'
name|'_make_vm_config_info'
op|'('
op|')'
newline|'\n'
name|'tmp_dir_loc'
op|','
name|'tmp_image_ds_loc'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_prepare_flat_image'
op|'('
name|'vi'
op|')'
newline|'\n'
nl|'\n'
name|'expected_tmp_dir_path'
op|'='
string|"'[%s] vmware_temp/tmp-uuid'"
op|'%'
op|'('
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'expected_image_path'
op|'='
string|"'[%s] vmware_temp/tmp-uuid/%s/%s-flat.vmdk'"
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'_image_id'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
newline|'\n'
name|'expected_image_path_parent'
op|'='
string|"'[%s] vmware_temp/tmp-uuid/%s'"
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
newline|'\n'
name|'expected_path_to_create'
op|'='
string|"'[%s] vmware_temp/tmp-uuid/%s/%s.vmdk'"
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'_image_id'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
newline|'\n'
nl|'\n'
name|'mock_mkdir'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'DsPathMatcher'
op|'('
name|'expected_image_path_parent'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
name|'tmp_dir_loc'
op|')'
op|','
name|'expected_tmp_dir_path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
name|'tmp_image_ds_loc'
op|')'
op|','
name|'expected_image_path'
op|')'
newline|'\n'
nl|'\n'
name|'image_info'
op|'='
name|'vi'
op|'.'
name|'ii'
newline|'\n'
name|'mock_create_virtual_disk'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|','
nl|'\n'
name|'image_info'
op|'.'
name|'adapter_type'
op|','
nl|'\n'
name|'image_info'
op|'.'
name|'disk_type'
op|','
nl|'\n'
name|'DsPathMatcher'
op|'('
name|'expected_path_to_create'
op|')'
op|','
nl|'\n'
name|'image_info'
op|'.'
name|'file_size_in_kb'
op|')'
newline|'\n'
name|'mock_delete_datastore_file'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'DsPathMatcher'
op|'('
name|'expected_image_path'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'file_move'"
op|')'
newline|'\n'
DECL|member|test_cache_iso_image
name|'def'
name|'test_cache_iso_image'
op|'('
name|'self'
op|','
name|'mock_file_move'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vi'
op|'='
name|'self'
op|'.'
name|'_make_vm_config_info'
op|'('
name|'is_iso'
op|'='
name|'True'
op|')'
newline|'\n'
name|'tmp_image_ds_loc'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_cache_iso_image'
op|'('
name|'vi'
op|','
name|'tmp_image_ds_loc'
op|')'
newline|'\n'
nl|'\n'
name|'mock_file_move'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|','
nl|'\n'
name|'tmp_image_ds_loc'
op|'.'
name|'parent'
op|','
nl|'\n'
name|'DsPathMatcher'
op|'('
string|"'[fake_ds] vmware_base/%s'"
op|'%'
name|'self'
op|'.'
name|'_image_id'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'file_move'"
op|')'
newline|'\n'
DECL|member|test_cache_flat_image
name|'def'
name|'test_cache_flat_image'
op|'('
name|'self'
op|','
name|'mock_file_move'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vi'
op|'='
name|'self'
op|'.'
name|'_make_vm_config_info'
op|'('
op|')'
newline|'\n'
name|'tmp_image_ds_loc'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_cache_flat_image'
op|'('
name|'vi'
op|','
name|'tmp_image_ds_loc'
op|')'
newline|'\n'
nl|'\n'
name|'mock_file_move'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|','
nl|'\n'
name|'tmp_image_ds_loc'
op|'.'
name|'parent'
op|','
nl|'\n'
name|'DsPathMatcher'
op|'('
string|"'[fake_ds] vmware_base/%s'"
op|'%'
name|'self'
op|'.'
name|'_image_id'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'disk_move'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'mkdir'"
op|')'
newline|'\n'
DECL|member|test_cache_stream_optimized_image
name|'def'
name|'test_cache_stream_optimized_image'
op|'('
name|'self'
op|','
name|'mock_mkdir'
op|','
name|'mock_disk_move'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vi'
op|'='
name|'self'
op|'.'
name|'_make_vm_config_info'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_cache_stream_optimized_image'
op|'('
name|'vi'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'tmp_image'
op|')'
newline|'\n'
nl|'\n'
name|'mock_mkdir'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'DsPathMatcher'
op|'('
string|"'[fake_ds] vmware_base/%s'"
op|'%'
name|'self'
op|'.'
name|'_image_id'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|')'
newline|'\n'
name|'mock_disk_move'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'tmp_image'
op|','
nl|'\n'
name|'DsPathMatcher'
op|'('
string|"'[fake_ds] vmware_base/%s/%s.vmdk'"
op|'%'
nl|'\n'
op|'('
name|'self'
op|'.'
name|'_image_id'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'ds_util'
op|','
string|"'file_move'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'copy_virtual_disk'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMwareVMOps'
op|','
string|"'_delete_datastore_file'"
op|')'
newline|'\n'
DECL|member|test_cache_sparse_image
name|'def'
name|'test_cache_sparse_image'
op|'('
name|'self'
op|','
nl|'\n'
name|'mock_delete_datastore_file'
op|','
nl|'\n'
name|'mock_copy_virtual_disk'
op|','
nl|'\n'
name|'mock_file_move'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vi'
op|'='
name|'self'
op|'.'
name|'_make_vm_config_info'
op|'('
name|'is_sparse_disk'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'sparse_disk_path'
op|'='
string|'"[%s] vmware_temp/tmp-uuid/%s/tmp-sparse.vmdk"'
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
newline|'\n'
name|'tmp_image_ds_loc'
op|'='
name|'ds_obj'
op|'.'
name|'DatastorePath'
op|'.'
name|'parse'
op|'('
name|'sparse_disk_path'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_cache_sparse_image'
op|'('
name|'vi'
op|','
name|'tmp_image_ds_loc'
op|')'
newline|'\n'
nl|'\n'
name|'target_disk_path'
op|'='
string|'"[%s] vmware_temp/tmp-uuid/%s/%s.vmdk"'
op|'%'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_ds'
op|'.'
name|'name'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_image_id'
op|','
name|'self'
op|'.'
name|'_image_id'
op|')'
newline|'\n'
name|'mock_copy_virtual_disk'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
name|'self'
op|'.'
name|'_dc_info'
op|'.'
name|'ref'
op|','
nl|'\n'
name|'sparse_disk_path'
op|','
nl|'\n'
name|'DsPathMatcher'
op|'('
name|'target_disk_path'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_storage_policy_none
dedent|''
name|'def'
name|'test_get_storage_policy_none'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'flavor'
op|'='
name|'objects'
op|'.'
name|'Flavor'
op|'('
name|'name'
op|'='
string|"'m1.small'"
op|','
nl|'\n'
name|'memory_mb'
op|'='
number|'6'
op|','
nl|'\n'
name|'vcpus'
op|'='
number|'28'
op|','
nl|'\n'
name|'root_gb'
op|'='
number|'496'
op|','
nl|'\n'
name|'ephemeral_gb'
op|'='
number|'8128'
op|','
nl|'\n'
name|'swap'
op|'='
number|'33550336'
op|','
nl|'\n'
name|'extra_specs'
op|'='
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'pbm_enabled'
op|'='
name|'True'
op|','
nl|'\n'
name|'pbm_default_policy'
op|'='
string|"'fake-policy'"
op|','
name|'group'
op|'='
string|"'vmware'"
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_get_extra_specs'
op|'('
name|'flavor'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'fake-policy'"
op|','
name|'extra_specs'
op|'.'
name|'storage_policy'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_storage_policy_extra_specs
dedent|''
name|'def'
name|'test_get_storage_policy_extra_specs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'extra_specs'
op|'='
op|'{'
string|"'vmware:storage_policy'"
op|':'
string|"'flavor-policy'"
op|'}'
newline|'\n'
name|'flavor'
op|'='
name|'objects'
op|'.'
name|'Flavor'
op|'('
name|'name'
op|'='
string|"'m1.small'"
op|','
nl|'\n'
name|'memory_mb'
op|'='
number|'6'
op|','
nl|'\n'
name|'vcpus'
op|'='
number|'28'
op|','
nl|'\n'
name|'root_gb'
op|'='
number|'496'
op|','
nl|'\n'
name|'ephemeral_gb'
op|'='
number|'8128'
op|','
nl|'\n'
name|'swap'
op|'='
number|'33550336'
op|','
nl|'\n'
name|'extra_specs'
op|'='
name|'extra_specs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'pbm_enabled'
op|'='
name|'True'
op|','
nl|'\n'
name|'pbm_default_policy'
op|'='
string|"'default-policy'"
op|','
name|'group'
op|'='
string|"'vmware'"
op|')'
newline|'\n'
name|'extra_specs'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_get_extra_specs'
op|'('
name|'flavor'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'flavor-policy'"
op|','
name|'extra_specs'
op|'.'
name|'storage_policy'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_base_folder_not_set
dedent|''
name|'def'
name|'test_get_base_folder_not_set'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'image_cache_subdirectory_name'
op|'='
string|"'vmware_base'"
op|')'
newline|'\n'
name|'base_folder'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_get_base_folder'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'vmware_base'"
op|','
name|'base_folder'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_base_folder_host_ip
dedent|''
name|'def'
name|'test_get_base_folder_host_ip'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'my_ip'
op|'='
string|"'7.7.7.7'"
op|','
nl|'\n'
name|'image_cache_subdirectory_name'
op|'='
string|"'_base'"
op|')'
newline|'\n'
name|'base_folder'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_get_base_folder'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'7.7.7.7_base'"
op|','
name|'base_folder'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_base_folder_cache_prefix
dedent|''
name|'def'
name|'test_get_base_folder_cache_prefix'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'cache_prefix'
op|'='
string|"'my_prefix'"
op|','
name|'group'
op|'='
string|"'vmware'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'image_cache_subdirectory_name'
op|'='
string|"'_base'"
op|')'
newline|'\n'
name|'base_folder'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_get_base_folder'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'my_prefix_base'"
op|','
name|'base_folder'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_reboot_vm
dedent|''
name|'def'
name|'_test_reboot_vm'
op|'('
name|'self'
op|','
name|'reboot_type'
op|'='
string|'"SOFT"'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'expected_methods'
op|'='
op|'['
string|"'get_object_properties'"
op|']'
newline|'\n'
name|'if'
name|'reboot_type'
op|'=='
string|'"SOFT"'
op|':'
newline|'\n'
indent|'            '
name|'expected_methods'
op|'.'
name|'append'
op|'('
string|"'RebootGuest'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'expected_methods'
op|'.'
name|'append'
op|'('
string|"'ResetVM_Task'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'query'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'query'
op|'['
string|"'runtime.powerState'"
op|']'
op|'='
string|'"poweredOn"'
newline|'\n'
name|'query'
op|'['
string|"'summary.guest.toolsStatus'"
op|']'
op|'='
string|'"toolsOk"'
newline|'\n'
name|'query'
op|'['
string|"'summary.guest.toolsRunningStatus'"
op|']'
op|'='
string|'"guestToolsRunning"'
newline|'\n'
nl|'\n'
DECL|function|fake_call_method
name|'def'
name|'fake_call_method'
op|'('
name|'module'
op|','
name|'method'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'expected_method'
op|'='
name|'expected_methods'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_method'
op|','
name|'method'
op|')'
newline|'\n'
name|'if'
op|'('
name|'expected_method'
op|'=='
string|"'get_object_properties'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
string|"'fake-props'"
newline|'\n'
dedent|''
name|'elif'
op|'('
name|'expected_method'
op|'=='
string|"'ResetVM_Task'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
string|"'fake-task'"
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_vm_ref"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-vm-ref'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_values_from_object_properties"'
op|','
nl|'\n'
name|'return_value'
op|'='
name|'query'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
string|'"_call_method"'
op|','
nl|'\n'
name|'fake_call_method'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
string|'"_wait_for_task"'
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'_get_vm_ref'
op|','
name|'_get_values_from_object_properties'
op|','
nl|'\n'
name|'fake_call_method'
op|','
name|'_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'reboot'
op|'('
name|'self'
op|'.'
name|'_instance'
op|','
name|'self'
op|'.'
name|'network_info'
op|','
name|'reboot_type'
op|')'
newline|'\n'
name|'_get_vm_ref'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_instance'
op|')'
newline|'\n'
nl|'\n'
name|'_get_values_from_object_properties'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_session'
op|','
nl|'\n'
string|"'fake-props'"
op|')'
newline|'\n'
name|'if'
name|'reboot_type'
op|'=='
string|'"HARD"'
op|':'
newline|'\n'
indent|'                '
name|'_wait_for_task'
op|'.'
name|'assert_has_calls'
op|'('
op|'['
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
string|"'fake-task'"
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_reboot_vm_soft
dedent|''
dedent|''
dedent|''
name|'def'
name|'test_reboot_vm_soft'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_reboot_vm'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_reboot_vm_hard
dedent|''
name|'def'
name|'test_reboot_vm_hard'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_reboot_vm'
op|'('
name|'reboot_type'
op|'='
string|'"HARD"'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
