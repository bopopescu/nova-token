begin_unit
comment|'#  Copyright 2014 IBM Corp.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'os'
newline|'\n'
nl|'\n'
name|'from'
name|'eventlet'
name|'import'
name|'timeout'
name|'as'
name|'etimeout'
newline|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'from'
name|'oslo'
op|'.'
name|'config'
name|'import'
name|'cfg'
newline|'\n'
name|'from'
name|'oslo'
op|'.'
name|'utils'
name|'import'
name|'units'
newline|'\n'
name|'from'
name|'oslo_concurrency'
name|'import'
name|'processutils'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
name|'import'
name|'fake_instance'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
op|'.'
name|'virt'
op|'.'
name|'hyperv'
name|'import'
name|'test_base'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'hyperv'
name|'import'
name|'constants'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'hyperv'
name|'import'
name|'vmops'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'hyperv'
name|'import'
name|'vmutils'
newline|'\n'
nl|'\n'
DECL|variable|CONF
name|'CONF'
op|'='
name|'cfg'
op|'.'
name|'CONF'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VMOpsTestCase
name|'class'
name|'VMOpsTestCase'
op|'('
name|'test_base'
op|'.'
name|'HyperVBaseTestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Unit tests for the Hyper-V VMOps class."""'
newline|'\n'
nl|'\n'
DECL|variable|_FAKE_TIMEOUT
name|'_FAKE_TIMEOUT'
op|'='
number|'2'
newline|'\n'
DECL|variable|FAKE_SIZE
name|'FAKE_SIZE'
op|'='
number|'10'
newline|'\n'
DECL|variable|FAKE_DIR
name|'FAKE_DIR'
op|'='
string|"'fake_dir'"
newline|'\n'
DECL|variable|FAKE_ROOT_PATH
name|'FAKE_ROOT_PATH'
op|'='
string|"'C:\\\\path\\\\to\\\\fake.%s'"
newline|'\n'
DECL|variable|FAKE_CONFIG_DRIVE_ISO
name|'FAKE_CONFIG_DRIVE_ISO'
op|'='
string|"'configdrive.iso'"
newline|'\n'
DECL|variable|FAKE_CONFIG_DRIVE_VHD
name|'FAKE_CONFIG_DRIVE_VHD'
op|'='
string|"'configdrive.vhd'"
newline|'\n'
nl|'\n'
DECL|variable|ISO9660
name|'ISO9660'
op|'='
string|"'iso9660'"
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'test_case_name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'VMOpsTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'__init__'
op|'('
name|'test_case_name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|setUp
dedent|''
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'VMOpsTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
string|"'fake-context'"
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'='
name|'vmops'
op|'.'
name|'VMOps'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vmutils'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vhdutils'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_prepare_create_root_vhd_mocks
dedent|''
name|'def'
name|'_prepare_create_root_vhd_mocks'
op|'('
name|'self'
op|','
name|'use_cow_images'
op|','
name|'vhd_format'
op|','
nl|'\n'
name|'vhd_size'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
name|'mock_instance'
op|'.'
name|'root_gb'
op|'='
name|'self'
op|'.'
name|'FAKE_SIZE'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'use_cow_images'
op|'='
name|'use_cow_images'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vhdutils'
op|'.'
name|'get_vhd_info'
op|'.'
name|'return_value'
op|'='
op|'{'
string|"'MaxInternalSize'"
op|':'
nl|'\n'
name|'vhd_size'
op|'*'
name|'units'
op|'.'
name|'Gi'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vhdutils'
op|'.'
name|'get_vhd_format'
op|'.'
name|'return_value'
op|'='
name|'vhd_format'
newline|'\n'
name|'root_vhd_internal_size'
op|'='
name|'mock_instance'
op|'.'
name|'root_gb'
op|'*'
name|'units'
op|'.'
name|'Gi'
newline|'\n'
name|'get_size'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vhdutils'
op|'.'
name|'get_internal_vhd_size_by_file_size'
newline|'\n'
name|'get_size'
op|'.'
name|'return_value'
op|'='
name|'root_vhd_internal_size'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'exists'
op|'.'
name|'return_value'
op|'='
name|'True'
newline|'\n'
nl|'\n'
name|'return'
name|'mock_instance'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.hyperv.imagecache.ImageCache.get_cached_image'"
op|')'
newline|'\n'
DECL|member|_test_create_root_vhd_exception
name|'def'
name|'_test_create_root_vhd_exception'
op|'('
name|'self'
op|','
name|'mock_get_cached_image'
op|','
nl|'\n'
name|'vhd_format'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_instance'
op|'='
name|'self'
op|'.'
name|'_prepare_create_root_vhd_mocks'
op|'('
nl|'\n'
name|'use_cow_images'
op|'='
name|'False'
op|','
name|'vhd_format'
op|'='
name|'vhd_format'
op|','
nl|'\n'
name|'vhd_size'
op|'='
op|'('
name|'self'
op|'.'
name|'FAKE_SIZE'
op|'+'
number|'1'
op|')'
op|')'
newline|'\n'
name|'fake_vhd_path'
op|'='
name|'self'
op|'.'
name|'FAKE_ROOT_PATH'
op|'%'
name|'vhd_format'
newline|'\n'
name|'mock_get_cached_image'
op|'.'
name|'return_value'
op|'='
name|'fake_vhd_path'
newline|'\n'
name|'fake_root_path'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'get_root_vhd_path'
op|'.'
name|'return_value'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'vmutils'
op|'.'
name|'VHDResizeException'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_create_root_vhd'
op|','
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'mock_instance'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vhdutils'
op|'.'
name|'resize_vhd'
op|'.'
name|'called'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'exists'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'fake_root_path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'remove'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'fake_root_path'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.hyperv.imagecache.ImageCache.get_cached_image'"
op|')'
newline|'\n'
DECL|member|_test_create_root_vhd_qcow
name|'def'
name|'_test_create_root_vhd_qcow'
op|'('
name|'self'
op|','
name|'mock_get_cached_image'
op|','
name|'vhd_format'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_instance'
op|'='
name|'self'
op|'.'
name|'_prepare_create_root_vhd_mocks'
op|'('
nl|'\n'
name|'use_cow_images'
op|'='
name|'True'
op|','
name|'vhd_format'
op|'='
name|'vhd_format'
op|','
nl|'\n'
name|'vhd_size'
op|'='
op|'('
name|'self'
op|'.'
name|'FAKE_SIZE'
op|'-'
number|'1'
op|')'
op|')'
newline|'\n'
name|'fake_vhd_path'
op|'='
name|'self'
op|'.'
name|'FAKE_ROOT_PATH'
op|'%'
name|'vhd_format'
newline|'\n'
name|'mock_get_cached_image'
op|'.'
name|'return_value'
op|'='
name|'fake_vhd_path'
newline|'\n'
nl|'\n'
name|'fake_root_path'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'get_root_vhd_path'
op|'.'
name|'return_value'
newline|'\n'
name|'root_vhd_internal_size'
op|'='
name|'mock_instance'
op|'.'
name|'root_gb'
op|'*'
name|'units'
op|'.'
name|'Gi'
newline|'\n'
name|'get_size'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vhdutils'
op|'.'
name|'get_internal_vhd_size_by_file_size'
newline|'\n'
nl|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_create_root_vhd'
op|'('
name|'context'
op|'='
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'instance'
op|'='
name|'mock_instance'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'fake_root_path'
op|','
name|'response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'get_root_vhd_path'
op|'.'
name|'assert_called_with'
op|'('
nl|'\n'
name|'mock_instance'
op|'.'
name|'name'
op|','
name|'vhd_format'
op|')'
newline|'\n'
name|'differencing_vhd'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vhdutils'
op|'.'
name|'create_differencing_vhd'
newline|'\n'
name|'differencing_vhd'
op|'.'
name|'assert_called_with'
op|'('
name|'fake_root_path'
op|','
name|'fake_vhd_path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vhdutils'
op|'.'
name|'get_vhd_info'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'fake_vhd_path'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'vhd_format'
name|'is'
name|'constants'
op|'.'
name|'DISK_FORMAT_VHD'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'get_size'
op|'.'
name|'called'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vhdutils'
op|'.'
name|'resize_vhd'
op|'.'
name|'called'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'get_size'
op|'.'
name|'assert_called_once_with'
op|'('
name|'fake_vhd_path'
op|','
nl|'\n'
name|'root_vhd_internal_size'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vhdutils'
op|'.'
name|'resize_vhd'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'fake_root_path'
op|','
name|'root_vhd_internal_size'
op|','
name|'is_file_max_size'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.hyperv.imagecache.ImageCache.get_cached_image'"
op|')'
newline|'\n'
DECL|member|_test_create_root_vhd
name|'def'
name|'_test_create_root_vhd'
op|'('
name|'self'
op|','
name|'mock_get_cached_image'
op|','
name|'vhd_format'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_instance'
op|'='
name|'self'
op|'.'
name|'_prepare_create_root_vhd_mocks'
op|'('
nl|'\n'
name|'use_cow_images'
op|'='
name|'False'
op|','
name|'vhd_format'
op|'='
name|'vhd_format'
op|','
nl|'\n'
name|'vhd_size'
op|'='
op|'('
name|'self'
op|'.'
name|'FAKE_SIZE'
op|'-'
number|'1'
op|')'
op|')'
newline|'\n'
name|'fake_vhd_path'
op|'='
name|'self'
op|'.'
name|'FAKE_ROOT_PATH'
op|'%'
name|'vhd_format'
newline|'\n'
name|'mock_get_cached_image'
op|'.'
name|'return_value'
op|'='
name|'fake_vhd_path'
newline|'\n'
nl|'\n'
name|'fake_root_path'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'get_root_vhd_path'
op|'.'
name|'return_value'
newline|'\n'
name|'root_vhd_internal_size'
op|'='
name|'mock_instance'
op|'.'
name|'root_gb'
op|'*'
name|'units'
op|'.'
name|'Gi'
newline|'\n'
name|'get_size'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vhdutils'
op|'.'
name|'get_internal_vhd_size_by_file_size'
newline|'\n'
nl|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_create_root_vhd'
op|'('
name|'context'
op|'='
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'instance'
op|'='
name|'mock_instance'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'fake_root_path'
op|','
name|'response'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'get_root_vhd_path'
op|'.'
name|'assert_called_with'
op|'('
nl|'\n'
name|'mock_instance'
op|'.'
name|'name'
op|','
name|'vhd_format'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'copyfile'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'fake_vhd_path'
op|','
name|'fake_root_path'
op|')'
newline|'\n'
name|'get_size'
op|'.'
name|'assert_called_once_with'
op|'('
name|'fake_vhd_path'
op|','
name|'root_vhd_internal_size'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vhdutils'
op|'.'
name|'resize_vhd'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'fake_root_path'
op|','
name|'root_vhd_internal_size'
op|','
name|'is_file_max_size'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_root_vhd
dedent|''
name|'def'
name|'test_create_root_vhd'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_root_vhd'
op|'('
name|'vhd_format'
op|'='
name|'constants'
op|'.'
name|'DISK_FORMAT_VHD'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_root_vhdx
dedent|''
name|'def'
name|'test_create_root_vhdx'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_root_vhd'
op|'('
name|'vhd_format'
op|'='
name|'constants'
op|'.'
name|'DISK_FORMAT_VHDX'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_root_vhd_use_cow_images_true
dedent|''
name|'def'
name|'test_create_root_vhd_use_cow_images_true'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_root_vhd_qcow'
op|'('
name|'vhd_format'
op|'='
name|'constants'
op|'.'
name|'DISK_FORMAT_VHD'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_root_vhdx_use_cow_images_true
dedent|''
name|'def'
name|'test_create_root_vhdx_use_cow_images_true'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_root_vhd_qcow'
op|'('
name|'vhd_format'
op|'='
name|'constants'
op|'.'
name|'DISK_FORMAT_VHDX'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_root_vhdx_size_less_than_internal
dedent|''
name|'def'
name|'test_create_root_vhdx_size_less_than_internal'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_root_vhd_exception'
op|'('
nl|'\n'
name|'vhd_format'
op|'='
name|'constants'
op|'.'
name|'DISK_FORMAT_VHD'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_is_resize_needed_exception
dedent|''
name|'def'
name|'test_is_resize_needed_exception'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'inst'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
nl|'\n'
name|'vmutils'
op|'.'
name|'VHDResizeException'
op|','
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_is_resize_needed'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_PATH'
op|','
name|'self'
op|'.'
name|'FAKE_SIZE'
op|','
name|'self'
op|'.'
name|'FAKE_SIZE'
op|'-'
number|'1'
op|','
name|'inst'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_is_resize_needed_true
dedent|''
name|'def'
name|'test_is_resize_needed_true'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'inst'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_is_resize_needed'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_PATH'
op|','
name|'self'
op|'.'
name|'FAKE_SIZE'
op|','
name|'self'
op|'.'
name|'FAKE_SIZE'
op|'+'
number|'1'
op|','
name|'inst'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_is_resize_needed_false
dedent|''
name|'def'
name|'test_is_resize_needed_false'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'inst'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_is_resize_needed'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_PATH'
op|','
name|'self'
op|'.'
name|'FAKE_SIZE'
op|','
name|'self'
op|'.'
name|'FAKE_SIZE'
op|','
name|'inst'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_ephemeral_vhd
dedent|''
name|'def'
name|'test_create_ephemeral_vhd'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
name|'mock_instance'
op|'.'
name|'ephemeral_gb'
op|'='
name|'self'
op|'.'
name|'FAKE_SIZE'
newline|'\n'
name|'best_supported'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vhdutils'
op|'.'
name|'get_best_supported_vhd_format'
newline|'\n'
name|'best_supported'
op|'.'
name|'return_value'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_FORMAT'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'get_ephemeral_vhd_path'
op|'.'
name|'return_value'
op|'='
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_PATH'
op|')'
newline|'\n'
nl|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'create_ephemeral_vhd'
op|'('
name|'instance'
op|'='
name|'mock_instance'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'get_ephemeral_vhd_path'
op|'.'
name|'assert_called_with'
op|'('
nl|'\n'
name|'mock_instance'
op|'.'
name|'name'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_FORMAT'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vhdutils'
op|'.'
name|'create_dynamic_vhd'
op|'.'
name|'assert_called_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_PATH'
op|','
name|'mock_instance'
op|'.'
name|'ephemeral_gb'
op|'*'
name|'units'
op|'.'
name|'Gi'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_FORMAT'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_PATH'
op|','
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.hyperv.vmops.VMOps.destroy'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.hyperv.vmops.VMOps.power_on'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.hyperv.vmops.VMOps.attach_config_drive'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.hyperv.vmops.VMOps._create_config_drive'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.configdrive.required_by'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.hyperv.vmops.VMOps.create_instance'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.hyperv.vmops.VMOps.create_ephemeral_vhd'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.hyperv.vmops.VMOps._create_root_vhd'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.hyperv.volumeops.VolumeOps.'"
nl|'\n'
string|"'ebs_root_in_block_devices'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.hyperv.vmops.VMOps._delete_disk_files'"
op|')'
newline|'\n'
DECL|member|_test_spawn
name|'def'
name|'_test_spawn'
op|'('
name|'self'
op|','
name|'mock_delete_disk_files'
op|','
nl|'\n'
name|'mock_ebs_root_in_block_devices'
op|','
name|'mock_create_root_vhd'
op|','
nl|'\n'
name|'mock_create_ephemeral_vhd'
op|','
name|'mock_create_instance'
op|','
nl|'\n'
name|'mock_configdrive_required'
op|','
name|'mock_create_config_drive'
op|','
nl|'\n'
name|'mock_attach_config_drive'
op|','
name|'mock_power_on'
op|','
name|'mock_destroy'
op|','
nl|'\n'
name|'exists'
op|','
name|'boot_from_volume'
op|','
name|'configdrive_required'
op|','
name|'fail'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
nl|'\n'
name|'fake_root_path'
op|'='
name|'mock_create_root_vhd'
op|'.'
name|'return_value'
newline|'\n'
name|'fake_root_path'
op|'='
name|'None'
name|'if'
name|'boot_from_volume'
name|'else'
name|'fake_root_path'
newline|'\n'
name|'fake_ephemeral_path'
op|'='
name|'mock_create_ephemeral_vhd'
op|'.'
name|'return_value'
newline|'\n'
name|'fake_config_drive_path'
op|'='
name|'mock_create_config_drive'
op|'.'
name|'return_value'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vmutils'
op|'.'
name|'vm_exists'
op|'.'
name|'return_value'
op|'='
name|'exists'
newline|'\n'
name|'mock_ebs_root_in_block_devices'
op|'.'
name|'return_value'
op|'='
name|'boot_from_volume'
newline|'\n'
name|'mock_create_root_vhd'
op|'.'
name|'return_value'
op|'='
name|'fake_root_path'
newline|'\n'
name|'mock_configdrive_required'
op|'.'
name|'return_value'
op|'='
name|'configdrive_required'
newline|'\n'
name|'mock_create_instance'
op|'.'
name|'side_effect'
op|'='
name|'fail'
newline|'\n'
name|'if'
name|'exists'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'InstanceExists'
op|','
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'spawn'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'mock_instance'
op|','
name|'None'
op|','
nl|'\n'
op|'['
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FILE'
op|']'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'PASSWORD'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'INFO'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'DEV_INFO'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'fail'
name|'is'
name|'vmutils'
op|'.'
name|'HyperVException'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'vmutils'
op|'.'
name|'HyperVException'
op|','
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'spawn'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'mock_instance'
op|','
name|'None'
op|','
nl|'\n'
op|'['
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FILE'
op|']'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'PASSWORD'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'INFO'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'DEV_INFO'
op|')'
newline|'\n'
name|'mock_destroy'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock_instance'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'spawn'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'mock_instance'
op|','
name|'None'
op|','
nl|'\n'
op|'['
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FILE'
op|']'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'PASSWORD'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'INFO'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'DEV_INFO'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vmutils'
op|'.'
name|'vm_exists'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock_instance'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'mock_delete_disk_files'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock_instance'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'mock_ebs_root_in_block_devices'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'DEV_INFO'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'boot_from_volume'
op|':'
newline|'\n'
indent|'                '
name|'mock_create_root_vhd'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'mock_instance'
op|')'
newline|'\n'
dedent|''
name|'mock_create_ephemeral_vhd'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock_instance'
op|')'
newline|'\n'
name|'mock_create_instance'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock_instance'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'INFO'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'DEV_INFO'
op|','
nl|'\n'
name|'fake_root_path'
op|','
name|'fake_ephemeral_path'
op|')'
newline|'\n'
name|'mock_configdrive_required'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock_instance'
op|')'
newline|'\n'
name|'if'
name|'configdrive_required'
op|':'
newline|'\n'
indent|'                '
name|'mock_create_config_drive'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock_instance'
op|','
op|'['
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FILE'
op|']'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'PASSWORD'
op|')'
newline|'\n'
name|'mock_attach_config_drive'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock_instance'
op|','
name|'fake_config_drive_path'
op|')'
newline|'\n'
dedent|''
name|'mock_power_on'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock_instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn
dedent|''
dedent|''
name|'def'
name|'test_spawn'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'exists'
op|'='
name|'False'
op|','
name|'boot_from_volume'
op|'='
name|'False'
op|','
nl|'\n'
name|'configdrive_required'
op|'='
name|'True'
op|','
name|'fail'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_instance_exists
dedent|''
name|'def'
name|'test_spawn_instance_exists'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'exists'
op|'='
name|'True'
op|','
name|'boot_from_volume'
op|'='
name|'False'
op|','
nl|'\n'
name|'configdrive_required'
op|'='
name|'True'
op|','
name|'fail'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_create_instance_exception
dedent|''
name|'def'
name|'test_spawn_create_instance_exception'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'exists'
op|'='
name|'False'
op|','
name|'boot_from_volume'
op|'='
name|'False'
op|','
nl|'\n'
name|'configdrive_required'
op|'='
name|'True'
op|','
nl|'\n'
name|'fail'
op|'='
name|'vmutils'
op|'.'
name|'HyperVException'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_not_required
dedent|''
name|'def'
name|'test_spawn_not_required'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'exists'
op|'='
name|'False'
op|','
name|'boot_from_volume'
op|'='
name|'False'
op|','
nl|'\n'
name|'configdrive_required'
op|'='
name|'False'
op|','
name|'fail'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_spawn_root_in_block
dedent|''
name|'def'
name|'test_spawn_root_in_block'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_spawn'
op|'('
name|'exists'
op|'='
name|'False'
op|','
name|'boot_from_volume'
op|'='
name|'True'
op|','
nl|'\n'
name|'configdrive_required'
op|'='
name|'False'
op|','
name|'fail'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.hyperv.volumeops.VolumeOps'"
nl|'\n'
string|"'.attach_volumes'"
op|')'
newline|'\n'
DECL|member|_test_create_instance
name|'def'
name|'_test_create_instance'
op|'('
name|'self'
op|','
name|'mock_attach_volumes'
op|','
name|'fake_root_path'
op|','
nl|'\n'
name|'fake_ephemeral_path'
op|','
name|'enable_instance_metrics'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_vif_driver'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vif_driver'
op|'='
name|'mock_vif_driver'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'enable_instance_metrics_collection'
op|'='
name|'enable_instance_metrics'
op|','
nl|'\n'
name|'group'
op|'='
string|"'hyperv'"
op|')'
newline|'\n'
name|'fake_network_info'
op|'='
op|'{'
string|"'id'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'ID'
op|','
nl|'\n'
string|"'address'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'ADDRESS'
op|'}'
newline|'\n'
name|'mock_instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'create_instance'
op|'('
name|'instance'
op|'='
name|'mock_instance'
op|','
nl|'\n'
name|'network_info'
op|'='
op|'['
name|'fake_network_info'
op|']'
op|','
nl|'\n'
name|'block_device_info'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'DEV_INFO'
op|','
nl|'\n'
name|'root_vhd_path'
op|'='
name|'fake_root_path'
op|','
nl|'\n'
name|'eph_vhd_path'
op|'='
name|'fake_ephemeral_path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vmutils'
op|'.'
name|'create_vm'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock_instance'
op|'.'
name|'name'
op|','
name|'mock_instance'
op|'.'
name|'memory_mb'
op|','
nl|'\n'
name|'mock_instance'
op|'.'
name|'vcpus'
op|','
name|'CONF'
op|'.'
name|'hyperv'
op|'.'
name|'limit_cpu_features'
op|','
nl|'\n'
name|'CONF'
op|'.'
name|'hyperv'
op|'.'
name|'dynamic_memory_ratio'
op|','
op|'['
name|'mock_instance'
op|'.'
name|'uuid'
op|']'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'['
op|']'
newline|'\n'
name|'ctrl_disk_addr'
op|'='
number|'0'
newline|'\n'
name|'if'
name|'fake_root_path'
op|':'
newline|'\n'
indent|'            '
name|'expected'
op|'.'
name|'append'
op|'('
name|'mock'
op|'.'
name|'call'
op|'('
name|'mock_instance'
op|'.'
name|'name'
op|','
name|'fake_root_path'
op|','
nl|'\n'
number|'0'
op|','
name|'ctrl_disk_addr'
op|','
name|'constants'
op|'.'
name|'DISK'
op|')'
op|')'
newline|'\n'
name|'ctrl_disk_addr'
op|'+='
number|'1'
newline|'\n'
dedent|''
name|'if'
name|'fake_ephemeral_path'
op|':'
newline|'\n'
indent|'            '
name|'expected'
op|'.'
name|'append'
op|'('
name|'mock'
op|'.'
name|'call'
op|'('
name|'mock_instance'
op|'.'
name|'name'
op|','
nl|'\n'
name|'fake_ephemeral_path'
op|','
number|'0'
op|','
name|'ctrl_disk_addr'
op|','
nl|'\n'
name|'constants'
op|'.'
name|'DISK'
op|')'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vmutils'
op|'.'
name|'attach_ide_drive'
op|'.'
name|'has_calls'
op|'('
name|'expected'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vmutils'
op|'.'
name|'create_scsi_controller'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock_instance'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'mock_attach_volumes'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'DEV_INFO'
op|','
nl|'\n'
name|'mock_instance'
op|'.'
name|'name'
op|','
nl|'\n'
name|'fake_root_path'
name|'is'
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vmutils'
op|'.'
name|'create_nic'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock_instance'
op|'.'
name|'name'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'ID'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'ADDRESS'
op|')'
newline|'\n'
name|'mock_vif_driver'
op|'.'
name|'plug'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock_instance'
op|','
nl|'\n'
name|'fake_network_info'
op|')'
newline|'\n'
name|'mock_enable'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vmutils'
op|'.'
name|'enable_vm_metrics_collection'
newline|'\n'
name|'if'
name|'enable_instance_metrics'
op|':'
newline|'\n'
indent|'            '
name|'mock_enable'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock_instance'
op|'.'
name|'name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_instance
dedent|''
dedent|''
name|'def'
name|'test_create_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_ephemeral_path'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_EPHEMERAL_PATH'
newline|'\n'
name|'self'
op|'.'
name|'_test_create_instance'
op|'('
name|'fake_root_path'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_ROOT_PATH'
op|','
nl|'\n'
name|'fake_ephemeral_path'
op|'='
name|'fake_ephemeral_path'
op|','
nl|'\n'
name|'enable_instance_metrics'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_instance_no_root_path
dedent|''
name|'def'
name|'test_create_instance_no_root_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_ephemeral_path'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_EPHEMERAL_PATH'
newline|'\n'
name|'self'
op|'.'
name|'_test_create_instance'
op|'('
name|'fake_root_path'
op|'='
name|'None'
op|','
nl|'\n'
name|'fake_ephemeral_path'
op|'='
name|'fake_ephemeral_path'
op|','
nl|'\n'
name|'enable_instance_metrics'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_instance_no_ephemeral_path
dedent|''
name|'def'
name|'test_create_instance_no_ephemeral_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_instance'
op|'('
name|'fake_root_path'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_ROOT_PATH'
op|','
nl|'\n'
name|'fake_ephemeral_path'
op|'='
name|'None'
op|','
nl|'\n'
name|'enable_instance_metrics'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_instance_no_path
dedent|''
name|'def'
name|'test_create_instance_no_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_instance'
op|'('
name|'fake_root_path'
op|'='
name|'None'
op|','
nl|'\n'
name|'fake_ephemeral_path'
op|'='
name|'None'
op|','
nl|'\n'
name|'enable_instance_metrics'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_instance_enable_instance_metrics_false
dedent|''
name|'def'
name|'test_create_instance_enable_instance_metrics_false'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_ephemeral_path'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_EPHEMERAL_PATH'
newline|'\n'
name|'self'
op|'.'
name|'_test_create_instance'
op|'('
name|'fake_root_path'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_ROOT_PATH'
op|','
nl|'\n'
name|'fake_ephemeral_path'
op|'='
name|'fake_ephemeral_path'
op|','
nl|'\n'
name|'enable_instance_metrics'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.api.metadata.base.InstanceMetadata'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.configdrive.ConfigDriveBuilder'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.utils.execute'"
op|')'
newline|'\n'
DECL|member|_test_create_config_drive
name|'def'
name|'_test_create_config_drive'
op|'('
name|'self'
op|','
name|'mock_execute'
op|','
name|'mock_ConfigDriveBuilder'
op|','
nl|'\n'
name|'mock_InstanceMetadata'
op|','
name|'config_drive_format'
op|','
nl|'\n'
name|'config_drive_cdrom'
op|','
name|'side_effect'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'config_drive_format'
op|'='
name|'config_drive_format'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'config_drive_cdrom'
op|'='
name|'config_drive_cdrom'
op|','
name|'group'
op|'='
string|"'hyperv'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'config_drive_inject_password'
op|'='
name|'True'
op|','
name|'group'
op|'='
string|"'hyperv'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'get_instance_dir'
op|'.'
name|'return_value'
op|'='
op|'('
nl|'\n'
name|'self'
op|'.'
name|'FAKE_DIR'
op|')'
newline|'\n'
name|'mock_ConfigDriveBuilder'
op|'('
op|')'
op|'.'
name|'__enter__'
op|'('
op|')'
op|'.'
name|'make_drive'
op|'.'
name|'side_effect'
op|'='
op|'['
nl|'\n'
name|'side_effect'
op|']'
newline|'\n'
nl|'\n'
name|'if'
name|'config_drive_format'
op|'!='
name|'self'
op|'.'
name|'ISO9660'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'vmutils'
op|'.'
name|'UnsupportedConfigDriveFormatException'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_create_config_drive'
op|','
nl|'\n'
name|'mock_instance'
op|','
op|'['
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FILE'
op|']'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'PASSWORD'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'side_effect'
name|'is'
name|'processutils'
op|'.'
name|'ProcessExecutionError'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'processutils'
op|'.'
name|'ProcessExecutionError'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_create_config_drive'
op|','
nl|'\n'
name|'mock_instance'
op|','
op|'['
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FILE'
op|']'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'PASSWORD'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_create_config_drive'
op|'('
name|'mock_instance'
op|','
nl|'\n'
op|'['
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FILE'
op|']'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'PASSWORD'
op|')'
newline|'\n'
name|'mock_InstanceMetadata'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock_instance'
op|','
name|'content'
op|'='
op|'['
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FILE'
op|']'
op|','
nl|'\n'
name|'extra_md'
op|'='
op|'{'
string|"'admin_pass'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'PASSWORD'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'get_instance_dir'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock_instance'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'mock_ConfigDriveBuilder'
op|'.'
name|'assert_called_with'
op|'('
nl|'\n'
name|'instance_md'
op|'='
name|'mock_InstanceMetadata'
op|'('
op|')'
op|')'
newline|'\n'
name|'mock_make_drive'
op|'='
name|'mock_ConfigDriveBuilder'
op|'('
op|')'
op|'.'
name|'__enter__'
op|'('
op|')'
op|'.'
name|'make_drive'
newline|'\n'
name|'path_iso'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'FAKE_DIR'
op|','
name|'self'
op|'.'
name|'FAKE_CONFIG_DRIVE_ISO'
op|')'
newline|'\n'
name|'path_vhd'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'FAKE_DIR'
op|','
name|'self'
op|'.'
name|'FAKE_CONFIG_DRIVE_VHD'
op|')'
newline|'\n'
name|'mock_make_drive'
op|'.'
name|'assert_called_once_with'
op|'('
name|'path_iso'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'CONF'
op|'.'
name|'hyperv'
op|'.'
name|'config_drive_cdrom'
op|':'
newline|'\n'
indent|'                '
name|'expected'
op|'='
name|'path_vhd'
newline|'\n'
name|'mock_execute'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'CONF'
op|'.'
name|'hyperv'
op|'.'
name|'qemu_img_cmd'
op|','
nl|'\n'
string|"'convert'"
op|','
string|"'-f'"
op|','
string|"'raw'"
op|','
string|"'-O'"
op|','
string|"'vpc'"
op|','
nl|'\n'
name|'path_iso'
op|','
name|'path_vhd'
op|','
name|'attempts'
op|'='
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'remove'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'FAKE_DIR'
op|','
name|'self'
op|'.'
name|'FAKE_CONFIG_DRIVE_ISO'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'expected'
op|'='
name|'path_iso'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'path'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_config_drive_cdrom
dedent|''
dedent|''
name|'def'
name|'test_create_config_drive_cdrom'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_config_drive'
op|'('
name|'config_drive_format'
op|'='
name|'self'
op|'.'
name|'ISO9660'
op|','
nl|'\n'
name|'config_drive_cdrom'
op|'='
name|'True'
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_config_drive_vhd
dedent|''
name|'def'
name|'test_create_config_drive_vhd'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_config_drive'
op|'('
name|'config_drive_format'
op|'='
name|'self'
op|'.'
name|'ISO9660'
op|','
nl|'\n'
name|'config_drive_cdrom'
op|'='
name|'False'
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_config_drive_other_drive_format
dedent|''
name|'def'
name|'test_create_config_drive_other_drive_format'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_config_drive'
op|'('
name|'config_drive_format'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'OTHER'
op|','
nl|'\n'
name|'config_drive_cdrom'
op|'='
name|'False'
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_config_drive_execution_error
dedent|''
name|'def'
name|'test_create_config_drive_execution_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_config_drive'
op|'('
nl|'\n'
name|'config_drive_format'
op|'='
name|'self'
op|'.'
name|'ISO9660'
op|','
nl|'\n'
name|'config_drive_cdrom'
op|'='
name|'False'
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'processutils'
op|'.'
name|'ProcessExecutionError'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_attach_config_drive
dedent|''
name|'def'
name|'test_attach_config_drive'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'InvalidDiskFormat'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'attach_config_drive'
op|','
nl|'\n'
name|'instance'
op|','
string|"'C:/fake_instance_dir/configdrive.xxx'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_disk_files
dedent|''
name|'def'
name|'test_delete_disk_files'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_delete_disk_files'
op|'('
name|'mock_instance'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'get_instance_dir'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock_instance'
op|'.'
name|'name'
op|','
name|'create_dir'
op|'='
name|'False'
op|','
name|'remove_dir'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_reboot_hard
dedent|''
name|'def'
name|'test_reboot_hard'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_reboot'
op|'('
name|'vmops'
op|'.'
name|'REBOOT_TYPE_HARD'
op|','
nl|'\n'
name|'constants'
op|'.'
name|'HYPERV_VM_STATE_REBOOT'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"nova.virt.hyperv.vmops.VMOps._soft_shutdown"'
op|')'
newline|'\n'
DECL|member|test_reboot_soft
name|'def'
name|'test_reboot_soft'
op|'('
name|'self'
op|','
name|'mock_soft_shutdown'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_soft_shutdown'
op|'.'
name|'return_value'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'_test_reboot'
op|'('
name|'vmops'
op|'.'
name|'REBOOT_TYPE_SOFT'
op|','
nl|'\n'
name|'constants'
op|'.'
name|'HYPERV_VM_STATE_ENABLED'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"nova.virt.hyperv.vmops.VMOps._soft_shutdown"'
op|')'
newline|'\n'
DECL|member|test_reboot_soft_failed
name|'def'
name|'test_reboot_soft_failed'
op|'('
name|'self'
op|','
name|'mock_soft_shutdown'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_soft_shutdown'
op|'.'
name|'return_value'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'_test_reboot'
op|'('
name|'vmops'
op|'.'
name|'REBOOT_TYPE_SOFT'
op|','
nl|'\n'
name|'constants'
op|'.'
name|'HYPERV_VM_STATE_REBOOT'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"nova.virt.hyperv.vmops.VMOps.power_on"'
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"nova.virt.hyperv.vmops.VMOps._soft_shutdown"'
op|')'
newline|'\n'
DECL|member|test_reboot_soft_exception
name|'def'
name|'test_reboot_soft_exception'
op|'('
name|'self'
op|','
name|'mock_soft_shutdown'
op|','
name|'mock_power_on'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_soft_shutdown'
op|'.'
name|'return_value'
op|'='
name|'True'
newline|'\n'
name|'mock_power_on'
op|'.'
name|'side_effect'
op|'='
name|'vmutils'
op|'.'
name|'HyperVException'
op|'('
string|'"Expected failure"'
op|')'
newline|'\n'
name|'instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'vmutils'
op|'.'
name|'HyperVException'
op|','
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'reboot'
op|','
nl|'\n'
name|'instance'
op|','
op|'{'
op|'}'
op|','
name|'vmops'
op|'.'
name|'REBOOT_TYPE_SOFT'
op|')'
newline|'\n'
nl|'\n'
name|'mock_soft_shutdown'
op|'.'
name|'assert_called_once_with'
op|'('
name|'instance'
op|')'
newline|'\n'
name|'mock_power_on'
op|'.'
name|'assert_called_once_with'
op|'('
name|'instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_reboot
dedent|''
name|'def'
name|'_test_reboot'
op|'('
name|'self'
op|','
name|'reboot_type'
op|','
name|'vm_state'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|','
string|"'_set_vm_state'"
op|')'
name|'as'
name|'mock_set_state'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'reboot'
op|'('
name|'instance'
op|','
op|'{'
op|'}'
op|','
name|'reboot_type'
op|')'
newline|'\n'
name|'mock_set_state'
op|'.'
name|'assert_called_once_with'
op|'('
name|'instance'
op|','
name|'vm_state'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"nova.virt.hyperv.vmops.VMOps._wait_for_power_off"'
op|')'
newline|'\n'
DECL|member|test_soft_shutdown
name|'def'
name|'test_soft_shutdown'
op|'('
name|'self'
op|','
name|'mock_wait_for_power_off'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
name|'mock_wait_for_power_off'
op|'.'
name|'return_value'
op|'='
name|'True'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_soft_shutdown'
op|'('
name|'instance'
op|','
name|'self'
op|'.'
name|'_FAKE_TIMEOUT'
op|')'
newline|'\n'
nl|'\n'
name|'mock_shutdown_vm'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vmutils'
op|'.'
name|'soft_shutdown_vm'
newline|'\n'
name|'mock_shutdown_vm'
op|'.'
name|'assert_called_once_with'
op|'('
name|'instance'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'mock_wait_for_power_off'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'instance'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'_FAKE_TIMEOUT'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"time.sleep"'
op|')'
newline|'\n'
DECL|member|test_soft_shutdown_failed
name|'def'
name|'test_soft_shutdown_failed'
op|'('
name|'self'
op|','
name|'mock_sleep'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
nl|'\n'
name|'mock_shutdown_vm'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vmutils'
op|'.'
name|'soft_shutdown_vm'
newline|'\n'
name|'mock_shutdown_vm'
op|'.'
name|'side_effect'
op|'='
name|'vmutils'
op|'.'
name|'HyperVException'
op|'('
nl|'\n'
string|'"Expected failure."'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_soft_shutdown'
op|'('
name|'instance'
op|','
name|'self'
op|'.'
name|'_FAKE_TIMEOUT'
op|')'
newline|'\n'
nl|'\n'
name|'mock_shutdown_vm'
op|'.'
name|'assert_called_once_with'
op|'('
name|'instance'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"nova.virt.hyperv.vmops.VMOps._wait_for_power_off"'
op|')'
newline|'\n'
DECL|member|test_soft_shutdown_wait
name|'def'
name|'test_soft_shutdown_wait'
op|'('
name|'self'
op|','
name|'mock_wait_for_power_off'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
name|'mock_wait_for_power_off'
op|'.'
name|'side_effect'
op|'='
op|'['
name|'False'
op|','
name|'True'
op|']'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_soft_shutdown'
op|'('
name|'instance'
op|','
name|'self'
op|'.'
name|'_FAKE_TIMEOUT'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
name|'calls'
op|'='
op|'['
name|'mock'
op|'.'
name|'call'
op|'('
name|'instance'
op|'.'
name|'name'
op|','
number|'1'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
name|'instance'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'_FAKE_TIMEOUT'
op|'-'
number|'1'
op|')'
op|']'
newline|'\n'
name|'mock_shutdown_vm'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vmutils'
op|'.'
name|'soft_shutdown_vm'
newline|'\n'
name|'mock_shutdown_vm'
op|'.'
name|'assert_called_with'
op|'('
name|'instance'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'mock_wait_for_power_off'
op|'.'
name|'assert_has_calls'
op|'('
name|'calls'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"nova.virt.hyperv.vmops.VMOps._wait_for_power_off"'
op|')'
newline|'\n'
DECL|member|test_soft_shutdown_wait_timeout
name|'def'
name|'test_soft_shutdown_wait_timeout'
op|'('
name|'self'
op|','
name|'mock_wait_for_power_off'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
name|'mock_wait_for_power_off'
op|'.'
name|'return_value'
op|'='
name|'False'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_soft_shutdown'
op|'('
name|'instance'
op|','
name|'self'
op|'.'
name|'_FAKE_TIMEOUT'
op|','
number|'1.5'
op|')'
newline|'\n'
nl|'\n'
name|'calls'
op|'='
op|'['
name|'mock'
op|'.'
name|'call'
op|'('
name|'instance'
op|'.'
name|'name'
op|','
number|'1.5'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
name|'instance'
op|'.'
name|'name'
op|','
name|'self'
op|'.'
name|'_FAKE_TIMEOUT'
op|'-'
number|'1.5'
op|')'
op|']'
newline|'\n'
name|'mock_shutdown_vm'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vmutils'
op|'.'
name|'soft_shutdown_vm'
newline|'\n'
name|'mock_shutdown_vm'
op|'.'
name|'assert_called_with'
op|'('
name|'instance'
op|'.'
name|'name'
op|')'
newline|'\n'
name|'mock_wait_for_power_off'
op|'.'
name|'assert_has_calls'
op|'('
name|'calls'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_power_off
dedent|''
name|'def'
name|'_test_power_off'
op|'('
name|'self'
op|','
name|'timeout'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|','
string|"'_set_vm_state'"
op|')'
name|'as'
name|'mock_set_state'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'power_off'
op|'('
name|'instance'
op|','
name|'timeout'
op|')'
newline|'\n'
nl|'\n'
name|'mock_set_state'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'instance'
op|','
name|'constants'
op|'.'
name|'HYPERV_VM_STATE_DISABLED'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_power_off_hard
dedent|''
dedent|''
name|'def'
name|'test_power_off_hard'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_power_off'
op|'('
name|'timeout'
op|'='
number|'0'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"nova.virt.hyperv.vmops.VMOps._soft_shutdown"'
op|')'
newline|'\n'
DECL|member|test_power_off_exception
name|'def'
name|'test_power_off_exception'
op|'('
name|'self'
op|','
name|'mock_soft_shutdown'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_soft_shutdown'
op|'.'
name|'return_value'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'_test_power_off'
op|'('
name|'timeout'
op|'='
number|'1'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"nova.virt.hyperv.vmops.VMOps._set_vm_state"'
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"nova.virt.hyperv.vmops.VMOps._soft_shutdown"'
op|')'
newline|'\n'
DECL|member|test_power_off_soft
name|'def'
name|'test_power_off_soft'
op|'('
name|'self'
op|','
name|'mock_soft_shutdown'
op|','
name|'mock_set_state'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
name|'fake_instance'
op|'.'
name|'fake_instance_obj'
op|'('
name|'self'
op|'.'
name|'context'
op|')'
newline|'\n'
name|'mock_soft_shutdown'
op|'.'
name|'return_value'
op|'='
name|'True'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'power_off'
op|'('
name|'instance'
op|','
number|'1'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
name|'mock_soft_shutdown'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'instance'
op|','
number|'1'
op|','
name|'vmops'
op|'.'
name|'SHUTDOWN_TIME_INCREMENT'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'mock_set_state'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_state
dedent|''
name|'def'
name|'test_get_vm_state'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'summary_info'
op|'='
op|'{'
string|"'EnabledState'"
op|':'
name|'constants'
op|'.'
name|'HYPERV_VM_STATE_DISABLED'
op|'}'
newline|'\n'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vmutils'
op|','
nl|'\n'
string|"'get_vm_summary_info'"
op|')'
name|'as'
name|'mock_get_summary_info'
op|':'
newline|'\n'
indent|'            '
name|'mock_get_summary_info'
op|'.'
name|'return_value'
op|'='
name|'summary_info'
newline|'\n'
nl|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_get_vm_state'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_VM_NAME'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|','
name|'constants'
op|'.'
name|'HYPERV_VM_STATE_DISABLED'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'VMOps'
op|','
string|"'_get_vm_state'"
op|')'
newline|'\n'
DECL|member|test_wait_for_power_off_true
name|'def'
name|'test_wait_for_power_off_true'
op|'('
name|'self'
op|','
name|'mock_get_state'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_get_state'
op|'.'
name|'return_value'
op|'='
name|'constants'
op|'.'
name|'HYPERV_VM_STATE_DISABLED'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_wait_for_power_off'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_VM_NAME'
op|','
name|'vmops'
op|'.'
name|'SHUTDOWN_TIME_INCREMENT'
op|')'
newline|'\n'
name|'mock_get_state'
op|'.'
name|'assert_called_with'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_VM_NAME'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vmops'
op|'.'
name|'etimeout'
op|','
string|'"with_timeout"'
op|')'
newline|'\n'
DECL|member|test_wait_for_power_off_false
name|'def'
name|'test_wait_for_power_off_false'
op|'('
name|'self'
op|','
name|'mock_with_timeout'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_with_timeout'
op|'.'
name|'side_effect'
op|'='
name|'etimeout'
op|'.'
name|'Timeout'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_wait_for_power_off'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_VM_NAME'
op|','
name|'vmops'
op|'.'
name|'SHUTDOWN_TIME_INCREMENT'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_copy_vm_console_logs
dedent|''
name|'def'
name|'test_copy_vm_console_logs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_local_paths'
op|'='
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_PATH'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_PATH_ARCHIVED'
op|')'
newline|'\n'
name|'fake_remote_paths'
op|'='
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_REMOTE_PATH'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_REMOTE_PATH_ARCHIVED'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'get_vm_console_log_paths'
op|'.'
name|'side_effect'
op|'='
op|'['
nl|'\n'
name|'fake_local_paths'
op|','
name|'fake_remote_paths'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'exists'
op|'.'
name|'side_effect'
op|'='
op|'['
name|'True'
op|','
name|'False'
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'copy_vm_console_logs'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_VM_NAME'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_DEST'
op|')'
newline|'\n'
nl|'\n'
name|'calls'
op|'='
op|'['
name|'mock'
op|'.'
name|'call'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_VM_NAME'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_VM_NAME'
op|','
nl|'\n'
name|'remote_server'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_DEST'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'get_vm_console_log_paths'
op|'.'
name|'assert_has_calls'
op|'('
name|'calls'
op|')'
newline|'\n'
nl|'\n'
name|'calls'
op|'='
op|'['
name|'mock'
op|'.'
name|'call'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_PATH'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_PATH_ARCHIVED'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'exists'
op|'.'
name|'assert_has_calls'
op|'('
name|'calls'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'copy'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_PATH'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'FAKE_REMOTE_PATH'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"__builtin__.open"'
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|'"os.path.exists"'
op|')'
newline|'\n'
DECL|member|test_get_console_output_exception
name|'def'
name|'test_get_console_output_exception'
op|'('
name|'self'
op|','
name|'fake_path_exists'
op|','
name|'fake_open'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_vm'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'fake_open'
op|'.'
name|'side_effect'
op|'='
name|'vmutils'
op|'.'
name|'HyperVException'
newline|'\n'
name|'fake_path_exists'
op|'.'
name|'return_value'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_pathutils'
op|'.'
name|'get_vm_console_log_paths'
op|'.'
name|'return_value'
op|'='
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_console_log_path'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_console_log_archived'
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.virt.hyperv.vmops.open'"
op|','
name|'fake_open'
op|','
name|'create'
op|'='
name|'True'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'vmutils'
op|'.'
name|'HyperVException'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'get_console_output'
op|','
nl|'\n'
name|'fake_vm'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_list_instance_uuids
dedent|''
dedent|''
name|'def'
name|'test_list_instance_uuids'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_uuid'
op|'='
string|"'4f54fb69-d3a2-45b7-bb9b-b6e6b3d893b3'"
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'_vmutils'
op|','
nl|'\n'
string|"'list_instance_notes'"
op|')'
name|'as'
name|'mock_list_notes'
op|':'
newline|'\n'
indent|'            '
name|'mock_list_notes'
op|'.'
name|'return_value'
op|'='
op|'['
op|'('
string|"'fake_name'"
op|','
op|'['
name|'fake_uuid'
op|']'
op|')'
op|']'
newline|'\n'
nl|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'_vmops'
op|'.'
name|'list_instance_uuids'
op|'('
op|')'
newline|'\n'
name|'mock_list_notes'
op|'.'
name|'assert_called_once_with'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|','
op|'['
name|'fake_uuid'
op|']'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
