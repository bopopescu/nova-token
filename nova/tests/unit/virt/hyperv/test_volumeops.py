begin_unit
comment|'# Copyright 2014 Cloudbase Solutions Srl'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'os'
newline|'\n'
nl|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'from'
name|'os_win'
name|'import'
name|'exceptions'
name|'as'
name|'os_win_exc'
newline|'\n'
name|'from'
name|'oslo_config'
name|'import'
name|'cfg'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
name|'import'
name|'fake_block_device'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
op|'.'
name|'virt'
op|'.'
name|'hyperv'
name|'import'
name|'test_base'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'hyperv'
name|'import'
name|'volumeops'
newline|'\n'
nl|'\n'
DECL|variable|CONF
name|'CONF'
op|'='
name|'cfg'
op|'.'
name|'CONF'
newline|'\n'
nl|'\n'
DECL|variable|connection_data
name|'connection_data'
op|'='
op|'{'
string|"'volume_id'"
op|':'
string|"'fake_vol_id'"
op|','
nl|'\n'
string|"'target_lun'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_lun'
op|','
nl|'\n'
string|"'target_iqn'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_iqn'
op|','
nl|'\n'
string|"'target_portal'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_portal'
op|','
nl|'\n'
string|"'auth_method'"
op|':'
string|"'chap'"
op|','
nl|'\n'
string|"'auth_username'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_user'
op|','
nl|'\n'
string|"'auth_password'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_pass'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|get_fake_block_dev_info
name|'def'
name|'get_fake_block_dev_info'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
op|'{'
string|"'block_device_mapping'"
op|':'
op|'['
nl|'\n'
name|'fake_block_device'
op|'.'
name|'AnonFakeDbBlockDeviceDict'
op|'('
op|'{'
string|"'source_type'"
op|':'
string|"'volume'"
op|'}'
op|')'
op|']'
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|get_fake_connection_info
dedent|''
name|'def'
name|'get_fake_connection_info'
op|'('
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
op|'{'
string|"'data'"
op|':'
name|'dict'
op|'('
name|'connection_data'
op|','
op|'**'
name|'kwargs'
op|')'
op|','
nl|'\n'
string|"'serial'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'serial'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VolumeOpsTestCase
dedent|''
name|'class'
name|'VolumeOpsTestCase'
op|'('
name|'test_base'
op|'.'
name|'HyperVBaseTestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Unit tests for VolumeOps class."""'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'VolumeOpsTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_volumeops'
op|'='
name|'volumeops'
op|'.'
name|'VolumeOps'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'_volutils'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'_vmutils'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_volume_driver
dedent|''
name|'def'
name|'test_get_volume_driver'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_conn_info'
op|'='
op|'{'
string|"'driver_volume_type'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_driver_type'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'volume_drivers'
op|'['
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_driver_type'
op|']'
op|'='
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_driver'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'_get_volume_driver'
op|'('
nl|'\n'
name|'connection_info'
op|'='
name|'fake_conn_info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_driver'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_volume_driver_exception
dedent|''
name|'def'
name|'test_get_volume_driver_exception'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_conn_info'
op|'='
op|'{'
string|"'driver_volume_type'"
op|':'
string|"'fake_driver'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'VolumeDriverNotFound'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'_get_volume_driver'
op|','
nl|'\n'
name|'connection_info'
op|'='
name|'fake_conn_info'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'VolumeOps'
op|','
string|"'attach_volume'"
op|')'
newline|'\n'
DECL|member|test_attach_volumes
name|'def'
name|'test_attach_volumes'
op|'('
name|'self'
op|','
name|'mock_attach_volume'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'block_device_info'
op|'='
name|'get_fake_block_dev_info'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'attach_volumes'
op|'('
name|'block_device_info'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|','
nl|'\n'
name|'ebs_root'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'mock_attach_volume'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'block_device_info'
op|'['
string|"'block_device_mapping'"
op|']'
op|'['
number|'0'
op|']'
op|'['
string|"'connection_info'"
op|']'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|','
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_fix_instance_volume_disk_paths_empty_bdm
dedent|''
name|'def'
name|'test_fix_instance_volume_disk_paths_empty_bdm'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'fix_instance_volume_disk_paths'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|','
nl|'\n'
name|'block_device_info'
op|'='
op|'{'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'_vmutils'
op|'.'
name|'get_vm_physical_disk_mapping'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'VolumeOps'
op|','
string|"'get_disk_path_mapping'"
op|')'
newline|'\n'
DECL|member|test_fix_instance_volume_disk_paths
name|'def'
name|'test_fix_instance_volume_disk_paths'
op|'('
name|'self'
op|','
name|'mock_get_disk_path_mapping'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'block_device_info'
op|'='
name|'get_fake_block_dev_info'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'mock_disk1'
op|'='
op|'{'
nl|'\n'
string|"'mounted_disk_path'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'mounted_disk1_path'
op|','
nl|'\n'
string|"'resource_path'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'resource1_path'
nl|'\n'
op|'}'
newline|'\n'
name|'mock_disk2'
op|'='
op|'{'
nl|'\n'
string|"'mounted_disk_path'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'mounted_disk2_path'
op|','
nl|'\n'
string|"'resource_path'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'resource2_path'
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
name|'mock_vm_disk_mapping'
op|'='
op|'{'
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'disk1_serial'
op|':'
name|'mock_disk1'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'disk2_serial'
op|':'
name|'mock_disk2'
nl|'\n'
op|'}'
newline|'\n'
comment|'# In this case, only the first disk needs to be updated.'
nl|'\n'
name|'mock_phys_disk_path_mapping'
op|'='
op|'{'
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'disk1_serial'
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'actual_disk1_path'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'disk2_serial'
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'mounted_disk2_path'
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
name|'vmutils'
op|'='
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'_vmutils'
newline|'\n'
name|'vmutils'
op|'.'
name|'get_vm_physical_disk_mapping'
op|'.'
name|'return_value'
op|'='
op|'('
nl|'\n'
name|'mock_vm_disk_mapping'
op|')'
newline|'\n'
nl|'\n'
name|'mock_get_disk_path_mapping'
op|'.'
name|'return_value'
op|'='
name|'mock_phys_disk_path_mapping'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'fix_instance_volume_disk_paths'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|','
nl|'\n'
name|'block_device_info'
op|')'
newline|'\n'
nl|'\n'
name|'vmutils'
op|'.'
name|'get_vm_physical_disk_mapping'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|')'
newline|'\n'
name|'mock_get_disk_path_mapping'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'block_device_info'
op|')'
newline|'\n'
name|'vmutils'
op|'.'
name|'set_disk_host_res'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'resource1_path'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'actual_disk1_path'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'VolumeOps'
op|','
string|"'_get_volume_driver'"
op|')'
newline|'\n'
DECL|member|test_disconnect_volumes
name|'def'
name|'test_disconnect_volumes'
op|'('
name|'self'
op|','
name|'mock_get_volume_driver'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'block_device_info'
op|'='
name|'get_fake_block_dev_info'
op|'('
op|')'
newline|'\n'
name|'block_device_mapping'
op|'='
name|'block_device_info'
op|'['
string|"'block_device_mapping'"
op|']'
newline|'\n'
name|'block_device_mapping'
op|'['
number|'0'
op|']'
op|'['
string|"'connection_info'"
op|']'
op|'='
op|'{'
nl|'\n'
string|"'driver_volume_type'"
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_vol_type'
op|'}'
newline|'\n'
name|'fake_volume_driver'
op|'='
name|'mock_get_volume_driver'
op|'.'
name|'return_value'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'disconnect_volumes'
op|'('
name|'block_device_info'
op|')'
newline|'\n'
name|'fake_volume_driver'
op|'.'
name|'disconnect_volumes'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'block_device_mapping'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.block_device.volume_in_mapping'"
op|')'
newline|'\n'
DECL|member|test_ebs_root_in_block_devices
name|'def'
name|'test_ebs_root_in_block_devices'
op|'('
name|'self'
op|','
name|'mock_vol_in_mapping'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'block_device_info'
op|'='
name|'get_fake_block_dev_info'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'ebs_root_in_block_devices'
op|'('
name|'block_device_info'
op|')'
newline|'\n'
nl|'\n'
name|'mock_vol_in_mapping'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'_default_root_device'
op|','
name|'block_device_info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_vol_in_mapping'
op|'.'
name|'return_value'
op|','
name|'response'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_volume_connector
dedent|''
name|'def'
name|'test_get_volume_connector'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_instance'
op|'='
name|'mock'
op|'.'
name|'DEFAULT'
newline|'\n'
name|'initiator'
op|'='
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'_volutils'
op|'.'
name|'get_iscsi_initiator'
op|'.'
name|'return_value'
newline|'\n'
name|'expected'
op|'='
op|'{'
string|"'ip'"
op|':'
name|'CONF'
op|'.'
name|'my_ip'
op|','
nl|'\n'
string|"'host'"
op|':'
name|'CONF'
op|'.'
name|'host'
op|','
nl|'\n'
string|"'initiator'"
op|':'
name|'initiator'
op|'}'
newline|'\n'
nl|'\n'
name|'response'
op|'='
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'get_volume_connector'
op|'('
name|'instance'
op|'='
name|'mock_instance'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'_volutils'
op|'.'
name|'get_iscsi_initiator'
op|'.'
name|'assert_called_once_with'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'response'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'VolumeOps'
op|','
string|"'_get_volume_driver'"
op|')'
newline|'\n'
DECL|member|test_initialize_volumes_connection
name|'def'
name|'test_initialize_volumes_connection'
op|'('
name|'self'
op|','
name|'mock_get_volume_driver'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'block_device_info'
op|'='
name|'get_fake_block_dev_info'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'initialize_volumes_connection'
op|'('
name|'block_device_info'
op|')'
newline|'\n'
nl|'\n'
name|'init_vol_conn'
op|'='
op|'('
nl|'\n'
name|'mock_get_volume_driver'
op|'.'
name|'return_value'
op|'.'
name|'initialize_volume_connection'
op|')'
newline|'\n'
name|'init_vol_conn'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'block_device_info'
op|'['
string|"'block_device_mapping'"
op|']'
op|'['
number|'0'
op|']'
op|'['
string|"'connection_info'"
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'VolumeOps'
op|','
nl|'\n'
string|"'get_mounted_disk_path_from_volume'"
op|')'
newline|'\n'
DECL|member|test_get_disk_path_mapping
name|'def'
name|'test_get_disk_path_mapping'
op|'('
name|'self'
op|','
name|'mock_get_disk_path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'block_device_info'
op|'='
name|'get_fake_block_dev_info'
op|'('
op|')'
newline|'\n'
name|'block_device_mapping'
op|'='
name|'block_device_info'
op|'['
string|"'block_device_mapping'"
op|']'
newline|'\n'
name|'fake_conn_info'
op|'='
name|'get_fake_connection_info'
op|'('
op|')'
newline|'\n'
name|'block_device_mapping'
op|'['
number|'0'
op|']'
op|'['
string|"'connection_info'"
op|']'
op|'='
name|'fake_conn_info'
newline|'\n'
nl|'\n'
name|'mock_get_disk_path'
op|'.'
name|'return_value'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'disk_path'
newline|'\n'
nl|'\n'
name|'resulted_disk_path_mapping'
op|'='
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'get_disk_path_mapping'
op|'('
nl|'\n'
name|'block_device_info'
op|')'
newline|'\n'
nl|'\n'
name|'mock_get_disk_path'
op|'.'
name|'assert_called_once_with'
op|'('
name|'fake_conn_info'
op|')'
newline|'\n'
name|'expected_disk_path_mapping'
op|'='
op|'{'
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'serial'
op|':'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'disk_path'
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_disk_path_mapping'
op|','
nl|'\n'
name|'resulted_disk_path_mapping'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_group_block_devices_by_type
dedent|''
name|'def'
name|'test_group_block_devices_by_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'block_device_map'
op|'='
name|'get_fake_block_dev_info'
op|'('
op|')'
op|'['
string|"'block_device_mapping'"
op|']'
newline|'\n'
name|'block_device_map'
op|'['
number|'0'
op|']'
op|'['
string|"'connection_info'"
op|']'
op|'='
op|'{'
nl|'\n'
string|"'driver_volume_type'"
op|':'
string|"'iscsi'"
op|'}'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'_group_block_devices_by_type'
op|'('
nl|'\n'
name|'block_device_map'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'{'
string|"'iscsi'"
op|':'
op|'['
name|'block_device_map'
op|'['
number|'0'
op|']'
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'VolumeOps'
op|','
string|"'_get_volume_driver'"
op|')'
newline|'\n'
DECL|member|test_get_mounted_disk_path_from_volume
name|'def'
name|'test_get_mounted_disk_path_from_volume'
op|'('
name|'self'
op|','
name|'mock_get_volume_driver'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_conn_info'
op|'='
name|'get_fake_connection_info'
op|'('
op|')'
newline|'\n'
name|'fake_volume_driver'
op|'='
name|'mock_get_volume_driver'
op|'.'
name|'return_value'
newline|'\n'
nl|'\n'
name|'resulted_disk_path'
op|'='
name|'self'
op|'.'
name|'_volumeops'
op|'.'
name|'get_mounted_disk_path_from_volume'
op|'('
nl|'\n'
name|'fake_conn_info'
op|')'
newline|'\n'
nl|'\n'
name|'mock_get_volume_driver'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'connection_info'
op|'='
name|'fake_conn_info'
op|')'
newline|'\n'
name|'get_mounted_disk'
op|'='
name|'fake_volume_driver'
op|'.'
name|'get_mounted_disk_path_from_volume'
newline|'\n'
name|'get_mounted_disk'
op|'.'
name|'assert_called_once_with'
op|'('
name|'fake_conn_info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'get_mounted_disk'
op|'.'
name|'return_value'
op|','
nl|'\n'
name|'resulted_disk_path'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ISCSIVolumeDriverTestCase
dedent|''
dedent|''
name|'class'
name|'ISCSIVolumeDriverTestCase'
op|'('
name|'test_base'
op|'.'
name|'HyperVBaseTestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Unit tests for Hyper-V ISCSIVolumeDriver class."""'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'ISCSIVolumeDriverTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'='
name|'volumeops'
op|'.'
name|'ISCSIVolumeDriver'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_vmutils'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_volutils'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_login_storage_target_auth_exception
dedent|''
name|'def'
name|'test_login_storage_target_auth_exception'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'connection_info'
op|'='
name|'get_fake_connection_info'
op|'('
nl|'\n'
name|'auth_method'
op|'='
string|"'fake_auth_method'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'UnsupportedBDMVolumeAuthMethod'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'login_storage_target'
op|','
nl|'\n'
name|'connection_info'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'ISCSIVolumeDriver'
op|','
nl|'\n'
string|"'_get_mounted_disk_from_lun'"
op|')'
newline|'\n'
DECL|member|_check_login_storage_target
name|'def'
name|'_check_login_storage_target'
op|'('
name|'self'
op|','
name|'mock_get_mounted_disk_from_lun'
op|','
nl|'\n'
name|'dev_number'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'connection_info'
op|'='
name|'get_fake_connection_info'
op|'('
op|')'
newline|'\n'
name|'login_target'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_volutils'
op|'.'
name|'login_storage_target'
newline|'\n'
name|'get_number'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_volutils'
op|'.'
name|'get_device_number_for_target'
newline|'\n'
name|'get_number'
op|'.'
name|'return_value'
op|'='
name|'dev_number'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'login_storage_target'
op|'('
name|'connection_info'
op|')'
newline|'\n'
nl|'\n'
name|'get_number'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_iqn'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_lun'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'dev_number'
op|':'
newline|'\n'
indent|'            '
name|'login_target'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_lun'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_iqn'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_portal'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_user'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_pass'
op|')'
newline|'\n'
name|'mock_get_mounted_disk_from_lun'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_iqn'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_lun'
op|','
name|'True'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'login_target'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_login_storage_target_already_logged
dedent|''
dedent|''
name|'def'
name|'test_login_storage_target_already_logged'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_login_storage_target'
op|'('
name|'dev_number'
op|'='
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_login_storage_target
dedent|''
name|'def'
name|'test_login_storage_target'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_login_storage_target'
op|'('
name|'dev_number'
op|'='
number|'0'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_check_logout_storage_target
dedent|''
name|'def'
name|'_check_logout_storage_target'
op|'('
name|'self'
op|','
name|'disconnected_luns_count'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_volutils'
op|'.'
name|'get_target_lun_count'
op|'.'
name|'return_value'
op|'='
number|'1'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'logout_storage_target'
op|'('
nl|'\n'
name|'target_iqn'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_iqn'
op|','
nl|'\n'
name|'disconnected_luns_count'
op|'='
name|'disconnected_luns_count'
op|')'
newline|'\n'
nl|'\n'
name|'logout_storage'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_volutils'
op|'.'
name|'logout_storage_target'
newline|'\n'
nl|'\n'
name|'if'
name|'disconnected_luns_count'
op|':'
newline|'\n'
indent|'            '
name|'logout_storage'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_iqn'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'logout_storage'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_logout_storage_target_skip
dedent|''
dedent|''
name|'def'
name|'test_logout_storage_target_skip'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_logout_storage_target'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_logout_storage_target
dedent|''
name|'def'
name|'test_logout_storage_target'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_logout_storage_target'
op|'('
name|'disconnected_luns_count'
op|'='
number|'1'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'ISCSIVolumeDriver'
op|','
nl|'\n'
string|"'_get_mounted_disk_from_lun'"
op|')'
newline|'\n'
DECL|member|test_get_mounted_disk_path_from_volume
name|'def'
name|'test_get_mounted_disk_path_from_volume'
op|'('
name|'self'
op|','
nl|'\n'
name|'mock_get_mounted_disk_from_lun'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'connection_info'
op|'='
name|'get_fake_connection_info'
op|'('
op|')'
newline|'\n'
name|'resulted_disk_path'
op|'='
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'get_mounted_disk_path_from_volume'
op|'('
nl|'\n'
name|'connection_info'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mock_get_mounted_disk_from_lun'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'connection_info'
op|'['
string|"'data'"
op|']'
op|'['
string|"'target_iqn'"
op|']'
op|','
nl|'\n'
name|'connection_info'
op|'['
string|"'data'"
op|']'
op|'['
string|"'target_lun'"
op|']'
op|','
nl|'\n'
name|'wait_for_device'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_get_mounted_disk_from_lun'
op|'.'
name|'return_value'
op|','
nl|'\n'
name|'resulted_disk_path'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'ISCSIVolumeDriver'
op|','
nl|'\n'
string|"'_get_mounted_disk_from_lun'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'ISCSIVolumeDriver'
op|','
string|"'logout_storage_target'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'ISCSIVolumeDriver'
op|','
string|"'login_storage_target'"
op|')'
newline|'\n'
DECL|member|test_attach_volume_exception
name|'def'
name|'test_attach_volume_exception'
op|'('
name|'self'
op|','
name|'mock_login_storage_target'
op|','
nl|'\n'
name|'mock_logout_storage_target'
op|','
nl|'\n'
name|'mock_get_mounted_disk'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'connection_info'
op|'='
name|'get_fake_connection_info'
op|'('
op|')'
newline|'\n'
name|'mock_get_mounted_disk'
op|'.'
name|'side_effect'
op|'='
name|'os_win_exc'
op|'.'
name|'HyperVException'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'os_win_exc'
op|'.'
name|'HyperVException'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'attach_volume'
op|','
name|'connection_info'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|')'
newline|'\n'
name|'mock_logout_storage_target'
op|'.'
name|'assert_called_with'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_iqn'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'ISCSIVolumeDriver'
op|','
nl|'\n'
string|"'_get_mounted_disk_from_lun'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'ISCSIVolumeDriver'
op|','
string|"'login_storage_target'"
op|')'
newline|'\n'
DECL|member|_check_attach_volume
name|'def'
name|'_check_attach_volume'
op|'('
name|'self'
op|','
name|'mock_login_storage_target'
op|','
nl|'\n'
name|'mock_get_mounted_disk_from_lun'
op|','
name|'ebs_root'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'connection_info'
op|'='
name|'get_fake_connection_info'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'get_ide_path'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_vmutils'
op|'.'
name|'get_vm_ide_controller'
newline|'\n'
name|'get_scsi_path'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_vmutils'
op|'.'
name|'get_vm_scsi_controller'
newline|'\n'
name|'fake_ide_path'
op|'='
name|'get_ide_path'
op|'.'
name|'return_value'
newline|'\n'
name|'fake_scsi_path'
op|'='
name|'get_scsi_path'
op|'.'
name|'return_value'
newline|'\n'
name|'fake_mounted_disk_path'
op|'='
name|'mock_get_mounted_disk_from_lun'
op|'.'
name|'return_value'
newline|'\n'
name|'attach_vol'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_vmutils'
op|'.'
name|'attach_volume_to_controller'
newline|'\n'
nl|'\n'
name|'get_free_slot'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_vmutils'
op|'.'
name|'get_free_controller_slot'
newline|'\n'
name|'get_free_slot'
op|'.'
name|'return_value'
op|'='
number|'1'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'attach_volume'
op|'('
nl|'\n'
name|'connection_info'
op|'='
name|'connection_info'
op|','
nl|'\n'
name|'instance_name'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|','
nl|'\n'
name|'ebs_root'
op|'='
name|'ebs_root'
op|')'
newline|'\n'
nl|'\n'
name|'mock_login_storage_target'
op|'.'
name|'assert_called_once_with'
op|'('
name|'connection_info'
op|')'
newline|'\n'
name|'mock_get_mounted_disk_from_lun'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_iqn'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_lun'
op|','
nl|'\n'
name|'wait_for_device'
op|'='
name|'True'
op|')'
newline|'\n'
name|'if'
name|'ebs_root'
op|':'
newline|'\n'
indent|'            '
name|'get_ide_path'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|','
number|'0'
op|')'
newline|'\n'
name|'attach_vol'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|','
nl|'\n'
name|'fake_ide_path'
op|','
number|'0'
op|','
nl|'\n'
name|'fake_mounted_disk_path'
op|','
nl|'\n'
name|'serial'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'serial'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'get_scsi_path'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|')'
newline|'\n'
name|'get_free_slot'
op|'.'
name|'assert_called_once_with'
op|'('
name|'fake_scsi_path'
op|')'
newline|'\n'
name|'attach_vol'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|','
nl|'\n'
name|'fake_scsi_path'
op|','
number|'1'
op|','
nl|'\n'
name|'fake_mounted_disk_path'
op|','
nl|'\n'
name|'serial'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'serial'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_attach_volume_ebs
dedent|''
dedent|''
name|'def'
name|'test_attach_volume_ebs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_attach_volume'
op|'('
name|'ebs_root'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_attach_volume
dedent|''
name|'def'
name|'test_attach_volume'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_attach_volume'
op|'('
name|'ebs_root'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'ISCSIVolumeDriver'
op|','
nl|'\n'
string|"'_get_mounted_disk_from_lun'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'ISCSIVolumeDriver'
op|','
string|"'logout_storage_target'"
op|')'
newline|'\n'
DECL|member|test_detach_volume
name|'def'
name|'test_detach_volume'
op|'('
name|'self'
op|','
name|'mock_logout_storage_target'
op|','
nl|'\n'
name|'mock_get_mounted_disk_from_lun'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'connection_info'
op|'='
name|'get_fake_connection_info'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'detach_volume'
op|'('
name|'connection_info'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|')'
newline|'\n'
nl|'\n'
name|'mock_get_mounted_disk_from_lun'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_iqn'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_lun'
op|','
nl|'\n'
name|'wait_for_device'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_vmutils'
op|'.'
name|'detach_vm_disk'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|','
nl|'\n'
name|'mock_get_mounted_disk_from_lun'
op|'.'
name|'return_value'
op|')'
newline|'\n'
name|'mock_logout_storage_target'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_iqn'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_mounted_disk_from_lun
dedent|''
name|'def'
name|'test_get_mounted_disk_from_lun'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'test'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_volutils'
op|','
nl|'\n'
string|"'get_device_number_for_target'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_vmutils'
op|','
nl|'\n'
string|"'get_mounted_disk_by_drive_number'"
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'mock_get_device_number_for_target'
op|','
nl|'\n'
name|'mock_get_mounted_disk_by_drive_number'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'            '
name|'mock_get_device_number_for_target'
op|'.'
name|'return_value'
op|'='
number|'0'
newline|'\n'
name|'mock_get_mounted_disk_by_drive_number'
op|'.'
name|'return_value'
op|'='
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'disk_path'
op|')'
newline|'\n'
nl|'\n'
name|'disk'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_get_mounted_disk_from_lun'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'target_iqn'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'target_lun'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'disk_path'
op|','
name|'disk'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_target_from_disk_path
dedent|''
dedent|''
name|'def'
name|'test_get_target_from_disk_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'result'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'get_target_from_disk_path'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'physical_drive_path'
op|')'
newline|'\n'
nl|'\n'
name|'mock_get_target'
op|'='
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_volutils'
op|'.'
name|'get_target_from_disk_path'
op|')'
newline|'\n'
name|'mock_get_target'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'physical_drive_path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_get_target'
op|'.'
name|'return_value'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'time.sleep'"
op|')'
newline|'\n'
DECL|member|test_get_mounted_disk_from_lun_failure
name|'def'
name|'test_get_mounted_disk_from_lun_failure'
op|'('
name|'self'
op|','
name|'fake_sleep'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'mounted_disk_query_retry_count'
op|'='
number|'1'
op|','
name|'group'
op|'='
string|"'hyperv'"
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_volutils'
op|','
nl|'\n'
string|"'get_device_number_for_target'"
op|')'
name|'as'
name|'m_device_num'
op|':'
newline|'\n'
indent|'            '
name|'m_device_num'
op|'.'
name|'side_effect'
op|'='
op|'['
name|'None'
op|','
op|'-'
number|'1'
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NotFound'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_get_mounted_disk_from_lun'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'target_iqn'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'target_lun'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'ISCSIVolumeDriver'
op|','
string|"'logout_storage_target'"
op|')'
newline|'\n'
DECL|member|test_disconnect_volumes
name|'def'
name|'test_disconnect_volumes'
op|'('
name|'self'
op|','
name|'mock_logout_storage_target'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'block_device_info'
op|'='
name|'get_fake_block_dev_info'
op|'('
op|')'
newline|'\n'
name|'connection_info'
op|'='
name|'get_fake_connection_info'
op|'('
op|')'
newline|'\n'
name|'block_device_mapping'
op|'='
name|'block_device_info'
op|'['
string|"'block_device_mapping'"
op|']'
newline|'\n'
name|'block_device_mapping'
op|'['
number|'0'
op|']'
op|'['
string|"'connection_info'"
op|']'
op|'='
name|'connection_info'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'disconnect_volumes'
op|'('
name|'block_device_mapping'
op|')'
newline|'\n'
nl|'\n'
name|'mock_logout_storage_target'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'fake_iqn'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_target_lun_count
dedent|''
name|'def'
name|'test_get_target_lun_count'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'result'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'get_target_lun_count'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'target_iqn'
op|')'
newline|'\n'
nl|'\n'
name|'mock_get_lun_count'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_volutils'
op|'.'
name|'get_target_lun_count'
newline|'\n'
name|'mock_get_lun_count'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'target_iqn'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_get_lun_count'
op|'.'
name|'return_value'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'ISCSIVolumeDriver'
op|','
string|"'login_storage_target'"
op|')'
newline|'\n'
DECL|member|test_initialize_volume_connection
name|'def'
name|'test_initialize_volume_connection'
op|'('
name|'self'
op|','
name|'mock_login_storage_target'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'initialize_volume_connection'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'connection_info'
op|')'
newline|'\n'
name|'mock_login_storage_target'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'connection_info'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SMBFSVolumeDriverTestCase
dedent|''
dedent|''
name|'class'
name|'SMBFSVolumeDriverTestCase'
op|'('
name|'test_base'
op|'.'
name|'HyperVBaseTestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Unit tests for the Hyper-V SMBFSVolumeDriver class."""'
newline|'\n'
nl|'\n'
DECL|variable|_FAKE_SHARE
name|'_FAKE_SHARE'
op|'='
string|"'//1.2.3.4/fake_share'"
newline|'\n'
DECL|variable|_FAKE_SHARE_NORMALIZED
name|'_FAKE_SHARE_NORMALIZED'
op|'='
name|'_FAKE_SHARE'
op|'.'
name|'replace'
op|'('
string|"'/'"
op|','
string|"'\\\\'"
op|')'
newline|'\n'
DECL|variable|_FAKE_DISK_NAME
name|'_FAKE_DISK_NAME'
op|'='
string|"'fake_volume_name.vhdx'"
newline|'\n'
DECL|variable|_FAKE_USERNAME
name|'_FAKE_USERNAME'
op|'='
string|"'fake_username'"
newline|'\n'
DECL|variable|_FAKE_PASSWORD
name|'_FAKE_PASSWORD'
op|'='
string|"'fake_password'"
newline|'\n'
name|'_FAKE_SMB_OPTIONS'
op|'='
string|"'-o username=%s,password=%s'"
op|'%'
op|'('
name|'_FAKE_USERNAME'
op|','
nl|'\n'
name|'_FAKE_PASSWORD'
op|')'
newline|'\n'
DECL|variable|_FAKE_CONNECTION_INFO
name|'_FAKE_CONNECTION_INFO'
op|'='
op|'{'
string|"'data'"
op|':'
op|'{'
string|"'export'"
op|':'
name|'_FAKE_SHARE'
op|','
nl|'\n'
string|"'name'"
op|':'
name|'_FAKE_DISK_NAME'
op|','
nl|'\n'
string|"'options'"
op|':'
name|'_FAKE_SMB_OPTIONS'
op|','
nl|'\n'
string|"'volume_id'"
op|':'
string|"'fake_vol_id'"
op|'}'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'SMBFSVolumeDriverTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'='
name|'volumeops'
op|'.'
name|'SMBFSVolumeDriver'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_vmutils'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_smbutils'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_volutils'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'SMBFSVolumeDriver'
op|','
nl|'\n'
string|"'_get_disk_path'"
op|')'
newline|'\n'
DECL|member|test_get_mounted_disk_path_from_volume
name|'def'
name|'test_get_mounted_disk_path_from_volume'
op|'('
name|'self'
op|','
name|'mock_get_disk_path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'disk_path'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'get_mounted_disk_path_from_volume'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'conn_info'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'mock_get_disk_path'
op|'.'
name|'return_value'
op|','
name|'disk_path'
op|')'
newline|'\n'
name|'mock_get_disk_path'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'conn_info'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'SMBFSVolumeDriver'
op|','
string|"'ensure_share_mounted'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'SMBFSVolumeDriver'
op|','
string|"'_get_disk_path'"
op|')'
newline|'\n'
DECL|member|_check_attach_volume
name|'def'
name|'_check_attach_volume'
op|'('
name|'self'
op|','
name|'mock_get_disk_path'
op|','
nl|'\n'
name|'mock_ensure_share_mounted'
op|','
name|'ebs_root'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_get_disk_path'
op|'.'
name|'return_value'
op|'='
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'disk_path'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'attach_volume'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_CONNECTION_INFO'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|','
nl|'\n'
name|'ebs_root'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'ebs_root'
op|':'
newline|'\n'
indent|'            '
name|'get_vm_ide_controller'
op|'='
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_vmutils'
op|'.'
name|'get_vm_ide_controller'
op|')'
newline|'\n'
name|'get_vm_ide_controller'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|','
number|'0'
op|')'
newline|'\n'
name|'ctrller_path'
op|'='
name|'get_vm_ide_controller'
op|'.'
name|'return_value'
newline|'\n'
name|'slot'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'get_vm_scsi_controller'
op|'='
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_vmutils'
op|'.'
name|'get_vm_scsi_controller'
op|')'
newline|'\n'
name|'get_vm_scsi_controller'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|')'
newline|'\n'
name|'get_free_controller_slot'
op|'='
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_vmutils'
op|'.'
name|'get_free_controller_slot'
op|')'
newline|'\n'
name|'get_free_controller_slot'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'get_vm_scsi_controller'
op|'.'
name|'return_value'
op|')'
newline|'\n'
nl|'\n'
name|'ctrller_path'
op|'='
name|'get_vm_scsi_controller'
op|'.'
name|'return_value'
newline|'\n'
name|'slot'
op|'='
name|'get_free_controller_slot'
op|'.'
name|'return_value'
newline|'\n'
nl|'\n'
dedent|''
name|'mock_ensure_share_mounted'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_CONNECTION_INFO'
op|')'
newline|'\n'
name|'mock_get_disk_path'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'_FAKE_CONNECTION_INFO'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_vmutils'
op|'.'
name|'attach_drive'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'disk_path'
op|','
nl|'\n'
name|'ctrller_path'
op|','
name|'slot'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_attach_volume_ide
dedent|''
name|'def'
name|'test_attach_volume_ide'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_attach_volume'
op|'('
name|'ebs_root'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_attach_volume_scsi
dedent|''
name|'def'
name|'test_attach_volume_scsi'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_attach_volume'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'SMBFSVolumeDriver'
op|','
string|"'ensure_share_mounted'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'SMBFSVolumeDriver'
op|','
string|"'_get_disk_path'"
op|')'
newline|'\n'
DECL|member|test_attach_non_existing_image
name|'def'
name|'test_attach_non_existing_image'
op|'('
name|'self'
op|','
name|'mock_get_disk_path'
op|','
nl|'\n'
name|'mock_ensure_share_mounted'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_vmutils'
op|'.'
name|'attach_drive'
op|'.'
name|'side_effect'
op|'='
op|'('
nl|'\n'
name|'os_win_exc'
op|'.'
name|'HyperVException'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'VolumeAttachFailed'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'attach_volume'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_CONNECTION_INFO'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'SMBFSVolumeDriver'
op|','
string|"'_get_disk_path'"
op|')'
newline|'\n'
DECL|member|test_detach_volume
name|'def'
name|'test_detach_volume'
op|'('
name|'self'
op|','
name|'mock_get_disk_path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_get_disk_path'
op|'.'
name|'return_value'
op|'='
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'disk_path'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'detach_volume'
op|'('
name|'self'
op|'.'
name|'_FAKE_CONNECTION_INFO'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_vmutils'
op|'.'
name|'detach_vm_disk'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'instance_name'
op|','
name|'mock'
op|'.'
name|'sentinel'
op|'.'
name|'disk_path'
op|','
nl|'\n'
name|'is_physical'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_parse_credentials
dedent|''
name|'def'
name|'test_parse_credentials'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'username'
op|','
name|'password'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_parse_credentials'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_SMB_OPTIONS'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_FAKE_USERNAME'
op|','
name|'username'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_FAKE_PASSWORD'
op|','
name|'password'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_export_path
dedent|''
name|'def'
name|'test_get_export_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'result'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_get_export_path'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_CONNECTION_INFO'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
name|'self'
op|'.'
name|'_FAKE_SHARE'
op|'.'
name|'replace'
op|'('
string|"'/'"
op|','
string|"'\\\\'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_disk_path
dedent|''
name|'def'
name|'test_get_disk_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expected'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'_FAKE_SHARE_NORMALIZED'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_DISK_NAME'
op|')'
newline|'\n'
nl|'\n'
name|'disk_path'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_get_disk_path'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_CONNECTION_INFO'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'disk_path'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'volumeops'
op|'.'
name|'SMBFSVolumeDriver'
op|','
string|"'_parse_credentials'"
op|')'
newline|'\n'
DECL|member|_test_ensure_mounted
name|'def'
name|'_test_ensure_mounted'
op|'('
name|'self'
op|','
name|'mock_parse_credentials'
op|','
name|'is_mounted'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_mount_smb_share'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_smbutils'
op|'.'
name|'mount_smb_share'
newline|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_smbutils'
op|'.'
name|'check_smb_mapping'
op|'.'
name|'return_value'
op|'='
op|'('
nl|'\n'
name|'is_mounted'
op|')'
newline|'\n'
name|'mock_parse_credentials'
op|'.'
name|'return_value'
op|'='
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_USERNAME'
op|','
name|'self'
op|'.'
name|'_FAKE_PASSWORD'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'ensure_share_mounted'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_CONNECTION_INFO'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'is_mounted'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertFalse'
op|'('
nl|'\n'
name|'mock_mount_smb_share'
op|'.'
name|'called'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'mock_mount_smb_share'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_SHARE_NORMALIZED'
op|','
nl|'\n'
name|'username'
op|'='
name|'self'
op|'.'
name|'_FAKE_USERNAME'
op|','
nl|'\n'
name|'password'
op|'='
name|'self'
op|'.'
name|'_FAKE_PASSWORD'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_ensure_mounted_new_share
dedent|''
dedent|''
name|'def'
name|'test_ensure_mounted_new_share'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_ensure_mounted'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_ensure_already_mounted
dedent|''
name|'def'
name|'test_ensure_already_mounted'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_ensure_mounted'
op|'('
name|'is_mounted'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_disconnect_volumes
dedent|''
name|'def'
name|'test_disconnect_volumes'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'block_device_mapping'
op|'='
op|'['
nl|'\n'
op|'{'
string|"'connection_info'"
op|':'
name|'self'
op|'.'
name|'_FAKE_CONNECTION_INFO'
op|'}'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'disconnect_volumes'
op|'('
name|'block_device_mapping'
op|')'
newline|'\n'
name|'mock_unmount_share'
op|'='
name|'self'
op|'.'
name|'_volume_driver'
op|'.'
name|'_smbutils'
op|'.'
name|'unmount_smb_share'
newline|'\n'
name|'mock_unmount_share'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_SHARE_NORMALIZED'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
