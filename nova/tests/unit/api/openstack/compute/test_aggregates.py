begin_unit
comment|'# Copyright (c) 2012 Citrix Systems, Inc.'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
string|'"""Tests for the aggregates admin api."""'
newline|'\n'
nl|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'from'
name|'webob'
name|'import'
name|'exc'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
op|'.'
name|'api'
op|'.'
name|'openstack'
op|'.'
name|'compute'
name|'import'
name|'aggregates'
name|'as'
name|'aggregates_v21'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'api'
op|'.'
name|'openstack'
op|'.'
name|'compute'
op|'.'
name|'legacy_v2'
op|'.'
name|'contrib'
name|'import'
name|'aggregates'
name|'as'
name|'aggregates_v2'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'compute'
name|'import'
name|'api'
name|'as'
name|'compute_api'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'context'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'objects'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
op|'.'
name|'api'
op|'.'
name|'openstack'
name|'import'
name|'fakes'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
name|'import'
name|'matchers'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_make_agg_obj
name|'def'
name|'_make_agg_obj'
op|'('
name|'agg_dict'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'objects'
op|'.'
name|'Aggregate'
op|'('
op|'**'
name|'agg_dict'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_make_agg_list
dedent|''
name|'def'
name|'_make_agg_list'
op|'('
name|'agg_list'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'objects'
op|'.'
name|'AggregateList'
op|'('
name|'objects'
op|'='
op|'['
name|'_make_agg_obj'
op|'('
name|'a'
op|')'
name|'for'
name|'a'
name|'in'
name|'agg_list'
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_transform_aggregate_az
dedent|''
name|'def'
name|'_transform_aggregate_az'
op|'('
name|'agg_dict'
op|')'
op|':'
newline|'\n'
comment|'# the Aggregate object looks for availability_zone within metadata,'
nl|'\n'
comment|'# so if availability_zone is in the top-level dict, move it down into'
nl|'\n'
comment|'# metadata. We also have to delete the key from the top-level dict because'
nl|'\n'
comment|'# availability_zone is a read-only property on the Aggregate object'
nl|'\n'
indent|'    '
name|'md'
op|'='
name|'agg_dict'
op|'.'
name|'get'
op|'('
string|"'metadata'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
name|'if'
string|"'availability_zone'"
name|'in'
name|'agg_dict'
op|':'
newline|'\n'
indent|'        '
name|'md'
op|'['
string|"'availability_zone'"
op|']'
op|'='
name|'agg_dict'
op|'['
string|"'availability_zone'"
op|']'
newline|'\n'
name|'del'
name|'agg_dict'
op|'['
string|"'availability_zone'"
op|']'
newline|'\n'
name|'agg_dict'
op|'['
string|"'metadata'"
op|']'
op|'='
name|'md'
newline|'\n'
dedent|''
name|'return'
name|'agg_dict'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_transform_aggregate_list_azs
dedent|''
name|'def'
name|'_transform_aggregate_list_azs'
op|'('
name|'agg_list'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'for'
name|'agg_dict'
name|'in'
name|'agg_list'
op|':'
newline|'\n'
indent|'        '
name|'yield'
name|'_transform_aggregate_az'
op|'('
name|'agg_dict'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|AGGREGATE_LIST
dedent|''
dedent|''
name|'AGGREGATE_LIST'
op|'='
op|'['
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"aggregate1"'
op|','
string|'"id"'
op|':'
string|'"1"'
op|','
nl|'\n'
string|'"metadata"'
op|':'
op|'{'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
op|','
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"aggregate2"'
op|','
string|'"id"'
op|':'
string|'"2"'
op|','
nl|'\n'
string|'"metadata"'
op|':'
op|'{'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
op|','
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"aggregate3"'
op|','
string|'"id"'
op|':'
string|'"3"'
op|','
nl|'\n'
string|'"metadata"'
op|':'
op|'{'
string|'"availability_zone"'
op|':'
string|'"nova2"'
op|'}'
op|'}'
op|','
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"aggregate1"'
op|','
string|'"id"'
op|':'
string|'"4"'
op|','
nl|'\n'
string|'"metadata"'
op|':'
op|'{'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
op|']'
newline|'\n'
DECL|variable|AGGREGATE_LIST
name|'AGGREGATE_LIST'
op|'='
name|'_make_agg_list'
op|'('
name|'AGGREGATE_LIST'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|AGGREGATE
name|'AGGREGATE'
op|'='
op|'{'
string|'"name"'
op|':'
string|'"aggregate1"'
op|','
nl|'\n'
string|'"id"'
op|':'
string|'"1"'
op|','
nl|'\n'
string|'"metadata"'
op|':'
op|'{'
string|'"foo"'
op|':'
string|'"bar"'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|','
nl|'\n'
string|'"hosts"'
op|':'
op|'['
string|'"host1"'
op|','
string|'"host2"'
op|']'
op|'}'
newline|'\n'
DECL|variable|AGGREGATE
name|'AGGREGATE'
op|'='
name|'_make_agg_obj'
op|'('
name|'AGGREGATE'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|FORMATTED_AGGREGATE
name|'FORMATTED_AGGREGATE'
op|'='
op|'{'
string|'"name"'
op|':'
string|'"aggregate1"'
op|','
nl|'\n'
string|'"id"'
op|':'
string|'"1"'
op|','
nl|'\n'
string|'"metadata"'
op|':'
op|'{'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
newline|'\n'
DECL|variable|FORMATTED_AGGREGATE
name|'FORMATTED_AGGREGATE'
op|'='
name|'_make_agg_obj'
op|'('
name|'FORMATTED_AGGREGATE'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeRequest
name|'class'
name|'FakeRequest'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|variable|environ
indent|'    '
name|'environ'
op|'='
op|'{'
string|'"nova.context"'
op|':'
name|'context'
op|'.'
name|'get_admin_context'
op|'('
op|')'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|AggregateTestCaseV21
dedent|''
name|'class'
name|'AggregateTestCaseV21'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Test Case for aggregates admin api."""'
newline|'\n'
nl|'\n'
DECL|variable|add_host
name|'add_host'
op|'='
string|"'self.controller._add_host'"
newline|'\n'
DECL|variable|remove_host
name|'remove_host'
op|'='
string|"'self.controller._remove_host'"
newline|'\n'
DECL|variable|set_metadata
name|'set_metadata'
op|'='
string|"'self.controller._set_metadata'"
newline|'\n'
DECL|variable|bad_request
name|'bad_request'
op|'='
name|'exception'
op|'.'
name|'ValidationError'
newline|'\n'
nl|'\n'
DECL|member|_set_up
name|'def'
name|'_set_up'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'controller'
op|'='
name|'aggregates_v21'
op|'.'
name|'AggregateController'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
string|"'/v2/os-aggregates'"
op|','
nl|'\n'
name|'use_admin_context'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'user_req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
string|"'/v2/os-aggregates'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'self'
op|'.'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'nova.context'"
op|']'
newline|'\n'
nl|'\n'
DECL|member|setUp
dedent|''
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'AggregateTestCaseV21'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_set_up'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_index
dedent|''
name|'def'
name|'test_index'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_list_aggregates
indent|'        '
name|'def'
name|'stub_list_aggregates'
op|'('
name|'context'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'context'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'Exception'
op|'('
op|')'
newline|'\n'
dedent|''
name|'return'
name|'AGGREGATE_LIST'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|"'get_aggregate_list'"
op|','
nl|'\n'
name|'stub_list_aggregates'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'index'
op|'('
name|'self'
op|'.'
name|'req'
op|')'
newline|'\n'
name|'result'
op|'='
name|'_transform_aggregate_list_azs'
op|'('
name|'result'
op|'['
string|"'aggregates'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_agg_data'
op|'('
name|'AGGREGATE_LIST'
op|','
name|'_make_agg_list'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_index_no_admin
dedent|''
name|'def'
name|'test_index_no_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
nl|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'index'
op|','
nl|'\n'
name|'self'
op|'.'
name|'user_req'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create
dedent|''
name|'def'
name|'test_create'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_create_aggregate
indent|'        '
name|'def'
name|'stub_create_aggregate'
op|'('
name|'context'
op|','
name|'name'
op|','
name|'availability_zone'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'context'
op|','
name|'self'
op|'.'
name|'context'
op|','
string|'"context"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"test"'
op|','
name|'name'
op|','
string|'"name"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"nova1"'
op|','
name|'availability_zone'
op|','
string|'"availability_zone"'
op|')'
newline|'\n'
name|'return'
name|'AGGREGATE'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"create_aggregate"'
op|','
nl|'\n'
name|'stub_create_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|'('
name|'self'
op|'.'
name|'req'
op|','
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"test"'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
op|')'
newline|'\n'
name|'result'
op|'='
name|'_transform_aggregate_az'
op|'('
name|'result'
op|'['
string|"'aggregate'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_agg_data'
op|'('
name|'FORMATTED_AGGREGATE'
op|','
name|'_make_agg_obj'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_no_admin
dedent|''
name|'def'
name|'test_create_no_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
nl|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
name|'self'
op|'.'
name|'user_req'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"test"'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_with_duplicate_aggregate_name
dedent|''
name|'def'
name|'test_create_with_duplicate_aggregate_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_create_aggregate
indent|'        '
name|'def'
name|'stub_create_aggregate'
op|'('
name|'context'
op|','
name|'name'
op|','
name|'availability_zone'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'AggregateNameExists'
op|'('
name|'aggregate_name'
op|'='
name|'name'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"create_aggregate"'
op|','
nl|'\n'
name|'stub_create_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPConflict'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"test"'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_with_incorrect_availability_zone
dedent|''
name|'def'
name|'test_create_with_incorrect_availability_zone'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_create_aggregate
indent|'        '
name|'def'
name|'stub_create_aggregate'
op|'('
name|'context'
op|','
name|'name'
op|','
name|'availability_zone'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'InvalidAggregateAction'
op|'('
name|'action'
op|'='
string|"'create_aggregate'"
op|','
nl|'\n'
name|'aggregate_id'
op|'='
string|'"\'N/A\'"'
op|','
nl|'\n'
name|'reason'
op|'='
string|"'invalid zone'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"create_aggregate"'
op|','
nl|'\n'
name|'stub_create_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
nl|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"test"'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"nova_bad"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_with_no_aggregate
dedent|''
name|'def'
name|'test_create_with_no_aggregate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
name|'body'
op|'='
op|'{'
string|'"foo"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"test"'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_with_no_name
dedent|''
name|'def'
name|'test_create_with_no_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"foo"'
op|':'
string|'"test"'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_name_with_leading_trailing_spaces
dedent|''
name|'def'
name|'test_create_name_with_leading_trailing_spaces'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"  test  "'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_name_with_leading_trailing_spaces_compat_mode
dedent|''
name|'def'
name|'test_create_name_with_leading_trailing_spaces_compat_mode'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_mock_aggs
indent|'        '
name|'def'
name|'fake_mock_aggs'
op|'('
name|'context'
op|','
name|'name'
op|','
name|'az'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'test'"
op|','
name|'name'
op|')'
newline|'\n'
name|'return'
name|'AGGREGATE'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'compute_api'
op|'.'
name|'AggregateAPI'
op|','
nl|'\n'
string|"'create_aggregate'"
op|')'
name|'as'
name|'mock_aggs'
op|':'
newline|'\n'
indent|'            '
name|'mock_aggs'
op|'.'
name|'side_effect'
op|'='
name|'fake_mock_aggs'
newline|'\n'
name|'self'
op|'.'
name|'req'
op|'.'
name|'set_legacy_v2'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|'('
name|'self'
op|'.'
name|'req'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"  test  "'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_with_no_availability_zone
dedent|''
dedent|''
name|'def'
name|'test_create_with_no_availability_zone'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_create_aggregate
indent|'        '
name|'def'
name|'stub_create_aggregate'
op|'('
name|'context'
op|','
name|'name'
op|','
name|'availability_zone'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'context'
op|','
name|'self'
op|'.'
name|'context'
op|','
string|'"context"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"test"'
op|','
name|'name'
op|','
string|'"name"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'availability_zone'
op|','
string|'"availability_zone"'
op|')'
newline|'\n'
name|'return'
name|'AGGREGATE'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"create_aggregate"'
op|','
nl|'\n'
name|'stub_create_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|'('
name|'self'
op|'.'
name|'req'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
op|'{'
string|'"name"'
op|':'
string|'"test"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'_transform_aggregate_az'
op|'('
name|'result'
op|'['
string|"'aggregate'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_agg_data'
op|'('
name|'FORMATTED_AGGREGATE'
op|','
name|'_make_agg_obj'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_with_null_name
dedent|''
name|'def'
name|'test_create_with_null_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'""'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_with_name_too_long
dedent|''
name|'def'
name|'test_create_with_name_too_long'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"x"'
op|'*'
number|'256'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_with_availability_zone_too_long
dedent|''
name|'def'
name|'test_create_with_availability_zone_too_long'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"test"'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"x"'
op|'*'
number|'256'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_availability_zone_with_leading_trailing_spaces
dedent|''
name|'def'
name|'test_create_availability_zone_with_leading_trailing_spaces'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"test"'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"  nova1  "'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_availabiltiy_zone_with_leading_trailing_spaces_compat_mode
dedent|''
name|'def'
name|'test_create_availabiltiy_zone_with_leading_trailing_spaces_compat_mode'
op|'('
nl|'\n'
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_mock_aggs
indent|'        '
name|'def'
name|'fake_mock_aggs'
op|'('
name|'context'
op|','
name|'name'
op|','
name|'az'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'nova1'"
op|','
name|'az'
op|')'
newline|'\n'
name|'return'
name|'AGGREGATE'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'compute_api'
op|'.'
name|'AggregateAPI'
op|','
nl|'\n'
string|"'create_aggregate'"
op|')'
name|'as'
name|'mock_aggs'
op|':'
newline|'\n'
indent|'            '
name|'mock_aggs'
op|'.'
name|'side_effect'
op|'='
name|'fake_mock_aggs'
newline|'\n'
name|'self'
op|'.'
name|'req'
op|'.'
name|'set_legacy_v2'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|'('
name|'self'
op|'.'
name|'req'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"test"'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"  nova1  "'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_with_empty_availability_zone
dedent|''
dedent|''
name|'def'
name|'test_create_with_empty_availability_zone'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"test"'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'""'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_with_extra_invalid_arg
dedent|''
name|'def'
name|'test_create_with_extra_invalid_arg'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
name|'body'
op|'='
op|'{'
string|'"name"'
op|':'
string|'"test"'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|','
nl|'\n'
string|'"foo"'
op|':'
string|"'bar'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_show
dedent|''
name|'def'
name|'test_show'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_get_aggregate
indent|'        '
name|'def'
name|'stub_get_aggregate'
op|'('
name|'context'
op|','
name|'id'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'context'
op|','
name|'self'
op|'.'
name|'context'
op|','
string|'"context"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"1"'
op|','
name|'id'
op|','
string|'"id"'
op|')'
newline|'\n'
name|'return'
name|'AGGREGATE'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|"'get_aggregate'"
op|','
nl|'\n'
name|'stub_get_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'aggregate'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'show'
op|'('
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|')'
newline|'\n'
name|'aggregate'
op|'='
name|'_transform_aggregate_az'
op|'('
name|'aggregate'
op|'['
string|"'aggregate'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_agg_data'
op|'('
name|'AGGREGATE'
op|','
name|'_make_agg_obj'
op|'('
name|'aggregate'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_show_no_admin
dedent|''
name|'def'
name|'test_show_no_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
nl|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'show'
op|','
nl|'\n'
name|'self'
op|'.'
name|'user_req'
op|','
string|'"1"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_show_with_invalid_id
dedent|''
name|'def'
name|'test_show_with_invalid_id'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_get_aggregate
indent|'        '
name|'def'
name|'stub_get_aggregate'
op|'('
name|'context'
op|','
name|'id'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'AggregateNotFound'
op|'('
name|'aggregate_id'
op|'='
number|'2'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|"'get_aggregate'"
op|','
nl|'\n'
name|'stub_get_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPNotFound'
op|','
nl|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'show'
op|','
name|'self'
op|'.'
name|'req'
op|','
string|'"2"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update
dedent|''
name|'def'
name|'test_update'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
op|'{'
string|'"name"'
op|':'
string|'"new_name"'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|stub_update_aggregate
name|'def'
name|'stub_update_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'values'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'context'
op|','
name|'self'
op|'.'
name|'context'
op|','
string|'"context"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"1"'
op|','
name|'aggregate'
op|','
string|'"aggregate"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'body'
op|'['
string|'"aggregate"'
op|']'
op|','
name|'values'
op|','
string|'"values"'
op|')'
newline|'\n'
name|'return'
name|'AGGREGATE'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"update_aggregate"'
op|','
nl|'\n'
name|'stub_update_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'update'
op|'('
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'_transform_aggregate_az'
op|'('
name|'result'
op|'['
string|"'aggregate'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_agg_data'
op|'('
name|'AGGREGATE'
op|','
name|'_make_agg_obj'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update_no_admin
dedent|''
name|'def'
name|'test_update_no_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
op|'{'
string|'"availability_zone"'
op|':'
string|'"nova"'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
nl|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'update'
op|','
nl|'\n'
name|'self'
op|'.'
name|'user_req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update_with_only_name
dedent|''
name|'def'
name|'test_update_with_only_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
op|'{'
string|'"name"'
op|':'
string|'"new_name"'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|stub_update_aggregate
name|'def'
name|'stub_update_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'values'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'AGGREGATE'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"update_aggregate"'
op|','
nl|'\n'
name|'stub_update_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'update'
op|'('
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'_transform_aggregate_az'
op|'('
name|'result'
op|'['
string|"'aggregate'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_agg_data'
op|'('
name|'AGGREGATE'
op|','
name|'_make_agg_obj'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update_with_only_availability_zone
dedent|''
name|'def'
name|'test_update_with_only_availability_zone'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
op|'{'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|stub_update_aggregate
name|'def'
name|'stub_update_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'values'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'AGGREGATE'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"update_aggregate"'
op|','
nl|'\n'
name|'stub_update_aggregate'
op|')'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'update'
op|'('
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'_transform_aggregate_az'
op|'('
name|'result'
op|'['
string|"'aggregate'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_agg_data'
op|'('
name|'AGGREGATE'
op|','
name|'_make_agg_obj'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update_with_no_updates
dedent|''
name|'def'
name|'test_update_with_no_updates'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_metadata'
op|'='
op|'{'
string|'"aggregate"'
op|':'
op|'{'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'update'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"2"'
op|','
name|'body'
op|'='
name|'test_metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update_with_no_update_key
dedent|''
name|'def'
name|'test_update_with_no_update_key'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_metadata'
op|'='
op|'{'
string|'"asdf"'
op|':'
op|'{'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'update'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"2"'
op|','
name|'body'
op|'='
name|'test_metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update_with_wrong_updates
dedent|''
name|'def'
name|'test_update_with_wrong_updates'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_metadata'
op|'='
op|'{'
string|'"aggregate"'
op|':'
op|'{'
string|'"status"'
op|':'
string|'"disable"'
op|','
nl|'\n'
string|'"foo"'
op|':'
string|'"bar"'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'update'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"2"'
op|','
name|'body'
op|'='
name|'test_metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update_with_null_name
dedent|''
name|'def'
name|'test_update_with_null_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_metadata'
op|'='
op|'{'
string|'"aggregate"'
op|':'
op|'{'
string|'"name"'
op|':'
string|'""'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'update'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"2"'
op|','
name|'body'
op|'='
name|'test_metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update_with_name_too_long
dedent|''
name|'def'
name|'test_update_with_name_too_long'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_metadata'
op|'='
op|'{'
string|'"aggregate"'
op|':'
op|'{'
string|'"name"'
op|':'
string|'"x"'
op|'*'
number|'256'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'update'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"2"'
op|','
name|'body'
op|'='
name|'test_metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update_with_availability_zone_too_long
dedent|''
name|'def'
name|'test_update_with_availability_zone_too_long'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_metadata'
op|'='
op|'{'
string|'"aggregate"'
op|':'
op|'{'
string|'"availability_zone"'
op|':'
string|'"x"'
op|'*'
number|'256'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'update'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"2"'
op|','
name|'body'
op|'='
name|'test_metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update_with_empty_availability_zone
dedent|''
name|'def'
name|'test_update_with_empty_availability_zone'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_metadata'
op|'='
op|'{'
string|'"aggregate"'
op|':'
op|'{'
string|'"availability_zone"'
op|':'
string|'""'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'update'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"2"'
op|','
name|'body'
op|'='
name|'test_metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update_with_bad_aggregate
dedent|''
name|'def'
name|'test_update_with_bad_aggregate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_metadata'
op|'='
op|'{'
string|'"aggregate"'
op|':'
op|'{'
string|'"name"'
op|':'
string|'"test_name"'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|stub_update_aggregate
name|'def'
name|'stub_update_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'metadata'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'AggregateNotFound'
op|'('
name|'aggregate_id'
op|'='
number|'2'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"update_aggregate"'
op|','
nl|'\n'
name|'stub_update_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPNotFound'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'update'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"2"'
op|','
name|'body'
op|'='
name|'test_metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update_with_duplicated_name
dedent|''
name|'def'
name|'test_update_with_duplicated_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'test_metadata'
op|'='
op|'{'
string|'"aggregate"'
op|':'
op|'{'
string|'"name"'
op|':'
string|'"test_name"'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|stub_update_aggregate
name|'def'
name|'stub_update_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'metadata'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'AggregateNameExists'
op|'('
name|'aggregate_name'
op|'='
string|'"test_name"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"update_aggregate"'
op|','
nl|'\n'
name|'stub_update_aggregate'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPConflict'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'update'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"2"'
op|','
name|'body'
op|'='
name|'test_metadata'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_invalid_action
dedent|''
name|'def'
name|'test_invalid_action'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"append_host"'
op|':'
op|'{'
string|'"host"'
op|':'
string|'"host1"'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
nl|'\n'
name|'eval'
op|'('
name|'self'
op|'.'
name|'add_host'
op|')'
op|','
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_update_with_invalid_action
dedent|''
name|'def'
name|'test_update_with_invalid_action'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"update_aggregate"'
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'exception'
op|'.'
name|'InvalidAggregateAction'
op|'('
nl|'\n'
name|'action'
op|'='
string|"'invalid'"
op|','
name|'aggregate_id'
op|'='
string|"'agg1'"
op|','
name|'reason'
op|'='
string|'"not empty"'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
op|'{'
string|'"availability_zone"'
op|':'
string|'"nova"'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'update'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_host
dedent|''
dedent|''
name|'def'
name|'test_add_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_add_host_to_aggregate
indent|'        '
name|'def'
name|'stub_add_host_to_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'context'
op|','
name|'self'
op|'.'
name|'context'
op|','
string|'"context"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"1"'
op|','
name|'aggregate'
op|','
string|'"aggregate"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"host1"'
op|','
name|'host'
op|','
string|'"host"'
op|')'
newline|'\n'
name|'return'
name|'AGGREGATE'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"add_host_to_aggregate"'
op|','
nl|'\n'
name|'stub_add_host_to_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'aggregate'
op|'='
name|'eval'
op|'('
name|'self'
op|'.'
name|'add_host'
op|')'
op|'('
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"add_host"'
op|':'
op|'{'
string|'"host"'
op|':'
nl|'\n'
string|'"host1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'aggregate'
op|'='
name|'_transform_aggregate_az'
op|'('
name|'aggregate'
op|'['
string|"'aggregate'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_agg_data'
op|'('
name|'AGGREGATE'
op|','
name|'aggregate'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_host_no_admin
dedent|''
name|'def'
name|'test_add_host_no_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
nl|'\n'
name|'eval'
op|'('
name|'self'
op|'.'
name|'add_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'user_req'
op|','
string|'"1"'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"add_host"'
op|':'
op|'{'
string|'"host"'
op|':'
string|'"host1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_host_with_already_added_host
dedent|''
name|'def'
name|'test_add_host_with_already_added_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_add_host_to_aggregate
indent|'        '
name|'def'
name|'stub_add_host_to_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'AggregateHostExists'
op|'('
name|'aggregate_id'
op|'='
name|'aggregate'
op|','
nl|'\n'
name|'host'
op|'='
name|'host'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"add_host_to_aggregate"'
op|','
nl|'\n'
name|'stub_add_host_to_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPConflict'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'add_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"add_host"'
op|':'
op|'{'
string|'"host"'
op|':'
string|'"host1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_host_with_bad_aggregate
dedent|''
name|'def'
name|'test_add_host_with_bad_aggregate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_add_host_to_aggregate
indent|'        '
name|'def'
name|'stub_add_host_to_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'AggregateNotFound'
op|'('
name|'aggregate_id'
op|'='
name|'aggregate'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"add_host_to_aggregate"'
op|','
nl|'\n'
name|'stub_add_host_to_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPNotFound'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'add_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"bogus_aggregate"'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"add_host"'
op|':'
op|'{'
string|'"host"'
op|':'
string|'"host1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_host_with_bad_host
dedent|''
name|'def'
name|'test_add_host_with_bad_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_add_host_to_aggregate
indent|'        '
name|'def'
name|'stub_add_host_to_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'ComputeHostNotFound'
op|'('
name|'host'
op|'='
name|'host'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"add_host_to_aggregate"'
op|','
nl|'\n'
name|'stub_add_host_to_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPNotFound'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'add_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"add_host"'
op|':'
op|'{'
string|'"host"'
op|':'
string|'"bogus_host"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_host_with_missing_host
dedent|''
name|'def'
name|'test_add_host_with_missing_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'add_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
op|'{'
string|'"add_host"'
op|':'
op|'{'
string|'"asdf"'
op|':'
string|'"asdf"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_host_with_invalid_format_host
dedent|''
name|'def'
name|'test_add_host_with_invalid_format_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'add_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
op|'{'
string|'"add_host"'
op|':'
op|'{'
string|'"host"'
op|':'
string|'"a"'
op|'*'
number|'300'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_host_with_multiple_hosts
dedent|''
name|'def'
name|'test_add_host_with_multiple_hosts'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'add_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
op|'{'
string|'"add_host"'
op|':'
op|'{'
string|'"host"'
op|':'
op|'['
string|'"host1"'
op|','
string|'"host2"'
op|']'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_host_raises_key_error
dedent|''
name|'def'
name|'test_add_host_raises_key_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_add_host_to_aggregate
indent|'        '
name|'def'
name|'stub_add_host_to_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'KeyError'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"add_host_to_aggregate"'
op|','
nl|'\n'
name|'stub_add_host_to_aggregate'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPInternalServerError'
op|','
nl|'\n'
name|'eval'
op|'('
name|'self'
op|'.'
name|'add_host'
op|')'
op|','
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"add_host"'
op|':'
op|'{'
string|'"host"'
op|':'
string|'"host1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_host_with_invalid_request
dedent|''
name|'def'
name|'test_add_host_with_invalid_request'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'add_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
op|'{'
string|'"add_host"'
op|':'
string|'"1"'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_host_with_non_string
dedent|''
name|'def'
name|'test_add_host_with_non_string'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'add_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
op|'{'
string|'"add_host"'
op|':'
op|'{'
string|'"host"'
op|':'
number|'1'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_host
dedent|''
name|'def'
name|'test_remove_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_remove_host_from_aggregate
indent|'        '
name|'def'
name|'stub_remove_host_from_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'context'
op|','
name|'self'
op|'.'
name|'context'
op|','
string|'"context"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"1"'
op|','
name|'aggregate'
op|','
string|'"aggregate"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"host1"'
op|','
name|'host'
op|','
string|'"host"'
op|')'
newline|'\n'
name|'stub_remove_host_from_aggregate'
op|'.'
name|'called'
op|'='
name|'True'
newline|'\n'
comment|'# at minimum, metadata is always set to {} in the api'
nl|'\n'
name|'return'
name|'_make_agg_obj'
op|'('
op|'{'
string|"'metadata'"
op|':'
op|'{'
op|'}'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
nl|'\n'
string|'"remove_host_from_aggregate"'
op|','
nl|'\n'
name|'stub_remove_host_from_aggregate'
op|')'
newline|'\n'
name|'eval'
op|'('
name|'self'
op|'.'
name|'remove_host'
op|')'
op|'('
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"remove_host"'
op|':'
op|'{'
string|'"host"'
op|':'
string|'"host1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'stub_remove_host_from_aggregate'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_host_no_admin
dedent|''
name|'def'
name|'test_remove_host_no_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
nl|'\n'
name|'eval'
op|'('
name|'self'
op|'.'
name|'remove_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'user_req'
op|','
string|'"1"'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"remove_host"'
op|':'
op|'{'
string|'"host"'
op|':'
string|'"host1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_host_with_bad_aggregate
dedent|''
name|'def'
name|'test_remove_host_with_bad_aggregate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_remove_host_from_aggregate
indent|'        '
name|'def'
name|'stub_remove_host_from_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'AggregateNotFound'
op|'('
name|'aggregate_id'
op|'='
name|'aggregate'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
nl|'\n'
string|'"remove_host_from_aggregate"'
op|','
nl|'\n'
name|'stub_remove_host_from_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPNotFound'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'remove_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"bogus_aggregate"'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"remove_host"'
op|':'
op|'{'
string|'"host"'
op|':'
string|'"host1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_host_with_host_not_in_aggregate
dedent|''
name|'def'
name|'test_remove_host_with_host_not_in_aggregate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_remove_host_from_aggregate
indent|'        '
name|'def'
name|'stub_remove_host_from_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'AggregateHostNotFound'
op|'('
name|'aggregate_id'
op|'='
name|'aggregate'
op|','
nl|'\n'
name|'host'
op|'='
name|'host'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
nl|'\n'
string|'"remove_host_from_aggregate"'
op|','
nl|'\n'
name|'stub_remove_host_from_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPNotFound'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'remove_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"remove_host"'
op|':'
op|'{'
string|'"host"'
op|':'
string|'"host1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_host_with_bad_host
dedent|''
name|'def'
name|'test_remove_host_with_bad_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_remove_host_from_aggregate
indent|'        '
name|'def'
name|'stub_remove_host_from_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'ComputeHostNotFound'
op|'('
name|'host'
op|'='
name|'host'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
nl|'\n'
string|'"remove_host_from_aggregate"'
op|','
nl|'\n'
name|'stub_remove_host_from_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPNotFound'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'remove_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
op|'{'
string|'"remove_host"'
op|':'
op|'{'
string|'"host"'
op|':'
string|'"bogushost"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_host_with_missing_host
dedent|''
name|'def'
name|'test_remove_host_with_missing_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'remove_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
op|'{'
string|'"asdf"'
op|':'
string|'"asdf"'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_host_with_multiple_hosts
dedent|''
name|'def'
name|'test_remove_host_with_multiple_hosts'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'remove_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
op|'{'
string|'"remove_host"'
op|':'
op|'{'
string|'"host"'
op|':'
nl|'\n'
op|'['
string|'"host1"'
op|','
string|'"host2"'
op|']'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_host_with_extra_param
dedent|''
name|'def'
name|'test_remove_host_with_extra_param'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'remove_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
op|'{'
string|'"remove_host"'
op|':'
op|'{'
string|'"asdf"'
op|':'
string|'"asdf"'
op|','
nl|'\n'
string|'"host"'
op|':'
string|'"asdf"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_host_with_invalid_request
dedent|''
name|'def'
name|'test_remove_host_with_invalid_request'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
nl|'\n'
name|'eval'
op|'('
name|'self'
op|'.'
name|'remove_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
op|'{'
string|'"remove_host"'
op|':'
string|'"1"'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_host_with_missing_host_empty
dedent|''
name|'def'
name|'test_remove_host_with_missing_host_empty'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
nl|'\n'
name|'eval'
op|'('
name|'self'
op|'.'
name|'remove_host'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
op|'{'
string|'"remove_host"'
op|':'
op|'{'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_metadata
dedent|''
name|'def'
name|'test_set_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"set_metadata"'
op|':'
op|'{'
string|'"metadata"'
op|':'
op|'{'
string|'"foo"'
op|':'
string|'"bar"'
op|'}'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|stub_update_aggregate
name|'def'
name|'stub_update_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'values'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'context'
op|','
name|'self'
op|'.'
name|'context'
op|','
string|'"context"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"1"'
op|','
name|'aggregate'
op|','
string|'"aggregate"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertThat'
op|'('
name|'body'
op|'['
string|'"set_metadata"'
op|']'
op|'['
string|"'metadata'"
op|']'
op|','
nl|'\n'
name|'matchers'
op|'.'
name|'DictMatches'
op|'('
name|'values'
op|')'
op|')'
newline|'\n'
name|'return'
name|'AGGREGATE'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
nl|'\n'
string|'"update_aggregate_metadata"'
op|','
nl|'\n'
name|'stub_update_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'eval'
op|'('
name|'self'
op|'.'
name|'set_metadata'
op|')'
op|'('
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'_transform_aggregate_az'
op|'('
name|'result'
op|'['
string|"'aggregate'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_agg_data'
op|'('
name|'AGGREGATE'
op|','
name|'_make_agg_obj'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_metadata_delete
dedent|''
name|'def'
name|'test_set_metadata_delete'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"set_metadata"'
op|':'
op|'{'
string|'"metadata"'
op|':'
op|'{'
string|'"foo"'
op|':'
name|'None'
op|'}'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
nl|'\n'
string|"'update_aggregate_metadata'"
op|')'
name|'as'
name|'mocked'
op|':'
newline|'\n'
indent|'            '
name|'mocked'
op|'.'
name|'return_value'
op|'='
name|'AGGREGATE'
newline|'\n'
name|'result'
op|'='
name|'eval'
op|'('
name|'self'
op|'.'
name|'set_metadata'
op|')'
op|'('
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'result'
op|'='
name|'_transform_aggregate_az'
op|'('
name|'result'
op|'['
string|"'aggregate'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_agg_data'
op|'('
name|'AGGREGATE'
op|','
name|'_make_agg_obj'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
name|'mocked'
op|'.'
name|'assert_called_once_with'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|'"1"'
op|','
nl|'\n'
name|'body'
op|'['
string|'"set_metadata"'
op|']'
op|'['
string|'"metadata"'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_metadata_no_admin
dedent|''
name|'def'
name|'test_set_metadata_no_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
nl|'\n'
name|'eval'
op|'('
name|'self'
op|'.'
name|'set_metadata'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'user_req'
op|','
string|'"1"'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"set_metadata"'
op|':'
op|'{'
string|'"metadata"'
op|':'
nl|'\n'
op|'{'
string|'"foo"'
op|':'
string|'"bar"'
op|'}'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_metadata_with_bad_aggregate
dedent|''
name|'def'
name|'test_set_metadata_with_bad_aggregate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"set_metadata"'
op|':'
op|'{'
string|'"metadata"'
op|':'
op|'{'
string|'"foo"'
op|':'
string|'"bar"'
op|'}'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|stub_update_aggregate
name|'def'
name|'stub_update_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'metadata'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'AggregateNotFound'
op|'('
name|'aggregate_id'
op|'='
name|'aggregate'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
nl|'\n'
string|'"update_aggregate_metadata"'
op|','
nl|'\n'
name|'stub_update_aggregate'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPNotFound'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'set_metadata'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"bad_aggregate"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_metadata_with_missing_metadata
dedent|''
name|'def'
name|'test_set_metadata_with_missing_metadata'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"asdf"'
op|':'
op|'{'
string|'"foo"'
op|':'
string|'"bar"'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'set_metadata'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_metadata_with_extra_params
dedent|''
name|'def'
name|'test_set_metadata_with_extra_params'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"metadata"'
op|':'
op|'{'
string|'"foo"'
op|':'
string|'"bar"'
op|'}'
op|','
string|'"asdf"'
op|':'
op|'{'
string|'"foo"'
op|':'
string|'"bar"'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'set_metadata'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_metadata_without_dict
dedent|''
name|'def'
name|'test_set_metadata_without_dict'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"set_metadata"'
op|':'
op|'{'
string|"'metadata'"
op|':'
number|'1'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'set_metadata'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_metadata_with_empty_key
dedent|''
name|'def'
name|'test_set_metadata_with_empty_key'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"set_metadata"'
op|':'
op|'{'
string|'"metadata"'
op|':'
op|'{'
string|'""'
op|':'
string|'"value"'
op|'}'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'set_metadata'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_metadata_with_key_too_long
dedent|''
name|'def'
name|'test_set_metadata_with_key_too_long'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"set_metadata"'
op|':'
op|'{'
string|'"metadata"'
op|':'
op|'{'
string|'"x"'
op|'*'
number|'256'
op|':'
string|'"value"'
op|'}'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'set_metadata'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_metadata_with_value_too_long
dedent|''
name|'def'
name|'test_set_metadata_with_value_too_long'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"set_metadata"'
op|':'
op|'{'
string|'"metadata"'
op|':'
op|'{'
string|'"key"'
op|':'
string|'"x"'
op|'*'
number|'256'
op|'}'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'set_metadata'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_metadata_with_string
dedent|''
name|'def'
name|'test_set_metadata_with_string'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|'"set_metadata"'
op|':'
op|'{'
string|'"metadata"'
op|':'
string|'"test"'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'self'
op|'.'
name|'bad_request'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'set_metadata'
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
name|'body'
op|'='
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_aggregate
dedent|''
name|'def'
name|'test_delete_aggregate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_delete_aggregate
indent|'        '
name|'def'
name|'stub_delete_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'context'
op|','
name|'self'
op|'.'
name|'context'
op|','
string|'"context"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"1"'
op|','
name|'aggregate'
op|','
string|'"aggregate"'
op|')'
newline|'\n'
name|'stub_delete_aggregate'
op|'.'
name|'called'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"delete_aggregate"'
op|','
nl|'\n'
name|'stub_delete_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'delete'
op|'('
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'stub_delete_aggregate'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_aggregate_no_admin
dedent|''
name|'def'
name|'test_delete_aggregate_no_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
nl|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'delete'
op|','
nl|'\n'
name|'self'
op|'.'
name|'user_req'
op|','
string|'"1"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_aggregate_with_bad_aggregate
dedent|''
name|'def'
name|'test_delete_aggregate_with_bad_aggregate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_delete_aggregate
indent|'        '
name|'def'
name|'stub_delete_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'AggregateNotFound'
op|'('
name|'aggregate_id'
op|'='
name|'aggregate'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"delete_aggregate"'
op|','
nl|'\n'
name|'stub_delete_aggregate'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPNotFound'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'delete'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"bogus_aggregate"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_aggregate_with_host
dedent|''
name|'def'
name|'test_delete_aggregate_with_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"delete_aggregate"'
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'exception'
op|'.'
name|'InvalidAggregateAction'
op|'('
nl|'\n'
name|'action'
op|'='
string|'"delete"'
op|','
name|'aggregate_id'
op|'='
string|'"agg1"'
op|','
nl|'\n'
name|'reason'
op|'='
string|'"not empty"'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
nl|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'delete'
op|','
nl|'\n'
name|'self'
op|'.'
name|'req'
op|','
string|'"agg1"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_marshall_aggregate
dedent|''
dedent|''
name|'def'
name|'test_marshall_aggregate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# _marshall_aggregate() just basically turns the aggregate returned'
nl|'\n'
comment|'# from the AggregateAPI into a dict, so this tests that transform.'
nl|'\n'
comment|'# We would expect the dictionary that comes out is the same one'
nl|'\n'
comment|'# that we pump into the aggregate object in the first place'
nl|'\n'
indent|'        '
name|'agg'
op|'='
op|'{'
string|"'name'"
op|':'
string|"'aggregate1'"
op|','
nl|'\n'
string|"'id'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'metadata'"
op|':'
op|'{'
string|"'foo'"
op|':'
string|"'bar'"
op|','
string|"'availability_zone'"
op|':'
string|"'nova'"
op|'}'
op|','
nl|'\n'
string|"'hosts'"
op|':'
op|'['
string|"'host1'"
op|','
string|"'host2'"
op|']'
op|'}'
newline|'\n'
name|'agg_obj'
op|'='
name|'_make_agg_obj'
op|'('
name|'agg'
op|')'
newline|'\n'
name|'marshalled_agg'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'_marshall_aggregate'
op|'('
name|'agg_obj'
op|')'
newline|'\n'
nl|'\n'
comment|'# _marshall_aggregate() puts all fields and obj_extra_fields in the'
nl|'\n'
comment|'# top-level dict, so we need to put availability_zone at the top also'
nl|'\n'
name|'agg'
op|'['
string|"'availability_zone'"
op|']'
op|'='
string|"'nova'"
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'agg'
op|','
name|'marshalled_agg'
op|'['
string|"'aggregate'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_assert_agg_data
dedent|''
name|'def'
name|'_assert_agg_data'
op|'('
name|'self'
op|','
name|'expected'
op|','
name|'actual'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expected_data'
op|'='
name|'expected'
op|'.'
name|'obj_to_primitive'
op|'('
op|')'
op|'['
string|"'nova_object.data'"
op|']'
newline|'\n'
name|'actual_data'
op|'='
name|'expected'
op|'.'
name|'obj_to_primitive'
op|'('
op|')'
op|'['
string|"'nova_object.data'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_data'
op|','
name|'actual_data'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|AggregateTestCaseV2
dedent|''
dedent|''
name|'class'
name|'AggregateTestCaseV2'
op|'('
name|'AggregateTestCaseV21'
op|')'
op|':'
newline|'\n'
DECL|variable|add_host
indent|'    '
name|'add_host'
op|'='
string|"'self.controller.action'"
newline|'\n'
DECL|variable|remove_host
name|'remove_host'
op|'='
string|"'self.controller.action'"
newline|'\n'
DECL|variable|set_metadata
name|'set_metadata'
op|'='
string|"'self.controller.action'"
newline|'\n'
DECL|variable|bad_request
name|'bad_request'
op|'='
name|'exc'
op|'.'
name|'HTTPBadRequest'
newline|'\n'
nl|'\n'
DECL|member|_set_up
name|'def'
name|'_set_up'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'controller'
op|'='
name|'aggregates_v2'
op|'.'
name|'AggregateController'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'req'
op|'='
name|'FakeRequest'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'user_req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
string|"'/v2/os-aggregates'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'self'
op|'.'
name|'req'
op|'.'
name|'environ'
op|'['
string|"'nova.context'"
op|']'
newline|'\n'
nl|'\n'
DECL|member|test_add_host_raises_key_error
dedent|''
name|'def'
name|'test_add_host_raises_key_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|stub_add_host_to_aggregate
indent|'        '
name|'def'
name|'stub_add_host_to_aggregate'
op|'('
name|'context'
op|','
name|'aggregate'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'KeyError'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'controller'
op|'.'
name|'api'
op|','
string|'"add_host_to_aggregate"'
op|','
nl|'\n'
name|'stub_add_host_to_aggregate'
op|')'
newline|'\n'
comment|'# NOTE(mtreinish) The check for a KeyError here is to ensure that'
nl|'\n'
comment|'# if add_host_to_aggregate() raises a KeyError it propagates. At'
nl|'\n'
comment|'# one point the api code would mask the error as a HTTPBadRequest.'
nl|'\n'
comment|"# This test is to ensure that this doesn't occur again."
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'KeyError'
op|','
name|'eval'
op|'('
name|'self'
op|'.'
name|'add_host'
op|')'
op|','
name|'self'
op|'.'
name|'req'
op|','
string|'"1"'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"add_host"'
op|':'
op|'{'
string|'"host"'
op|':'
string|'"host1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_host_to_aggregate_with_non_admin
dedent|''
name|'def'
name|'test_add_host_to_aggregate_with_non_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'rule_name'
op|'='
string|'"compute_extension:aggregates"'
newline|'\n'
name|'self'
op|'.'
name|'policy'
op|'.'
name|'set_rules'
op|'('
op|'{'
name|'rule_name'
op|':'
string|'""'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'AdminRequired'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'_add_host'
op|','
nl|'\n'
name|'self'
op|'.'
name|'user_req'
op|','
string|"'1'"
op|','
op|'{'
string|"'host'"
op|':'
string|"'fake_host'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_host_from_aggregate_with_non_admin
dedent|''
name|'def'
name|'test_remove_host_from_aggregate_with_non_admin'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'rule_name'
op|'='
string|'"compute_extension:aggregates"'
newline|'\n'
name|'self'
op|'.'
name|'policy'
op|'.'
name|'set_rules'
op|'('
op|'{'
name|'rule_name'
op|':'
string|'""'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'AdminRequired'
op|','
nl|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'_remove_host'
op|','
name|'self'
op|'.'
name|'user_req'
op|','
nl|'\n'
string|"'1'"
op|','
op|'{'
string|"'host'"
op|':'
string|"'fake_host'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_name_with_leading_trailing_spaces
dedent|''
name|'def'
name|'test_create_name_with_leading_trailing_spaces'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_mock_aggs
indent|'        '
name|'def'
name|'fake_mock_aggs'
op|'('
name|'context'
op|','
name|'name'
op|','
name|'az'
op|')'
op|':'
newline|'\n'
comment|"# NOTE(alex_xu): legacy v2 api didn't strip the spaces."
nl|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'  test  '"
op|','
name|'name'
op|')'
newline|'\n'
name|'return'
name|'AGGREGATE'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'compute_api'
op|'.'
name|'AggregateAPI'
op|','
nl|'\n'
string|"'create_aggregate'"
op|')'
name|'as'
name|'mock_aggs'
op|':'
newline|'\n'
indent|'            '
name|'mock_aggs'
op|'.'
name|'side_effect'
op|'='
name|'fake_mock_aggs'
newline|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|'('
name|'self'
op|'.'
name|'req'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"  test  "'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"nova1"'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_name_with_leading_trailing_spaces_compat_mode
dedent|''
dedent|''
name|'def'
name|'test_create_name_with_leading_trailing_spaces_compat_mode'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|test_create_availability_zone_with_leading_trailing_spaces
dedent|''
name|'def'
name|'test_create_availability_zone_with_leading_trailing_spaces'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_mock_aggs
indent|'        '
name|'def'
name|'fake_mock_aggs'
op|'('
name|'context'
op|','
name|'name'
op|','
name|'az'
op|')'
op|':'
newline|'\n'
comment|"# NOTE(alex_xu): legacy v2 api didn't strip the spaces."
nl|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'  nova1  '"
op|','
name|'az'
op|')'
newline|'\n'
name|'return'
name|'AGGREGATE'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'compute_api'
op|'.'
name|'AggregateAPI'
op|','
nl|'\n'
string|"'create_aggregate'"
op|')'
name|'as'
name|'mock_aggs'
op|':'
newline|'\n'
indent|'            '
name|'mock_aggs'
op|'.'
name|'side_effect'
op|'='
name|'fake_mock_aggs'
newline|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|'('
name|'self'
op|'.'
name|'req'
op|','
nl|'\n'
name|'body'
op|'='
op|'{'
string|'"aggregate"'
op|':'
nl|'\n'
op|'{'
string|'"name"'
op|':'
string|'"  test  "'
op|','
nl|'\n'
string|'"availability_zone"'
op|':'
string|'"  nova1  "'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_availabiltiy_zone_with_leading_trailing_spaces_compat_mode
dedent|''
dedent|''
name|'def'
name|'test_create_availabiltiy_zone_with_leading_trailing_spaces_compat_mode'
op|'('
nl|'\n'
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
