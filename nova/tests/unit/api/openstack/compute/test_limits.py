begin_unit
comment|'# Copyright 2011 OpenStack Foundation'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
string|'"""\nTests dealing with HTTP rate-limiting.\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'httplib'
newline|'\n'
name|'import'
name|'StringIO'
newline|'\n'
nl|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'from'
name|'oslo_serialization'
name|'import'
name|'jsonutils'
newline|'\n'
name|'import'
name|'six'
newline|'\n'
name|'import'
name|'webob'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
op|'.'
name|'api'
op|'.'
name|'openstack'
op|'.'
name|'compute'
name|'import'
name|'limits'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'api'
op|'.'
name|'openstack'
op|'.'
name|'compute'
op|'.'
name|'plugins'
op|'.'
name|'v3'
name|'import'
name|'limits'
name|'as'
name|'limits_v3'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'api'
op|'.'
name|'openstack'
op|'.'
name|'compute'
name|'import'
name|'views'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'api'
op|'.'
name|'openstack'
name|'import'
name|'wsgi'
newline|'\n'
name|'import'
name|'nova'
op|'.'
name|'context'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
op|'.'
name|'api'
op|'.'
name|'openstack'
name|'import'
name|'fakes'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
name|'import'
name|'matchers'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'utils'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|TEST_LIMITS
name|'TEST_LIMITS'
op|'='
op|'['
nl|'\n'
name|'limits'
op|'.'
name|'Limit'
op|'('
string|'"GET"'
op|','
string|'"/delayed"'
op|','
string|'"^/delayed"'
op|','
number|'1'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'TIME_UNITS'
op|'['
string|"'MINUTE'"
op|']'
op|')'
op|','
nl|'\n'
name|'limits'
op|'.'
name|'Limit'
op|'('
string|'"POST"'
op|','
string|'"*"'
op|','
string|'".*"'
op|','
number|'7'
op|','
name|'utils'
op|'.'
name|'TIME_UNITS'
op|'['
string|"'MINUTE'"
op|']'
op|')'
op|','
nl|'\n'
name|'limits'
op|'.'
name|'Limit'
op|'('
string|'"POST"'
op|','
string|'"/servers"'
op|','
string|'"^/servers"'
op|','
number|'3'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'TIME_UNITS'
op|'['
string|"'MINUTE'"
op|']'
op|')'
op|','
nl|'\n'
name|'limits'
op|'.'
name|'Limit'
op|'('
string|'"PUT"'
op|','
string|'"*"'
op|','
string|'""'
op|','
number|'10'
op|','
name|'utils'
op|'.'
name|'TIME_UNITS'
op|'['
string|"'MINUTE'"
op|']'
op|')'
op|','
nl|'\n'
name|'limits'
op|'.'
name|'Limit'
op|'('
string|'"PUT"'
op|','
string|'"/servers"'
op|','
string|'"^/servers"'
op|','
number|'5'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'TIME_UNITS'
op|'['
string|"'MINUTE'"
op|']'
op|')'
op|','
nl|'\n'
op|']'
newline|'\n'
DECL|variable|NS
name|'NS'
op|'='
op|'{'
nl|'\n'
string|"'atom'"
op|':'
string|"'http://www.w3.org/2005/Atom'"
op|','
nl|'\n'
string|"'ns'"
op|':'
string|"'http://docs.openstack.org/common/api/v1.0'"
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|BaseLimitTestSuite
name|'class'
name|'BaseLimitTestSuite'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Base test suite which provides relevant stubs and time abstraction."""'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'BaseLimitTestSuite'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'time'
op|'='
number|'0.0'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'limits'
op|'.'
name|'Limit'
op|','
string|'"_get_time"'
op|','
name|'self'
op|'.'
name|'_get_time'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'absolute_limits'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|stub_get_project_quotas
name|'def'
name|'stub_get_project_quotas'
op|'('
name|'context'
op|','
name|'project_id'
op|','
name|'usages'
op|'='
name|'True'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'{'
name|'k'
op|':'
name|'dict'
op|'('
name|'limit'
op|'='
name|'v'
op|')'
nl|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'self'
op|'.'
name|'absolute_limits'
op|'.'
name|'items'
op|'('
op|')'
op|'}'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'quota'
op|'.'
name|'QUOTAS'
op|','
string|'"get_project_quotas"'
op|','
nl|'\n'
name|'stub_get_project_quotas'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_time
dedent|''
name|'def'
name|'_get_time'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Return the "time" according to this test suite."""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'time'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|LimitsControllerTestV21
dedent|''
dedent|''
name|'class'
name|'LimitsControllerTestV21'
op|'('
name|'BaseLimitTestSuite'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Tests for `limits.LimitsController` class."""'
newline|'\n'
DECL|variable|limits_controller
name|'limits_controller'
op|'='
name|'limits_v3'
op|'.'
name|'LimitsController'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Run before each test."""'
newline|'\n'
name|'super'
op|'('
name|'LimitsControllerTestV21'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'controller'
op|'='
name|'wsgi'
op|'.'
name|'Resource'
op|'('
name|'self'
op|'.'
name|'limits_controller'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'ctrler'
op|'='
name|'self'
op|'.'
name|'limits_controller'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_index_request
dedent|''
name|'def'
name|'_get_index_request'
op|'('
name|'self'
op|','
name|'accept_header'
op|'='
string|'"application/json"'
op|','
nl|'\n'
name|'tenant_id'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Helper to set routing arguments."""'
newline|'\n'
name|'request'
op|'='
name|'webob'
op|'.'
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/"'
op|')'
newline|'\n'
name|'if'
name|'tenant_id'
op|':'
newline|'\n'
indent|'            '
name|'request'
op|'='
name|'webob'
op|'.'
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/?tenant_id=%s"'
op|'%'
name|'tenant_id'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'request'
op|'.'
name|'accept'
op|'='
name|'accept_header'
newline|'\n'
name|'request'
op|'.'
name|'environ'
op|'['
string|'"wsgiorg.routing_args"'
op|']'
op|'='
op|'('
name|'None'
op|','
op|'{'
nl|'\n'
string|'"action"'
op|':'
string|'"index"'
op|','
nl|'\n'
string|'"controller"'
op|':'
string|'""'
op|','
nl|'\n'
op|'}'
op|')'
newline|'\n'
name|'context'
op|'='
name|'nova'
op|'.'
name|'context'
op|'.'
name|'RequestContext'
op|'('
string|"'testuser'"
op|','
string|"'testproject'"
op|')'
newline|'\n'
name|'request'
op|'.'
name|'environ'
op|'['
string|'"nova.context"'
op|']'
op|'='
name|'context'
newline|'\n'
name|'return'
name|'request'
newline|'\n'
nl|'\n'
DECL|member|_populate_limits
dedent|''
name|'def'
name|'_populate_limits'
op|'('
name|'self'
op|','
name|'request'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Put limit info into a request."""'
newline|'\n'
name|'_limits'
op|'='
op|'['
nl|'\n'
name|'limits'
op|'.'
name|'Limit'
op|'('
string|'"GET"'
op|','
string|'"*"'
op|','
string|'".*"'
op|','
number|'10'
op|','
number|'60'
op|')'
op|'.'
name|'display'
op|'('
op|')'
op|','
nl|'\n'
name|'limits'
op|'.'
name|'Limit'
op|'('
string|'"POST"'
op|','
string|'"*"'
op|','
string|'".*"'
op|','
number|'5'
op|','
number|'60'
op|'*'
number|'60'
op|')'
op|'.'
name|'display'
op|'('
op|')'
op|','
nl|'\n'
name|'limits'
op|'.'
name|'Limit'
op|'('
string|'"GET"'
op|','
string|'"changes-since*"'
op|','
string|'"changes-since"'
op|','
nl|'\n'
number|'5'
op|','
number|'60'
op|')'
op|'.'
name|'display'
op|'('
op|')'
op|','
nl|'\n'
op|']'
newline|'\n'
name|'request'
op|'.'
name|'environ'
op|'['
string|'"nova.limits"'
op|']'
op|'='
name|'_limits'
newline|'\n'
name|'return'
name|'request'
newline|'\n'
nl|'\n'
DECL|member|test_empty_index_json
dedent|''
name|'def'
name|'test_empty_index_json'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test getting empty limit details in JSON.'
nl|'\n'
indent|'        '
name|'request'
op|'='
name|'self'
op|'.'
name|'_get_index_request'
op|'('
op|')'
newline|'\n'
name|'response'
op|'='
name|'request'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'controller'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|'"limits"'
op|':'
op|'{'
nl|'\n'
string|'"rate"'
op|':'
op|'['
op|']'
op|','
nl|'\n'
string|'"absolute"'
op|':'
op|'{'
op|'}'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'body'
op|'='
name|'jsonutils'
op|'.'
name|'loads'
op|'('
name|'response'
op|'.'
name|'body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_index_json
dedent|''
name|'def'
name|'test_index_json'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_index_json'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_index_json_by_tenant
dedent|''
name|'def'
name|'test_index_json_by_tenant'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_index_json'
op|'('
string|"'faketenant'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_index_json
dedent|''
name|'def'
name|'_test_index_json'
op|'('
name|'self'
op|','
name|'tenant_id'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# Test getting limit details in JSON.'
nl|'\n'
indent|'        '
name|'request'
op|'='
name|'self'
op|'.'
name|'_get_index_request'
op|'('
name|'tenant_id'
op|'='
name|'tenant_id'
op|')'
newline|'\n'
name|'context'
op|'='
name|'request'
op|'.'
name|'environ'
op|'['
string|'"nova.context"'
op|']'
newline|'\n'
name|'if'
name|'tenant_id'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'tenant_id'
op|'='
name|'context'
op|'.'
name|'project_id'
newline|'\n'
nl|'\n'
dedent|''
name|'request'
op|'='
name|'self'
op|'.'
name|'_populate_limits'
op|'('
name|'request'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'absolute_limits'
op|'='
op|'{'
nl|'\n'
string|"'ram'"
op|':'
number|'512'
op|','
nl|'\n'
string|"'instances'"
op|':'
number|'5'
op|','
nl|'\n'
string|"'cores'"
op|':'
number|'21'
op|','
nl|'\n'
string|"'key_pairs'"
op|':'
number|'10'
op|','
nl|'\n'
string|"'floating_ips'"
op|':'
number|'10'
op|','
nl|'\n'
string|"'security_groups'"
op|':'
number|'10'
op|','
nl|'\n'
string|"'security_group_rules'"
op|':'
number|'20'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|'"limits"'
op|':'
op|'{'
nl|'\n'
string|'"rate"'
op|':'
op|'['
nl|'\n'
op|'{'
nl|'\n'
string|'"regex"'
op|':'
string|'".*"'
op|','
nl|'\n'
string|'"uri"'
op|':'
string|'"*"'
op|','
nl|'\n'
string|'"limit"'
op|':'
op|'['
nl|'\n'
op|'{'
nl|'\n'
string|'"verb"'
op|':'
string|'"GET"'
op|','
nl|'\n'
string|'"next-available"'
op|':'
string|'"1970-01-01T00:00:00Z"'
op|','
nl|'\n'
string|'"unit"'
op|':'
string|'"MINUTE"'
op|','
nl|'\n'
string|'"value"'
op|':'
number|'10'
op|','
nl|'\n'
string|'"remaining"'
op|':'
number|'10'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'{'
nl|'\n'
string|'"verb"'
op|':'
string|'"POST"'
op|','
nl|'\n'
string|'"next-available"'
op|':'
string|'"1970-01-01T00:00:00Z"'
op|','
nl|'\n'
string|'"unit"'
op|':'
string|'"HOUR"'
op|','
nl|'\n'
string|'"value"'
op|':'
number|'5'
op|','
nl|'\n'
string|'"remaining"'
op|':'
number|'5'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|']'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'{'
nl|'\n'
string|'"regex"'
op|':'
string|'"changes-since"'
op|','
nl|'\n'
string|'"uri"'
op|':'
string|'"changes-since*"'
op|','
nl|'\n'
string|'"limit"'
op|':'
op|'['
nl|'\n'
op|'{'
nl|'\n'
string|'"verb"'
op|':'
string|'"GET"'
op|','
nl|'\n'
string|'"next-available"'
op|':'
string|'"1970-01-01T00:00:00Z"'
op|','
nl|'\n'
string|'"unit"'
op|':'
string|'"MINUTE"'
op|','
nl|'\n'
string|'"value"'
op|':'
number|'5'
op|','
nl|'\n'
string|'"remaining"'
op|':'
number|'5'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|']'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
nl|'\n'
op|']'
op|','
nl|'\n'
string|'"absolute"'
op|':'
op|'{'
nl|'\n'
string|'"maxTotalRAMSize"'
op|':'
number|'512'
op|','
nl|'\n'
string|'"maxTotalInstances"'
op|':'
number|'5'
op|','
nl|'\n'
string|'"maxTotalCores"'
op|':'
number|'21'
op|','
nl|'\n'
string|'"maxTotalKeypairs"'
op|':'
number|'10'
op|','
nl|'\n'
string|'"maxTotalFloatingIps"'
op|':'
number|'10'
op|','
nl|'\n'
string|'"maxSecurityGroups"'
op|':'
number|'10'
op|','
nl|'\n'
string|'"maxSecurityGroupRules"'
op|':'
number|'20'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|_get_project_quotas
name|'def'
name|'_get_project_quotas'
op|'('
name|'context'
op|','
name|'project_id'
op|','
name|'usages'
op|'='
name|'True'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'{'
name|'k'
op|':'
name|'dict'
op|'('
name|'limit'
op|'='
name|'v'
op|')'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'self'
op|'.'
name|'absolute_limits'
op|'.'
name|'items'
op|'('
op|')'
op|'}'
newline|'\n'
nl|'\n'
dedent|''
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'('
string|"'nova.quota.QUOTAS.get_project_quotas'"
op|')'
name|'as'
name|'get_project_quotas'
op|':'
newline|'\n'
indent|'            '
name|'get_project_quotas'
op|'.'
name|'side_effect'
op|'='
name|'_get_project_quotas'
newline|'\n'
nl|'\n'
name|'response'
op|'='
name|'request'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'controller'
op|')'
newline|'\n'
nl|'\n'
name|'body'
op|'='
name|'jsonutils'
op|'.'
name|'loads'
op|'('
name|'response'
op|'.'
name|'body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'body'
op|')'
newline|'\n'
name|'get_project_quotas'
op|'.'
name|'assert_called_once_with'
op|'('
name|'context'
op|','
name|'tenant_id'
op|','
nl|'\n'
name|'usages'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|LimitsControllerTestV2
dedent|''
dedent|''
dedent|''
name|'class'
name|'LimitsControllerTestV2'
op|'('
name|'LimitsControllerTestV21'
op|')'
op|':'
newline|'\n'
DECL|variable|limits_controller
indent|'    '
name|'limits_controller'
op|'='
name|'limits'
op|'.'
name|'LimitsController'
newline|'\n'
nl|'\n'
DECL|member|_populate_limits_diff_regex
name|'def'
name|'_populate_limits_diff_regex'
op|'('
name|'self'
op|','
name|'request'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Put limit info into a request."""'
newline|'\n'
name|'_limits'
op|'='
op|'['
nl|'\n'
name|'limits'
op|'.'
name|'Limit'
op|'('
string|'"GET"'
op|','
string|'"*"'
op|','
string|'".*"'
op|','
number|'10'
op|','
number|'60'
op|')'
op|'.'
name|'display'
op|'('
op|')'
op|','
nl|'\n'
name|'limits'
op|'.'
name|'Limit'
op|'('
string|'"GET"'
op|','
string|'"*"'
op|','
string|'"*.*"'
op|','
number|'10'
op|','
number|'60'
op|')'
op|'.'
name|'display'
op|'('
op|')'
op|','
nl|'\n'
op|']'
newline|'\n'
name|'request'
op|'.'
name|'environ'
op|'['
string|'"nova.limits"'
op|']'
op|'='
name|'_limits'
newline|'\n'
name|'return'
name|'request'
newline|'\n'
nl|'\n'
DECL|member|test_index_diff_regex
dedent|''
name|'def'
name|'test_index_diff_regex'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test getting limit details in JSON.'
nl|'\n'
indent|'        '
name|'request'
op|'='
name|'self'
op|'.'
name|'_get_index_request'
op|'('
op|')'
newline|'\n'
name|'request'
op|'='
name|'self'
op|'.'
name|'_populate_limits_diff_regex'
op|'('
name|'request'
op|')'
newline|'\n'
name|'response'
op|'='
name|'request'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'controller'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|'"limits"'
op|':'
op|'{'
nl|'\n'
string|'"rate"'
op|':'
op|'['
nl|'\n'
op|'{'
nl|'\n'
string|'"regex"'
op|':'
string|'".*"'
op|','
nl|'\n'
string|'"uri"'
op|':'
string|'"*"'
op|','
nl|'\n'
string|'"limit"'
op|':'
op|'['
nl|'\n'
op|'{'
nl|'\n'
string|'"verb"'
op|':'
string|'"GET"'
op|','
nl|'\n'
string|'"next-available"'
op|':'
string|'"1970-01-01T00:00:00Z"'
op|','
nl|'\n'
string|'"unit"'
op|':'
string|'"MINUTE"'
op|','
nl|'\n'
string|'"value"'
op|':'
number|'10'
op|','
nl|'\n'
string|'"remaining"'
op|':'
number|'10'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|']'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'{'
nl|'\n'
string|'"regex"'
op|':'
string|'"*.*"'
op|','
nl|'\n'
string|'"uri"'
op|':'
string|'"*"'
op|','
nl|'\n'
string|'"limit"'
op|':'
op|'['
nl|'\n'
op|'{'
nl|'\n'
string|'"verb"'
op|':'
string|'"GET"'
op|','
nl|'\n'
string|'"next-available"'
op|':'
string|'"1970-01-01T00:00:00Z"'
op|','
nl|'\n'
string|'"unit"'
op|':'
string|'"MINUTE"'
op|','
nl|'\n'
string|'"value"'
op|':'
number|'10'
op|','
nl|'\n'
string|'"remaining"'
op|':'
number|'10'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|']'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
nl|'\n'
op|']'
op|','
nl|'\n'
string|'"absolute"'
op|':'
op|'{'
op|'}'
op|','
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'body'
op|'='
name|'jsonutils'
op|'.'
name|'loads'
op|'('
name|'response'
op|'.'
name|'body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_index_absolute_limits_json
dedent|''
name|'def'
name|'_test_index_absolute_limits_json'
op|'('
name|'self'
op|','
name|'expected'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'request'
op|'='
name|'self'
op|'.'
name|'_get_index_request'
op|'('
op|')'
newline|'\n'
name|'response'
op|'='
name|'request'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'controller'
op|')'
newline|'\n'
name|'body'
op|'='
name|'jsonutils'
op|'.'
name|'loads'
op|'('
name|'response'
op|'.'
name|'body'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'body'
op|'['
string|"'limits'"
op|']'
op|'['
string|"'absolute'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_index_ignores_extra_absolute_limits_json
dedent|''
name|'def'
name|'test_index_ignores_extra_absolute_limits_json'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'absolute_limits'
op|'='
op|'{'
string|"'unknown_limit'"
op|':'
number|'9001'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_test_index_absolute_limits_json'
op|'('
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_index_absolute_ram_json
dedent|''
name|'def'
name|'test_index_absolute_ram_json'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'absolute_limits'
op|'='
op|'{'
string|"'ram'"
op|':'
number|'1024'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_test_index_absolute_limits_json'
op|'('
op|'{'
string|"'maxTotalRAMSize'"
op|':'
number|'1024'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_index_absolute_cores_json
dedent|''
name|'def'
name|'test_index_absolute_cores_json'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'absolute_limits'
op|'='
op|'{'
string|"'cores'"
op|':'
number|'17'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_test_index_absolute_limits_json'
op|'('
op|'{'
string|"'maxTotalCores'"
op|':'
number|'17'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_index_absolute_instances_json
dedent|''
name|'def'
name|'test_index_absolute_instances_json'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'absolute_limits'
op|'='
op|'{'
string|"'instances'"
op|':'
number|'19'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_test_index_absolute_limits_json'
op|'('
op|'{'
string|"'maxTotalInstances'"
op|':'
number|'19'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_index_absolute_metadata_json
dedent|''
name|'def'
name|'test_index_absolute_metadata_json'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# NOTE: both server metadata and image metadata are overloaded'
nl|'\n'
comment|'# into metadata_items'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'absolute_limits'
op|'='
op|'{'
string|"'metadata_items'"
op|':'
number|'23'
op|'}'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|"'maxServerMeta'"
op|':'
number|'23'
op|','
nl|'\n'
string|"'maxImageMeta'"
op|':'
number|'23'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_test_index_absolute_limits_json'
op|'('
name|'expected'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_index_absolute_injected_files
dedent|''
name|'def'
name|'test_index_absolute_injected_files'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'absolute_limits'
op|'='
op|'{'
nl|'\n'
string|"'injected_files'"
op|':'
number|'17'
op|','
nl|'\n'
string|"'injected_file_content_bytes'"
op|':'
number|'86753'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|"'maxPersonality'"
op|':'
number|'17'
op|','
nl|'\n'
string|"'maxPersonalitySize'"
op|':'
number|'86753'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_test_index_absolute_limits_json'
op|'('
name|'expected'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_index_absolute_security_groups
dedent|''
name|'def'
name|'test_index_absolute_security_groups'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'absolute_limits'
op|'='
op|'{'
nl|'\n'
string|"'security_groups'"
op|':'
number|'8'
op|','
nl|'\n'
string|"'security_group_rules'"
op|':'
number|'16'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|"'maxSecurityGroups'"
op|':'
number|'8'
op|','
nl|'\n'
string|"'maxSecurityGroupRules'"
op|':'
number|'16'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_test_index_absolute_limits_json'
op|'('
name|'expected'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_limit_create
dedent|''
name|'def'
name|'test_limit_create'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
string|"'/v2/fake/limits'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPNotImplemented'
op|','
name|'self'
op|'.'
name|'ctrler'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_limit_delete
dedent|''
name|'def'
name|'test_limit_delete'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
string|"'/v2/fake/limits'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPNotImplemented'
op|','
name|'self'
op|'.'
name|'ctrler'
op|'.'
name|'delete'
op|','
nl|'\n'
name|'req'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_limit_detail
dedent|''
name|'def'
name|'test_limit_detail'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
string|"'/v2/fake/limits'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPNotImplemented'
op|','
name|'self'
op|'.'
name|'ctrler'
op|'.'
name|'detail'
op|','
nl|'\n'
name|'req'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_limit_show
dedent|''
name|'def'
name|'test_limit_show'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
string|"'/v2/fake/limits'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPNotImplemented'
op|','
name|'self'
op|'.'
name|'ctrler'
op|'.'
name|'show'
op|','
nl|'\n'
name|'req'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_limit_update
dedent|''
name|'def'
name|'test_limit_update'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
string|"'/v2/fake/limits'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPNotImplemented'
op|','
name|'self'
op|'.'
name|'ctrler'
op|'.'
name|'update'
op|','
nl|'\n'
name|'req'
op|','
number|'1'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|MockLimiter
dedent|''
dedent|''
name|'class'
name|'MockLimiter'
op|'('
name|'limits'
op|'.'
name|'Limiter'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|LimitMiddlewareTest
dedent|''
name|'class'
name|'LimitMiddlewareTest'
op|'('
name|'BaseLimitTestSuite'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Tests for the `limits.RateLimitingMiddleware` class."""'
newline|'\n'
nl|'\n'
op|'@'
name|'webob'
op|'.'
name|'dec'
op|'.'
name|'wsgify'
newline|'\n'
DECL|member|_empty_app
name|'def'
name|'_empty_app'
op|'('
name|'self'
op|','
name|'request'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Do-nothing WSGI app."""'
newline|'\n'
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|setUp
dedent|''
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Prepare middleware for use through fake WSGI app."""'
newline|'\n'
name|'super'
op|'('
name|'LimitMiddlewareTest'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'_limits'
op|'='
string|"'(GET, *, .*, 1, MINUTE)'"
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'='
name|'limits'
op|'.'
name|'RateLimitingMiddleware'
op|'('
name|'self'
op|'.'
name|'_empty_app'
op|','
name|'_limits'
op|','
nl|'\n'
string|'"%s.MockLimiter"'
op|'%'
nl|'\n'
name|'self'
op|'.'
name|'__class__'
op|'.'
name|'__module__'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_limit_class
dedent|''
name|'def'
name|'test_limit_class'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test that middleware selected correct limiter class.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertIsInstance'
op|'('
name|'self'
op|'.'
name|'app'
op|'.'
name|'_limiter'
op|','
name|'MockLimiter'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_good_request
dedent|''
name|'def'
name|'test_good_request'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test successful GET request through middleware.'
nl|'\n'
indent|'        '
name|'request'
op|'='
name|'webob'
op|'.'
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/"'
op|')'
newline|'\n'
name|'response'
op|'='
name|'request'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'200'
op|','
name|'response'
op|'.'
name|'status_int'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_limited_request_json
dedent|''
name|'def'
name|'test_limited_request_json'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test a rate-limited (429) GET request through middleware.'
nl|'\n'
indent|'        '
name|'request'
op|'='
name|'webob'
op|'.'
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/"'
op|')'
newline|'\n'
name|'response'
op|'='
name|'request'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'200'
op|','
name|'response'
op|'.'
name|'status_int'
op|')'
newline|'\n'
nl|'\n'
name|'request'
op|'='
name|'webob'
op|'.'
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/"'
op|')'
newline|'\n'
name|'response'
op|'='
name|'request'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|'.'
name|'status_int'
op|','
number|'429'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'Retry-After'"
op|','
name|'response'
op|'.'
name|'headers'
op|')'
newline|'\n'
name|'retry_after'
op|'='
name|'int'
op|'('
name|'response'
op|'.'
name|'headers'
op|'['
string|"'Retry-After'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertAlmostEqual'
op|'('
name|'retry_after'
op|','
number|'60'
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
name|'body'
op|'='
name|'jsonutils'
op|'.'
name|'loads'
op|'('
name|'response'
op|'.'
name|'body'
op|')'
newline|'\n'
name|'expected'
op|'='
string|'"Only 1 GET request(s) can be made to * every minute."'
newline|'\n'
name|'value'
op|'='
name|'body'
op|'['
string|'"overLimit"'
op|']'
op|'['
string|'"details"'
op|']'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'value'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|'"retryAfter"'
op|','
name|'body'
op|'['
string|'"overLimit"'
op|']'
op|')'
newline|'\n'
name|'retryAfter'
op|'='
name|'body'
op|'['
string|'"overLimit"'
op|']'
op|'['
string|'"retryAfter"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'retryAfter'
op|','
string|'"60"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|LimitTest
dedent|''
dedent|''
name|'class'
name|'LimitTest'
op|'('
name|'BaseLimitTestSuite'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Tests for the `limits.Limit` class."""'
newline|'\n'
nl|'\n'
DECL|member|test_GET_no_delay
name|'def'
name|'test_GET_no_delay'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test a limit handles 1 GET per second.'
nl|'\n'
indent|'        '
name|'limit'
op|'='
name|'limits'
op|'.'
name|'Limit'
op|'('
string|'"GET"'
op|','
string|'"*"'
op|','
string|'".*"'
op|','
number|'1'
op|','
number|'1'
op|')'
newline|'\n'
name|'delay'
op|'='
name|'limit'
op|'('
string|'"GET"'
op|','
string|'"/anything"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'delay'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'limit'
op|'.'
name|'next_request'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'limit'
op|'.'
name|'last_request'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_GET_delay
dedent|''
name|'def'
name|'test_GET_delay'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test two calls to 1 GET per second limit.'
nl|'\n'
indent|'        '
name|'limit'
op|'='
name|'limits'
op|'.'
name|'Limit'
op|'('
string|'"GET"'
op|','
string|'"*"'
op|','
string|'".*"'
op|','
number|'1'
op|','
number|'1'
op|')'
newline|'\n'
name|'delay'
op|'='
name|'limit'
op|'('
string|'"GET"'
op|','
string|'"/anything"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'delay'
op|')'
newline|'\n'
nl|'\n'
name|'delay'
op|'='
name|'limit'
op|'('
string|'"GET"'
op|','
string|'"/anything"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'delay'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'limit'
op|'.'
name|'next_request'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'limit'
op|'.'
name|'last_request'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'time'
op|'+='
number|'4'
newline|'\n'
nl|'\n'
name|'delay'
op|'='
name|'limit'
op|'('
string|'"GET"'
op|','
string|'"/anything"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'delay'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'4'
op|','
name|'limit'
op|'.'
name|'next_request'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'4'
op|','
name|'limit'
op|'.'
name|'last_request'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ParseLimitsTest
dedent|''
dedent|''
name|'class'
name|'ParseLimitsTest'
op|'('
name|'BaseLimitTestSuite'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Tests for the default limits parser in the in-memory\n    `limits.Limiter` class.\n    """'
newline|'\n'
nl|'\n'
DECL|member|test_invalid
name|'def'
name|'test_invalid'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test that parse_limits() handles invalid input correctly.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'limits'
op|'.'
name|'Limiter'
op|'.'
name|'parse_limits'
op|','
nl|'\n'
string|"';;;;;'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bad_rule
dedent|''
name|'def'
name|'test_bad_rule'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test that parse_limits() handles bad rules correctly.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'limits'
op|'.'
name|'Limiter'
op|'.'
name|'parse_limits'
op|','
nl|'\n'
string|"'GET, *, .*, 20, minute'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_missing_arg
dedent|''
name|'def'
name|'test_missing_arg'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test that parse_limits() handles missing args correctly.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'limits'
op|'.'
name|'Limiter'
op|'.'
name|'parse_limits'
op|','
nl|'\n'
string|"'(GET, *, .*, 20)'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bad_value
dedent|''
name|'def'
name|'test_bad_value'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test that parse_limits() handles bad values correctly.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'limits'
op|'.'
name|'Limiter'
op|'.'
name|'parse_limits'
op|','
nl|'\n'
string|"'(GET, *, .*, foo, minute)'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_bad_unit
dedent|''
name|'def'
name|'test_bad_unit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test that parse_limits() handles bad units correctly.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
name|'limits'
op|'.'
name|'Limiter'
op|'.'
name|'parse_limits'
op|','
nl|'\n'
string|"'(GET, *, .*, 20, lightyears)'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiple_rules
dedent|''
name|'def'
name|'test_multiple_rules'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test that parse_limits() handles multiple rules correctly.'
nl|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'l'
op|'='
name|'limits'
op|'.'
name|'Limiter'
op|'.'
name|'parse_limits'
op|'('
string|"'(get, *, .*, 20, minute);'"
nl|'\n'
string|"'(PUT, /foo*, /foo.*, 10, hour);'"
nl|'\n'
string|"'(POST, /bar*, /bar.*, 5, second);'"
nl|'\n'
string|"'(Say, /derp*, /derp.*, 1, day)'"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'assert'
name|'False'
op|','
name|'six'
op|'.'
name|'text_type'
op|'('
name|'e'
op|')'
newline|'\n'
nl|'\n'
comment|'# Make sure the number of returned limits are correct'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'l'
op|')'
op|','
number|'4'
op|')'
newline|'\n'
nl|'\n'
comment|'# Check all the verbs...'
nl|'\n'
name|'expected'
op|'='
op|'['
string|"'GET'"
op|','
string|"'PUT'"
op|','
string|"'POST'"
op|','
string|"'SAY'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
name|'t'
op|'.'
name|'verb'
name|'for'
name|'t'
name|'in'
name|'l'
op|']'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
comment|'# ...the URIs...'
nl|'\n'
name|'expected'
op|'='
op|'['
string|"'*'"
op|','
string|"'/foo*'"
op|','
string|"'/bar*'"
op|','
string|"'/derp*'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
name|'t'
op|'.'
name|'uri'
name|'for'
name|'t'
name|'in'
name|'l'
op|']'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
comment|'# ...the regexes...'
nl|'\n'
name|'expected'
op|'='
op|'['
string|"'.*'"
op|','
string|"'/foo.*'"
op|','
string|"'/bar.*'"
op|','
string|"'/derp.*'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
name|'t'
op|'.'
name|'regex'
name|'for'
name|'t'
name|'in'
name|'l'
op|']'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
comment|'# ...the values...'
nl|'\n'
name|'expected'
op|'='
op|'['
number|'20'
op|','
number|'10'
op|','
number|'5'
op|','
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
name|'t'
op|'.'
name|'value'
name|'for'
name|'t'
name|'in'
name|'l'
op|']'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
comment|'# ...and the units...'
nl|'\n'
name|'expected'
op|'='
op|'['
name|'utils'
op|'.'
name|'TIME_UNITS'
op|'['
string|"'MINUTE'"
op|']'
op|','
name|'utils'
op|'.'
name|'TIME_UNITS'
op|'['
string|"'HOUR'"
op|']'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'TIME_UNITS'
op|'['
string|"'SECOND'"
op|']'
op|','
name|'utils'
op|'.'
name|'TIME_UNITS'
op|'['
string|"'DAY'"
op|']'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
name|'t'
op|'.'
name|'unit'
name|'for'
name|'t'
name|'in'
name|'l'
op|']'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|LimiterTest
dedent|''
dedent|''
name|'class'
name|'LimiterTest'
op|'('
name|'BaseLimitTestSuite'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Tests for the in-memory `limits.Limiter` class."""'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Run before each test."""'
newline|'\n'
name|'super'
op|'('
name|'LimiterTest'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'userlimits'
op|'='
op|'{'
string|"'limits.user3'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'limits.user0'"
op|':'
string|"'(get, *, .*, 4, minute);'"
nl|'\n'
string|"'(put, *, .*, 2, minute)'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'limiter'
op|'='
name|'limits'
op|'.'
name|'Limiter'
op|'('
name|'TEST_LIMITS'
op|','
op|'**'
name|'userlimits'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_check
dedent|''
name|'def'
name|'_check'
op|'('
name|'self'
op|','
name|'num'
op|','
name|'verb'
op|','
name|'url'
op|','
name|'username'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Check and yield results from checks."""'
newline|'\n'
name|'for'
name|'x'
name|'in'
name|'xrange'
op|'('
name|'num'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'yield'
name|'self'
op|'.'
name|'limiter'
op|'.'
name|'check_for_delay'
op|'('
name|'verb'
op|','
name|'url'
op|','
name|'username'
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
DECL|member|_check_sum
dedent|''
dedent|''
name|'def'
name|'_check_sum'
op|'('
name|'self'
op|','
name|'num'
op|','
name|'verb'
op|','
name|'url'
op|','
name|'username'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Check and sum results from checks."""'
newline|'\n'
name|'results'
op|'='
name|'self'
op|'.'
name|'_check'
op|'('
name|'num'
op|','
name|'verb'
op|','
name|'url'
op|','
name|'username'
op|')'
newline|'\n'
name|'return'
name|'sum'
op|'('
name|'item'
name|'for'
name|'item'
name|'in'
name|'results'
name|'if'
name|'item'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_no_delay_GET
dedent|''
name|'def'
name|'test_no_delay_GET'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Simple test to ensure no delay on a single call for a limit verb we\n        didn"t set.\n        """'
newline|'\n'
name|'delay'
op|'='
name|'self'
op|'.'
name|'limiter'
op|'.'
name|'check_for_delay'
op|'('
string|'"GET"'
op|','
string|'"/anything"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'delay'
op|','
op|'('
name|'None'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_no_delay_PUT
dedent|''
name|'def'
name|'test_no_delay_PUT'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Simple test to ensure no delay on a single call for a known limit.'
nl|'\n'
indent|'        '
name|'delay'
op|'='
name|'self'
op|'.'
name|'limiter'
op|'.'
name|'check_for_delay'
op|'('
string|'"PUT"'
op|','
string|'"/anything"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'delay'
op|','
op|'('
name|'None'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delay_PUT
dedent|''
name|'def'
name|'test_delay_PUT'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Ensure the 11th PUT will result in a delay of 6.0 seconds until\n        the next request will be granced.\n        """'
newline|'\n'
name|'expected'
op|'='
op|'['
name|'None'
op|']'
op|'*'
number|'10'
op|'+'
op|'['
number|'6.0'
op|']'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'11'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delay_POST
dedent|''
name|'def'
name|'test_delay_POST'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Ensure the 8th POST will result in a delay of 6.0 seconds until\n        the next request will be granced.\n        """'
newline|'\n'
name|'expected'
op|'='
op|'['
name|'None'
op|']'
op|'*'
number|'7'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'7'
op|','
string|'"POST"'
op|','
string|'"/anything"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
number|'60.0'
op|'/'
number|'7.0'
newline|'\n'
name|'results'
op|'='
name|'self'
op|'.'
name|'_check_sum'
op|'('
number|'1'
op|','
string|'"POST"'
op|','
string|'"/anything"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertAlmostEqual'
op|'('
name|'expected'
op|','
name|'results'
op|','
number|'8'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delay_GET
dedent|''
name|'def'
name|'test_delay_GET'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Ensure the 11th GET will result in NO delay.'
nl|'\n'
indent|'        '
name|'expected'
op|'='
op|'['
name|'None'
op|']'
op|'*'
number|'11'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'11'
op|','
string|'"GET"'
op|','
string|'"/anything"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'['
name|'None'
op|']'
op|'*'
number|'4'
op|'+'
op|'['
number|'15.0'
op|']'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'5'
op|','
string|'"GET"'
op|','
string|'"/foo"'
op|','
string|'"user0"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delay_PUT_servers
dedent|''
name|'def'
name|'test_delay_PUT_servers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Ensure PUT on /servers limits at 5 requests, and PUT elsewhere is\n        still OK after 5 requests...but then after 11 total requests, PUT\n        limiting kicks in.\n        """'
newline|'\n'
comment|'# First 6 requests on PUT /servers'
nl|'\n'
name|'expected'
op|'='
op|'['
name|'None'
op|']'
op|'*'
number|'5'
op|'+'
op|'['
number|'12.0'
op|']'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'6'
op|','
string|'"PUT"'
op|','
string|'"/servers"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
comment|'# Next 5 request on PUT /anything'
nl|'\n'
name|'expected'
op|'='
op|'['
name|'None'
op|']'
op|'*'
number|'4'
op|'+'
op|'['
number|'6.0'
op|']'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'5'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delay_PUT_wait
dedent|''
name|'def'
name|'test_delay_PUT_wait'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Ensure after hitting the limit and then waiting for the correct\n        amount of time, the limit will be lifted.\n        """'
newline|'\n'
name|'expected'
op|'='
op|'['
name|'None'
op|']'
op|'*'
number|'10'
op|'+'
op|'['
number|'6.0'
op|']'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'11'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
comment|'# Advance time'
nl|'\n'
name|'self'
op|'.'
name|'time'
op|'+='
number|'6.0'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'['
name|'None'
op|','
number|'6.0'
op|']'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'2'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiple_delays
dedent|''
name|'def'
name|'test_multiple_delays'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Ensure multiple requests still get a delay.'
nl|'\n'
indent|'        '
name|'expected'
op|'='
op|'['
name|'None'
op|']'
op|'*'
number|'10'
op|'+'
op|'['
number|'6.0'
op|']'
op|'*'
number|'10'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'20'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'time'
op|'+='
number|'1.0'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'['
number|'5.0'
op|']'
op|'*'
number|'10'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'10'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'['
name|'None'
op|']'
op|'*'
number|'2'
op|'+'
op|'['
number|'30.0'
op|']'
op|'*'
number|'8'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'10'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|','
string|'"user0"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_user_limit
dedent|''
name|'def'
name|'test_user_limit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test user-specific limits.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'limiter'
op|'.'
name|'levels'
op|'['
string|"'user3'"
op|']'
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'self'
op|'.'
name|'limiter'
op|'.'
name|'levels'
op|'['
string|"'user0'"
op|']'
op|')'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_multiple_users
dedent|''
name|'def'
name|'test_multiple_users'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Tests involving multiple users.'
nl|'\n'
comment|'# User0'
nl|'\n'
indent|'        '
name|'expected'
op|'='
op|'['
name|'None'
op|']'
op|'*'
number|'2'
op|'+'
op|'['
number|'30.0'
op|']'
op|'*'
number|'8'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'10'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|','
string|'"user0"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
comment|'# User1'
nl|'\n'
name|'expected'
op|'='
op|'['
name|'None'
op|']'
op|'*'
number|'10'
op|'+'
op|'['
number|'6.0'
op|']'
op|'*'
number|'10'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'20'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|','
string|'"user1"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
comment|'# User2'
nl|'\n'
name|'expected'
op|'='
op|'['
name|'None'
op|']'
op|'*'
number|'10'
op|'+'
op|'['
number|'6.0'
op|']'
op|'*'
number|'5'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'15'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|','
string|'"user2"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
comment|'# User3'
nl|'\n'
name|'expected'
op|'='
op|'['
name|'None'
op|']'
op|'*'
number|'20'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'20'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|','
string|'"user3"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'time'
op|'+='
number|'1.0'
newline|'\n'
nl|'\n'
comment|'# User1 again'
nl|'\n'
name|'expected'
op|'='
op|'['
number|'5.0'
op|']'
op|'*'
number|'10'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'10'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|','
string|'"user1"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'time'
op|'+='
number|'1.0'
newline|'\n'
nl|'\n'
comment|'# User1 again'
nl|'\n'
name|'expected'
op|'='
op|'['
number|'4.0'
op|']'
op|'*'
number|'5'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'5'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|','
string|'"user2"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
comment|'# User0 again'
nl|'\n'
name|'expected'
op|'='
op|'['
number|'28.0'
op|']'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'1'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|','
string|'"user0"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'time'
op|'+='
number|'28.0'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'['
name|'None'
op|','
number|'30.0'
op|']'
newline|'\n'
name|'results'
op|'='
name|'list'
op|'('
name|'self'
op|'.'
name|'_check'
op|'('
number|'2'
op|','
string|'"PUT"'
op|','
string|'"/anything"'
op|','
string|'"user0"'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'results'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|WsgiLimiterTest
dedent|''
dedent|''
name|'class'
name|'WsgiLimiterTest'
op|'('
name|'BaseLimitTestSuite'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Tests for `limits.WsgiLimiter` class."""'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Run before each test."""'
newline|'\n'
name|'super'
op|'('
name|'WsgiLimiterTest'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'='
name|'limits'
op|'.'
name|'WsgiLimiter'
op|'('
name|'TEST_LIMITS'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_request_data
dedent|''
name|'def'
name|'_request_data'
op|'('
name|'self'
op|','
name|'verb'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Get data describing a limit request verb/path."""'
newline|'\n'
name|'return'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"verb"'
op|':'
name|'verb'
op|','
string|'"path"'
op|':'
name|'path'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_request
dedent|''
name|'def'
name|'_request'
op|'('
name|'self'
op|','
name|'verb'
op|','
name|'url'
op|','
name|'username'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Make sure that POSTing to the given url causes the given username\n        to perform the given action.  Make the internal rate limiter return\n        delay and make sure that the WSGI app returns the correct response.\n        """'
newline|'\n'
name|'if'
name|'username'
op|':'
newline|'\n'
indent|'            '
name|'request'
op|'='
name|'webob'
op|'.'
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/%s"'
op|'%'
name|'username'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'request'
op|'='
name|'webob'
op|'.'
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'request'
op|'.'
name|'method'
op|'='
string|'"POST"'
newline|'\n'
name|'request'
op|'.'
name|'body'
op|'='
name|'self'
op|'.'
name|'_request_data'
op|'('
name|'verb'
op|','
name|'url'
op|')'
newline|'\n'
name|'response'
op|'='
name|'request'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
nl|'\n'
name|'if'
string|'"X-Wait-Seconds"'
name|'in'
name|'response'
op|'.'
name|'headers'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|'.'
name|'status_int'
op|','
number|'403'
op|')'
newline|'\n'
name|'return'
name|'response'
op|'.'
name|'headers'
op|'['
string|'"X-Wait-Seconds"'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_invalid_methods
dedent|''
name|'def'
name|'test_invalid_methods'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Only POSTs should work.'
nl|'\n'
indent|'        '
name|'for'
name|'method'
name|'in'
op|'['
string|'"GET"'
op|','
string|'"PUT"'
op|','
string|'"DELETE"'
op|','
string|'"HEAD"'
op|','
string|'"OPTIONS"'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'request'
op|'='
name|'webob'
op|'.'
name|'Request'
op|'.'
name|'blank'
op|'('
string|'"/"'
op|','
name|'method'
op|'='
name|'method'
op|')'
newline|'\n'
name|'response'
op|'='
name|'request'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'response'
op|'.'
name|'status_int'
op|','
number|'405'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_good_url
dedent|''
dedent|''
name|'def'
name|'test_good_url'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'delay'
op|'='
name|'self'
op|'.'
name|'_request'
op|'('
string|'"GET"'
op|','
string|'"/something"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'delay'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_escaping
dedent|''
name|'def'
name|'test_escaping'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'delay'
op|'='
name|'self'
op|'.'
name|'_request'
op|'('
string|'"GET"'
op|','
string|'"/something/jump%20up"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'delay'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_response_to_delays
dedent|''
name|'def'
name|'test_response_to_delays'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'delay'
op|'='
name|'self'
op|'.'
name|'_request'
op|'('
string|'"GET"'
op|','
string|'"/delayed"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'delay'
op|')'
newline|'\n'
nl|'\n'
name|'delay'
op|'='
name|'self'
op|'.'
name|'_request'
op|'('
string|'"GET"'
op|','
string|'"/delayed"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'delay'
op|','
string|"'60.00'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_response_to_delays_usernames
dedent|''
name|'def'
name|'test_response_to_delays_usernames'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'delay'
op|'='
name|'self'
op|'.'
name|'_request'
op|'('
string|'"GET"'
op|','
string|'"/delayed"'
op|','
string|'"user1"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'delay'
op|')'
newline|'\n'
nl|'\n'
name|'delay'
op|'='
name|'self'
op|'.'
name|'_request'
op|'('
string|'"GET"'
op|','
string|'"/delayed"'
op|','
string|'"user2"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'delay'
op|')'
newline|'\n'
nl|'\n'
name|'delay'
op|'='
name|'self'
op|'.'
name|'_request'
op|'('
string|'"GET"'
op|','
string|'"/delayed"'
op|','
string|'"user1"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'delay'
op|','
string|"'60.00'"
op|')'
newline|'\n'
nl|'\n'
name|'delay'
op|'='
name|'self'
op|'.'
name|'_request'
op|'('
string|'"GET"'
op|','
string|'"/delayed"'
op|','
string|'"user2"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'delay'
op|','
string|"'60.00'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeHttplibSocket
dedent|''
dedent|''
name|'class'
name|'FakeHttplibSocket'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Fake `httplib.HTTPResponse` replacement."""'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'response_string'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Initialize new `FakeHttplibSocket`."""'
newline|'\n'
name|'self'
op|'.'
name|'_buffer'
op|'='
name|'StringIO'
op|'.'
name|'StringIO'
op|'('
name|'response_string'
op|')'
newline|'\n'
nl|'\n'
DECL|member|makefile
dedent|''
name|'def'
name|'makefile'
op|'('
name|'self'
op|','
name|'_mode'
op|','
name|'_other'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Returns the socket\'s internal buffer."""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'_buffer'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeHttplibConnection
dedent|''
dedent|''
name|'class'
name|'FakeHttplibConnection'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Fake `httplib.HTTPConnection`."""'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'app'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Initialize `FakeHttplibConnection`."""'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'='
name|'app'
newline|'\n'
name|'self'
op|'.'
name|'host'
op|'='
name|'host'
newline|'\n'
nl|'\n'
DECL|member|request
dedent|''
name|'def'
name|'request'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'path'
op|','
name|'body'
op|'='
string|'""'
op|','
name|'headers'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Requests made via this connection actually get translated and routed\n        into our WSGI app, we then wait for the response and turn it back into\n        an `httplib.HTTPResponse`.\n        """'
newline|'\n'
name|'if'
name|'not'
name|'headers'
op|':'
newline|'\n'
indent|'            '
name|'headers'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
dedent|''
name|'req'
op|'='
name|'webob'
op|'.'
name|'Request'
op|'.'
name|'blank'
op|'('
name|'path'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'method'
op|'='
name|'method'
newline|'\n'
name|'req'
op|'.'
name|'headers'
op|'='
name|'headers'
newline|'\n'
name|'req'
op|'.'
name|'host'
op|'='
name|'self'
op|'.'
name|'host'
newline|'\n'
name|'req'
op|'.'
name|'body'
op|'='
name|'body'
newline|'\n'
nl|'\n'
name|'resp'
op|'='
name|'str'
op|'('
name|'req'
op|'.'
name|'get_response'
op|'('
name|'self'
op|'.'
name|'app'
op|')'
op|')'
newline|'\n'
name|'resp'
op|'='
string|'"HTTP/1.0 %s"'
op|'%'
name|'resp'
newline|'\n'
name|'sock'
op|'='
name|'FakeHttplibSocket'
op|'('
name|'resp'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'http_response'
op|'='
name|'httplib'
op|'.'
name|'HTTPResponse'
op|'('
name|'sock'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'http_response'
op|'.'
name|'begin'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|getresponse
dedent|''
name|'def'
name|'getresponse'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Return our generated response from the request."""'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'http_response'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|wire_HTTPConnection_to_WSGI
dedent|''
dedent|''
name|'def'
name|'wire_HTTPConnection_to_WSGI'
op|'('
name|'host'
op|','
name|'app'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Monkeypatches HTTPConnection so that if you try to connect to host, you\n    are instead routed straight to the given WSGI app.\n\n    After calling this method, when any code calls\n\n    httplib.HTTPConnection(host)\n\n    the connection object will be a fake.  Its requests will be sent directly\n    to the given WSGI app rather than through a socket.\n\n    Code connecting to hosts other than host will not be affected.\n\n    This method may be called multiple times to map different hosts to\n    different apps.\n\n    This method returns the original HTTPConnection object, so that the caller\n    can restore the default HTTPConnection interface (for all hosts).\n    """'
newline|'\n'
DECL|class|HTTPConnectionDecorator
name|'class'
name|'HTTPConnectionDecorator'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Wraps the real HTTPConnection class so that when you instantiate\n        the class you might instead get a fake instance.\n        """'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'wrapped'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'wrapped'
op|'='
name|'wrapped'
newline|'\n'
nl|'\n'
DECL|member|__call__
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'connection_host'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'connection_host'
op|'=='
name|'host'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'FakeHttplibConnection'
op|'('
name|'app'
op|','
name|'host'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'self'
op|'.'
name|'wrapped'
op|'('
name|'connection_host'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'oldHTTPConnection'
op|'='
name|'httplib'
op|'.'
name|'HTTPConnection'
newline|'\n'
name|'httplib'
op|'.'
name|'HTTPConnection'
op|'='
name|'HTTPConnectionDecorator'
op|'('
name|'httplib'
op|'.'
name|'HTTPConnection'
op|')'
newline|'\n'
name|'return'
name|'oldHTTPConnection'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|WsgiLimiterProxyTest
dedent|''
name|'class'
name|'WsgiLimiterProxyTest'
op|'('
name|'BaseLimitTestSuite'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Tests for the `limits.WsgiLimiterProxy` class."""'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Do some nifty HTTP/WSGI magic which allows for WSGI to be called\n        directly by something like the `httplib` library.\n        """'
newline|'\n'
name|'super'
op|'('
name|'WsgiLimiterProxyTest'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'='
name|'limits'
op|'.'
name|'WsgiLimiter'
op|'('
name|'TEST_LIMITS'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'oldHTTPConnection'
op|'='
op|'('
nl|'\n'
name|'wire_HTTPConnection_to_WSGI'
op|'('
string|'"169.254.0.1:80"'
op|','
name|'self'
op|'.'
name|'app'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'proxy'
op|'='
name|'limits'
op|'.'
name|'WsgiLimiterProxy'
op|'('
string|'"169.254.0.1:80"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_200
dedent|''
name|'def'
name|'test_200'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Successful request test.'
nl|'\n'
indent|'        '
name|'delay'
op|'='
name|'self'
op|'.'
name|'proxy'
op|'.'
name|'check_for_delay'
op|'('
string|'"GET"'
op|','
string|'"/anything"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'delay'
op|','
op|'('
name|'None'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_403
dedent|''
name|'def'
name|'test_403'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Forbidden request test.'
nl|'\n'
indent|'        '
name|'delay'
op|'='
name|'self'
op|'.'
name|'proxy'
op|'.'
name|'check_for_delay'
op|'('
string|'"GET"'
op|','
string|'"/delayed"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'delay'
op|','
op|'('
name|'None'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'delay'
op|','
name|'error'
op|'='
name|'self'
op|'.'
name|'proxy'
op|'.'
name|'check_for_delay'
op|'('
string|'"GET"'
op|','
string|'"/delayed"'
op|')'
newline|'\n'
name|'error'
op|'='
name|'error'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'('
string|'"60.00"'
op|','
string|'"403 Forbidden\\n\\nOnly 1 GET request(s) can be "'
nl|'\n'
string|'"made to /delayed every minute."'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'('
name|'delay'
op|','
name|'error'
op|')'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# restore original HTTPConnection object'
nl|'\n'
indent|'        '
name|'httplib'
op|'.'
name|'HTTPConnection'
op|'='
name|'self'
op|'.'
name|'oldHTTPConnection'
newline|'\n'
name|'super'
op|'('
name|'WsgiLimiterProxyTest'
op|','
name|'self'
op|')'
op|'.'
name|'tearDown'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|LimitsViewBuilderTest
dedent|''
dedent|''
name|'class'
name|'LimitsViewBuilderTest'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'LimitsViewBuilderTest'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'view_builder'
op|'='
name|'views'
op|'.'
name|'limits'
op|'.'
name|'ViewBuilder'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'rate_limits'
op|'='
op|'['
op|'{'
string|'"URI"'
op|':'
string|'"*"'
op|','
nl|'\n'
string|'"regex"'
op|':'
string|'".*"'
op|','
nl|'\n'
string|'"value"'
op|':'
number|'10'
op|','
nl|'\n'
string|'"verb"'
op|':'
string|'"POST"'
op|','
nl|'\n'
string|'"remaining"'
op|':'
number|'2'
op|','
nl|'\n'
string|'"unit"'
op|':'
string|'"MINUTE"'
op|','
nl|'\n'
string|'"resetTime"'
op|':'
number|'1311272226'
op|'}'
op|','
nl|'\n'
op|'{'
string|'"URI"'
op|':'
string|'"*/servers"'
op|','
nl|'\n'
string|'"regex"'
op|':'
string|'"^/servers"'
op|','
nl|'\n'
string|'"value"'
op|':'
number|'50'
op|','
nl|'\n'
string|'"verb"'
op|':'
string|'"POST"'
op|','
nl|'\n'
string|'"remaining"'
op|':'
number|'10'
op|','
nl|'\n'
string|'"unit"'
op|':'
string|'"DAY"'
op|','
nl|'\n'
string|'"resetTime"'
op|':'
number|'1311272226'
op|'}'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'absolute_limits'
op|'='
op|'{'
string|'"metadata_items"'
op|':'
number|'1'
op|','
nl|'\n'
string|'"injected_files"'
op|':'
number|'5'
op|','
nl|'\n'
string|'"injected_file_content_bytes"'
op|':'
number|'5'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|test_build_limits
dedent|''
name|'def'
name|'test_build_limits'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expected_limits'
op|'='
op|'{'
string|'"limits"'
op|':'
op|'{'
nl|'\n'
string|'"rate"'
op|':'
op|'['
op|'{'
nl|'\n'
string|'"uri"'
op|':'
string|'"*"'
op|','
nl|'\n'
string|'"regex"'
op|':'
string|'".*"'
op|','
nl|'\n'
string|'"limit"'
op|':'
op|'['
op|'{'
string|'"value"'
op|':'
number|'10'
op|','
nl|'\n'
string|'"verb"'
op|':'
string|'"POST"'
op|','
nl|'\n'
string|'"remaining"'
op|':'
number|'2'
op|','
nl|'\n'
string|'"unit"'
op|':'
string|'"MINUTE"'
op|','
nl|'\n'
string|'"next-available"'
op|':'
string|'"2011-07-21T18:17:06Z"'
op|'}'
op|']'
op|'}'
op|','
nl|'\n'
op|'{'
string|'"uri"'
op|':'
string|'"*/servers"'
op|','
nl|'\n'
string|'"regex"'
op|':'
string|'"^/servers"'
op|','
nl|'\n'
string|'"limit"'
op|':'
op|'['
op|'{'
string|'"value"'
op|':'
number|'50'
op|','
nl|'\n'
string|'"verb"'
op|':'
string|'"POST"'
op|','
nl|'\n'
string|'"remaining"'
op|':'
number|'10'
op|','
nl|'\n'
string|'"unit"'
op|':'
string|'"DAY"'
op|','
nl|'\n'
string|'"next-available"'
op|':'
string|'"2011-07-21T18:17:06Z"'
op|'}'
op|']'
op|'}'
op|']'
op|','
nl|'\n'
string|'"absolute"'
op|':'
op|'{'
string|'"maxServerMeta"'
op|':'
number|'1'
op|','
nl|'\n'
string|'"maxImageMeta"'
op|':'
number|'1'
op|','
nl|'\n'
string|'"maxPersonality"'
op|':'
number|'5'
op|','
nl|'\n'
string|'"maxPersonalitySize"'
op|':'
number|'5'
op|'}'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'output'
op|'='
name|'self'
op|'.'
name|'view_builder'
op|'.'
name|'build'
op|'('
name|'self'
op|'.'
name|'rate_limits'
op|','
nl|'\n'
name|'self'
op|'.'
name|'absolute_limits'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertThat'
op|'('
name|'output'
op|','
name|'matchers'
op|'.'
name|'DictMatches'
op|'('
name|'expected_limits'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_build_limits_empty_limits
dedent|''
name|'def'
name|'test_build_limits_empty_limits'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expected_limits'
op|'='
op|'{'
string|'"limits"'
op|':'
op|'{'
string|'"rate"'
op|':'
op|'['
op|']'
op|','
nl|'\n'
string|'"absolute"'
op|':'
op|'{'
op|'}'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'abs_limits'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'rate_limits'
op|'='
op|'['
op|']'
newline|'\n'
name|'output'
op|'='
name|'self'
op|'.'
name|'view_builder'
op|'.'
name|'build'
op|'('
name|'rate_limits'
op|','
name|'abs_limits'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertThat'
op|'('
name|'output'
op|','
name|'matchers'
op|'.'
name|'DictMatches'
op|'('
name|'expected_limits'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
