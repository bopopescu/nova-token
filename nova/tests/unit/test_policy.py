begin_unit
comment|'# Copyright 2011 Piston Cloud Computing, Inc.'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
string|'"""Test of Policy Engine For Nova."""'
newline|'\n'
nl|'\n'
name|'import'
name|'os'
op|'.'
name|'path'
newline|'\n'
nl|'\n'
name|'from'
name|'oslo_policy'
name|'import'
name|'policy'
name|'as'
name|'oslo_policy'
newline|'\n'
name|'from'
name|'oslo_serialization'
name|'import'
name|'jsonutils'
newline|'\n'
name|'import'
name|'requests_mock'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'context'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'policy'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
name|'import'
name|'fake_policy'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'unit'
name|'import'
name|'policy_fixture'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'utils'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|PolicyFileTestCase
name|'class'
name|'PolicyFileTestCase'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'PolicyFileTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'context'
op|'.'
name|'RequestContext'
op|'('
string|"'fake'"
op|','
string|"'fake'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'target'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|test_modified_policy_reloads
dedent|''
name|'def'
name|'test_modified_policy_reloads'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'with'
name|'utils'
op|'.'
name|'tempdir'
op|'('
op|')'
name|'as'
name|'tmpdir'
op|':'
newline|'\n'
indent|'            '
name|'tmpfilename'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'tmpdir'
op|','
string|"'policy'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'policy_file'
op|'='
name|'tmpfilename'
op|','
name|'group'
op|'='
string|"'oslo_policy'"
op|')'
newline|'\n'
nl|'\n'
comment|'# NOTE(uni): context construction invokes policy check to determin'
nl|'\n'
comment|'# is_admin or not. As a side-effect, policy reset is needed here'
nl|'\n'
comment|'# to flush existing policy cache.'
nl|'\n'
name|'policy'
op|'.'
name|'reset'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'action'
op|'='
string|'"example:test"'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'tmpfilename'
op|','
string|'"w"'
op|')'
name|'as'
name|'policyfile'
op|':'
newline|'\n'
indent|'                '
name|'policyfile'
op|'.'
name|'write'
op|'('
string|'\'{"example:test": ""}\''
op|')'
newline|'\n'
dedent|''
name|'policy'
op|'.'
name|'enforce'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'action'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
name|'with'
name|'open'
op|'('
name|'tmpfilename'
op|','
string|'"w"'
op|')'
name|'as'
name|'policyfile'
op|':'
newline|'\n'
indent|'                '
name|'policyfile'
op|'.'
name|'write'
op|'('
string|'\'{"example:test": "!"}\''
op|')'
newline|'\n'
dedent|''
name|'policy'
op|'.'
name|'_ENFORCER'
op|'.'
name|'load_rules'
op|'('
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
name|'policy'
op|'.'
name|'enforce'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'action'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|PolicyTestCase
dedent|''
dedent|''
dedent|''
name|'class'
name|'PolicyTestCase'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'PolicyTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'rules'
op|'='
op|'{'
nl|'\n'
string|'"true"'
op|':'
string|"'@'"
op|','
nl|'\n'
string|'"example:allowed"'
op|':'
string|"'@'"
op|','
nl|'\n'
string|'"example:denied"'
op|':'
string|'"!"'
op|','
nl|'\n'
string|'"example:get_http"'
op|':'
string|'"http://www.example.com"'
op|','
nl|'\n'
string|'"example:my_file"'
op|':'
string|'"role:compute_admin or "'
nl|'\n'
string|'"project_id:%(project_id)s"'
op|','
nl|'\n'
string|'"example:early_and_fail"'
op|':'
string|'"! and @"'
op|','
nl|'\n'
string|'"example:early_or_success"'
op|':'
string|'"@ or !"'
op|','
nl|'\n'
string|'"example:lowercase_admin"'
op|':'
string|'"role:admin or role:sysadmin"'
op|','
nl|'\n'
string|'"example:uppercase_admin"'
op|':'
string|'"role:ADMIN or role:sysadmin"'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'policy'
op|'.'
name|'reset'
op|'('
op|')'
newline|'\n'
name|'policy'
op|'.'
name|'init'
op|'('
op|')'
newline|'\n'
name|'policy'
op|'.'
name|'set_rules'
op|'('
name|'oslo_policy'
op|'.'
name|'Rules'
op|'.'
name|'from_dict'
op|'('
name|'rules'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'context'
op|'.'
name|'RequestContext'
op|'('
string|"'fake'"
op|','
string|"'fake'"
op|','
name|'roles'
op|'='
op|'['
string|"'member'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'target'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|test_enforce_nonexistent_action_throws
dedent|''
name|'def'
name|'test_enforce_nonexistent_action_throws'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'action'
op|'='
string|'"example:noexist"'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
name|'policy'
op|'.'
name|'enforce'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'action'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_enforce_bad_action_throws
dedent|''
name|'def'
name|'test_enforce_bad_action_throws'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'action'
op|'='
string|'"example:denied"'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
name|'policy'
op|'.'
name|'enforce'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'action'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_enforce_bad_action_noraise
dedent|''
name|'def'
name|'test_enforce_bad_action_noraise'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'action'
op|'='
string|'"example:denied"'
newline|'\n'
name|'result'
op|'='
name|'policy'
op|'.'
name|'enforce'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'action'
op|','
name|'self'
op|'.'
name|'target'
op|','
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_enforce_good_action
dedent|''
name|'def'
name|'test_enforce_good_action'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'action'
op|'='
string|'"example:allowed"'
newline|'\n'
name|'result'
op|'='
name|'policy'
op|'.'
name|'enforce'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'action'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'requests_mock'
op|'.'
name|'mock'
op|'('
op|')'
newline|'\n'
DECL|member|test_enforce_http_true
name|'def'
name|'test_enforce_http_true'
op|'('
name|'self'
op|','
name|'req_mock'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req_mock'
op|'.'
name|'post'
op|'('
string|"'http://www.example.com/'"
op|','
nl|'\n'
name|'text'
op|'='
string|"'True'"
op|')'
newline|'\n'
name|'action'
op|'='
string|'"example:get_http"'
newline|'\n'
name|'target'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'result'
op|'='
name|'policy'
op|'.'
name|'enforce'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'action'
op|','
name|'target'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'requests_mock'
op|'.'
name|'mock'
op|'('
op|')'
newline|'\n'
DECL|member|test_enforce_http_false
name|'def'
name|'test_enforce_http_false'
op|'('
name|'self'
op|','
name|'req_mock'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req_mock'
op|'.'
name|'post'
op|'('
string|"'http://www.example.com/'"
op|','
nl|'\n'
name|'text'
op|'='
string|"'False'"
op|')'
newline|'\n'
name|'action'
op|'='
string|'"example:get_http"'
newline|'\n'
name|'target'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
name|'policy'
op|'.'
name|'enforce'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'action'
op|','
name|'target'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_templatized_enforcement
dedent|''
name|'def'
name|'test_templatized_enforcement'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'target_mine'
op|'='
op|'{'
string|"'project_id'"
op|':'
string|"'fake'"
op|'}'
newline|'\n'
name|'target_not_mine'
op|'='
op|'{'
string|"'project_id'"
op|':'
string|"'another'"
op|'}'
newline|'\n'
name|'action'
op|'='
string|'"example:my_file"'
newline|'\n'
name|'policy'
op|'.'
name|'enforce'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'action'
op|','
name|'target_mine'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
name|'policy'
op|'.'
name|'enforce'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'action'
op|','
name|'target_not_mine'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_early_AND_enforcement
dedent|''
name|'def'
name|'test_early_AND_enforcement'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'action'
op|'='
string|'"example:early_and_fail"'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
name|'policy'
op|'.'
name|'enforce'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'action'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_early_OR_enforcement
dedent|''
name|'def'
name|'test_early_OR_enforcement'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'action'
op|'='
string|'"example:early_or_success"'
newline|'\n'
name|'policy'
op|'.'
name|'enforce'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'action'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_ignore_case_role_check
dedent|''
name|'def'
name|'test_ignore_case_role_check'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'lowercase_action'
op|'='
string|'"example:lowercase_admin"'
newline|'\n'
name|'uppercase_action'
op|'='
string|'"example:uppercase_admin"'
newline|'\n'
comment|'# NOTE(dprince) we mix case in the Admin role here to ensure'
nl|'\n'
comment|'# case is ignored'
nl|'\n'
name|'admin_context'
op|'='
name|'context'
op|'.'
name|'RequestContext'
op|'('
string|"'admin'"
op|','
nl|'\n'
string|"'fake'"
op|','
nl|'\n'
name|'roles'
op|'='
op|'['
string|"'AdMiN'"
op|']'
op|')'
newline|'\n'
name|'policy'
op|'.'
name|'enforce'
op|'('
name|'admin_context'
op|','
name|'lowercase_action'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
name|'policy'
op|'.'
name|'enforce'
op|'('
name|'admin_context'
op|','
name|'uppercase_action'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|DefaultPolicyTestCase
dedent|''
dedent|''
name|'class'
name|'DefaultPolicyTestCase'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'DefaultPolicyTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'rules'
op|'='
op|'{'
nl|'\n'
string|'"default"'
op|':'
string|"''"
op|','
nl|'\n'
string|'"example:exist"'
op|':'
string|'"!"'
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_set_rules'
op|'('
string|"'default'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'context'
op|'.'
name|'RequestContext'
op|'('
string|"'fake'"
op|','
string|"'fake'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_set_rules
dedent|''
name|'def'
name|'_set_rules'
op|'('
name|'self'
op|','
name|'default_rule'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policy'
op|'.'
name|'reset'
op|'('
op|')'
newline|'\n'
name|'rules'
op|'='
name|'oslo_policy'
op|'.'
name|'Rules'
op|'.'
name|'from_dict'
op|'('
name|'self'
op|'.'
name|'rules'
op|')'
newline|'\n'
name|'policy'
op|'.'
name|'init'
op|'('
name|'rules'
op|'='
name|'rules'
op|','
name|'default_rule'
op|'='
name|'default_rule'
op|','
name|'use_conf'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_policy_called
dedent|''
name|'def'
name|'test_policy_called'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
name|'policy'
op|'.'
name|'enforce'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
string|'"example:exist"'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_not_found_policy_calls_default
dedent|''
name|'def'
name|'test_not_found_policy_calls_default'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policy'
op|'.'
name|'enforce'
op|'('
name|'self'
op|'.'
name|'context'
op|','
string|'"example:noexist"'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_default_not_found
dedent|''
name|'def'
name|'test_default_not_found'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_set_rules'
op|'('
string|'"default_noexist"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
name|'policy'
op|'.'
name|'enforce'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
string|'"example:noexist"'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|IsAdminCheckTestCase
dedent|''
dedent|''
name|'class'
name|'IsAdminCheckTestCase'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'IsAdminCheckTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'policy'
op|'.'
name|'init'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_init_true
dedent|''
name|'def'
name|'test_init_true'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'check'
op|'='
name|'policy'
op|'.'
name|'IsAdminCheck'
op|'('
string|"'is_admin'"
op|','
string|"'True'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'check'
op|'.'
name|'kind'
op|','
string|"'is_admin'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'check'
op|'.'
name|'match'
op|','
string|"'True'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'check'
op|'.'
name|'expected'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_init_false
dedent|''
name|'def'
name|'test_init_false'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'check'
op|'='
name|'policy'
op|'.'
name|'IsAdminCheck'
op|'('
string|"'is_admin'"
op|','
string|"'nottrue'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'check'
op|'.'
name|'kind'
op|','
string|"'is_admin'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'check'
op|'.'
name|'match'
op|','
string|"'False'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'check'
op|'.'
name|'expected'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_call_true
dedent|''
name|'def'
name|'test_call_true'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'check'
op|'='
name|'policy'
op|'.'
name|'IsAdminCheck'
op|'('
string|"'is_admin'"
op|','
string|"'True'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'check'
op|'('
string|"'target'"
op|','
name|'dict'
op|'('
name|'is_admin'
op|'='
name|'True'
op|')'
op|','
nl|'\n'
name|'policy'
op|'.'
name|'_ENFORCER'
op|')'
op|','
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'check'
op|'('
string|"'target'"
op|','
name|'dict'
op|'('
name|'is_admin'
op|'='
name|'False'
op|')'
op|','
nl|'\n'
name|'policy'
op|'.'
name|'_ENFORCER'
op|')'
op|','
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_call_false
dedent|''
name|'def'
name|'test_call_false'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'check'
op|'='
name|'policy'
op|'.'
name|'IsAdminCheck'
op|'('
string|"'is_admin'"
op|','
string|"'False'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'check'
op|'('
string|"'target'"
op|','
name|'dict'
op|'('
name|'is_admin'
op|'='
name|'True'
op|')'
op|','
nl|'\n'
name|'policy'
op|'.'
name|'_ENFORCER'
op|')'
op|','
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'check'
op|'('
string|"'target'"
op|','
name|'dict'
op|'('
name|'is_admin'
op|'='
name|'False'
op|')'
op|','
nl|'\n'
name|'policy'
op|'.'
name|'_ENFORCER'
op|')'
op|','
name|'True'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|AdminRolePolicyTestCase
dedent|''
dedent|''
name|'class'
name|'AdminRolePolicyTestCase'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'AdminRolePolicyTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'policy'
op|'='
name|'self'
op|'.'
name|'useFixture'
op|'('
name|'policy_fixture'
op|'.'
name|'RoleBasedPolicyFixture'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'context'
op|'.'
name|'RequestContext'
op|'('
string|"'fake'"
op|','
string|"'fake'"
op|','
name|'roles'
op|'='
op|'['
string|"'member'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'actions'
op|'='
name|'policy'
op|'.'
name|'get_rules'
op|'('
op|')'
op|'.'
name|'keys'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'target'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|test_enforce_admin_actions_with_nonadmin_context_throws
dedent|''
name|'def'
name|'test_enforce_admin_actions_with_nonadmin_context_throws'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Check if non-admin context passed to admin actions throws\n           Policy not authorized exception\n        """'
newline|'\n'
name|'for'
name|'action'
name|'in'
name|'self'
op|'.'
name|'actions'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
name|'policy'
op|'.'
name|'enforce'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'action'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|RealRolePolicyTestCase
dedent|''
dedent|''
dedent|''
name|'class'
name|'RealRolePolicyTestCase'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'RealRolePolicyTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'policy'
op|'='
name|'self'
op|'.'
name|'useFixture'
op|'('
name|'policy_fixture'
op|'.'
name|'RealPolicyFixture'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'non_admin_context'
op|'='
name|'context'
op|'.'
name|'RequestContext'
op|'('
string|"'fake'"
op|','
string|"'fake'"
op|','
nl|'\n'
name|'roles'
op|'='
op|'['
string|"'member'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'admin_context'
op|'='
name|'context'
op|'.'
name|'RequestContext'
op|'('
string|"'fake'"
op|','
string|"'fake'"
op|','
name|'True'
op|','
nl|'\n'
name|'roles'
op|'='
op|'['
string|"'member'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'target'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'fake_policy'
op|'='
name|'jsonutils'
op|'.'
name|'loads'
op|'('
name|'fake_policy'
op|'.'
name|'policy_data'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'admin_only_rules'
op|'='
op|'('
nl|'\n'
string|'"cells_scheduler_filter:TargetCellFilter"'
op|','
nl|'\n'
string|'"compute:unlock_override"'
op|','
nl|'\n'
string|'"compute:get_all_tenants"'
op|','
nl|'\n'
string|'"compute:create:forced_host"'
op|','
nl|'\n'
string|'"compute_extension:accounts"'
op|','
nl|'\n'
string|'"compute_extension:admin_actions"'
op|','
nl|'\n'
string|'"compute_extension:admin_actions:resetNetwork"'
op|','
nl|'\n'
string|'"compute_extension:admin_actions:injectNetworkInfo"'
op|','
nl|'\n'
string|'"compute_extension:admin_actions:migrateLive"'
op|','
nl|'\n'
string|'"compute_extension:admin_actions:resetState"'
op|','
nl|'\n'
string|'"compute_extension:admin_actions:migrate"'
op|','
nl|'\n'
string|'"compute_extension:aggregates"'
op|','
nl|'\n'
string|'"compute_extension:agents"'
op|','
nl|'\n'
string|'"compute_extension:baremetal_nodes"'
op|','
nl|'\n'
string|'"compute_extension:cells"'
op|','
nl|'\n'
string|'"compute_extension:cells:create"'
op|','
nl|'\n'
string|'"compute_extension:cells:delete"'
op|','
nl|'\n'
string|'"compute_extension:cells:update"'
op|','
nl|'\n'
string|'"compute_extension:cells:sync_instances"'
op|','
nl|'\n'
string|'"compute_extension:cloudpipe"'
op|','
nl|'\n'
string|'"compute_extension:cloudpipe_update"'
op|','
nl|'\n'
string|'"compute_extension:evacuate"'
op|','
nl|'\n'
string|'"compute_extension:extended_server_attributes"'
op|','
nl|'\n'
string|'"compute_extension:fixed_ips"'
op|','
nl|'\n'
string|'"compute_extension:flavor_access:addTenantAccess"'
op|','
nl|'\n'
string|'"compute_extension:flavor_access:removeTenantAccess"'
op|','
nl|'\n'
string|'"compute_extension:flavorextraspecs:create"'
op|','
nl|'\n'
string|'"compute_extension:flavorextraspecs:update"'
op|','
nl|'\n'
string|'"compute_extension:flavorextraspecs:delete"'
op|','
nl|'\n'
string|'"compute_extension:flavormanage"'
op|','
nl|'\n'
string|'"compute_extension:floating_ips_bulk"'
op|','
nl|'\n'
string|'"compute_extension:fping:all_tenants"'
op|','
nl|'\n'
string|'"compute_extension:hosts"'
op|','
nl|'\n'
string|'"compute_extension:hypervisors"'
op|','
nl|'\n'
string|'"compute_extension:instance_actions:events"'
op|','
nl|'\n'
string|'"compute_extension:instance_usage_audit_log"'
op|','
nl|'\n'
string|'"compute_extension:networks"'
op|','
nl|'\n'
string|'"compute_extension:networks_associate"'
op|','
nl|'\n'
string|'"compute_extension:quotas:update"'
op|','
nl|'\n'
string|'"compute_extension:quotas:delete"'
op|','
nl|'\n'
string|'"compute_extension:security_group_default_rules"'
op|','
nl|'\n'
string|'"compute_extension:server_diagnostics"'
op|','
nl|'\n'
string|'"compute_extension:services"'
op|','
nl|'\n'
string|'"compute_extension:shelveOffload"'
op|','
nl|'\n'
string|'"compute_extension:simple_tenant_usage:list"'
op|','
nl|'\n'
string|'"compute_extension:users"'
op|','
nl|'\n'
string|'"compute_extension:availability_zone:detail"'
op|','
nl|'\n'
string|'"compute_extension:used_limits_for_admin"'
op|','
nl|'\n'
string|'"compute_extension:migrations:index"'
op|','
nl|'\n'
string|'"compute_extension:os-assisted-volume-snapshots:create"'
op|','
nl|'\n'
string|'"compute_extension:os-assisted-volume-snapshots:delete"'
op|','
nl|'\n'
string|'"compute_extension:console_auth_tokens"'
op|','
nl|'\n'
string|'"compute_extension:os-server-external-events:create"'
op|','
nl|'\n'
string|'"os_compute_api:servers:create:forced_host"'
op|','
nl|'\n'
string|'"os_compute_api:servers:detail:get_all_tenants"'
op|','
nl|'\n'
string|'"os_compute_api:servers:index:get_all_tenants"'
op|','
nl|'\n'
string|'"os_compute_api:servers:show:host_status"'
op|','
nl|'\n'
string|'"os_compute_api:servers:migrations:force_complete"'
op|','
nl|'\n'
string|'"network:attach_external_network"'
op|','
nl|'\n'
string|'"os_compute_api:os-admin-actions"'
op|','
nl|'\n'
string|'"os_compute_api:os-admin-actions:reset_network"'
op|','
nl|'\n'
string|'"os_compute_api:os-admin-actions:inject_network_info"'
op|','
nl|'\n'
string|'"os_compute_api:os-admin-actions:reset_state"'
op|','
nl|'\n'
string|'"os_compute_api:os-aggregates:index"'
op|','
nl|'\n'
string|'"os_compute_api:os-aggregates:create"'
op|','
nl|'\n'
string|'"os_compute_api:os-aggregates:show"'
op|','
nl|'\n'
string|'"os_compute_api:os-aggregates:update"'
op|','
nl|'\n'
string|'"os_compute_api:os-aggregates:delete"'
op|','
nl|'\n'
string|'"os_compute_api:os-aggregates:add_host"'
op|','
nl|'\n'
string|'"os_compute_api:os-aggregates:remove_host"'
op|','
nl|'\n'
string|'"os_compute_api:os-aggregates:set_metadata"'
op|','
nl|'\n'
string|'"os_compute_api:os-agents"'
op|','
nl|'\n'
string|'"os_compute_api:os-baremetal-nodes"'
op|','
nl|'\n'
string|'"os_compute_api:os-cells"'
op|','
nl|'\n'
string|'"os_compute_api:os-cells:create"'
op|','
nl|'\n'
string|'"os_compute_api:os-cells:delete"'
op|','
nl|'\n'
string|'"os_compute_api:os-cells:update"'
op|','
nl|'\n'
string|'"os_compute_api:os-cells:sync_instances"'
op|','
nl|'\n'
string|'"os_compute_api:os-cloudpipe"'
op|','
nl|'\n'
string|'"os_compute_api:os-evacuate"'
op|','
nl|'\n'
string|'"os_compute_api:os-extended-server-attributes"'
op|','
nl|'\n'
string|'"os_compute_api:os-fixed-ips"'
op|','
nl|'\n'
string|'"os_compute_api:os-flavor-access:remove_tenant_access"'
op|','
nl|'\n'
string|'"os_compute_api:os-flavor-access:add_tenant_access"'
op|','
nl|'\n'
string|'"os_compute_api:os-flavor-extra-specs:create"'
op|','
nl|'\n'
string|'"os_compute_api:os-flavor-extra-specs:update"'
op|','
nl|'\n'
string|'"os_compute_api:os-flavor-extra-specs:delete"'
op|','
nl|'\n'
string|'"os_compute_api:os-flavor-manage"'
op|','
nl|'\n'
string|'"os_compute_api:os-floating-ips-bulk"'
op|','
nl|'\n'
string|'"os_compute_api:os-floating-ip-dns:domain:delete"'
op|','
nl|'\n'
string|'"os_compute_api:os-floating-ip-dns:domain:update"'
op|','
nl|'\n'
string|'"os_compute_api:os-fping:all_tenants"'
op|','
nl|'\n'
string|'"os_compute_api:os-hosts"'
op|','
nl|'\n'
string|'"os_compute_api:os-hypervisors"'
op|','
nl|'\n'
string|'"os_compute_api:os-instance-actions:events"'
op|','
nl|'\n'
string|'"os_compute_api:os-instance-usage-audit-log"'
op|','
nl|'\n'
string|'"os_compute_api:os-lock-server:unlock:unlock_override"'
op|','
nl|'\n'
string|'"os_compute_api:os-migrate-server:migrate"'
op|','
nl|'\n'
string|'"os_compute_api:os-migrate-server:migrate_live"'
op|','
nl|'\n'
string|'"os_compute_api:os-networks"'
op|','
nl|'\n'
string|'"os_compute_api:os-networks-associate"'
op|','
nl|'\n'
string|'"os_compute_api:os-pci:index"'
op|','
nl|'\n'
string|'"os_compute_api:os-pci:detail"'
op|','
nl|'\n'
string|'"os_compute_api:os-pci:show"'
op|','
nl|'\n'
string|'"os_compute_api:os-quota-sets:update"'
op|','
nl|'\n'
string|'"os_compute_api:os-quota-sets:delete"'
op|','
nl|'\n'
string|'"os_compute_api:os-quota-sets:detail"'
op|','
nl|'\n'
string|'"os_compute_api:os-security-group-default-rules"'
op|','
nl|'\n'
string|'"os_compute_api:os-server-diagnostics"'
op|','
nl|'\n'
string|'"os_compute_api:os-services"'
op|','
nl|'\n'
string|'"os_compute_api:os-shelve:shelve_offload"'
op|','
nl|'\n'
string|'"os_compute_api:os-simple-tenant-usage:list"'
op|','
nl|'\n'
string|'"os_compute_api:os-availability-zone:detail"'
op|','
nl|'\n'
string|'"os_compute_api:os-used-limits"'
op|','
nl|'\n'
string|'"os_compute_api:os-migrations:index"'
op|','
nl|'\n'
string|'"os_compute_api:os-assisted-volume-snapshots:create"'
op|','
nl|'\n'
string|'"os_compute_api:os-assisted-volume-snapshots:delete"'
op|','
nl|'\n'
string|'"os_compute_api:os-console-auth-tokens"'
op|','
nl|'\n'
string|'"os_compute_api:os-quota-class-sets:update"'
op|','
nl|'\n'
string|'"os_compute_api:os-server-external-events:create"'
op|','
nl|'\n'
string|'"os_compute_api:servers:migrations:index"'
op|','
nl|'\n'
string|'"os_compute_api:servers:migrations:show"'
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'admin_or_owner_rules'
op|'='
op|'('
nl|'\n'
string|'"default"'
op|','
nl|'\n'
string|'"compute:start"'
op|','
nl|'\n'
string|'"compute:stop"'
op|','
nl|'\n'
string|'"compute:delete"'
op|','
nl|'\n'
string|'"compute:soft_delete"'
op|','
nl|'\n'
string|'"compute:force_delete"'
op|','
nl|'\n'
string|'"compute:lock"'
op|','
nl|'\n'
string|'"compute:unlock"'
op|','
nl|'\n'
string|'"compute_extension:admin_actions:pause"'
op|','
nl|'\n'
string|'"compute_extension:admin_actions:unpause"'
op|','
nl|'\n'
string|'"compute_extension:admin_actions:suspend"'
op|','
nl|'\n'
string|'"compute_extension:admin_actions:resume"'
op|','
nl|'\n'
string|'"compute_extension:admin_actions:lock"'
op|','
nl|'\n'
string|'"compute_extension:admin_actions:unlock"'
op|','
nl|'\n'
string|'"compute_extension:admin_actions:createBackup"'
op|','
nl|'\n'
string|'"compute_extension:simple_tenant_usage:show"'
op|','
nl|'\n'
string|'"os_compute_api:servers:start"'
op|','
nl|'\n'
string|'"os_compute_api:servers:stop"'
op|','
nl|'\n'
string|'"os_compute_api:servers:trigger_crash_dump"'
op|','
nl|'\n'
string|'"os_compute_api:os-create-backup"'
op|','
nl|'\n'
string|'"os_compute_api:ips:index"'
op|','
nl|'\n'
string|'"os_compute_api:ips:show"'
op|','
nl|'\n'
string|'"os_compute_api:os-keypairs:create"'
op|','
nl|'\n'
string|'"os_compute_api:os-keypairs:delete"'
op|','
nl|'\n'
string|'"os_compute_api:os-keypairs:index"'
op|','
nl|'\n'
string|'"os_compute_api:os-keypairs:show"'
op|','
nl|'\n'
string|'"os_compute_api:os-lock-server:lock"'
op|','
nl|'\n'
string|'"os_compute_api:os-lock-server:unlock"'
op|','
nl|'\n'
string|'"os_compute_api:os-pause-server:pause"'
op|','
nl|'\n'
string|'"os_compute_api:os-pause-server:unpause"'
op|','
nl|'\n'
string|'"os_compute_api:os-quota-sets:show"'
op|','
nl|'\n'
string|'"os_compute_api:server-metadata:index"'
op|','
nl|'\n'
string|'"os_compute_api:server-metadata:show"'
op|','
nl|'\n'
string|'"os_compute_api:server-metadata:delete"'
op|','
nl|'\n'
string|'"os_compute_api:server-metadata:create"'
op|','
nl|'\n'
string|'"os_compute_api:server-metadata:update"'
op|','
nl|'\n'
string|'"os_compute_api:server-metadata:update_all"'
op|','
nl|'\n'
string|'"os_compute_api:os-simple-tenant-usage:show"'
op|','
nl|'\n'
string|'"os_compute_api:os-suspend-server:suspend"'
op|','
nl|'\n'
string|'"os_compute_api:os-suspend-server:resume"'
op|','
nl|'\n'
string|'"os_compute_api:os-tenant-networks"'
op|','
nl|'\n'
string|'"compute:create"'
op|','
nl|'\n'
string|'"compute:create:attach_network"'
op|','
nl|'\n'
string|'"compute:create:attach_volume"'
op|','
nl|'\n'
string|'"compute:get_all_instance_metadata"'
op|','
nl|'\n'
string|'"compute:get_all_instance_system_metadata"'
op|','
nl|'\n'
string|'"compute:get_console_output"'
op|','
nl|'\n'
string|'"compute:get_diagnostics"'
op|','
nl|'\n'
string|'"compute:delete_instance_metadata"'
op|','
nl|'\n'
string|'"compute:get"'
op|','
nl|'\n'
string|'"compute:get_all"'
op|','
nl|'\n'
string|'"compute:shelve"'
op|','
nl|'\n'
string|'"compute:shelve_offload"'
op|','
nl|'\n'
string|'"compute:snapshot_volume_backed"'
op|','
nl|'\n'
string|'"compute:unshelve"'
op|','
nl|'\n'
string|'"compute:resize"'
op|','
nl|'\n'
string|'"compute:confirm_resize"'
op|','
nl|'\n'
string|'"compute:revert_resize"'
op|','
nl|'\n'
string|'"compute:rebuild"'
op|','
nl|'\n'
string|'"compute:reboot"'
op|','
nl|'\n'
string|'"compute:volume_snapshot_create"'
op|','
nl|'\n'
string|'"compute:volume_snapshot_delete"'
op|','
nl|'\n'
string|'"compute:add_fixed_ip"'
op|','
nl|'\n'
string|'"compute:attach_interface"'
op|','
nl|'\n'
string|'"compute:detach_interface"'
op|','
nl|'\n'
string|'"compute:attach_volume"'
op|','
nl|'\n'
string|'"compute:detach_volume"'
op|','
nl|'\n'
string|'"compute:backup"'
op|','
nl|'\n'
string|'"compute:get_instance_diagnostics"'
op|','
nl|'\n'
string|'"compute:get_instance_metadata"'
op|','
nl|'\n'
string|'"compute:get_mks_console"'
op|','
nl|'\n'
string|'"compute:get_rdp_console"'
op|','
nl|'\n'
string|'"compute:get_serial_console"'
op|','
nl|'\n'
string|'"compute:get_spice_console"'
op|','
nl|'\n'
string|'"compute:get_vnc_console"'
op|','
nl|'\n'
string|'"compute:inject_network_info"'
op|','
nl|'\n'
string|'"compute:pause"'
op|','
nl|'\n'
string|'"compute:remove_fixed_ip"'
op|','
nl|'\n'
string|'"compute:rescue"'
op|','
nl|'\n'
string|'"compute:reset_network"'
op|','
nl|'\n'
string|'"compute:restore"'
op|','
nl|'\n'
string|'"compute:resume"'
op|','
nl|'\n'
string|'"compute:security_groups:add_to_instance"'
op|','
nl|'\n'
string|'"compute:security_groups:remove_from_instance"'
op|','
nl|'\n'
string|'"compute:set_admin_password"'
op|','
nl|'\n'
string|'"compute:snapshot"'
op|','
nl|'\n'
string|'"compute:suspend"'
op|','
nl|'\n'
string|'"compute:swap_volume"'
op|','
nl|'\n'
string|'"compute:unpause"'
op|','
nl|'\n'
string|'"compute:unrescue"'
op|','
nl|'\n'
string|'"compute:update"'
op|','
nl|'\n'
string|'"compute:update_instance_metadata"'
op|','
nl|'\n'
string|'"compute_extension:config_drive"'
op|','
nl|'\n'
string|'"compute_extension:os-tenant-networks"'
op|','
nl|'\n'
string|'"network:get_vif_by_mac_address"'
op|','
nl|'\n'
string|'"os_compute_api:extensions"'
op|','
nl|'\n'
string|'"os_compute_api:os-config-drive"'
op|','
nl|'\n'
string|'"os_compute_api:servers:confirm_resize"'
op|','
nl|'\n'
string|'"os_compute_api:servers:create"'
op|','
nl|'\n'
string|'"os_compute_api:servers:create:attach_network"'
op|','
nl|'\n'
string|'"os_compute_api:servers:create:attach_volume"'
op|','
nl|'\n'
string|'"os_compute_api:servers:create_image"'
op|','
nl|'\n'
string|'"os_compute_api:servers:delete"'
op|','
nl|'\n'
string|'"os_compute_api:servers:detail"'
op|','
nl|'\n'
string|'"os_compute_api:servers:index"'
op|','
nl|'\n'
string|'"os_compute_api:servers:reboot"'
op|','
nl|'\n'
string|'"os_compute_api:servers:rebuild"'
op|','
nl|'\n'
string|'"os_compute_api:servers:resize"'
op|','
nl|'\n'
string|'"os_compute_api:servers:revert_resize"'
op|','
nl|'\n'
string|'"os_compute_api:servers:show"'
op|','
nl|'\n'
string|'"os_compute_api:servers:update"'
op|','
nl|'\n'
string|'"compute_extension:attach_interfaces"'
op|','
nl|'\n'
string|'"compute_extension:certificates"'
op|','
nl|'\n'
string|'"compute_extension:console_output"'
op|','
nl|'\n'
string|'"compute_extension:consoles"'
op|','
nl|'\n'
string|'"compute_extension:createserverext"'
op|','
nl|'\n'
string|'"compute_extension:deferred_delete"'
op|','
nl|'\n'
string|'"compute_extension:disk_config"'
op|','
nl|'\n'
string|'"compute_extension:extended_status"'
op|','
nl|'\n'
string|'"compute_extension:extended_availability_zone"'
op|','
nl|'\n'
string|'"compute_extension:extended_ips"'
op|','
nl|'\n'
string|'"compute_extension:extended_ips_mac"'
op|','
nl|'\n'
string|'"compute_extension:extended_vif_net"'
op|','
nl|'\n'
string|'"compute_extension:extended_volumes"'
op|','
nl|'\n'
string|'"compute_extension:flavor_access"'
op|','
nl|'\n'
string|'"compute_extension:flavor_disabled"'
op|','
nl|'\n'
string|'"compute_extension:flavor_rxtx"'
op|','
nl|'\n'
string|'"compute_extension:flavor_swap"'
op|','
nl|'\n'
string|'"compute_extension:flavorextradata"'
op|','
nl|'\n'
string|'"compute_extension:flavorextraspecs:index"'
op|','
nl|'\n'
string|'"compute_extension:flavorextraspecs:show"'
op|','
nl|'\n'
string|'"compute_extension:floating_ip_dns"'
op|','
nl|'\n'
string|'"compute_extension:floating_ip_pools"'
op|','
nl|'\n'
string|'"compute_extension:floating_ips"'
op|','
nl|'\n'
string|'"compute_extension:fping"'
op|','
nl|'\n'
string|'"compute_extension:image_size"'
op|','
nl|'\n'
string|'"compute_extension:instance_actions"'
op|','
nl|'\n'
string|'"compute_extension:keypairs"'
op|','
nl|'\n'
string|'"compute_extension:keypairs:index"'
op|','
nl|'\n'
string|'"compute_extension:keypairs:show"'
op|','
nl|'\n'
string|'"compute_extension:keypairs:create"'
op|','
nl|'\n'
string|'"compute_extension:keypairs:delete"'
op|','
nl|'\n'
string|'"compute_extension:multinic"'
op|','
nl|'\n'
string|'"compute_extension:networks:view"'
op|','
nl|'\n'
string|'"compute_extension:quotas:show"'
op|','
nl|'\n'
string|'"compute_extension:quota_classes"'
op|','
nl|'\n'
string|'"compute_extension:rescue"'
op|','
nl|'\n'
string|'"compute_extension:security_groups"'
op|','
nl|'\n'
string|'"compute_extension:server_groups"'
op|','
nl|'\n'
string|'"compute_extension:server_password"'
op|','
nl|'\n'
string|'"compute_extension:server_usage"'
op|','
nl|'\n'
string|'"compute_extension:shelve"'
op|','
nl|'\n'
string|'"compute_extension:unshelve"'
op|','
nl|'\n'
string|'"compute_extension:virtual_interfaces"'
op|','
nl|'\n'
string|'"compute_extension:virtual_storage_arrays"'
op|','
nl|'\n'
string|'"compute_extension:volumes"'
op|','
nl|'\n'
string|'"compute_extension:volume_attachments:index"'
op|','
nl|'\n'
string|'"compute_extension:volume_attachments:show"'
op|','
nl|'\n'
string|'"compute_extension:volume_attachments:create"'
op|','
nl|'\n'
string|'"compute_extension:volume_attachments:update"'
op|','
nl|'\n'
string|'"compute_extension:volume_attachments:delete"'
op|','
nl|'\n'
string|'"compute_extension:volumetypes"'
op|','
nl|'\n'
string|'"compute_extension:availability_zone:list"'
op|','
nl|'\n'
string|'"network:get_all"'
op|','
nl|'\n'
string|'"network:get"'
op|','
nl|'\n'
string|'"network:create"'
op|','
nl|'\n'
string|'"network:delete"'
op|','
nl|'\n'
string|'"network:associate"'
op|','
nl|'\n'
string|'"network:disassociate"'
op|','
nl|'\n'
string|'"network:get_vifs_by_instance"'
op|','
nl|'\n'
string|'"network:allocate_for_instance"'
op|','
nl|'\n'
string|'"network:deallocate_for_instance"'
op|','
nl|'\n'
string|'"network:validate_networks"'
op|','
nl|'\n'
string|'"network:get_instance_uuids_by_ip_filter"'
op|','
nl|'\n'
string|'"network:get_instance_id_by_floating_address"'
op|','
nl|'\n'
string|'"network:setup_networks_on_host"'
op|','
nl|'\n'
string|'"network:get_backdoor_port"'
op|','
nl|'\n'
string|'"network:get_floating_ip"'
op|','
nl|'\n'
string|'"network:get_floating_ip_pools"'
op|','
nl|'\n'
string|'"network:get_floating_ip_by_address"'
op|','
nl|'\n'
string|'"network:get_floating_ips_by_project"'
op|','
nl|'\n'
string|'"network:get_floating_ips_by_fixed_address"'
op|','
nl|'\n'
string|'"network:allocate_floating_ip"'
op|','
nl|'\n'
string|'"network:associate_floating_ip"'
op|','
nl|'\n'
string|'"network:disassociate_floating_ip"'
op|','
nl|'\n'
string|'"network:release_floating_ip"'
op|','
nl|'\n'
string|'"network:migrate_instance_start"'
op|','
nl|'\n'
string|'"network:migrate_instance_finish"'
op|','
nl|'\n'
string|'"network:get_fixed_ip"'
op|','
nl|'\n'
string|'"network:get_fixed_ip_by_address"'
op|','
nl|'\n'
string|'"network:add_fixed_ip_to_instance"'
op|','
nl|'\n'
string|'"network:remove_fixed_ip_from_instance"'
op|','
nl|'\n'
string|'"network:add_network_to_project"'
op|','
nl|'\n'
string|'"network:get_instance_nw_info"'
op|','
nl|'\n'
string|'"network:get_dns_domains"'
op|','
nl|'\n'
string|'"network:add_dns_entry"'
op|','
nl|'\n'
string|'"network:modify_dns_entry"'
op|','
nl|'\n'
string|'"network:delete_dns_entry"'
op|','
nl|'\n'
string|'"network:get_dns_entries_by_address"'
op|','
nl|'\n'
string|'"network:get_dns_entries_by_name"'
op|','
nl|'\n'
string|'"network:create_private_dns_domain"'
op|','
nl|'\n'
string|'"network:create_public_dns_domain"'
op|','
nl|'\n'
string|'"network:delete_dns_domain"'
op|','
nl|'\n'
string|'"os_compute_api:servers:create_image:allow_volume_backed"'
op|','
nl|'\n'
string|'"os_compute_api:os-access-ips"'
op|','
nl|'\n'
string|'"os_compute_api:os-admin-password"'
op|','
nl|'\n'
string|'"os_compute_api:os-attach-interfaces"'
op|','
nl|'\n'
string|'"os_compute_api:os-certificates:create"'
op|','
nl|'\n'
string|'"os_compute_api:os-certificates:show"'
op|','
nl|'\n'
string|'"os_compute_api:os-consoles:create"'
op|','
nl|'\n'
string|'"os_compute_api:os-consoles:delete"'
op|','
nl|'\n'
string|'"os_compute_api:os-consoles:index"'
op|','
nl|'\n'
string|'"os_compute_api:os-consoles:show"'
op|','
nl|'\n'
string|'"os_compute_api:os-console-output"'
op|','
nl|'\n'
string|'"os_compute_api:os-remote-consoles"'
op|','
nl|'\n'
string|'"os_compute_api:os-deferred-delete"'
op|','
nl|'\n'
string|'"os_compute_api:os-disk-config"'
op|','
nl|'\n'
string|'"os_compute_api:os-extended-status"'
op|','
nl|'\n'
string|'"os_compute_api:os-extended-availability-zone"'
op|','
nl|'\n'
string|'"os_compute_api:os-extended-volumes"'
op|','
nl|'\n'
string|'"os_compute_api:os-flavor-access"'
op|','
nl|'\n'
string|'"os_compute_api:os-flavor-rxtx"'
op|','
nl|'\n'
string|'"os_compute_api:flavors"'
op|','
nl|'\n'
string|'"os_compute_api:os-flavor-extra-specs:index"'
op|','
nl|'\n'
string|'"os_compute_api:os-flavor-extra-specs:show"'
op|','
nl|'\n'
string|'"os_compute_api:os-floating-ip-dns"'
op|','
nl|'\n'
string|'"os_compute_api:os-floating-ip-pools"'
op|','
nl|'\n'
string|'"os_compute_api:os-floating-ips"'
op|','
nl|'\n'
string|'"os_compute_api:os-fping"'
op|','
nl|'\n'
string|'"os_compute_api:image-size"'
op|','
nl|'\n'
string|'"os_compute_api:os-instance-actions"'
op|','
nl|'\n'
string|'"os_compute_api:os-keypairs"'
op|','
nl|'\n'
string|'"os_compute_api:limits"'
op|','
nl|'\n'
string|'"os_compute_api:os-multinic"'
op|','
nl|'\n'
string|'"os_compute_api:os-networks:view"'
op|','
nl|'\n'
string|'"os_compute_api:os-pci:pci_servers"'
op|','
nl|'\n'
string|'"os_compute_api:os-rescue"'
op|','
nl|'\n'
string|'"os_compute_api:os-security-groups"'
op|','
nl|'\n'
string|'"os_compute_api:os-server-password"'
op|','
nl|'\n'
string|'"os_compute_api:os-server-usage"'
op|','
nl|'\n'
string|'"os_compute_api:os-server-groups"'
op|','
nl|'\n'
string|'"os_compute_api:os-shelve:shelve"'
op|','
nl|'\n'
string|'"os_compute_api:os-shelve:unshelve"'
op|','
nl|'\n'
string|'"os_compute_api:os-virtual-interfaces"'
op|','
nl|'\n'
string|'"os_compute_api:os-volumes"'
op|','
nl|'\n'
string|'"os_compute_api:os-volumes-attachments:index"'
op|','
nl|'\n'
string|'"os_compute_api:os-volumes-attachments:show"'
op|','
nl|'\n'
string|'"os_compute_api:os-volumes-attachments:create"'
op|','
nl|'\n'
string|'"os_compute_api:os-volumes-attachments:update"'
op|','
nl|'\n'
string|'"os_compute_api:os-volumes-attachments:delete"'
op|','
nl|'\n'
string|'"os_compute_api:os-availability-zone:list"'
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'non_admin_only_rules'
op|'='
op|'('
nl|'\n'
string|'"compute_extension:hide_server_addresses"'
op|','
nl|'\n'
string|'"os_compute_api:os-hide-server-addresses"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'allow_all_rules'
op|'='
op|'('
nl|'\n'
string|'"os_compute_api:os-quota-sets:defaults"'
op|','
nl|'\n'
string|'"os_compute_api:extensions:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-access-ips:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-admin-actions:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-admin-password:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-aggregates:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-agents:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-attach-interfaces:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-baremetal-nodes:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-block-device-mapping-v1:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-cells:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-certificates:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-cloudpipe:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-consoles:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-console-output:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-remote-consoles:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-create-backup:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-deferred-delete:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-disk-config:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-evacuate:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-extended-server-attributes:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-extended-status:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-extended-availability-zone:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:extension_info:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-extended-volumes:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-fixed-ips:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-flavor-access:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-flavor-rxtx:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:flavors:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-flavor-extra-specs:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-flavor-manage:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-floating-ip-dns:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-floating-ip-pools:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-floating-ips:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-floating-ips-bulk:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-fping:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-hide-server-addresses:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-hosts:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-hypervisors:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:images:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:image-size:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-instance-actions:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-instance-usage-audit-log:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:ips:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-keypairs:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:limits:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-lock-server:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-migrate-server:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-multinic:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-networks:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-networks-associate:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-pause-server:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-pci:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-personality:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-preserve-ephemeral-rebuild:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-quota-sets:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-quota-class-sets:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-rescue:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-scheduler-hints:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-security-group-default-rules:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-security-groups:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-server-diagnostics:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-server-password:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-server-usage:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-server-groups:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-services:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:server-metadata:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:servers:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-shelve:shelve:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-simple-tenant-usage:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-suspend-server:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-tenant-networks:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-user-data:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-virtual-interfaces:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-volumes:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-volumes-attachments:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-availability-zone:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-used-limits:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-migrations:discoverable"'
op|','
nl|'\n'
string|'"os_compute_api:os-assisted-volume-snapshots:discoverable"'
op|','
nl|'\n'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_all_rules_in_sample_file
dedent|''
name|'def'
name|'test_all_rules_in_sample_file'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'special_rules'
op|'='
op|'['
string|'"context_is_admin"'
op|','
string|'"admin_or_owner"'
op|','
string|'"default"'
op|']'
newline|'\n'
name|'for'
op|'('
name|'name'
op|','
name|'rule'
op|')'
name|'in'
name|'self'
op|'.'
name|'fake_policy'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'name'
name|'in'
name|'special_rules'
op|':'
newline|'\n'
indent|'                '
name|'continue'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'name'
op|','
name|'policy'
op|'.'
name|'get_rules'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_admin_only_rules
dedent|''
dedent|''
name|'def'
name|'test_admin_only_rules'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'rule'
name|'in'
name|'self'
op|'.'
name|'admin_only_rules'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
name|'policy'
op|'.'
name|'enforce'
op|','
nl|'\n'
name|'self'
op|'.'
name|'non_admin_context'
op|','
name|'rule'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
name|'policy'
op|'.'
name|'enforce'
op|'('
name|'self'
op|'.'
name|'admin_context'
op|','
name|'rule'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_non_admin_only_rules
dedent|''
dedent|''
name|'def'
name|'test_non_admin_only_rules'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'rule'
name|'in'
name|'self'
op|'.'
name|'non_admin_only_rules'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
name|'policy'
op|'.'
name|'enforce'
op|','
nl|'\n'
name|'self'
op|'.'
name|'admin_context'
op|','
name|'rule'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
name|'policy'
op|'.'
name|'enforce'
op|'('
name|'self'
op|'.'
name|'non_admin_context'
op|','
name|'rule'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_admin_or_owner_rules
dedent|''
dedent|''
name|'def'
name|'test_admin_or_owner_rules'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'rule'
name|'in'
name|'self'
op|'.'
name|'admin_or_owner_rules'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'PolicyNotAuthorized'
op|','
name|'policy'
op|'.'
name|'enforce'
op|','
nl|'\n'
name|'self'
op|'.'
name|'non_admin_context'
op|','
name|'rule'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
name|'policy'
op|'.'
name|'enforce'
op|'('
name|'self'
op|'.'
name|'non_admin_context'
op|','
name|'rule'
op|','
nl|'\n'
op|'{'
string|"'project_id'"
op|':'
string|"'fake'"
op|','
string|"'user_id'"
op|':'
string|"'fake'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_no_empty_rules
dedent|''
dedent|''
name|'def'
name|'test_no_empty_rules'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'rules'
op|'='
name|'policy'
op|'.'
name|'get_rules'
op|'('
op|')'
newline|'\n'
name|'for'
name|'rule'
name|'in'
name|'rules'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertNotEqual'
op|'('
string|"''"
op|','
name|'str'
op|'('
name|'rule'
op|')'
op|','
nl|'\n'
string|'\'%s should not be empty, use "@" instead if the policy \''
nl|'\n'
string|"'should allow everything'"
op|'%'
name|'rule'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_allow_all_rules
dedent|''
dedent|''
name|'def'
name|'test_allow_all_rules'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'rule'
name|'in'
name|'self'
op|'.'
name|'allow_all_rules'
op|':'
newline|'\n'
indent|'            '
name|'policy'
op|'.'
name|'enforce'
op|'('
name|'self'
op|'.'
name|'non_admin_context'
op|','
name|'rule'
op|','
name|'self'
op|'.'
name|'target'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_rule_missing
dedent|''
dedent|''
name|'def'
name|'test_rule_missing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'rules'
op|'='
name|'policy'
op|'.'
name|'get_rules'
op|'('
op|')'
newline|'\n'
comment|'# eliqiao os_compute_api:os-quota-class-sets:show requires'
nl|'\n'
comment|"# admin=True or quota_class match, this rule won't belong to"
nl|'\n'
comment|'# admin_only, non_admin, admin_or_user, empty_rule'
nl|'\n'
name|'special_rules'
op|'='
op|'('
string|"'admin_api'"
op|','
string|"'admin_or_owner'"
op|','
string|"'context_is_admin'"
op|','
nl|'\n'
string|"'os_compute_api:os-quota-class-sets:show'"
op|')'
newline|'\n'
name|'result'
op|'='
name|'set'
op|'('
name|'rules'
op|'.'
name|'keys'
op|'('
op|')'
op|')'
op|'-'
name|'set'
op|'('
name|'self'
op|'.'
name|'admin_only_rules'
op|'+'
nl|'\n'
name|'self'
op|'.'
name|'admin_or_owner_rules'
op|'+'
name|'self'
op|'.'
name|'non_admin_only_rules'
op|'+'
nl|'\n'
name|'self'
op|'.'
name|'allow_all_rules'
op|'+'
name|'special_rules'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'set'
op|'('
op|'['
op|']'
op|')'
op|','
name|'result'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
