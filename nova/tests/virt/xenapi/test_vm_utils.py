begin_unit
comment|'# vim: tabstop=4 shiftwidth=4 softtabstop=4'
nl|'\n'
nl|'\n'
comment|'# Copyright 2013 OpenStack Foundation'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'contextlib'
newline|'\n'
name|'import'
name|'uuid'
newline|'\n'
nl|'\n'
name|'from'
name|'eventlet'
name|'import'
name|'greenthread'
newline|'\n'
name|'import'
name|'fixtures'
newline|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'import'
name|'mox'
newline|'\n'
name|'from'
name|'oslo'
op|'.'
name|'config'
name|'import'
name|'cfg'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
op|'.'
name|'compute'
name|'import'
name|'flavors'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'compute'
name|'import'
name|'vm_mode'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'context'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
op|'.'
name|'gettextutils'
name|'import'
name|'_'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'processutils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'timeutils'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'virt'
op|'.'
name|'xenapi'
name|'import'
name|'stubs'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'virt'
op|'.'
name|'xenapi'
name|'import'
name|'test_xenapi'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'unit'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'utils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'xenapi'
name|'import'
name|'driver'
name|'as'
name|'xenapi_conn'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'xenapi'
name|'import'
name|'fake'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'xenapi'
name|'import'
name|'vm_utils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'xenapi'
name|'import'
name|'volume_utils'
newline|'\n'
nl|'\n'
DECL|variable|CONF
name|'CONF'
op|'='
name|'cfg'
op|'.'
name|'CONF'
newline|'\n'
DECL|variable|XENSM_TYPE
name|'XENSM_TYPE'
op|'='
string|"'xensm'"
newline|'\n'
DECL|variable|ISCSI_TYPE
name|'ISCSI_TYPE'
op|'='
string|"'iscsi'"
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|get_fake_connection_data
name|'def'
name|'get_fake_connection_data'
op|'('
name|'sr_type'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'fakes'
op|'='
op|'{'
name|'XENSM_TYPE'
op|':'
op|'{'
string|"'sr_uuid'"
op|':'
string|"'falseSR'"
op|','
nl|'\n'
string|"'name_label'"
op|':'
string|"'fake_storage'"
op|','
nl|'\n'
string|"'name_description'"
op|':'
string|"'test purposes'"
op|','
nl|'\n'
string|"'server'"
op|':'
string|"'myserver'"
op|','
nl|'\n'
string|"'serverpath'"
op|':'
string|"'/local/scratch/myname'"
op|','
nl|'\n'
string|"'sr_type'"
op|':'
string|"'nfs'"
op|','
nl|'\n'
string|"'introduce_sr_keys'"
op|':'
op|'['
string|"'server'"
op|','
nl|'\n'
string|"'serverpath'"
op|','
nl|'\n'
string|"'sr_type'"
op|']'
op|','
nl|'\n'
string|"'vdi_uuid'"
op|':'
string|"'falseVDI'"
op|'}'
op|','
nl|'\n'
name|'ISCSI_TYPE'
op|':'
op|'{'
string|"'volume_id'"
op|':'
string|"'fake_volume_id'"
op|','
nl|'\n'
string|"'target_lun'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'target_iqn'"
op|':'
string|"'fake_iqn:volume-fake_volume_id'"
op|','
nl|'\n'
string|"'target_portal'"
op|':'
string|"u'localhost:3260'"
op|','
nl|'\n'
string|"'target_discovered'"
op|':'
name|'False'
op|'}'
op|','
op|'}'
newline|'\n'
name|'return'
name|'fakes'
op|'['
name|'sr_type'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_get_fake_session_and_exception
dedent|''
name|'def'
name|'_get_fake_session_and_exception'
op|'('
name|'error'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|class|FakeException
name|'class'
name|'FakeException'
op|'('
name|'Exception'
op|')'
op|':'
newline|'\n'
DECL|variable|details
indent|'        '
name|'details'
op|'='
op|'['
name|'error'
op|','
string|'"a"'
op|','
string|'"b"'
op|','
string|'"c"'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'session'
op|'.'
name|'XenAPI'
op|'.'
name|'Failure'
op|'='
name|'FakeException'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'side_effect'
op|'='
name|'FakeException'
newline|'\n'
nl|'\n'
name|'return'
name|'session'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
op|'@'
name|'contextlib'
op|'.'
name|'contextmanager'
newline|'\n'
DECL|function|contextified
name|'def'
name|'contextified'
op|'('
name|'result'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'yield'
name|'result'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_fake_noop
dedent|''
name|'def'
name|'_fake_noop'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VMUtilsTestBase
dedent|''
name|'class'
name|'VMUtilsTestBase'
op|'('
name|'stubs'
op|'.'
name|'XenAPITestBaseNoDB'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|LookupTestCase
dedent|''
name|'class'
name|'LookupTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'LookupTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'='
name|'self'
op|'.'
name|'mox'
op|'.'
name|'CreateMockAnything'
op|'('
string|"'Fake Session'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'name_label'
op|'='
string|"'my_vm'"
newline|'\n'
nl|'\n'
DECL|member|_do_mock
dedent|''
name|'def'
name|'_do_mock'
op|'('
name|'self'
op|','
name|'result'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
nl|'\n'
string|'"VM.get_by_name_label"'
op|','
name|'self'
op|'.'
name|'name_label'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'result'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_normal
dedent|''
name|'def'
name|'test_normal'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_mock'
op|'('
op|'['
string|"'x'"
op|']'
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'lookup'
op|'('
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'name_label'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'x'"
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_no_result
dedent|''
name|'def'
name|'test_no_result'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_mock'
op|'('
op|'['
op|']'
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'lookup'
op|'('
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'name_label'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_too_many
dedent|''
name|'def'
name|'test_too_many'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_do_mock'
op|'('
op|'['
string|"'a'"
op|','
string|"'b'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'InstanceExists'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'lookup'
op|','
nl|'\n'
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'name_label'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_rescue_none
dedent|''
name|'def'
name|'test_rescue_none'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
nl|'\n'
string|'"VM.get_by_name_label"'
op|','
name|'self'
op|'.'
name|'name_label'
op|'+'
string|"'-rescue'"
op|')'
op|'.'
name|'AndReturn'
op|'('
op|'['
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_do_mock'
op|'('
op|'['
string|"'x'"
op|']'
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'lookup'
op|'('
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'name_label'
op|','
nl|'\n'
name|'check_rescue'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'x'"
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_rescue_found
dedent|''
name|'def'
name|'test_rescue_found'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
nl|'\n'
string|'"VM.get_by_name_label"'
op|','
nl|'\n'
name|'self'
op|'.'
name|'name_label'
op|'+'
string|"'-rescue'"
op|')'
op|'.'
name|'AndReturn'
op|'('
op|'['
string|"'y'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'lookup'
op|'('
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'name_label'
op|','
nl|'\n'
name|'check_rescue'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'y'"
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_rescue_too_many
dedent|''
name|'def'
name|'test_rescue_too_many'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
nl|'\n'
string|'"VM.get_by_name_label"'
op|','
nl|'\n'
name|'self'
op|'.'
name|'name_label'
op|'+'
string|"'-rescue'"
op|')'
op|'.'
name|'AndReturn'
op|'('
op|'['
string|"'a'"
op|','
string|"'b'"
op|','
string|"'c'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'InstanceExists'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'lookup'
op|','
nl|'\n'
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'name_label'
op|','
nl|'\n'
name|'check_rescue'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|GenerateConfigDriveTestCase
dedent|''
dedent|''
name|'class'
name|'GenerateConfigDriveTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|test_no_admin_pass
indent|'    '
name|'def'
name|'test_no_admin_pass'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|"# This is here to avoid masking errors, it shouldn't be used normally"
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'useFixture'
op|'('
name|'fixtures'
op|'.'
name|'MonkeyPatch'
op|'('
nl|'\n'
string|"'nova.virt.xenapi.vm_utils.destroy_vdi'"
op|','
name|'_fake_noop'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# Mocks'
nl|'\n'
name|'instance'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'safe_find_sr'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'safe_find_sr'
op|'('
string|"'session'"
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'sr_ref'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'create_vdi'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'create_vdi'
op|'('
string|"'session'"
op|','
string|"'sr_ref'"
op|','
name|'instance'
op|','
string|"'config-2'"
op|','
nl|'\n'
string|"'configdrive'"
op|','
nl|'\n'
number|'64'
op|'*'
name|'unit'
op|'.'
name|'Mi'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'vdi_ref'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'vdi_attached_here'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'vdi_attached_here'
op|'('
nl|'\n'
string|"'session'"
op|','
string|"'vdi_ref'"
op|','
name|'read_only'
op|'='
name|'False'
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
name|'contextified'
op|'('
string|"'mounted_dev'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|class|FakeInstanceMetadata
name|'class'
name|'FakeInstanceMetadata'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'            '
name|'def'
name|'__init__'
op|'('
name|'_self'
op|','
name|'instance'
op|','
name|'content'
op|'='
name|'None'
op|','
name|'extra_md'
op|'='
name|'None'
op|','
nl|'\n'
name|'network_info'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'network_info'
op|','
string|'"nw_info"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|metadata_for_config_drive
dedent|''
name|'def'
name|'metadata_for_config_drive'
op|'('
name|'_self'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'useFixture'
op|'('
name|'fixtures'
op|'.'
name|'MonkeyPatch'
op|'('
nl|'\n'
string|"'nova.api.metadata.base.InstanceMetadata'"
op|','
nl|'\n'
name|'FakeInstanceMetadata'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'utils'
op|','
string|"'execute'"
op|')'
newline|'\n'
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'genisoimage'"
op|','
string|"'-o'"
op|','
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|','
string|"'-ldots'"
op|','
nl|'\n'
string|"'-allow-lowercase'"
op|','
string|"'-allow-multidot'"
op|','
string|"'-l'"
op|','
nl|'\n'
string|"'-publisher'"
op|','
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|','
string|"'-quiet'"
op|','
nl|'\n'
string|"'-J'"
op|','
string|"'-r'"
op|','
string|"'-V'"
op|','
string|"'config-2'"
op|','
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|','
nl|'\n'
name|'attempts'
op|'='
number|'1'
op|','
name|'run_as_root'
op|'='
name|'False'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'None'
op|')'
newline|'\n'
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'dd'"
op|','
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|','
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|','
nl|'\n'
name|'run_as_root'
op|'='
name|'True'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'create_vbd'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'create_vbd'
op|'('
string|"'session'"
op|','
string|"'vm_ref'"
op|','
string|"'vdi_ref'"
op|','
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|','
nl|'\n'
name|'bootable'
op|'='
name|'False'
op|','
name|'read_only'
op|'='
name|'True'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|"# And the actual call we're testing"
nl|'\n'
name|'vm_utils'
op|'.'
name|'generate_configdrive'
op|'('
string|"'session'"
op|','
name|'instance'
op|','
string|"'vm_ref'"
op|','
nl|'\n'
string|"'userdevice'"
op|','
string|'"nw_info"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|XenAPIGetUUID
dedent|''
dedent|''
name|'class'
name|'XenAPIGetUUID'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|test_get_this_vm_uuid_new_kernel
indent|'    '
name|'def'
name|'test_get_this_vm_uuid_new_kernel'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_get_sys_hypervisor_uuid'"
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_get_sys_hypervisor_uuid'
op|'('
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
string|"'2f46f0f5-f14c-ef1b-1fac-9eeca0888a3f'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'2f46f0f5-f14c-ef1b-1fac-9eeca0888a3f'"
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'get_this_vm_uuid'
op|'('
name|'None'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_this_vm_uuid_old_kernel_reboot
dedent|''
name|'def'
name|'test_get_this_vm_uuid_old_kernel_reboot'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_get_sys_hypervisor_uuid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'utils'
op|','
string|"'execute'"
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_get_sys_hypervisor_uuid'
op|'('
op|')'
op|'.'
name|'AndRaise'
op|'('
nl|'\n'
name|'IOError'
op|'('
number|'13'
op|','
string|"'Permission denied'"
op|')'
op|')'
newline|'\n'
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'xenstore-read'"
op|','
string|"'domid'"
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
op|'('
string|"'27'"
op|','
string|"''"
op|')'
op|')'
newline|'\n'
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'xenstore-read'"
op|','
string|"'/local/domain/27/vm'"
op|','
nl|'\n'
name|'run_as_root'
op|'='
name|'True'
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
op|'('
string|"'/vm/2f46f0f5-f14c-ef1b-1fac-9eeca0888a3f'"
op|','
string|"''"
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'2f46f0f5-f14c-ef1b-1fac-9eeca0888a3f'"
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'get_this_vm_uuid'
op|'('
name|'None'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeSession
dedent|''
dedent|''
name|'class'
name|'FakeSession'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|call_xenapi
indent|'    '
name|'def'
name|'call_xenapi'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|call_plugin
dedent|''
name|'def'
name|'call_plugin'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|call_plugin_serialized
dedent|''
name|'def'
name|'call_plugin_serialized'
op|'('
name|'self'
op|','
name|'plugin'
op|','
name|'fn'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|call_plugin_serialized_with_retry
dedent|''
name|'def'
name|'call_plugin_serialized_with_retry'
op|'('
name|'self'
op|','
name|'plugin'
op|','
name|'fn'
op|','
name|'num_retries'
op|','
nl|'\n'
name|'callback'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FetchVhdImageTestCase
dedent|''
dedent|''
name|'class'
name|'FetchVhdImageTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'FetchVhdImageTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'context'
op|'.'
name|'get_admin_context'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'.'
name|'auth_token'
op|'='
string|"'auth_token'"
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'='
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'instance'
op|'='
op|'{'
string|'"uuid"'
op|':'
string|'"uuid"'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_make_uuid_stack'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_make_uuid_stack'
op|'('
op|')'
op|'.'
name|'AndReturn'
op|'('
op|'['
string|'"uuid_stack"'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'get_sr_path'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'get_sr_path'
op|'('
name|'self'
op|'.'
name|'session'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'sr_path'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_stub_glance_download_vhd
dedent|''
name|'def'
name|'_stub_glance_download_vhd'
op|'('
name|'self'
op|','
name|'raise_exc'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'session'
op|','
string|"'call_plugin_serialized_with_retry'"
op|')'
newline|'\n'
name|'func'
op|'='
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_plugin_serialized_with_retry'
op|'('
nl|'\n'
string|"'glance'"
op|','
string|"'download_vhd'"
op|','
number|'0'
op|','
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|','
nl|'\n'
name|'extra_headers'
op|'='
op|'{'
string|"'X-Service-Catalog'"
op|':'
string|"'[]'"
op|','
nl|'\n'
string|"'X-Auth-Token'"
op|':'
string|"'auth_token'"
op|','
nl|'\n'
string|"'X-Roles'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'X-Tenant-Id'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'X-User-Id'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'X-Identity-Status'"
op|':'
string|"'Confirmed'"
op|'}'
op|','
nl|'\n'
name|'image_id'
op|'='
string|"'image_id'"
op|','
nl|'\n'
name|'uuid_stack'
op|'='
op|'['
string|'"uuid_stack"'
op|']'
op|','
nl|'\n'
name|'sr_path'
op|'='
string|"'sr_path'"
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'raise_exc'
op|':'
newline|'\n'
indent|'            '
name|'func'
op|'.'
name|'AndRaise'
op|'('
name|'raise_exc'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'func'
op|'.'
name|'AndReturn'
op|'('
op|'{'
string|"'root'"
op|':'
op|'{'
string|"'uuid'"
op|':'
string|"'vdi'"
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_stub_bittorrent_download_vhd
dedent|''
dedent|''
name|'def'
name|'_stub_bittorrent_download_vhd'
op|'('
name|'self'
op|','
name|'raise_exc'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'session'
op|','
string|"'call_plugin_serialized'"
op|')'
newline|'\n'
name|'func'
op|'='
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_plugin_serialized'
op|'('
nl|'\n'
string|"'bittorrent'"
op|','
string|"'download_vhd'"
op|','
nl|'\n'
name|'image_id'
op|'='
string|"'image_id'"
op|','
nl|'\n'
name|'uuid_stack'
op|'='
op|'['
string|'"uuid_stack"'
op|']'
op|','
nl|'\n'
name|'sr_path'
op|'='
string|"'sr_path'"
op|','
nl|'\n'
name|'torrent_download_stall_cutoff'
op|'='
number|'600'
op|','
nl|'\n'
name|'torrent_listen_port_start'
op|'='
number|'6881'
op|','
nl|'\n'
name|'torrent_listen_port_end'
op|'='
number|'6891'
op|','
nl|'\n'
name|'torrent_max_last_accessed'
op|'='
number|'86400'
op|','
nl|'\n'
name|'torrent_max_seeder_processes_per_host'
op|'='
number|'1'
op|','
nl|'\n'
name|'torrent_seed_chance'
op|'='
number|'1.0'
op|','
nl|'\n'
name|'torrent_seed_duration'
op|'='
number|'3600'
op|','
nl|'\n'
name|'torrent_url'
op|'='
string|"'http://foo/image_id.torrent'"
nl|'\n'
op|')'
newline|'\n'
name|'if'
name|'raise_exc'
op|':'
newline|'\n'
indent|'            '
name|'func'
op|'.'
name|'AndRaise'
op|'('
name|'raise_exc'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'func'
op|'.'
name|'AndReturn'
op|'('
op|'{'
string|"'root'"
op|':'
op|'{'
string|"'uuid'"
op|':'
string|"'vdi'"
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_fetch_vhd_image_works_with_glance
dedent|''
dedent|''
name|'def'
name|'test_fetch_vhd_image_works_with_glance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_image_uses_bittorrent'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_image_uses_bittorrent'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'instance'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_stub_glance_download_vhd'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'safe_find_sr'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'safe_find_sr'
op|'('
name|'self'
op|'.'
name|'session'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"sr"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_scan_sr'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_scan_sr'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"sr"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_check_vdi_size'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_check_vdi_size'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
string|'"vdi"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"vdi"'
op|','
name|'vm_utils'
op|'.'
name|'_fetch_vhd_image'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
string|"'image_id'"
op|')'
op|'['
string|"'root'"
op|']'
op|'['
string|"'uuid'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_fetch_vhd_image_works_with_bittorrent
dedent|''
name|'def'
name|'test_fetch_vhd_image_works_with_bittorrent'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cfg'
op|'.'
name|'CONF'
op|'.'
name|'import_opt'
op|'('
string|"'torrent_base_url'"
op|','
nl|'\n'
string|"'nova.virt.xenapi.image.bittorrent'"
op|','
nl|'\n'
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'torrent_base_url'
op|'='
string|"'http://foo'"
op|','
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_image_uses_bittorrent'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_image_uses_bittorrent'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'instance'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_stub_bittorrent_download_vhd'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'safe_find_sr'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'safe_find_sr'
op|'('
name|'self'
op|'.'
name|'session'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"sr"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_scan_sr'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_scan_sr'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"sr"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_check_vdi_size'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_check_vdi_size'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
nl|'\n'
string|'"vdi"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"vdi"'
op|','
name|'vm_utils'
op|'.'
name|'_fetch_vhd_image'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
string|"'image_id'"
op|')'
op|'['
string|"'root'"
op|']'
op|'['
string|"'uuid'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_fetch_vhd_image_cleans_up_vdi_on_fail
dedent|''
name|'def'
name|'test_fetch_vhd_image_cleans_up_vdi_on_fail'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_image_uses_bittorrent'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_image_uses_bittorrent'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'instance'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_stub_glance_download_vhd'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'safe_find_sr'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'safe_find_sr'
op|'('
name|'self'
op|'.'
name|'session'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"sr"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_scan_sr'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_scan_sr'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"sr"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_check_vdi_size'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_check_vdi_size'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
nl|'\n'
string|'"vdi"'
op|')'
op|'.'
name|'AndRaise'
op|'('
name|'exception'
op|'.'
name|'FlavorDiskTooSmall'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|"'call_xenapi'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|'"VDI.get_by_uuid"'
op|','
string|'"vdi"'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"ref"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'destroy_vdi'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'destroy_vdi'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"ref"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'FlavorDiskTooSmall'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'_fetch_vhd_image'
op|','
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'instance'
op|','
string|"'image_id'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_fallback_to_default_handler
dedent|''
name|'def'
name|'test_fallback_to_default_handler'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cfg'
op|'.'
name|'CONF'
op|'.'
name|'import_opt'
op|'('
string|"'torrent_base_url'"
op|','
nl|'\n'
string|"'nova.virt.xenapi.image.bittorrent'"
op|','
nl|'\n'
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'torrent_base_url'
op|'='
string|"'http://foo'"
op|','
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_image_uses_bittorrent'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_image_uses_bittorrent'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'instance'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_stub_bittorrent_download_vhd'
op|'('
name|'raise_exc'
op|'='
name|'RuntimeError'
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_make_uuid_stack'
op|'('
op|')'
op|'.'
name|'AndReturn'
op|'('
op|'['
string|'"uuid_stack"'
op|']'
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'get_sr_path'
op|'('
name|'self'
op|'.'
name|'session'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'sr_path'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_stub_glance_download_vhd'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'safe_find_sr'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'safe_find_sr'
op|'('
name|'self'
op|'.'
name|'session'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"sr"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_scan_sr'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_scan_sr'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"sr"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_check_vdi_size'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_check_vdi_size'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
nl|'\n'
string|'"vdi"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"vdi"'
op|','
name|'vm_utils'
op|'.'
name|'_fetch_vhd_image'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
string|"'image_id'"
op|')'
op|'['
string|"'root'"
op|']'
op|'['
string|"'uuid'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_default_handler_doesnt_fallback_to_itself
dedent|''
name|'def'
name|'test_default_handler_doesnt_fallback_to_itself'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cfg'
op|'.'
name|'CONF'
op|'.'
name|'import_opt'
op|'('
string|"'torrent_base_url'"
op|','
nl|'\n'
string|"'nova.virt.xenapi.image.bittorrent'"
op|','
nl|'\n'
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'torrent_base_url'
op|'='
string|"'http://foo'"
op|','
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_image_uses_bittorrent'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_image_uses_bittorrent'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'instance'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_stub_glance_download_vhd'
op|'('
name|'raise_exc'
op|'='
name|'RuntimeError'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'RuntimeError'
op|','
name|'vm_utils'
op|'.'
name|'_fetch_vhd_image'
op|','
nl|'\n'
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
string|"'image_id'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestImageCompression
dedent|''
dedent|''
name|'class'
name|'TestImageCompression'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|test_image_compression
indent|'    '
name|'def'
name|'test_image_compression'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Testing for nova.conf, too low, negative, and a correct value.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'vm_utils'
op|'.'
name|'get_compression_level'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'image_compression_level'
op|'='
number|'0'
op|','
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'vm_utils'
op|'.'
name|'get_compression_level'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'image_compression_level'
op|'='
op|'-'
number|'6'
op|','
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'vm_utils'
op|'.'
name|'get_compression_level'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'image_compression_level'
op|'='
number|'6'
op|','
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'vm_utils'
op|'.'
name|'get_compression_level'
op|'('
op|')'
op|','
number|'6'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ResizeHelpersTestCase
dedent|''
dedent|''
name|'class'
name|'ResizeHelpersTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|test_repair_filesystem
indent|'    '
name|'def'
name|'test_repair_filesystem'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'utils'
op|','
string|"'execute'"
op|')'
newline|'\n'
nl|'\n'
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'e2fsck'"
op|','
string|"'-f'"
op|','
string|'"-y"'
op|','
string|'"fakepath"'
op|','
nl|'\n'
name|'run_as_root'
op|'='
name|'True'
op|','
name|'check_exit_code'
op|'='
op|'['
number|'0'
op|','
number|'1'
op|','
number|'2'
op|']'
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
op|'('
string|'"size is: 42"'
op|','
string|'""'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_repair_filesystem'
op|'('
string|'"fakepath"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_call_tune2fs_remove_journal
dedent|''
name|'def'
name|'_call_tune2fs_remove_journal'
op|'('
name|'self'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'utils'
op|'.'
name|'execute'
op|'('
string|'"tune2fs"'
op|','
string|'"-O ^has_journal"'
op|','
name|'path'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_call_tune2fs_add_journal
dedent|''
name|'def'
name|'_call_tune2fs_add_journal'
op|'('
name|'self'
op|','
name|'path'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'utils'
op|'.'
name|'execute'
op|'('
string|'"tune2fs"'
op|','
string|'"-j"'
op|','
name|'path'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_call_parted
dedent|''
name|'def'
name|'_call_parted'
op|'('
name|'self'
op|','
name|'path'
op|','
name|'start'
op|','
name|'end'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'parted'"
op|','
string|"'--script'"
op|','
name|'path'
op|','
string|"'rm'"
op|','
string|"'1'"
op|','
nl|'\n'
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'parted'"
op|','
string|"'--script'"
op|','
name|'path'
op|','
string|"'mkpart'"
op|','
nl|'\n'
string|"'primary'"
op|','
string|"'%ds'"
op|'%'
name|'start'
op|','
string|"'%ds'"
op|'%'
name|'end'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_resize_part_and_fs_down_succeeds
dedent|''
name|'def'
name|'test_resize_part_and_fs_down_succeeds'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|'"_repair_filesystem"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'utils'
op|','
string|"'execute'"
op|')'
newline|'\n'
nl|'\n'
name|'dev_path'
op|'='
string|'"/dev/fake"'
newline|'\n'
name|'partition_path'
op|'='
string|'"%s1"'
op|'%'
name|'dev_path'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_repair_filesystem'
op|'('
name|'partition_path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_call_tune2fs_remove_journal'
op|'('
name|'partition_path'
op|')'
newline|'\n'
name|'utils'
op|'.'
name|'execute'
op|'('
string|'"resize2fs"'
op|','
name|'partition_path'
op|','
string|'"10s"'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_call_parted'
op|'('
name|'dev_path'
op|','
number|'0'
op|','
number|'9'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_call_tune2fs_add_journal'
op|'('
name|'partition_path'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_resize_part_and_fs'
op|'('
string|'"fake"'
op|','
number|'0'
op|','
number|'20'
op|','
number|'10'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_log_progress_if_required
dedent|''
name|'def'
name|'test_log_progress_if_required'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|'.'
name|'LOG'
op|','
string|'"debug"'
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'LOG'
op|'.'
name|'debug'
op|'('
name|'_'
op|'('
string|'"Sparse copy in progress, "'
nl|'\n'
string|'"%(complete_pct).2f%% complete. "'
nl|'\n'
string|'"%(left)s bytes left to copy"'
op|')'
op|','
nl|'\n'
op|'{'
string|'"complete_pct"'
op|':'
number|'50.0'
op|','
string|'"left"'
op|':'
number|'1'
op|'}'
op|')'
newline|'\n'
name|'current'
op|'='
name|'timeutils'
op|'.'
name|'utcnow'
op|'('
op|')'
newline|'\n'
name|'timeutils'
op|'.'
name|'set_time_override'
op|'('
name|'current'
op|')'
newline|'\n'
name|'timeutils'
op|'.'
name|'advance_time_seconds'
op|'('
name|'vm_utils'
op|'.'
name|'PROGRESS_INTERVAL_SECONDS'
op|'+'
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_log_progress_if_required'
op|'('
number|'1'
op|','
name|'current'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_log_progress_if_not_required
dedent|''
name|'def'
name|'test_log_progress_if_not_required'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|'.'
name|'LOG'
op|','
string|'"debug"'
op|')'
newline|'\n'
name|'current'
op|'='
name|'timeutils'
op|'.'
name|'utcnow'
op|'('
op|')'
newline|'\n'
name|'timeutils'
op|'.'
name|'set_time_override'
op|'('
name|'current'
op|')'
newline|'\n'
name|'timeutils'
op|'.'
name|'advance_time_seconds'
op|'('
name|'vm_utils'
op|'.'
name|'PROGRESS_INTERVAL_SECONDS'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_log_progress_if_required'
op|'('
number|'1'
op|','
name|'current'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_resize_part_and_fs_down_fails_disk_too_big
dedent|''
name|'def'
name|'test_resize_part_and_fs_down_fails_disk_too_big'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|'"_repair_filesystem"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'utils'
op|','
string|"'execute'"
op|')'
newline|'\n'
nl|'\n'
name|'dev_path'
op|'='
string|'"/dev/fake"'
newline|'\n'
name|'partition_path'
op|'='
string|'"%s1"'
op|'%'
name|'dev_path'
newline|'\n'
name|'new_sectors'
op|'='
number|'10'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_repair_filesystem'
op|'('
name|'partition_path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_call_tune2fs_remove_journal'
op|'('
name|'partition_path'
op|')'
newline|'\n'
name|'mobj'
op|'='
name|'utils'
op|'.'
name|'execute'
op|'('
string|'"resize2fs"'
op|','
nl|'\n'
name|'partition_path'
op|','
nl|'\n'
string|'"%ss"'
op|'%'
name|'new_sectors'
op|','
nl|'\n'
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
name|'mobj'
op|'.'
name|'AndRaise'
op|'('
name|'processutils'
op|'.'
name|'ProcessExecutionError'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'ResizeError'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'_resize_part_and_fs'
op|','
string|'"fake"'
op|','
number|'0'
op|','
number|'20'
op|','
number|'10'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_resize_part_and_fs_up_succeeds
dedent|''
name|'def'
name|'test_resize_part_and_fs_up_succeeds'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|'"_repair_filesystem"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'utils'
op|','
string|"'execute'"
op|')'
newline|'\n'
nl|'\n'
name|'dev_path'
op|'='
string|'"/dev/fake"'
newline|'\n'
name|'partition_path'
op|'='
string|'"%s1"'
op|'%'
name|'dev_path'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_repair_filesystem'
op|'('
name|'partition_path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_call_tune2fs_remove_journal'
op|'('
name|'partition_path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_call_parted'
op|'('
name|'dev_path'
op|','
number|'0'
op|','
number|'29'
op|')'
newline|'\n'
name|'utils'
op|'.'
name|'execute'
op|'('
string|'"resize2fs"'
op|','
name|'partition_path'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_call_tune2fs_add_journal'
op|'('
name|'partition_path'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_resize_part_and_fs'
op|'('
string|'"fake"'
op|','
number|'0'
op|','
number|'20'
op|','
number|'30'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_resize_disk_throws_on_zero_size
dedent|''
name|'def'
name|'test_resize_disk_throws_on_zero_size'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'ResizeError'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'resize_disk'
op|','
string|'"session"'
op|','
string|'"instance"'
op|','
string|'"vdi_ref"'
op|','
nl|'\n'
op|'{'
string|'"root_gb"'
op|':'
number|'0'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_auto_config_disk_returns_early_on_zero_size
dedent|''
name|'def'
name|'test_auto_config_disk_returns_early_on_zero_size'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vm_utils'
op|'.'
name|'try_auto_configure_disk'
op|'('
string|'"bad_session"'
op|','
string|'"bad_vdi_ref"'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|CheckVDISizeTestCase
dedent|''
dedent|''
name|'class'
name|'CheckVDISizeTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'CheckVDISizeTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
string|"'fakecontext'"
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'='
string|"'fakesession'"
newline|'\n'
name|'self'
op|'.'
name|'instance'
op|'='
name|'dict'
op|'('
name|'uuid'
op|'='
string|"'fakeinstance'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'vdi_uuid'
op|'='
string|"'fakeuuid'"
newline|'\n'
nl|'\n'
DECL|member|test_not_too_large
dedent|''
name|'def'
name|'test_not_too_large'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'flavors'
op|','
string|"'extract_flavor'"
op|')'
newline|'\n'
name|'flavors'
op|'.'
name|'extract_flavor'
op|'('
name|'self'
op|'.'
name|'instance'
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
name|'dict'
op|'('
name|'root_gb'
op|'='
number|'1'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_get_vdi_chain_size'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_get_vdi_chain_size'
op|'('
name|'self'
op|'.'
name|'session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'vdi_uuid'
op|')'
op|'.'
name|'AndReturn'
op|'('
number|'1073741824'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_check_vdi_size'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
nl|'\n'
name|'self'
op|'.'
name|'vdi_uuid'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_too_large
dedent|''
name|'def'
name|'test_too_large'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'flavors'
op|','
string|"'extract_flavor'"
op|')'
newline|'\n'
name|'flavors'
op|'.'
name|'extract_flavor'
op|'('
name|'self'
op|'.'
name|'instance'
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
name|'dict'
op|'('
name|'root_gb'
op|'='
number|'1'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_get_vdi_chain_size'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_get_vdi_chain_size'
op|'('
name|'self'
op|'.'
name|'session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'vdi_uuid'
op|')'
op|'.'
name|'AndReturn'
op|'('
number|'11811160065'
op|')'
comment|'# 10GB overhead allowed'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'FlavorDiskTooSmall'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'_check_vdi_size'
op|','
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'session'
op|','
nl|'\n'
name|'self'
op|'.'
name|'instance'
op|','
name|'self'
op|'.'
name|'vdi_uuid'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_zero_root_gb_disables_check
dedent|''
name|'def'
name|'test_zero_root_gb_disables_check'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'flavors'
op|','
string|"'extract_flavor'"
op|')'
newline|'\n'
name|'flavors'
op|'.'
name|'extract_flavor'
op|'('
name|'self'
op|'.'
name|'instance'
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
name|'dict'
op|'('
name|'root_gb'
op|'='
number|'0'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_check_vdi_size'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
nl|'\n'
name|'self'
op|'.'
name|'vdi_uuid'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|GetInstanceForVdisForSrTestCase
dedent|''
dedent|''
name|'class'
name|'GetInstanceForVdisForSrTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'GetInstanceForVdisForSrTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'disable_process_locking'
op|'='
name|'True'
op|','
nl|'\n'
name|'instance_name_template'
op|'='
string|"'%d'"
op|','
nl|'\n'
name|'firewall_driver'
op|'='
string|"'nova.virt.xenapi.firewall.'"
nl|'\n'
string|"'Dom0IptablesFirewallDriver'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'connection_url'
op|'='
string|"'test_url'"
op|','
nl|'\n'
name|'connection_password'
op|'='
string|"'test_pass'"
op|','
nl|'\n'
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_instance_vdis_for_sr
dedent|''
name|'def'
name|'test_get_instance_vdis_for_sr'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vm_ref'
op|'='
name|'fake'
op|'.'
name|'create_vm'
op|'('
string|'"foo"'
op|','
string|'"Running"'
op|')'
newline|'\n'
name|'sr_ref'
op|'='
name|'fake'
op|'.'
name|'create_sr'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vdi_1'
op|'='
name|'fake'
op|'.'
name|'create_vdi'
op|'('
string|"'vdiname1'"
op|','
name|'sr_ref'
op|')'
newline|'\n'
name|'vdi_2'
op|'='
name|'fake'
op|'.'
name|'create_vdi'
op|'('
string|"'vdiname2'"
op|','
name|'sr_ref'
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'vdi_ref'
name|'in'
op|'['
name|'vdi_1'
op|','
name|'vdi_2'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'fake'
op|'.'
name|'create_vbd'
op|'('
name|'vm_ref'
op|','
name|'vdi_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'stubs'
op|'.'
name|'stubout_session'
op|'('
name|'self'
op|'.'
name|'stubs'
op|','
name|'fake'
op|'.'
name|'SessionBase'
op|')'
newline|'\n'
name|'driver'
op|'='
name|'xenapi_conn'
op|'.'
name|'XenAPIDriver'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'list'
op|'('
name|'vm_utils'
op|'.'
name|'get_instance_vdis_for_sr'
op|'('
nl|'\n'
name|'driver'
op|'.'
name|'_session'
op|','
name|'vm_ref'
op|','
name|'sr_ref'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
name|'vdi_1'
op|','
name|'vdi_2'
op|']'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_instance_vdis_for_sr_no_vbd
dedent|''
name|'def'
name|'test_get_instance_vdis_for_sr_no_vbd'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vm_ref'
op|'='
name|'fake'
op|'.'
name|'create_vm'
op|'('
string|'"foo"'
op|','
string|'"Running"'
op|')'
newline|'\n'
name|'sr_ref'
op|'='
name|'fake'
op|'.'
name|'create_sr'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'stubs'
op|'.'
name|'stubout_session'
op|'('
name|'self'
op|'.'
name|'stubs'
op|','
name|'fake'
op|'.'
name|'SessionBase'
op|')'
newline|'\n'
name|'driver'
op|'='
name|'xenapi_conn'
op|'.'
name|'XenAPIDriver'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'list'
op|'('
name|'vm_utils'
op|'.'
name|'get_instance_vdis_for_sr'
op|'('
nl|'\n'
name|'driver'
op|'.'
name|'_session'
op|','
name|'vm_ref'
op|','
name|'sr_ref'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|']'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vdi_uuid_for_volume_with_sr_uuid
dedent|''
name|'def'
name|'test_get_vdi_uuid_for_volume_with_sr_uuid'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'connection_data'
op|'='
name|'get_fake_connection_data'
op|'('
name|'XENSM_TYPE'
op|')'
newline|'\n'
name|'stubs'
op|'.'
name|'stubout_session'
op|'('
name|'self'
op|'.'
name|'stubs'
op|','
name|'fake'
op|'.'
name|'SessionBase'
op|')'
newline|'\n'
name|'driver'
op|'='
name|'xenapi_conn'
op|'.'
name|'XenAPIDriver'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'vdi_uuid'
op|'='
name|'vm_utils'
op|'.'
name|'get_vdi_uuid_for_volume'
op|'('
nl|'\n'
name|'driver'
op|'.'
name|'_session'
op|','
name|'connection_data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'vdi_uuid'
op|','
string|"'falseVDI'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vdi_uuid_for_volume_failure
dedent|''
name|'def'
name|'test_get_vdi_uuid_for_volume_failure'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'stubs'
op|'.'
name|'stubout_session'
op|'('
name|'self'
op|'.'
name|'stubs'
op|','
name|'fake'
op|'.'
name|'SessionBase'
op|')'
newline|'\n'
name|'driver'
op|'='
name|'xenapi_conn'
op|'.'
name|'XenAPIDriver'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|function|bad_introduce_sr
name|'def'
name|'bad_introduce_sr'
op|'('
name|'session'
op|','
name|'sr_uuid'
op|','
name|'label'
op|','
name|'sr_params'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'None'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'volume_utils'
op|','
string|"'introduce_sr'"
op|','
name|'bad_introduce_sr'
op|')'
newline|'\n'
name|'connection_data'
op|'='
name|'get_fake_connection_data'
op|'('
name|'XENSM_TYPE'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NovaException'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'get_vdi_uuid_for_volume'
op|','
nl|'\n'
name|'driver'
op|'.'
name|'_session'
op|','
name|'connection_data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vdi_uuid_for_volume_from_iscsi_vol_missing_sr_uuid
dedent|''
name|'def'
name|'test_get_vdi_uuid_for_volume_from_iscsi_vol_missing_sr_uuid'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'connection_data'
op|'='
name|'get_fake_connection_data'
op|'('
name|'ISCSI_TYPE'
op|')'
newline|'\n'
name|'stubs'
op|'.'
name|'stubout_session'
op|'('
name|'self'
op|'.'
name|'stubs'
op|','
name|'fake'
op|'.'
name|'SessionBase'
op|')'
newline|'\n'
name|'driver'
op|'='
name|'xenapi_conn'
op|'.'
name|'XenAPIDriver'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'vdi_uuid'
op|'='
name|'vm_utils'
op|'.'
name|'get_vdi_uuid_for_volume'
op|'('
nl|'\n'
name|'driver'
op|'.'
name|'_session'
op|','
name|'connection_data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNotNone'
op|'('
name|'vdi_uuid'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VMRefOrRaiseVMFoundTestCase
dedent|''
dedent|''
name|'class'
name|'VMRefOrRaiseVMFoundTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|test_lookup_call
indent|'    '
name|'def'
name|'test_lookup_call'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock'
op|'='
name|'mox'
op|'.'
name|'Mox'
op|'('
op|')'
newline|'\n'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'lookup'"
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'lookup'
op|'('
string|"'session'"
op|','
string|"'somename'"
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'ignored'"
op|')'
newline|'\n'
nl|'\n'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'vm_ref_or_raise'
op|'('
string|"'session'"
op|','
string|"'somename'"
op|')'
newline|'\n'
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_return_value
dedent|''
name|'def'
name|'test_return_value'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock'
op|'='
name|'mox'
op|'.'
name|'Mox'
op|'('
op|')'
newline|'\n'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'lookup'"
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'lookup'
op|'('
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|','
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'vmref'"
op|')'
newline|'\n'
nl|'\n'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
string|"'vmref'"
op|','
name|'vm_utils'
op|'.'
name|'vm_ref_or_raise'
op|'('
string|"'session'"
op|','
string|"'somename'"
op|')'
op|')'
newline|'\n'
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VMRefOrRaiseVMNotFoundTestCase
dedent|''
dedent|''
name|'class'
name|'VMRefOrRaiseVMNotFoundTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|test_exception_raised
indent|'    '
name|'def'
name|'test_exception_raised'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock'
op|'='
name|'mox'
op|'.'
name|'Mox'
op|'('
op|')'
newline|'\n'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'lookup'"
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'lookup'
op|'('
string|"'session'"
op|','
string|"'somename'"
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
nl|'\n'
name|'exception'
op|'.'
name|'InstanceNotFound'
op|','
nl|'\n'
name|'lambda'
op|':'
name|'vm_utils'
op|'.'
name|'vm_ref_or_raise'
op|'('
string|"'session'"
op|','
string|"'somename'"
op|')'
nl|'\n'
op|')'
newline|'\n'
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_exception_msg_contains_vm_name
dedent|''
name|'def'
name|'test_exception_msg_contains_vm_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock'
op|'='
name|'mox'
op|'.'
name|'Mox'
op|'('
op|')'
newline|'\n'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'lookup'"
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'lookup'
op|'('
string|"'session'"
op|','
string|"'somename'"
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'vm_utils'
op|'.'
name|'vm_ref_or_raise'
op|'('
string|"'session'"
op|','
string|"'somename'"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'exception'
op|'.'
name|'InstanceNotFound'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertTrue'
op|'('
nl|'\n'
string|"'somename'"
name|'in'
name|'str'
op|'('
name|'e'
op|')'
op|')'
newline|'\n'
dedent|''
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|BittorrentTestCase
dedent|''
dedent|''
name|'class'
name|'BittorrentTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'BittorrentTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'context'
op|'.'
name|'get_admin_context'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_image_uses_bittorrent
dedent|''
name|'def'
name|'test_image_uses_bittorrent'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
op|'{'
string|"'system_metadata'"
op|':'
op|'{'
string|"'image_bittorrent'"
op|':'
name|'True'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'torrent_images'
op|'='
string|"'some'"
op|','
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'vm_utils'
op|'.'
name|'_image_uses_bittorrent'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'instance'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_create_image
dedent|''
name|'def'
name|'_test_create_image'
op|'('
name|'self'
op|','
name|'cache_type'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
op|'{'
string|"'system_metadata'"
op|':'
op|'{'
string|"'image_cache_in_nova'"
op|':'
name|'True'
op|'}'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'cache_images'
op|'='
name|'cache_type'
op|','
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
nl|'\n'
name|'was'
op|'='
op|'{'
string|"'called'"
op|':'
name|'None'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|fake_create_cached_image
name|'def'
name|'fake_create_cached_image'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'was'
op|'['
string|"'called'"
op|']'
op|'='
string|"'some'"
newline|'\n'
name|'return'
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'vm_utils'
op|','
string|"'_create_cached_image'"
op|','
nl|'\n'
name|'fake_create_cached_image'
op|')'
newline|'\n'
nl|'\n'
DECL|function|fake_fetch_image
name|'def'
name|'fake_fetch_image'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'was'
op|'['
string|"'called'"
op|']'
op|'='
string|"'none'"
newline|'\n'
name|'return'
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'vm_utils'
op|','
string|"'_fetch_image'"
op|','
nl|'\n'
name|'fake_fetch_image'
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_create_image'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'None'
op|','
name|'instance'
op|','
nl|'\n'
string|"'foo'"
op|','
string|"'bar'"
op|','
string|"'baz'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'was'
op|'['
string|"'called'"
op|']'
op|','
name|'cache_type'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_image_cached
dedent|''
name|'def'
name|'test_create_image_cached'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_image'
op|'('
string|"'some'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_image_uncached
dedent|''
name|'def'
name|'test_create_image_uncached'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_create_image'
op|'('
string|"'none'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ShutdownTestCase
dedent|''
dedent|''
name|'class'
name|'ShutdownTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|test_hardshutdown_should_return_true_when_vm_is_shutdown
indent|'    '
name|'def'
name|'test_hardshutdown_should_return_true_when_vm_is_shutdown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mock'
op|'='
name|'mox'
op|'.'
name|'Mox'
op|'('
op|')'
newline|'\n'
name|'session'
op|'='
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'instance'
op|'='
string|'"instance"'
newline|'\n'
name|'vm_ref'
op|'='
string|'"vm-ref"'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'is_vm_shutdown'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'is_vm_shutdown'
op|'('
name|'session'
op|','
name|'vm_ref'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'LOG'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'vm_utils'
op|'.'
name|'hard_shutdown_vm'
op|'('
nl|'\n'
name|'session'
op|','
name|'instance'
op|','
name|'vm_ref'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_cleanshutdown_should_return_true_when_vm_is_shutdown
dedent|''
name|'def'
name|'test_cleanshutdown_should_return_true_when_vm_is_shutdown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mock'
op|'='
name|'mox'
op|'.'
name|'Mox'
op|'('
op|')'
newline|'\n'
name|'session'
op|'='
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'instance'
op|'='
string|'"instance"'
newline|'\n'
name|'vm_ref'
op|'='
string|'"vm-ref"'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'is_vm_shutdown'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'is_vm_shutdown'
op|'('
name|'session'
op|','
name|'vm_ref'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'LOG'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'vm_utils'
op|'.'
name|'clean_shutdown_vm'
op|'('
nl|'\n'
name|'session'
op|','
name|'instance'
op|','
name|'vm_ref'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|CreateVBDTestCase
dedent|''
dedent|''
name|'class'
name|'CreateVBDTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'CreateVBDTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'='
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'='
name|'mox'
op|'.'
name|'Mox'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|"'call_xenapi'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|'='
name|'self'
op|'.'
name|'_generate_vbd_rec'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_generate_vbd_rec
dedent|''
name|'def'
name|'_generate_vbd_rec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vbd_rec'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'VM'"
op|']'
op|'='
string|"'vm_ref'"
newline|'\n'
name|'vbd_rec'
op|'['
string|"'VDI'"
op|']'
op|'='
string|"'vdi_ref'"
newline|'\n'
name|'vbd_rec'
op|'['
string|"'userdevice'"
op|']'
op|'='
string|"'0'"
newline|'\n'
name|'vbd_rec'
op|'['
string|"'bootable'"
op|']'
op|'='
name|'False'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'mode'"
op|']'
op|'='
string|"'RW'"
newline|'\n'
name|'vbd_rec'
op|'['
string|"'type'"
op|']'
op|'='
string|"'disk'"
newline|'\n'
name|'vbd_rec'
op|'['
string|"'unpluggable'"
op|']'
op|'='
name|'True'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'empty'"
op|']'
op|'='
name|'False'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'other_config'"
op|']'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'qos_algorithm_type'"
op|']'
op|'='
string|"''"
newline|'\n'
name|'vbd_rec'
op|'['
string|"'qos_algorithm_params'"
op|']'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'qos_supported_algorithms'"
op|']'
op|'='
op|'['
op|']'
newline|'\n'
name|'return'
name|'vbd_rec'
newline|'\n'
nl|'\n'
DECL|member|test_create_vbd_default_args
dedent|''
name|'def'
name|'test_create_vbd_default_args'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|"'VBD.create'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'create_vbd'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"vm_ref"'
op|','
string|'"vdi_ref"'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_vbd_osvol
dedent|''
name|'def'
name|'test_create_vbd_osvol'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|"'VBD.create'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|"'VBD.add_to_other_config'"
op|','
string|'"vbd_ref"'
op|','
nl|'\n'
string|'"osvol"'
op|','
string|'"True"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'create_vbd'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"vm_ref"'
op|','
string|'"vdi_ref"'
op|','
number|'0'
op|','
nl|'\n'
name|'osvol'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_vbd_extra_args
dedent|''
name|'def'
name|'test_create_vbd_extra_args'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'vbd_rec'
op|'['
string|"'VDI'"
op|']'
op|'='
string|"'OpaqueRef:NULL'"
newline|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|'['
string|"'type'"
op|']'
op|'='
string|"'a'"
newline|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|'['
string|"'mode'"
op|']'
op|'='
string|"'RO'"
newline|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|'['
string|"'bootable'"
op|']'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|'['
string|"'empty'"
op|']'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|'['
string|"'unpluggable'"
op|']'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|"'VBD.create'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'vbd_rec'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'create_vbd'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"vm_ref"'
op|','
name|'None'
op|','
number|'0'
op|','
nl|'\n'
name|'vbd_type'
op|'='
string|'"a"'
op|','
name|'read_only'
op|'='
name|'True'
op|','
name|'bootable'
op|'='
name|'True'
op|','
nl|'\n'
name|'empty'
op|'='
name|'True'
op|','
name|'unpluggable'
op|'='
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_attach_cd
dedent|''
name|'def'
name|'test_attach_cd'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mock'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'create_vbd'"
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'create_vbd'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"vm_ref"'
op|','
name|'None'
op|','
number|'1'
op|','
nl|'\n'
name|'vbd_type'
op|'='
string|"'cd'"
op|','
name|'read_only'
op|'='
name|'True'
op|','
name|'bootable'
op|'='
name|'True'
op|','
nl|'\n'
name|'empty'
op|'='
name|'True'
op|','
name|'unpluggable'
op|'='
name|'False'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|"'VBD.insert'"
op|','
string|'"vbd_ref"'
op|','
string|'"vdi_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'attach_cd'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"vm_ref"'
op|','
string|'"vdi_ref"'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|','
string|'"vbd_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mock'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|UnplugVbdTestCase
dedent|''
dedent|''
name|'class'
name|'UnplugVbdTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'greenthread'
op|','
string|"'sleep'"
op|')'
newline|'\n'
DECL|member|test_unplug_vbd_works
name|'def'
name|'test_unplug_vbd_works'
op|'('
name|'self'
op|','
name|'mock_sleep'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'vbd_ref'
op|'='
string|'"vbd_ref"'
newline|'\n'
name|'vm_ref'
op|'='
string|"'vm_ref'"
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'unplug_vbd'
op|'('
name|'session'
op|','
name|'vbd_ref'
op|','
name|'vm_ref'
op|')'
newline|'\n'
nl|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'VBD.unplug'"
op|','
name|'vbd_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'mock_sleep'
op|'.'
name|'call_count'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_unplug_vbd_raises_unexpected_error
dedent|''
name|'def'
name|'test_unplug_vbd_raises_unexpected_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'vbd_ref'
op|'='
string|'"vbd_ref"'
newline|'\n'
name|'vm_ref'
op|'='
string|"'vm_ref'"
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'side_effect'
op|'='
name|'test'
op|'.'
name|'TestingException'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'test'
op|'.'
name|'TestingException'
op|','
name|'vm_utils'
op|'.'
name|'unplug_vbd'
op|','
nl|'\n'
name|'session'
op|','
name|'vm_ref'
op|','
name|'vbd_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'call_count'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_unplug_vbd_already_detached_works
dedent|''
name|'def'
name|'test_unplug_vbd_already_detached_works'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'error'
op|'='
string|'"DEVICE_ALREADY_DETACHED"'
newline|'\n'
name|'session'
op|'='
name|'_get_fake_session_and_exception'
op|'('
name|'error'
op|')'
newline|'\n'
name|'vbd_ref'
op|'='
string|'"vbd_ref"'
newline|'\n'
name|'vm_ref'
op|'='
string|"'vm_ref'"
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'unplug_vbd'
op|'('
name|'session'
op|','
name|'vbd_ref'
op|','
name|'vm_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'call_count'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_unplug_vbd_already_raises_unexpected_xenapi_error
dedent|''
name|'def'
name|'test_unplug_vbd_already_raises_unexpected_xenapi_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'_get_fake_session_and_exception'
op|'('
string|'""'
op|')'
newline|'\n'
name|'vbd_ref'
op|'='
string|'"vbd_ref"'
newline|'\n'
name|'vm_ref'
op|'='
string|"'vm_ref'"
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'volume_utils'
op|'.'
name|'StorageError'
op|','
name|'vm_utils'
op|'.'
name|'unplug_vbd'
op|','
nl|'\n'
name|'session'
op|','
name|'vbd_ref'
op|','
name|'vm_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'call_count'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_uplug_vbd_retries
dedent|''
name|'def'
name|'_test_uplug_vbd_retries'
op|'('
name|'self'
op|','
name|'mock_sleep'
op|','
name|'error'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'_get_fake_session_and_exception'
op|'('
name|'error'
op|')'
newline|'\n'
name|'vbd_ref'
op|'='
string|'"vbd_ref"'
newline|'\n'
name|'vm_ref'
op|'='
string|"'vm_ref'"
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'volume_utils'
op|'.'
name|'StorageError'
op|','
name|'vm_utils'
op|'.'
name|'unplug_vbd'
op|','
nl|'\n'
name|'session'
op|','
name|'vm_ref'
op|','
name|'vbd_ref'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'11'
op|','
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'call_count'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'10'
op|','
name|'mock_sleep'
op|'.'
name|'call_count'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'greenthread'
op|','
string|"'sleep'"
op|')'
newline|'\n'
DECL|member|test_uplug_vbd_retries_on_rejected
name|'def'
name|'test_uplug_vbd_retries_on_rejected'
op|'('
name|'self'
op|','
name|'mock_sleep'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_uplug_vbd_retries'
op|'('
name|'mock_sleep'
op|','
nl|'\n'
string|'"DEVICE_DETACH_REJECTED"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'greenthread'
op|','
string|"'sleep'"
op|')'
newline|'\n'
DECL|member|test_uplug_vbd_retries_on_internal_error
name|'def'
name|'test_uplug_vbd_retries_on_internal_error'
op|'('
name|'self'
op|','
name|'mock_sleep'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_uplug_vbd_retries'
op|'('
name|'mock_sleep'
op|','
nl|'\n'
string|'"INTERNAL_ERROR"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VDIOtherConfigTestCase
dedent|''
dedent|''
name|'class'
name|'VDIOtherConfigTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Tests to ensure that the code is populating VDI\'s `other_config`\n    attribute with the correct metadta.\n    """'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'VDIOtherConfigTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|class|_FakeSession
name|'class'
name|'_FakeSession'
op|'('
op|')'
op|':'
newline|'\n'
DECL|member|call_xenapi
indent|'            '
name|'def'
name|'call_xenapi'
op|'('
name|'self'
op|','
name|'operation'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
comment|'# VDI.add_to_other_config -> VDI_add_to_other_config'
nl|'\n'
indent|'                '
name|'method'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
name|'operation'
op|'.'
name|'replace'
op|'('
string|"'.'"
op|','
string|"'_'"
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'method'
op|':'
newline|'\n'
indent|'                    '
name|'return'
name|'method'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'operation'
op|'='
name|'operation'
newline|'\n'
name|'self'
op|'.'
name|'args'
op|'='
name|'args'
newline|'\n'
name|'self'
op|'.'
name|'kwargs'
op|'='
name|'kwargs'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'session'
op|'='
name|'_FakeSession'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
name|'context'
op|'.'
name|'get_admin_context'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'fake_instance'
op|'='
op|'{'
string|"'uuid'"
op|':'
string|"'aaaa-bbbb-cccc-dddd'"
op|','
nl|'\n'
string|"'name'"
op|':'
string|"'myinstance'"
op|'}'
newline|'\n'
nl|'\n'
DECL|member|test_create_vdi
dedent|''
name|'def'
name|'test_create_vdi'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Some images are registered with XenServer explicitly by calling'
nl|'\n'
comment|'# `create_vdi`'
nl|'\n'
indent|'        '
name|'vm_utils'
op|'.'
name|'create_vdi'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|"'sr_ref'"
op|','
name|'self'
op|'.'
name|'fake_instance'
op|','
nl|'\n'
string|"'myvdi'"
op|','
string|"'root'"
op|','
number|'1024'
op|','
name|'read_only'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'{'
string|"'nova_disk_type'"
op|':'
string|"'root'"
op|','
nl|'\n'
string|"'nova_instance_uuid'"
op|':'
string|"'aaaa-bbbb-cccc-dddd'"
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'self'
op|'.'
name|'session'
op|'.'
name|'args'
op|'['
number|'0'
op|']'
op|'['
string|"'other_config'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_image
dedent|''
name|'def'
name|'test_create_image'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Other images are registered implicitly when they are dropped into'
nl|'\n'
comment|'# the SR by a dom0 plugin or some other process'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'cache_images'
op|'='
string|"'none'"
op|','
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|fake_fetch_image
name|'def'
name|'fake_fetch_image'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'{'
string|"'root'"
op|':'
op|'{'
string|"'uuid'"
op|':'
string|"'fake-uuid'"
op|'}'
op|'}'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'vm_utils'
op|','
string|"'_fetch_image'"
op|','
name|'fake_fetch_image'
op|')'
newline|'\n'
nl|'\n'
name|'other_config'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|VDI_add_to_other_config
name|'def'
name|'VDI_add_to_other_config'
op|'('
name|'ref'
op|','
name|'key'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'other_config'
op|'['
name|'key'
op|']'
op|'='
name|'value'
newline|'\n'
nl|'\n'
DECL|function|VDI_get_record
dedent|''
name|'def'
name|'VDI_get_record'
op|'('
name|'ref'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'{'
string|"'other_config'"
op|':'
op|'{'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
comment|"# Stubbing on the session object and not class so we don't pollute"
nl|'\n'
comment|'# other tests'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'session'
op|'.'
name|'VDI_add_to_other_config'
op|'='
name|'VDI_add_to_other_config'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'VDI_get_record'
op|'='
name|'VDI_get_record'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_create_image'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'fake_instance'
op|','
nl|'\n'
string|"'myvdi'"
op|','
string|"'image1'"
op|','
name|'vm_utils'
op|'.'
name|'ImageType'
op|'.'
name|'DISK_VHD'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'{'
string|"'nova_disk_type'"
op|':'
string|"'root'"
op|','
nl|'\n'
string|"'nova_instance_uuid'"
op|':'
string|"'aaaa-bbbb-cccc-dddd'"
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'other_config'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_import_migrated_vhds
dedent|''
name|'def'
name|'test_import_migrated_vhds'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Migrated images should preserve the `other_config`'
nl|'\n'
indent|'        '
name|'other_config'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|VDI_add_to_other_config
name|'def'
name|'VDI_add_to_other_config'
op|'('
name|'ref'
op|','
name|'key'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'other_config'
op|'['
name|'key'
op|']'
op|'='
name|'value'
newline|'\n'
nl|'\n'
DECL|function|VDI_get_record
dedent|''
name|'def'
name|'VDI_get_record'
op|'('
name|'ref'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'{'
string|"'other_config'"
op|':'
op|'{'
op|'}'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|call_plugin_serialized
dedent|''
name|'def'
name|'call_plugin_serialized'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'{'
string|"'root'"
op|':'
op|'{'
string|"'uuid'"
op|':'
string|"'aaaa-bbbb-cccc-dddd'"
op|'}'
op|'}'
newline|'\n'
nl|'\n'
comment|"# Stubbing on the session object and not class so we don't pollute"
nl|'\n'
comment|'# other tests'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'session'
op|'.'
name|'VDI_add_to_other_config'
op|'='
name|'VDI_add_to_other_config'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'VDI_get_record'
op|'='
name|'VDI_get_record'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_plugin_serialized'
op|'='
name|'call_plugin_serialized'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'vm_utils'
op|','
string|"'get_sr_path'"
op|','
name|'lambda'
op|'*'
name|'a'
op|','
op|'**'
name|'k'
op|':'
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'vm_utils'
op|','
string|"'scan_default_sr'"
op|','
name|'lambda'
op|'*'
name|'a'
op|','
op|'**'
name|'k'
op|':'
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_import_migrated_vhds'
op|'('
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'fake_instance'
op|','
nl|'\n'
string|'"disk_label"'
op|','
string|'"root"'
op|','
string|'"vdi_label"'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'{'
string|"'nova_disk_type'"
op|':'
string|"'root'"
op|','
nl|'\n'
string|"'nova_instance_uuid'"
op|':'
string|"'aaaa-bbbb-cccc-dddd'"
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'other_config'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|GenerateDiskTestCase
dedent|''
dedent|''
name|'class'
name|'GenerateDiskTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'GenerateDiskTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'disable_process_locking'
op|'='
name|'True'
op|','
nl|'\n'
name|'instance_name_template'
op|'='
string|"'%d'"
op|','
nl|'\n'
name|'firewall_driver'
op|'='
string|"'nova.virt.xenapi.firewall.'"
nl|'\n'
string|"'Dom0IptablesFirewallDriver'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'connection_url'
op|'='
string|"'test_url'"
op|','
nl|'\n'
name|'connection_password'
op|'='
string|"'test_pass'"
op|','
nl|'\n'
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
name|'stubs'
op|'.'
name|'stubout_session'
op|'('
name|'self'
op|'.'
name|'stubs'
op|','
name|'fake'
op|'.'
name|'SessionBase'
op|')'
newline|'\n'
name|'driver'
op|'='
name|'xenapi_conn'
op|'.'
name|'XenAPIDriver'
op|'('
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'='
name|'driver'
op|'.'
name|'_session'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'is_local_connection'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'vm_ref'
op|'='
name|'fake'
op|'.'
name|'create_vm'
op|'('
string|'"foo"'
op|','
string|'"Running"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'GenerateDiskTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'tearDown'
op|'('
op|')'
newline|'\n'
name|'fake'
op|'.'
name|'destroy_vm'
op|'('
name|'self'
op|'.'
name|'vm_ref'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_expect_parted_calls
dedent|''
name|'def'
name|'_expect_parted_calls'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'utils'
op|','
string|'"execute"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'utils'
op|','
string|'"trycmd"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|'"destroy_vdi"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|'.'
name|'os'
op|'.'
name|'path'
op|','
string|'"exists"'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'session'
op|'.'
name|'is_local_connection'
op|':'
newline|'\n'
indent|'            '
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'parted'"
op|','
string|"'--script'"
op|','
string|"'/dev/fakedev'"
op|','
string|"'mklabel'"
op|','
nl|'\n'
string|"'msdos'"
op|','
name|'check_exit_code'
op|'='
name|'False'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'parted'"
op|','
string|"'--script'"
op|','
string|"'/dev/fakedev'"
op|','
string|"'--'"
op|','
string|"'mkpart'"
op|','
nl|'\n'
string|"'primary'"
op|','
string|"'0'"
op|','
string|"'-0'"
op|','
nl|'\n'
name|'check_exit_code'
op|'='
name|'False'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
string|"'/dev/mapper/fakedev1'"
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'True'
op|')'
newline|'\n'
name|'utils'
op|'.'
name|'trycmd'
op|'('
string|"'kpartx'"
op|','
string|"'-a'"
op|','
string|"'/dev/fakedev'"
op|','
nl|'\n'
name|'discard_warnings'
op|'='
name|'True'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'parted'"
op|','
string|"'--script'"
op|','
string|"'/dev/fakedev'"
op|','
string|"'mklabel'"
op|','
nl|'\n'
string|"'msdos'"
op|','
name|'check_exit_code'
op|'='
name|'True'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'parted'"
op|','
string|"'--script'"
op|','
string|"'/dev/fakedev'"
op|','
string|"'--'"
op|','
string|"'mkpart'"
op|','
nl|'\n'
string|"'primary'"
op|','
string|"'0'"
op|','
string|"'-0'"
op|','
nl|'\n'
name|'check_exit_code'
op|'='
name|'True'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_check_vdi
dedent|''
dedent|''
name|'def'
name|'_check_vdi'
op|'('
name|'self'
op|','
name|'vdi_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vdi_rec'
op|'='
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|'"VDI.get_record"'
op|','
name|'vdi_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'str'
op|'('
number|'10'
op|'*'
name|'unit'
op|'.'
name|'Mi'
op|')'
op|','
name|'vdi_rec'
op|'['
string|'"virtual_size"'
op|']'
op|')'
newline|'\n'
name|'vbd_ref'
op|'='
name|'vdi_rec'
op|'['
string|'"VBDs"'
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'vbd_rec'
op|'='
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|'"VBD.get_record"'
op|','
name|'vbd_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'vm_ref'
op|','
name|'vbd_rec'
op|'['
string|"'VM'"
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'test_xenapi'
op|'.'
name|'stub_vm_utils_with_vdi_attached_here'
newline|'\n'
DECL|member|test_generate_disk_with_no_fs_given
name|'def'
name|'test_generate_disk_with_no_fs_given'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_expect_parted_calls'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'vdi_ref'
op|'='
name|'vm_utils'
op|'.'
name|'_generate_disk'
op|'('
name|'self'
op|'.'
name|'session'
op|','
op|'{'
string|'"uuid"'
op|':'
string|'"fake_uuid"'
op|'}'
op|','
nl|'\n'
name|'self'
op|'.'
name|'vm_ref'
op|','
string|'"2"'
op|','
string|'"name"'
op|','
string|'"user"'
op|','
number|'10'
op|','
name|'None'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_vdi'
op|'('
name|'vdi_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'test_xenapi'
op|'.'
name|'stub_vm_utils_with_vdi_attached_here'
newline|'\n'
DECL|member|test_generate_disk_swap
name|'def'
name|'test_generate_disk_swap'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_expect_parted_calls'
op|'('
op|')'
newline|'\n'
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'mkswap'"
op|','
string|"'/dev/fakedev1'"
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'vdi_ref'
op|'='
name|'vm_utils'
op|'.'
name|'_generate_disk'
op|'('
name|'self'
op|'.'
name|'session'
op|','
op|'{'
string|'"uuid"'
op|':'
string|'"fake_uuid"'
op|'}'
op|','
nl|'\n'
name|'self'
op|'.'
name|'vm_ref'
op|','
string|'"2"'
op|','
string|'"name"'
op|','
string|'"swap"'
op|','
number|'10'
op|','
string|'"linux-swap"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_vdi'
op|'('
name|'vdi_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'test_xenapi'
op|'.'
name|'stub_vm_utils_with_vdi_attached_here'
newline|'\n'
DECL|member|test_generate_disk_ephemeral
name|'def'
name|'test_generate_disk_ephemeral'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_expect_parted_calls'
op|'('
op|')'
newline|'\n'
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'mkfs'"
op|','
string|"'-t'"
op|','
string|"'ext4'"
op|','
string|"'/dev/fakedev1'"
op|','
nl|'\n'
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'vdi_ref'
op|'='
name|'vm_utils'
op|'.'
name|'_generate_disk'
op|'('
name|'self'
op|'.'
name|'session'
op|','
op|'{'
string|'"uuid"'
op|':'
string|'"fake_uuid"'
op|'}'
op|','
nl|'\n'
name|'self'
op|'.'
name|'vm_ref'
op|','
string|'"2"'
op|','
string|'"name"'
op|','
string|'"ephemeral"'
op|','
number|'10'
op|','
string|'"ext4"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_vdi'
op|'('
name|'vdi_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'test_xenapi'
op|'.'
name|'stub_vm_utils_with_vdi_attached_here'
newline|'\n'
DECL|member|test_generate_disk_ensure_cleanup_called
name|'def'
name|'test_generate_disk_ensure_cleanup_called'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_expect_parted_calls'
op|'('
op|')'
newline|'\n'
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'mkfs'"
op|','
string|"'-t'"
op|','
string|"'ext4'"
op|','
string|"'/dev/fakedev1'"
op|','
nl|'\n'
name|'run_as_root'
op|'='
name|'True'
op|')'
op|'.'
name|'AndRaise'
op|'('
name|'test'
op|'.'
name|'TestingException'
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'destroy_vdi'
op|'('
name|'self'
op|'.'
name|'session'
op|','
name|'mox'
op|'.'
name|'IgnoreArg'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'test'
op|'.'
name|'TestingException'
op|','
name|'vm_utils'
op|'.'
name|'_generate_disk'
op|','
nl|'\n'
name|'self'
op|'.'
name|'session'
op|','
op|'{'
string|'"uuid"'
op|':'
string|'"fake_uuid"'
op|'}'
op|','
nl|'\n'
name|'self'
op|'.'
name|'vm_ref'
op|','
string|'"2"'
op|','
string|'"name"'
op|','
string|'"ephemeral"'
op|','
number|'10'
op|','
string|'"ext4"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'test_xenapi'
op|'.'
name|'stub_vm_utils_with_vdi_attached_here'
newline|'\n'
DECL|member|test_generate_disk_ephemeral_local
name|'def'
name|'test_generate_disk_ephemeral_local'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'session'
op|'.'
name|'is_local_connection'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'_expect_parted_calls'
op|'('
op|')'
newline|'\n'
name|'utils'
op|'.'
name|'execute'
op|'('
string|"'mkfs'"
op|','
string|"'-t'"
op|','
string|"'ext4'"
op|','
string|"'/dev/mapper/fakedev1'"
op|','
nl|'\n'
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'vdi_ref'
op|'='
name|'vm_utils'
op|'.'
name|'_generate_disk'
op|'('
name|'self'
op|'.'
name|'session'
op|','
op|'{'
string|'"uuid"'
op|':'
string|'"fake_uuid"'
op|'}'
op|','
nl|'\n'
name|'self'
op|'.'
name|'vm_ref'
op|','
string|'"2"'
op|','
string|'"name"'
op|','
string|'"ephemeral"'
op|','
number|'10'
op|','
string|'"ext4"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_vdi'
op|'('
name|'vdi_ref'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|GenerateEphemeralTestCase
dedent|''
dedent|''
name|'class'
name|'GenerateEphemeralTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'GenerateEphemeralTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'='
string|'"session"'
newline|'\n'
name|'self'
op|'.'
name|'instance'
op|'='
string|'"instance"'
newline|'\n'
name|'self'
op|'.'
name|'vm_ref'
op|'='
string|'"vm_ref"'
newline|'\n'
name|'self'
op|'.'
name|'name_label'
op|'='
string|'"name"'
newline|'\n'
name|'self'
op|'.'
name|'ephemeral_name_label'
op|'='
string|'"name ephemeral"'
newline|'\n'
name|'self'
op|'.'
name|'userdevice'
op|'='
number|'4'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|'"_generate_disk"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|'"safe_destroy_vdis"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_ephemeral_disk_sizes_simple
dedent|''
name|'def'
name|'test_get_ephemeral_disk_sizes_simple'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'get_ephemeral_disk_sizes'
op|'('
number|'20'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'['
number|'20'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'list'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_ephemeral_disk_sizes_three_disks_2000
dedent|''
name|'def'
name|'test_get_ephemeral_disk_sizes_three_disks_2000'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'get_ephemeral_disk_sizes'
op|'('
number|'4030'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'['
number|'2000'
op|','
number|'2000'
op|','
number|'30'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'list'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_ephemeral_disk_sizes_two_disks_1024
dedent|''
name|'def'
name|'test_get_ephemeral_disk_sizes_two_disks_1024'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'get_ephemeral_disk_sizes'
op|'('
number|'2048'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'['
number|'1024'
op|','
number|'1024'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'list'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_expect_generate_disk
dedent|''
name|'def'
name|'_expect_generate_disk'
op|'('
name|'self'
op|','
name|'size'
op|','
name|'device'
op|','
name|'name_label'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vm_utils'
op|'.'
name|'_generate_disk'
op|'('
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
name|'self'
op|'.'
name|'vm_ref'
op|','
nl|'\n'
name|'str'
op|'('
name|'device'
op|')'
op|','
name|'name_label'
op|','
string|"'ephemeral'"
op|','
nl|'\n'
name|'size'
op|'*'
number|'1024'
op|','
name|'None'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'device'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_generate_ephemeral_adds_one_disk
dedent|''
name|'def'
name|'test_generate_ephemeral_adds_one_disk'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_expect_generate_disk'
op|'('
number|'20'
op|','
name|'self'
op|'.'
name|'userdevice'
op|','
nl|'\n'
name|'self'
op|'.'
name|'ephemeral_name_label'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'generate_ephemeral'
op|'('
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
name|'self'
op|'.'
name|'vm_ref'
op|','
nl|'\n'
name|'str'
op|'('
name|'self'
op|'.'
name|'userdevice'
op|')'
op|','
name|'self'
op|'.'
name|'name_label'
op|','
number|'20'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_generate_ephemeral_adds_multiple_disks
dedent|''
name|'def'
name|'test_generate_ephemeral_adds_multiple_disks'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_expect_generate_disk'
op|'('
number|'2000'
op|','
name|'self'
op|'.'
name|'userdevice'
op|','
nl|'\n'
name|'self'
op|'.'
name|'ephemeral_name_label'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_expect_generate_disk'
op|'('
number|'2000'
op|','
name|'self'
op|'.'
name|'userdevice'
op|'+'
number|'1'
op|','
nl|'\n'
name|'self'
op|'.'
name|'ephemeral_name_label'
op|'+'
string|'" (1)"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_expect_generate_disk'
op|'('
number|'30'
op|','
name|'self'
op|'.'
name|'userdevice'
op|'+'
number|'2'
op|','
nl|'\n'
name|'self'
op|'.'
name|'ephemeral_name_label'
op|'+'
string|'" (2)"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'generate_ephemeral'
op|'('
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
name|'self'
op|'.'
name|'vm_ref'
op|','
nl|'\n'
name|'str'
op|'('
name|'self'
op|'.'
name|'userdevice'
op|')'
op|','
name|'self'
op|'.'
name|'name_label'
op|','
number|'4030'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_generate_ephemeral_cleans_up_on_error
dedent|''
name|'def'
name|'test_generate_ephemeral_cleans_up_on_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_expect_generate_disk'
op|'('
number|'1024'
op|','
name|'self'
op|'.'
name|'userdevice'
op|','
nl|'\n'
name|'self'
op|'.'
name|'ephemeral_name_label'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_expect_generate_disk'
op|'('
number|'1024'
op|','
name|'self'
op|'.'
name|'userdevice'
op|'+'
number|'1'
op|','
nl|'\n'
name|'self'
op|'.'
name|'ephemeral_name_label'
op|'+'
string|'" (1)"'
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_generate_disk'
op|'('
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
name|'self'
op|'.'
name|'vm_ref'
op|','
nl|'\n'
name|'str'
op|'('
name|'self'
op|'.'
name|'userdevice'
op|'+'
number|'2'
op|')'
op|','
string|'"name ephemeral (2)"'
op|','
string|"'ephemeral'"
op|','
nl|'\n'
name|'unit'
op|'.'
name|'Mi'
op|','
name|'None'
op|')'
op|'.'
name|'AndRaise'
op|'('
name|'exception'
op|'.'
name|'NovaException'
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'safe_destroy_vdis'
op|'('
name|'self'
op|'.'
name|'session'
op|','
op|'['
number|'4'
op|','
number|'5'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NovaException'
op|','
name|'vm_utils'
op|'.'
name|'generate_ephemeral'
op|','
nl|'\n'
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
name|'self'
op|'.'
name|'vm_ref'
op|','
nl|'\n'
name|'str'
op|'('
name|'self'
op|'.'
name|'userdevice'
op|')'
op|','
name|'self'
op|'.'
name|'name_label'
op|','
number|'4096'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeFile
dedent|''
dedent|''
name|'class'
name|'FakeFile'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_file_operations'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|member|seek
dedent|''
name|'def'
name|'seek'
op|'('
name|'self'
op|','
name|'offset'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_file_operations'
op|'.'
name|'append'
op|'('
op|'('
name|'self'
op|'.'
name|'seek'
op|','
name|'offset'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|StreamDiskTestCase
dedent|''
dedent|''
name|'class'
name|'StreamDiskTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'import'
name|'__builtin__'
newline|'\n'
name|'super'
op|'('
name|'StreamDiskTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|'.'
name|'utils'
op|','
string|"'make_dev_path'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|'.'
name|'utils'
op|','
string|"'temporary_chown'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|"'_write_partition'"
op|')'
newline|'\n'
nl|'\n'
comment|'# NOTE(matelakat): This might hide the fail reason, as test runners'
nl|'\n'
comment|'# are unhappy with a mocked out open.'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'__builtin__'
op|','
string|"'open'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'image_service_func'
op|'='
name|'self'
op|'.'
name|'mox'
op|'.'
name|'CreateMockAnything'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_non_ami
dedent|''
name|'def'
name|'test_non_ami'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_file'
op|'='
name|'FakeFile'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'utils'
op|'.'
name|'make_dev_path'
op|'('
string|"'dev'"
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'some_path'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'utils'
op|'.'
name|'temporary_chown'
op|'('
nl|'\n'
string|"'some_path'"
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'contextified'
op|'('
name|'None'
op|')'
op|')'
newline|'\n'
name|'open'
op|'('
string|"'some_path'"
op|','
string|"'wb'"
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'contextified'
op|'('
name|'fake_file'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'image_service_func'
op|'('
name|'fake_file'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_stream_disk'
op|'('
string|'"session"'
op|','
name|'self'
op|'.'
name|'image_service_func'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'ImageType'
op|'.'
name|'KERNEL'
op|','
name|'None'
op|','
string|"'dev'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|'('
name|'fake_file'
op|'.'
name|'seek'
op|','
number|'0'
op|')'
op|']'
op|','
name|'fake_file'
op|'.'
name|'_file_operations'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_ami_disk
dedent|''
name|'def'
name|'test_ami_disk'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_file'
op|'='
name|'FakeFile'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_write_partition'
op|'('
string|'"session"'
op|','
number|'100'
op|','
string|"'dev'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'utils'
op|'.'
name|'make_dev_path'
op|'('
string|"'dev'"
op|')'
op|'.'
name|'AndReturn'
op|'('
string|"'some_path'"
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'utils'
op|'.'
name|'temporary_chown'
op|'('
nl|'\n'
string|"'some_path'"
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'contextified'
op|'('
name|'None'
op|')'
op|')'
newline|'\n'
name|'open'
op|'('
string|"'some_path'"
op|','
string|"'wb'"
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'contextified'
op|'('
name|'fake_file'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'image_service_func'
op|'('
name|'fake_file'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_stream_disk'
op|'('
string|'"session"'
op|','
name|'self'
op|'.'
name|'image_service_func'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'ImageType'
op|'.'
name|'DISK'
op|','
number|'100'
op|','
string|"'dev'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
op|'['
op|'('
name|'fake_file'
op|'.'
name|'seek'
op|','
name|'vm_utils'
op|'.'
name|'MBR_SIZE_BYTES'
op|')'
op|']'
op|','
nl|'\n'
name|'fake_file'
op|'.'
name|'_file_operations'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VMUtilsSRPath
dedent|''
dedent|''
name|'class'
name|'VMUtilsSRPath'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'VMUtilsSRPath'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'disable_process_locking'
op|'='
name|'True'
op|','
nl|'\n'
name|'instance_name_template'
op|'='
string|"'%d'"
op|','
nl|'\n'
name|'firewall_driver'
op|'='
string|"'nova.virt.xenapi.firewall.'"
nl|'\n'
string|"'Dom0IptablesFirewallDriver'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'connection_url'
op|'='
string|"'test_url'"
op|','
nl|'\n'
name|'connection_password'
op|'='
string|"'test_pass'"
op|','
nl|'\n'
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
name|'stubs'
op|'.'
name|'stubout_session'
op|'('
name|'self'
op|'.'
name|'stubs'
op|','
name|'fake'
op|'.'
name|'SessionBase'
op|')'
newline|'\n'
name|'driver'
op|'='
name|'xenapi_conn'
op|'.'
name|'XenAPIDriver'
op|'('
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'='
name|'driver'
op|'.'
name|'_session'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'is_local_connection'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|member|test_defined
dedent|''
name|'def'
name|'test_defined'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|'"safe_find_sr"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"call_xenapi"'
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'safe_find_sr'
op|'('
name|'self'
op|'.'
name|'session'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"sr_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'host_ref'
op|'='
string|'"host_ref"'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|"'PBD.get_all_records_where'"
op|','
nl|'\n'
string|'\'field "host"="host_ref" and field "SR"="sr_ref"\''
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
op|'{'
string|"'pbd_ref'"
op|':'
op|'{'
string|"'device_config'"
op|':'
op|'{'
string|"'path'"
op|':'
string|"'sr_path'"
op|'}'
op|'}'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'vm_utils'
op|'.'
name|'get_sr_path'
op|'('
name|'self'
op|'.'
name|'session'
op|')'
op|','
string|'"sr_path"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_default
dedent|''
name|'def'
name|'test_default'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|'"safe_find_sr"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"call_xenapi"'
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'safe_find_sr'
op|'('
name|'self'
op|'.'
name|'session'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"sr_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'host_ref'
op|'='
string|'"host_ref"'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|"'PBD.get_all_records_where'"
op|','
nl|'\n'
string|'\'field "host"="host_ref" and field "SR"="sr_ref"\''
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
op|'{'
string|"'pbd_ref'"
op|':'
op|'{'
string|"'device_config'"
op|':'
op|'{'
op|'}'
op|'}'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_xenapi'
op|'('
string|'"SR.get_record"'
op|','
string|'"sr_ref"'
op|')'
op|'.'
name|'AndReturn'
op|'('
nl|'\n'
op|'{'
string|"'uuid'"
op|':'
string|"'sr_uuid'"
op|','
string|"'type'"
op|':'
string|"'ext'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'vm_utils'
op|'.'
name|'get_sr_path'
op|'('
name|'self'
op|'.'
name|'session'
op|')'
op|','
nl|'\n'
string|'"/var/run/sr-mount/sr_uuid"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|CreateKernelRamdiskTestCase
dedent|''
dedent|''
name|'class'
name|'CreateKernelRamdiskTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'CreateKernelRamdiskTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'context'
op|'='
string|'"context"'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'='
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'instance'
op|'='
op|'{'
string|'"kernel_id"'
op|':'
name|'None'
op|','
string|'"ramdisk_id"'
op|':'
name|'None'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'name_label'
op|'='
string|'"name"'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|'"call_plugin"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'uuid'
op|','
string|'"uuid4"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'vm_utils'
op|','
string|'"_fetch_disk_image"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_kernel_and_ramdisk_no_create
dedent|''
name|'def'
name|'test_create_kernel_and_ramdisk_no_create'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'create_kernel_and_ramdisk'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
name|'self'
op|'.'
name|'name_label'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'('
name|'None'
op|','
name|'None'
op|')'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_kernel_and_ramdisk_create_both_cached
dedent|''
name|'def'
name|'test_create_kernel_and_ramdisk_create_both_cached'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'kernel_id'
op|'='
string|'"kernel"'
newline|'\n'
name|'ramdisk_id'
op|'='
string|'"ramdisk"'
newline|'\n'
name|'self'
op|'.'
name|'instance'
op|'['
string|'"kernel_id"'
op|']'
op|'='
name|'kernel_id'
newline|'\n'
name|'self'
op|'.'
name|'instance'
op|'['
string|'"ramdisk_id"'
op|']'
op|'='
name|'ramdisk_id'
newline|'\n'
nl|'\n'
name|'args_kernel'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'args_kernel'
op|'['
string|"'cached-image'"
op|']'
op|'='
name|'kernel_id'
newline|'\n'
name|'args_kernel'
op|'['
string|"'new-image-uuid'"
op|']'
op|'='
string|'"fake_uuid1"'
newline|'\n'
name|'uuid'
op|'.'
name|'uuid4'
op|'('
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"fake_uuid1"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_plugin'
op|'('
string|"'kernel'"
op|','
string|"'create_kernel_ramdisk'"
op|','
nl|'\n'
name|'args_kernel'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"k"'
op|')'
newline|'\n'
nl|'\n'
name|'args_ramdisk'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'args_ramdisk'
op|'['
string|"'cached-image'"
op|']'
op|'='
name|'ramdisk_id'
newline|'\n'
name|'args_ramdisk'
op|'['
string|"'new-image-uuid'"
op|']'
op|'='
string|'"fake_uuid2"'
newline|'\n'
name|'uuid'
op|'.'
name|'uuid4'
op|'('
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"fake_uuid2"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_plugin'
op|'('
string|"'kernel'"
op|','
string|"'create_kernel_ramdisk'"
op|','
nl|'\n'
name|'args_ramdisk'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"r"'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'create_kernel_and_ramdisk'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
name|'self'
op|'.'
name|'name_label'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'('
string|'"k"'
op|','
string|'"r"'
op|')'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_kernel_and_ramdisk_create_kernel_not_cached
dedent|''
name|'def'
name|'test_create_kernel_and_ramdisk_create_kernel_not_cached'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'kernel_id'
op|'='
string|'"kernel"'
newline|'\n'
name|'self'
op|'.'
name|'instance'
op|'['
string|'"kernel_id"'
op|']'
op|'='
name|'kernel_id'
newline|'\n'
nl|'\n'
name|'args_kernel'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'args_kernel'
op|'['
string|"'cached-image'"
op|']'
op|'='
name|'kernel_id'
newline|'\n'
name|'args_kernel'
op|'['
string|"'new-image-uuid'"
op|']'
op|'='
string|'"fake_uuid1"'
newline|'\n'
name|'uuid'
op|'.'
name|'uuid4'
op|'('
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'"fake_uuid1"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'call_plugin'
op|'('
string|"'kernel'"
op|','
string|"'create_kernel_ramdisk'"
op|','
nl|'\n'
name|'args_kernel'
op|')'
op|'.'
name|'AndReturn'
op|'('
string|'""'
op|')'
newline|'\n'
nl|'\n'
name|'kernel'
op|'='
op|'{'
string|'"kernel"'
op|':'
op|'{'
string|'"file"'
op|':'
string|'"k"'
op|'}'
op|'}'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_fetch_disk_image'
op|'('
name|'self'
op|'.'
name|'context'
op|','
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
nl|'\n'
name|'self'
op|'.'
name|'name_label'
op|','
name|'kernel_id'
op|','
number|'0'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'kernel'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'create_kernel_and_ramdisk'
op|'('
name|'self'
op|'.'
name|'context'
op|','
nl|'\n'
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
name|'self'
op|'.'
name|'name_label'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'('
string|'"k"'
op|','
name|'None'
op|')'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ScanSrTestCase
dedent|''
dedent|''
name|'class'
name|'ScanSrTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|'"_scan_sr"'
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|'"safe_find_sr"'
op|')'
newline|'\n'
DECL|member|test_scan_default_sr
name|'def'
name|'test_scan_default_sr'
op|'('
name|'self'
op|','
name|'mock_safe_find_sr'
op|','
name|'mock_scan_sr'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_safe_find_sr'
op|'.'
name|'return_value'
op|'='
string|'"sr_ref"'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"sr_ref"'
op|','
name|'vm_utils'
op|'.'
name|'scan_default_sr'
op|'('
string|'"fake_session"'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mock_scan_sr'
op|'.'
name|'assert_called_once_with'
op|'('
string|'"fake_session"'
op|','
string|'"sr_ref"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_scan_sr_works
dedent|''
name|'def'
name|'test_scan_sr_works'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_scan_sr'
op|'('
name|'session'
op|','
string|'"sr_ref"'
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'SR.scan'"
op|','
string|'"sr_ref"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_scan_sr_unknown_error_fails_once
dedent|''
name|'def'
name|'test_scan_sr_unknown_error_fails_once'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'side_effect'
op|'='
name|'test'
op|'.'
name|'TestingException'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'test'
op|'.'
name|'TestingException'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'_scan_sr'
op|','
name|'session'
op|','
string|'"sr_ref"'
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'SR.scan'"
op|','
string|'"sr_ref"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'greenthread'
op|','
string|"'sleep'"
op|')'
newline|'\n'
DECL|member|test_scan_sr_known_error_retries_then_throws
name|'def'
name|'test_scan_sr_known_error_retries_then_throws'
op|'('
name|'self'
op|','
name|'mock_sleep'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|class|FakeException
name|'class'
name|'FakeException'
op|'('
name|'Exception'
op|')'
op|':'
newline|'\n'
DECL|variable|details
indent|'            '
name|'details'
op|'='
op|'['
string|"'SR_BACKEND_FAILURE_40'"
op|','
string|'""'
op|','
string|'""'
op|','
string|'""'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'session'
op|'.'
name|'XenAPI'
op|'.'
name|'Failure'
op|'='
name|'FakeException'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'side_effect'
op|'='
name|'FakeException'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'FakeException'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'_scan_sr'
op|','
name|'session'
op|','
string|'"sr_ref"'
op|')'
newline|'\n'
nl|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'assert_called_with'
op|'('
string|"'SR.scan'"
op|','
string|'"sr_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'4'
op|','
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'call_count'
op|')'
newline|'\n'
name|'mock_sleep'
op|'.'
name|'assert_has_calls'
op|'('
op|'['
name|'mock'
op|'.'
name|'call'
op|'('
number|'2'
op|')'
op|','
name|'mock'
op|'.'
name|'call'
op|'('
number|'4'
op|')'
op|','
name|'mock'
op|'.'
name|'call'
op|'('
number|'8'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'greenthread'
op|','
string|"'sleep'"
op|')'
newline|'\n'
DECL|member|test_scan_sr_known_error_retries_then_succeeds
name|'def'
name|'test_scan_sr_known_error_retries_then_succeeds'
op|'('
name|'self'
op|','
name|'mock_sleep'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|class|FakeException
name|'class'
name|'FakeException'
op|'('
name|'Exception'
op|')'
op|':'
newline|'\n'
DECL|variable|details
indent|'            '
name|'details'
op|'='
op|'['
string|"'SR_BACKEND_FAILURE_40'"
op|','
string|'""'
op|','
string|'""'
op|','
string|'""'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'session'
op|'.'
name|'XenAPI'
op|'.'
name|'Failure'
op|'='
name|'FakeException'
newline|'\n'
name|'sr_scan_call_count'
op|'='
number|'0'
newline|'\n'
nl|'\n'
DECL|function|fake_call_xenapi
name|'def'
name|'fake_call_xenapi'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'fake_call_xenapi'
op|'.'
name|'count'
op|'+='
number|'1'
newline|'\n'
name|'if'
name|'fake_call_xenapi'
op|'.'
name|'count'
op|'!='
number|'2'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'FakeException'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'fake_call_xenapi'
op|'.'
name|'count'
op|'='
number|'0'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'side_effect'
op|'='
name|'fake_call_xenapi'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_scan_sr'
op|'('
name|'session'
op|','
string|'"sr_ref"'
op|')'
newline|'\n'
nl|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'assert_called_with'
op|'('
string|"'SR.scan'"
op|','
string|'"sr_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'2'
op|','
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'call_count'
op|')'
newline|'\n'
name|'mock_sleep'
op|'.'
name|'assert_called_once_with'
op|'('
number|'2'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|AllowVSSProviderTest
dedent|''
dedent|''
name|'class'
name|'AllowVSSProviderTest'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'AllowVSSProviderTest'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'disable_process_locking'
op|'='
name|'True'
op|','
nl|'\n'
name|'instance_name_template'
op|'='
string|"'%d'"
op|','
nl|'\n'
name|'firewall_driver'
op|'='
string|"'nova.virt.xenapi.firewall.'"
nl|'\n'
string|"'Dom0IptablesFirewallDriver'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'connection_url'
op|'='
string|"'test_url'"
op|','
nl|'\n'
name|'connection_password'
op|'='
string|"'test_pass'"
op|','
nl|'\n'
name|'group'
op|'='
string|"'xenserver'"
op|')'
newline|'\n'
name|'stubs'
op|'.'
name|'stubout_session'
op|'('
name|'self'
op|'.'
name|'stubs'
op|','
name|'fake'
op|'.'
name|'SessionBase'
op|')'
newline|'\n'
name|'driver'
op|'='
name|'xenapi_conn'
op|'.'
name|'XenAPIDriver'
op|'('
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'='
name|'driver'
op|'.'
name|'_session'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'.'
name|'is_local_connection'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'instance'
op|'='
op|'{'
nl|'\n'
string|"'uuid'"
op|':'
string|"'fakeinstance'"
op|','
nl|'\n'
string|"'kernel_id'"
op|':'
string|"'kernel'"
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|test_allow_vss_provider
dedent|''
name|'def'
name|'test_allow_vss_provider'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|fake_extract_flavor
indent|'        '
name|'def'
name|'fake_extract_flavor'
op|'('
name|'inst'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'{'
nl|'\n'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'vcpus'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'vcpu_weight'"
op|':'
number|'1.0'
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|fake_call_xenapi
dedent|''
name|'def'
name|'fake_call_xenapi'
op|'('
name|'command'
op|','
name|'rec'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'xenstore_data'
op|'='
name|'rec'
op|'.'
name|'get'
op|'('
string|"'xenstore_data'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'vm-data/allowvssprovider'"
op|','
name|'xenstore_data'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'flavors'
op|','
string|"'extract_flavor'"
op|','
name|'fake_extract_flavor'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'session'
op|','
string|"'call_xenapi'"
op|','
name|'fake_call_xenapi'
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'create_vm'
op|'('
name|'self'
op|'.'
name|'session'
op|','
name|'self'
op|'.'
name|'instance'
op|','
string|'"label"'
op|','
nl|'\n'
string|'"kernel"'
op|','
string|'"ramdisk"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|DetermineVmModeTestCase
dedent|''
dedent|''
name|'class'
name|'DetermineVmModeTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|test_determine_vm_mode_returns_xen_mode
indent|'    '
name|'def'
name|'test_determine_vm_mode_returns_xen_mode'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
op|'{'
string|'"vm_mode"'
op|':'
string|'"xen"'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'vm_mode'
op|'.'
name|'XEN'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'determine_vm_mode'
op|'('
name|'instance'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_determine_vm_mode_returns_hvm_mode
dedent|''
name|'def'
name|'test_determine_vm_mode_returns_hvm_mode'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
op|'{'
string|'"vm_mode"'
op|':'
string|'"hvm"'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'vm_mode'
op|'.'
name|'HVM'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'determine_vm_mode'
op|'('
name|'instance'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_determine_vm_mode_returns_xen_for_linux
dedent|''
name|'def'
name|'test_determine_vm_mode_returns_xen_for_linux'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
op|'{'
string|'"vm_mode"'
op|':'
name|'None'
op|','
string|'"os_type"'
op|':'
string|'"linux"'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'vm_mode'
op|'.'
name|'XEN'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'determine_vm_mode'
op|'('
name|'instance'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_determine_vm_mode_returns_hvm_for_windows
dedent|''
name|'def'
name|'test_determine_vm_mode_returns_hvm_for_windows'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
op|'{'
string|'"vm_mode"'
op|':'
name|'None'
op|','
string|'"os_type"'
op|':'
string|'"windows"'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'vm_mode'
op|'.'
name|'HVM'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'determine_vm_mode'
op|'('
name|'instance'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_determine_vm_mode_returns_hvm_by_default
dedent|''
name|'def'
name|'test_determine_vm_mode_returns_hvm_by_default'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
op|'{'
string|'"vm_mode"'
op|':'
name|'None'
op|','
string|'"os_type"'
op|':'
name|'None'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'vm_mode'
op|'.'
name|'HVM'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'determine_vm_mode'
op|'('
name|'instance'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_determine_vm_mode_returns_xen_for_VHD
dedent|''
name|'def'
name|'test_determine_vm_mode_returns_xen_for_VHD'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
op|'{'
string|'"vm_mode"'
op|':'
name|'None'
op|','
string|'"os_type"'
op|':'
name|'None'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'vm_mode'
op|'.'
name|'XEN'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'determine_vm_mode'
op|'('
name|'instance'
op|','
name|'vm_utils'
op|'.'
name|'ImageType'
op|'.'
name|'DISK_VHD'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_determine_vm_mode_returns_xen_for_DISK
dedent|''
name|'def'
name|'test_determine_vm_mode_returns_xen_for_DISK'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
op|'{'
string|'"vm_mode"'
op|':'
name|'None'
op|','
string|'"os_type"'
op|':'
name|'None'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'vm_mode'
op|'.'
name|'XEN'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'determine_vm_mode'
op|'('
name|'instance'
op|','
name|'vm_utils'
op|'.'
name|'ImageType'
op|'.'
name|'DISK'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|CallXenAPIHelpersTestCase
dedent|''
dedent|''
name|'class'
name|'CallXenAPIHelpersTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|test_vm_get_vbd_refs
indent|'    '
name|'def'
name|'test_vm_get_vbd_refs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'return_value'
op|'='
string|'"foo"'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"foo"'
op|','
name|'vm_utils'
op|'.'
name|'_vm_get_vbd_refs'
op|'('
name|'session'
op|','
string|'"vm_ref"'
op|')'
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'assert_called_once_with'
op|'('
string|'"VM.get_VBDs"'
op|','
string|'"vm_ref"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vbd_get_rec
dedent|''
name|'def'
name|'test_vbd_get_rec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'return_value'
op|'='
string|'"foo"'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"foo"'
op|','
name|'vm_utils'
op|'.'
name|'_vbd_get_rec'
op|'('
name|'session'
op|','
string|'"vbd_ref"'
op|')'
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'assert_called_once_with'
op|'('
string|'"VBD.get_record"'
op|','
nl|'\n'
string|'"vbd_ref"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vdi_get_rec
dedent|''
name|'def'
name|'test_vdi_get_rec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'return_value'
op|'='
string|'"foo"'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"foo"'
op|','
name|'vm_utils'
op|'.'
name|'_vdi_get_rec'
op|'('
name|'session'
op|','
string|'"vdi_ref"'
op|')'
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'assert_called_once_with'
op|'('
string|'"VDI.get_record"'
op|','
nl|'\n'
string|'"vdi_ref"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vdi_snapshot
dedent|''
name|'def'
name|'test_vdi_snapshot'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'return_value'
op|'='
string|'"foo"'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"foo"'
op|','
name|'vm_utils'
op|'.'
name|'_vdi_snapshot'
op|'('
name|'session'
op|','
string|'"vdi_ref"'
op|')'
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'assert_called_once_with'
op|'('
string|'"VDI.snapshot"'
op|','
nl|'\n'
string|'"vdi_ref"'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_vdi_get_rec'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_vbd_get_rec'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_vm_get_vbd_refs'"
op|')'
newline|'\n'
DECL|class|GetVdiForVMTestCase
name|'class'
name|'GetVdiForVMTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|test_get_vdi_for_vm_safely
indent|'    '
name|'def'
name|'test_get_vdi_for_vm_safely'
op|'('
name|'self'
op|','
name|'vm_get_vbd_refs'
op|','
nl|'\n'
name|'vbd_get_rec'
op|','
name|'vdi_get_rec'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
string|'"session"'
newline|'\n'
nl|'\n'
name|'vm_get_vbd_refs'
op|'.'
name|'return_value'
op|'='
op|'['
string|'"a"'
op|','
string|'"b"'
op|']'
newline|'\n'
name|'vbd_get_rec'
op|'.'
name|'return_value'
op|'='
op|'{'
string|"'userdevice'"
op|':'
string|"'0'"
op|','
string|"'VDI'"
op|':'
string|"'vdi_ref'"
op|'}'
newline|'\n'
name|'vdi_get_rec'
op|'.'
name|'return_value'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'get_vdi_for_vm_safely'
op|'('
name|'session'
op|','
string|'"vm_ref"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'('
string|"'vdi_ref'"
op|','
op|'{'
op|'}'
op|')'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
name|'vm_get_vbd_refs'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
string|'"vm_ref"'
op|')'
newline|'\n'
name|'vbd_get_rec'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
string|'"a"'
op|')'
newline|'\n'
name|'vdi_get_rec'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
string|'"vdi_ref"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vdi_for_vm_safely_fails
dedent|''
name|'def'
name|'test_get_vdi_for_vm_safely_fails'
op|'('
name|'self'
op|','
name|'vm_get_vbd_refs'
op|','
nl|'\n'
name|'vbd_get_rec'
op|','
name|'vdi_get_rec'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
string|'"session"'
newline|'\n'
nl|'\n'
name|'vm_get_vbd_refs'
op|'.'
name|'return_value'
op|'='
op|'['
string|'"a"'
op|','
string|'"b"'
op|']'
newline|'\n'
name|'vbd_get_rec'
op|'.'
name|'return_value'
op|'='
op|'{'
string|"'userdevice'"
op|':'
string|"'0'"
op|','
string|"'VDI'"
op|':'
string|"'vdi_ref'"
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NovaException'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'get_vdi_for_vm_safely'
op|','
nl|'\n'
name|'session'
op|','
string|'"vm_ref"'
op|','
name|'userdevice'
op|'='
string|"'1'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|']'
op|','
name|'vdi_get_rec'
op|'.'
name|'call_args_list'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'2'
op|','
name|'len'
op|'('
name|'vbd_get_rec'
op|'.'
name|'call_args_list'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_vdi_get_uuid'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_vbd_get_rec'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_vm_get_vbd_refs'"
op|')'
newline|'\n'
DECL|class|GetAllVdiForVMTestCase
name|'class'
name|'GetAllVdiForVMTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|_setup_get_all_vdi_uuids_for_vm
indent|'    '
name|'def'
name|'_setup_get_all_vdi_uuids_for_vm'
op|'('
name|'self'
op|','
name|'vm_get_vbd_refs'
op|','
nl|'\n'
name|'vbd_get_rec'
op|','
name|'vdi_get_uuid'
op|')'
op|':'
newline|'\n'
DECL|function|fake_vbd_get_rec
indent|'        '
name|'def'
name|'fake_vbd_get_rec'
op|'('
name|'session'
op|','
name|'vbd_ref'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'{'
string|"'userdevice'"
op|':'
name|'vbd_ref'
op|','
string|"'VDI'"
op|':'
string|'"vdi_ref_%s"'
op|'%'
name|'vbd_ref'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|fake_vdi_get_uuid
dedent|''
name|'def'
name|'fake_vdi_get_uuid'
op|'('
name|'session'
op|','
name|'vdi_ref'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'vdi_ref'
newline|'\n'
nl|'\n'
dedent|''
name|'vm_get_vbd_refs'
op|'.'
name|'return_value'
op|'='
op|'['
string|'"0"'
op|','
string|'"2"'
op|']'
newline|'\n'
name|'vbd_get_rec'
op|'.'
name|'side_effect'
op|'='
name|'fake_vbd_get_rec'
newline|'\n'
name|'vdi_get_uuid'
op|'.'
name|'side_effect'
op|'='
name|'fake_vdi_get_uuid'
newline|'\n'
nl|'\n'
DECL|member|test_get_all_vdi_uuids_for_vm_works
dedent|''
name|'def'
name|'test_get_all_vdi_uuids_for_vm_works'
op|'('
name|'self'
op|','
name|'vm_get_vbd_refs'
op|','
nl|'\n'
name|'vbd_get_rec'
op|','
name|'vdi_get_uuid'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_setup_get_all_vdi_uuids_for_vm'
op|'('
name|'vm_get_vbd_refs'
op|','
nl|'\n'
name|'vbd_get_rec'
op|','
name|'vdi_get_uuid'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'get_all_vdi_uuids_for_vm'
op|'('
string|"'session'"
op|','
string|'"vm_ref"'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'['
string|"'vdi_ref_0'"
op|','
string|"'vdi_ref_2'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'list'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_all_vdi_uuids_for_vm_finds_none
dedent|''
name|'def'
name|'test_get_all_vdi_uuids_for_vm_finds_none'
op|'('
name|'self'
op|','
name|'vm_get_vbd_refs'
op|','
nl|'\n'
name|'vbd_get_rec'
op|','
name|'vdi_get_uuid'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_setup_get_all_vdi_uuids_for_vm'
op|'('
name|'vm_get_vbd_refs'
op|','
nl|'\n'
name|'vbd_get_rec'
op|','
name|'vdi_get_uuid'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'get_all_vdi_uuids_for_vm'
op|'('
string|"'session'"
op|','
string|'"vm_ref"'
op|','
nl|'\n'
name|'min_userdevice'
op|'='
number|'1'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'['
string|'"vdi_ref_2"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'list'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|GetAllVdisTestCase
dedent|''
dedent|''
name|'class'
name|'GetAllVdisTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|test_get_all_vdis_in_sr
indent|'    '
name|'def'
name|'test_get_all_vdis_in_sr'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_get_rec
indent|'        '
name|'def'
name|'fake_get_rec'
op|'('
name|'record_type'
op|','
name|'ref'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'ref'
op|'=='
string|'"2"'
op|':'
newline|'\n'
indent|'                '
name|'return'
string|'"vdi_rec_2"'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'return_value'
op|'='
op|'['
string|'"1"'
op|','
string|'"2"'
op|']'
newline|'\n'
name|'session'
op|'.'
name|'get_rec'
op|'.'
name|'side_effect'
op|'='
name|'fake_get_rec'
newline|'\n'
nl|'\n'
name|'sr_ref'
op|'='
string|'"sr_ref"'
newline|'\n'
name|'actual'
op|'='
name|'list'
op|'('
name|'vm_utils'
op|'.'
name|'_get_all_vdis_in_sr'
op|'('
name|'session'
op|','
name|'sr_ref'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'actual'
op|','
op|'['
op|'('
string|"'2'"
op|','
string|"'vdi_rec_2'"
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'assert_called_once_with'
op|'('
string|'"SR.get_VDIs"'
op|','
name|'sr_ref'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SnapshotAttachedHereTestCase
dedent|''
dedent|''
name|'class'
name|'SnapshotAttachedHereTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_snapshot_attached_here_impl'"
op|')'
newline|'\n'
DECL|member|test_snapshot_attached_here
name|'def'
name|'test_snapshot_attached_here'
op|'('
name|'self'
op|','
name|'mock_impl'
op|')'
op|':'
newline|'\n'
DECL|function|fake_impl
indent|'        '
name|'def'
name|'fake_impl'
op|'('
name|'session'
op|','
name|'instance'
op|','
name|'vm_ref'
op|','
name|'label'
op|','
name|'userdevice'
op|','
nl|'\n'
name|'post_snapshot_callback'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"session"'
op|','
name|'session'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"instance"'
op|','
name|'instance'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"vm_ref"'
op|','
name|'vm_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"label"'
op|','
name|'label'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'0'"
op|','
name|'userdevice'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'post_snapshot_callback'
op|')'
newline|'\n'
name|'yield'
string|'"fake"'
newline|'\n'
nl|'\n'
dedent|''
name|'mock_impl'
op|'.'
name|'side_effect'
op|'='
name|'fake_impl'
newline|'\n'
nl|'\n'
name|'with'
name|'vm_utils'
op|'.'
name|'snapshot_attached_here'
op|'('
string|'"session"'
op|','
string|'"instance"'
op|','
string|'"vm_ref"'
op|','
nl|'\n'
string|'"label"'
op|')'
name|'as'
name|'result'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"fake"'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'mock_impl'
op|'.'
name|'assert_called_once_with'
op|'('
string|'"session"'
op|','
string|'"instance"'
op|','
string|'"vm_ref"'
op|','
nl|'\n'
string|'"label"'
op|','
string|"'0'"
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'safe_destroy_vdis'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_walk_vdi_chain'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_wait_for_vhd_coalesce'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_vdi_get_uuid'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_vdi_snapshot'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_get_vhd_parent_uuid'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'get_vdi_for_vm_safely'"
op|')'
newline|'\n'
DECL|member|test_snapshot_attached_here_impl
name|'def'
name|'test_snapshot_attached_here_impl'
op|'('
name|'self'
op|','
name|'mock_get_vdi_for_vm_safely'
op|','
nl|'\n'
name|'mock_get_vhd_parent_uuid'
op|','
name|'mock_vdi_snapshot'
op|','
name|'mock_vdi_get_uuid'
op|','
nl|'\n'
name|'mock_wait_for_vhd_coalesce'
op|','
name|'mock_walk_vdi_chain'
op|','
nl|'\n'
name|'mock_safe_destroy_vdis'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
string|'"session"'
newline|'\n'
name|'instance'
op|'='
op|'{'
string|'"uuid"'
op|':'
string|'"uuid"'
op|'}'
newline|'\n'
name|'mock_callback'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'mock_get_vdi_for_vm_safely'
op|'.'
name|'return_value'
op|'='
op|'('
string|'"vdi_ref"'
op|','
nl|'\n'
op|'{'
string|'"SR"'
op|':'
string|'"sr_ref"'
op|'}'
op|')'
newline|'\n'
name|'mock_get_vhd_parent_uuid'
op|'.'
name|'return_value'
op|'='
string|'"original_uuid"'
newline|'\n'
name|'mock_vdi_snapshot'
op|'.'
name|'return_value'
op|'='
string|'"snap_ref"'
newline|'\n'
name|'mock_vdi_get_uuid'
op|'.'
name|'return_value'
op|'='
string|'"snap_uuid"'
newline|'\n'
name|'mock_walk_vdi_chain'
op|'.'
name|'return_value'
op|'='
op|'['
op|'{'
string|'"uuid"'
op|':'
string|'"a"'
op|'}'
op|','
op|'{'
string|'"uuid"'
op|':'
string|'"b"'
op|'}'
op|']'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'with'
name|'vm_utils'
op|'.'
name|'snapshot_attached_here'
op|'('
name|'session'
op|','
name|'instance'
op|','
string|'"vm_ref"'
op|','
nl|'\n'
string|'"label"'
op|','
string|"'2'"
op|','
name|'mock_callback'
op|')'
name|'as'
name|'result'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
string|'"a"'
op|','
string|'"b"'
op|']'
op|','
name|'result'
op|')'
newline|'\n'
name|'raise'
name|'test'
op|'.'
name|'TestingException'
op|'('
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'False'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'test'
op|'.'
name|'TestingException'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
dedent|''
name|'mock_get_vdi_for_vm_safely'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
string|'"vm_ref"'
op|','
nl|'\n'
string|"'2'"
op|')'
newline|'\n'
name|'mock_get_vhd_parent_uuid'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
string|'"vdi_ref"'
op|')'
newline|'\n'
name|'mock_vdi_snapshot'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
string|'"vdi_ref"'
op|')'
newline|'\n'
name|'mock_wait_for_vhd_coalesce'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
name|'instance'
op|','
nl|'\n'
string|'"sr_ref"'
op|','
string|'"vdi_ref"'
op|','
string|'"original_uuid"'
op|')'
newline|'\n'
name|'mock_vdi_get_uuid'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
string|'"snap_ref"'
op|')'
newline|'\n'
name|'mock_walk_vdi_chain'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
string|'"snap_uuid"'
op|')'
newline|'\n'
name|'mock_callback'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'task_state'
op|'='
string|'"image_pending_upload"'
op|')'
newline|'\n'
name|'mock_safe_destroy_vdis'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
op|'['
string|'"snap_ref"'
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ImportMigratedDisksTestCase
dedent|''
dedent|''
name|'class'
name|'ImportMigratedDisksTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_import_migrate_ephemeral_disks'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_import_migrated_root_disk'"
op|')'
newline|'\n'
DECL|member|test_import_all_migrated_disks
name|'def'
name|'test_import_all_migrated_disks'
op|'('
name|'self'
op|','
name|'mock_root'
op|','
name|'mock_ephemeral'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
string|'"session"'
newline|'\n'
name|'instance'
op|'='
string|'"instance"'
newline|'\n'
name|'mock_root'
op|'.'
name|'return_value'
op|'='
string|'"root_vdi"'
newline|'\n'
name|'mock_ephemeral'
op|'.'
name|'return_value'
op|'='
op|'['
string|'"a"'
op|','
string|'"b"'
op|']'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'import_all_migrated_disks'
op|'('
name|'session'
op|','
name|'instance'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'{'
string|"'root'"
op|':'
string|"'root_vdi'"
op|','
string|"'ephemerals'"
op|':'
op|'['
string|'"a"'
op|','
string|'"b"'
op|']'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
name|'mock_root'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
name|'instance'
op|')'
newline|'\n'
name|'mock_ephemeral'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
name|'instance'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_import_migrated_vhds'"
op|')'
newline|'\n'
DECL|member|test_import_migrated_root_disk
name|'def'
name|'test_import_migrated_root_disk'
op|'('
name|'self'
op|','
name|'mock_migrate'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_migrate'
op|'.'
name|'return_value'
op|'='
string|'"foo"'
newline|'\n'
name|'instance'
op|'='
op|'{'
string|'"uuid"'
op|':'
string|'"uuid"'
op|','
string|'"name"'
op|':'
string|'"name"'
op|'}'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'_import_migrated_root_disk'
op|'('
string|'"s"'
op|','
name|'instance'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"foo"'
op|','
name|'result'
op|')'
newline|'\n'
name|'mock_migrate'
op|'.'
name|'assert_called_once_with'
op|'('
string|'"s"'
op|','
name|'instance'
op|','
string|'"uuid"'
op|','
string|'"root"'
op|','
nl|'\n'
string|'"name"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_import_migrated_vhds'"
op|')'
newline|'\n'
DECL|member|test_import_migrate_ephemeral_disks
name|'def'
name|'test_import_migrate_ephemeral_disks'
op|'('
name|'self'
op|','
name|'mock_migrate'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_migrate'
op|'.'
name|'return_value'
op|'='
string|'"foo"'
newline|'\n'
name|'instance'
op|'='
op|'{'
string|'"uuid"'
op|':'
string|'"uuid"'
op|','
string|'"name"'
op|':'
string|'"name"'
op|','
string|'"ephemeral_gb"'
op|':'
number|'4000'
op|'}'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'_import_migrate_ephemeral_disks'
op|'('
string|'"s"'
op|','
name|'instance'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'{'
string|"'4'"
op|':'
string|"'foo'"
op|','
string|"'5'"
op|':'
string|"'foo'"
op|'}'
op|','
name|'result'
op|')'
newline|'\n'
name|'expected_calls'
op|'='
op|'['
name|'mock'
op|'.'
name|'call'
op|'('
string|'"s"'
op|','
name|'instance'
op|','
string|'"uuid_ephemeral_1"'
op|','
nl|'\n'
string|'"ephemeral"'
op|','
string|'"name ephemeral (1)"'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
string|'"s"'
op|','
name|'instance'
op|','
string|'"uuid_ephemeral_2"'
op|','
nl|'\n'
string|'"ephemeral"'
op|','
string|'"name ephemeral (2)"'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_calls'
op|','
name|'mock_migrate'
op|'.'
name|'call_args_list'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_set_vdi_info'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'scan_default_sr'"
op|')'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'get_sr_path'"
op|')'
newline|'\n'
DECL|member|test_import_migrated_vhds
name|'def'
name|'test_import_migrated_vhds'
op|'('
name|'self'
op|','
name|'mock_get_sr_path'
op|','
name|'mock_scan_sr'
op|','
nl|'\n'
name|'mock_set_info'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'instance'
op|'='
op|'{'
string|'"uuid"'
op|':'
string|'"uuid"'
op|'}'
newline|'\n'
name|'session'
op|'.'
name|'call_plugin_serialized'
op|'.'
name|'return_value'
op|'='
op|'{'
string|'"root"'
op|':'
op|'{'
string|'"uuid"'
op|':'
string|'"a"'
op|'}'
op|'}'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'return_value'
op|'='
string|'"vdi_ref"'
newline|'\n'
name|'mock_get_sr_path'
op|'.'
name|'return_value'
op|'='
string|'"sr_path"'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'vm_utils'
op|'.'
name|'_import_migrated_vhds'
op|'('
name|'session'
op|','
name|'instance'
op|','
nl|'\n'
string|"'chain_label'"
op|','
string|"'disk_type'"
op|','
string|"'vdi_label'"
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'{'
string|"'uuid'"
op|':'
string|'"a"'
op|','
string|"'ref'"
op|':'
string|'"vdi_ref"'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
name|'mock_get_sr_path'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_plugin_serialized'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'migration'"
op|','
nl|'\n'
string|"'move_vhds_into_sr'"
op|','
name|'instance_uuid'
op|'='
string|"'chain_label'"
op|','
nl|'\n'
name|'sr_path'
op|'='
string|"'sr_path'"
op|','
name|'uuid_stack'
op|'='
name|'mock'
op|'.'
name|'ANY'
op|')'
newline|'\n'
name|'mock_scan_sr'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'VDI.get_by_uuid'"
op|','
string|"'a'"
op|')'
newline|'\n'
name|'mock_set_info'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
string|"'vdi_ref'"
op|','
string|"'disk_type'"
op|','
nl|'\n'
string|"'vdi_label'"
op|','
string|"'disk_type'"
op|','
name|'instance'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|MigrateVHDTestCase
dedent|''
dedent|''
name|'class'
name|'MigrateVHDTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|_assert_transfer_called
indent|'    '
name|'def'
name|'_assert_transfer_called'
op|'('
name|'self'
op|','
name|'session'
op|','
name|'label'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'.'
name|'call_plugin_serialized'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
string|"'migration'"
op|','
string|"'transfer_vhd'"
op|','
name|'instance_uuid'
op|'='
name|'label'
op|','
name|'host'
op|'='
string|'"dest"'
op|','
nl|'\n'
name|'vdi_uuid'
op|'='
string|'"vdi_uuid"'
op|','
name|'sr_path'
op|'='
string|'"sr_path"'
op|','
name|'seq_num'
op|'='
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_migrate_vhd_root
dedent|''
name|'def'
name|'test_migrate_vhd_root'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'instance'
op|'='
op|'{'
string|'"uuid"'
op|':'
string|'"a"'
op|'}'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'migrate_vhd'
op|'('
name|'session'
op|','
name|'instance'
op|','
string|'"vdi_uuid"'
op|','
string|'"dest"'
op|','
nl|'\n'
string|'"sr_path"'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_assert_transfer_called'
op|'('
name|'session'
op|','
string|'"a"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_migrate_vhd_ephemeral
dedent|''
name|'def'
name|'test_migrate_vhd_ephemeral'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'instance'
op|'='
op|'{'
string|'"uuid"'
op|':'
string|'"a"'
op|'}'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'migrate_vhd'
op|'('
name|'session'
op|','
name|'instance'
op|','
string|'"vdi_uuid"'
op|','
string|'"dest"'
op|','
nl|'\n'
string|'"sr_path"'
op|','
number|'2'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_assert_transfer_called'
op|'('
name|'session'
op|','
string|'"a_ephemeral_2"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_migrate_vhd_converts_exceptions
dedent|''
name|'def'
name|'test_migrate_vhd_converts_exceptions'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'session'
op|'.'
name|'XenAPI'
op|'.'
name|'Failure'
op|'='
name|'test'
op|'.'
name|'TestingException'
newline|'\n'
name|'session'
op|'.'
name|'call_plugin_serialized'
op|'.'
name|'side_effect'
op|'='
name|'test'
op|'.'
name|'TestingException'
op|'('
op|')'
newline|'\n'
name|'instance'
op|'='
op|'{'
string|'"uuid"'
op|':'
string|'"a"'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'MigrationError'
op|','
name|'vm_utils'
op|'.'
name|'migrate_vhd'
op|','
nl|'\n'
name|'session'
op|','
name|'instance'
op|','
string|'"vdi_uuid"'
op|','
string|'"dest"'
op|','
string|'"sr_path"'
op|','
number|'2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_assert_transfer_called'
op|'('
name|'session'
op|','
string|'"a"'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|StripBaseMirrorTestCase
dedent|''
dedent|''
name|'class'
name|'StripBaseMirrorTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|test_strip_base_mirror_from_vdi_works
indent|'    '
name|'def'
name|'test_strip_base_mirror_from_vdi_works'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'vm_utils'
op|'.'
name|'_try_strip_base_mirror_from_vdi'
op|'('
name|'session'
op|','
string|'"vdi_ref"'
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
string|'"VDI.remove_from_sm_config"'
op|','
string|'"vdi_ref"'
op|','
string|'"base_mirror"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_strip_base_mirror_from_vdi_hides_error
dedent|''
name|'def'
name|'test_strip_base_mirror_from_vdi_hides_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'session'
op|'.'
name|'XenAPI'
op|'.'
name|'Failure'
op|'='
name|'test'
op|'.'
name|'TestingException'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'side_effect'
op|'='
name|'test'
op|'.'
name|'TestingException'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'_try_strip_base_mirror_from_vdi'
op|'('
name|'session'
op|','
string|'"vdi_ref"'
op|')'
newline|'\n'
nl|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
string|'"VDI.remove_from_sm_config"'
op|','
string|'"vdi_ref"'
op|','
string|'"base_mirror"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_utils'
op|','
string|"'_try_strip_base_mirror_from_vdi'"
op|')'
newline|'\n'
DECL|member|test_strip_base_mirror_from_vdis
name|'def'
name|'test_strip_base_mirror_from_vdis'
op|'('
name|'self'
op|','
name|'mock_strip'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'return_value'
op|'='
op|'{'
string|'"VDI"'
op|':'
string|'"ref"'
op|','
string|'"foo"'
op|':'
string|'"bar"'
op|'}'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'strip_base_mirror_from_vdis'
op|'('
name|'session'
op|','
string|'"vm_ref"'
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
op|'['
name|'mock'
op|'.'
name|'call'
op|'('
string|"'VM.get_VBDs'"
op|','
string|'"vm_ref"'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
string|"'VBD.get_record'"
op|','
string|'"VDI"'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'call'
op|'('
string|"'VBD.get_record'"
op|','
string|'"foo"'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'call_args_list'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'['
name|'mock'
op|'.'
name|'call'
op|'('
name|'session'
op|','
string|'"ref"'
op|')'
op|','
name|'mock'
op|'.'
name|'call'
op|'('
name|'session'
op|','
string|'"ref"'
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'mock_strip'
op|'.'
name|'call_args_list'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|DeviceIdTestCase
dedent|''
dedent|''
name|'class'
name|'DeviceIdTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
DECL|member|test_device_id_is_none_if_not_specified_in_meta_data
indent|'    '
name|'def'
name|'test_device_id_is_none_if_not_specified_in_meta_data'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'image_meta'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'session'
op|'.'
name|'product_version'
op|'='
op|'('
number|'6'
op|','
number|'1'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'vm_utils'
op|'.'
name|'get_vm_device_id'
op|'('
name|'session'
op|','
name|'image_meta'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_device_id_if_hypervisor_version_is_greater_than_6_1
dedent|''
name|'def'
name|'test_get_device_id_if_hypervisor_version_is_greater_than_6_1'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'image_meta'
op|'='
op|'{'
string|"'xenapi_device_id'"
op|':'
string|"'0002'"
op|'}'
newline|'\n'
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'session'
op|'.'
name|'product_version'
op|'='
op|'('
number|'6'
op|','
number|'2'
op|','
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'0002'"
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'get_vm_device_id'
op|'('
name|'session'
op|','
name|'image_meta'
op|')'
op|')'
newline|'\n'
name|'session'
op|'.'
name|'product_version'
op|'='
op|'('
number|'6'
op|','
number|'3'
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'0002'"
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'get_vm_device_id'
op|'('
name|'session'
op|','
name|'image_meta'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_raise_exception_if_device_id_not_supported_by_hyp_version
dedent|''
name|'def'
name|'test_raise_exception_if_device_id_not_supported_by_hyp_version'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'image_meta'
op|'='
op|'{'
string|"'xenapi_device_id'"
op|':'
string|"'0002'"
op|'}'
newline|'\n'
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'session'
op|'.'
name|'product_version'
op|'='
op|'('
number|'6'
op|','
number|'0'
op|')'
newline|'\n'
name|'exc'
op|'='
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NovaException'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'get_vm_device_id'
op|','
name|'session'
op|','
name|'image_meta'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"Device id 0002 specified is not supported by "'
nl|'\n'
string|'"hypervisor version (6, 0)"'
op|','
name|'exc'
op|'.'
name|'message'
op|')'
newline|'\n'
name|'session'
op|'.'
name|'product_version'
op|'='
op|'('
string|"'6a'"
op|')'
newline|'\n'
name|'exc'
op|'='
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NovaException'
op|','
nl|'\n'
name|'vm_utils'
op|'.'
name|'get_vm_device_id'
op|','
name|'session'
op|','
name|'image_meta'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"Device id 0002 specified is not supported by "'
nl|'\n'
string|'"hypervisor version 6a"'
op|','
name|'exc'
op|'.'
name|'message'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|CreateVmRecordTestCase
dedent|''
dedent|''
name|'class'
name|'CreateVmRecordTestCase'
op|'('
name|'VMUtilsTestBase'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'flavors'
op|','
string|"'extract_flavor'"
op|')'
newline|'\n'
DECL|member|test_create_vm_record
name|'def'
name|'test_create_vm_record'
op|'('
name|'self'
op|','
name|'mock_extract_flavor'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
op|')'
newline|'\n'
name|'instance'
op|'='
op|'{'
string|'"uuid"'
op|':'
string|'"uuid123"'
op|'}'
newline|'\n'
name|'flavor'
op|'='
op|'{'
string|'"memory_mb"'
op|':'
number|'1024'
op|','
string|'"vcpus"'
op|':'
number|'1'
op|','
string|'"vcpu_weight"'
op|':'
number|'2'
op|'}'
newline|'\n'
name|'mock_extract_flavor'
op|'.'
name|'return_value'
op|'='
name|'flavor'
newline|'\n'
nl|'\n'
name|'vm_utils'
op|'.'
name|'create_vm'
op|'('
name|'session'
op|','
name|'instance'
op|','
string|'"name"'
op|','
string|'"kernel"'
op|','
string|'"ramdisk"'
op|','
nl|'\n'
name|'device_id'
op|'='
string|'"0002"'
op|')'
newline|'\n'
nl|'\n'
name|'expected_vm_rec'
op|'='
op|'{'
nl|'\n'
string|"'VCPUs_params'"
op|':'
op|'{'
string|"'cap'"
op|':'
string|"'0'"
op|','
string|"'weight'"
op|':'
string|"'2'"
op|'}'
op|','
nl|'\n'
string|"'PV_args'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'memory_static_min'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'ha_restart_priority'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'HVM_boot_policy'"
op|':'
string|"'BIOS order'"
op|','
nl|'\n'
string|"'PV_bootloader'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'tags'"
op|':'
op|'['
op|']'
op|','
nl|'\n'
string|"'VCPUs_max'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'memory_static_max'"
op|':'
string|"'1073741824'"
op|','
nl|'\n'
string|"'actions_after_shutdown'"
op|':'
string|"'destroy'"
op|','
nl|'\n'
string|"'memory_dynamic_max'"
op|':'
string|"'1073741824'"
op|','
nl|'\n'
string|"'user_version'"
op|':'
string|"'0'"
op|','
nl|'\n'
string|"'xenstore_data'"
op|':'
op|'{'
string|"'vm-data/allowvssprovider'"
op|':'
string|"'false'"
op|'}'
op|','
nl|'\n'
string|"'blocked_operations'"
op|':'
op|'{'
op|'}'
op|','
nl|'\n'
string|"'is_a_template'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'name_description'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'memory_dynamic_min'"
op|':'
string|"'1073741824'"
op|','
nl|'\n'
string|"'actions_after_crash'"
op|':'
string|"'destroy'"
op|','
nl|'\n'
string|"'memory_target'"
op|':'
string|"'1073741824'"
op|','
nl|'\n'
string|"'PV_ramdisk'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'PV_bootloader_args'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'PCI_bus'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'other_config'"
op|':'
op|'{'
string|"'nova_uuid'"
op|':'
string|"'uuid123'"
op|'}'
op|','
nl|'\n'
string|"'name_label'"
op|':'
string|"'name'"
op|','
nl|'\n'
string|"'actions_after_reboot'"
op|':'
string|"'restart'"
op|','
nl|'\n'
string|"'VCPUs_at_startup'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'HVM_boot_params'"
op|':'
op|'{'
string|"'order'"
op|':'
string|"'dc'"
op|'}'
op|','
nl|'\n'
string|"'platform'"
op|':'
op|'{'
string|"'nx'"
op|':'
string|"'true'"
op|','
string|"'pae'"
op|':'
string|"'true'"
op|','
string|"'apic'"
op|':'
string|"'true'"
op|','
nl|'\n'
string|"'timeoffset'"
op|':'
string|"'0'"
op|','
string|"'viridian'"
op|':'
string|"'true'"
op|','
string|"'acpi'"
op|':'
string|"'true'"
op|','
nl|'\n'
string|"'device_id'"
op|':'
string|"'0002'"
op|'}'
op|','
nl|'\n'
string|"'PV_legacy_args'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'PV_kernel'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'affinity'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'recommendations'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'ha_always_run'"
op|':'
name|'False'
op|'}'
newline|'\n'
nl|'\n'
name|'session'
op|'.'
name|'call_xenapi'
op|'.'
name|'assert_called_with'
op|'('
string|"'VM.create'"
op|','
name|'expected_vm_rec'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
