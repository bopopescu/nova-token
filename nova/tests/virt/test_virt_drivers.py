begin_unit
comment|'#    Copyright 2010 OpenStack Foundation'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'base64'
newline|'\n'
name|'import'
name|'sys'
newline|'\n'
name|'import'
name|'traceback'
newline|'\n'
nl|'\n'
name|'import'
name|'fixtures'
newline|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'import'
name|'netaddr'
newline|'\n'
name|'import'
name|'six'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
op|'.'
name|'compute'
name|'import'
name|'manager'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'objects'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'importutils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'jsonutils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'log'
name|'as'
name|'logging'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
name|'import'
name|'fake_block_device'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'image'
name|'import'
name|'fake'
name|'as'
name|'fake_image'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
name|'import'
name|'utils'
name|'as'
name|'test_utils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'virt'
op|'.'
name|'libvirt'
name|'import'
name|'fake_libvirt_utils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
name|'import'
name|'block_device'
name|'as'
name|'driver_block_device'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
name|'import'
name|'event'
name|'as'
name|'virtevent'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
name|'import'
name|'fake'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
name|'import'
name|'libvirt'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'libvirt'
name|'import'
name|'imagebackend'
newline|'\n'
nl|'\n'
DECL|variable|LOG
name|'LOG'
op|'='
name|'logging'
op|'.'
name|'getLogger'
op|'('
name|'__name__'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|catch_notimplementederror
name|'def'
name|'catch_notimplementederror'
op|'('
name|'f'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Decorator to simplify catching drivers raising NotImplementedError\n\n    If a particular call makes a driver raise NotImplementedError, we\n    log it so that we can extract this information afterwards to\n    automatically generate a hypervisor/feature support matrix.\n    """'
newline|'\n'
DECL|function|wrapped_func
name|'def'
name|'wrapped_func'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'f'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'NotImplementedError'
op|':'
newline|'\n'
indent|'            '
name|'frame'
op|'='
name|'traceback'
op|'.'
name|'extract_tb'
op|'('
name|'sys'
op|'.'
name|'exc_info'
op|'('
op|')'
op|'['
number|'2'
op|']'
op|')'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'LOG'
op|'.'
name|'error'
op|'('
string|"'%(driver)s does not implement %(method)s'"
op|'%'
op|'{'
nl|'\n'
string|"'driver'"
op|':'
name|'type'
op|'('
name|'self'
op|'.'
name|'connection'
op|')'
op|','
nl|'\n'
string|"'method'"
op|':'
name|'frame'
op|'['
number|'2'
op|']'
op|'}'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'wrapped_func'
op|'.'
name|'__name__'
op|'='
name|'f'
op|'.'
name|'__name__'
newline|'\n'
name|'wrapped_func'
op|'.'
name|'__doc__'
op|'='
name|'f'
op|'.'
name|'__doc__'
newline|'\n'
name|'return'
name|'wrapped_func'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|_FakeDriverBackendTestCase
dedent|''
name|'class'
name|'_FakeDriverBackendTestCase'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|_setup_fakelibvirt
indent|'    '
name|'def'
name|'_setup_fakelibvirt'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# So that the _supports_direct_io does the test based'
nl|'\n'
comment|'# on the current working directory, instead of the'
nl|'\n'
comment|"# default instances_path which doesn't exist"
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'instances_path'
op|'='
name|'self'
op|'.'
name|'useFixture'
op|'('
name|'fixtures'
op|'.'
name|'TempDir'
op|'('
op|')'
op|')'
op|'.'
name|'path'
op|')'
newline|'\n'
nl|'\n'
comment|'# Put fakelibvirt in place'
nl|'\n'
name|'if'
string|"'libvirt'"
name|'in'
name|'sys'
op|'.'
name|'modules'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'saved_libvirt'
op|'='
name|'sys'
op|'.'
name|'modules'
op|'['
string|"'libvirt'"
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'saved_libvirt'
op|'='
name|'None'
newline|'\n'
nl|'\n'
dedent|''
name|'import'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'virt'
op|'.'
name|'libvirt'
op|'.'
name|'fake_imagebackend'
name|'as'
name|'fake_imagebackend'
newline|'\n'
name|'import'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'virt'
op|'.'
name|'libvirt'
op|'.'
name|'fake_libvirt_utils'
name|'as'
name|'fake_libvirt_utils'
newline|'\n'
name|'import'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'virt'
op|'.'
name|'libvirt'
op|'.'
name|'fakelibvirt'
name|'as'
name|'fakelibvirt'
newline|'\n'
nl|'\n'
name|'sys'
op|'.'
name|'modules'
op|'['
string|"'libvirt'"
op|']'
op|'='
name|'fakelibvirt'
newline|'\n'
name|'import'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'libvirt'
op|'.'
name|'driver'
newline|'\n'
name|'import'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'libvirt'
op|'.'
name|'firewall'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'useFixture'
op|'('
name|'fixtures'
op|'.'
name|'MonkeyPatch'
op|'('
nl|'\n'
string|"'nova.virt.libvirt.driver.imagebackend'"
op|','
nl|'\n'
name|'fake_imagebackend'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'useFixture'
op|'('
name|'fixtures'
op|'.'
name|'MonkeyPatch'
op|'('
nl|'\n'
string|"'nova.virt.libvirt.driver.libvirt'"
op|','
nl|'\n'
name|'fakelibvirt'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'useFixture'
op|'('
name|'fixtures'
op|'.'
name|'MonkeyPatch'
op|'('
nl|'\n'
string|"'nova.virt.libvirt.driver.libvirt_utils'"
op|','
nl|'\n'
name|'fake_libvirt_utils'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'useFixture'
op|'('
name|'fixtures'
op|'.'
name|'MonkeyPatch'
op|'('
nl|'\n'
string|"'nova.virt.libvirt.imagebackend.libvirt_utils'"
op|','
nl|'\n'
name|'fake_libvirt_utils'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'useFixture'
op|'('
name|'fixtures'
op|'.'
name|'MonkeyPatch'
op|'('
nl|'\n'
string|"'nova.virt.libvirt.firewall.libvirt'"
op|','
nl|'\n'
name|'fakelibvirt'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'rescue_image_id'
op|'='
string|'"2"'
op|','
nl|'\n'
name|'rescue_kernel_id'
op|'='
string|'"3"'
op|','
nl|'\n'
name|'rescue_ramdisk_id'
op|'='
name|'None'
op|','
nl|'\n'
name|'snapshots_directory'
op|'='
string|"'./'"
op|','
nl|'\n'
name|'group'
op|'='
string|"'libvirt'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|fake_extend
name|'def'
name|'fake_extend'
op|'('
name|'image'
op|','
name|'size'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
DECL|function|fake_migrateToURI
dedent|''
name|'def'
name|'fake_migrateToURI'
op|'('
op|'*'
name|'a'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
DECL|function|fake_make_drive
dedent|''
name|'def'
name|'fake_make_drive'
op|'('
name|'_self'
op|','
name|'_path'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
DECL|function|fake_get_instance_disk_info
dedent|''
name|'def'
name|'fake_get_instance_disk_info'
op|'('
name|'_self'
op|','
name|'instance'
op|','
name|'xml'
op|'='
name|'None'
op|','
nl|'\n'
name|'block_device_info'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|"'[]'"
newline|'\n'
nl|'\n'
DECL|function|fake_delete_instance_files
dedent|''
name|'def'
name|'fake_delete_instance_files'
op|'('
name|'_self'
op|','
name|'_instance'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'libvirt'
op|'.'
name|'driver'
op|'.'
name|'LibvirtDriver'
op|','
nl|'\n'
string|"'_get_instance_disk_info'"
op|','
nl|'\n'
name|'fake_get_instance_disk_info'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'libvirt'
op|'.'
name|'driver'
op|'.'
name|'disk'
op|','
nl|'\n'
string|"'extend'"
op|','
name|'fake_extend'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'libvirt'
op|'.'
name|'driver'
op|'.'
name|'LibvirtDriver'
op|','
nl|'\n'
string|"'_delete_instance_files'"
op|','
nl|'\n'
name|'fake_delete_instance_files'
op|')'
newline|'\n'
nl|'\n'
comment|'# Like the existing fakelibvirt.migrateToURI, do nothing,'
nl|'\n'
comment|"# but don't fail for these tests."
nl|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'libvirt'
op|'.'
name|'driver'
op|'.'
name|'libvirt'
op|'.'
name|'Domain'
op|','
nl|'\n'
string|"'migrateToURI'"
op|','
name|'fake_migrateToURI'
op|')'
newline|'\n'
nl|'\n'
comment|"# We can't actually make a config drive v2 because ensure_tree has"
nl|'\n'
comment|'# been faked out'
nl|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'configdrive'
op|'.'
name|'ConfigDriveBuilder'
op|','
nl|'\n'
string|"'make_drive'"
op|','
name|'fake_make_drive'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_teardown_fakelibvirt
dedent|''
name|'def'
name|'_teardown_fakelibvirt'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Restore libvirt'
nl|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'saved_libvirt'
op|':'
newline|'\n'
indent|'            '
name|'sys'
op|'.'
name|'modules'
op|'['
string|"'libvirt'"
op|']'
op|'='
name|'self'
op|'.'
name|'saved_libvirt'
newline|'\n'
nl|'\n'
DECL|member|setUp
dedent|''
dedent|''
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'_FakeDriverBackendTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
comment|'# TODO(sdague): it would be nice to do this in a way that only'
nl|'\n'
comment|'# the relevant backends where replaced for tests, though this'
nl|'\n'
comment|'# should not harm anything by doing it for all backends'
nl|'\n'
name|'fake_image'
op|'.'
name|'stub_out_image_service'
op|'('
name|'self'
op|'.'
name|'stubs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_setup_fakelibvirt'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_image'
op|'.'
name|'FakeImageService_reset'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_teardown_fakelibvirt'
op|'('
op|')'
newline|'\n'
name|'super'
op|'('
name|'_FakeDriverBackendTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'tearDown'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VirtDriverLoaderTestCase
dedent|''
dedent|''
name|'class'
name|'VirtDriverLoaderTestCase'
op|'('
name|'_FakeDriverBackendTestCase'
op|','
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Test that ComputeManager can successfully load both\n    old style and new style drivers and end up with the correct\n    final class.\n    """'
newline|'\n'
nl|'\n'
comment|'# if your driver supports being tested in a fake way, it can go here'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# both long form and short form drivers are supported'
nl|'\n'
DECL|variable|new_drivers
name|'new_drivers'
op|'='
op|'{'
nl|'\n'
string|"'nova.virt.fake.FakeDriver'"
op|':'
string|"'FakeDriver'"
op|','
nl|'\n'
string|"'nova.virt.libvirt.LibvirtDriver'"
op|':'
string|"'LibvirtDriver'"
op|','
nl|'\n'
string|"'fake.FakeDriver'"
op|':'
string|"'FakeDriver'"
op|','
nl|'\n'
string|"'libvirt.LibvirtDriver'"
op|':'
string|"'LibvirtDriver'"
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|test_load_new_drivers
name|'def'
name|'test_load_new_drivers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'cls'
op|','
name|'driver'
name|'in'
name|'self'
op|'.'
name|'new_drivers'
op|'.'
name|'iteritems'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'flags'
op|'('
name|'compute_driver'
op|'='
name|'cls'
op|')'
newline|'\n'
comment|'# NOTE(sdague) the try block is to make it easier to debug a'
nl|'\n'
comment|'# failure by knowing which driver broke'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'cm'
op|'='
name|'manager'
op|'.'
name|'ComputeManager'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'fail'
op|'('
string|'"Couldn\'t load driver %s - %s"'
op|'%'
op|'('
name|'cls'
op|','
name|'e'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cm'
op|'.'
name|'driver'
op|'.'
name|'__class__'
op|'.'
name|'__name__'
op|','
name|'driver'
op|','
nl|'\n'
string|'"Could\'t load driver %s"'
op|'%'
name|'cls'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_fail_to_load_new_drivers
dedent|''
dedent|''
name|'def'
name|'test_fail_to_load_new_drivers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'compute_driver'
op|'='
string|"'nova.virt.amiga'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|_fake_exit
name|'def'
name|'_fake_exit'
op|'('
name|'error'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'test'
op|'.'
name|'TestingException'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'sys'
op|','
string|"'exit'"
op|','
name|'_fake_exit'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'test'
op|'.'
name|'TestingException'
op|','
name|'manager'
op|'.'
name|'ComputeManager'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|_VirtDriverTestCase
dedent|''
dedent|''
name|'class'
name|'_VirtDriverTestCase'
op|'('
name|'_FakeDriverBackendTestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'_VirtDriverTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'instances_path'
op|'='
name|'self'
op|'.'
name|'useFixture'
op|'('
name|'fixtures'
op|'.'
name|'TempDir'
op|'('
op|')'
op|')'
op|'.'
name|'path'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'='
name|'importutils'
op|'.'
name|'import_object'
op|'('
name|'self'
op|'.'
name|'driver_module'
op|','
nl|'\n'
name|'fake'
op|'.'
name|'FakeVirtAPI'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'ctxt'
op|'='
name|'test_utils'
op|'.'
name|'get_test_admin_context'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'image_service'
op|'='
name|'fake_image'
op|'.'
name|'FakeImageService'
op|'('
op|')'
newline|'\n'
comment|'# NOTE(dripton): resolve_driver_format does some file reading and'
nl|'\n'
comment|'# writing and chowning that complicate testing too much by requiring'
nl|'\n'
comment|'# using real directories with proper permissions.  Just stub it out'
nl|'\n'
comment|'# here; we test it in test_imagebackend.py'
nl|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'imagebackend'
op|'.'
name|'Image'
op|','
string|"'resolve_driver_format'"
op|','
nl|'\n'
name|'imagebackend'
op|'.'
name|'Image'
op|'.'
name|'_get_driver_format'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_running_instance
dedent|''
name|'def'
name|'_get_running_instance'
op|'('
name|'self'
op|','
name|'obj'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|'='
name|'test_utils'
op|'.'
name|'get_test_instance'
op|'('
name|'obj'
op|'='
name|'obj'
op|')'
newline|'\n'
name|'network_info'
op|'='
name|'test_utils'
op|'.'
name|'get_test_network_info'
op|'('
op|')'
newline|'\n'
name|'network_info'
op|'['
number|'0'
op|']'
op|'['
string|"'network'"
op|']'
op|'['
string|"'subnets'"
op|']'
op|'['
number|'0'
op|']'
op|'['
string|"'meta'"
op|']'
op|'['
string|"'dhcp_server'"
op|']'
op|'='
string|"'1.1.1.1'"
newline|'\n'
name|'image_info'
op|'='
name|'test_utils'
op|'.'
name|'get_test_image_info'
op|'('
name|'None'
op|','
name|'instance_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'spawn'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
name|'image_info'
op|','
nl|'\n'
op|'['
op|']'
op|','
string|"'herp'"
op|','
name|'network_info'
op|'='
name|'network_info'
op|')'
newline|'\n'
name|'return'
name|'instance_ref'
op|','
name|'network_info'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_init_host
name|'def'
name|'test_init_host'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'init_host'
op|'('
string|"'myhostname'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_list_instances
name|'def'
name|'test_list_instances'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'list_instances'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_list_instance_uuids
name|'def'
name|'test_list_instance_uuids'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'list_instance_uuids'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_spawn
name|'def'
name|'test_spawn'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'domains'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'list_instances'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'instance_ref'
op|'['
string|"'name'"
op|']'
op|','
name|'domains'
op|')'
newline|'\n'
nl|'\n'
name|'num_instances'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_num_instances'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'num_instances'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_snapshot_not_running
name|'def'
name|'test_snapshot_not_running'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|'='
name|'test_utils'
op|'.'
name|'get_test_instance'
op|'('
op|')'
newline|'\n'
name|'img_ref'
op|'='
name|'self'
op|'.'
name|'image_service'
op|'.'
name|'create'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
op|'{'
string|"'name'"
op|':'
string|"'snap-1'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'InstanceNotRunning'
op|','
nl|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'snapshot'
op|','
nl|'\n'
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
name|'img_ref'
op|'['
string|"'id'"
op|']'
op|','
nl|'\n'
name|'lambda'
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|':'
name|'None'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_snapshot_running
name|'def'
name|'test_snapshot_running'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'img_ref'
op|'='
name|'self'
op|'.'
name|'image_service'
op|'.'
name|'create'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
op|'{'
string|"'name'"
op|':'
string|"'snap-1'"
op|'}'
op|')'
newline|'\n'
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'snapshot'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
name|'img_ref'
op|'['
string|"'id'"
op|']'
op|','
nl|'\n'
name|'lambda'
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|':'
name|'None'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_reboot
name|'def'
name|'test_reboot'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'reboot_type'
op|'='
string|'"SOFT"'
newline|'\n'
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'reboot'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
name|'network_info'
op|','
nl|'\n'
name|'reboot_type'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_host_ip_addr
name|'def'
name|'test_get_host_ip_addr'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'host_ip'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_host_ip_addr'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|"# Will raise an exception if it's not a valid IP at all"
nl|'\n'
name|'ip'
op|'='
name|'netaddr'
op|'.'
name|'IPAddress'
op|'('
name|'host_ip'
op|')'
newline|'\n'
nl|'\n'
comment|'# For now, assume IPv4.'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'ip'
op|'.'
name|'version'
op|','
number|'4'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_set_admin_password
name|'def'
name|'test_set_admin_password'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
name|'obj'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'set_admin_password'
op|'('
name|'instance'
op|','
string|"'p4ssw0rd'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_inject_file
name|'def'
name|'test_inject_file'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'inject_file'
op|'('
name|'instance_ref'
op|','
nl|'\n'
name|'base64'
op|'.'
name|'b64encode'
op|'('
string|"'/testfile'"
op|')'
op|','
nl|'\n'
name|'base64'
op|'.'
name|'b64encode'
op|'('
string|"'testcontents'"
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_resume_state_on_host_boot
name|'def'
name|'test_resume_state_on_host_boot'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'resume_state_on_host_boot'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
nl|'\n'
name|'network_info'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_rescue
name|'def'
name|'test_rescue'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'rescue'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
name|'network_info'
op|','
name|'None'
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_unrescue_unrescued_instance
name|'def'
name|'test_unrescue_unrescued_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'unrescue'
op|'('
name|'instance_ref'
op|','
name|'network_info'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_unrescue_rescued_instance
name|'def'
name|'test_unrescue_rescued_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'rescue'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
name|'network_info'
op|','
name|'None'
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'unrescue'
op|'('
name|'instance_ref'
op|','
name|'network_info'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_poll_rebooting_instances
name|'def'
name|'test_poll_rebooting_instances'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instances'
op|'='
op|'['
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'poll_rebooting_instances'
op|'('
number|'10'
op|','
name|'instances'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_migrate_disk_and_power_off
name|'def'
name|'test_migrate_disk_and_power_off'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'flavor_ref'
op|'='
name|'test_utils'
op|'.'
name|'get_test_flavor'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'migrate_disk_and_power_off'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
string|"'dest_host'"
op|','
name|'flavor_ref'
op|','
nl|'\n'
name|'network_info'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_power_off
name|'def'
name|'test_power_off'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'power_off'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_power_on_running
name|'def'
name|'test_power_on_running'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'power_on'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
nl|'\n'
name|'network_info'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_power_on_powered_off
name|'def'
name|'test_power_on_powered_off'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'power_off'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'power_on'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
name|'network_info'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_soft_delete
name|'def'
name|'test_soft_delete'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
name|'obj'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'soft_delete'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_restore_running
name|'def'
name|'test_restore_running'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'restore'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_restore_soft_deleted
name|'def'
name|'test_restore_soft_deleted'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'soft_delete'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'restore'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_pause
name|'def'
name|'test_pause'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'pause'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_unpause_unpaused_instance
name|'def'
name|'test_unpause_unpaused_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'unpause'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_unpause_paused_instance
name|'def'
name|'test_unpause_paused_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'pause'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'unpause'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_suspend
name|'def'
name|'test_suspend'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'suspend'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_resume_unsuspended_instance
name|'def'
name|'test_resume_unsuspended_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'resume'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
name|'network_info'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_resume_suspended_instance
name|'def'
name|'test_resume_suspended_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'suspend'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'resume'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
name|'network_info'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_destroy_instance_nonexistent
name|'def'
name|'test_destroy_instance_nonexistent'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_instance'
op|'='
op|'{'
string|"'id'"
op|':'
number|'42'
op|','
string|"'name'"
op|':'
string|"'I just made this up!'"
op|','
nl|'\n'
string|"'uuid'"
op|':'
string|"'bda5fb9e-b347-40e8-8256-42397848cb00'"
op|'}'
newline|'\n'
name|'network_info'
op|'='
name|'test_utils'
op|'.'
name|'get_test_network_info'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'destroy'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'fake_instance'
op|','
name|'network_info'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_destroy_instance
name|'def'
name|'test_destroy_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'instance_ref'
op|'['
string|"'name'"
op|']'
op|','
nl|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'list_instances'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'destroy'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
name|'network_info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
name|'instance_ref'
op|'['
string|"'name'"
op|']'
op|','
nl|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'list_instances'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_volume_connector
name|'def'
name|'test_get_volume_connector'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'result'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_volume_connector'
op|'('
op|'{'
string|"'id'"
op|':'
string|"'fake'"
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'ip'"
op|','
name|'result'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'initiator'"
op|','
name|'result'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'host'"
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_attach_detach_volume
name|'def'
name|'test_attach_detach_volume'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'connection_info'
op|'='
op|'{'
nl|'\n'
string|'"driver_volume_type"'
op|':'
string|'"fake"'
op|','
nl|'\n'
string|'"serial"'
op|':'
string|'"fake_serial"'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'attach_volume'
op|'('
name|'None'
op|','
name|'connection_info'
op|','
name|'instance_ref'
op|','
nl|'\n'
string|"'/dev/sda'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'detach_volume'
op|'('
name|'connection_info'
op|','
name|'instance_ref'
op|','
nl|'\n'
string|"'/dev/sda'"
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_swap_volume
name|'def'
name|'test_swap_volume'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'attach_volume'
op|'('
name|'None'
op|','
op|'{'
string|"'driver_volume_type'"
op|':'
string|"'fake'"
op|'}'
op|','
nl|'\n'
name|'instance_ref'
op|','
nl|'\n'
string|"'/dev/sda'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'swap_volume'
op|'('
op|'{'
string|"'driver_volume_type'"
op|':'
string|"'fake'"
op|'}'
op|','
nl|'\n'
op|'{'
string|"'driver_volume_type'"
op|':'
string|"'fake'"
op|'}'
op|','
nl|'\n'
name|'instance_ref'
op|','
nl|'\n'
string|"'/dev/sda'"
op|','
number|'2'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_attach_detach_different_power_states
name|'def'
name|'test_attach_detach_different_power_states'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'connection_info'
op|'='
op|'{'
nl|'\n'
string|'"driver_volume_type"'
op|':'
string|'"fake"'
op|','
nl|'\n'
string|'"serial"'
op|':'
string|'"fake_serial"'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'power_off'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'attach_volume'
op|'('
name|'None'
op|','
name|'connection_info'
op|','
name|'instance_ref'
op|','
nl|'\n'
string|"'/dev/sda'"
op|')'
newline|'\n'
nl|'\n'
name|'bdm'
op|'='
op|'{'
nl|'\n'
string|"'root_device_name'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'swap'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'ephemerals'"
op|':'
op|'['
op|']'
op|','
nl|'\n'
string|"'block_device_mapping'"
op|':'
name|'driver_block_device'
op|'.'
name|'convert_volumes'
op|'('
op|'['
nl|'\n'
name|'fake_block_device'
op|'.'
name|'FakeDbBlockDeviceDict'
op|'('
nl|'\n'
op|'{'
string|"'id'"
op|':'
number|'1'
op|','
string|"'instance_uuid'"
op|':'
name|'instance_ref'
op|'['
string|"'uuid'"
op|']'
op|','
nl|'\n'
string|"'device_name'"
op|':'
string|"'/dev/sda'"
op|','
nl|'\n'
string|"'source_type'"
op|':'
string|"'volume'"
op|','
nl|'\n'
string|"'destination_type'"
op|':'
string|"'volume'"
op|','
nl|'\n'
string|"'delete_on_termination'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'snapshot_id'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'volume_id'"
op|':'
string|"'abcdedf'"
op|','
nl|'\n'
string|"'volume_size'"
op|':'
name|'None'
op|','
nl|'\n'
string|"'no_device'"
op|':'
name|'None'
nl|'\n'
op|'}'
op|')'
op|','
nl|'\n'
op|']'
op|')'
nl|'\n'
op|'}'
newline|'\n'
name|'bdm'
op|'['
string|"'block_device_mapping'"
op|']'
op|'['
number|'0'
op|']'
op|'['
string|"'connection_info'"
op|']'
op|'='
op|'('
nl|'\n'
op|'{'
string|"'driver_volume_type'"
op|':'
string|"'fake'"
op|'}'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'driver_block_device'
op|'.'
name|'DriverVolumeBlockDevice'
op|','
string|"'save'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'power_on'
op|'('
nl|'\n'
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
name|'network_info'
op|','
name|'bdm'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'detach_volume'
op|'('
name|'connection_info'
op|','
nl|'\n'
name|'instance_ref'
op|','
nl|'\n'
string|"'/dev/sda'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_info
name|'def'
name|'test_get_info'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'info'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_info'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'state'"
op|','
name|'info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'max_mem'"
op|','
name|'info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'mem'"
op|','
name|'info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'num_cpu'"
op|','
name|'info'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'cpu_time'"
op|','
name|'info'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_info_for_unknown_instance
name|'def'
name|'test_get_info_for_unknown_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NotFound'
op|','
nl|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_info'
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
string|"'I just made this name up'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_diagnostics
name|'def'
name|'test_get_diagnostics'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
name|'obj'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_diagnostics'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_instance_diagnostics
name|'def'
name|'test_get_instance_diagnostics'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
name|'obj'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_instance_diagnostics'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_block_stats
name|'def'
name|'test_block_stats'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'stats'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'block_stats'
op|'('
name|'instance_ref'
op|'['
string|"'name'"
op|']'
op|','
string|"'someid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'stats'
op|')'
op|','
number|'5'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_interface_stats
name|'def'
name|'test_interface_stats'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'stats'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'interface_stats'
op|'('
name|'instance_ref'
op|'['
string|"'name'"
op|']'
op|','
string|"'someid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'stats'
op|')'
op|','
number|'8'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_console_output
name|'def'
name|'test_get_console_output'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_libvirt_utils'
op|'.'
name|'files'
op|'['
string|"'dummy.log'"
op|']'
op|'='
string|"''"
newline|'\n'
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'console_output'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_console_output'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
nl|'\n'
name|'instance_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsInstance'
op|'('
name|'console_output'
op|','
name|'six'
op|'.'
name|'string_types'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_vnc_console
name|'def'
name|'test_get_vnc_console'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
name|'obj'
op|'='
name|'True'
op|')'
newline|'\n'
name|'vnc_console'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_vnc_console'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'internal_access_path'"
op|','
name|'vnc_console'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'host'"
op|','
name|'vnc_console'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'port'"
op|','
name|'vnc_console'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_spice_console
name|'def'
name|'test_get_spice_console'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'spice_console'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_spice_console'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
nl|'\n'
name|'instance_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'internal_access_path'"
op|','
name|'spice_console'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'host'"
op|','
name|'spice_console'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'port'"
op|','
name|'spice_console'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'tlsPort'"
op|','
name|'spice_console'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_rdp_console
name|'def'
name|'test_get_rdp_console'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'rdp_console'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_rdp_console'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'internal_access_path'"
op|','
name|'rdp_console'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'host'"
op|','
name|'rdp_console'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'port'"
op|','
name|'rdp_console'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_console_pool_info
name|'def'
name|'test_get_console_pool_info'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'console_pool'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_console_pool_info'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'address'"
op|','
name|'console_pool'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'username'"
op|','
name|'console_pool'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'password'"
op|','
name|'console_pool'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_refresh_security_group_rules
name|'def'
name|'test_refresh_security_group_rules'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# FIXME: Create security group and add the instance to it'
nl|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'refresh_security_group_rules'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_refresh_security_group_members
name|'def'
name|'test_refresh_security_group_members'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# FIXME: Create security group and add the instance to it'
nl|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'refresh_security_group_members'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_refresh_instance_security_rules
name|'def'
name|'test_refresh_instance_security_rules'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# FIXME: Create security group and add the instance to it'
nl|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'refresh_instance_security_rules'
op|'('
name|'instance_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_refresh_provider_fw_rules
name|'def'
name|'test_refresh_provider_fw_rules'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'refresh_provider_fw_rules'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_ensure_filtering_for_instance
name|'def'
name|'test_ensure_filtering_for_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
name|'test_utils'
op|'.'
name|'get_test_instance'
op|'('
name|'obj'
op|'='
name|'True'
op|')'
newline|'\n'
name|'network_info'
op|'='
name|'test_utils'
op|'.'
name|'get_test_network_info'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'ensure_filtering_rules_for_instance'
op|'('
name|'instance'
op|','
nl|'\n'
name|'network_info'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_unfilter_instance
name|'def'
name|'test_unfilter_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|'='
name|'test_utils'
op|'.'
name|'get_test_instance'
op|'('
op|')'
newline|'\n'
name|'network_info'
op|'='
name|'test_utils'
op|'.'
name|'get_test_network_info'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'unfilter_instance'
op|'('
name|'instance_ref'
op|','
name|'network_info'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_live_migration
name|'def'
name|'test_live_migration'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'live_migration'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
string|"'otherhost'"
op|','
nl|'\n'
name|'lambda'
op|'*'
name|'a'
op|':'
name|'None'
op|','
name|'lambda'
op|'*'
name|'a'
op|':'
name|'None'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|_check_available_resource_fields
name|'def'
name|'_check_available_resource_fields'
op|'('
name|'self'
op|','
name|'host_status'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'keys'
op|'='
op|'['
string|"'vcpus'"
op|','
string|"'memory_mb'"
op|','
string|"'local_gb'"
op|','
string|"'vcpus_used'"
op|','
nl|'\n'
string|"'memory_mb_used'"
op|','
string|"'hypervisor_type'"
op|','
string|"'hypervisor_version'"
op|','
nl|'\n'
string|"'hypervisor_hostname'"
op|','
string|"'cpu_info'"
op|','
string|"'disk_available_least'"
op|','
nl|'\n'
string|"'supported_instances'"
op|']'
newline|'\n'
name|'for'
name|'key'
name|'in'
name|'keys'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'key'
op|','
name|'host_status'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertIsInstance'
op|'('
name|'host_status'
op|'['
string|"'hypervisor_version'"
op|']'
op|','
name|'int'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_host_stats
name|'def'
name|'test_get_host_stats'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'host_status'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_host_stats'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_available_resource_fields'
op|'('
name|'host_status'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_available_resource
name|'def'
name|'test_get_available_resource'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'available_resource'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_available_resource'
op|'('
nl|'\n'
string|"'myhostname'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_available_resource_fields'
op|'('
name|'available_resource'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|_check_host_cpu_status_fields
name|'def'
name|'_check_host_cpu_status_fields'
op|'('
name|'self'
op|','
name|'host_cpu_status'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'kernel'"
op|','
name|'host_cpu_status'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'idle'"
op|','
name|'host_cpu_status'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'user'"
op|','
name|'host_cpu_status'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'iowait'"
op|','
name|'host_cpu_status'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'frequency'"
op|','
name|'host_cpu_status'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_host_cpu_stats
name|'def'
name|'test_get_host_cpu_stats'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'host_cpu_status'
op|'='
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_host_cpu_stats'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_host_cpu_status_fields'
op|'('
name|'host_cpu_status'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_set_host_enabled
name|'def'
name|'test_set_host_enabled'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'set_host_enabled'
op|'('
string|"'a useless argument?'"
op|','
name|'True'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_host_uptime
name|'def'
name|'test_get_host_uptime'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_host_uptime'
op|'('
string|"'a useless argument?'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_host_power_action_reboot
name|'def'
name|'test_host_power_action_reboot'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'host_power_action'
op|'('
string|"'a useless argument?'"
op|','
string|"'reboot'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_host_power_action_shutdown
name|'def'
name|'test_host_power_action_shutdown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'host_power_action'
op|'('
string|"'a useless argument?'"
op|','
string|"'shutdown'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_host_power_action_startup
name|'def'
name|'test_host_power_action_startup'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'host_power_action'
op|'('
string|"'a useless argument?'"
op|','
string|"'startup'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_add_to_aggregate
name|'def'
name|'test_add_to_aggregate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'add_to_aggregate'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
string|"'aggregate'"
op|','
string|"'host'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_remove_from_aggregate
name|'def'
name|'test_remove_from_aggregate'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'remove_from_aggregate'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
string|"'aggregate'"
op|','
string|"'host'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_events
dedent|''
name|'def'
name|'test_events'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'got_events'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
DECL|function|handler
name|'def'
name|'handler'
op|'('
name|'event'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'got_events'
op|'.'
name|'append'
op|'('
name|'event'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'connection'
op|'.'
name|'register_event_listener'
op|'('
name|'handler'
op|')'
newline|'\n'
nl|'\n'
name|'event1'
op|'='
name|'virtevent'
op|'.'
name|'LifecycleEvent'
op|'('
nl|'\n'
string|'"cef19ce0-0ca2-11df-855d-b19fbce37686"'
op|','
nl|'\n'
name|'virtevent'
op|'.'
name|'EVENT_LIFECYCLE_STARTED'
op|')'
newline|'\n'
name|'event2'
op|'='
name|'virtevent'
op|'.'
name|'LifecycleEvent'
op|'('
nl|'\n'
string|'"cef19ce0-0ca2-11df-855d-b19fbce37686"'
op|','
nl|'\n'
name|'virtevent'
op|'.'
name|'EVENT_LIFECYCLE_PAUSED'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'emit_event'
op|'('
name|'event1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'emit_event'
op|'('
name|'event2'
op|')'
newline|'\n'
name|'want_events'
op|'='
op|'['
name|'event1'
op|','
name|'event2'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'want_events'
op|','
name|'got_events'
op|')'
newline|'\n'
nl|'\n'
name|'event3'
op|'='
name|'virtevent'
op|'.'
name|'LifecycleEvent'
op|'('
nl|'\n'
string|'"cef19ce0-0ca2-11df-855d-b19fbce37686"'
op|','
nl|'\n'
name|'virtevent'
op|'.'
name|'EVENT_LIFECYCLE_RESUMED'
op|')'
newline|'\n'
name|'event4'
op|'='
name|'virtevent'
op|'.'
name|'LifecycleEvent'
op|'('
nl|'\n'
string|'"cef19ce0-0ca2-11df-855d-b19fbce37686"'
op|','
nl|'\n'
name|'virtevent'
op|'.'
name|'EVENT_LIFECYCLE_STOPPED'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'emit_event'
op|'('
name|'event3'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'emit_event'
op|'('
name|'event4'
op|')'
newline|'\n'
nl|'\n'
name|'want_events'
op|'='
op|'['
name|'event1'
op|','
name|'event2'
op|','
name|'event3'
op|','
name|'event4'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'want_events'
op|','
name|'got_events'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_event_bad_object
dedent|''
name|'def'
name|'test_event_bad_object'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Passing in something which does not inherit'
nl|'\n'
comment|'# from virtevent.Event'
nl|'\n'
nl|'\n'
DECL|function|handler
indent|'        '
name|'def'
name|'handler'
op|'('
name|'event'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'connection'
op|'.'
name|'register_event_listener'
op|'('
name|'handler'
op|')'
newline|'\n'
nl|'\n'
name|'badevent'
op|'='
op|'{'
nl|'\n'
string|'"foo"'
op|':'
string|'"bar"'
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ValueError'
op|','
nl|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'emit_event'
op|','
nl|'\n'
name|'badevent'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_event_bad_callback
dedent|''
name|'def'
name|'test_event_bad_callback'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Check that if a callback raises an exception,'
nl|'\n'
comment|'# it does not propagate back out of the'
nl|'\n'
comment|"# 'emit_event' call"
nl|'\n'
nl|'\n'
DECL|function|handler
indent|'        '
name|'def'
name|'handler'
op|'('
name|'event'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|'"Hit Me!"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'connection'
op|'.'
name|'register_event_listener'
op|'('
name|'handler'
op|')'
newline|'\n'
nl|'\n'
name|'event1'
op|'='
name|'virtevent'
op|'.'
name|'LifecycleEvent'
op|'('
nl|'\n'
string|'"cef19ce0-0ca2-11df-855d-b19fbce37686"'
op|','
nl|'\n'
name|'virtevent'
op|'.'
name|'EVENT_LIFECYCLE_STARTED'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'emit_event'
op|'('
name|'event1'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_bootable
dedent|''
name|'def'
name|'test_set_bootable'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'NotImplementedError'
op|','
name|'self'
op|'.'
name|'connection'
op|'.'
name|'set_bootable'
op|','
nl|'\n'
string|"'instance'"
op|','
name|'True'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
DECL|member|test_get_instance_disk_info
name|'def'
name|'test_get_instance_disk_info'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# This should be implemented by any driver that supports live migrate.'
nl|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'get_instance_disk_info'
op|'('
name|'instance_ref'
op|'['
string|"'name'"
op|']'
op|','
nl|'\n'
name|'block_device_info'
op|'='
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|AbstractDriverTestCase
dedent|''
dedent|''
name|'class'
name|'AbstractDriverTestCase'
op|'('
name|'_VirtDriverTestCase'
op|','
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'driver_module'
op|'='
string|'"nova.virt.driver.ComputeDriver"'
newline|'\n'
name|'super'
op|'('
name|'AbstractDriverTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeConnectionTestCase
dedent|''
dedent|''
name|'class'
name|'FakeConnectionTestCase'
op|'('
name|'_VirtDriverTestCase'
op|','
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'driver_module'
op|'='
string|"'nova.virt.fake.FakeDriver'"
newline|'\n'
name|'fake'
op|'.'
name|'set_nodes'
op|'('
op|'['
string|"'myhostname'"
op|']'
op|')'
newline|'\n'
name|'super'
op|'('
name|'FakeConnectionTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_check_available_resource_fields
dedent|''
name|'def'
name|'_check_available_resource_fields'
op|'('
name|'self'
op|','
name|'host_status'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'FakeConnectionTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'_check_available_resource_fields'
op|'('
nl|'\n'
name|'host_status'
op|')'
newline|'\n'
nl|'\n'
name|'hypervisor_type'
op|'='
name|'host_status'
op|'['
string|"'hypervisor_type'"
op|']'
newline|'\n'
name|'supported_instances'
op|'='
name|'host_status'
op|'['
string|"'supported_instances'"
op|']'
newline|'\n'
name|'try'
op|':'
newline|'\n'
comment|'# supported_instances could be JSON wrapped'
nl|'\n'
indent|'            '
name|'supported_instances'
op|'='
name|'jsonutils'
op|'.'
name|'loads'
op|'('
name|'supported_instances'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'TypeError'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'any'
op|'('
name|'hypervisor_type'
name|'in'
name|'x'
name|'for'
name|'x'
name|'in'
name|'supported_instances'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|LibvirtConnTestCase
dedent|''
dedent|''
name|'class'
name|'LibvirtConnTestCase'
op|'('
name|'_VirtDriverTestCase'
op|','
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Point _VirtDriverTestCase at the right module'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'driver_module'
op|'='
string|"'nova.virt.libvirt.LibvirtDriver'"
newline|'\n'
name|'super'
op|'('
name|'LibvirtConnTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'self'
op|'.'
name|'connection'
op|','
nl|'\n'
string|"'_set_host_enabled'"
op|','
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'useFixture'
op|'('
name|'fixtures'
op|'.'
name|'MonkeyPatch'
op|'('
nl|'\n'
string|"'nova.context.get_admin_context'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_fake_admin_context'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_fake_admin_context
dedent|''
name|'def'
name|'_fake_admin_context'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'ctxt'
newline|'\n'
nl|'\n'
DECL|member|test_force_hard_reboot
dedent|''
name|'def'
name|'test_force_hard_reboot'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'flags'
op|'('
name|'wait_soft_reboot_seconds'
op|'='
number|'0'
op|','
name|'group'
op|'='
string|"'libvirt'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'test_reboot'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_migrate_disk_and_power_off
dedent|''
name|'def'
name|'test_migrate_disk_and_power_off'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# there is lack of fake stuff to execute this method. so pass.'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'skipTest'
op|'('
string|'"Test nothing, but this method"'
nl|'\n'
string|'" needed to override superclass."'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_internal_set_host_enabled
dedent|''
name|'def'
name|'test_internal_set_host_enabled'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'UnsetStubs'
op|'('
op|')'
newline|'\n'
name|'service_mock'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# Previous status of the service: disabled: False'
nl|'\n'
name|'service_mock'
op|'.'
name|'configure_mock'
op|'('
name|'disabled_reason'
op|'='
string|"'None'"
op|','
nl|'\n'
name|'disabled'
op|'='
name|'False'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'objects'
op|'.'
name|'Service'
op|','
string|'"get_by_compute_host"'
op|','
nl|'\n'
name|'return_value'
op|'='
name|'service_mock'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'_set_host_enabled'
op|'('
name|'False'
op|','
string|"'ERROR!'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'service_mock'
op|'.'
name|'disabled'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'service_mock'
op|'.'
name|'disabled_reason'
op|','
string|"'AUTO: ERROR!'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_host_enabled_when_auto_disabled
dedent|''
dedent|''
name|'def'
name|'test_set_host_enabled_when_auto_disabled'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'UnsetStubs'
op|'('
op|')'
newline|'\n'
name|'service_mock'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|"# Previous status of the service: disabled: True, 'AUTO: ERROR'"
nl|'\n'
name|'service_mock'
op|'.'
name|'configure_mock'
op|'('
name|'disabled_reason'
op|'='
string|"'AUTO: ERROR'"
op|','
nl|'\n'
name|'disabled'
op|'='
name|'True'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'objects'
op|'.'
name|'Service'
op|','
string|'"get_by_compute_host"'
op|','
nl|'\n'
name|'return_value'
op|'='
name|'service_mock'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'_set_host_enabled'
op|'('
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'service_mock'
op|'.'
name|'disabled'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'service_mock'
op|'.'
name|'disabled_reason'
op|','
string|"'None'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_host_enabled_when_manually_disabled
dedent|''
dedent|''
name|'def'
name|'test_set_host_enabled_when_manually_disabled'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'UnsetStubs'
op|'('
op|')'
newline|'\n'
name|'service_mock'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|"# Previous status of the service: disabled: True, 'Manually disabled'"
nl|'\n'
name|'service_mock'
op|'.'
name|'configure_mock'
op|'('
name|'disabled_reason'
op|'='
string|"'Manually disabled'"
op|','
nl|'\n'
name|'disabled'
op|'='
name|'True'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'objects'
op|'.'
name|'Service'
op|','
string|'"get_by_compute_host"'
op|','
nl|'\n'
name|'return_value'
op|'='
name|'service_mock'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'_set_host_enabled'
op|'('
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'service_mock'
op|'.'
name|'disabled'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'service_mock'
op|'.'
name|'disabled_reason'
op|','
string|"'Manually disabled'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_host_enabled_dont_override_manually_disabled
dedent|''
dedent|''
name|'def'
name|'test_set_host_enabled_dont_override_manually_disabled'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'mox'
op|'.'
name|'UnsetStubs'
op|'('
op|')'
newline|'\n'
name|'service_mock'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|"# Previous status of the service: disabled: True, 'Manually disabled'"
nl|'\n'
name|'service_mock'
op|'.'
name|'configure_mock'
op|'('
name|'disabled_reason'
op|'='
string|"'Manually disabled'"
op|','
nl|'\n'
name|'disabled'
op|'='
name|'True'
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'objects'
op|'.'
name|'Service'
op|','
string|'"get_by_compute_host"'
op|','
nl|'\n'
name|'return_value'
op|'='
name|'service_mock'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'connection'
op|'.'
name|'_set_host_enabled'
op|'('
name|'False'
op|','
string|"'ERROR!'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'service_mock'
op|'.'
name|'disabled'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'service_mock'
op|'.'
name|'disabled_reason'
op|','
string|"'Manually disabled'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'libvirt'
op|'.'
name|'driver'
op|'.'
name|'LibvirtDriver'
op|','
string|"'_unplug_vifs'"
op|')'
newline|'\n'
DECL|member|test_unplug_vifs_with_destroy_vifs_false
name|'def'
name|'test_unplug_vifs_with_destroy_vifs_false'
op|'('
name|'self'
op|','
name|'unplug_vifs_mock'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'cleanup'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
name|'network_info'
op|','
nl|'\n'
name|'destroy_vifs'
op|'='
name|'False'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'unplug_vifs_mock'
op|'.'
name|'call_count'
op|','
number|'0'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'catch_notimplementederror'
newline|'\n'
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'libvirt'
op|'.'
name|'driver'
op|'.'
name|'LibvirtDriver'
op|','
string|"'_unplug_vifs'"
op|')'
newline|'\n'
DECL|member|test_unplug_vifs_with_destroy_vifs_true
name|'def'
name|'test_unplug_vifs_with_destroy_vifs_true'
op|'('
name|'self'
op|','
name|'unplug_vifs_mock'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_ref'
op|','
name|'network_info'
op|'='
name|'self'
op|'.'
name|'_get_running_instance'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'connection'
op|'.'
name|'cleanup'
op|'('
name|'self'
op|'.'
name|'ctxt'
op|','
name|'instance_ref'
op|','
name|'network_info'
op|','
nl|'\n'
name|'destroy_vifs'
op|'='
name|'True'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'unplug_vifs_mock'
op|'.'
name|'call_count'
op|','
number|'1'
op|')'
newline|'\n'
name|'unplug_vifs_mock'
op|'.'
name|'assert_called_once_with'
op|'('
name|'instance_ref'
op|','
nl|'\n'
name|'network_info'
op|','
name|'True'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
