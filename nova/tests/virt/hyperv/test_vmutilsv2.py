begin_unit
comment|'# vim: tabstop=4 shiftwidth=4 softtabstop=4'
nl|'\n'
nl|'\n'
comment|'#  Copyright 2013 Cloudbase Solutions Srl'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'mock'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'hyperv'
name|'import'
name|'vmutilsv2'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VMUtilsV2TestCase
name|'class'
name|'VMUtilsV2TestCase'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Unit tests for the Hyper-V VMUtilsV2 class."""'
newline|'\n'
nl|'\n'
DECL|variable|_FAKE_VM_NAME
name|'_FAKE_VM_NAME'
op|'='
string|"'fake_vm'"
newline|'\n'
DECL|variable|_FAKE_MEMORY_MB
name|'_FAKE_MEMORY_MB'
op|'='
number|'2'
newline|'\n'
DECL|variable|_FAKE_VCPUS_NUM
name|'_FAKE_VCPUS_NUM'
op|'='
number|'4'
newline|'\n'
DECL|variable|_FAKE_JOB_PATH
name|'_FAKE_JOB_PATH'
op|'='
string|"'fake_job_path'"
newline|'\n'
DECL|variable|_FAKE_RET_VAL
name|'_FAKE_RET_VAL'
op|'='
number|'0'
newline|'\n'
DECL|variable|_FAKE_CTRL_PATH
name|'_FAKE_CTRL_PATH'
op|'='
string|"'fake_ctrl_path'"
newline|'\n'
DECL|variable|_FAKE_CTRL_ADDR
name|'_FAKE_CTRL_ADDR'
op|'='
number|'0'
newline|'\n'
DECL|variable|_FAKE_DRIVE_ADDR
name|'_FAKE_DRIVE_ADDR'
op|'='
number|'0'
newline|'\n'
DECL|variable|_FAKE_MOUNTED_DISK_PATH
name|'_FAKE_MOUNTED_DISK_PATH'
op|'='
string|"'fake_mounted_disk_path'"
newline|'\n'
DECL|variable|_FAKE_VM_PATH
name|'_FAKE_VM_PATH'
op|'='
string|'"fake_vm_path"'
newline|'\n'
DECL|variable|_FAKE_ENABLED_STATE
name|'_FAKE_ENABLED_STATE'
op|'='
number|'1'
newline|'\n'
DECL|variable|_FAKE_SNAPSHOT_PATH
name|'_FAKE_SNAPSHOT_PATH'
op|'='
string|'"_FAKE_SNAPSHOT_PATH"'
newline|'\n'
DECL|variable|_FAKE_RES_DATA
name|'_FAKE_RES_DATA'
op|'='
string|'"fake_res_data"'
newline|'\n'
DECL|variable|_FAKE_RES_PATH
name|'_FAKE_RES_PATH'
op|'='
string|'"fake_res_path"'
newline|'\n'
DECL|variable|_FAKE_DYNAMIC_MEMORY_RATIO
name|'_FAKE_DYNAMIC_MEMORY_RATIO'
op|'='
number|'1.0'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_vmutils'
op|'='
name|'vmutilsv2'
op|'.'
name|'VMUtilsV2'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_conn'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'super'
op|'('
name|'VMUtilsV2TestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_lookup_vm
dedent|''
name|'def'
name|'_lookup_vm'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_vm'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_lookup_vm_check'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
nl|'\n'
name|'return_value'
op|'='
name|'mock_vm'
op|')'
newline|'\n'
name|'mock_vm'
op|'.'
name|'path_'
op|'.'
name|'return_value'
op|'='
name|'self'
op|'.'
name|'_FAKE_VM_PATH'
newline|'\n'
name|'return'
name|'mock_vm'
newline|'\n'
nl|'\n'
DECL|member|test_create_vm
dedent|''
name|'def'
name|'test_create_vm'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_svc'
op|'='
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_conn'
op|'.'
name|'Msvm_VirtualSystemManagementService'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'mock_svc'
op|'.'
name|'DefineSystem'
op|'.'
name|'return_value'
op|'='
op|'('
name|'None'
op|','
name|'self'
op|'.'
name|'_FAKE_JOB_PATH'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_RET_VAL'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_get_wmi_obj'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'mock_vm'
op|'='
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_get_wmi_obj'
op|'.'
name|'return_value'
newline|'\n'
nl|'\n'
name|'mock_s'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'mock_s'
op|'.'
name|'VirtualSystemType'
op|'='
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_VIRTUAL_SYSTEM_TYPE_REALIZED'
newline|'\n'
name|'mock_vm'
op|'.'
name|'associators'
op|'.'
name|'return_value'
op|'='
op|'['
name|'mock_s'
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_set_vm_memory'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_set_vm_vcpus'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'create_vm'
op|'('
name|'self'
op|'.'
name|'_FAKE_VM_NAME'
op|','
name|'self'
op|'.'
name|'_FAKE_MEMORY_MB'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_VCPUS_NUM'
op|','
name|'False'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_DYNAMIC_MEMORY_RATIO'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'mock_svc'
op|'.'
name|'DefineSystem'
op|'.'
name|'called'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_set_vm_memory'
op|'.'
name|'assert_called_with'
op|'('
nl|'\n'
name|'mock_vm'
op|','
name|'mock_s'
op|','
name|'self'
op|'.'
name|'_FAKE_MEMORY_MB'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_DYNAMIC_MEMORY_RATIO'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_set_vm_vcpus'
op|'.'
name|'assert_called_with'
op|'('
name|'mock_vm'
op|','
name|'mock_s'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_VCPUS_NUM'
op|','
nl|'\n'
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_attach_ide_drive
dedent|''
name|'def'
name|'test_attach_ide_drive'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_lookup_vm'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_get_vm_ide_controller'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_get_new_resource_setting_data'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_add_virt_resource'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'attach_ide_drive'
op|'('
name|'self'
op|'.'
name|'_FAKE_VM_NAME'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_CTRL_PATH'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_CTRL_ADDR'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_DRIVE_ADDR'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_get_vm_ide_controller'
op|'.'
name|'called'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_get_new_resource_setting_data'
op|'.'
name|'called'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_add_virt_resource'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_attach_volume_to_controller
dedent|''
name|'def'
name|'test_attach_volume_to_controller'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_lookup_vm'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_add_virt_resource'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'attach_volume_to_controller'
op|'('
name|'self'
op|'.'
name|'_FAKE_VM_NAME'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_CTRL_PATH'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_CTRL_ADDR'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_MOUNTED_DISK_PATH'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_add_virt_resource'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_scsi_controller
dedent|''
name|'def'
name|'test_create_scsi_controller'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_lookup_vm'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_add_virt_resource'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'create_scsi_controller'
op|'('
name|'self'
op|'.'
name|'_FAKE_VM_NAME'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_add_virt_resource'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_destroy
dedent|''
name|'def'
name|'test_destroy'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_lookup_vm'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'mock_svc'
op|'='
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_conn'
op|'.'
name|'Msvm_VirtualSystemManagementService'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'mock_svc'
op|'.'
name|'DestroySystem'
op|'.'
name|'return_value'
op|'='
op|'('
name|'self'
op|'.'
name|'_FAKE_JOB_PATH'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_RET_VAL'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'destroy_vm'
op|'('
name|'self'
op|'.'
name|'_FAKE_VM_NAME'
op|')'
newline|'\n'
nl|'\n'
name|'mock_svc'
op|'.'
name|'DestroySystem'
op|'.'
name|'assert_called_with'
op|'('
name|'self'
op|'.'
name|'_FAKE_VM_PATH'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_state
dedent|''
name|'def'
name|'test_get_vm_state'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'get_vm_summary_info'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
nl|'\n'
name|'return_value'
op|'='
op|'{'
string|"'EnabledState'"
op|':'
name|'self'
op|'.'
name|'_FAKE_ENABLED_STATE'
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'enabled_state'
op|'='
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'get_vm_state'
op|'('
name|'self'
op|'.'
name|'_FAKE_VM_NAME'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'self'
op|'.'
name|'_FAKE_ENABLED_STATE'
op|','
name|'enabled_state'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_take_vm_snapshot
dedent|''
name|'def'
name|'test_take_vm_snapshot'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_lookup_vm'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'mock_svc'
op|'='
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_conn'
op|'.'
name|'Msvm_VirtualSystemSnapshotService'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'mock_svc'
op|'.'
name|'CreateSnapshot'
op|'.'
name|'return_value'
op|'='
op|'('
name|'self'
op|'.'
name|'_FAKE_JOB_PATH'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_RET_VAL'
op|')'
newline|'\n'
name|'vmutilsv2'
op|'.'
name|'wmi'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'take_vm_snapshot'
op|'('
name|'self'
op|'.'
name|'_FAKE_VM_NAME'
op|')'
newline|'\n'
nl|'\n'
name|'mock_svc'
op|'.'
name|'CreateSnapshot'
op|'.'
name|'assert_called_with'
op|'('
nl|'\n'
name|'AffectedSystem'
op|'='
name|'self'
op|'.'
name|'_FAKE_VM_PATH'
op|','
nl|'\n'
name|'SnapshotType'
op|'='
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_SNAPSHOT_FULL'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_vm_snapshot
dedent|''
name|'def'
name|'test_remove_vm_snapshot'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_svc'
op|'='
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_conn'
op|'.'
name|'Msvm_VirtualSystemSnapshotService'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'mock_svc'
op|'.'
name|'DestroySnapshot'
op|'.'
name|'return_value'
op|'='
op|'('
name|'self'
op|'.'
name|'_FAKE_JOB_PATH'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_RET_VAL'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'remove_vm_snapshot'
op|'('
name|'self'
op|'.'
name|'_FAKE_SNAPSHOT_PATH'
op|')'
newline|'\n'
nl|'\n'
name|'mock_svc'
op|'.'
name|'DestroySnapshot'
op|'.'
name|'assert_called_with'
op|'('
name|'self'
op|'.'
name|'_FAKE_SNAPSHOT_PATH'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_set_nic_connection
dedent|''
name|'def'
name|'test_set_nic_connection'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_lookup_vm'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_get_nic_data_by_name'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_add_virt_resource'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'fake_eth_port'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_get_new_setting_data'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
nl|'\n'
name|'return_value'
op|'='
name|'fake_eth_port'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'set_nic_connection'
op|'('
name|'self'
op|'.'
name|'_FAKE_VM_NAME'
op|','
name|'None'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_add_virt_resource'
op|'.'
name|'assert_called_with'
op|'('
name|'fake_eth_port'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_VM_PATH'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_add_virt_resource
dedent|''
name|'def'
name|'test_add_virt_resource'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_svc'
op|'='
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_conn'
op|'.'
name|'Msvm_VirtualSystemManagementService'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'mock_svc'
op|'.'
name|'AddResourceSettings'
op|'.'
name|'return_value'
op|'='
op|'('
name|'self'
op|'.'
name|'_FAKE_JOB_PATH'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_RET_VAL'
op|')'
newline|'\n'
name|'mock_res_setting_data'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'mock_res_setting_data'
op|'.'
name|'GetText_'
op|'.'
name|'return_value'
op|'='
name|'self'
op|'.'
name|'_FAKE_RES_DATA'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_add_virt_resource'
op|'('
name|'mock_res_setting_data'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_VM_PATH'
op|')'
newline|'\n'
nl|'\n'
name|'mock_svc'
op|'.'
name|'AddResourceSettings'
op|'.'
name|'assert_called_with'
op|'('
name|'self'
op|'.'
name|'_FAKE_VM_PATH'
op|','
nl|'\n'
op|'['
name|'self'
op|'.'
name|'_FAKE_RES_DATA'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_modify_virt_resource
dedent|''
name|'def'
name|'test_modify_virt_resource'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_svc'
op|'='
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_conn'
op|'.'
name|'Msvm_VirtualSystemManagementService'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'mock_svc'
op|'.'
name|'ModifyResourceSettings'
op|'.'
name|'return_value'
op|'='
op|'('
name|'self'
op|'.'
name|'_FAKE_JOB_PATH'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_RET_VAL'
op|')'
newline|'\n'
name|'mock_res_setting_data'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'mock_res_setting_data'
op|'.'
name|'GetText_'
op|'.'
name|'return_value'
op|'='
name|'self'
op|'.'
name|'_FAKE_RES_DATA'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_modify_virt_resource'
op|'('
name|'mock_res_setting_data'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_VM_PATH'
op|')'
newline|'\n'
nl|'\n'
name|'mock_svc'
op|'.'
name|'ModifyResourceSettings'
op|'.'
name|'assert_called_with'
op|'('
nl|'\n'
name|'ResourceSettings'
op|'='
op|'['
name|'self'
op|'.'
name|'_FAKE_RES_DATA'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_virt_resource
dedent|''
name|'def'
name|'test_remove_virt_resource'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mock_svc'
op|'='
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_conn'
op|'.'
name|'Msvm_VirtualSystemManagementService'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'mock_svc'
op|'.'
name|'RemoveResourceSettings'
op|'.'
name|'return_value'
op|'='
op|'('
name|'self'
op|'.'
name|'_FAKE_JOB_PATH'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_RET_VAL'
op|')'
newline|'\n'
name|'mock_res_setting_data'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'mock_res_setting_data'
op|'.'
name|'path_'
op|'.'
name|'return_value'
op|'='
name|'self'
op|'.'
name|'_FAKE_RES_PATH'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_remove_virt_resource'
op|'('
name|'mock_res_setting_data'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_FAKE_VM_PATH'
op|')'
newline|'\n'
nl|'\n'
name|'mock_svc'
op|'.'
name|'RemoveResourceSettings'
op|'.'
name|'assert_called_with'
op|'('
nl|'\n'
op|'['
name|'self'
op|'.'
name|'_FAKE_RES_PATH'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_enable_vm_metrics_collection
dedent|''
name|'def'
name|'test_enable_vm_metrics_collection'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_lookup_vm'
op|'('
op|')'
newline|'\n'
name|'mock_svc'
op|'='
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_conn'
op|'.'
name|'Msvm_MetricService'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
name|'metric_def'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'fake_metric_def_paths'
op|'='
op|'['
string|'"fake_0"'
op|','
string|'"fake_1"'
op|','
string|'"fake_2"'
op|']'
newline|'\n'
name|'metric_def'
op|'.'
name|'path_'
op|'.'
name|'side_effect'
op|'='
name|'fake_metric_def_paths'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_conn'
op|'.'
name|'CIM_BaseMetricDefinition'
op|'.'
name|'return_value'
op|'='
op|'['
nl|'\n'
name|'metric_def'
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'enable_vm_metrics_collection'
op|'('
name|'self'
op|'.'
name|'_FAKE_VM_NAME'
op|')'
newline|'\n'
nl|'\n'
name|'calls'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'fake_metric_def_path'
name|'in'
name|'fake_metric_def_paths'
op|':'
newline|'\n'
indent|'            '
name|'calls'
op|'.'
name|'append'
op|'('
name|'mock'
op|'.'
name|'call'
op|'('
nl|'\n'
name|'Subject'
op|'='
name|'self'
op|'.'
name|'_FAKE_VM_PATH'
op|','
nl|'\n'
name|'Definition'
op|'='
name|'fake_metric_def_path'
op|','
nl|'\n'
name|'MetricCollectionEnabled'
op|'='
name|'self'
op|'.'
name|'_vmutils'
op|'.'
name|'_METRIC_ENABLED'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'mock_svc'
op|'.'
name|'ControlMetrics'
op|'.'
name|'assert_has_calls'
op|'('
name|'calls'
op|','
name|'any_order'
op|'='
name|'True'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
