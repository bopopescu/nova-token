begin_unit
comment|'# Copyright (c) 2013 Hewlett-Packard Development Company, L.P.'
nl|'\n'
comment|'# Copyright 2013 Canonical Corp.'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'collections'
newline|'\n'
name|'import'
name|'contextlib'
newline|'\n'
name|'import'
name|'re'
newline|'\n'
nl|'\n'
name|'import'
name|'mock'
newline|'\n'
name|'from'
name|'oslo'
op|'.'
name|'vmware'
name|'import'
name|'exceptions'
name|'as'
name|'vexc'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'network'
name|'import'
name|'model'
name|'as'
name|'network_model'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'uuidutils'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'fake'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'vmwareapi'
name|'import'
name|'vm_util'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|partialObject
name|'class'
name|'partialObject'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'path'
op|'='
string|"'fake-path'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'path'
op|'='
name|'path'
newline|'\n'
name|'self'
op|'.'
name|'fault'
op|'='
name|'fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|VMwareVMUtilTestCase
dedent|''
dedent|''
name|'class'
name|'VMwareVMUtilTestCase'
op|'('
name|'test'
op|'.'
name|'NoDBTestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'VMwareVMUtilTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'fake'
op|'.'
name|'reset'
op|'('
op|')'
newline|'\n'
name|'vm_util'
op|'.'
name|'vm_refs_cache_reset'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'VMwareVMUtilTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'tearDown'
op|'('
op|')'
newline|'\n'
name|'fake'
op|'.'
name|'reset'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_get_stats_from_cluster
dedent|''
name|'def'
name|'_test_get_stats_from_cluster'
op|'('
name|'self'
op|','
name|'connection_state'
op|'='
string|'"connected"'
op|','
nl|'\n'
name|'maintenance_mode'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ManagedObjectRefs'
op|'='
op|'['
name|'fake'
op|'.'
name|'ManagedObjectReference'
op|'('
string|'"host1"'
op|','
nl|'\n'
string|'"HostSystem"'
op|')'
op|','
nl|'\n'
name|'fake'
op|'.'
name|'ManagedObjectReference'
op|'('
string|'"host2"'
op|','
nl|'\n'
string|'"HostSystem"'
op|')'
op|']'
newline|'\n'
name|'hosts'
op|'='
name|'fake'
op|'.'
name|'_convert_to_array_of_mor'
op|'('
name|'ManagedObjectRefs'
op|')'
newline|'\n'
name|'respool'
op|'='
name|'fake'
op|'.'
name|'ManagedObjectReference'
op|'('
string|'"resgroup-11"'
op|','
string|'"ResourcePool"'
op|')'
newline|'\n'
name|'prop_dict'
op|'='
op|'{'
string|"'host'"
op|':'
name|'hosts'
op|','
string|"'resourcePool'"
op|':'
name|'respool'
op|'}'
newline|'\n'
nl|'\n'
name|'hardware'
op|'='
name|'fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'hardware'
op|'.'
name|'numCpuCores'
op|'='
number|'8'
newline|'\n'
name|'hardware'
op|'.'
name|'numCpuThreads'
op|'='
number|'16'
newline|'\n'
name|'hardware'
op|'.'
name|'vendor'
op|'='
string|'"Intel"'
newline|'\n'
name|'hardware'
op|'.'
name|'cpuModel'
op|'='
string|'"Intel(R) Xeon(R)"'
newline|'\n'
nl|'\n'
name|'runtime_host_1'
op|'='
name|'fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'runtime_host_1'
op|'.'
name|'connectionState'
op|'='
string|'"connected"'
newline|'\n'
name|'runtime_host_1'
op|'.'
name|'inMaintenanceMode'
op|'='
name|'False'
newline|'\n'
nl|'\n'
name|'runtime_host_2'
op|'='
name|'fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'runtime_host_2'
op|'.'
name|'connectionState'
op|'='
name|'connection_state'
newline|'\n'
name|'runtime_host_2'
op|'.'
name|'inMaintenanceMode'
op|'='
name|'maintenance_mode'
newline|'\n'
nl|'\n'
name|'prop_list_host_1'
op|'='
op|'['
name|'fake'
op|'.'
name|'Prop'
op|'('
name|'name'
op|'='
string|'"hardware_summary"'
op|','
name|'val'
op|'='
name|'hardware'
op|')'
op|','
nl|'\n'
name|'fake'
op|'.'
name|'Prop'
op|'('
name|'name'
op|'='
string|'"runtime_summary"'
op|','
nl|'\n'
name|'val'
op|'='
name|'runtime_host_1'
op|')'
op|']'
newline|'\n'
name|'prop_list_host_2'
op|'='
op|'['
name|'fake'
op|'.'
name|'Prop'
op|'('
name|'name'
op|'='
string|'"hardware_summary"'
op|','
name|'val'
op|'='
name|'hardware'
op|')'
op|','
nl|'\n'
name|'fake'
op|'.'
name|'Prop'
op|'('
name|'name'
op|'='
string|'"runtime_summary"'
op|','
nl|'\n'
name|'val'
op|'='
name|'runtime_host_2'
op|')'
op|']'
newline|'\n'
nl|'\n'
name|'fake_objects'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'fake'
op|'.'
name|'ObjectContent'
op|'('
string|'"prop_list_host1"'
op|','
nl|'\n'
name|'prop_list_host_1'
op|')'
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'fake'
op|'.'
name|'ObjectContent'
op|'('
string|'"prop_list_host1"'
op|','
nl|'\n'
name|'prop_list_host_2'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'respool_resource_usage'
op|'='
name|'fake'
op|'.'
name|'DataObject'
op|'('
op|')'
newline|'\n'
name|'respool_resource_usage'
op|'.'
name|'maxUsage'
op|'='
number|'5368709120'
newline|'\n'
name|'respool_resource_usage'
op|'.'
name|'overallUsage'
op|'='
number|'2147483648'
newline|'\n'
nl|'\n'
DECL|function|fake_call_method
name|'def'
name|'fake_call_method'
op|'('
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
string|'"get_dynamic_properties"'
name|'in'
name|'args'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'prop_dict'
newline|'\n'
dedent|''
name|'elif'
string|'"get_properties_for_a_collection_of_objects"'
name|'in'
name|'args'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'fake_objects'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'respool_resource_usage'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
name|'fake_call_method'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_stats_from_cluster'
op|'('
name|'session'
op|','
string|'"cluster1"'
op|')'
newline|'\n'
name|'cpu_info'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'mem_info'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'if'
name|'connection_state'
op|'=='
string|'"connected"'
name|'and'
name|'not'
name|'maintenance_mode'
op|':'
newline|'\n'
indent|'                '
name|'cpu_info'
op|'['
string|"'vcpus'"
op|']'
op|'='
number|'32'
newline|'\n'
name|'cpu_info'
op|'['
string|"'cores'"
op|']'
op|'='
number|'16'
newline|'\n'
name|'cpu_info'
op|'['
string|"'vendor'"
op|']'
op|'='
op|'['
string|'"Intel"'
op|','
string|'"Intel"'
op|']'
newline|'\n'
name|'cpu_info'
op|'['
string|"'model'"
op|']'
op|'='
op|'['
string|'"Intel(R) Xeon(R)"'
op|','
nl|'\n'
string|'"Intel(R) Xeon(R)"'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'cpu_info'
op|'['
string|"'vcpus'"
op|']'
op|'='
number|'16'
newline|'\n'
name|'cpu_info'
op|'['
string|"'cores'"
op|']'
op|'='
number|'8'
newline|'\n'
name|'cpu_info'
op|'['
string|"'vendor'"
op|']'
op|'='
op|'['
string|'"Intel"'
op|']'
newline|'\n'
name|'cpu_info'
op|'['
string|"'model'"
op|']'
op|'='
op|'['
string|'"Intel(R) Xeon(R)"'
op|']'
newline|'\n'
dedent|''
name|'mem_info'
op|'['
string|"'total'"
op|']'
op|'='
number|'5120'
newline|'\n'
name|'mem_info'
op|'['
string|"'free'"
op|']'
op|'='
number|'3072'
newline|'\n'
name|'expected_stats'
op|'='
op|'{'
string|"'cpu'"
op|':'
name|'cpu_info'
op|','
string|"'mem'"
op|':'
name|'mem_info'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_stats'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_stats_from_cluster_hosts_connected_and_active
dedent|''
dedent|''
name|'def'
name|'test_get_stats_from_cluster_hosts_connected_and_active'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_get_stats_from_cluster'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_stats_from_cluster_hosts_disconnected_and_active
dedent|''
name|'def'
name|'test_get_stats_from_cluster_hosts_disconnected_and_active'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_get_stats_from_cluster'
op|'('
name|'connection_state'
op|'='
string|'"disconnected"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_stats_from_cluster_hosts_connected_and_maintenance
dedent|''
name|'def'
name|'test_get_stats_from_cluster_hosts_connected_and_maintenance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_get_stats_from_cluster'
op|'('
name|'maintenance_mode'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_host_ref_from_id
dedent|''
name|'def'
name|'test_get_host_ref_from_id'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_host_name'
op|'='
string|'"ha-host"'
newline|'\n'
name|'fake_host_sys'
op|'='
name|'fake'
op|'.'
name|'HostSystem'
op|'('
name|'fake_host_name'
op|')'
newline|'\n'
name|'fake_host_id'
op|'='
name|'fake_host_sys'
op|'.'
name|'obj'
op|'.'
name|'value'
newline|'\n'
name|'fake_objects'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'fake_host_sys'
op|')'
newline|'\n'
name|'ref'
op|'='
name|'vm_util'
op|'.'
name|'get_host_ref_from_id'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'fake_objects'
op|')'
op|','
nl|'\n'
name|'fake_host_id'
op|','
op|'['
string|"'name'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertIsInstance'
op|'('
name|'ref'
op|','
name|'fake'
op|'.'
name|'HostSystem'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'fake_host_id'
op|','
name|'ref'
op|'.'
name|'obj'
op|'.'
name|'value'
op|')'
newline|'\n'
nl|'\n'
name|'host_name'
op|'='
name|'vm_util'
op|'.'
name|'get_host_name_from_host_ref'
op|'('
name|'ref'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'fake_host_name'
op|','
name|'host_name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_host_ref_no_hosts_in_cluster
dedent|''
name|'def'
name|'test_get_host_ref_no_hosts_in_cluster'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NoValidHost'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'get_host_ref'
op|','
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
string|'""'
op|')'
op|','
string|"'fake_cluster'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|"'_get_vm_ref_from_vm_uuid'"
op|','
nl|'\n'
name|'return_value'
op|'='
name|'None'
op|')'
newline|'\n'
DECL|member|test_get_host_name_for_vm
name|'def'
name|'test_get_host_name_for_vm'
op|'('
name|'self'
op|','
name|'_get_ref_from_uuid'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_host'
op|'='
name|'fake'
op|'.'
name|'HostSystem'
op|'('
op|')'
newline|'\n'
name|'fake_host_id'
op|'='
name|'fake_host'
op|'.'
name|'obj'
op|'.'
name|'value'
newline|'\n'
name|'fake_vm'
op|'='
name|'fake'
op|'.'
name|'VirtualMachine'
op|'('
name|'name'
op|'='
string|"'vm-123'"
op|','
nl|'\n'
name|'runtime_host'
op|'='
name|'fake_host'
op|'.'
name|'obj'
op|')'
newline|'\n'
name|'fake_objects'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'fake_vm'
op|')'
newline|'\n'
nl|'\n'
name|'vm_ref'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_ref_from_name'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'fake_objects'
op|')'
op|','
string|"'vm-123'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertIsNotNone'
op|'('
name|'vm_ref'
op|')'
newline|'\n'
nl|'\n'
name|'host_id'
op|'='
name|'vm_util'
op|'.'
name|'get_host_id_from_vm_ref'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'fake_objects'
op|')'
op|','
name|'vm_ref'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'fake_host_id'
op|','
name|'host_id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_property_from_property_set
dedent|''
name|'def'
name|'test_property_from_property_set'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'ObjectContent'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'ObjectContent'"
op|','
op|'['
string|"'propSet'"
op|']'
op|')'
newline|'\n'
name|'DynamicProperty'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'Property'"
op|','
op|'['
string|"'name'"
op|','
string|"'val'"
op|']'
op|')'
newline|'\n'
name|'MoRef'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'Val'"
op|','
op|'['
string|"'value'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'good_objects'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'results_good'
op|'='
op|'['
nl|'\n'
name|'ObjectContent'
op|'('
name|'propSet'
op|'='
op|'['
nl|'\n'
name|'DynamicProperty'
op|'('
name|'name'
op|'='
string|"'name'"
op|','
name|'val'
op|'='
name|'MoRef'
op|'('
name|'value'
op|'='
string|"'vm-123'"
op|')'
op|')'
op|']'
op|')'
op|','
nl|'\n'
name|'ObjectContent'
op|'('
name|'propSet'
op|'='
op|'['
nl|'\n'
name|'DynamicProperty'
op|'('
name|'name'
op|'='
string|"'foo'"
op|','
name|'val'
op|'='
name|'MoRef'
op|'('
name|'value'
op|'='
string|"'bar1'"
op|')'
op|')'
op|','
nl|'\n'
name|'DynamicProperty'
op|'('
nl|'\n'
name|'name'
op|'='
string|"'runtime.host'"
op|','
name|'val'
op|'='
name|'MoRef'
op|'('
name|'value'
op|'='
string|"'host-123'"
op|')'
op|')'
op|','
nl|'\n'
name|'DynamicProperty'
op|'('
name|'name'
op|'='
string|"'foo'"
op|','
name|'val'
op|'='
name|'MoRef'
op|'('
name|'value'
op|'='
string|"'bar2'"
op|')'
op|')'
op|','
nl|'\n'
op|']'
op|')'
op|','
nl|'\n'
name|'ObjectContent'
op|'('
name|'propSet'
op|'='
op|'['
nl|'\n'
name|'DynamicProperty'
op|'('
nl|'\n'
name|'name'
op|'='
string|"'something'"
op|','
name|'val'
op|'='
name|'MoRef'
op|'('
name|'value'
op|'='
string|"'thing'"
op|')'
op|')'
op|']'
op|')'
op|','
op|']'
newline|'\n'
name|'for'
name|'result'
name|'in'
name|'results_good'
op|':'
newline|'\n'
indent|'            '
name|'good_objects'
op|'.'
name|'add_object'
op|'('
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'bad_objects'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'results_bad'
op|'='
op|'['
nl|'\n'
name|'ObjectContent'
op|'('
name|'propSet'
op|'='
op|'['
nl|'\n'
name|'DynamicProperty'
op|'('
name|'name'
op|'='
string|"'name'"
op|','
name|'val'
op|'='
name|'MoRef'
op|'('
name|'value'
op|'='
string|"'vm-123'"
op|')'
op|')'
op|']'
op|')'
op|','
nl|'\n'
name|'ObjectContent'
op|'('
name|'propSet'
op|'='
op|'['
nl|'\n'
name|'DynamicProperty'
op|'('
name|'name'
op|'='
string|"'foo'"
op|','
name|'val'
op|'='
string|"'bar1'"
op|')'
op|','
nl|'\n'
name|'DynamicProperty'
op|'('
name|'name'
op|'='
string|"'foo'"
op|','
name|'val'
op|'='
string|"'bar2'"
op|')'
op|','
op|']'
op|')'
op|','
nl|'\n'
name|'ObjectContent'
op|'('
name|'propSet'
op|'='
op|'['
nl|'\n'
name|'DynamicProperty'
op|'('
nl|'\n'
name|'name'
op|'='
string|"'something'"
op|','
name|'val'
op|'='
name|'MoRef'
op|'('
name|'value'
op|'='
string|"'thing'"
op|')'
op|')'
op|']'
op|')'
op|','
op|']'
newline|'\n'
name|'for'
name|'result'
name|'in'
name|'results_bad'
op|':'
newline|'\n'
indent|'            '
name|'bad_objects'
op|'.'
name|'add_object'
op|'('
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'prop'
op|'='
name|'vm_util'
op|'.'
name|'property_from_property_set'
op|'('
nl|'\n'
string|"'runtime.host'"
op|','
name|'good_objects'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNotNone'
op|'('
name|'prop'
op|')'
newline|'\n'
name|'value'
op|'='
name|'prop'
op|'.'
name|'val'
op|'.'
name|'value'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'host-123'"
op|','
name|'value'
op|')'
newline|'\n'
nl|'\n'
name|'prop2'
op|'='
name|'vm_util'
op|'.'
name|'property_from_property_set'
op|'('
nl|'\n'
string|"'runtime.host'"
op|','
name|'bad_objects'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'prop2'
op|')'
newline|'\n'
nl|'\n'
name|'prop3'
op|'='
name|'vm_util'
op|'.'
name|'property_from_property_set'
op|'('
string|"'foo'"
op|','
name|'good_objects'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNotNone'
op|'('
name|'prop3'
op|')'
newline|'\n'
name|'val3'
op|'='
name|'prop3'
op|'.'
name|'val'
op|'.'
name|'value'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'bar1'"
op|','
name|'val3'
op|')'
newline|'\n'
nl|'\n'
name|'prop4'
op|'='
name|'vm_util'
op|'.'
name|'property_from_property_set'
op|'('
string|"'foo'"
op|','
name|'bad_objects'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNotNone'
op|'('
name|'prop4'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'bar1'"
op|','
name|'prop4'
op|'.'
name|'val'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_resize_spec
dedent|''
name|'def'
name|'test_get_resize_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_instance'
op|'='
op|'{'
string|"'id'"
op|':'
number|'7'
op|','
string|"'name'"
op|':'
string|"'fake!'"
op|','
nl|'\n'
string|"'uuid'"
op|':'
string|"'bda5fb9e-b347-40e8-8256-42397848cb00'"
op|','
nl|'\n'
string|"'vcpus'"
op|':'
number|'2'
op|','
string|"'memory_mb'"
op|':'
number|'2048'
op|'}'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_resize_spec'
op|'('
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
nl|'\n'
name|'fake_instance'
op|')'
newline|'\n'
name|'expected'
op|'='
string|'"""{\'memoryMB\': 2048,\n                       \'numCPUs\': 2,\n                       \'obj_name\': \'ns0:VirtualMachineConfigSpec\'}"""'
newline|'\n'
name|'expected'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'expected'
op|')'
newline|'\n'
name|'result'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'repr'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_cdrom_attach_config_spec
dedent|''
name|'def'
name|'test_get_cdrom_attach_config_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_cdrom_attach_config_spec'
op|'('
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
nl|'\n'
name|'fake'
op|'.'
name|'Datastore'
op|'('
op|')'
op|','
nl|'\n'
string|'"/tmp/foo.iso"'
op|','
nl|'\n'
number|'200'
op|','
number|'0'
op|')'
newline|'\n'
name|'expected'
op|'='
string|'"""{\n    \'deviceChange\': [\n        {\n            \'device\': {\n                \'connectable\': {\n                    \'allowGuestControl\': False,\n                    \'startConnected\': True,\n                    \'connected\': True,\n                    \'obj_name\': \'ns0: VirtualDeviceConnectInfo\'\n                },\n                \'backing\': {\n                    \'datastore\': {\n                        "summary.maintenanceMode": "normal",\n                        "summary.type": "VMFS",\n                        "summary.accessible":true,\n                        "summary.name": "fake-ds",\n                        "summary.capacity": 1099511627776,\n                        "summary.freeSpace": 536870912000,\n                        "browser": ""\n                    },\n                    \'fileName\': \'/tmp/foo.iso\',\n                    \'obj_name\': \'ns0: VirtualCdromIsoBackingInfo\'\n                },\n                \'controllerKey\': 200,\n                \'unitNumber\': 0,\n                \'key\': -1,\n                \'obj_name\': \'ns0: VirtualCdrom\'\n            },\n            \'operation\': \'add\',\n            \'obj_name\': \'ns0: VirtualDeviceConfigSpec\'\n        }\n    ],\n    \'obj_name\': \'ns0: VirtualMachineConfigSpec\'\n}\n"""'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'expected'
op|')'
newline|'\n'
name|'result'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'repr'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_lsilogic_controller_spec
dedent|''
name|'def'
name|'test_lsilogic_controller_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test controller spec returned for lsiLogic sas adapter type'
nl|'\n'
indent|'        '
name|'config_spec'
op|'='
name|'vm_util'
op|'.'
name|'create_controller_spec'
op|'('
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
op|'-'
number|'101'
op|','
nl|'\n'
name|'adapter_type'
op|'='
string|'"lsiLogicsas"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"ns0:VirtualLsiLogicSASController"'
op|','
nl|'\n'
name|'config_spec'
op|'.'
name|'device'
op|'.'
name|'obj_name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_vmdk_path_and_adapter_type_devices
dedent|''
name|'def'
name|'_vmdk_path_and_adapter_type_devices'
op|'('
name|'self'
op|','
name|'filename'
op|','
name|'parent'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# Test the adapter_type returned for a lsiLogic sas controller'
nl|'\n'
indent|'        '
name|'controller_key'
op|'='
number|'1000'
newline|'\n'
name|'disk'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
op|')'
newline|'\n'
name|'disk'
op|'.'
name|'controllerKey'
op|'='
name|'controller_key'
newline|'\n'
name|'disk_backing'
op|'='
name|'fake'
op|'.'
name|'VirtualDiskFlatVer2BackingInfo'
op|'('
op|')'
newline|'\n'
name|'disk_backing'
op|'.'
name|'fileName'
op|'='
name|'filename'
newline|'\n'
name|'if'
name|'parent'
op|':'
newline|'\n'
indent|'            '
name|'disk_backing'
op|'.'
name|'parent'
op|'='
name|'parent'
newline|'\n'
dedent|''
name|'disk'
op|'.'
name|'backing'
op|'='
name|'disk_backing'
newline|'\n'
name|'controller'
op|'='
name|'fake'
op|'.'
name|'VirtualLsiLogicSASController'
op|'('
op|')'
newline|'\n'
name|'controller'
op|'.'
name|'key'
op|'='
name|'controller_key'
newline|'\n'
name|'devices'
op|'='
op|'['
name|'disk'
op|','
name|'controller'
op|']'
newline|'\n'
name|'return'
name|'devices'
newline|'\n'
nl|'\n'
DECL|member|test_get_vmdk_path
dedent|''
name|'def'
name|'test_get_vmdk_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'uuid'
op|'='
string|"'00000000-0000-0000-0000-000000000000'"
newline|'\n'
name|'filename'
op|'='
string|"'[test_datastore] %s/%s.vmdk'"
op|'%'
op|'('
name|'uuid'
op|','
name|'uuid'
op|')'
newline|'\n'
name|'devices'
op|'='
name|'self'
op|'.'
name|'_vmdk_path_and_adapter_type_devices'
op|'('
name|'filename'
op|')'
newline|'\n'
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'with'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'return_value'
op|'='
name|'devices'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'instance'
op|'='
op|'{'
string|"'uuid'"
op|':'
name|'uuid'
op|'}'
newline|'\n'
name|'vmdk_path'
op|'='
name|'vm_util'
op|'.'
name|'get_vmdk_path'
op|'('
name|'session'
op|','
name|'None'
op|','
name|'instance'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'filename'
op|','
name|'vmdk_path'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vmdk_path_and_adapter_type
dedent|''
dedent|''
name|'def'
name|'test_get_vmdk_path_and_adapter_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'filename'
op|'='
string|"'[test_datastore] test_file.vmdk'"
newline|'\n'
name|'devices'
op|'='
name|'self'
op|'.'
name|'_vmdk_path_and_adapter_type_devices'
op|'('
name|'filename'
op|')'
newline|'\n'
name|'vmdk_info'
op|'='
name|'vm_util'
op|'.'
name|'get_vmdk_path_and_adapter_type'
op|'('
name|'devices'
op|')'
newline|'\n'
name|'adapter_type'
op|'='
name|'vmdk_info'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'lsiLogicsas'"
op|','
name|'adapter_type'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'vmdk_info'
op|'['
number|'0'
op|']'
op|','
name|'filename'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vmdk_path_and_adapter_type_with_match
dedent|''
name|'def'
name|'test_get_vmdk_path_and_adapter_type_with_match'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'n_filename'
op|'='
string|"'[test_datastore] uuid/uuid.vmdk'"
newline|'\n'
name|'devices'
op|'='
name|'self'
op|'.'
name|'_vmdk_path_and_adapter_type_devices'
op|'('
name|'n_filename'
op|')'
newline|'\n'
name|'vmdk_info'
op|'='
name|'vm_util'
op|'.'
name|'get_vmdk_path_and_adapter_type'
op|'('
nl|'\n'
name|'devices'
op|','
name|'uuid'
op|'='
string|"'uuid'"
op|')'
newline|'\n'
name|'adapter_type'
op|'='
name|'vmdk_info'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'lsiLogicsas'"
op|','
name|'adapter_type'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'n_filename'
op|','
name|'vmdk_info'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vmdk_path_and_adapter_type_with_nomatch
dedent|''
name|'def'
name|'test_get_vmdk_path_and_adapter_type_with_nomatch'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'n_filename'
op|'='
string|"'[test_datastore] diuu/diuu.vmdk'"
newline|'\n'
name|'devices'
op|'='
name|'self'
op|'.'
name|'_vmdk_path_and_adapter_type_devices'
op|'('
name|'n_filename'
op|')'
newline|'\n'
name|'vmdk_info'
op|'='
name|'vm_util'
op|'.'
name|'get_vmdk_path_and_adapter_type'
op|'('
nl|'\n'
name|'devices'
op|','
name|'uuid'
op|'='
string|"'uuid'"
op|')'
newline|'\n'
name|'adapter_type'
op|'='
name|'vmdk_info'
op|'['
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'lsiLogicsas'"
op|','
name|'adapter_type'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'vmdk_info'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vmdk_adapter_type
dedent|''
name|'def'
name|'test_get_vmdk_adapter_type'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test for the adapter_type to be used in vmdk descriptor'
nl|'\n'
comment|'# Adapter type in vmdk descriptor is same for LSI-SAS & LSILogic'
nl|'\n'
indent|'        '
name|'vmdk_adapter_type'
op|'='
name|'vm_util'
op|'.'
name|'get_vmdk_adapter_type'
op|'('
string|'"lsiLogic"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"lsiLogic"'
op|','
name|'vmdk_adapter_type'
op|')'
newline|'\n'
name|'vmdk_adapter_type'
op|'='
name|'vm_util'
op|'.'
name|'get_vmdk_adapter_type'
op|'('
string|'"lsiLogicsas"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"lsiLogic"'
op|','
name|'vmdk_adapter_type'
op|')'
newline|'\n'
name|'vmdk_adapter_type'
op|'='
name|'vm_util'
op|'.'
name|'get_vmdk_adapter_type'
op|'('
string|'"dummyAdapter"'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"dummyAdapter"'
op|','
name|'vmdk_adapter_type'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_find_allocated_slots
dedent|''
name|'def'
name|'test_find_allocated_slots'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'disk1'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
number|'200'
op|','
number|'0'
op|')'
newline|'\n'
name|'disk2'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
number|'200'
op|','
number|'1'
op|')'
newline|'\n'
name|'disk3'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
number|'201'
op|','
number|'1'
op|')'
newline|'\n'
name|'ide0'
op|'='
name|'fake'
op|'.'
name|'VirtualIDEController'
op|'('
number|'200'
op|')'
newline|'\n'
name|'ide1'
op|'='
name|'fake'
op|'.'
name|'VirtualIDEController'
op|'('
number|'201'
op|')'
newline|'\n'
name|'scsi0'
op|'='
name|'fake'
op|'.'
name|'VirtualLsiLogicController'
op|'('
name|'key'
op|'='
number|'1000'
op|','
name|'scsiCtlrUnitNumber'
op|'='
number|'7'
op|')'
newline|'\n'
name|'devices'
op|'='
op|'['
name|'disk1'
op|','
name|'disk2'
op|','
name|'disk3'
op|','
name|'ide0'
op|','
name|'ide1'
op|','
name|'scsi0'
op|']'
newline|'\n'
name|'taken'
op|'='
name|'vm_util'
op|'.'
name|'_find_allocated_slots'
op|'('
name|'devices'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
number|'0'
op|','
number|'1'
op|']'
op|','
name|'sorted'
op|'('
name|'taken'
op|'['
number|'200'
op|']'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
number|'1'
op|']'
op|','
name|'taken'
op|'['
number|'201'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
number|'7'
op|']'
op|','
name|'taken'
op|'['
number|'1000'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_allocate_controller_key_and_unit_number_ide_default
dedent|''
name|'def'
name|'test_allocate_controller_key_and_unit_number_ide_default'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test that default IDE controllers are used when there is a free slot'
nl|'\n'
comment|'# on them'
nl|'\n'
indent|'        '
name|'disk1'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
number|'200'
op|','
number|'0'
op|')'
newline|'\n'
name|'disk2'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
number|'200'
op|','
number|'1'
op|')'
newline|'\n'
name|'ide0'
op|'='
name|'fake'
op|'.'
name|'VirtualIDEController'
op|'('
number|'200'
op|')'
newline|'\n'
name|'ide1'
op|'='
name|'fake'
op|'.'
name|'VirtualIDEController'
op|'('
number|'201'
op|')'
newline|'\n'
name|'devices'
op|'='
op|'['
name|'disk1'
op|','
name|'disk2'
op|','
name|'ide0'
op|','
name|'ide1'
op|']'
newline|'\n'
op|'('
name|'controller_key'
op|','
name|'unit_number'
op|','
nl|'\n'
name|'controller_spec'
op|')'
op|'='
name|'vm_util'
op|'.'
name|'allocate_controller_key_and_unit_number'
op|'('
nl|'\n'
name|'None'
op|','
nl|'\n'
name|'devices'
op|','
nl|'\n'
string|"'ide'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'201'
op|','
name|'controller_key'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'unit_number'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'controller_spec'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_allocate_controller_key_and_unit_number_ide
dedent|''
name|'def'
name|'test_allocate_controller_key_and_unit_number_ide'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test that a new controller is created when there is no free slot on'
nl|'\n'
comment|'# the default IDE controllers'
nl|'\n'
indent|'        '
name|'ide0'
op|'='
name|'fake'
op|'.'
name|'VirtualIDEController'
op|'('
number|'200'
op|')'
newline|'\n'
name|'ide1'
op|'='
name|'fake'
op|'.'
name|'VirtualIDEController'
op|'('
number|'201'
op|')'
newline|'\n'
name|'devices'
op|'='
op|'['
name|'ide0'
op|','
name|'ide1'
op|']'
newline|'\n'
name|'for'
name|'controller_key'
name|'in'
op|'['
number|'200'
op|','
number|'201'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'unit_number'
name|'in'
op|'['
number|'0'
op|','
number|'1'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'disk'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
name|'controller_key'
op|','
name|'unit_number'
op|')'
newline|'\n'
name|'devices'
op|'.'
name|'append'
op|'('
name|'disk'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
op|'('
name|'controller_key'
op|','
name|'unit_number'
op|','
nl|'\n'
name|'controller_spec'
op|')'
op|'='
name|'vm_util'
op|'.'
name|'allocate_controller_key_and_unit_number'
op|'('
nl|'\n'
name|'factory'
op|','
nl|'\n'
name|'devices'
op|','
nl|'\n'
string|"'ide'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'-'
number|'101'
op|','
name|'controller_key'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'unit_number'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNotNone'
op|'('
name|'controller_spec'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_allocate_controller_key_and_unit_number_scsi
dedent|''
name|'def'
name|'test_allocate_controller_key_and_unit_number_scsi'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# Test that we allocate on existing SCSI controller if there is a free'
nl|'\n'
comment|'# slot on it'
nl|'\n'
indent|'        '
name|'devices'
op|'='
op|'['
name|'fake'
op|'.'
name|'VirtualLsiLogicController'
op|'('
number|'1000'
op|','
name|'scsiCtlrUnitNumber'
op|'='
number|'7'
op|')'
op|']'
newline|'\n'
name|'for'
name|'unit_number'
name|'in'
name|'range'
op|'('
number|'7'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'disk'
op|'='
name|'fake'
op|'.'
name|'VirtualDisk'
op|'('
number|'1000'
op|','
name|'unit_number'
op|')'
newline|'\n'
name|'devices'
op|'.'
name|'append'
op|'('
name|'disk'
op|')'
newline|'\n'
dedent|''
name|'factory'
op|'='
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
newline|'\n'
op|'('
name|'controller_key'
op|','
name|'unit_number'
op|','
nl|'\n'
name|'controller_spec'
op|')'
op|'='
name|'vm_util'
op|'.'
name|'allocate_controller_key_and_unit_number'
op|'('
nl|'\n'
name|'factory'
op|','
nl|'\n'
name|'devices'
op|','
nl|'\n'
string|"'lsiLogic'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1000'
op|','
name|'controller_key'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'8'
op|','
name|'unit_number'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIsNone'
op|'('
name|'controller_spec'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_get_vnc_config_spec
dedent|''
name|'def'
name|'_test_get_vnc_config_spec'
op|'('
name|'self'
op|','
name|'port'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vnc_config_spec'
op|'('
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
nl|'\n'
name|'port'
op|')'
newline|'\n'
name|'return'
name|'result'
newline|'\n'
nl|'\n'
DECL|member|test_get_vnc_config_spec
dedent|''
name|'def'
name|'test_get_vnc_config_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'result'
op|'='
name|'self'
op|'.'
name|'_test_get_vnc_config_spec'
op|'('
number|'7'
op|')'
newline|'\n'
name|'expected'
op|'='
string|'"""{\'extraConfig\': [\n                          {\'value\': \'true\',\n                           \'key\': \'RemoteDisplay.vnc.enabled\',\n                           \'obj_name\': \'ns0:OptionValue\'},\n                          {\'value\': 7,\n                           \'key\': \'RemoteDisplay.vnc.port\',\n                           \'obj_name\': \'ns0:OptionValue\'}],\n                       \'obj_name\': \'ns0:VirtualMachineConfigSpec\'}"""'
newline|'\n'
name|'expected'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'expected'
op|')'
newline|'\n'
name|'result'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'repr'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_create_fake_vms
dedent|''
name|'def'
name|'_create_fake_vms'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_vms'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'OptionValue'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'OptionValue'"
op|','
op|'['
string|"'key'"
op|','
string|"'value'"
op|']'
op|')'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm'
op|'='
name|'fake'
op|'.'
name|'ManagedObject'
op|'('
op|')'
newline|'\n'
name|'opt_val'
op|'='
name|'OptionValue'
op|'('
name|'key'
op|'='
string|"''"
op|','
name|'value'
op|'='
number|'5900'
op|'+'
name|'i'
op|')'
newline|'\n'
name|'vm'
op|'.'
name|'set'
op|'('
name|'vm_util'
op|'.'
name|'VNC_CONFIG_KEY'
op|','
name|'opt_val'
op|')'
newline|'\n'
name|'fake_vms'
op|'.'
name|'add_object'
op|'('
name|'vm'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'fake_vms'
newline|'\n'
nl|'\n'
DECL|member|test_get_vnc_port
dedent|''
name|'def'
name|'test_get_vnc_port'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_vms'
op|'='
name|'self'
op|'.'
name|'_create_fake_vms'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'vnc_port'
op|'='
number|'5900'
op|','
name|'group'
op|'='
string|"'vmware'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'vnc_port_total'
op|'='
number|'10000'
op|','
name|'group'
op|'='
string|"'vmware'"
op|')'
newline|'\n'
name|'actual'
op|'='
name|'vm_util'
op|'.'
name|'get_vnc_port'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'fake_vms'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'actual'
op|','
number|'5910'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vnc_port_exhausted
dedent|''
name|'def'
name|'test_get_vnc_port_exhausted'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_vms'
op|'='
name|'self'
op|'.'
name|'_create_fake_vms'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'vnc_port'
op|'='
number|'5900'
op|','
name|'group'
op|'='
string|"'vmware'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'flags'
op|'('
name|'vnc_port_total'
op|'='
number|'10'
op|','
name|'group'
op|'='
string|"'vmware'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'ConsolePortRangeExhausted'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'get_vnc_port'
op|','
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'fake_vms'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_all_cluster_refs_by_name_none
dedent|''
name|'def'
name|'test_get_all_cluster_refs_by_name_none'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_objects'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'refs'
op|'='
name|'vm_util'
op|'.'
name|'get_all_cluster_refs_by_name'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'fake_objects'
op|')'
op|','
op|'['
string|"'fake_cluster'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'{'
op|'}'
op|','
name|'refs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_all_cluster_refs_by_name_exists
dedent|''
name|'def'
name|'test_get_all_cluster_refs_by_name_exists'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_objects'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'fake'
op|'.'
name|'ClusterComputeResource'
op|'('
name|'name'
op|'='
string|"'cluster'"
op|')'
op|')'
newline|'\n'
name|'refs'
op|'='
name|'vm_util'
op|'.'
name|'get_all_cluster_refs_by_name'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'fake_objects'
op|')'
op|','
op|'['
string|"'cluster'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'refs'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_all_cluster_refs_by_name_missing
dedent|''
name|'def'
name|'test_get_all_cluster_refs_by_name_missing'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_objects'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'partialObject'
op|'('
name|'path'
op|'='
string|"'cluster'"
op|')'
op|')'
newline|'\n'
name|'refs'
op|'='
name|'vm_util'
op|'.'
name|'get_all_cluster_refs_by_name'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'fake_objects'
op|')'
op|','
op|'['
string|"'cluster'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'{'
op|'}'
op|','
name|'refs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_propset_dict_simple
dedent|''
name|'def'
name|'test_propset_dict_simple'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ObjectContent'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'ObjectContent'"
op|','
op|'['
string|"'propSet'"
op|']'
op|')'
newline|'\n'
name|'DynamicProperty'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'Property'"
op|','
op|'['
string|"'name'"
op|','
string|"'val'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'object'
op|'='
name|'ObjectContent'
op|'('
name|'propSet'
op|'='
op|'['
nl|'\n'
name|'DynamicProperty'
op|'('
name|'name'
op|'='
string|"'foo'"
op|','
name|'val'
op|'='
string|'"bar"'
op|')'
op|']'
op|')'
newline|'\n'
name|'propdict'
op|'='
name|'vm_util'
op|'.'
name|'propset_dict'
op|'('
name|'object'
op|'.'
name|'propSet'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"bar"'
op|','
name|'propdict'
op|'['
string|"'foo'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_propset_dict_complex
dedent|''
name|'def'
name|'test_propset_dict_complex'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ObjectContent'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'ObjectContent'"
op|','
op|'['
string|"'propSet'"
op|']'
op|')'
newline|'\n'
name|'DynamicProperty'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'Property'"
op|','
op|'['
string|"'name'"
op|','
string|"'val'"
op|']'
op|')'
newline|'\n'
name|'MoRef'
op|'='
name|'collections'
op|'.'
name|'namedtuple'
op|'('
string|"'Val'"
op|','
op|'['
string|"'value'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'object'
op|'='
name|'ObjectContent'
op|'('
name|'propSet'
op|'='
op|'['
nl|'\n'
name|'DynamicProperty'
op|'('
name|'name'
op|'='
string|"'foo'"
op|','
name|'val'
op|'='
string|'"bar"'
op|')'
op|','
nl|'\n'
name|'DynamicProperty'
op|'('
name|'name'
op|'='
string|"'some.thing'"
op|','
nl|'\n'
name|'val'
op|'='
name|'MoRef'
op|'('
name|'value'
op|'='
string|"'else'"
op|')'
op|')'
op|','
nl|'\n'
name|'DynamicProperty'
op|'('
name|'name'
op|'='
string|"'another.thing'"
op|','
name|'val'
op|'='
string|"'value'"
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'propdict'
op|'='
name|'vm_util'
op|'.'
name|'propset_dict'
op|'('
name|'object'
op|'.'
name|'propSet'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"bar"'
op|','
name|'propdict'
op|'['
string|"'foo'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'hasattr'
op|'('
name|'propdict'
op|'['
string|"'some.thing'"
op|']'
op|','
string|"'value'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"else"'
op|','
name|'propdict'
op|'['
string|"'some.thing'"
op|']'
op|'.'
name|'value'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|'"value"'
op|','
name|'propdict'
op|'['
string|"'another.thing'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_test_detach_virtual_disk_spec
dedent|''
name|'def'
name|'_test_detach_virtual_disk_spec'
op|'('
name|'self'
op|','
name|'destroy_disk'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'virtual_device_config'
op|'='
name|'vm_util'
op|'.'
name|'detach_virtual_disk_spec'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
nl|'\n'
string|"'fake_device'"
op|','
nl|'\n'
name|'destroy_disk'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'remove'"
op|','
name|'virtual_device_config'
op|'.'
name|'operation'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'fake_device'"
op|','
name|'virtual_device_config'
op|'.'
name|'device'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'ns0:VirtualDeviceConfigSpec'"
op|','
nl|'\n'
name|'virtual_device_config'
op|'.'
name|'obj_name'
op|')'
newline|'\n'
name|'if'
name|'destroy_disk'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'destroy'"
op|','
name|'virtual_device_config'
op|'.'
name|'fileOperation'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'hasattr'
op|'('
name|'virtual_device_config'
op|','
string|"'fileOperation'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_detach_virtual_disk_spec
dedent|''
dedent|''
name|'def'
name|'test_detach_virtual_disk_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_detach_virtual_disk_spec'
op|'('
name|'destroy_disk'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_detach_virtual_disk_destroy_spec
dedent|''
name|'def'
name|'test_detach_virtual_disk_destroy_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_test_detach_virtual_disk_spec'
op|'('
name|'destroy_disk'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec
dedent|''
name|'def'
name|'test_get_vm_create_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_uuid'
op|'='
name|'uuidutils'
op|'.'
name|'generate_uuid'
op|'('
op|')'
newline|'\n'
name|'fake_instance'
op|'='
op|'{'
string|"'id'"
op|':'
number|'7'
op|','
string|"'name'"
op|':'
string|"'fake!'"
op|','
nl|'\n'
string|"'uuid'"
op|':'
name|'instance_uuid'
op|','
nl|'\n'
string|"'vcpus'"
op|':'
number|'2'
op|','
string|"'memory_mb'"
op|':'
number|'2048'
op|'}'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
nl|'\n'
name|'fake_instance'
op|','
name|'instance_uuid'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'expected'
op|'='
string|'"""{\n            \'files\': {\'vmPathName\': \'[fake-datastore]\',\n            \'obj_name\': \'ns0:VirtualMachineFileInfo\'},\n            \'instanceUuid\': \'%(instance_uuid)s\',\n            \'name\': \'%(instance_uuid)s\', \'deviceChange\': [],\n            \'extraConfig\': [{\'value\': \'%(instance_uuid)s\',\n                             \'key\': \'nvp.vm-uuid\',\n                             \'obj_name\': \'ns0:OptionValue\'}],\n            \'memoryMB\': 2048,\n            \'obj_name\': \'ns0:VirtualMachineConfigSpec\',\n            \'guestId\': \'otherGuest\',\n            \'tools\': {\'beforeGuestStandby\': True,\n                      \'beforeGuestReboot\': True,\n                      \'beforeGuestShutdown\': True,\n                      \'afterResume\': True,\n                      \'afterPowerOn\': True,\n            \'obj_name\': \'ns0:ToolsConfigInfo\'},\n            \'numCPUs\': 2}"""'
op|'%'
op|'{'
string|"'instance_uuid'"
op|':'
name|'instance_uuid'
op|'}'
newline|'\n'
name|'expected'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'expected'
op|')'
newline|'\n'
name|'result'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'repr'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec_with_allocations
dedent|''
name|'def'
name|'test_get_vm_create_spec_with_allocations'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_uuid'
op|'='
name|'uuidutils'
op|'.'
name|'generate_uuid'
op|'('
op|')'
newline|'\n'
name|'fake_instance'
op|'='
op|'{'
string|"'id'"
op|':'
number|'7'
op|','
string|"'name'"
op|':'
string|"'fake!'"
op|','
nl|'\n'
string|"'uuid'"
op|':'
name|'instance_uuid'
op|','
nl|'\n'
string|"'vcpus'"
op|':'
number|'2'
op|','
string|"'memory_mb'"
op|':'
number|'2048'
op|'}'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
nl|'\n'
name|'fake_instance'
op|','
name|'instance_uuid'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'allocations'
op|'='
op|'{'
string|"'cpu_limit'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'cpu_reservation'"
op|':'
number|'6'
op|'}'
op|')'
newline|'\n'
name|'expected'
op|'='
string|'"""{\n            \'files\': {\'vmPathName\': \'[fake-datastore]\',\n            \'obj_name\': \'ns0:VirtualMachineFileInfo\'},\n            \'instanceUuid\': \'%(instance_uuid)s\',\n            \'name\': \'%(instance_uuid)s\', \'deviceChange\': [],\n            \'extraConfig\': [{\'value\': \'%(instance_uuid)s\',\n                             \'key\': \'nvp.vm-uuid\',\n                             \'obj_name\': \'ns0:OptionValue\'}],\n            \'memoryMB\': 2048,\n            \'obj_name\': \'ns0:VirtualMachineConfigSpec\',\n            \'guestId\': \'otherGuest\',\n            \'tools\': {\'beforeGuestStandby\': True,\n                      \'beforeGuestReboot\': True,\n                      \'beforeGuestShutdown\': True,\n                      \'afterResume\': True,\n                      \'afterPowerOn\': True,\n            \'obj_name\': \'ns0:ToolsConfigInfo\'},\n            \'cpuAllocation\': {\'reservation\': 6,\n                              \'limit\': 7,\n                              \'obj_name\': \'ns0:ResourceAllocationInfo\'},\n            \'numCPUs\': 2}"""'
op|'%'
op|'{'
string|"'instance_uuid'"
op|':'
name|'instance_uuid'
op|'}'
newline|'\n'
name|'expected'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'expected'
op|')'
newline|'\n'
name|'result'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'repr'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec_with_limit
dedent|''
name|'def'
name|'test_get_vm_create_spec_with_limit'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_uuid'
op|'='
name|'uuidutils'
op|'.'
name|'generate_uuid'
op|'('
op|')'
newline|'\n'
name|'fake_instance'
op|'='
op|'{'
string|"'id'"
op|':'
number|'7'
op|','
string|"'name'"
op|':'
string|"'fake!'"
op|','
nl|'\n'
string|"'uuid'"
op|':'
name|'instance_uuid'
op|','
nl|'\n'
string|"'vcpus'"
op|':'
number|'2'
op|','
string|"'memory_mb'"
op|':'
number|'2048'
op|'}'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
nl|'\n'
name|'fake_instance'
op|','
name|'instance_uuid'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'allocations'
op|'='
op|'{'
string|"'cpu_limit'"
op|':'
number|'7'
op|'}'
op|')'
newline|'\n'
name|'expected'
op|'='
string|'"""{\n            \'files\': {\'vmPathName\': \'[fake-datastore]\',\n            \'obj_name\': \'ns0:VirtualMachineFileInfo\'},\n            \'instanceUuid\': \'%(instance_uuid)s\',\n            \'name\': \'%(instance_uuid)s\', \'deviceChange\': [],\n            \'extraConfig\': [{\'value\': \'%(instance_uuid)s\',\n                             \'key\': \'nvp.vm-uuid\',\n                             \'obj_name\': \'ns0:OptionValue\'}],\n            \'memoryMB\': 2048,\n            \'obj_name\': \'ns0:VirtualMachineConfigSpec\',\n            \'guestId\': \'otherGuest\',\n            \'tools\': {\'beforeGuestStandby\': True,\n                      \'beforeGuestReboot\': True,\n                      \'beforeGuestShutdown\': True,\n                      \'afterResume\': True,\n                      \'afterPowerOn\': True,\n            \'obj_name\': \'ns0:ToolsConfigInfo\'},\n            \'cpuAllocation\': {\'limit\': 7,\n                              \'obj_name\': \'ns0:ResourceAllocationInfo\'},\n            \'numCPUs\': 2}"""'
op|'%'
op|'{'
string|"'instance_uuid'"
op|':'
name|'instance_uuid'
op|'}'
newline|'\n'
name|'expected'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'expected'
op|')'
newline|'\n'
name|'result'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'repr'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec_with_share
dedent|''
name|'def'
name|'test_get_vm_create_spec_with_share'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_uuid'
op|'='
name|'uuidutils'
op|'.'
name|'generate_uuid'
op|'('
op|')'
newline|'\n'
name|'fake_instance'
op|'='
op|'{'
string|"'id'"
op|':'
number|'7'
op|','
string|"'name'"
op|':'
string|"'fake!'"
op|','
nl|'\n'
string|"'uuid'"
op|':'
name|'instance_uuid'
op|','
nl|'\n'
string|"'vcpus'"
op|':'
number|'2'
op|','
string|"'memory_mb'"
op|':'
number|'2048'
op|'}'
newline|'\n'
name|'shares'
op|'='
op|'{'
string|"'cpu_shares_level'"
op|':'
string|"'high'"
op|'}'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
nl|'\n'
name|'fake_instance'
op|','
name|'instance_uuid'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'allocations'
op|'='
name|'shares'
op|')'
newline|'\n'
name|'expected'
op|'='
string|'"""{\n            \'files\': {\'vmPathName\': \'[fake-datastore]\',\n            \'obj_name\': \'ns0:VirtualMachineFileInfo\'},\n            \'instanceUuid\': \'%(instance_uuid)s\',\n            \'name\': \'%(instance_uuid)s\', \'deviceChange\': [],\n            \'extraConfig\': [{\'value\': \'%(instance_uuid)s\',\n                             \'key\': \'nvp.vm-uuid\',\n                             \'obj_name\': \'ns0:OptionValue\'}],\n            \'memoryMB\': 2048,\n            \'obj_name\': \'ns0:VirtualMachineConfigSpec\',\n            \'guestId\': \'otherGuest\',\n            \'tools\': {\'beforeGuestStandby\': True,\n                      \'beforeGuestReboot\': True,\n                      \'beforeGuestShutdown\': True,\n                      \'afterResume\': True,\n                      \'afterPowerOn\': True,\n            \'obj_name\': \'ns0:ToolsConfigInfo\'},\n            \'cpuAllocation\': {\'shares\': {\'level\': \'high\',\n                                         \'shares\': 0,\n                                         \'obj_name\':\'ns0:SharesInfo\'},\n                              \'obj_name\':\'ns0:ResourceAllocationInfo\'},\n            \'numCPUs\': 2}"""'
op|'%'
op|'{'
string|"'instance_uuid'"
op|':'
name|'instance_uuid'
op|'}'
newline|'\n'
name|'expected'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'expected'
op|')'
newline|'\n'
name|'result'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'repr'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_vm_create_spec_with_share_custom
dedent|''
name|'def'
name|'test_get_vm_create_spec_with_share_custom'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance_uuid'
op|'='
name|'uuidutils'
op|'.'
name|'generate_uuid'
op|'('
op|')'
newline|'\n'
name|'fake_instance'
op|'='
op|'{'
string|"'id'"
op|':'
number|'7'
op|','
string|"'name'"
op|':'
string|"'fake!'"
op|','
nl|'\n'
string|"'uuid'"
op|':'
name|'instance_uuid'
op|','
nl|'\n'
string|"'vcpus'"
op|':'
number|'2'
op|','
string|"'memory_mb'"
op|':'
number|'2048'
op|'}'
newline|'\n'
name|'shares'
op|'='
op|'{'
string|"'cpu_shares_level'"
op|':'
string|"'custom'"
op|','
nl|'\n'
string|"'cpu_shares_share'"
op|':'
number|'1948'
op|'}'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_vm_create_spec'
op|'('
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
nl|'\n'
name|'fake_instance'
op|','
name|'instance_uuid'
op|','
nl|'\n'
string|"'fake-datastore'"
op|','
op|'['
op|']'
op|','
nl|'\n'
name|'allocations'
op|'='
name|'shares'
op|')'
newline|'\n'
name|'expected'
op|'='
string|'"""{\n            \'files\': {\'vmPathName\': \'[fake-datastore]\',\n            \'obj_name\': \'ns0:VirtualMachineFileInfo\'},\n            \'instanceUuid\': \'%(instance_uuid)s\',\n            \'name\': \'%(instance_uuid)s\', \'deviceChange\': [],\n            \'extraConfig\': [{\'value\': \'%(instance_uuid)s\',\n                             \'key\': \'nvp.vm-uuid\',\n                             \'obj_name\': \'ns0:OptionValue\'}],\n            \'memoryMB\': 2048,\n            \'obj_name\': \'ns0:VirtualMachineConfigSpec\',\n            \'guestId\': \'otherGuest\',\n            \'tools\': {\'beforeGuestStandby\': True,\n                      \'beforeGuestReboot\': True,\n                      \'beforeGuestShutdown\': True,\n                      \'afterResume\': True,\n                      \'afterPowerOn\': True,\n            \'obj_name\': \'ns0:ToolsConfigInfo\'},\n            \'cpuAllocation\': {\'shares\': {\'level\': \'custom\',\n                                         \'shares\': 1948,\n                                         \'obj_name\':\'ns0:SharesInfo\'},\n                              \'obj_name\':\'ns0:ResourceAllocationInfo\'},\n            \'numCPUs\': 2}"""'
op|'%'
op|'{'
string|"'instance_uuid'"
op|':'
name|'instance_uuid'
op|'}'
newline|'\n'
name|'expected'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'expected'
op|')'
newline|'\n'
name|'result'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'repr'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_vm
dedent|''
name|'def'
name|'test_create_vm'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'method_list'
op|'='
op|'['
string|"'CreateVM_Task'"
op|','
string|"'get_dynamic_property'"
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_call_method
name|'def'
name|'fake_call_method'
op|'('
name|'module'
op|','
name|'method'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'expected_method'
op|'='
name|'method_list'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_method'
op|','
name|'method'
op|')'
newline|'\n'
name|'if'
op|'('
name|'expected_method'
op|'=='
string|"'CreateVM_Task'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'return'
string|"'fake_create_vm_task'"
newline|'\n'
dedent|''
name|'elif'
op|'('
name|'expected_method'
op|'=='
string|"'get_dynamic_property'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'task_info'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
name|'state'
op|'='
string|'"success"'
op|','
name|'result'
op|'='
string|'"fake_vm_ref"'
op|')'
newline|'\n'
name|'return'
name|'task_info'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'fail'
op|'('
string|"'Should not get here....'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|fake_wait_for_task
dedent|''
dedent|''
name|'def'
name|'fake_wait_for_task'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'task_info'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
name|'state'
op|'='
string|'"success"'
op|','
name|'result'
op|'='
string|'"fake_vm_ref"'
op|')'
newline|'\n'
name|'return'
name|'task_info'
newline|'\n'
nl|'\n'
dedent|''
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'fake_instance'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'fake_call_mock'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
name|'side_effect'
op|'='
name|'fake_call_method'
op|')'
newline|'\n'
name|'fake_wait_mock'
op|'='
name|'mock'
op|'.'
name|'Mock'
op|'('
name|'side_effect'
op|'='
name|'fake_wait_for_task'
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_wait_for_task'"
op|','
nl|'\n'
name|'fake_wait_mock'
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'fake_call_mock'
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'wait_for_task'
op|','
name|'call_method'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_ref'
op|'='
name|'vm_util'
op|'.'
name|'create_vm'
op|'('
nl|'\n'
name|'session'
op|','
nl|'\n'
name|'fake_instance'
op|','
nl|'\n'
string|"'fake_vm_folder'"
op|','
nl|'\n'
string|"'fake_config_spec'"
op|','
nl|'\n'
string|"'fake_res_pool_ref'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'fake_vm_ref'"
op|','
name|'vm_ref'
op|')'
newline|'\n'
nl|'\n'
name|'call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'ANY'
op|','
string|"'CreateVM_Task'"
op|','
nl|'\n'
string|"'fake_vm_folder'"
op|','
name|'config'
op|'='
string|"'fake_config_spec'"
op|','
nl|'\n'
name|'pool'
op|'='
string|"'fake_res_pool_ref'"
op|')'
newline|'\n'
name|'wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake_create_vm_task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_convert_vif_model
dedent|''
dedent|''
name|'def'
name|'test_convert_vif_model'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expected'
op|'='
string|'"VirtualE1000"'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'convert_vif_model'
op|'('
name|'network_model'
op|'.'
name|'VIF_MODEL_E1000'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
name|'expected'
op|'='
string|'"VirtualE1000e"'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'convert_vif_model'
op|'('
name|'network_model'
op|'.'
name|'VIF_MODEL_E1000E'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
name|'types'
op|'='
op|'['
string|'"VirtualE1000"'
op|','
string|'"VirtualE1000e"'
op|','
string|'"VirtualPCNet32"'
op|','
nl|'\n'
string|'"VirtualVmxnet"'
op|']'
newline|'\n'
name|'for'
name|'type'
name|'in'
name|'types'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'type'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'convert_vif_model'
op|'('
name|'type'
op|')'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'Invalid'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'convert_vif_model'
op|','
nl|'\n'
string|'"InvalidVifModel"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_power_on_instance_with_vm_ref
dedent|''
name|'def'
name|'test_power_on_instance_with_vm_ref'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'fake_instance'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_call_method"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_wait_for_task"'
op|')'
op|','
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'power_on_instance'
op|'('
name|'session'
op|','
name|'fake_instance'
op|','
nl|'\n'
name|'vm_ref'
op|'='
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'_get_vim'
op|'('
op|')'
op|','
nl|'\n'
string|'"PowerOnVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_power_on_instance_without_vm_ref
dedent|''
dedent|''
name|'def'
name|'test_power_on_instance_without_vm_ref'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'fake_instance'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_vm_ref"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-vm-ref'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_call_method"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_wait_for_task"'
op|')'
op|','
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_get_vm_ref'
op|','
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'power_on_instance'
op|'('
name|'session'
op|','
name|'fake_instance'
op|')'
newline|'\n'
name|'fake_get_vm_ref'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
name|'fake_instance'
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'_get_vim'
op|'('
op|')'
op|','
nl|'\n'
string|'"PowerOnVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_power_on_instance_with_exception
dedent|''
dedent|''
name|'def'
name|'test_power_on_instance_with_exception'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'fake_instance'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_call_method"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_wait_for_task"'
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'exception'
op|'.'
name|'NovaException'
op|'('
string|"'fake'"
op|')'
op|')'
op|','
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NovaException'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'power_on_instance'
op|','
nl|'\n'
name|'session'
op|','
name|'fake_instance'
op|','
nl|'\n'
name|'vm_ref'
op|'='
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'_get_vim'
op|'('
op|')'
op|','
nl|'\n'
string|'"PowerOnVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_power_on_instance_with_power_state_exception
dedent|''
dedent|''
name|'def'
name|'test_power_on_instance_with_power_state_exception'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'fake_instance'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_call_method"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'session'
op|','
string|'"_wait_for_task"'
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'vexc'
op|'.'
name|'InvalidPowerStateException'
op|')'
op|','
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'power_on_instance'
op|'('
name|'session'
op|','
name|'fake_instance'
op|','
nl|'\n'
name|'vm_ref'
op|'='
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'_get_vim'
op|'('
op|')'
op|','
nl|'\n'
string|'"PowerOnVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_virtual_disk
dedent|''
dedent|''
name|'def'
name|'test_create_virtual_disk'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'dm'
op|'='
name|'session'
op|'.'
name|'_get_vim'
op|'('
op|')'
op|'.'
name|'service_content'
op|'.'
name|'virtualDiskManager'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_vmdk_create_spec"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-spec'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_call_method"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_wait_for_task"'
op|')'
op|','
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_get_spec'
op|','
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'create_virtual_disk'
op|'('
name|'session'
op|','
string|"'fake-dc-ref'"
op|','
nl|'\n'
string|"'fake-adapter-type'"
op|','
string|"'fake-disk-type'"
op|','
nl|'\n'
string|"'fake-path'"
op|','
number|'7'
op|')'
newline|'\n'
name|'fake_get_spec'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'session'
op|'.'
name|'_get_vim'
op|'('
op|')'
op|'.'
name|'client'
op|'.'
name|'factory'
op|','
number|'7'
op|','
nl|'\n'
string|"'fake-adapter-type'"
op|','
nl|'\n'
string|"'fake-disk-type'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'session'
op|'.'
name|'_get_vim'
op|'('
op|')'
op|','
nl|'\n'
string|'"CreateVirtualDisk_Task"'
op|','
nl|'\n'
name|'dm'
op|','
nl|'\n'
name|'name'
op|'='
string|"'fake-path'"
op|','
nl|'\n'
name|'datacenter'
op|'='
string|"'fake-dc-ref'"
op|','
nl|'\n'
name|'spec'
op|'='
string|"'fake-spec'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_copy_virtual_disk
dedent|''
dedent|''
name|'def'
name|'test_copy_virtual_disk'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'dm'
op|'='
name|'session'
op|'.'
name|'_get_vim'
op|'('
op|')'
op|'.'
name|'service_content'
op|'.'
name|'virtualDiskManager'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_call_method"'
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|'"_wait_for_task"'
op|')'
op|','
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'copy_virtual_disk'
op|'('
name|'session'
op|','
string|"'fake-dc-ref'"
op|','
nl|'\n'
string|"'fake-source'"
op|','
string|"'fake-dest'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
name|'session'
op|'.'
name|'_get_vim'
op|'('
op|')'
op|','
nl|'\n'
string|'"CopyVirtualDisk_Task"'
op|','
nl|'\n'
name|'dm'
op|','
nl|'\n'
name|'sourceName'
op|'='
string|"'fake-source'"
op|','
nl|'\n'
name|'sourceDatacenter'
op|'='
string|"'fake-dc-ref'"
op|','
nl|'\n'
name|'destName'
op|'='
string|"'fake-dest'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_create_fake_vm_objects
dedent|''
dedent|''
name|'def'
name|'_create_fake_vm_objects'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fake_objects'
op|'='
name|'fake'
op|'.'
name|'FakeRetrieveResult'
op|'('
op|')'
newline|'\n'
name|'fake_objects'
op|'.'
name|'add_object'
op|'('
name|'fake'
op|'.'
name|'VirtualMachine'
op|'('
op|')'
op|')'
newline|'\n'
name|'return'
name|'fake_objects'
newline|'\n'
nl|'\n'
DECL|member|test_get_values
dedent|''
name|'def'
name|'test_get_values'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'objects'
op|'='
name|'self'
op|'.'
name|'_create_fake_vm_objects'
op|'('
op|')'
newline|'\n'
name|'query'
op|'='
name|'vm_util'
op|'.'
name|'get_values_from_object_properties'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeObjectRetrievalSession'
op|'('
name|'objects'
op|')'
op|','
name|'objects'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'poweredOn'"
op|','
name|'query'
op|'['
string|"'runtime.powerState'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'guestToolsRunning'"
op|','
nl|'\n'
name|'query'
op|'['
string|"'summary.guest.toolsRunningStatus'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'toolsOk'"
op|','
name|'query'
op|'['
string|"'summary.guest.toolsStatus'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_reconfigure_vm
dedent|''
name|'def'
name|'test_reconfigure_vm'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake_reconfigure_task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_wait_for_task'"
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'_call_method'
op|','
name|'_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'reconfigure_vm'
op|'('
name|'session'
op|','
string|"'fake-ref'"
op|','
string|"'fake-spec'"
op|')'
newline|'\n'
name|'_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'mock'
op|'.'
name|'ANY'
op|','
nl|'\n'
string|"'ReconfigVM_Task'"
op|','
string|"'fake-ref'"
op|','
name|'spec'
op|'='
string|"'fake-spec'"
op|')'
newline|'\n'
name|'_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
nl|'\n'
string|"'fake_reconfigure_task'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_network_attach_config_spec_opaque
dedent|''
dedent|''
name|'def'
name|'test_get_network_attach_config_spec_opaque'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vif_info'
op|'='
op|'{'
string|"'network_name'"
op|':'
string|"'br-int'"
op|','
nl|'\n'
string|"'mac_address'"
op|':'
string|"'00:00:00:ca:fe:01'"
op|','
nl|'\n'
string|"'network_ref'"
op|':'
op|'{'
string|"'type'"
op|':'
string|"'OpaqueNetwork'"
op|','
nl|'\n'
string|"'network-id'"
op|':'
string|"'fake-network-id'"
op|','
nl|'\n'
string|"'network-type'"
op|':'
string|"'opaque'"
op|'}'
op|','
nl|'\n'
string|"'iface_id'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'vif_model'"
op|':'
string|"'VirtualE1000'"
op|'}'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_network_attach_config_spec'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
name|'vif_info'
op|','
number|'1'
op|')'
newline|'\n'
name|'card'
op|'='
string|"'ns0:VirtualEthernetCardOpaqueNetworkBackingInfo'"
newline|'\n'
name|'expected'
op|'='
string|'"""{\n            \'extraConfig\': [{\'value\': 7,\n                             \'key\': \'nvp.iface-id.1\',\n                             \'obj_name\':\'ns0:OptionValue\'}],\n            \'deviceChange\': [\n                {\'device\': {\n                     \'macAddress\':\'00:00:00:ca:fe:01\',\n                     \'addressType\': \'manual\',\n                     \'connectable\': {\n                         \'allowGuestControl\':True,\n                         \'startConnected\': True,\n                         \'connected\': True,\n                         \'obj_name\':\'ns0:VirtualDeviceConnectInfo\'},\n                     \'backing\': {\n                         \'opaqueNetworkType\': \'opaque\',\n                         \'opaqueNetworkId\': \'fake-network-id\',\n                         \'obj_name\': \'%(card)s\'},\n                     \'key\': -47,\n                     \'obj_name\': \'ns0:VirtualE1000\',\n                     \'wakeOnLanEnabled\': True},\n                 \'operation\': \'add\',\n                 \'obj_name\': \'ns0:VirtualDeviceConfigSpec\'}],\n            \'obj_name\':\'ns0:VirtualMachineConfigSpec\'}"""'
op|'%'
op|'{'
string|"'card'"
op|':'
name|'card'
op|'}'
newline|'\n'
name|'expected'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'expected'
op|')'
newline|'\n'
name|'result'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'repr'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_network_attach_config_spec_dvs
dedent|''
name|'def'
name|'test_get_network_attach_config_spec_dvs'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vif_info'
op|'='
op|'{'
string|"'network_name'"
op|':'
string|"'br100'"
op|','
nl|'\n'
string|"'mac_address'"
op|':'
string|"'00:00:00:ca:fe:01'"
op|','
nl|'\n'
string|"'network_ref'"
op|':'
op|'{'
string|"'type'"
op|':'
string|"'DistributedVirtualPortgroup'"
op|','
nl|'\n'
string|"'dvsw'"
op|':'
string|"'fake-network-id'"
op|','
nl|'\n'
string|"'dvpg'"
op|':'
string|"'fake-group'"
op|'}'
op|','
nl|'\n'
string|"'iface_id'"
op|':'
number|'7'
op|','
nl|'\n'
string|"'vif_model'"
op|':'
string|"'VirtualE1000'"
op|'}'
newline|'\n'
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_network_attach_config_spec'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
name|'vif_info'
op|','
number|'1'
op|')'
newline|'\n'
name|'port'
op|'='
string|"'ns0:DistributedVirtualSwitchPortConnection'"
newline|'\n'
name|'backing'
op|'='
string|"'ns0:VirtualEthernetCardDistributedVirtualPortBackingInfo'"
newline|'\n'
name|'expected'
op|'='
string|'"""{\n            \'extraConfig\': [{\'value\': 7,\n                             \'key\': \'nvp.iface-id.1\',\n                             \'obj_name\': \'ns0:OptionValue\'}],\n            \'deviceChange\': [\n                {\'device\': {\'macAddress\': \'00:00:00:ca:fe:01\',\n                            \'addressType\': \'manual\',\n                            \'connectable\': {\n                                \'allowGuestControl\': True,\n                                \'startConnected\': True,\n                                \'connected\': True,\n                                \'obj_name\': \'ns0:VirtualDeviceConnectInfo\'},\n                 \'backing\': {\n                     \'port\': {\n                         \'portgroupKey\': \'fake-group\',\n                         \'switchUuid\': \'fake-network-id\',\n                         \'obj_name\': \'%(obj_name_port)s\'},\n                     \'obj_name\': \'%(obj_name_backing)s\'},\n                     \'key\': -47,\n                     \'obj_name\': \'ns0:VirtualE1000\',\n                     \'wakeOnLanEnabled\': True},\n                 \'operation\': \'add\',\n                 \'obj_name\': \'ns0:VirtualDeviceConfigSpec\'}],\n            \'obj_name\':\'ns0:VirtualMachineConfigSpec\'}"""'
op|'%'
op|'{'
nl|'\n'
string|"'obj_name_backing'"
op|':'
name|'backing'
op|','
nl|'\n'
string|"'obj_name_port'"
op|':'
name|'port'
op|'}'
newline|'\n'
name|'expected'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'expected'
op|')'
newline|'\n'
name|'result'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'repr'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_network_detach_config_spec
dedent|''
name|'def'
name|'test_get_network_detach_config_spec'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'result'
op|'='
name|'vm_util'
op|'.'
name|'get_network_detach_config_spec'
op|'('
nl|'\n'
name|'fake'
op|'.'
name|'FakeFactory'
op|'('
op|')'
op|','
string|"'fake-device'"
op|','
number|'2'
op|')'
newline|'\n'
name|'expected'
op|'='
string|'"""{\n            \'extraConfig\': [{\'value\': \'free\',\n                             \'key\': \'nvp.iface-id.2\',\n                             \'obj_name\': \'ns0:OptionValue\'}],\n            \'deviceChange\': [{\'device\': \'fake-device\',\n                              \'operation\': \'remove\',\n                              \'obj_name\': \'ns0:VirtualDeviceConfigSpec\'}],\n            \'obj_name\':\'ns0:VirtualMachineConfigSpec\'}"""'
newline|'\n'
name|'expected'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'expected'
op|')'
newline|'\n'
name|'result'
op|'='
name|'re'
op|'.'
name|'sub'
op|'('
string|"r'\\s+'"
op|','
string|"''"
op|','
name|'repr'
op|'('
name|'result'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected'
op|','
name|'result'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_vm_ref"'
op|')'
newline|'\n'
DECL|member|test_power_off_instance
name|'def'
name|'test_power_off_instance'
op|'('
name|'self'
op|','
name|'fake_get_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'fake_instance'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_wait_for_task'"
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'power_off_instance'
op|'('
name|'session'
op|','
name|'fake_instance'
op|','
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'_get_vim'
op|'('
op|')'
op|','
nl|'\n'
string|'"PowerOffVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'fake_get_ref'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_vm_ref"'
op|','
name|'return_value'
op|'='
string|'"fake-vm-ref"'
op|')'
newline|'\n'
DECL|member|test_power_off_instance_no_vm_ref
name|'def'
name|'test_power_off_instance_no_vm_ref'
op|'('
name|'self'
op|','
name|'fake_get_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'fake_instance'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_wait_for_task'"
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'power_off_instance'
op|'('
name|'session'
op|','
name|'fake_instance'
op|')'
newline|'\n'
name|'fake_get_ref'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|','
name|'fake_instance'
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'_get_vim'
op|'('
op|')'
op|','
nl|'\n'
string|'"PowerOffVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_vm_ref"'
op|')'
newline|'\n'
DECL|member|test_power_off_instance_with_exception
name|'def'
name|'test_power_off_instance_with_exception'
op|'('
name|'self'
op|','
name|'fake_get_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'fake_instance'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_wait_for_task'"
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'exception'
op|'.'
name|'NovaException'
op|'('
string|"'fake'"
op|')'
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NovaException'
op|','
nl|'\n'
name|'vm_util'
op|'.'
name|'power_off_instance'
op|','
nl|'\n'
name|'session'
op|','
name|'fake_instance'
op|','
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'_get_vim'
op|'('
op|')'
op|','
nl|'\n'
string|'"PowerOffVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'fake_get_ref'
op|'.'
name|'called'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'vm_util'
op|','
string|'"get_vm_ref"'
op|')'
newline|'\n'
DECL|member|test_power_off_instance_power_state_exception
name|'def'
name|'test_power_off_instance_power_state_exception'
op|'('
name|'self'
op|','
name|'fake_get_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'session'
op|'='
name|'fake'
op|'.'
name|'FakeSession'
op|'('
op|')'
newline|'\n'
name|'fake_instance'
op|'='
name|'mock'
op|'.'
name|'MagicMock'
op|'('
op|')'
newline|'\n'
name|'with'
name|'contextlib'
op|'.'
name|'nested'
op|'('
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
name|'session'
op|','
string|"'_call_method'"
op|','
nl|'\n'
name|'return_value'
op|'='
string|"'fake-task'"
op|')'
op|','
nl|'\n'
name|'mock'
op|'.'
name|'patch'
op|'.'
name|'object'
op|'('
nl|'\n'
name|'session'
op|','
string|"'_wait_for_task'"
op|','
nl|'\n'
name|'side_effect'
op|'='
name|'vexc'
op|'.'
name|'InvalidPowerStateException'
op|')'
nl|'\n'
op|')'
name|'as'
op|'('
name|'fake_call_method'
op|','
name|'fake_wait_for_task'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'vm_util'
op|'.'
name|'power_off_instance'
op|'('
name|'session'
op|','
name|'fake_instance'
op|','
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_call_method'
op|'.'
name|'assert_called_once_with'
op|'('
name|'session'
op|'.'
name|'_get_vim'
op|'('
op|')'
op|','
nl|'\n'
string|'"PowerOffVM_Task"'
op|','
nl|'\n'
string|"'fake-vm-ref'"
op|')'
newline|'\n'
name|'fake_wait_for_task'
op|'.'
name|'assert_called_once_with'
op|'('
string|"'fake-task'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'fake_get_ref'
op|'.'
name|'called'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
endmarker|''
end_unit
