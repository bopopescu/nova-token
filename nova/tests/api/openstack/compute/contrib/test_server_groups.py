begin_unit
comment|'# Copyright (c) 2014 Cisco Systems, Inc.'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
name|'from'
name|'lxml'
name|'import'
name|'etree'
newline|'\n'
name|'import'
name|'webob'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
op|'.'
name|'api'
op|'.'
name|'openstack'
op|'.'
name|'compute'
op|'.'
name|'contrib'
name|'import'
name|'server_groups'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'api'
op|'.'
name|'openstack'
op|'.'
name|'compute'
op|'.'
name|'plugins'
op|'.'
name|'v3'
name|'import'
name|'server_groups'
name|'as'
name|'sg_v3'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'api'
op|'.'
name|'openstack'
name|'import'
name|'extensions'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'api'
op|'.'
name|'openstack'
name|'import'
name|'wsgi'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'context'
newline|'\n'
name|'import'
name|'nova'
op|'.'
name|'db'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'objects'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'uuidutils'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
op|'.'
name|'api'
op|'.'
name|'openstack'
name|'import'
name|'fakes'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'tests'
name|'import'
name|'utils'
newline|'\n'
nl|'\n'
DECL|variable|FAKE_UUID1
name|'FAKE_UUID1'
op|'='
string|"'a47ae74e-ab08-447f-8eee-ffd43fc46c16'"
newline|'\n'
DECL|variable|FAKE_UUID2
name|'FAKE_UUID2'
op|'='
string|"'c6e6430a-6563-4efa-9542-5e93c9e97d18'"
newline|'\n'
DECL|variable|FAKE_UUID3
name|'FAKE_UUID3'
op|'='
string|"'b8713410-9ba3-e913-901b-13410ca90121'"
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|AttrDict
name|'class'
name|'AttrDict'
op|'('
name|'dict'
op|')'
op|':'
newline|'\n'
DECL|member|__getattr__
indent|'    '
name|'def'
name|'__getattr__'
op|'('
name|'self'
op|','
name|'k'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'['
name|'k'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|server_group_template
dedent|''
dedent|''
name|'def'
name|'server_group_template'
op|'('
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'sgroup'
op|'='
name|'kwargs'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'sgroup'
op|'.'
name|'setdefault'
op|'('
string|"'name'"
op|','
string|"'test'"
op|')'
newline|'\n'
name|'return'
name|'sgroup'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|server_group_resp_template
dedent|''
name|'def'
name|'server_group_resp_template'
op|'('
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'sgroup'
op|'='
name|'kwargs'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'sgroup'
op|'.'
name|'setdefault'
op|'('
string|"'name'"
op|','
string|"'test'"
op|')'
newline|'\n'
name|'sgroup'
op|'.'
name|'setdefault'
op|'('
string|"'policies'"
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'sgroup'
op|'.'
name|'setdefault'
op|'('
string|"'members'"
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'return'
name|'sgroup'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|server_group_db
dedent|''
name|'def'
name|'server_group_db'
op|'('
name|'sg'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'attrs'
op|'='
name|'sg'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'if'
string|"'id'"
name|'in'
name|'attrs'
op|':'
newline|'\n'
indent|'        '
name|'attrs'
op|'['
string|"'uuid'"
op|']'
op|'='
name|'attrs'
op|'.'
name|'pop'
op|'('
string|"'id'"
op|')'
newline|'\n'
dedent|''
name|'if'
string|"'policies'"
name|'in'
name|'attrs'
op|':'
newline|'\n'
indent|'        '
name|'policies'
op|'='
name|'attrs'
op|'.'
name|'pop'
op|'('
string|"'policies'"
op|')'
newline|'\n'
name|'attrs'
op|'['
string|"'policies'"
op|']'
op|'='
name|'policies'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'attrs'
op|'['
string|"'policies'"
op|']'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'if'
string|"'members'"
name|'in'
name|'attrs'
op|':'
newline|'\n'
indent|'        '
name|'members'
op|'='
name|'attrs'
op|'.'
name|'pop'
op|'('
string|"'members'"
op|')'
newline|'\n'
name|'attrs'
op|'['
string|"'members'"
op|']'
op|'='
name|'members'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'attrs'
op|'['
string|"'members'"
op|']'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'attrs'
op|'['
string|"'deleted'"
op|']'
op|'='
number|'0'
newline|'\n'
name|'attrs'
op|'['
string|"'deleted_at'"
op|']'
op|'='
name|'None'
newline|'\n'
name|'attrs'
op|'['
string|"'created_at'"
op|']'
op|'='
name|'None'
newline|'\n'
name|'attrs'
op|'['
string|"'updated_at'"
op|']'
op|'='
name|'None'
newline|'\n'
name|'if'
string|"'user_id'"
name|'not'
name|'in'
name|'attrs'
op|':'
newline|'\n'
indent|'        '
name|'attrs'
op|'['
string|"'user_id'"
op|']'
op|'='
string|"'user_id'"
newline|'\n'
dedent|''
name|'if'
string|"'project_id'"
name|'not'
name|'in'
name|'attrs'
op|':'
newline|'\n'
indent|'        '
name|'attrs'
op|'['
string|"'project_id'"
op|']'
op|'='
string|"'project_id'"
newline|'\n'
dedent|''
name|'attrs'
op|'['
string|"'id'"
op|']'
op|'='
number|'7'
newline|'\n'
nl|'\n'
name|'return'
name|'AttrDict'
op|'('
name|'attrs'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ServerGroupTestV21
dedent|''
name|'class'
name|'ServerGroupTestV21'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'ServerGroupTestV21'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_setup_controller'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'app'
op|'='
name|'self'
op|'.'
name|'_get_app'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_setup_controller
dedent|''
name|'def'
name|'_setup_controller'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'controller'
op|'='
name|'sg_v3'
op|'.'
name|'ServerGroupController'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_app
dedent|''
name|'def'
name|'_get_app'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'fakes'
op|'.'
name|'wsgi_app_v3'
op|'('
name|'init_only'
op|'='
op|'('
string|"'os-server-groups'"
op|','
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_url
dedent|''
name|'def'
name|'_get_url'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
string|"'/v3'"
newline|'\n'
nl|'\n'
DECL|member|test_create_server_group_with_no_policies
dedent|''
name|'def'
name|'test_create_server_group_with_no_policies'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_server_group_normal
dedent|''
name|'def'
name|'test_create_server_group_normal'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
op|')'
newline|'\n'
name|'policies'
op|'='
op|'['
string|"'anti-affinity'"
op|']'
newline|'\n'
name|'sgroup'
op|'['
string|"'policies'"
op|']'
op|'='
name|'policies'
newline|'\n'
name|'res_dict'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|'('
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'res_dict'
op|'['
string|"'server_group'"
op|']'
op|'['
string|"'name'"
op|']'
op|','
string|"'test'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'uuidutils'
op|'.'
name|'is_uuid_like'
op|'('
name|'res_dict'
op|'['
string|"'server_group'"
op|']'
op|'['
string|"'id'"
op|']'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'res_dict'
op|'['
string|"'server_group'"
op|']'
op|'['
string|"'policies'"
op|']'
op|','
name|'policies'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_create_instance
dedent|''
name|'def'
name|'_create_instance'
op|'('
name|'self'
op|','
name|'context'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
name|'objects'
op|'.'
name|'Instance'
op|'('
name|'image_ref'
op|'='
number|'1'
op|','
name|'node'
op|'='
string|"'node1'"
op|','
nl|'\n'
name|'reservation_id'
op|'='
string|"'a'"
op|','
name|'host'
op|'='
string|"'host1'"
op|','
name|'project_id'
op|'='
string|"'fake'"
op|','
nl|'\n'
name|'vm_state'
op|'='
string|"'fake'"
op|','
name|'system_metadata'
op|'='
op|'{'
string|"'key'"
op|':'
string|"'value'"
op|'}'
op|')'
newline|'\n'
name|'instance'
op|'.'
name|'create'
op|'('
name|'context'
op|')'
newline|'\n'
name|'return'
name|'instance'
newline|'\n'
nl|'\n'
DECL|member|_create_instance_group
dedent|''
name|'def'
name|'_create_instance_group'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'members'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ig'
op|'='
name|'objects'
op|'.'
name|'InstanceGroup'
op|'('
name|'name'
op|'='
string|"'fake_name'"
op|','
nl|'\n'
name|'user_id'
op|'='
string|"'fake_user'"
op|','
name|'project_id'
op|'='
string|"'fake'"
op|','
nl|'\n'
name|'members'
op|'='
name|'members'
op|')'
newline|'\n'
name|'ig'
op|'.'
name|'create'
op|'('
name|'context'
op|')'
newline|'\n'
name|'return'
name|'ig'
op|'.'
name|'uuid'
newline|'\n'
nl|'\n'
DECL|member|_create_groups_and_instances
dedent|''
name|'def'
name|'_create_groups_and_instances'
op|'('
name|'self'
op|','
name|'ctx'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instances'
op|'='
op|'['
name|'self'
op|'.'
name|'_create_instance'
op|'('
name|'ctx'
op|')'
op|','
name|'self'
op|'.'
name|'_create_instance'
op|'('
name|'ctx'
op|')'
op|']'
newline|'\n'
name|'members'
op|'='
op|'['
name|'instance'
op|'.'
name|'uuid'
name|'for'
name|'instance'
name|'in'
name|'instances'
op|']'
newline|'\n'
name|'ig_uuid'
op|'='
name|'self'
op|'.'
name|'_create_instance_group'
op|'('
name|'ctx'
op|','
name|'members'
op|')'
newline|'\n'
name|'return'
op|'('
name|'ig_uuid'
op|','
name|'instances'
op|','
name|'members'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_display_members
dedent|''
name|'def'
name|'test_display_members'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ctx'
op|'='
name|'context'
op|'.'
name|'RequestContext'
op|'('
string|"'fake_user'"
op|','
string|"'fake'"
op|')'
newline|'\n'
op|'('
name|'ig_uuid'
op|','
name|'instances'
op|','
name|'members'
op|')'
op|'='
name|'self'
op|'.'
name|'_create_groups_and_instances'
op|'('
name|'ctx'
op|')'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'res_dict'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'show'
op|'('
name|'req'
op|','
name|'ig_uuid'
op|')'
newline|'\n'
name|'result_members'
op|'='
name|'res_dict'
op|'['
string|"'server_group'"
op|']'
op|'['
string|"'members'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'2'
op|','
name|'len'
op|'('
name|'result_members'
op|')'
op|')'
newline|'\n'
name|'for'
name|'member'
name|'in'
name|'members'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'member'
op|','
name|'result_members'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_display_active_members_only
dedent|''
dedent|''
name|'def'
name|'test_display_active_members_only'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ctx'
op|'='
name|'context'
op|'.'
name|'RequestContext'
op|'('
string|"'fake_user'"
op|','
string|"'fake'"
op|')'
newline|'\n'
op|'('
name|'ig_uuid'
op|','
name|'instances'
op|','
name|'members'
op|')'
op|'='
name|'self'
op|'.'
name|'_create_groups_and_instances'
op|'('
name|'ctx'
op|')'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
nl|'\n'
comment|'# delete an instance'
nl|'\n'
name|'instances'
op|'['
number|'1'
op|']'
op|'.'
name|'destroy'
op|'('
name|'ctx'
op|')'
newline|'\n'
comment|'# check that the instance does not exist'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'InstanceNotFound'
op|','
nl|'\n'
name|'objects'
op|'.'
name|'Instance'
op|'.'
name|'get_by_uuid'
op|','
nl|'\n'
name|'ctx'
op|','
name|'instances'
op|'['
number|'1'
op|']'
op|'.'
name|'uuid'
op|')'
newline|'\n'
name|'res_dict'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'show'
op|'('
name|'req'
op|','
name|'ig_uuid'
op|')'
newline|'\n'
name|'result_members'
op|'='
name|'res_dict'
op|'['
string|"'server_group'"
op|']'
op|'['
string|"'members'"
op|']'
newline|'\n'
comment|'# check that only the active instance is displayed'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'result_members'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'instances'
op|'['
number|'0'
op|']'
op|'.'
name|'uuid'
op|','
name|'result_members'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_server_group_with_illegal_name
dedent|''
name|'def'
name|'test_create_server_group_with_illegal_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# blank name'
nl|'\n'
indent|'        '
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
name|'name'
op|'='
string|"''"
op|','
name|'policies'
op|'='
op|'['
string|"'test_policy'"
op|']'
op|')'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# name with length 256'
nl|'\n'
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
name|'name'
op|'='
string|"'1234567890'"
op|'*'
number|'26'
op|','
nl|'\n'
name|'policies'
op|'='
op|'['
string|"'test_policy'"
op|']'
op|')'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# non-string name'
nl|'\n'
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
name|'name'
op|'='
number|'12'
op|','
name|'policies'
op|'='
op|'['
string|"'test_policy'"
op|']'
op|')'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# name with leading spaces'
nl|'\n'
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
name|'name'
op|'='
string|"'  leading spaces'"
op|','
nl|'\n'
name|'policies'
op|'='
op|'['
string|"'test_policy'"
op|']'
op|')'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# name with trailing spaces'
nl|'\n'
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
name|'name'
op|'='
string|"'trailing space '"
op|','
nl|'\n'
name|'policies'
op|'='
op|'['
string|"'test_policy'"
op|']'
op|')'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# name with all spaces'
nl|'\n'
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
name|'name'
op|'='
string|"'    '"
op|','
nl|'\n'
name|'policies'
op|'='
op|'['
string|"'test_policy'"
op|']'
op|')'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_server_group_with_illegal_policies
dedent|''
name|'def'
name|'test_create_server_group_with_illegal_policies'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# blank policy'
nl|'\n'
indent|'        '
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
name|'name'
op|'='
string|"'fake-name'"
op|','
name|'policies'
op|'='
string|"''"
op|')'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# policy as integer'
nl|'\n'
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
name|'name'
op|'='
string|"'fake-name'"
op|','
name|'policies'
op|'='
number|'7'
op|')'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# policy as string'
nl|'\n'
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
name|'name'
op|'='
string|"'fake-name'"
op|','
name|'policies'
op|'='
string|"'invalid'"
op|')'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# policy as None'
nl|'\n'
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
name|'name'
op|'='
string|"'fake-name'"
op|','
name|'policies'
op|'='
name|'None'
op|')'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_server_group_conflicting_policies
dedent|''
name|'def'
name|'test_create_server_group_conflicting_policies'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
op|')'
newline|'\n'
name|'policies'
op|'='
op|'['
string|"'anti-affinity'"
op|','
string|"'affinity'"
op|']'
newline|'\n'
name|'sgroup'
op|'['
string|"'policies'"
op|']'
op|'='
name|'policies'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_server_group_with_duplicate_policies
dedent|''
name|'def'
name|'test_create_server_group_with_duplicate_policies'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
op|')'
newline|'\n'
name|'policies'
op|'='
op|'['
string|"'affinity'"
op|','
string|"'affinity'"
op|']'
newline|'\n'
name|'sgroup'
op|'['
string|"'policies'"
op|']'
op|'='
name|'policies'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_server_group_not_supported
dedent|''
name|'def'
name|'test_create_server_group_not_supported'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'sgroup'
op|'='
name|'server_group_template'
op|'('
op|')'
newline|'\n'
name|'policies'
op|'='
op|'['
string|"'storage-affinity'"
op|','
string|"'anti-affinity'"
op|','
string|"'rack-affinity'"
op|']'
newline|'\n'
name|'sgroup'
op|'['
string|"'policies'"
op|']'
op|'='
name|'policies'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
nl|'\n'
name|'req'
op|','
op|'{'
string|"'server_group'"
op|':'
name|'sgroup'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_server_group_with_no_body
dedent|''
name|'def'
name|'test_create_server_group_with_no_body'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
nl|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
name|'req'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_server_group_with_no_server_group
dedent|''
name|'def'
name|'test_create_server_group_with_no_server_group'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
op|'{'
string|"'no-instanceGroup'"
op|':'
name|'None'
op|'}'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPBadRequest'
op|','
nl|'\n'
name|'self'
op|'.'
name|'controller'
op|'.'
name|'create'
op|','
name|'req'
op|','
name|'body'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_list_server_group_by_tenant
dedent|''
name|'def'
name|'test_list_server_group_by_tenant'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'groups'
op|'='
op|'['
op|']'
newline|'\n'
name|'policies'
op|'='
op|'['
string|"'anti-affinity'"
op|']'
newline|'\n'
name|'members'
op|'='
op|'['
op|']'
newline|'\n'
name|'metadata'
op|'='
op|'{'
op|'}'
comment|'# always empty'
newline|'\n'
name|'names'
op|'='
op|'['
string|"'default-x'"
op|','
string|"'test'"
op|']'
newline|'\n'
name|'sg1'
op|'='
name|'server_group_resp_template'
op|'('
name|'id'
op|'='
name|'str'
op|'('
number|'1345'
op|')'
op|','
nl|'\n'
name|'name'
op|'='
name|'names'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
name|'policies'
op|'='
name|'policies'
op|','
nl|'\n'
name|'members'
op|'='
name|'members'
op|','
nl|'\n'
name|'metadata'
op|'='
name|'metadata'
op|')'
newline|'\n'
name|'sg2'
op|'='
name|'server_group_resp_template'
op|'('
name|'id'
op|'='
name|'str'
op|'('
number|'891'
op|')'
op|','
nl|'\n'
name|'name'
op|'='
name|'names'
op|'['
number|'1'
op|']'
op|','
nl|'\n'
name|'policies'
op|'='
name|'policies'
op|','
nl|'\n'
name|'members'
op|'='
name|'members'
op|','
nl|'\n'
name|'metadata'
op|'='
name|'metadata'
op|')'
newline|'\n'
name|'groups'
op|'='
op|'['
name|'sg1'
op|','
name|'sg2'
op|']'
newline|'\n'
name|'expected'
op|'='
op|'{'
string|"'server_groups'"
op|':'
name|'groups'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|return_server_groups
name|'def'
name|'return_server_groups'
op|'('
name|'context'
op|','
name|'project_id'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'['
name|'server_group_db'
op|'('
name|'sg'
op|')'
name|'for'
name|'sg'
name|'in'
name|'groups'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'db'
op|','
string|"'instance_group_get_all_by_project_id'"
op|','
nl|'\n'
name|'return_server_groups'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups'"
op|')'
newline|'\n'
name|'res_dict'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'index'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'res_dict'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_list_server_group_all
dedent|''
name|'def'
name|'test_list_server_group_all'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'all_groups'
op|'='
op|'['
op|']'
newline|'\n'
name|'tenant_groups'
op|'='
op|'['
op|']'
newline|'\n'
name|'policies'
op|'='
op|'['
string|"'anti-affinity'"
op|']'
newline|'\n'
name|'members'
op|'='
op|'['
op|']'
newline|'\n'
name|'metadata'
op|'='
op|'{'
op|'}'
comment|'# always empty'
newline|'\n'
name|'names'
op|'='
op|'['
string|"'default-x'"
op|','
string|"'test'"
op|']'
newline|'\n'
name|'sg1'
op|'='
name|'server_group_resp_template'
op|'('
name|'id'
op|'='
name|'str'
op|'('
number|'1345'
op|')'
op|','
nl|'\n'
name|'name'
op|'='
name|'names'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
name|'policies'
op|'='
op|'['
op|']'
op|','
nl|'\n'
name|'members'
op|'='
name|'members'
op|','
nl|'\n'
name|'metadata'
op|'='
name|'metadata'
op|')'
newline|'\n'
name|'sg2'
op|'='
name|'server_group_resp_template'
op|'('
name|'id'
op|'='
name|'str'
op|'('
number|'891'
op|')'
op|','
nl|'\n'
name|'name'
op|'='
name|'names'
op|'['
number|'1'
op|']'
op|','
nl|'\n'
name|'policies'
op|'='
name|'policies'
op|','
nl|'\n'
name|'members'
op|'='
name|'members'
op|','
nl|'\n'
name|'metadata'
op|'='
op|'{'
op|'}'
op|')'
newline|'\n'
name|'tenant_groups'
op|'='
op|'['
name|'sg2'
op|']'
newline|'\n'
name|'all_groups'
op|'='
op|'['
name|'sg1'
op|','
name|'sg2'
op|']'
newline|'\n'
nl|'\n'
name|'all'
op|'='
op|'{'
string|"'server_groups'"
op|':'
name|'all_groups'
op|'}'
newline|'\n'
name|'tenant_specific'
op|'='
op|'{'
string|"'server_groups'"
op|':'
name|'tenant_groups'
op|'}'
newline|'\n'
nl|'\n'
DECL|function|return_all_server_groups
name|'def'
name|'return_all_server_groups'
op|'('
name|'context'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'['
name|'server_group_db'
op|'('
name|'sg'
op|')'
name|'for'
name|'sg'
name|'in'
name|'all_groups'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'db'
op|','
string|"'instance_group_get_all'"
op|','
nl|'\n'
name|'return_all_server_groups'
op|')'
newline|'\n'
nl|'\n'
DECL|function|return_tenant_server_groups
name|'def'
name|'return_tenant_server_groups'
op|'('
name|'context'
op|','
name|'project_id'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'['
name|'server_group_db'
op|'('
name|'sg'
op|')'
name|'for'
name|'sg'
name|'in'
name|'tenant_groups'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'db'
op|','
string|"'instance_group_get_all_by_project_id'"
op|','
nl|'\n'
name|'return_tenant_server_groups'
op|')'
newline|'\n'
nl|'\n'
name|'path'
op|'='
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
string|"'/os-server-groups?all_projects=True'"
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'path'
op|','
name|'use_admin_context'
op|'='
name|'True'
op|')'
newline|'\n'
name|'res_dict'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'index'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'res_dict'
op|','
name|'all'
op|')'
newline|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'path'
op|')'
newline|'\n'
name|'res_dict'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'index'
op|'('
name|'req'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'res_dict'
op|','
name|'tenant_specific'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_server_group_by_id
dedent|''
name|'def'
name|'test_delete_server_group_by_id'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'sg'
op|'='
name|'server_group_template'
op|'('
name|'id'
op|'='
string|"'123'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'called'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|function|server_group_delete
name|'def'
name|'server_group_delete'
op|'('
name|'context'
op|','
name|'id'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'called'
op|'='
name|'True'
newline|'\n'
nl|'\n'
DECL|function|return_server_group
dedent|''
name|'def'
name|'return_server_group'
op|'('
name|'context'
op|','
name|'group_id'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'sg'
op|'['
string|"'id'"
op|']'
op|','
name|'group_id'
op|')'
newline|'\n'
name|'return'
name|'server_group_db'
op|'('
name|'sg'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'db'
op|','
string|"'instance_group_delete'"
op|','
nl|'\n'
name|'server_group_delete'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'nova'
op|'.'
name|'db'
op|','
string|"'instance_group_get'"
op|','
nl|'\n'
name|'return_server_group'
op|')'
newline|'\n'
nl|'\n'
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
nl|'\n'
string|"'/os-server-groups/123'"
op|')'
newline|'\n'
name|'resp'
op|'='
name|'self'
op|'.'
name|'controller'
op|'.'
name|'delete'
op|'('
name|'req'
op|','
string|"'123'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'self'
op|'.'
name|'called'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'resp'
op|'.'
name|'status_int'
op|','
number|'204'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_non_existing_server_group
dedent|''
name|'def'
name|'test_delete_non_existing_server_group'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'fakes'
op|'.'
name|'HTTPRequest'
op|'.'
name|'blank'
op|'('
name|'self'
op|'.'
name|'_get_url'
op|'('
op|')'
op|'+'
nl|'\n'
string|"'/os-server-groups/invalid'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'webob'
op|'.'
name|'exc'
op|'.'
name|'HTTPNotFound'
op|','
name|'self'
op|'.'
name|'controller'
op|'.'
name|'delete'
op|','
nl|'\n'
name|'req'
op|','
string|"'invalid'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ServerGroupTestV2
dedent|''
dedent|''
name|'class'
name|'ServerGroupTestV2'
op|'('
name|'ServerGroupTestV21'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|_setup_controller
indent|'    '
name|'def'
name|'_setup_controller'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ext_mgr'
op|'='
name|'extensions'
op|'.'
name|'ExtensionManager'
op|'('
op|')'
newline|'\n'
name|'ext_mgr'
op|'.'
name|'extensions'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'controller'
op|'='
name|'server_groups'
op|'.'
name|'ServerGroupController'
op|'('
name|'ext_mgr'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_app
dedent|''
name|'def'
name|'_get_app'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'fakes'
op|'.'
name|'wsgi_app'
op|'('
name|'init_only'
op|'='
op|'('
string|"'os-server-groups'"
op|','
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_url
dedent|''
name|'def'
name|'_get_url'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
string|"'/v2/fake'"
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestServerGroupXMLDeserializer
dedent|''
dedent|''
name|'class'
name|'TestServerGroupXMLDeserializer'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'TestServerGroupXMLDeserializer'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'deserializer'
op|'='
name|'server_groups'
op|'.'
name|'ServerGroupXMLDeserializer'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_request
dedent|''
name|'def'
name|'test_create_request'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'serial_request'
op|'='
string|'"""\n<server_group name="test">\n</server_group>"""'
newline|'\n'
name|'request'
op|'='
name|'self'
op|'.'
name|'deserializer'
op|'.'
name|'deserialize'
op|'('
name|'serial_request'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|'"server_group"'
op|':'
op|'{'
nl|'\n'
string|'"name"'
op|':'
string|'"test"'
op|','
nl|'\n'
string|'"policies"'
op|':'
op|'['
op|']'
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'request'
op|'['
string|"'body'"
op|']'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
DECL|function|test_update_request
dedent|''
name|'def'
name|'test_update_request'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'serial_request'
op|'='
string|'"""\n<server_group name="test">\n<policies>\n<policy>policy-1</policy>\n<policy>policy-2</policy>\n</policies>\n</server_group>"""'
newline|'\n'
name|'request'
op|'='
name|'self'
op|'.'
name|'deserializer'
op|'.'
name|'deserialize'
op|'('
name|'serial_request'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|'"server_group"'
op|':'
op|'{'
nl|'\n'
string|'"name"'
op|':'
string|"'test'"
op|','
nl|'\n'
string|'"policies"'
op|':'
op|'['
string|"'policy-1'"
op|','
string|"'policy-2'"
op|']'
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'request'
op|'['
string|"'body'"
op|']'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
DECL|function|test_create_request_no_name
dedent|''
name|'def'
name|'test_create_request_no_name'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'serial_request'
op|'='
string|'"""\n<server_group>\n</server_group>"""'
newline|'\n'
name|'request'
op|'='
name|'self'
op|'.'
name|'deserializer'
op|'.'
name|'deserialize'
op|'('
name|'serial_request'
op|')'
newline|'\n'
name|'expected'
op|'='
op|'{'
nl|'\n'
string|'"server_group"'
op|':'
op|'{'
nl|'\n'
string|'"policies"'
op|':'
op|'['
op|']'
nl|'\n'
op|'}'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'request'
op|'['
string|"'body'"
op|']'
op|','
name|'expected'
op|')'
newline|'\n'
nl|'\n'
DECL|function|test_corrupt_xml
dedent|''
name|'def'
name|'test_corrupt_xml'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Should throw a 400 error on corrupt xml."""'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
nl|'\n'
name|'exception'
op|'.'
name|'MalformedRequestBody'
op|','
nl|'\n'
name|'self'
op|'.'
name|'deserializer'
op|'.'
name|'deserialize'
op|','
nl|'\n'
name|'utils'
op|'.'
name|'killer_xml_body'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|TestServerGroupXMLSerializer
dedent|''
dedent|''
name|'class'
name|'TestServerGroupXMLSerializer'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'TestServerGroupXMLSerializer'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'namespace'
op|'='
name|'wsgi'
op|'.'
name|'XMLNS_V11'
newline|'\n'
name|'self'
op|'.'
name|'index_serializer'
op|'='
name|'server_groups'
op|'.'
name|'ServerGroupsTemplate'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'default_serializer'
op|'='
name|'server_groups'
op|'.'
name|'ServerGroupTemplate'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_tag
dedent|''
name|'def'
name|'_tag'
op|'('
name|'self'
op|','
name|'elem'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'tagname'
op|'='
name|'elem'
op|'.'
name|'tag'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'tagname'
op|'['
number|'0'
op|']'
op|','
string|"'{'"
op|')'
newline|'\n'
name|'tmp'
op|'='
name|'tagname'
op|'.'
name|'partition'
op|'('
string|"'}'"
op|')'
newline|'\n'
name|'namespace'
op|'='
name|'tmp'
op|'['
number|'0'
op|']'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'namespace'
op|','
name|'self'
op|'.'
name|'namespace'
op|')'
newline|'\n'
name|'return'
name|'tmp'
op|'['
number|'2'
op|']'
newline|'\n'
nl|'\n'
DECL|member|_verify_server_group
dedent|''
name|'def'
name|'_verify_server_group'
op|'('
name|'self'
op|','
name|'raw_group'
op|','
name|'tree'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policies'
op|'='
name|'raw_group'
op|'['
string|"'policies'"
op|']'
newline|'\n'
name|'members'
op|'='
name|'raw_group'
op|'['
string|"'members'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'server_group'"
op|','
name|'self'
op|'.'
name|'_tag'
op|'('
name|'tree'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'raw_group'
op|'['
string|"'id'"
op|']'
op|','
name|'tree'
op|'.'
name|'get'
op|'('
string|"'id'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'raw_group'
op|'['
string|"'name'"
op|']'
op|','
name|'tree'
op|'.'
name|'get'
op|'('
string|"'name'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'3'
op|','
name|'len'
op|'('
name|'tree'
op|')'
op|')'
newline|'\n'
name|'for'
name|'child'
name|'in'
name|'tree'
op|':'
newline|'\n'
indent|'            '
name|'child_tag'
op|'='
name|'self'
op|'.'
name|'_tag'
op|'('
name|'child'
op|')'
newline|'\n'
name|'if'
name|'child_tag'
op|'=='
string|"'policies'"
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'policies'
op|')'
op|','
name|'len'
op|'('
name|'child'
op|')'
op|')'
newline|'\n'
name|'for'
name|'idx'
op|','
name|'gr_child'
name|'in'
name|'enumerate'
op|'('
name|'child'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_tag'
op|'('
name|'gr_child'
op|')'
op|','
string|"'policy'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'policies'
op|'['
name|'idx'
op|']'
op|','
nl|'\n'
name|'gr_child'
op|'.'
name|'text'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'child_tag'
op|'=='
string|"'members'"
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'members'
op|')'
op|','
name|'len'
op|'('
name|'child'
op|')'
op|')'
newline|'\n'
name|'for'
name|'idx'
op|','
name|'gr_child'
name|'in'
name|'enumerate'
op|'('
name|'child'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'_tag'
op|'('
name|'gr_child'
op|')'
op|','
string|"'member'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'members'
op|'['
name|'idx'
op|']'
op|','
nl|'\n'
name|'gr_child'
op|'.'
name|'text'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'elif'
name|'child_tag'
op|'=='
string|"'metadata'"
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'len'
op|'('
name|'child'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_verify_server_group_brief
dedent|''
dedent|''
dedent|''
name|'def'
name|'_verify_server_group_brief'
op|'('
name|'self'
op|','
name|'raw_group'
op|','
name|'tree'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'server_group'"
op|','
name|'self'
op|'.'
name|'_tag'
op|'('
name|'tree'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'raw_group'
op|'['
string|"'id'"
op|']'
op|','
name|'tree'
op|'.'
name|'get'
op|'('
string|"'id'"
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'raw_group'
op|'['
string|"'name'"
op|']'
op|','
name|'tree'
op|'.'
name|'get'
op|'('
string|"'name'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_group_serializer
dedent|''
name|'def'
name|'test_group_serializer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policies'
op|'='
op|'['
string|'"policy-1"'
op|','
string|'"policy-2"'
op|']'
newline|'\n'
name|'members'
op|'='
op|'['
string|'"1"'
op|','
string|'"2"'
op|']'
newline|'\n'
name|'raw_group'
op|'='
name|'dict'
op|'('
nl|'\n'
name|'id'
op|'='
string|"'890'"
op|','
nl|'\n'
name|'name'
op|'='
string|"'name'"
op|','
nl|'\n'
name|'policies'
op|'='
name|'policies'
op|','
nl|'\n'
name|'members'
op|'='
name|'members'
op|')'
newline|'\n'
name|'sg_group'
op|'='
name|'dict'
op|'('
name|'server_group'
op|'='
name|'raw_group'
op|')'
newline|'\n'
name|'text'
op|'='
name|'self'
op|'.'
name|'default_serializer'
op|'.'
name|'serialize'
op|'('
name|'sg_group'
op|')'
newline|'\n'
nl|'\n'
name|'tree'
op|'='
name|'etree'
op|'.'
name|'fromstring'
op|'('
name|'text'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_verify_server_group'
op|'('
name|'raw_group'
op|','
name|'tree'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_groups_serializer
dedent|''
name|'def'
name|'test_groups_serializer'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'policies'
op|'='
op|'['
string|'"policy-1"'
op|','
string|'"policy-2"'
op|','
nl|'\n'
string|'"policy-3"'
op|']'
newline|'\n'
name|'members'
op|'='
op|'['
string|'"1"'
op|','
string|'"2"'
op|','
string|'"3"'
op|']'
newline|'\n'
name|'groups'
op|'='
op|'['
name|'dict'
op|'('
nl|'\n'
name|'id'
op|'='
string|"'890'"
op|','
nl|'\n'
name|'name'
op|'='
string|"'test'"
op|','
nl|'\n'
name|'policies'
op|'='
name|'policies'
op|'['
number|'0'
op|':'
number|'2'
op|']'
op|','
nl|'\n'
name|'members'
op|'='
name|'members'
op|'['
number|'0'
op|':'
number|'2'
op|']'
op|')'
op|','
nl|'\n'
name|'dict'
op|'('
nl|'\n'
name|'id'
op|'='
string|"'123'"
op|','
nl|'\n'
name|'name'
op|'='
string|"'default'"
op|','
nl|'\n'
name|'policies'
op|'='
name|'policies'
op|'['
number|'2'
op|':'
op|']'
op|','
nl|'\n'
name|'members'
op|'='
name|'members'
op|'['
number|'2'
op|':'
op|']'
op|')'
op|']'
newline|'\n'
name|'sg_groups'
op|'='
name|'dict'
op|'('
name|'server_groups'
op|'='
name|'groups'
op|')'
newline|'\n'
name|'text'
op|'='
name|'self'
op|'.'
name|'index_serializer'
op|'.'
name|'serialize'
op|'('
name|'sg_groups'
op|')'
newline|'\n'
nl|'\n'
name|'tree'
op|'='
name|'etree'
op|'.'
name|'fromstring'
op|'('
name|'text'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'server_groups'"
op|','
name|'self'
op|'.'
name|'_tag'
op|'('
name|'tree'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'len'
op|'('
name|'groups'
op|')'
op|','
name|'len'
op|'('
name|'tree'
op|')'
op|')'
newline|'\n'
name|'for'
name|'idx'
op|','
name|'child'
name|'in'
name|'enumerate'
op|'('
name|'tree'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_verify_server_group_brief'
op|'('
name|'groups'
op|'['
name|'idx'
op|']'
op|','
name|'child'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
endmarker|''
end_unit
