begin_unit
comment|'# vim: tabstop=4 shiftwidth=4 softtabstop=4'
nl|'\n'
nl|'\n'
comment|'# Copyright 2010 United States Government as represented by the'
nl|'\n'
comment|'# Administrator of the National Aeronautics and Space Administration.'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
string|'"""Tests for api.ec2.admin"""'
newline|'\n'
nl|'\n'
name|'import'
name|'datetime'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'context'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'db'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'flags'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'utils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'api'
op|'.'
name|'ec2'
name|'import'
name|'admin'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'api'
op|'.'
name|'ec2'
name|'import'
name|'ec2utils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'cloudpipe'
name|'import'
name|'pipelib'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'compute'
name|'import'
name|'vm_states'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|AdminTestCase
name|'class'
name|'AdminTestCase'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'AdminTestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'utils'
op|','
string|"'vpn_ping'"
op|','
nl|'\n'
name|'lambda'
name|'address'
op|','
name|'port'
op|':'
name|'address'
op|'=='
string|"'127.0.0.1'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_user_dict
dedent|''
name|'def'
name|'test_user_dict'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|'='
name|'type'
op|'('
string|"'User'"
op|','
op|'('
name|'object'
op|','
op|')'
op|','
nl|'\n'
op|'{'
string|"'id'"
op|':'
string|"'bob'"
op|','
string|"'access'"
op|':'
string|"'foo'"
op|','
string|"'secret'"
op|':'
string|"'bar'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'expected_user_dict'
op|'='
op|'{'
string|"'username'"
op|':'
string|"'bob'"
op|','
nl|'\n'
string|"'accesskey'"
op|':'
string|"'foo'"
op|','
nl|'\n'
string|"'secretkey'"
op|':'
string|"'bar'"
op|','
nl|'\n'
string|"'file'"
op|':'
string|"'filename'"
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_user_dict'
op|','
name|'admin'
op|'.'
name|'user_dict'
op|'('
name|'user'
op|','
string|"'filename'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_user_dict_no_file
dedent|''
name|'def'
name|'test_user_dict_no_file'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'user'
op|'='
name|'type'
op|'('
string|"'User'"
op|','
op|'('
name|'object'
op|','
op|')'
op|','
nl|'\n'
op|'{'
string|"'id'"
op|':'
string|"'bob'"
op|','
string|"'access'"
op|':'
string|"'foo'"
op|','
string|"'secret'"
op|':'
string|"'bar'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'expected_user_dict'
op|'='
op|'{'
string|"'username'"
op|':'
string|"'bob'"
op|','
nl|'\n'
string|"'accesskey'"
op|':'
string|"'foo'"
op|','
nl|'\n'
string|"'secretkey'"
op|':'
string|"'bar'"
op|','
nl|'\n'
string|"'file'"
op|':'
name|'None'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_user_dict'
op|','
name|'admin'
op|'.'
name|'user_dict'
op|'('
name|'user'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_user_dict_no_user
dedent|''
name|'def'
name|'test_user_dict_no_user'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'{'
op|'}'
op|','
name|'admin'
op|'.'
name|'user_dict'
op|'('
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_project_dict
dedent|''
name|'def'
name|'test_project_dict'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'project'
op|'='
name|'type'
op|'('
string|"'Project'"
op|','
op|'('
name|'object'
op|','
op|')'
op|','
op|'{'
string|"'id'"
op|':'
string|"'project'"
op|','
nl|'\n'
string|"'project_manager_id'"
op|':'
string|"'foo'"
op|','
nl|'\n'
string|"'description'"
op|':'
string|"'bar'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'expected_project_dict'
op|'='
op|'{'
string|"'projectname'"
op|':'
string|"'project'"
op|','
nl|'\n'
string|"'project_manager_id'"
op|':'
string|"'foo'"
op|','
nl|'\n'
string|"'description'"
op|':'
string|"'bar'"
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_project_dict'
op|','
name|'admin'
op|'.'
name|'project_dict'
op|'('
name|'project'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_project_dict_no_project
dedent|''
name|'def'
name|'test_project_dict_no_project'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'{'
op|'}'
op|','
name|'admin'
op|'.'
name|'project_dict'
op|'('
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_host_dict_using_updated_at
dedent|''
name|'def'
name|'test_host_dict_using_updated_at'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# instances and volumes only used for count'
nl|'\n'
indent|'        '
name|'instances'
op|'='
name|'range'
op|'('
number|'2'
op|')'
newline|'\n'
name|'volumes'
op|'='
name|'range'
op|'('
number|'3'
op|')'
newline|'\n'
nl|'\n'
name|'now'
op|'='
name|'datetime'
op|'.'
name|'datetime'
op|'.'
name|'now'
op|'('
op|')'
newline|'\n'
name|'updated_at'
op|'='
name|'now'
op|'-'
name|'datetime'
op|'.'
name|'timedelta'
op|'('
name|'seconds'
op|'='
number|'10'
op|')'
newline|'\n'
name|'compute_service'
op|'='
op|'{'
string|"'updated_at'"
op|':'
name|'updated_at'
op|'}'
newline|'\n'
name|'volume_service'
op|'='
op|'{'
string|"'updated_at'"
op|':'
name|'updated_at'
op|'}'
newline|'\n'
nl|'\n'
name|'expected_host_dict'
op|'='
op|'{'
string|"'hostname'"
op|':'
string|"'server'"
op|','
nl|'\n'
string|"'instance_count'"
op|':'
number|'2'
op|','
nl|'\n'
string|"'volume_count'"
op|':'
number|'3'
op|','
nl|'\n'
string|"'compute'"
op|':'
string|"'up'"
op|','
nl|'\n'
string|"'volume'"
op|':'
string|"'up'"
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_host_dict'
op|','
nl|'\n'
name|'admin'
op|'.'
name|'host_dict'
op|'('
string|"'server'"
op|','
name|'compute_service'
op|','
name|'instances'
op|','
nl|'\n'
name|'volume_service'
op|','
name|'volumes'
op|','
name|'now'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_host_dict_service_down_using_created_at
dedent|''
name|'def'
name|'test_host_dict_service_down_using_created_at'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
comment|'# instances and volumes only used for count'
nl|'\n'
indent|'        '
name|'instances'
op|'='
name|'range'
op|'('
number|'2'
op|')'
newline|'\n'
name|'volumes'
op|'='
name|'range'
op|'('
number|'3'
op|')'
newline|'\n'
nl|'\n'
comment|'# service_down_time is 60 by defualt so we set to 70 to simulate'
nl|'\n'
comment|'# services been down'
nl|'\n'
name|'now'
op|'='
name|'datetime'
op|'.'
name|'datetime'
op|'.'
name|'now'
op|'('
op|')'
newline|'\n'
name|'created_at'
op|'='
name|'now'
op|'-'
name|'datetime'
op|'.'
name|'timedelta'
op|'('
name|'seconds'
op|'='
number|'70'
op|')'
newline|'\n'
name|'compute_service'
op|'='
op|'{'
string|"'created_at'"
op|':'
name|'created_at'
op|','
string|"'updated_at'"
op|':'
name|'None'
op|'}'
newline|'\n'
name|'volume_service'
op|'='
op|'{'
string|"'created_at'"
op|':'
name|'created_at'
op|','
string|"'updated_at'"
op|':'
name|'None'
op|'}'
newline|'\n'
nl|'\n'
name|'expected_host_dict'
op|'='
op|'{'
string|"'hostname'"
op|':'
string|"'server'"
op|','
nl|'\n'
string|"'instance_count'"
op|':'
number|'2'
op|','
nl|'\n'
string|"'volume_count'"
op|':'
number|'3'
op|','
nl|'\n'
string|"'compute'"
op|':'
string|"'down'"
op|','
nl|'\n'
string|"'volume'"
op|':'
string|"'down'"
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_host_dict'
op|','
nl|'\n'
name|'admin'
op|'.'
name|'host_dict'
op|'('
string|"'server'"
op|','
name|'compute_service'
op|','
name|'instances'
op|','
nl|'\n'
name|'volume_service'
op|','
name|'volumes'
op|','
name|'now'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_instance_dict
dedent|''
name|'def'
name|'test_instance_dict'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'inst'
op|'='
op|'{'
string|"'name'"
op|':'
string|"'this_inst'"
op|','
nl|'\n'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'vcpus'"
op|':'
number|'2'
op|','
nl|'\n'
string|"'local_gb'"
op|':'
number|'500'
op|','
nl|'\n'
string|"'flavorid'"
op|':'
number|'1'
op|'}'
newline|'\n'
nl|'\n'
name|'expected_inst_dict'
op|'='
op|'{'
string|"'name'"
op|':'
string|"'this_inst'"
op|','
nl|'\n'
string|"'memory_mb'"
op|':'
number|'1024'
op|','
nl|'\n'
string|"'vcpus'"
op|':'
number|'2'
op|','
nl|'\n'
string|"'disk_gb'"
op|':'
number|'500'
op|','
nl|'\n'
string|"'flavor_id'"
op|':'
number|'1'
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_inst_dict'
op|','
name|'admin'
op|'.'
name|'instance_dict'
op|'('
name|'inst'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vpn_dict_state_running
dedent|''
name|'def'
name|'test_vpn_dict_state_running'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'isonow'
op|'='
name|'datetime'
op|'.'
name|'datetime'
op|'.'
name|'utcnow'
op|'('
op|')'
newline|'\n'
name|'vpn_instance'
op|'='
op|'{'
string|"'id'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'created_at'"
op|':'
name|'isonow'
op|','
nl|'\n'
string|"'fixed_ip'"
op|':'
op|'{'
string|"'address'"
op|':'
string|"'127.0.0.1'"
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'project'
op|'='
name|'type'
op|'('
string|"'Project'"
op|','
op|'('
name|'object'
op|','
op|')'
op|','
op|'{'
string|"'id'"
op|':'
string|"'project'"
op|','
nl|'\n'
string|"'vpn_ip'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'vpn_port'"
op|':'
number|'1234'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# Returns state running for 127.0.0.1 - look at class setup'
nl|'\n'
name|'expected_vpn_dict'
op|'='
op|'{'
string|"'project_id'"
op|':'
string|"'project'"
op|','
nl|'\n'
string|"'public_ip'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'public_port'"
op|':'
number|'1234'
op|','
nl|'\n'
string|"'internal_ip'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'instance_id'"
op|':'
nl|'\n'
name|'ec2utils'
op|'.'
name|'id_to_ec2_id'
op|'('
number|'1'
op|')'
op|','
nl|'\n'
string|"'created_at'"
op|':'
name|'utils'
op|'.'
name|'isotime'
op|'('
name|'isonow'
op|')'
op|','
nl|'\n'
string|"'state'"
op|':'
string|"'running'"
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_vpn_dict'
op|','
nl|'\n'
name|'admin'
op|'.'
name|'vpn_dict'
op|'('
name|'project'
op|','
name|'vpn_instance'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vpn_dict_state_down
dedent|''
name|'def'
name|'test_vpn_dict_state_down'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'isonow'
op|'='
name|'datetime'
op|'.'
name|'datetime'
op|'.'
name|'utcnow'
op|'('
op|')'
newline|'\n'
name|'vpn_instance'
op|'='
op|'{'
string|"'id'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'created_at'"
op|':'
name|'isonow'
op|','
nl|'\n'
string|"'fixed_ip'"
op|':'
op|'{'
string|"'address'"
op|':'
string|"'127.0.0.1'"
op|'}'
op|'}'
newline|'\n'
nl|'\n'
name|'project'
op|'='
name|'type'
op|'('
string|"'Project'"
op|','
op|'('
name|'object'
op|','
op|')'
op|','
op|'{'
string|"'id'"
op|':'
string|"'project'"
op|','
nl|'\n'
string|"'vpn_ip'"
op|':'
string|"'127.0.0.2'"
op|','
nl|'\n'
string|"'vpn_port'"
op|':'
number|'1234'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# Returns state down for 127.0.0.2 - look at class setup'
nl|'\n'
name|'vpn_dict'
op|'='
name|'admin'
op|'.'
name|'vpn_dict'
op|'('
name|'project'
op|','
name|'vpn_instance'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'down'"
op|','
name|'vpn_dict'
op|'['
string|"'state'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vpn_dict_invalid_project_vpn_config
dedent|''
name|'def'
name|'test_vpn_dict_invalid_project_vpn_config'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'isonow'
op|'='
name|'datetime'
op|'.'
name|'datetime'
op|'.'
name|'utcnow'
op|'('
op|')'
newline|'\n'
name|'vpn_instance'
op|'='
op|'{'
string|"'id'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'created_at'"
op|':'
name|'isonow'
op|','
nl|'\n'
string|"'fixed_ip'"
op|':'
op|'{'
string|"'address'"
op|':'
string|"'127.0.0.1'"
op|'}'
op|'}'
newline|'\n'
nl|'\n'
comment|'# Inline project object - vpn_port of None to make it invalid'
nl|'\n'
name|'project'
op|'='
name|'type'
op|'('
string|"'Project'"
op|','
op|'('
name|'object'
op|','
op|')'
op|','
op|'{'
string|"'id'"
op|':'
string|"'project'"
op|','
nl|'\n'
string|"'vpn_ip'"
op|':'
string|"'127.0.0.2'"
op|','
nl|'\n'
string|"'vpn_port'"
op|':'
name|'None'
op|'}'
op|')'
newline|'\n'
nl|'\n'
comment|'# Returns state down for 127.0.0.2 - look at class setup'
nl|'\n'
name|'vpn_dict'
op|'='
name|'admin'
op|'.'
name|'vpn_dict'
op|'('
name|'project'
op|','
name|'vpn_instance'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'down - invalid project vpn config'"
op|','
nl|'\n'
name|'vpn_dict'
op|'['
string|"'state'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_vpn_dict_non_vpn_instance
dedent|''
name|'def'
name|'test_vpn_dict_non_vpn_instance'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'project'
op|'='
name|'type'
op|'('
string|"'Project'"
op|','
op|'('
name|'object'
op|','
op|')'
op|','
op|'{'
string|"'id'"
op|':'
string|"'project'"
op|','
nl|'\n'
string|"'vpn_ip'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'vpn_port'"
op|':'
string|"'1234'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
name|'expected_vpn_dict'
op|'='
op|'{'
string|"'project_id'"
op|':'
string|"'project'"
op|','
nl|'\n'
string|"'public_ip'"
op|':'
string|"'127.0.0.1'"
op|','
nl|'\n'
string|"'public_port'"
op|':'
string|"'1234'"
op|','
nl|'\n'
string|"'state'"
op|':'
string|"'pending'"
op|'}'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'expected_vpn_dict'
op|','
name|'admin'
op|'.'
name|'vpn_dict'
op|'('
name|'project'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|AdminControllerTestCase
dedent|''
dedent|''
name|'class'
name|'AdminControllerTestCase'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
op|'@'
name|'classmethod'
newline|'\n'
DECL|member|setUpClass
name|'def'
name|'setUpClass'
op|'('
name|'cls'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cls'
op|'.'
name|'_c'
op|'='
name|'context'
op|'.'
name|'get_admin_context'
op|'('
op|')'
newline|'\n'
name|'cls'
op|'.'
name|'_ac'
op|'='
name|'admin'
op|'.'
name|'AdminController'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_admin_controller_to_str
dedent|''
name|'def'
name|'test_admin_controller_to_str'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'AdminController'"
op|','
name|'str'
op|'('
name|'admin'
op|'.'
name|'AdminController'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_describe_instance_types
dedent|''
name|'def'
name|'test_describe_instance_types'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'insts'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_instance_types'
op|'('
name|'self'
op|'.'
name|'_c'
op|')'
op|'['
string|"'instanceTypeSet'"
op|']'
newline|'\n'
name|'for'
name|'inst_name'
name|'in'
op|'('
string|"'m1.medium'"
op|','
string|"'m1.large'"
op|','
string|"'m1.tiny'"
op|','
string|"'m1.xlarge'"
op|','
nl|'\n'
string|"'m1.small'"
op|','
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertIn'
op|'('
name|'inst_name'
op|','
op|'['
name|'i'
op|'['
string|"'name'"
op|']'
name|'for'
name|'i'
name|'in'
name|'insts'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_register_user
dedent|''
dedent|''
name|'def'
name|'test_register_user'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'registered_user'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'bob'"
op|','
name|'registered_user'
op|'['
string|"'username'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_describe_user
dedent|''
name|'def'
name|'test_describe_user'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'bob'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
op|'['
string|"'username'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_describe_users
dedent|''
name|'def'
name|'test_describe_users'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'users'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_users'
op|'('
name|'self'
op|'.'
name|'_c'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'userSet'"
op|','
name|'users'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'bob'"
op|','
name|'users'
op|'['
string|"'userSet'"
op|']'
op|'['
number|'0'
op|']'
op|'['
string|"'username'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_deregister_user
dedent|''
name|'def'
name|'test_deregister_user'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'deregister_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'UserNotFound'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_user'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_register_project
dedent|''
name|'def'
name|'test_register_project'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'bobs_project'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
nl|'\n'
string|"'bobs_project'"
op|','
nl|'\n'
string|"'bob'"
op|')'
op|'['
string|"'projectname'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_describe_projects
dedent|''
name|'def'
name|'test_describe_projects'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'projects'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_projects'
op|'('
name|'self'
op|'.'
name|'_c'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'projectSet'"
op|','
name|'projects'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'bobs_project'"
op|','
nl|'\n'
name|'projects'
op|'['
string|"'projectSet'"
op|']'
op|'['
number|'0'
op|']'
op|'['
string|"'projectname'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_deregister_project
dedent|''
name|'def'
name|'test_deregister_project'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'deregister_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'ProjectNotFound'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_project'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_describe_project_members
dedent|''
name|'def'
name|'test_describe_project_members'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'members'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_project_members'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'members'"
op|','
name|'members'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'bob'"
op|','
name|'members'
op|'['
string|"'members'"
op|']'
op|'['
number|'0'
op|']'
op|'['
string|"'member'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_modify_project
dedent|''
name|'def'
name|'test_modify_project'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'modify_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|','
nl|'\n'
name|'description'
op|'='
string|"'I like cake'"
op|')'
newline|'\n'
name|'project'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'I like cake'"
op|','
name|'project'
op|'['
string|"'description'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_modify_project_member_add
dedent|''
name|'def'
name|'test_modify_project_member_add'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'mary'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'modify_project_member'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'mary'"
op|','
string|"'bobs_project'"
op|','
string|"'add'"
op|')'
newline|'\n'
name|'members'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_project_members'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'mary'"
op|','
op|'['
name|'m'
op|'['
string|"'member'"
op|']'
name|'for'
name|'m'
name|'in'
name|'members'
op|'['
string|"'members'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_modify_project_member_remove
dedent|''
name|'def'
name|'test_modify_project_member_remove'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'modify_project_member'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|','
string|"'bobs_project'"
op|','
nl|'\n'
string|"'remove'"
op|')'
newline|'\n'
name|'members'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_project_members'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
string|"'bob'"
op|','
op|'['
name|'m'
op|'['
string|"'member'"
op|']'
name|'for'
name|'m'
name|'in'
name|'members'
op|'['
string|"'members'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_modify_project_member_invalid_operation
dedent|''
name|'def'
name|'test_modify_project_member_invalid_operation'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'ApiError'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'modify_project_member'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|','
string|"'bobs_project'"
op|','
string|"'invalid_operation'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_describe_roles
dedent|''
name|'def'
name|'test_describe_roles'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'roles'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_roles'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|')'
newline|'\n'
nl|'\n'
comment|"# Default roles ('sysadmin', 'netadmin', 'developer') should be in here"
nl|'\n'
name|'roles'
op|'='
op|'['
name|'r'
op|'['
string|"'role'"
op|']'
name|'for'
name|'r'
name|'in'
name|'roles'
op|'['
string|"'roles'"
op|']'
op|']'
newline|'\n'
name|'for'
name|'role'
name|'in'
op|'('
string|"'sysadmin'"
op|','
string|"'netadmin'"
op|','
string|"'developer'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'sysadmin'"
op|','
name|'roles'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_modify_user_role_add
dedent|''
dedent|''
name|'def'
name|'test_modify_user_role_add'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'modify_user_role'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|','
string|"'itsec'"
op|')'
newline|'\n'
name|'user_roles'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_user_roles'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'itsec'"
op|','
op|'['
name|'r'
op|'['
string|"'role'"
op|']'
name|'for'
name|'r'
name|'in'
name|'user_roles'
op|'['
string|"'roles'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_modify_user_role_project_add
dedent|''
name|'def'
name|'test_modify_user_role_project_add'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'modify_user_role'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|','
string|"'developer'"
op|','
string|"'bobs_project'"
op|')'
newline|'\n'
name|'user_roles'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_user_roles'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|','
nl|'\n'
string|"'bobs_project'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'developer'"
op|','
op|'['
name|'r'
op|'['
string|"'role'"
op|']'
name|'for'
name|'r'
name|'in'
name|'user_roles'
op|'['
string|"'roles'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_modify_user_role_remove
dedent|''
name|'def'
name|'test_modify_user_role_remove'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'modify_user_role'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|','
string|"'itsec'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'modify_user_role'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|','
string|"'itsec'"
op|','
name|'operation'
op|'='
string|"'remove'"
op|')'
newline|'\n'
name|'user_roles'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_user_roles'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
string|"'itsec'"
op|','
op|'['
name|'r'
op|'['
string|"'role'"
op|']'
name|'for'
name|'r'
name|'in'
name|'user_roles'
op|'['
string|"'roles'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_modify_user_role_project_remove
dedent|''
name|'def'
name|'test_modify_user_role_project_remove'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'modify_user_role'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|','
string|"'developer'"
op|','
string|"'bobs_project'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'modify_user_role'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|','
string|"'developer'"
op|','
string|"'bobs_project'"
op|','
nl|'\n'
string|"'remove'"
op|')'
newline|'\n'
name|'user_roles'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_user_roles'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|','
nl|'\n'
string|"'bobs_project'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertNotIn'
op|'('
string|"'developer'"
op|','
op|'['
name|'r'
op|'['
string|"'role'"
op|']'
name|'for'
name|'r'
name|'in'
name|'user_roles'
op|'['
string|"'roles'"
op|']'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_modify_user_role_invalid
dedent|''
name|'def'
name|'test_modify_user_role_invalid'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'ApiError'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'modify_user_role'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|','
string|"'itsec'"
op|','
nl|'\n'
name|'operation'
op|'='
string|"'invalid_operation'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_describe_hosts_compute
dedent|''
name|'def'
name|'test_describe_hosts_compute'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db'
op|'.'
name|'service_create'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
op|'{'
string|"'host'"
op|':'
string|"'host1'"
op|','
nl|'\n'
string|"'binary'"
op|':'
string|'"nova-compute"'
op|','
nl|'\n'
string|"'topic'"
op|':'
string|"'compute'"
op|','
nl|'\n'
string|"'report_count'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'availability_zone'"
op|':'
string|'"zone1"'
op|'}'
op|')'
newline|'\n'
name|'hosts'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_hosts'
op|'('
name|'self'
op|'.'
name|'_c'
op|')'
op|'['
string|"'hosts'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'host1'"
op|','
name|'hosts'
op|'['
number|'0'
op|']'
op|'['
string|"'hostname'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_describe_hosts_volume
dedent|''
name|'def'
name|'test_describe_hosts_volume'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db'
op|'.'
name|'service_create'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
op|'{'
string|"'host'"
op|':'
string|"'volume1'"
op|','
nl|'\n'
string|"'binary'"
op|':'
string|'"nova-volume"'
op|','
nl|'\n'
string|"'topic'"
op|':'
string|"'volume'"
op|','
nl|'\n'
string|"'report_count'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'availability_zone'"
op|':'
string|'"zone1"'
op|'}'
op|')'
newline|'\n'
name|'hosts'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_hosts'
op|'('
name|'self'
op|'.'
name|'_c'
op|')'
op|'['
string|"'hosts'"
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'volume1'"
op|','
name|'hosts'
op|'['
number|'0'
op|']'
op|'['
string|"'hostname'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_block_external_addresses
dedent|''
name|'def'
name|'test_block_external_addresses'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'result'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'block_external_addresses'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'192.168.100.1/24'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'OK'"
op|','
name|'result'
op|'['
string|"'status'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'Added 3 rules'"
op|','
name|'result'
op|'['
string|"'message'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_block_external_addresses_already_existent_rule
dedent|''
name|'def'
name|'test_block_external_addresses_already_existent_rule'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'block_external_addresses'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'192.168.100.1/24'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'ApiError'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'block_external_addresses'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_c'
op|','
string|"'192.168.100.1/24'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_describe_external_address_blocks
dedent|''
name|'def'
name|'test_describe_external_address_blocks'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'block_external_addresses'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'192.168.100.1/24'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
op|'{'
string|"'externalIpBlockInfo'"
op|':'
op|'['
op|'{'
string|"'cidr'"
op|':'
string|"u'192.168.100.1/24'"
op|'}'
op|']'
op|'}'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_external_address_blocks'
op|'('
name|'self'
op|'.'
name|'_c'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_remove_external_address_block
dedent|''
name|'def'
name|'test_remove_external_address_block'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'block_external_addresses'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'192.168.100.1/24'"
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'remove_external_address_block'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
nl|'\n'
string|"'192.168.100.1/24'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'OK'"
op|','
name|'result'
op|'['
string|"'status'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'Deleted 3 rules'"
op|','
name|'result'
op|'['
string|"'message'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_external_address_blocks'
op|'('
name|'self'
op|'.'
name|'_c'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
op|']'
op|','
name|'result'
op|'['
string|"'externalIpBlockInfo'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_start_vpn
dedent|''
name|'def'
name|'test_start_vpn'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|function|fake_launch_vpn_instance
indent|'        '
name|'def'
name|'fake_launch_vpn_instance'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
DECL|function|get_fake_instance_func
dedent|''
name|'def'
name|'get_fake_instance_func'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'first_call'
op|'='
op|'['
name|'True'
op|']'
newline|'\n'
nl|'\n'
DECL|function|fake_instance_get_all_by_project
name|'def'
name|'fake_instance_get_all_by_project'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'first_call'
op|'['
number|'0'
op|']'
op|':'
newline|'\n'
indent|'                    '
name|'first_call'
op|'['
number|'0'
op|']'
op|'='
name|'False'
newline|'\n'
name|'return'
op|'['
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'return'
op|'['
op|'{'
string|"'id'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'user_id'"
op|':'
string|"'bob'"
op|','
nl|'\n'
string|"'image_id'"
op|':'
name|'str'
op|'('
name|'flags'
op|'.'
name|'FLAGS'
op|'.'
name|'vpn_image_id'
op|')'
op|','
nl|'\n'
string|"'project_id'"
op|':'
string|"'bobs_project'"
op|','
nl|'\n'
string|"'instance_type_id'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'os_type'"
op|':'
string|"'linux'"
op|','
nl|'\n'
string|"'architecture'"
op|':'
string|"'x86-64'"
op|','
nl|'\n'
string|"'state_description'"
op|':'
string|"'running'"
op|','
nl|'\n'
string|"'vm_state'"
op|':'
name|'vm_states'
op|'.'
name|'ACTIVE'
op|','
nl|'\n'
string|"'image_ref'"
op|':'
string|"'3'"
op|'}'
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'return'
name|'fake_instance_get_all_by_project'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'pipelib'
op|'.'
name|'CloudPipe'
op|','
string|"'launch_vpn_instance'"
op|','
nl|'\n'
name|'fake_launch_vpn_instance'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'db'
op|','
string|"'instance_get_all_by_project'"
op|','
nl|'\n'
name|'get_fake_instance_func'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'i-00000001'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'start_vpn'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|')'
op|'['
string|"'instance_id'"
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_describe_vpns
dedent|''
name|'def'
name|'test_describe_vpns'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|fake_instance_get_all_by_project
indent|'        '
name|'def'
name|'fake_instance_get_all_by_project'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'now'
op|'='
name|'datetime'
op|'.'
name|'datetime'
op|'.'
name|'now'
op|'('
op|')'
newline|'\n'
name|'created_at'
op|'='
name|'now'
op|'-'
name|'datetime'
op|'.'
name|'timedelta'
op|'('
name|'seconds'
op|'='
number|'70'
op|')'
newline|'\n'
nl|'\n'
name|'return'
op|'['
op|'{'
string|"'id'"
op|':'
number|'1'
op|','
nl|'\n'
string|"'user_id'"
op|':'
string|"'bob'"
op|','
nl|'\n'
string|"'image_id'"
op|':'
name|'str'
op|'('
name|'flags'
op|'.'
name|'FLAGS'
op|'.'
name|'vpn_image_id'
op|')'
op|','
nl|'\n'
string|"'project_id'"
op|':'
string|"'bobs_project'"
op|','
nl|'\n'
string|"'instance_type_id'"
op|':'
string|"'1'"
op|','
nl|'\n'
string|"'os_type'"
op|':'
string|"'linux'"
op|','
nl|'\n'
string|"'architecture'"
op|':'
string|"'x86-64'"
op|','
nl|'\n'
string|"'state_description'"
op|':'
string|"'running'"
op|','
nl|'\n'
string|"'created_at'"
op|':'
name|'created_at'
op|','
nl|'\n'
string|"'vm_state'"
op|':'
name|'vm_states'
op|'.'
name|'ACTIVE'
op|','
nl|'\n'
string|"'image_ref'"
op|':'
string|"'3'"
op|'}'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'db'
op|','
string|"'instance_get_all_by_project'"
op|','
nl|'\n'
name|'fake_instance_get_all_by_project'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_user'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'register_project'
op|'('
name|'self'
op|'.'
name|'_c'
op|','
string|"'bobs_project'"
op|','
string|"'bob'"
op|')'
newline|'\n'
name|'vpns'
op|'='
name|'self'
op|'.'
name|'_ac'
op|'.'
name|'describe_vpns'
op|'('
name|'self'
op|'.'
name|'_c'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertIn'
op|'('
string|"'items'"
op|','
name|'vpns'
op|')'
newline|'\n'
nl|'\n'
name|'item'
op|'='
name|'vpns'
op|'['
string|"'items'"
op|']'
op|'['
number|'0'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'i-00000001'"
op|','
name|'item'
op|'['
string|"'instance_id'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'None'
op|','
name|'item'
op|'['
string|"'public_port'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'None'
op|','
name|'item'
op|'['
string|"'public_ip'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'down - invalid project vpn config'"
op|','
name|'item'
op|'['
string|"'state'"
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"u'bobs_project'"
op|','
name|'item'
op|'['
string|"'project_id'"
op|']'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
