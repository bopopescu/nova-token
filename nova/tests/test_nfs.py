begin_unit
comment|'# vim: tabstop=4 shiftwidth=4 softtabstop=4'
nl|'\n'
nl|'\n'
comment|'# Copyright (c) 2012 NetApp, Inc.'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
string|'"""Unit tests for the NFS driver module"""'
newline|'\n'
nl|'\n'
name|'import'
name|'__builtin__'
newline|'\n'
name|'import'
name|'errno'
newline|'\n'
name|'import'
name|'os'
newline|'\n'
nl|'\n'
name|'import'
name|'mox'
name|'as'
name|'mox_lib'
newline|'\n'
name|'from'
name|'mox'
name|'import'
name|'IgnoreArg'
newline|'\n'
name|'from'
name|'mox'
name|'import'
name|'IsA'
newline|'\n'
name|'from'
name|'mox'
name|'import'
name|'stubout'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'context'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'exception'
name|'import'
name|'ProcessExecutionError'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
op|'.'
name|'volume'
name|'import'
name|'nfs'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|DumbVolume
name|'class'
name|'DumbVolume'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|variable|fields
indent|'    '
name|'fields'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|__setitem__
name|'def'
name|'__setitem__'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'fields'
op|'['
name|'key'
op|']'
op|'='
name|'value'
newline|'\n'
nl|'\n'
DECL|member|__getitem__
dedent|''
name|'def'
name|'__getitem__'
op|'('
name|'self'
op|','
name|'item'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'fields'
op|'['
name|'item'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|NfsDriverTestCase
dedent|''
dedent|''
name|'class'
name|'NfsDriverTestCase'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Test case for NFS driver"""'
newline|'\n'
nl|'\n'
DECL|variable|TEST_NFS_EXPORT1
name|'TEST_NFS_EXPORT1'
op|'='
string|"'nfs-host1:/export'"
newline|'\n'
DECL|variable|TEST_NFS_EXPORT2
name|'TEST_NFS_EXPORT2'
op|'='
string|"'nfs-host2:/export'"
newline|'\n'
DECL|variable|TEST_SIZE_IN_GB
name|'TEST_SIZE_IN_GB'
op|'='
number|'1'
newline|'\n'
DECL|variable|TEST_MNT_POINT
name|'TEST_MNT_POINT'
op|'='
string|"'/mnt/nfs'"
newline|'\n'
DECL|variable|TEST_MNT_POINT_BASE
name|'TEST_MNT_POINT_BASE'
op|'='
string|"'/mnt/test'"
newline|'\n'
DECL|variable|TEST_LOCAL_PATH
name|'TEST_LOCAL_PATH'
op|'='
string|"'/mnt/nfs/volume-123'"
newline|'\n'
DECL|variable|TEST_FILE_NAME
name|'TEST_FILE_NAME'
op|'='
string|"'test.txt'"
newline|'\n'
DECL|variable|TEST_SHARES_CONFIG_FILE
name|'TEST_SHARES_CONFIG_FILE'
op|'='
string|"'/etc/cinder/test-shares.conf'"
newline|'\n'
DECL|variable|ONE_GB_IN_BYTES
name|'ONE_GB_IN_BYTES'
op|'='
number|'1024'
op|'*'
number|'1024'
op|'*'
number|'1024'
newline|'\n'
nl|'\n'
DECL|member|setUp
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_driver'
op|'='
name|'nfs'
op|'.'
name|'NfsDriver'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_mox'
op|'='
name|'mox_lib'
op|'.'
name|'Mox'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'='
name|'stubout'
op|'.'
name|'StubOutForTesting'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_mox'
op|'.'
name|'UnsetStubs'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'UnsetAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|stub_out_not_replaying
dedent|''
name|'def'
name|'stub_out_not_replaying'
op|'('
name|'self'
op|','
name|'obj'
op|','
name|'attr_name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'attr_to_replace'
op|'='
name|'getattr'
op|'('
name|'obj'
op|','
name|'attr_name'
op|')'
newline|'\n'
name|'stub'
op|'='
name|'mox_lib'
op|'.'
name|'MockObject'
op|'('
name|'attr_to_replace'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'obj'
op|','
name|'attr_name'
op|','
name|'stub'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_path_exists_should_return_true
dedent|''
name|'def'
name|'test_path_exists_should_return_true'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_path_exists should return True if stat returns 0"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_execute'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_execute'
op|'('
string|"'stat'"
op|','
name|'self'
op|'.'
name|'TEST_FILE_NAME'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertTrue'
op|'('
name|'drv'
op|'.'
name|'_path_exists'
op|'('
name|'self'
op|'.'
name|'TEST_FILE_NAME'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_path_exists_should_return_false
dedent|''
name|'def'
name|'test_path_exists_should_return_false'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_path_exists should return True if stat doesn\'t return 0"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_execute'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_execute'
op|'('
string|"'stat'"
op|','
name|'self'
op|'.'
name|'TEST_FILE_NAME'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
op|'.'
name|'AndRaise'
op|'('
name|'ProcessExecutionError'
op|'('
nl|'\n'
name|'stderr'
op|'='
string|'"stat: cannot stat `test.txt\': No such file or directory"'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertFalse'
op|'('
name|'drv'
op|'.'
name|'_path_exists'
op|'('
name|'self'
op|'.'
name|'TEST_FILE_NAME'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_local_path
dedent|''
name|'def'
name|'test_local_path'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""local_path common use case"""'
newline|'\n'
name|'nfs'
op|'.'
name|'FLAGS'
op|'.'
name|'nfs_mount_point_base'
op|'='
name|'self'
op|'.'
name|'TEST_MNT_POINT_BASE'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'volume'
op|'='
name|'DumbVolume'
op|'('
op|')'
newline|'\n'
name|'volume'
op|'['
string|"'provider_location'"
op|']'
op|'='
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
newline|'\n'
name|'volume'
op|'['
string|"'name'"
op|']'
op|'='
string|"'volume-123'"
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
nl|'\n'
string|"'/mnt/test/2f4f60214cf43c595666dd815f0360a4/volume-123'"
op|','
nl|'\n'
name|'drv'
op|'.'
name|'local_path'
op|'('
name|'volume'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_mount_nfs_should_mount_correctly
dedent|''
name|'def'
name|'test_mount_nfs_should_mount_correctly'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_mount_nfs common case usage"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_path_exists'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_path_exists'
op|'('
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_execute'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_execute'
op|'('
string|"'mount'"
op|','
string|"'-t'"
op|','
string|"'nfs'"
op|','
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|','
nl|'\n'
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'_mount_nfs'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|','
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_mount_nfs_should_suppress_already_mounted_error
dedent|''
name|'def'
name|'test_mount_nfs_should_suppress_already_mounted_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_mount_nfs should suppress already mounted error if ensure=True\n        """'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_path_exists'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_path_exists'
op|'('
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_execute'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_execute'
op|'('
string|"'mount'"
op|','
string|"'-t'"
op|','
string|"'nfs'"
op|','
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|','
nl|'\n'
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
op|'.'
name|'AndRaise'
op|'('
name|'ProcessExecutionError'
op|'('
nl|'\n'
name|'stderr'
op|'='
string|"'is busy or already mounted'"
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'_mount_nfs'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|','
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|','
name|'ensure'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_mount_nfs_should_reraise_already_mounted_error
dedent|''
name|'def'
name|'test_mount_nfs_should_reraise_already_mounted_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_mount_nfs should not suppress already mounted error if ensure=False\n        """'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_path_exists'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_path_exists'
op|'('
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_execute'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_execute'
op|'('
string|"'mount'"
op|','
string|"'-t'"
op|','
string|"'nfs'"
op|','
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|','
nl|'\n'
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
op|'.'
name|'AndRaise'
op|'('
name|'ProcessExecutionError'
op|'('
name|'stderr'
op|'='
string|"'is busy or already mounted'"
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'ProcessExecutionError'
op|','
name|'drv'
op|'.'
name|'_mount_nfs'
op|','
nl|'\n'
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|','
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|','
nl|'\n'
name|'ensure'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_mount_nfs_should_create_mountpoint_if_not_yet
dedent|''
name|'def'
name|'test_mount_nfs_should_create_mountpoint_if_not_yet'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_mount_nfs should create mountpoint if it doesn\'t exist"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_path_exists'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_path_exists'
op|'('
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_execute'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_execute'
op|'('
string|"'mkdir'"
op|','
string|"'-p'"
op|','
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_execute'
op|'('
op|'*'
op|'('
op|'['
name|'IgnoreArg'
op|'('
op|')'
op|']'
op|'*'
number|'5'
op|')'
op|','
name|'run_as_root'
op|'='
name|'IgnoreArg'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'_mount_nfs'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|','
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_mount_nfs_should_not_create_mountpoint_if_already
dedent|''
name|'def'
name|'test_mount_nfs_should_not_create_mountpoint_if_already'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_mount_nfs should not create mountpoint if it already exists"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_path_exists'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_path_exists'
op|'('
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_execute'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_execute'
op|'('
op|'*'
op|'('
op|'['
name|'IgnoreArg'
op|'('
op|')'
op|']'
op|'*'
number|'5'
op|')'
op|','
name|'run_as_root'
op|'='
name|'IgnoreArg'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'_mount_nfs'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|','
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_hash_str
dedent|''
name|'def'
name|'test_get_hash_str'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_get_hash_str should calculation correct value"""'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'2f4f60214cf43c595666dd815f0360a4'"
op|','
nl|'\n'
name|'drv'
op|'.'
name|'_get_hash_str'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_mount_point_for_share
dedent|''
name|'def'
name|'test_get_mount_point_for_share'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_get_mount_point_for_share should calculate correct value"""'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'nfs'
op|'.'
name|'FLAGS'
op|'.'
name|'nfs_mount_point_base'
op|'='
name|'self'
op|'.'
name|'TEST_MNT_POINT_BASE'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
string|"'/mnt/test/2f4f60214cf43c595666dd815f0360a4'"
op|','
nl|'\n'
name|'drv'
op|'.'
name|'_get_mount_point_for_share'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_available_capacity_with_df
dedent|''
name|'def'
name|'test_get_available_capacity_with_df'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_get_available_capacity should calculate correct value"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'df_avail'
op|'='
number|'1490560'
newline|'\n'
name|'df_head'
op|'='
string|"'Filesystem 1K-blocks Used Available Use% Mounted on\\n'"
newline|'\n'
name|'df_data'
op|'='
string|"'nfs-host:/export 2620544 996864 %d 41%% /mnt'"
op|'%'
name|'df_avail'
newline|'\n'
name|'df_output'
op|'='
name|'df_head'
op|'+'
name|'df_data'
newline|'\n'
nl|'\n'
name|'setattr'
op|'('
name|'nfs'
op|'.'
name|'FLAGS'
op|','
string|"'nfs_disk_util'"
op|','
string|"'df'"
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_get_mount_point_for_share'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_get_mount_point_for_share'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_execute'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_execute'
op|'('
string|"'df'"
op|','
string|"'-P'"
op|','
string|"'-B'"
op|','
string|"'1'"
op|','
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|','
nl|'\n'
name|'run_as_root'
op|'='
name|'True'
op|')'
op|'.'
name|'AndReturn'
op|'('
op|'('
name|'df_output'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'df_avail'
op|','
nl|'\n'
name|'drv'
op|'.'
name|'_get_available_capacity'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'delattr'
op|'('
name|'nfs'
op|'.'
name|'FLAGS'
op|','
string|"'nfs_disk_util'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_get_available_capacity_with_du
dedent|''
name|'def'
name|'test_get_available_capacity_with_du'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_get_available_capacity should calculate correct value"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'setattr'
op|'('
name|'nfs'
op|'.'
name|'FLAGS'
op|','
string|"'nfs_disk_util'"
op|','
string|"'du'"
op|')'
newline|'\n'
nl|'\n'
name|'df_total_size'
op|'='
number|'2620544'
newline|'\n'
name|'df_used_size'
op|'='
number|'996864'
newline|'\n'
name|'df_avail_size'
op|'='
number|'1490560'
newline|'\n'
name|'df_title'
op|'='
string|"'Filesystem 1-blocks Used Available Use% Mounted on\\n'"
newline|'\n'
name|'df_mnt_data'
op|'='
string|"'nfs-host:/export %d %d %d 41%% /mnt'"
op|'%'
op|'('
name|'df_total_size'
op|','
nl|'\n'
name|'df_used_size'
op|','
nl|'\n'
name|'df_avail_size'
op|')'
newline|'\n'
name|'df_output'
op|'='
name|'df_title'
op|'+'
name|'df_mnt_data'
newline|'\n'
nl|'\n'
name|'du_used'
op|'='
number|'490560'
newline|'\n'
name|'du_output'
op|'='
string|"'%d /mnt'"
op|'%'
name|'du_used'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_get_mount_point_for_share'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_get_mount_point_for_share'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_execute'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_execute'
op|'('
string|"'df'"
op|','
string|"'-P'"
op|','
string|"'-B'"
op|','
string|"'1'"
op|','
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|','
nl|'\n'
name|'run_as_root'
op|'='
name|'True'
op|')'
op|'.'
name|'AndReturn'
op|'('
op|'('
name|'df_output'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_execute'
op|'('
string|"'du'"
op|','
string|"'-sb'"
op|','
string|"'--apparent-size'"
op|','
nl|'\n'
string|"'--exclude'"
op|','
string|"'*snapshot*'"
op|','
nl|'\n'
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|','
nl|'\n'
name|'run_as_root'
op|'='
name|'True'
op|')'
op|'.'
name|'AndReturn'
op|'('
op|'('
name|'du_output'
op|','
name|'None'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEquals'
op|'('
name|'df_total_size'
op|'-'
name|'du_used'
op|','
nl|'\n'
name|'drv'
op|'.'
name|'_get_available_capacity'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'delattr'
op|'('
name|'nfs'
op|'.'
name|'FLAGS'
op|','
string|"'nfs_disk_util'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_load_shares_config
dedent|''
name|'def'
name|'test_load_shares_config'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'nfs'
op|'.'
name|'FLAGS'
op|'.'
name|'nfs_shares_config'
op|'='
name|'self'
op|'.'
name|'TEST_SHARES_CONFIG_FILE'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'__builtin__'
op|','
string|"'open'"
op|')'
newline|'\n'
name|'config_data'
op|'='
op|'['
op|']'
newline|'\n'
name|'config_data'
op|'.'
name|'append'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
newline|'\n'
name|'config_data'
op|'.'
name|'append'
op|'('
string|"'#'"
op|'+'
name|'self'
op|'.'
name|'TEST_NFS_EXPORT2'
op|')'
newline|'\n'
name|'config_data'
op|'.'
name|'append'
op|'('
string|"''"
op|')'
newline|'\n'
name|'__builtin__'
op|'.'
name|'open'
op|'('
name|'self'
op|'.'
name|'TEST_SHARES_CONFIG_FILE'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'config_data'
op|')'
newline|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'shares'
op|'='
name|'drv'
op|'.'
name|'_load_shares_config'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
op|'['
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|']'
op|','
name|'shares'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_ensure_share_mounted
dedent|''
name|'def'
name|'test_ensure_share_mounted'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_ensure_share_mounted simple use case"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_get_mount_point_for_share'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_get_mount_point_for_share'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_mount_nfs'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_mount_nfs'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|','
name|'self'
op|'.'
name|'TEST_MNT_POINT'
op|','
name|'ensure'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'_ensure_share_mounted'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_ensure_shares_mounted_should_save_mounting_successfully
dedent|''
name|'def'
name|'test_ensure_shares_mounted_should_save_mounting_successfully'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_ensure_shares_mounted should save share if mounted with success"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_load_shares_config'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_load_shares_config'
op|'('
op|')'
op|'.'
name|'AndReturn'
op|'('
op|'['
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|']'
op|')'
newline|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_ensure_share_mounted'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_ensure_share_mounted'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'_ensure_shares_mounted'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'1'
op|','
name|'len'
op|'('
name|'drv'
op|'.'
name|'_mounted_shares'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|','
name|'drv'
op|'.'
name|'_mounted_shares'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_ensure_shares_mounted_should_not_save_mounting_with_error
dedent|''
name|'def'
name|'test_ensure_shares_mounted_should_not_save_mounting_with_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_ensure_shares_mounted should not save share if failed to mount"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_load_shares_config'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_load_shares_config'
op|'('
op|')'
op|'.'
name|'AndReturn'
op|'('
op|'['
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|']'
op|')'
newline|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_ensure_share_mounted'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_ensure_share_mounted'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
op|'.'
name|'AndRaise'
op|'('
name|'Exception'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'_ensure_shares_mounted'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
number|'0'
op|','
name|'len'
op|'('
name|'drv'
op|'.'
name|'_mounted_shares'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_setup_should_throw_error_if_shares_config_not_configured
dedent|''
name|'def'
name|'test_setup_should_throw_error_if_shares_config_not_configured'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""do_setup should throw error if shares config is not configured """'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'nfs'
op|'.'
name|'FLAGS'
op|'.'
name|'nfs_shares_config'
op|'='
name|'self'
op|'.'
name|'TEST_SHARES_CONFIG_FILE'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NfsException'
op|','
nl|'\n'
name|'drv'
op|'.'
name|'do_setup'
op|','
name|'IsA'
op|'('
name|'context'
op|'.'
name|'RequestContext'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_setup_should_throw_exception_if_nfs_client_is_not_installed
dedent|''
name|'def'
name|'test_setup_should_throw_exception_if_nfs_client_is_not_installed'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""do_setup should throw error if nfs client is not installed """'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'nfs'
op|'.'
name|'FLAGS'
op|'.'
name|'nfs_shares_config'
op|'='
name|'self'
op|'.'
name|'TEST_SHARES_CONFIG_FILE'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'os'
op|'.'
name|'path'
op|','
string|"'exists'"
op|')'
newline|'\n'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'self'
op|'.'
name|'TEST_SHARES_CONFIG_FILE'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'True'
op|')'
newline|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_execute'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_execute'
op|'('
string|"'mount.nfs'"
op|','
name|'check_exit_code'
op|'='
name|'False'
op|')'
op|'.'
name|'AndRaise'
op|'('
name|'OSError'
op|'('
name|'errno'
op|'.'
name|'ENOENT'
op|','
string|"'No such file or directory'"
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NfsException'
op|','
nl|'\n'
name|'drv'
op|'.'
name|'do_setup'
op|','
name|'IsA'
op|'('
name|'context'
op|'.'
name|'RequestContext'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_find_share_should_throw_error_if_there_is_no_mounted_shares
dedent|''
name|'def'
name|'test_find_share_should_throw_error_if_there_is_no_mounted_shares'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_find_share should throw error if there is no mounted shares"""'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'_mounted_shares'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NotFound'
op|','
name|'drv'
op|'.'
name|'_find_share'
op|','
nl|'\n'
name|'self'
op|'.'
name|'TEST_SIZE_IN_GB'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_find_share
dedent|''
name|'def'
name|'test_find_share'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_find_share simple use case"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'_mounted_shares'
op|'='
op|'['
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|','
name|'self'
op|'.'
name|'TEST_NFS_EXPORT2'
op|']'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_get_available_capacity'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_get_available_capacity'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
op|'.'
name|'AndReturn'
op|'('
number|'2'
op|'*'
name|'self'
op|'.'
name|'ONE_GB_IN_BYTES'
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_get_available_capacity'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT2'
op|')'
op|'.'
name|'AndReturn'
op|'('
number|'3'
op|'*'
name|'self'
op|'.'
name|'ONE_GB_IN_BYTES'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT2'
op|','
nl|'\n'
name|'drv'
op|'.'
name|'_find_share'
op|'('
name|'self'
op|'.'
name|'TEST_SIZE_IN_GB'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_find_share_should_throw_error_if_there_is_no_enough_place
dedent|''
name|'def'
name|'test_find_share_should_throw_error_if_there_is_no_enough_place'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""_find_share should throw error if there is no share to host vol"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'_mounted_shares'
op|'='
op|'['
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|','
name|'self'
op|'.'
name|'TEST_NFS_EXPORT2'
op|']'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_get_available_capacity'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_get_available_capacity'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
op|'.'
name|'AndReturn'
op|'('
number|'0'
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_get_available_capacity'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT2'
op|')'
op|'.'
name|'AndReturn'
op|'('
number|'0'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'assertRaises'
op|'('
name|'exception'
op|'.'
name|'NfsNoSuitableShareFound'
op|','
name|'drv'
op|'.'
name|'_find_share'
op|','
nl|'\n'
name|'self'
op|'.'
name|'TEST_SIZE_IN_GB'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_simple_volume
dedent|''
name|'def'
name|'_simple_volume'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'volume'
op|'='
name|'DumbVolume'
op|'('
op|')'
newline|'\n'
name|'volume'
op|'['
string|"'provider_location'"
op|']'
op|'='
string|"'127.0.0.1:/mnt'"
newline|'\n'
name|'volume'
op|'['
string|"'name'"
op|']'
op|'='
string|"'volume_name'"
newline|'\n'
name|'volume'
op|'['
string|"'size'"
op|']'
op|'='
number|'10'
newline|'\n'
nl|'\n'
name|'return'
name|'volume'
newline|'\n'
nl|'\n'
DECL|member|test_create_sparsed_volume
dedent|''
name|'def'
name|'test_create_sparsed_volume'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
name|'volume'
op|'='
name|'self'
op|'.'
name|'_simple_volume'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'setattr'
op|'('
name|'nfs'
op|'.'
name|'FLAGS'
op|','
string|"'nfs_sparsed_volumes'"
op|','
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_create_sparsed_file'"
op|')'
newline|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_set_rw_permissions_for_all'"
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'_create_sparsed_file'
op|'('
name|'IgnoreArg'
op|'('
op|')'
op|','
name|'IgnoreArg'
op|'('
op|')'
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_set_rw_permissions_for_all'
op|'('
name|'IgnoreArg'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'_do_create_volume'
op|'('
name|'volume'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'delattr'
op|'('
name|'nfs'
op|'.'
name|'FLAGS'
op|','
string|"'nfs_sparsed_volumes'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_nonsparsed_volume
dedent|''
name|'def'
name|'test_create_nonsparsed_volume'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
name|'volume'
op|'='
name|'self'
op|'.'
name|'_simple_volume'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'setattr'
op|'('
name|'nfs'
op|'.'
name|'FLAGS'
op|','
string|"'nfs_sparsed_volumes'"
op|','
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_create_regular_file'"
op|')'
newline|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_set_rw_permissions_for_all'"
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'_create_regular_file'
op|'('
name|'IgnoreArg'
op|'('
op|')'
op|','
name|'IgnoreArg'
op|'('
op|')'
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_set_rw_permissions_for_all'
op|'('
name|'IgnoreArg'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'_do_create_volume'
op|'('
name|'volume'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'delattr'
op|'('
name|'nfs'
op|'.'
name|'FLAGS'
op|','
string|"'nfs_sparsed_volumes'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_volume_should_ensure_nfs_mounted
dedent|''
name|'def'
name|'test_create_volume_should_ensure_nfs_mounted'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""create_volume should ensure shares provided in config are mounted"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stub_out_not_replaying'
op|'('
name|'nfs'
op|','
string|"'LOG'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stub_out_not_replaying'
op|'('
name|'drv'
op|','
string|"'_find_share'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stub_out_not_replaying'
op|'('
name|'drv'
op|','
string|"'_do_create_volume'"
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_ensure_shares_mounted'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_ensure_shares_mounted'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'volume'
op|'='
name|'DumbVolume'
op|'('
op|')'
newline|'\n'
name|'volume'
op|'['
string|"'size'"
op|']'
op|'='
name|'self'
op|'.'
name|'TEST_SIZE_IN_GB'
newline|'\n'
name|'drv'
op|'.'
name|'create_volume'
op|'('
name|'volume'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_volume_should_return_provider_location
dedent|''
name|'def'
name|'test_create_volume_should_return_provider_location'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""create_volume should return provider_location with found share """'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stub_out_not_replaying'
op|'('
name|'nfs'
op|','
string|"'LOG'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stub_out_not_replaying'
op|'('
name|'drv'
op|','
string|"'_ensure_shares_mounted'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stub_out_not_replaying'
op|'('
name|'drv'
op|','
string|"'_do_create_volume'"
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_find_share'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_find_share'
op|'('
name|'self'
op|'.'
name|'TEST_SIZE_IN_GB'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'volume'
op|'='
name|'DumbVolume'
op|'('
op|')'
newline|'\n'
name|'volume'
op|'['
string|"'size'"
op|']'
op|'='
name|'self'
op|'.'
name|'TEST_SIZE_IN_GB'
newline|'\n'
name|'result'
op|'='
name|'drv'
op|'.'
name|'create_volume'
op|'('
name|'volume'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|','
name|'result'
op|'['
string|"'provider_location'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_volume
dedent|''
name|'def'
name|'test_delete_volume'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""delete_volume simple test case"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stub_out_not_replaying'
op|'('
name|'drv'
op|','
string|"'_ensure_share_mounted'"
op|')'
newline|'\n'
nl|'\n'
name|'volume'
op|'='
name|'DumbVolume'
op|'('
op|')'
newline|'\n'
name|'volume'
op|'['
string|"'name'"
op|']'
op|'='
string|"'volume-123'"
newline|'\n'
name|'volume'
op|'['
string|"'provider_location'"
op|']'
op|'='
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'local_path'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'local_path'
op|'('
name|'volume'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'self'
op|'.'
name|'TEST_LOCAL_PATH'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_path_exists'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_path_exists'
op|'('
name|'self'
op|'.'
name|'TEST_LOCAL_PATH'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_execute'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_execute'
op|'('
string|"'rm'"
op|','
string|"'-f'"
op|','
name|'self'
op|'.'
name|'TEST_LOCAL_PATH'
op|','
name|'run_as_root'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'delete_volume'
op|'('
name|'volume'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_should_ensure_share_mounted
dedent|''
name|'def'
name|'test_delete_should_ensure_share_mounted'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""delete_volume should ensure that corresponding share is mounted"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stub_out_not_replaying'
op|'('
name|'drv'
op|','
string|"'_execute'"
op|')'
newline|'\n'
nl|'\n'
name|'volume'
op|'='
name|'DumbVolume'
op|'('
op|')'
newline|'\n'
name|'volume'
op|'['
string|"'name'"
op|']'
op|'='
string|"'volume-123'"
newline|'\n'
name|'volume'
op|'['
string|"'provider_location'"
op|']'
op|'='
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_ensure_share_mounted'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_ensure_share_mounted'
op|'('
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'delete_volume'
op|'('
name|'volume'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_should_not_delete_if_provider_location_not_provided
dedent|''
name|'def'
name|'test_delete_should_not_delete_if_provider_location_not_provided'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""delete_volume shouldn\'t try to delete if provider_location missed"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stub_out_not_replaying'
op|'('
name|'drv'
op|','
string|"'_ensure_share_mounted'"
op|')'
newline|'\n'
nl|'\n'
name|'volume'
op|'='
name|'DumbVolume'
op|'('
op|')'
newline|'\n'
name|'volume'
op|'['
string|"'name'"
op|']'
op|'='
string|"'volume-123'"
newline|'\n'
name|'volume'
op|'['
string|"'provider_location'"
op|']'
op|'='
name|'None'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_execute'"
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'delete_volume'
op|'('
name|'volume'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_should_not_delete_if_there_is_no_file
dedent|''
name|'def'
name|'test_delete_should_not_delete_if_there_is_no_file'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""delete_volume should not try to delete if file missed"""'
newline|'\n'
name|'mox'
op|'='
name|'self'
op|'.'
name|'_mox'
newline|'\n'
name|'drv'
op|'='
name|'self'
op|'.'
name|'_driver'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'stub_out_not_replaying'
op|'('
name|'drv'
op|','
string|"'_ensure_share_mounted'"
op|')'
newline|'\n'
nl|'\n'
name|'volume'
op|'='
name|'DumbVolume'
op|'('
op|')'
newline|'\n'
name|'volume'
op|'['
string|"'name'"
op|']'
op|'='
string|"'volume-123'"
newline|'\n'
name|'volume'
op|'['
string|"'provider_location'"
op|']'
op|'='
name|'self'
op|'.'
name|'TEST_NFS_EXPORT1'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'local_path'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'local_path'
op|'('
name|'volume'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'self'
op|'.'
name|'TEST_LOCAL_PATH'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_path_exists'"
op|')'
newline|'\n'
name|'drv'
op|'.'
name|'_path_exists'
op|'('
name|'self'
op|'.'
name|'TEST_LOCAL_PATH'
op|')'
op|'.'
name|'AndReturn'
op|'('
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'StubOutWithMock'
op|'('
name|'drv'
op|','
string|"'_execute'"
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'ReplayAll'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'drv'
op|'.'
name|'delete_volume'
op|'('
name|'volume'
op|')'
newline|'\n'
nl|'\n'
name|'mox'
op|'.'
name|'VerifyAll'
op|'('
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
