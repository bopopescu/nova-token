begin_unit
comment|'#    Copyright 2012 OpenStack LLC'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'log'
name|'as'
name|'logging'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'test'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'volume'
name|'import'
name|'san'
newline|'\n'
nl|'\n'
DECL|variable|LOG
name|'LOG'
op|'='
name|'logging'
op|'.'
name|'getLogger'
op|'('
name|'__name__'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|HpSanISCSITestCase
name|'class'
name|'HpSanISCSITestCase'
op|'('
name|'test'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'HpSanISCSITestCase'
op|','
name|'self'
op|')'
op|'.'
name|'setUp'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'san'
op|'.'
name|'HpSanISCSIDriver'
op|','
string|'"_cliq_run"'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_fake_cliq_run'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'stubs'
op|'.'
name|'Set'
op|'('
name|'san'
op|'.'
name|'HpSanISCSIDriver'
op|','
string|'"_get_iscsi_properties"'
op|','
nl|'\n'
name|'self'
op|'.'
name|'_fake_get_iscsi_properties'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'='
name|'san'
op|'.'
name|'HpSanISCSIDriver'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'volume_name'
op|'='
string|'"fakevolume"'
newline|'\n'
name|'self'
op|'.'
name|'connector'
op|'='
op|'{'
string|"'ip'"
op|':'
string|"'10.0.0.2'"
op|','
nl|'\n'
string|"'initiator'"
op|':'
string|"'iqn.1993-08.org.debian:01:222'"
op|','
nl|'\n'
string|"'host'"
op|':'
string|"'fakehost'"
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'properties'
op|'='
op|'{'
string|"'target_discoverd'"
op|':'
name|'True'
op|','
nl|'\n'
string|"'target_portal'"
op|':'
string|"'10.0.1.6:3260'"
op|','
nl|'\n'
string|"'target_iqn'"
op|':'
nl|'\n'
string|"'iqn.2003-10.com.lefthandnetworks:group01:25366:fakev'"
op|','
nl|'\n'
string|"'volume_id'"
op|':'
number|'1'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|tearDown
dedent|''
name|'def'
name|'tearDown'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'HpSanISCSITestCase'
op|','
name|'self'
op|')'
op|'.'
name|'tearDown'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|_fake_get_iscsi_properties
dedent|''
name|'def'
name|'_fake_get_iscsi_properties'
op|'('
name|'self'
op|','
name|'volume'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'properties'
newline|'\n'
nl|'\n'
DECL|member|_fake_cliq_run
dedent|''
name|'def'
name|'_fake_cliq_run'
op|'('
name|'self'
op|','
name|'verb'
op|','
name|'cliq_args'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Return fake results for the various methods."""'
newline|'\n'
nl|'\n'
DECL|function|create_volume
name|'def'
name|'create_volume'
op|'('
name|'cliq_args'
op|')'
op|':'
newline|'\n'
indent|'            '
string|'"""\n            input = "createVolume description="fake description"\n                                  clusterName=Cluster01 volumeName=fakevolume\n                                  thinProvision=0 output=XML size=1GB"\n            """'
newline|'\n'
name|'output'
op|'='
string|'"""<gauche version="1.0">\n                <response description="Operation succeeded."\n                          name="CliqSuccess" processingTime="181" result="0"/>\n                </gauche>"""'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cliq_args'
op|'['
string|"'volumeName'"
op|']'
op|','
name|'self'
op|'.'
name|'volume_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cliq_args'
op|'['
string|"'thinProvision'"
op|']'
op|','
string|"'1'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cliq_args'
op|'['
string|"'size'"
op|']'
op|','
string|"'1GB'"
op|')'
newline|'\n'
name|'return'
name|'output'
op|','
name|'None'
newline|'\n'
nl|'\n'
DECL|function|delete_volume
dedent|''
name|'def'
name|'delete_volume'
op|'('
name|'cliq_args'
op|')'
op|':'
newline|'\n'
indent|'            '
string|'"""\n            input = "deleteVolume volumeName=fakevolume prompt=false\n                                  output=XML"\n            """'
newline|'\n'
name|'output'
op|'='
string|'"""<gauche version="1.0">\n                <response description="Operation succeeded."\n                          name="CliqSuccess" processingTime="164" result="0"/>\n                </gauche>"""'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cliq_args'
op|'['
string|"'volumeName'"
op|']'
op|','
name|'self'
op|'.'
name|'volume_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cliq_args'
op|'['
string|"'prompt'"
op|']'
op|','
string|"'false'"
op|')'
newline|'\n'
name|'return'
name|'output'
op|','
name|'None'
newline|'\n'
nl|'\n'
DECL|function|assign_volume
dedent|''
name|'def'
name|'assign_volume'
op|'('
name|'cliq_args'
op|')'
op|':'
newline|'\n'
indent|'            '
string|'"""\n            input = "assignVolumeToServer volumeName=fakevolume\n                                          serverName=fakehost\n                                          output=XML"\n            """'
newline|'\n'
name|'output'
op|'='
string|'"""<gauche version="1.0">\n                <response description="Operation succeeded."\n                          name="CliqSuccess" processingTime="174" result="0"/>\n                </gauche>"""'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cliq_args'
op|'['
string|"'volumeName'"
op|']'
op|','
name|'self'
op|'.'
name|'volume_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cliq_args'
op|'['
string|"'serverName'"
op|']'
op|','
name|'self'
op|'.'
name|'connector'
op|'['
string|"'host'"
op|']'
op|')'
newline|'\n'
name|'return'
name|'output'
op|','
name|'None'
newline|'\n'
nl|'\n'
DECL|function|unassign_volume
dedent|''
name|'def'
name|'unassign_volume'
op|'('
name|'cliq_args'
op|')'
op|':'
newline|'\n'
indent|'            '
string|'"""\n            input = "unassignVolumeToServer volumeName=fakevolume\n                                            serverName=fakehost output=XML\n            """'
newline|'\n'
name|'output'
op|'='
string|'"""<gauche version="1.0">\n                <response description="Operation succeeded."\n                          name="CliqSuccess" processingTime="205" result="0"/>\n                </gauche>"""'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cliq_args'
op|'['
string|"'volumeName'"
op|']'
op|','
name|'self'
op|'.'
name|'volume_name'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cliq_args'
op|'['
string|"'serverName'"
op|']'
op|','
name|'self'
op|'.'
name|'connector'
op|'['
string|"'host'"
op|']'
op|')'
newline|'\n'
name|'return'
name|'output'
op|','
name|'None'
newline|'\n'
nl|'\n'
DECL|function|get_cluster_info
dedent|''
name|'def'
name|'get_cluster_info'
op|'('
name|'cliq_args'
op|')'
op|':'
newline|'\n'
indent|'            '
string|'"""\n            input = "getClusterInfo clusterName=Cluster01 searchDepth=1\n                                    verbose=0 output=XML"\n            """'
newline|'\n'
name|'output'
op|'='
string|'"""<gauche version="1.0">\n                <response description="Operation succeeded." name="CliqSuccess"\n                          processingTime="1164" result="0">\n                <cluster blockSize="1024" description=""\n                         maxVolumeSizeReplication1="622957690"\n                         maxVolumeSizeReplication2="311480287"\n                         minVolumeSize="262144" name="Cluster01"\n                         pageSize="262144" spaceTotal="633697992"\n                         storageNodeCount="2" unprovisionedSpace="622960574"\n                         useVip="true">\n                <nsm ipAddress="10.0.1.7" name="111-vsa"/>\n                <nsm ipAddress="10.0.1.8" name="112-vsa"/>\n                <vip ipAddress="10.0.1.6" subnetMask="255.255.255.0"/>\n                </cluster></response></gauche>"""'
newline|'\n'
name|'return'
name|'output'
op|','
name|'None'
newline|'\n'
nl|'\n'
DECL|function|get_volume_info
dedent|''
name|'def'
name|'get_volume_info'
op|'('
name|'cliq_args'
op|')'
op|':'
newline|'\n'
indent|'            '
string|'"""\n            input = "getVolumeInfo volumeName=fakevolume output=XML"\n            """'
newline|'\n'
name|'output'
op|'='
string|'"""<gauche version="1.0">\n                <response description="Operation succeeded." name="CliqSuccess"\n                          processingTime="87" result="0">\n                <volume autogrowPages="4" availability="online"\n                        blockSize="1024" bytesWritten="0" checkSum="false"\n                        clusterName="Cluster01" created="2011-02-08T19:56:53Z"\n                        deleting="false" description="" groupName="Group01"\n                        initialQuota="536870912" isPrimary="true"\n                iscsiIqn="iqn.2003-10.com.lefthandnetworks:group01:25366:fakev"\n                maxSize="6865387257856" md5="9fa5c8b2cca54b2948a63d833097e1ca"\n                minReplication="1" name="vol-b" parity="0" replication="2"\n                reserveQuota="536870912" scratchQuota="4194304"\n                serialNumber="9fa5c8b2cca54b2948a63d8"\n                size="1073741824" stridePages="32" thinProvision="true">\n                <status description="OK" value="2"/>\n                <permission access="rw" authGroup="api-1"\n                            chapName="chapusername" chapRequired="true"\n                            id="25369" initiatorSecret="" iqn=""\n                            iscsiEnabled="true" loadBalance="true"\n                            targetSecret="supersecret"/>\n                </volume></response></gauche>"""'
newline|'\n'
name|'return'
name|'output'
op|','
name|'None'
newline|'\n'
nl|'\n'
DECL|function|test_error
dedent|''
name|'def'
name|'test_error'
op|'('
name|'cliq_args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'output'
op|'='
string|'"""<gauche version="1.0">\n                <response description="Volume \'134234\' not found."\n                name="CliqVolumeNotFound" processingTime="1083"\n                result="8000100c"/>\n                </gauche>"""'
newline|'\n'
name|'return'
name|'output'
op|','
name|'None'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'cliq_args'
op|'['
string|"'output'"
op|']'
op|','
string|"'XML'"
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'verbs'
op|'='
op|'{'
string|"'createVolume'"
op|':'
name|'create_volume'
op|','
nl|'\n'
string|"'deleteVolume'"
op|':'
name|'delete_volume'
op|','
nl|'\n'
string|"'assignVolumeToServer'"
op|':'
name|'assign_volume'
op|','
nl|'\n'
string|"'unassignVolumeToServer'"
op|':'
name|'unassign_volume'
op|','
nl|'\n'
string|"'getClusterInfo'"
op|':'
name|'get_cluster_info'
op|','
nl|'\n'
string|"'getVolumeInfo'"
op|':'
name|'get_volume_info'
op|','
nl|'\n'
string|"'testError'"
op|':'
name|'test_error'
op|'}'
newline|'\n'
dedent|''
name|'except'
name|'KeyError'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'NotImplementedError'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'verbs'
op|'['
name|'verb'
op|']'
op|'('
name|'cliq_args'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_volume
dedent|''
name|'def'
name|'test_create_volume'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'volume'
op|'='
op|'{'
string|"'name'"
op|':'
name|'self'
op|'.'
name|'volume_name'
op|','
string|"'size'"
op|':'
number|'1'
op|'}'
newline|'\n'
name|'model_update'
op|'='
name|'self'
op|'.'
name|'driver'
op|'.'
name|'create_volume'
op|'('
name|'volume'
op|')'
newline|'\n'
name|'expected_iqn'
op|'='
string|'"iqn.2003-10.com.lefthandnetworks:group01:25366:fakev 0"'
newline|'\n'
name|'expected_location'
op|'='
string|'"10.0.1.6:3260,1 %s"'
op|'%'
name|'expected_iqn'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'model_update'
op|'['
string|"'provider_location'"
op|']'
op|','
name|'expected_location'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_delete_volume
dedent|''
name|'def'
name|'test_delete_volume'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'volume'
op|'='
op|'{'
string|"'name'"
op|':'
name|'self'
op|'.'
name|'volume_name'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'.'
name|'delete_volume'
op|'('
name|'volume'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_initialize_connection
dedent|''
name|'def'
name|'test_initialize_connection'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'volume'
op|'='
op|'{'
string|"'name'"
op|':'
name|'self'
op|'.'
name|'volume_name'
op|'}'
newline|'\n'
name|'result'
op|'='
name|'self'
op|'.'
name|'driver'
op|'.'
name|'initialize_connection'
op|'('
name|'volume'
op|','
name|'self'
op|'.'
name|'connector'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'result'
op|'['
string|"'driver_volume_type'"
op|']'
op|','
string|"'iscsi'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertDictMatch'
op|'('
name|'result'
op|'['
string|"'data'"
op|']'
op|','
name|'self'
op|'.'
name|'properties'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_terminate_connection
dedent|''
name|'def'
name|'test_terminate_connection'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'volume'
op|'='
op|'{'
string|"'name'"
op|':'
name|'self'
op|'.'
name|'volume_name'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'driver'
op|'.'
name|'terminate_connection'
op|'('
name|'volume'
op|','
name|'self'
op|'.'
name|'connector'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_create_snapshot
dedent|''
name|'def'
name|'test_create_snapshot'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'driver'
op|'.'
name|'create_snapshot'
op|'('
string|'""'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'NotImplementedError'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|test_create_volume_from_snapshot
dedent|''
dedent|''
name|'def'
name|'test_create_volume_from_snapshot'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'driver'
op|'.'
name|'create_volume_from_snapshot'
op|'('
string|'""'
op|','
string|'""'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'NotImplementedError'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|test_cliq_error
dedent|''
dedent|''
name|'def'
name|'test_cliq_error'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'driver'
op|'.'
name|'_cliq_run_xml'
op|'('
string|'"testError"'
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'exception'
op|'.'
name|'NovaException'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
dedent|''
dedent|''
endmarker|''
end_unit
