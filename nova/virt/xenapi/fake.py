begin_unit
comment|'#    Copyright (c) 2010 Citrix Systems, Inc.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#============================================================================'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Parts of this file are based upon xmlrpclib.py, the XML-RPC client'
nl|'\n'
comment|'# interface included in the Python distribution.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Copyright (c) 1999-2002 by Secret Labs AB'
nl|'\n'
comment|'# Copyright (c) 1999-2002 by Fredrik Lundh'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# By obtaining, using, and/or copying this software and/or its'
nl|'\n'
comment|'# associated documentation, you agree that you have read, understood,'
nl|'\n'
comment|'# and will comply with the following terms and conditions:'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Permission to use, copy, modify, and distribute this software and'
nl|'\n'
comment|'# its associated documentation for any purpose and without fee is'
nl|'\n'
comment|'# hereby granted, provided that the above copyright notice appears in'
nl|'\n'
comment|'# all copies, and that both that copyright notice and this permission'
nl|'\n'
comment|'# notice appear in supporting documentation, and that the name of'
nl|'\n'
comment|'# Secret Labs AB or the author not be used in advertising or publicity'
nl|'\n'
comment|'# pertaining to distribution of the software without specific, written'
nl|'\n'
comment|'# prior permission.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# SECRET LABS AB AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD'
nl|'\n'
comment|'# TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANT-'
nl|'\n'
comment|'# ABILITY AND FITNESS.  IN NO EVENT SHALL SECRET LABS AB OR THE AUTHOR'
nl|'\n'
comment|'# BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY'
nl|'\n'
comment|'# DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS,'
nl|'\n'
comment|'# WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS'
nl|'\n'
comment|'# ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE'
nl|'\n'
comment|'# OF THIS SOFTWARE.'
nl|'\n'
comment|'# --------------------------------------------------------------------'
nl|'\n'
nl|'\n'
nl|'\n'
string|'"""\nA fake XenAPI SDK.\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'base64'
newline|'\n'
name|'import'
name|'pickle'
newline|'\n'
name|'import'
name|'pprint'
newline|'\n'
name|'import'
name|'random'
newline|'\n'
name|'import'
name|'uuid'
newline|'\n'
name|'from'
name|'xml'
op|'.'
name|'sax'
name|'import'
name|'saxutils'
newline|'\n'
name|'import'
name|'zlib'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
op|'.'
name|'gettextutils'
name|'import'
name|'_'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'jsonutils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'log'
name|'as'
name|'logging'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'timeutils'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'units'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'virt'
op|'.'
name|'xenapi'
op|'.'
name|'client'
name|'import'
name|'session'
name|'as'
name|'xenapi_session'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|_CLASSES
name|'_CLASSES'
op|'='
op|'['
string|"'host'"
op|','
string|"'network'"
op|','
string|"'session'"
op|','
string|"'pool'"
op|','
string|"'SR'"
op|','
string|"'VBD'"
op|','
nl|'\n'
string|"'PBD'"
op|','
string|"'VDI'"
op|','
string|"'VIF'"
op|','
string|"'PIF'"
op|','
string|"'VM'"
op|','
string|"'VLAN'"
op|','
string|"'task'"
op|']'
newline|'\n'
nl|'\n'
DECL|variable|_db_content
name|'_db_content'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
DECL|variable|LOG
name|'LOG'
op|'='
name|'logging'
op|'.'
name|'getLogger'
op|'('
name|'__name__'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|log_db_contents
name|'def'
name|'log_db_contents'
op|'('
name|'msg'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'text'
op|'='
name|'msg'
name|'or'
string|'""'
newline|'\n'
name|'content'
op|'='
name|'pprint'
op|'.'
name|'pformat'
op|'('
name|'_db_content'
op|')'
newline|'\n'
name|'LOG'
op|'.'
name|'debug'
op|'('
string|'"%(text)s: _db_content => %(content)s"'
op|','
nl|'\n'
op|'{'
string|"'text'"
op|':'
name|'text'
op|','
string|"'content'"
op|':'
name|'content'
op|'}'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|reset
dedent|''
name|'def'
name|'reset'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'for'
name|'c'
name|'in'
name|'_CLASSES'
op|':'
newline|'\n'
indent|'        '
name|'_db_content'
op|'['
name|'c'
op|']'
op|'='
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'host'
op|'='
name|'create_host'
op|'('
string|"'fake'"
op|')'
newline|'\n'
name|'create_vm'
op|'('
string|"'fake dom 0'"
op|','
nl|'\n'
string|"'Running'"
op|','
nl|'\n'
name|'is_a_template'
op|'='
name|'False'
op|','
nl|'\n'
name|'is_control_domain'
op|'='
name|'True'
op|','
nl|'\n'
name|'resident_on'
op|'='
name|'host'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|reset_table
dedent|''
name|'def'
name|'reset_table'
op|'('
name|'table'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'table'
name|'not'
name|'in'
name|'_CLASSES'
op|':'
newline|'\n'
indent|'        '
name|'return'
newline|'\n'
dedent|''
name|'_db_content'
op|'['
name|'table'
op|']'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_create_pool
dedent|''
name|'def'
name|'_create_pool'
op|'('
name|'name_label'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'_create_object'
op|'('
string|"'pool'"
op|','
nl|'\n'
op|'{'
string|"'name_label'"
op|':'
name|'name_label'
op|'}'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|create_host
dedent|''
name|'def'
name|'create_host'
op|'('
name|'name_label'
op|','
name|'hostname'
op|'='
string|"'fake_name'"
op|','
name|'address'
op|'='
string|"'fake_addr'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'host_ref'
op|'='
name|'_create_object'
op|'('
string|"'host'"
op|','
nl|'\n'
op|'{'
string|"'name_label'"
op|':'
name|'name_label'
op|','
nl|'\n'
string|"'hostname'"
op|':'
name|'hostname'
op|','
nl|'\n'
string|"'address'"
op|':'
name|'address'
op|'}'
op|')'
newline|'\n'
name|'host_default_sr_ref'
op|'='
name|'_create_local_srs'
op|'('
name|'host_ref'
op|')'
newline|'\n'
name|'_create_local_pif'
op|'('
name|'host_ref'
op|')'
newline|'\n'
nl|'\n'
comment|"# Create a pool if we don't have one already"
nl|'\n'
name|'if'
name|'len'
op|'('
name|'_db_content'
op|'['
string|"'pool'"
op|']'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'        '
name|'pool_ref'
op|'='
name|'_create_pool'
op|'('
string|"''"
op|')'
newline|'\n'
name|'_db_content'
op|'['
string|"'pool'"
op|']'
op|'['
name|'pool_ref'
op|']'
op|'['
string|"'master'"
op|']'
op|'='
name|'host_ref'
newline|'\n'
name|'_db_content'
op|'['
string|"'pool'"
op|']'
op|'['
name|'pool_ref'
op|']'
op|'['
string|"'default-SR'"
op|']'
op|'='
name|'host_default_sr_ref'
newline|'\n'
name|'_db_content'
op|'['
string|"'pool'"
op|']'
op|'['
name|'pool_ref'
op|']'
op|'['
string|"'suspend-image-SR'"
op|']'
op|'='
name|'host_default_sr_ref'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|create_network
dedent|''
dedent|''
name|'def'
name|'create_network'
op|'('
name|'name_label'
op|','
name|'bridge'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'_create_object'
op|'('
string|"'network'"
op|','
nl|'\n'
op|'{'
string|"'name_label'"
op|':'
name|'name_label'
op|','
nl|'\n'
string|"'bridge'"
op|':'
name|'bridge'
op|'}'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|create_vm
dedent|''
name|'def'
name|'create_vm'
op|'('
name|'name_label'
op|','
name|'status'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'status'
op|'=='
string|"'Running'"
op|':'
newline|'\n'
indent|'        '
name|'domid'
op|'='
name|'random'
op|'.'
name|'randrange'
op|'('
number|'1'
op|','
number|'1'
op|'<<'
number|'16'
op|')'
newline|'\n'
name|'resident_on'
op|'='
name|'_db_content'
op|'['
string|"'host'"
op|']'
op|'.'
name|'keys'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'domid'
op|'='
op|'-'
number|'1'
newline|'\n'
name|'resident_on'
op|'='
string|"''"
newline|'\n'
nl|'\n'
dedent|''
name|'vm_rec'
op|'='
name|'kwargs'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'vm_rec'
op|'.'
name|'update'
op|'('
op|'{'
string|"'name_label'"
op|':'
name|'name_label'
op|','
nl|'\n'
string|"'domid'"
op|':'
name|'domid'
op|','
nl|'\n'
string|"'power_state'"
op|':'
name|'status'
op|','
nl|'\n'
string|"'blocked_operations'"
op|':'
op|'{'
op|'}'
op|','
nl|'\n'
string|"'resident_on'"
op|':'
name|'resident_on'
op|'}'
op|')'
newline|'\n'
name|'vm_ref'
op|'='
name|'_create_object'
op|'('
string|"'VM'"
op|','
name|'vm_rec'
op|')'
newline|'\n'
name|'after_VM_create'
op|'('
name|'vm_ref'
op|','
name|'vm_rec'
op|')'
newline|'\n'
name|'return'
name|'vm_ref'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|destroy_vm
dedent|''
name|'def'
name|'destroy_vm'
op|'('
name|'vm_ref'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'vm_rec'
op|'='
name|'_db_content'
op|'['
string|"'VM'"
op|']'
op|'['
name|'vm_ref'
op|']'
newline|'\n'
nl|'\n'
name|'vbd_refs'
op|'='
name|'vm_rec'
op|'['
string|"'VBDs'"
op|']'
newline|'\n'
comment|'# NOTE(johannes): Shallow copy since destroy_vbd will remove itself'
nl|'\n'
comment|'# from the list'
nl|'\n'
name|'for'
name|'vbd_ref'
name|'in'
name|'vbd_refs'
op|'['
op|':'
op|']'
op|':'
newline|'\n'
indent|'        '
name|'destroy_vbd'
op|'('
name|'vbd_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'del'
name|'_db_content'
op|'['
string|"'VM'"
op|']'
op|'['
name|'vm_ref'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|destroy_vbd
dedent|''
name|'def'
name|'destroy_vbd'
op|'('
name|'vbd_ref'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'vbd_rec'
op|'='
name|'_db_content'
op|'['
string|"'VBD'"
op|']'
op|'['
name|'vbd_ref'
op|']'
newline|'\n'
nl|'\n'
name|'vm_ref'
op|'='
name|'vbd_rec'
op|'['
string|"'VM'"
op|']'
newline|'\n'
name|'vm_rec'
op|'='
name|'_db_content'
op|'['
string|"'VM'"
op|']'
op|'['
name|'vm_ref'
op|']'
newline|'\n'
name|'vm_rec'
op|'['
string|"'VBDs'"
op|']'
op|'.'
name|'remove'
op|'('
name|'vbd_ref'
op|')'
newline|'\n'
nl|'\n'
name|'vdi_ref'
op|'='
name|'vbd_rec'
op|'['
string|"'VDI'"
op|']'
newline|'\n'
name|'vdi_rec'
op|'='
name|'_db_content'
op|'['
string|"'VDI'"
op|']'
op|'['
name|'vdi_ref'
op|']'
newline|'\n'
name|'vdi_rec'
op|'['
string|"'VBDs'"
op|']'
op|'.'
name|'remove'
op|'('
name|'vbd_ref'
op|')'
newline|'\n'
nl|'\n'
name|'del'
name|'_db_content'
op|'['
string|"'VBD'"
op|']'
op|'['
name|'vbd_ref'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|destroy_vdi
dedent|''
name|'def'
name|'destroy_vdi'
op|'('
name|'vdi_ref'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'vdi_rec'
op|'='
name|'_db_content'
op|'['
string|"'VDI'"
op|']'
op|'['
name|'vdi_ref'
op|']'
newline|'\n'
nl|'\n'
name|'vbd_refs'
op|'='
name|'vdi_rec'
op|'['
string|"'VBDs'"
op|']'
newline|'\n'
comment|'# NOTE(johannes): Shallow copy since destroy_vbd will remove itself'
nl|'\n'
comment|'# from the list'
nl|'\n'
name|'for'
name|'vbd_ref'
name|'in'
name|'vbd_refs'
op|'['
op|':'
op|']'
op|':'
newline|'\n'
indent|'        '
name|'destroy_vbd'
op|'('
name|'vbd_ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'del'
name|'_db_content'
op|'['
string|"'VDI'"
op|']'
op|'['
name|'vdi_ref'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|create_vdi
dedent|''
name|'def'
name|'create_vdi'
op|'('
name|'name_label'
op|','
name|'sr_ref'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'vdi_rec'
op|'='
op|'{'
nl|'\n'
string|"'SR'"
op|':'
name|'sr_ref'
op|','
nl|'\n'
string|"'read_only'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'type'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'name_label'"
op|':'
name|'name_label'
op|','
nl|'\n'
string|"'name_description'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'sharable'"
op|':'
name|'False'
op|','
nl|'\n'
string|"'other_config'"
op|':'
op|'{'
op|'}'
op|','
nl|'\n'
string|"'location'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'xenstore_data'"
op|':'
op|'{'
op|'}'
op|','
nl|'\n'
string|"'sm_config'"
op|':'
op|'{'
string|"'vhd-parent'"
op|':'
name|'None'
op|'}'
op|','
nl|'\n'
string|"'physical_utilisation'"
op|':'
string|"'123'"
op|','
nl|'\n'
string|"'managed'"
op|':'
name|'True'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'vdi_rec'
op|'.'
name|'update'
op|'('
name|'kwargs'
op|')'
newline|'\n'
name|'vdi_ref'
op|'='
name|'_create_object'
op|'('
string|"'VDI'"
op|','
name|'vdi_rec'
op|')'
newline|'\n'
name|'after_VDI_create'
op|'('
name|'vdi_ref'
op|','
name|'vdi_rec'
op|')'
newline|'\n'
name|'return'
name|'vdi_ref'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|after_VDI_create
dedent|''
name|'def'
name|'after_VDI_create'
op|'('
name|'vdi_ref'
op|','
name|'vdi_rec'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'vdi_rec'
op|'.'
name|'setdefault'
op|'('
string|"'VBDs'"
op|','
op|'['
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|create_vbd
dedent|''
name|'def'
name|'create_vbd'
op|'('
name|'vm_ref'
op|','
name|'vdi_ref'
op|','
name|'userdevice'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'vbd_rec'
op|'='
op|'{'
string|"'VM'"
op|':'
name|'vm_ref'
op|','
nl|'\n'
string|"'VDI'"
op|':'
name|'vdi_ref'
op|','
nl|'\n'
string|"'userdevice'"
op|':'
name|'str'
op|'('
name|'userdevice'
op|')'
op|','
nl|'\n'
string|"'currently_attached'"
op|':'
name|'False'
op|'}'
newline|'\n'
name|'vbd_ref'
op|'='
name|'_create_object'
op|'('
string|"'VBD'"
op|','
name|'vbd_rec'
op|')'
newline|'\n'
name|'after_VBD_create'
op|'('
name|'vbd_ref'
op|','
name|'vbd_rec'
op|')'
newline|'\n'
name|'return'
name|'vbd_ref'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|after_VBD_create
dedent|''
name|'def'
name|'after_VBD_create'
op|'('
name|'vbd_ref'
op|','
name|'vbd_rec'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Create read-only fields and backref from VM and VDI to VBD when VBD\n    is created.\n    """'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'currently_attached'"
op|']'
op|'='
name|'False'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'device'"
op|']'
op|'='
string|"''"
newline|'\n'
nl|'\n'
name|'vm_ref'
op|'='
name|'vbd_rec'
op|'['
string|"'VM'"
op|']'
newline|'\n'
name|'vm_rec'
op|'='
name|'_db_content'
op|'['
string|"'VM'"
op|']'
op|'['
name|'vm_ref'
op|']'
newline|'\n'
name|'vm_rec'
op|'['
string|"'VBDs'"
op|']'
op|'.'
name|'append'
op|'('
name|'vbd_ref'
op|')'
newline|'\n'
nl|'\n'
name|'vm_name_label'
op|'='
name|'_db_content'
op|'['
string|"'VM'"
op|']'
op|'['
name|'vm_ref'
op|']'
op|'['
string|"'name_label'"
op|']'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'vm_name_label'"
op|']'
op|'='
name|'vm_name_label'
newline|'\n'
nl|'\n'
name|'vdi_ref'
op|'='
name|'vbd_rec'
op|'['
string|"'VDI'"
op|']'
newline|'\n'
name|'if'
name|'vdi_ref'
name|'and'
name|'vdi_ref'
op|'!='
string|'"OpaqueRef:NULL"'
op|':'
newline|'\n'
indent|'        '
name|'vdi_rec'
op|'='
name|'_db_content'
op|'['
string|"'VDI'"
op|']'
op|'['
name|'vdi_ref'
op|']'
newline|'\n'
name|'vdi_rec'
op|'['
string|"'VBDs'"
op|']'
op|'.'
name|'append'
op|'('
name|'vbd_ref'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|after_VM_create
dedent|''
dedent|''
name|'def'
name|'after_VM_create'
op|'('
name|'vm_ref'
op|','
name|'vm_rec'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Create read-only fields in the VM record."""'
newline|'\n'
name|'vm_rec'
op|'.'
name|'setdefault'
op|'('
string|"'domid'"
op|','
op|'-'
number|'1'
op|')'
newline|'\n'
name|'vm_rec'
op|'.'
name|'setdefault'
op|'('
string|"'is_control_domain'"
op|','
name|'False'
op|')'
newline|'\n'
name|'vm_rec'
op|'.'
name|'setdefault'
op|'('
string|"'is_a_template'"
op|','
name|'False'
op|')'
newline|'\n'
name|'vm_rec'
op|'.'
name|'setdefault'
op|'('
string|"'memory_static_max'"
op|','
name|'str'
op|'('
number|'8'
op|'*'
name|'units'
op|'.'
name|'Gi'
op|')'
op|')'
newline|'\n'
name|'vm_rec'
op|'.'
name|'setdefault'
op|'('
string|"'memory_dynamic_max'"
op|','
name|'str'
op|'('
number|'8'
op|'*'
name|'units'
op|'.'
name|'Gi'
op|')'
op|')'
newline|'\n'
name|'vm_rec'
op|'.'
name|'setdefault'
op|'('
string|"'VCPUs_max'"
op|','
name|'str'
op|'('
number|'4'
op|')'
op|')'
newline|'\n'
name|'vm_rec'
op|'.'
name|'setdefault'
op|'('
string|"'VBDs'"
op|','
op|'['
op|']'
op|')'
newline|'\n'
name|'vm_rec'
op|'.'
name|'setdefault'
op|'('
string|"'resident_on'"
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|create_pbd
dedent|''
name|'def'
name|'create_pbd'
op|'('
name|'host_ref'
op|','
name|'sr_ref'
op|','
name|'attached'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'config'
op|'='
op|'{'
string|"'path'"
op|':'
string|"'/var/run/sr-mount/%s'"
op|'%'
name|'sr_ref'
op|'}'
newline|'\n'
name|'return'
name|'_create_object'
op|'('
string|"'PBD'"
op|','
nl|'\n'
op|'{'
string|"'device_config'"
op|':'
name|'config'
op|','
nl|'\n'
string|"'host'"
op|':'
name|'host_ref'
op|','
nl|'\n'
string|"'SR'"
op|':'
name|'sr_ref'
op|','
nl|'\n'
string|"'currently_attached'"
op|':'
name|'attached'
op|'}'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|create_task
dedent|''
name|'def'
name|'create_task'
op|'('
name|'name_label'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'_create_object'
op|'('
string|"'task'"
op|','
nl|'\n'
op|'{'
string|"'name_label'"
op|':'
name|'name_label'
op|','
nl|'\n'
string|"'status'"
op|':'
string|"'pending'"
op|'}'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_create_local_srs
dedent|''
name|'def'
name|'_create_local_srs'
op|'('
name|'host_ref'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Create an SR that looks like the one created on the local disk by\n    default by the XenServer installer.  Also, fake the installation of\n    an ISO SR.\n    """'
newline|'\n'
name|'create_sr'
op|'('
name|'name_label'
op|'='
string|"'Local storage ISO'"
op|','
nl|'\n'
name|'type'
op|'='
string|"'iso'"
op|','
nl|'\n'
name|'other_config'
op|'='
op|'{'
string|"'i18n-original-value-name_label'"
op|':'
nl|'\n'
string|"'Local storage ISO'"
op|','
nl|'\n'
string|"'i18n-key'"
op|':'
string|"'local-storage-iso'"
op|'}'
op|','
nl|'\n'
name|'physical_size'
op|'='
number|'80000'
op|','
nl|'\n'
name|'physical_utilisation'
op|'='
number|'40000'
op|','
nl|'\n'
name|'virtual_allocation'
op|'='
number|'80000'
op|','
nl|'\n'
name|'host_ref'
op|'='
name|'host_ref'
op|')'
newline|'\n'
name|'return'
name|'create_sr'
op|'('
name|'name_label'
op|'='
string|"'Local storage'"
op|','
nl|'\n'
name|'type'
op|'='
string|"'ext'"
op|','
nl|'\n'
name|'other_config'
op|'='
op|'{'
string|"'i18n-original-value-name_label'"
op|':'
nl|'\n'
string|"'Local storage'"
op|','
nl|'\n'
string|"'i18n-key'"
op|':'
string|"'local-storage'"
op|'}'
op|','
nl|'\n'
name|'physical_size'
op|'='
number|'40000'
op|','
nl|'\n'
name|'physical_utilisation'
op|'='
number|'20000'
op|','
nl|'\n'
name|'virtual_allocation'
op|'='
number|'10000'
op|','
nl|'\n'
name|'host_ref'
op|'='
name|'host_ref'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|create_sr
dedent|''
name|'def'
name|'create_sr'
op|'('
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'sr_ref'
op|'='
name|'_create_object'
op|'('
nl|'\n'
string|"'SR'"
op|','
nl|'\n'
op|'{'
string|"'name_label'"
op|':'
name|'kwargs'
op|'.'
name|'get'
op|'('
string|"'name_label'"
op|')'
op|','
nl|'\n'
string|"'type'"
op|':'
name|'kwargs'
op|'.'
name|'get'
op|'('
string|"'type'"
op|')'
op|','
nl|'\n'
string|"'content_type'"
op|':'
name|'kwargs'
op|'.'
name|'get'
op|'('
string|"'type'"
op|','
string|"'user'"
op|')'
op|','
nl|'\n'
string|"'shared'"
op|':'
name|'kwargs'
op|'.'
name|'get'
op|'('
string|"'shared'"
op|','
name|'False'
op|')'
op|','
nl|'\n'
string|"'physical_size'"
op|':'
name|'kwargs'
op|'.'
name|'get'
op|'('
string|"'physical_size'"
op|','
name|'str'
op|'('
number|'1'
op|'<<'
number|'30'
op|')'
op|')'
op|','
nl|'\n'
string|"'physical_utilisation'"
op|':'
name|'str'
op|'('
nl|'\n'
name|'kwargs'
op|'.'
name|'get'
op|'('
string|"'physical_utilisation'"
op|','
number|'0'
op|')'
op|')'
op|','
nl|'\n'
string|"'virtual_allocation'"
op|':'
name|'str'
op|'('
name|'kwargs'
op|'.'
name|'get'
op|'('
string|"'virtual_allocation'"
op|','
number|'0'
op|')'
op|')'
op|','
nl|'\n'
string|"'other_config'"
op|':'
name|'kwargs'
op|'.'
name|'get'
op|'('
string|"'other_config'"
op|','
op|'{'
op|'}'
op|')'
op|','
nl|'\n'
string|"'VDIs'"
op|':'
name|'kwargs'
op|'.'
name|'get'
op|'('
string|"'VDIs'"
op|','
op|'['
op|']'
op|')'
op|'}'
op|')'
newline|'\n'
name|'pbd_ref'
op|'='
name|'create_pbd'
op|'('
name|'kwargs'
op|'.'
name|'get'
op|'('
string|"'host_ref'"
op|')'
op|','
name|'sr_ref'
op|','
name|'True'
op|')'
newline|'\n'
name|'_db_content'
op|'['
string|"'SR'"
op|']'
op|'['
name|'sr_ref'
op|']'
op|'['
string|"'PBDs'"
op|']'
op|'='
op|'['
name|'pbd_ref'
op|']'
newline|'\n'
name|'return'
name|'sr_ref'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_create_local_pif
dedent|''
name|'def'
name|'_create_local_pif'
op|'('
name|'host_ref'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'pif_ref'
op|'='
name|'_create_object'
op|'('
string|"'PIF'"
op|','
nl|'\n'
op|'{'
string|"'name-label'"
op|':'
string|"'Fake PIF'"
op|','
nl|'\n'
string|"'MAC'"
op|':'
string|"'00:11:22:33:44:55'"
op|','
nl|'\n'
string|"'physical'"
op|':'
name|'True'
op|','
nl|'\n'
string|"'VLAN'"
op|':'
op|'-'
number|'1'
op|','
nl|'\n'
string|"'device'"
op|':'
string|"'fake0'"
op|','
nl|'\n'
string|"'host_uuid'"
op|':'
name|'host_ref'
op|','
nl|'\n'
string|"'network'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'IP'"
op|':'
string|"'10.1.1.1'"
op|','
nl|'\n'
string|"'IPv6'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'uuid'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'management'"
op|':'
string|"'true'"
op|'}'
op|')'
newline|'\n'
name|'_db_content'
op|'['
string|"'PIF'"
op|']'
op|'['
name|'pif_ref'
op|']'
op|'['
string|"'uuid'"
op|']'
op|'='
name|'pif_ref'
newline|'\n'
name|'return'
name|'pif_ref'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_create_object
dedent|''
name|'def'
name|'_create_object'
op|'('
name|'table'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'ref'
op|'='
name|'str'
op|'('
name|'uuid'
op|'.'
name|'uuid4'
op|'('
op|')'
op|')'
newline|'\n'
name|'obj'
op|'['
string|"'uuid'"
op|']'
op|'='
name|'str'
op|'('
name|'uuid'
op|'.'
name|'uuid4'
op|'('
op|')'
op|')'
newline|'\n'
name|'_db_content'
op|'['
name|'table'
op|']'
op|'['
name|'ref'
op|']'
op|'='
name|'obj'
newline|'\n'
name|'return'
name|'ref'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_create_sr
dedent|''
name|'def'
name|'_create_sr'
op|'('
name|'table'
op|','
name|'obj'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'sr_type'
op|'='
name|'obj'
op|'['
number|'6'
op|']'
newline|'\n'
comment|'# Forces fake to support iscsi only'
nl|'\n'
name|'if'
name|'sr_type'
op|'!='
string|"'iscsi'"
name|'and'
name|'sr_type'
op|'!='
string|"'nfs'"
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'Failure'
op|'('
op|'['
string|"'SR_UNKNOWN_DRIVER'"
op|','
name|'sr_type'
op|']'
op|')'
newline|'\n'
dedent|''
name|'host_ref'
op|'='
name|'_db_content'
op|'['
string|"'host'"
op|']'
op|'.'
name|'keys'
op|'('
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'sr_ref'
op|'='
name|'_create_object'
op|'('
name|'table'
op|','
name|'obj'
op|'['
number|'2'
op|']'
op|')'
newline|'\n'
name|'if'
name|'sr_type'
op|'=='
string|"'iscsi'"
op|':'
newline|'\n'
indent|'        '
name|'vdi_ref'
op|'='
name|'create_vdi'
op|'('
string|"''"
op|','
name|'sr_ref'
op|')'
newline|'\n'
name|'pbd_ref'
op|'='
name|'create_pbd'
op|'('
name|'host_ref'
op|','
name|'sr_ref'
op|','
name|'True'
op|')'
newline|'\n'
name|'_db_content'
op|'['
string|"'SR'"
op|']'
op|'['
name|'sr_ref'
op|']'
op|'['
string|"'VDIs'"
op|']'
op|'='
op|'['
name|'vdi_ref'
op|']'
newline|'\n'
name|'_db_content'
op|'['
string|"'SR'"
op|']'
op|'['
name|'sr_ref'
op|']'
op|'['
string|"'PBDs'"
op|']'
op|'='
op|'['
name|'pbd_ref'
op|']'
newline|'\n'
name|'_db_content'
op|'['
string|"'VDI'"
op|']'
op|'['
name|'vdi_ref'
op|']'
op|'['
string|"'SR'"
op|']'
op|'='
name|'sr_ref'
newline|'\n'
name|'_db_content'
op|'['
string|"'PBD'"
op|']'
op|'['
name|'pbd_ref'
op|']'
op|'['
string|"'SR'"
op|']'
op|'='
name|'sr_ref'
newline|'\n'
dedent|''
name|'return'
name|'sr_ref'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_create_vlan
dedent|''
name|'def'
name|'_create_vlan'
op|'('
name|'pif_ref'
op|','
name|'vlan_num'
op|','
name|'network_ref'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'pif_rec'
op|'='
name|'get_record'
op|'('
string|"'PIF'"
op|','
name|'pif_ref'
op|')'
newline|'\n'
name|'vlan_pif_ref'
op|'='
name|'_create_object'
op|'('
string|"'PIF'"
op|','
nl|'\n'
op|'{'
string|"'name-label'"
op|':'
string|"'Fake VLAN PIF'"
op|','
nl|'\n'
string|"'MAC'"
op|':'
string|"'00:11:22:33:44:55'"
op|','
nl|'\n'
string|"'physical'"
op|':'
name|'True'
op|','
nl|'\n'
string|"'VLAN'"
op|':'
name|'vlan_num'
op|','
nl|'\n'
string|"'device'"
op|':'
name|'pif_rec'
op|'['
string|"'device'"
op|']'
op|','
nl|'\n'
string|"'host_uuid'"
op|':'
name|'pif_rec'
op|'['
string|"'host_uuid'"
op|']'
op|'}'
op|')'
newline|'\n'
name|'return'
name|'_create_object'
op|'('
string|"'VLAN'"
op|','
nl|'\n'
op|'{'
string|"'tagged-pif'"
op|':'
name|'pif_ref'
op|','
nl|'\n'
string|"'untagged-pif'"
op|':'
name|'vlan_pif_ref'
op|','
nl|'\n'
string|"'tag'"
op|':'
name|'vlan_num'
op|'}'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|get_all
dedent|''
name|'def'
name|'get_all'
op|'('
name|'table'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'_db_content'
op|'['
name|'table'
op|']'
op|'.'
name|'keys'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|get_all_records
dedent|''
name|'def'
name|'get_all_records'
op|'('
name|'table'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'return'
name|'_db_content'
op|'['
name|'table'
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_query_matches
dedent|''
name|'def'
name|'_query_matches'
op|'('
name|'record'
op|','
name|'query'
op|')'
op|':'
newline|'\n'
comment|'# Simple support for the XenServer query language:'
nl|'\n'
comment|'# \'field "host"="<uuid>" and field "SR"="<sr uuid>"\''
nl|'\n'
comment|'# Tested through existing tests (e.g. calls to find_network_with_bridge)'
nl|'\n'
nl|'\n'
indent|'    '
name|'and_clauses'
op|'='
name|'query'
op|'.'
name|'split'
op|'('
string|'" and "'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'and_clauses'
op|')'
op|'>'
number|'1'
op|':'
newline|'\n'
indent|'        '
name|'matches'
op|'='
name|'True'
newline|'\n'
name|'for'
name|'clause'
name|'in'
name|'and_clauses'
op|':'
newline|'\n'
indent|'            '
name|'matches'
op|'='
name|'matches'
name|'and'
name|'_query_matches'
op|'('
name|'record'
op|','
name|'clause'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'matches'
newline|'\n'
nl|'\n'
dedent|''
name|'or_clauses'
op|'='
name|'query'
op|'.'
name|'split'
op|'('
string|'" or "'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'or_clauses'
op|')'
op|'>'
number|'1'
op|':'
newline|'\n'
indent|'        '
name|'matches'
op|'='
name|'False'
newline|'\n'
name|'for'
name|'clause'
name|'in'
name|'or_clauses'
op|':'
newline|'\n'
indent|'            '
name|'matches'
op|'='
name|'matches'
name|'or'
name|'_query_matches'
op|'('
name|'record'
op|','
name|'clause'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'matches'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'query'
op|'['
op|':'
number|'4'
op|']'
op|'=='
string|"'not '"
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'not'
name|'_query_matches'
op|'('
name|'record'
op|','
name|'query'
op|'['
number|'4'
op|':'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Now it must be a single field - bad queries never match'
nl|'\n'
dedent|''
name|'if'
name|'query'
op|'['
op|':'
number|'5'
op|']'
op|'!='
string|"'field'"
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'False'
newline|'\n'
dedent|''
op|'('
name|'field'
op|','
name|'value'
op|')'
op|'='
name|'query'
op|'['
number|'6'
op|':'
op|']'
op|'.'
name|'split'
op|'('
string|"'='"
op|','
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|'# Some fields (e.g. name_label, memory_overhead) have double'
nl|'\n'
comment|'# underscores in the DB, but only single underscores when querying'
nl|'\n'
nl|'\n'
name|'field'
op|'='
name|'field'
op|'.'
name|'replace'
op|'('
string|'"__"'
op|','
string|'"_"'
op|')'
op|'.'
name|'strip'
op|'('
string|'" \\"\'"'
op|')'
newline|'\n'
name|'value'
op|'='
name|'value'
op|'.'
name|'strip'
op|'('
string|'" \\"\'"'
op|')'
newline|'\n'
nl|'\n'
comment|'# Strings should be directly compared'
nl|'\n'
name|'if'
name|'isinstance'
op|'('
name|'record'
op|'['
name|'field'
op|']'
op|','
name|'str'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'record'
op|'['
name|'field'
op|']'
op|'=='
name|'value'
newline|'\n'
nl|'\n'
comment|'# But for all other value-checks, convert to a string first'
nl|'\n'
comment|'# (Notably used for booleans - which can be lower or camel'
nl|'\n'
comment|'# case and are interpreted/sanitised by XAPI)'
nl|'\n'
dedent|''
name|'return'
name|'str'
op|'('
name|'record'
op|'['
name|'field'
op|']'
op|')'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
name|'value'
op|'.'
name|'lower'
op|'('
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|get_all_records_where
dedent|''
name|'def'
name|'get_all_records_where'
op|'('
name|'table_name'
op|','
name|'query'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'matching_records'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'table'
op|'='
name|'_db_content'
op|'['
name|'table_name'
op|']'
newline|'\n'
name|'for'
name|'record'
name|'in'
name|'table'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'_query_matches'
op|'('
name|'table'
op|'['
name|'record'
op|']'
op|','
name|'query'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'matching_records'
op|'['
name|'record'
op|']'
op|'='
name|'table'
op|'['
name|'record'
op|']'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'matching_records'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|get_record
dedent|''
name|'def'
name|'get_record'
op|'('
name|'table'
op|','
name|'ref'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'ref'
name|'in'
name|'_db_content'
op|'['
name|'table'
op|']'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'_db_content'
op|'['
name|'table'
op|']'
op|'.'
name|'get'
op|'('
name|'ref'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'Failure'
op|'('
op|'['
string|"'HANDLE_INVALID'"
op|','
name|'table'
op|','
name|'ref'
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|check_for_session_leaks
dedent|''
dedent|''
name|'def'
name|'check_for_session_leaks'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'len'
op|'('
name|'_db_content'
op|'['
string|"'session'"
op|']'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'exception'
op|'.'
name|'NovaException'
op|'('
string|"'Sessions have leaked: %s'"
op|'%'
nl|'\n'
name|'_db_content'
op|'['
string|"'session'"
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|as_value
dedent|''
dedent|''
name|'def'
name|'as_value'
op|'('
name|'s'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Helper function for simulating XenAPI plugin responses.  It\n    escapes and wraps the given argument.\n    """'
newline|'\n'
name|'return'
string|"'<value>%s</value>'"
op|'%'
name|'saxutils'
op|'.'
name|'escape'
op|'('
name|'s'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|as_json
dedent|''
name|'def'
name|'as_json'
op|'('
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Helper function for simulating XenAPI plugin responses for those\n    that are returning JSON.  If this function is given plain arguments,\n    then these are rendered as a JSON list.  If it\'s given keyword\n    arguments then these are rendered as a JSON dict.\n    """'
newline|'\n'
name|'arg'
op|'='
name|'args'
name|'or'
name|'kwargs'
newline|'\n'
name|'return'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
name|'arg'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|Failure
dedent|''
name|'class'
name|'Failure'
op|'('
name|'Exception'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'details'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'details'
op|'='
name|'details'
newline|'\n'
nl|'\n'
DECL|member|__str__
dedent|''
name|'def'
name|'__str__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'str'
op|'('
name|'self'
op|'.'
name|'details'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|'"XenAPI Fake Failure: %s"'
op|'%'
name|'str'
op|'('
name|'self'
op|'.'
name|'details'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_details_map
dedent|''
dedent|''
name|'def'
name|'_details_map'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'dict'
op|'('
op|'['
op|'('
name|'str'
op|'('
name|'i'
op|')'
op|','
name|'self'
op|'.'
name|'details'
op|'['
name|'i'
op|']'
op|')'
nl|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'len'
op|'('
name|'self'
op|'.'
name|'details'
op|')'
op|')'
op|']'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SessionBase
dedent|''
dedent|''
name|'class'
name|'SessionBase'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Base class for Fake Sessions."""'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'uri'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_session'
op|'='
name|'None'
newline|'\n'
name|'xenapi_session'
op|'.'
name|'apply_session_helpers'
op|'('
name|'self'
op|')'
newline|'\n'
nl|'\n'
DECL|member|pool_get_default_SR
dedent|''
name|'def'
name|'pool_get_default_SR'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'pool_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'_db_content'
op|'['
string|"'pool'"
op|']'
op|'.'
name|'values'
op|'('
op|')'
op|'['
number|'0'
op|']'
op|'['
string|"'default-SR'"
op|']'
newline|'\n'
nl|'\n'
DECL|member|VBD_insert
dedent|''
name|'def'
name|'VBD_insert'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'vbd_ref'
op|','
name|'vdi_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vbd_rec'
op|'='
name|'get_record'
op|'('
string|"'VBD'"
op|','
name|'vbd_ref'
op|')'
newline|'\n'
name|'get_record'
op|'('
string|"'VDI'"
op|','
name|'vdi_ref'
op|')'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'empty'"
op|']'
op|'='
name|'False'
newline|'\n'
name|'vbd_rec'
op|'['
string|"'VDI'"
op|']'
op|'='
name|'vdi_ref'
newline|'\n'
nl|'\n'
DECL|member|VBD_plug
dedent|''
name|'def'
name|'VBD_plug'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'rec'
op|'='
name|'get_record'
op|'('
string|"'VBD'"
op|','
name|'ref'
op|')'
newline|'\n'
name|'if'
name|'rec'
op|'['
string|"'currently_attached'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Failure'
op|'('
op|'['
string|"'DEVICE_ALREADY_ATTACHED'"
op|','
name|'ref'
op|']'
op|')'
newline|'\n'
dedent|''
name|'rec'
op|'['
string|"'currently_attached'"
op|']'
op|'='
name|'True'
newline|'\n'
name|'rec'
op|'['
string|"'device'"
op|']'
op|'='
name|'rec'
op|'['
string|"'userdevice'"
op|']'
newline|'\n'
nl|'\n'
DECL|member|VBD_unplug
dedent|''
name|'def'
name|'VBD_unplug'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'rec'
op|'='
name|'get_record'
op|'('
string|"'VBD'"
op|','
name|'ref'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'rec'
op|'['
string|"'currently_attached'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Failure'
op|'('
op|'['
string|"'DEVICE_ALREADY_DETACHED'"
op|','
name|'ref'
op|']'
op|')'
newline|'\n'
dedent|''
name|'rec'
op|'['
string|"'currently_attached'"
op|']'
op|'='
name|'False'
newline|'\n'
name|'rec'
op|'['
string|"'device'"
op|']'
op|'='
string|"''"
newline|'\n'
nl|'\n'
DECL|member|VBD_add_to_other_config
dedent|''
name|'def'
name|'VBD_add_to_other_config'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'vbd_ref'
op|','
name|'key'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_ref'
op|'='
name|'_db_content'
op|'['
string|"'VBD'"
op|']'
op|'['
name|'vbd_ref'
op|']'
newline|'\n'
name|'if'
string|"'other_config'"
name|'not'
name|'in'
name|'db_ref'
op|':'
newline|'\n'
indent|'            '
name|'db_ref'
op|'['
string|"'other_config'"
op|']'
op|'='
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'if'
name|'key'
name|'in'
name|'db_ref'
op|'['
string|"'other_config'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Failure'
op|'('
op|'['
string|"'MAP_DUPLICATE_KEY'"
op|','
string|"'VBD'"
op|','
string|"'other_config'"
op|','
nl|'\n'
name|'vbd_ref'
op|','
name|'key'
op|']'
op|')'
newline|'\n'
dedent|''
name|'db_ref'
op|'['
string|"'other_config'"
op|']'
op|'['
name|'key'
op|']'
op|'='
name|'value'
newline|'\n'
nl|'\n'
DECL|member|VBD_get_other_config
dedent|''
name|'def'
name|'VBD_get_other_config'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'vbd_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_ref'
op|'='
name|'_db_content'
op|'['
string|"'VBD'"
op|']'
op|'['
name|'vbd_ref'
op|']'
newline|'\n'
name|'if'
string|"'other_config'"
name|'not'
name|'in'
name|'db_ref'
op|':'
newline|'\n'
indent|'            '
name|'return'
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'return'
name|'db_ref'
op|'['
string|"'other_config'"
op|']'
newline|'\n'
nl|'\n'
DECL|member|PBD_create
dedent|''
name|'def'
name|'PBD_create'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'pbd_rec'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pbd_ref'
op|'='
name|'_create_object'
op|'('
string|"'PBD'"
op|','
name|'pbd_rec'
op|')'
newline|'\n'
name|'_db_content'
op|'['
string|"'PBD'"
op|']'
op|'['
name|'pbd_ref'
op|']'
op|'['
string|"'currently_attached'"
op|']'
op|'='
name|'False'
newline|'\n'
name|'return'
name|'pbd_ref'
newline|'\n'
nl|'\n'
DECL|member|PBD_plug
dedent|''
name|'def'
name|'PBD_plug'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'pbd_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'rec'
op|'='
name|'get_record'
op|'('
string|"'PBD'"
op|','
name|'pbd_ref'
op|')'
newline|'\n'
name|'if'
name|'rec'
op|'['
string|"'currently_attached'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Failure'
op|'('
op|'['
string|"'DEVICE_ALREADY_ATTACHED'"
op|','
name|'rec'
op|']'
op|')'
newline|'\n'
dedent|''
name|'rec'
op|'['
string|"'currently_attached'"
op|']'
op|'='
name|'True'
newline|'\n'
name|'sr_ref'
op|'='
name|'rec'
op|'['
string|"'SR'"
op|']'
newline|'\n'
name|'_db_content'
op|'['
string|"'SR'"
op|']'
op|'['
name|'sr_ref'
op|']'
op|'['
string|"'PBDs'"
op|']'
op|'='
op|'['
name|'pbd_ref'
op|']'
newline|'\n'
nl|'\n'
DECL|member|PBD_unplug
dedent|''
name|'def'
name|'PBD_unplug'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'pbd_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'rec'
op|'='
name|'get_record'
op|'('
string|"'PBD'"
op|','
name|'pbd_ref'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'rec'
op|'['
string|"'currently_attached'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Failure'
op|'('
op|'['
string|"'DEVICE_ALREADY_DETACHED'"
op|','
name|'rec'
op|']'
op|')'
newline|'\n'
dedent|''
name|'rec'
op|'['
string|"'currently_attached'"
op|']'
op|'='
name|'False'
newline|'\n'
name|'sr_ref'
op|'='
name|'rec'
op|'['
string|"'SR'"
op|']'
newline|'\n'
name|'_db_content'
op|'['
string|"'SR'"
op|']'
op|'['
name|'sr_ref'
op|']'
op|'['
string|"'PBDs'"
op|']'
op|'.'
name|'remove'
op|'('
name|'pbd_ref'
op|')'
newline|'\n'
nl|'\n'
DECL|member|SR_introduce
dedent|''
name|'def'
name|'SR_introduce'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'sr_uuid'
op|','
name|'label'
op|','
name|'desc'
op|','
name|'type'
op|','
name|'content_type'
op|','
nl|'\n'
name|'shared'
op|','
name|'sm_config'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'ref'
op|'='
name|'None'
newline|'\n'
name|'rec'
op|'='
name|'None'
newline|'\n'
name|'for'
name|'ref'
op|','
name|'rec'
name|'in'
name|'_db_content'
op|'['
string|"'SR'"
op|']'
op|'.'
name|'iteritems'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'rec'
op|'.'
name|'get'
op|'('
string|"'uuid'"
op|')'
op|'=='
name|'sr_uuid'
op|':'
newline|'\n'
comment|'# make forgotten = 0 and return ref'
nl|'\n'
indent|'                '
name|'_db_content'
op|'['
string|"'SR'"
op|']'
op|'['
name|'ref'
op|']'
op|'['
string|"'forgotten'"
op|']'
op|'='
number|'0'
newline|'\n'
name|'return'
name|'ref'
newline|'\n'
comment|'# SR not found in db, so we create one'
nl|'\n'
dedent|''
dedent|''
name|'params'
op|'='
op|'{'
string|"'sr_uuid'"
op|':'
name|'sr_uuid'
op|','
nl|'\n'
string|"'label'"
op|':'
name|'label'
op|','
nl|'\n'
string|"'desc'"
op|':'
name|'desc'
op|','
nl|'\n'
string|"'type'"
op|':'
name|'type'
op|','
nl|'\n'
string|"'content_type'"
op|':'
name|'content_type'
op|','
nl|'\n'
string|"'shared'"
op|':'
name|'shared'
op|','
nl|'\n'
string|"'sm_config'"
op|':'
name|'sm_config'
op|'}'
newline|'\n'
name|'sr_ref'
op|'='
name|'_create_object'
op|'('
string|"'SR'"
op|','
name|'params'
op|')'
newline|'\n'
name|'_db_content'
op|'['
string|"'SR'"
op|']'
op|'['
name|'sr_ref'
op|']'
op|'['
string|"'uuid'"
op|']'
op|'='
name|'sr_uuid'
newline|'\n'
name|'_db_content'
op|'['
string|"'SR'"
op|']'
op|'['
name|'sr_ref'
op|']'
op|'['
string|"'forgotten'"
op|']'
op|'='
number|'0'
newline|'\n'
name|'vdi_per_lun'
op|'='
name|'False'
newline|'\n'
name|'if'
name|'type'
op|'=='
string|"'iscsi'"
op|':'
newline|'\n'
comment|'# Just to be clear'
nl|'\n'
indent|'            '
name|'vdi_per_lun'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'if'
name|'vdi_per_lun'
op|':'
newline|'\n'
comment|'# we need to create a vdi because this introduce'
nl|'\n'
comment|'# is likely meant for a single vdi'
nl|'\n'
indent|'            '
name|'vdi_ref'
op|'='
name|'create_vdi'
op|'('
string|"''"
op|','
name|'sr_ref'
op|')'
newline|'\n'
name|'_db_content'
op|'['
string|"'SR'"
op|']'
op|'['
name|'sr_ref'
op|']'
op|'['
string|"'VDIs'"
op|']'
op|'='
op|'['
name|'vdi_ref'
op|']'
newline|'\n'
name|'_db_content'
op|'['
string|"'VDI'"
op|']'
op|'['
name|'vdi_ref'
op|']'
op|'['
string|"'SR'"
op|']'
op|'='
name|'sr_ref'
newline|'\n'
dedent|''
name|'return'
name|'sr_ref'
newline|'\n'
nl|'\n'
DECL|member|SR_forget
dedent|''
name|'def'
name|'SR_forget'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'sr_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'_db_content'
op|'['
string|"'SR'"
op|']'
op|'['
name|'sr_ref'
op|']'
op|'['
string|"'forgotten'"
op|']'
op|'='
number|'1'
newline|'\n'
nl|'\n'
DECL|member|SR_scan
dedent|''
name|'def'
name|'SR_scan'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'sr_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
newline|'\n'
nl|'\n'
DECL|member|VM_get_xenstore_data
dedent|''
name|'def'
name|'VM_get_xenstore_data'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'vm_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'_db_content'
op|'['
string|"'VM'"
op|']'
op|'['
name|'vm_ref'
op|']'
op|'.'
name|'get'
op|'('
string|"'xenstore_data'"
op|','
op|'{'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|VM_remove_from_xenstore_data
dedent|''
name|'def'
name|'VM_remove_from_xenstore_data'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'vm_ref'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_ref'
op|'='
name|'_db_content'
op|'['
string|"'VM'"
op|']'
op|'['
name|'vm_ref'
op|']'
newline|'\n'
name|'if'
string|"'xenstore_data'"
name|'not'
name|'in'
name|'db_ref'
op|':'
newline|'\n'
indent|'            '
name|'return'
newline|'\n'
dedent|''
name|'if'
name|'key'
name|'in'
name|'db_ref'
op|'['
string|"'xenstore_data'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'del'
name|'db_ref'
op|'['
string|"'xenstore_data'"
op|']'
op|'['
name|'key'
op|']'
newline|'\n'
nl|'\n'
DECL|member|VM_add_to_xenstore_data
dedent|''
dedent|''
name|'def'
name|'VM_add_to_xenstore_data'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'vm_ref'
op|','
name|'key'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_ref'
op|'='
name|'_db_content'
op|'['
string|"'VM'"
op|']'
op|'['
name|'vm_ref'
op|']'
newline|'\n'
name|'if'
string|"'xenstore_data'"
name|'not'
name|'in'
name|'db_ref'
op|':'
newline|'\n'
indent|'            '
name|'db_ref'
op|'['
string|"'xenstore_data'"
op|']'
op|'='
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'db_ref'
op|'['
string|"'xenstore_data'"
op|']'
op|'['
name|'key'
op|']'
op|'='
name|'value'
newline|'\n'
nl|'\n'
DECL|member|VM_pool_migrate
dedent|''
name|'def'
name|'VM_pool_migrate'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'vm_ref'
op|','
name|'host_ref'
op|','
name|'options'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|VDI_remove_from_other_config
dedent|''
name|'def'
name|'VDI_remove_from_other_config'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'vdi_ref'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_ref'
op|'='
name|'_db_content'
op|'['
string|"'VDI'"
op|']'
op|'['
name|'vdi_ref'
op|']'
newline|'\n'
name|'if'
string|"'other_config'"
name|'not'
name|'in'
name|'db_ref'
op|':'
newline|'\n'
indent|'            '
name|'return'
newline|'\n'
dedent|''
name|'if'
name|'key'
name|'in'
name|'db_ref'
op|'['
string|"'other_config'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'del'
name|'db_ref'
op|'['
string|"'other_config'"
op|']'
op|'['
name|'key'
op|']'
newline|'\n'
nl|'\n'
DECL|member|VDI_add_to_other_config
dedent|''
dedent|''
name|'def'
name|'VDI_add_to_other_config'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'vdi_ref'
op|','
name|'key'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_ref'
op|'='
name|'_db_content'
op|'['
string|"'VDI'"
op|']'
op|'['
name|'vdi_ref'
op|']'
newline|'\n'
name|'if'
string|"'other_config'"
name|'not'
name|'in'
name|'db_ref'
op|':'
newline|'\n'
indent|'            '
name|'db_ref'
op|'['
string|"'other_config'"
op|']'
op|'='
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'if'
name|'key'
name|'in'
name|'db_ref'
op|'['
string|"'other_config'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Failure'
op|'('
op|'['
string|"'MAP_DUPLICATE_KEY'"
op|','
string|"'VDI'"
op|','
string|"'other_config'"
op|','
nl|'\n'
name|'vdi_ref'
op|','
name|'key'
op|']'
op|')'
newline|'\n'
dedent|''
name|'db_ref'
op|'['
string|"'other_config'"
op|']'
op|'['
name|'key'
op|']'
op|'='
name|'value'
newline|'\n'
nl|'\n'
DECL|member|VDI_copy
dedent|''
name|'def'
name|'VDI_copy'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'vdi_to_copy_ref'
op|','
name|'sr_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_ref'
op|'='
name|'_db_content'
op|'['
string|"'VDI'"
op|']'
op|'['
name|'vdi_to_copy_ref'
op|']'
newline|'\n'
name|'name_label'
op|'='
name|'db_ref'
op|'['
string|"'name_label'"
op|']'
newline|'\n'
name|'read_only'
op|'='
name|'db_ref'
op|'['
string|"'read_only'"
op|']'
newline|'\n'
name|'sharable'
op|'='
name|'db_ref'
op|'['
string|"'sharable'"
op|']'
newline|'\n'
name|'other_config'
op|'='
name|'db_ref'
op|'['
string|"'other_config'"
op|']'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'return'
name|'create_vdi'
op|'('
name|'name_label'
op|','
name|'sr_ref'
op|','
name|'sharable'
op|'='
name|'sharable'
op|','
nl|'\n'
name|'read_only'
op|'='
name|'read_only'
op|','
name|'other_config'
op|'='
name|'other_config'
op|')'
newline|'\n'
nl|'\n'
DECL|member|VDI_clone
dedent|''
name|'def'
name|'VDI_clone'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'vdi_to_clone_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_ref'
op|'='
name|'_db_content'
op|'['
string|"'VDI'"
op|']'
op|'['
name|'vdi_to_clone_ref'
op|']'
newline|'\n'
name|'sr_ref'
op|'='
name|'db_ref'
op|'['
string|"'SR'"
op|']'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'VDI_copy'
op|'('
name|'_1'
op|','
name|'vdi_to_clone_ref'
op|','
name|'sr_ref'
op|')'
newline|'\n'
nl|'\n'
DECL|member|host_compute_free_memory
dedent|''
name|'def'
name|'host_compute_free_memory'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'ref'
op|')'
op|':'
newline|'\n'
comment|'#Always return 12GB available'
nl|'\n'
indent|'        '
name|'return'
number|'12'
op|'*'
name|'units'
op|'.'
name|'Gi'
newline|'\n'
nl|'\n'
DECL|member|_plugin_agent_version
dedent|''
name|'def'
name|'_plugin_agent_version'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'as_json'
op|'('
name|'returncode'
op|'='
string|"'0'"
op|','
name|'message'
op|'='
string|"'1.0\\\\r\\\\n'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_plugin_agent_key_init
dedent|''
name|'def'
name|'_plugin_agent_key_init'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'as_json'
op|'('
name|'returncode'
op|'='
string|"'D0'"
op|','
name|'message'
op|'='
string|"'1'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_plugin_agent_password
dedent|''
name|'def'
name|'_plugin_agent_password'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'as_json'
op|'('
name|'returncode'
op|'='
string|"'0'"
op|','
name|'message'
op|'='
string|"'success'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_plugin_agent_inject_file
dedent|''
name|'def'
name|'_plugin_agent_inject_file'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'as_json'
op|'('
name|'returncode'
op|'='
string|"'0'"
op|','
name|'message'
op|'='
string|"'success'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_plugin_agent_resetnetwork
dedent|''
name|'def'
name|'_plugin_agent_resetnetwork'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'as_json'
op|'('
name|'returncode'
op|'='
string|"'0'"
op|','
name|'message'
op|'='
string|"'success'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_plugin_agent_agentupdate
dedent|''
name|'def'
name|'_plugin_agent_agentupdate'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'url'
op|'='
name|'args'
op|'['
string|'"url"'
op|']'
newline|'\n'
name|'md5'
op|'='
name|'args'
op|'['
string|'"md5sum"'
op|']'
newline|'\n'
name|'message'
op|'='
string|'"success with %(url)s and hash:%(md5)s"'
op|'%'
name|'dict'
op|'('
name|'url'
op|'='
name|'url'
op|','
nl|'\n'
name|'md5'
op|'='
name|'md5'
op|')'
newline|'\n'
name|'return'
name|'as_json'
op|'('
name|'returncode'
op|'='
string|"'0'"
op|','
name|'message'
op|'='
name|'message'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_plugin_noop
dedent|''
name|'def'
name|'_plugin_noop'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
string|"''"
newline|'\n'
nl|'\n'
DECL|member|_plugin_pickle_noop
dedent|''
name|'def'
name|'_plugin_pickle_noop'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'pickle'
op|'.'
name|'dumps'
op|'('
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_plugin_migration_transfer_vhd
dedent|''
name|'def'
name|'_plugin_migration_transfer_vhd'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'kwargs'
op|'='
name|'pickle'
op|'.'
name|'loads'
op|'('
name|'args'
op|'['
string|"'params'"
op|']'
op|')'
op|'['
string|"'kwargs'"
op|']'
newline|'\n'
name|'vdi_ref'
op|'='
name|'self'
op|'.'
name|'xenapi_request'
op|'('
string|"'VDI.get_by_uuid'"
op|','
nl|'\n'
op|'('
name|'kwargs'
op|'['
string|"'vdi_uuid'"
op|']'
op|','
op|')'
op|')'
newline|'\n'
name|'assert'
name|'vdi_ref'
newline|'\n'
name|'return'
name|'pickle'
op|'.'
name|'dumps'
op|'('
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|_plugin_glance_upload_vhd
dedent|''
name|'_plugin_glance_upload_vhd'
op|'='
name|'_plugin_pickle_noop'
newline|'\n'
DECL|variable|_plugin_kernel_copy_vdi
name|'_plugin_kernel_copy_vdi'
op|'='
name|'_plugin_noop'
newline|'\n'
DECL|variable|_plugin_kernel_create_kernel_ramdisk
name|'_plugin_kernel_create_kernel_ramdisk'
op|'='
name|'_plugin_noop'
newline|'\n'
DECL|variable|_plugin_kernel_remove_kernel_ramdisk
name|'_plugin_kernel_remove_kernel_ramdisk'
op|'='
name|'_plugin_noop'
newline|'\n'
DECL|variable|_plugin_migration_move_vhds_into_sr
name|'_plugin_migration_move_vhds_into_sr'
op|'='
name|'_plugin_noop'
newline|'\n'
nl|'\n'
DECL|member|_plugin_xenhost_host_data
name|'def'
name|'_plugin_xenhost_host_data'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
op|'{'
string|"'host_memory'"
op|':'
op|'{'
string|"'total'"
op|':'
number|'10'
op|','
nl|'\n'
string|"'overhead'"
op|':'
number|'20'
op|','
nl|'\n'
string|"'free'"
op|':'
number|'30'
op|','
nl|'\n'
string|"'free-computed'"
op|':'
number|'40'
op|'}'
op|','
nl|'\n'
string|"'host_hostname'"
op|':'
string|"'fake-xenhost'"
op|','
nl|'\n'
string|"'host_cpu_info'"
op|':'
op|'{'
string|"'cpu_count'"
op|':'
number|'50'
op|'}'
op|','
nl|'\n'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_plugin_poweraction
dedent|''
name|'def'
name|'_plugin_poweraction'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"power_action"'
op|':'
name|'method'
op|'['
number|'5'
op|':'
op|']'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|_plugin_xenhost_host_reboot
dedent|''
name|'_plugin_xenhost_host_reboot'
op|'='
name|'_plugin_poweraction'
newline|'\n'
DECL|variable|_plugin_xenhost_host_startup
name|'_plugin_xenhost_host_startup'
op|'='
name|'_plugin_poweraction'
newline|'\n'
DECL|variable|_plugin_xenhost_host_shutdown
name|'_plugin_xenhost_host_shutdown'
op|'='
name|'_plugin_poweraction'
newline|'\n'
nl|'\n'
DECL|member|_plugin_xenhost_set_host_enabled
name|'def'
name|'_plugin_xenhost_set_host_enabled'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'enabled'
op|'='
string|"'enabled'"
name|'if'
name|'args'
op|'.'
name|'get'
op|'('
string|"'enabled'"
op|')'
op|'=='
string|"'true'"
name|'else'
string|"'disabled'"
newline|'\n'
name|'return'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"status"'
op|':'
name|'enabled'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_plugin_xenhost_host_uptime
dedent|''
name|'def'
name|'_plugin_xenhost_host_uptime'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'jsonutils'
op|'.'
name|'dumps'
op|'('
op|'{'
string|'"uptime"'
op|':'
string|'"fake uptime"'
op|'}'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_plugin_xenhost_get_pci_device_details
dedent|''
name|'def'
name|'_plugin_xenhost_get_pci_device_details'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Simulate the ouput of three pci devices.\n\n        Both of those devices are available for pci passtrough but\n        only one will match with the pci whitelist used in the\n        method test_pci_passthrough_devices_*().\n        Return a single list.\n\n        """'
newline|'\n'
comment|'# Driver is not pciback'
nl|'\n'
name|'dev_bad1'
op|'='
op|'['
string|'"Slot:\\t86:10.0"'
op|','
string|'"Class:\\t0604"'
op|','
string|'"Vendor:\\t10b5"'
op|','
nl|'\n'
string|'"Device:\\t8747"'
op|','
string|'"Rev:\\tba"'
op|','
string|'"Driver:\\tpcieport"'
op|','
string|'"\\n"'
op|']'
newline|'\n'
comment|'# Driver is pciback but vendor and device are bad'
nl|'\n'
name|'dev_bad2'
op|'='
op|'['
string|'"Slot:\\t88:00.0"'
op|','
string|'"Class:\\t0300"'
op|','
string|'"Vendor:\\t0bad"'
op|','
nl|'\n'
string|'"Device:\\tcafe"'
op|','
string|'"SVendor:\\t10de"'
op|','
string|'"SDevice:\\t100d"'
op|','
nl|'\n'
string|'"Rev:\\ta1"'
op|','
string|'"Driver:\\tpciback"'
op|','
string|'"\\n"'
op|']'
newline|'\n'
comment|'# Driver is pciback and vendor, device are used for matching'
nl|'\n'
name|'dev_good'
op|'='
op|'['
string|'"Slot:\\t87:00.0"'
op|','
string|'"Class:\\t0300"'
op|','
string|'"Vendor:\\t10de"'
op|','
nl|'\n'
string|'"Device:\\t11bf"'
op|','
string|'"SVendor:\\t10de"'
op|','
string|'"SDevice:\\t100d"'
op|','
nl|'\n'
string|'"Rev:\\ta1"'
op|','
string|'"Driver:\\tpciback"'
op|','
string|'"\\n"'
op|']'
newline|'\n'
nl|'\n'
name|'lspci_output'
op|'='
string|'"\\n"'
op|'.'
name|'join'
op|'('
name|'dev_bad1'
op|'+'
name|'dev_bad2'
op|'+'
name|'dev_good'
op|')'
newline|'\n'
name|'return'
name|'pickle'
op|'.'
name|'dumps'
op|'('
name|'lspci_output'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_plugin_xenhost_get_pci_type
dedent|''
name|'def'
name|'_plugin_xenhost_get_pci_type'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'pickle'
op|'.'
name|'dumps'
op|'('
string|'"type-PCI"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_plugin_console_get_console_log
dedent|''
name|'def'
name|'_plugin_console_get_console_log'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'dom_id'
op|'='
name|'args'
op|'['
string|'"dom_id"'
op|']'
newline|'\n'
name|'if'
name|'dom_id'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Failure'
op|'('
string|"'Guest does not have a console'"
op|')'
newline|'\n'
dedent|''
name|'return'
name|'base64'
op|'.'
name|'b64encode'
op|'('
name|'zlib'
op|'.'
name|'compress'
op|'('
string|'"dom_id: %s"'
op|'%'
name|'dom_id'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_plugin_nova_plugin_version_get_version
dedent|''
name|'def'
name|'_plugin_nova_plugin_version_get_version'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'pickle'
op|'.'
name|'dumps'
op|'('
string|'"1.2"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_plugin_xenhost_query_gc
dedent|''
name|'def'
name|'_plugin_xenhost_query_gc'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'pickle'
op|'.'
name|'dumps'
op|'('
string|'"False"'
op|')'
newline|'\n'
nl|'\n'
DECL|member|host_call_plugin
dedent|''
name|'def'
name|'host_call_plugin'
op|'('
name|'self'
op|','
name|'_1'
op|','
name|'_2'
op|','
name|'plugin'
op|','
name|'method'
op|','
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'func'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
string|"'_plugin_%s_%s'"
op|'%'
op|'('
name|'plugin'
op|','
name|'method'
op|')'
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'func'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Exception'
op|'('
string|"'No simulation in host_call_plugin for %s,%s'"
op|'%'
nl|'\n'
op|'('
name|'plugin'
op|','
name|'method'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'func'
op|'('
name|'method'
op|','
name|'args'
op|')'
newline|'\n'
nl|'\n'
DECL|member|VDI_get_virtual_size
dedent|''
name|'def'
name|'VDI_get_virtual_size'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
number|'1'
op|'*'
name|'units'
op|'.'
name|'Gi'
newline|'\n'
nl|'\n'
DECL|member|VDI_resize_online
dedent|''
name|'def'
name|'VDI_resize_online'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
string|"'derp'"
newline|'\n'
nl|'\n'
DECL|variable|VDI_resize
dedent|''
name|'VDI_resize'
op|'='
name|'VDI_resize_online'
newline|'\n'
nl|'\n'
DECL|member|_VM_reboot
name|'def'
name|'_VM_reboot'
op|'('
name|'self'
op|','
name|'session'
op|','
name|'vm_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_ref'
op|'='
name|'_db_content'
op|'['
string|"'VM'"
op|']'
op|'['
name|'vm_ref'
op|']'
newline|'\n'
name|'if'
name|'db_ref'
op|'['
string|"'power_state'"
op|']'
op|'!='
string|"'Running'"
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Failure'
op|'('
op|'['
string|"'VM_BAD_POWER_STATE'"
op|','
nl|'\n'
string|"'fake-opaque-ref'"
op|','
name|'db_ref'
op|'['
string|"'power_state'"
op|']'
op|'.'
name|'lower'
op|'('
op|')'
op|','
string|"'halted'"
op|']'
op|')'
newline|'\n'
dedent|''
name|'db_ref'
op|'['
string|"'power_state'"
op|']'
op|'='
string|"'Running'"
newline|'\n'
name|'db_ref'
op|'['
string|"'domid'"
op|']'
op|'='
name|'random'
op|'.'
name|'randrange'
op|'('
number|'1'
op|','
number|'1'
op|'<<'
number|'16'
op|')'
newline|'\n'
nl|'\n'
DECL|member|VM_clean_reboot
dedent|''
name|'def'
name|'VM_clean_reboot'
op|'('
name|'self'
op|','
name|'session'
op|','
name|'vm_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'_VM_reboot'
op|'('
name|'session'
op|','
name|'vm_ref'
op|')'
newline|'\n'
nl|'\n'
DECL|member|VM_hard_reboot
dedent|''
name|'def'
name|'VM_hard_reboot'
op|'('
name|'self'
op|','
name|'session'
op|','
name|'vm_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'_VM_reboot'
op|'('
name|'session'
op|','
name|'vm_ref'
op|')'
newline|'\n'
nl|'\n'
DECL|member|VM_hard_shutdown
dedent|''
name|'def'
name|'VM_hard_shutdown'
op|'('
name|'self'
op|','
name|'session'
op|','
name|'vm_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_ref'
op|'='
name|'_db_content'
op|'['
string|"'VM'"
op|']'
op|'['
name|'vm_ref'
op|']'
newline|'\n'
name|'db_ref'
op|'['
string|"'power_state'"
op|']'
op|'='
string|"'Halted'"
newline|'\n'
name|'db_ref'
op|'['
string|"'domid'"
op|']'
op|'='
op|'-'
number|'1'
newline|'\n'
DECL|variable|VM_clean_shutdown
dedent|''
name|'VM_clean_shutdown'
op|'='
name|'VM_hard_shutdown'
newline|'\n'
nl|'\n'
DECL|member|VM_suspend
name|'def'
name|'VM_suspend'
op|'('
name|'self'
op|','
name|'session'
op|','
name|'vm_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_ref'
op|'='
name|'_db_content'
op|'['
string|"'VM'"
op|']'
op|'['
name|'vm_ref'
op|']'
newline|'\n'
name|'db_ref'
op|'['
string|"'power_state'"
op|']'
op|'='
string|"'Suspended'"
newline|'\n'
nl|'\n'
DECL|member|VM_pause
dedent|''
name|'def'
name|'VM_pause'
op|'('
name|'self'
op|','
name|'session'
op|','
name|'vm_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'db_ref'
op|'='
name|'_db_content'
op|'['
string|"'VM'"
op|']'
op|'['
name|'vm_ref'
op|']'
newline|'\n'
name|'db_ref'
op|'['
string|"'power_state'"
op|']'
op|'='
string|"'Paused'"
newline|'\n'
nl|'\n'
DECL|member|pool_eject
dedent|''
name|'def'
name|'pool_eject'
op|'('
name|'self'
op|','
name|'session'
op|','
name|'host_ref'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|pool_join
dedent|''
name|'def'
name|'pool_join'
op|'('
name|'self'
op|','
name|'session'
op|','
name|'hostname'
op|','
name|'username'
op|','
name|'password'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|pool_set_name_label
dedent|''
name|'def'
name|'pool_set_name_label'
op|'('
name|'self'
op|','
name|'session'
op|','
name|'pool_ref'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|host_migrate_receive
dedent|''
name|'def'
name|'host_migrate_receive'
op|'('
name|'self'
op|','
name|'session'
op|','
name|'destref'
op|','
name|'nwref'
op|','
name|'options'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
string|'"fake_migrate_data"'
newline|'\n'
nl|'\n'
DECL|member|VM_assert_can_migrate
dedent|''
name|'def'
name|'VM_assert_can_migrate'
op|'('
name|'self'
op|','
name|'session'
op|','
name|'vmref'
op|','
name|'migrate_data'
op|','
name|'live'
op|','
nl|'\n'
name|'vdi_map'
op|','
name|'vif_map'
op|','
name|'options'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|VM_migrate_send
dedent|''
name|'def'
name|'VM_migrate_send'
op|'('
name|'self'
op|','
name|'session'
op|','
name|'mref'
op|','
name|'migrate_data'
op|','
name|'live'
op|','
name|'vdi_map'
op|','
nl|'\n'
name|'vif_map'
op|','
name|'options'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
nl|'\n'
DECL|member|VM_remove_from_blocked_operations
dedent|''
name|'def'
name|'VM_remove_from_blocked_operations'
op|'('
name|'self'
op|','
name|'session'
op|','
name|'vm_ref'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
comment|"# operation is idempotent, XenServer doesn't care if the key exists"
nl|'\n'
indent|'        '
name|'_db_content'
op|'['
string|"'VM'"
op|']'
op|'['
name|'vm_ref'
op|']'
op|'['
string|"'blocked_operations'"
op|']'
op|'.'
name|'pop'
op|'('
name|'key'
op|','
name|'None'
op|')'
newline|'\n'
nl|'\n'
DECL|member|xenapi_request
dedent|''
name|'def'
name|'xenapi_request'
op|'('
name|'self'
op|','
name|'methodname'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'methodname'
op|'.'
name|'startswith'
op|'('
string|"'login'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_login'
op|'('
name|'methodname'
op|','
name|'params'
op|')'
newline|'\n'
name|'return'
name|'None'
newline|'\n'
dedent|''
name|'elif'
name|'methodname'
op|'=='
string|"'logout'"
name|'or'
name|'methodname'
op|'=='
string|"'session.logout'"
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_logout'
op|'('
op|')'
newline|'\n'
name|'return'
name|'None'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'full_params'
op|'='
op|'('
name|'self'
op|'.'
name|'_session'
op|','
op|')'
op|'+'
name|'params'
newline|'\n'
name|'meth'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
name|'methodname'
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'meth'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'LOG'
op|'.'
name|'debug'
op|'('
string|"'Raising NotImplemented'"
op|')'
newline|'\n'
name|'raise'
name|'NotImplementedError'
op|'('
nl|'\n'
name|'_'
op|'('
string|"'xenapi.fake does not have an implementation for %s'"
op|')'
op|'%'
nl|'\n'
name|'methodname'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'meth'
op|'('
op|'*'
name|'full_params'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_login
dedent|''
dedent|''
name|'def'
name|'_login'
op|'('
name|'self'
op|','
name|'method'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_session'
op|'='
name|'str'
op|'('
name|'uuid'
op|'.'
name|'uuid4'
op|'('
op|')'
op|')'
newline|'\n'
name|'_session_info'
op|'='
op|'{'
string|"'uuid'"
op|':'
name|'str'
op|'('
name|'uuid'
op|'.'
name|'uuid4'
op|'('
op|')'
op|')'
op|','
nl|'\n'
string|"'this_host'"
op|':'
name|'_db_content'
op|'['
string|"'host'"
op|']'
op|'.'
name|'keys'
op|'('
op|')'
op|'['
number|'0'
op|']'
op|'}'
newline|'\n'
name|'_db_content'
op|'['
string|"'session'"
op|']'
op|'['
name|'self'
op|'.'
name|'_session'
op|']'
op|'='
name|'_session_info'
newline|'\n'
nl|'\n'
DECL|member|_logout
dedent|''
name|'def'
name|'_logout'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'s'
op|'='
name|'self'
op|'.'
name|'_session'
newline|'\n'
name|'self'
op|'.'
name|'_session'
op|'='
name|'None'
newline|'\n'
name|'if'
name|'s'
name|'not'
name|'in'
name|'_db_content'
op|'['
string|"'session'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'NovaException'
op|'('
nl|'\n'
string|'"Logging out a session that is invalid or already logged "'
nl|'\n'
string|'"out: %s"'
op|'%'
name|'s'
op|')'
newline|'\n'
dedent|''
name|'del'
name|'_db_content'
op|'['
string|"'session'"
op|']'
op|'['
name|'s'
op|']'
newline|'\n'
nl|'\n'
DECL|member|__getattr__
dedent|''
name|'def'
name|'__getattr__'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'name'
op|'=='
string|"'handle'"
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'_session'
newline|'\n'
dedent|''
name|'elif'
name|'name'
op|'=='
string|"'xenapi'"
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'_Dispatcher'
op|'('
name|'self'
op|'.'
name|'xenapi_request'
op|','
name|'None'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'name'
op|'.'
name|'startswith'
op|'('
string|"'login'"
op|')'
name|'or'
name|'name'
op|'.'
name|'startswith'
op|'('
string|"'slave_local'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'lambda'
op|'*'
name|'params'
op|':'
name|'self'
op|'.'
name|'_login'
op|'('
name|'name'
op|','
name|'params'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'name'
op|'.'
name|'startswith'
op|'('
string|"'Async'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'lambda'
op|'*'
name|'params'
op|':'
name|'self'
op|'.'
name|'_async'
op|'('
name|'name'
op|','
name|'params'
op|')'
newline|'\n'
dedent|''
name|'elif'
string|"'.'"
name|'in'
name|'name'
op|':'
newline|'\n'
indent|'            '
name|'impl'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
name|'name'
op|'.'
name|'replace'
op|'('
string|"'.'"
op|','
string|"'_'"
op|')'
op|')'
newline|'\n'
name|'if'
name|'impl'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
nl|'\n'
DECL|function|callit
indent|'                '
name|'def'
name|'callit'
op|'('
op|'*'
name|'params'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'LOG'
op|'.'
name|'debug'
op|'('
string|"'Calling %(name)s %(impl)s'"
op|','
nl|'\n'
op|'{'
string|"'name'"
op|':'
name|'name'
op|','
string|"'impl'"
op|':'
name|'impl'
op|'}'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_session'
op|'('
name|'params'
op|')'
newline|'\n'
name|'return'
name|'impl'
op|'('
op|'*'
name|'params'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'callit'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'self'
op|'.'
name|'_is_gettersetter'
op|'('
name|'name'
op|','
name|'True'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'LOG'
op|'.'
name|'debug'
op|'('
string|"'Calling getter %s'"
op|','
name|'name'
op|')'
newline|'\n'
name|'return'
name|'lambda'
op|'*'
name|'params'
op|':'
name|'self'
op|'.'
name|'_getter'
op|'('
name|'name'
op|','
name|'params'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'_is_gettersetter'
op|'('
name|'name'
op|','
name|'False'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'LOG'
op|'.'
name|'debug'
op|'('
string|"'Calling setter %s'"
op|','
name|'name'
op|')'
newline|'\n'
name|'return'
name|'lambda'
op|'*'
name|'params'
op|':'
name|'self'
op|'.'
name|'_setter'
op|'('
name|'name'
op|','
name|'params'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'_is_create'
op|'('
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'lambda'
op|'*'
name|'params'
op|':'
name|'self'
op|'.'
name|'_create'
op|'('
name|'name'
op|','
name|'params'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'_is_destroy'
op|'('
name|'name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'lambda'
op|'*'
name|'params'
op|':'
name|'self'
op|'.'
name|'_destroy'
op|'('
name|'name'
op|','
name|'params'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'name'
op|'=='
string|"'XenAPI'"
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'FakeXenAPI'
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'None'
newline|'\n'
nl|'\n'
DECL|member|_is_gettersetter
dedent|''
dedent|''
name|'def'
name|'_is_gettersetter'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'getter'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'bits'
op|'='
name|'name'
op|'.'
name|'split'
op|'('
string|"'.'"
op|')'
newline|'\n'
name|'return'
op|'('
name|'len'
op|'('
name|'bits'
op|')'
op|'=='
number|'2'
name|'and'
nl|'\n'
name|'bits'
op|'['
number|'0'
op|']'
name|'in'
name|'_CLASSES'
name|'and'
nl|'\n'
name|'bits'
op|'['
number|'1'
op|']'
op|'.'
name|'startswith'
op|'('
name|'getter'
name|'and'
string|"'get_'"
name|'or'
string|"'set_'"
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_is_create
dedent|''
name|'def'
name|'_is_create'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'_is_method'
op|'('
name|'name'
op|','
string|"'create'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_is_destroy
dedent|''
name|'def'
name|'_is_destroy'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'_is_method'
op|'('
name|'name'
op|','
string|"'destroy'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_is_method
dedent|''
name|'def'
name|'_is_method'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'meth'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'bits'
op|'='
name|'name'
op|'.'
name|'split'
op|'('
string|"'.'"
op|')'
newline|'\n'
name|'return'
op|'('
name|'len'
op|'('
name|'bits'
op|')'
op|'=='
number|'2'
name|'and'
nl|'\n'
name|'bits'
op|'['
number|'0'
op|']'
name|'in'
name|'_CLASSES'
name|'and'
nl|'\n'
name|'bits'
op|'['
number|'1'
op|']'
op|'=='
name|'meth'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_getter
dedent|''
name|'def'
name|'_getter'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_session'
op|'('
name|'params'
op|')'
newline|'\n'
op|'('
name|'cls'
op|','
name|'func'
op|')'
op|'='
name|'name'
op|'.'
name|'split'
op|'('
string|"'.'"
op|')'
newline|'\n'
name|'if'
name|'func'
op|'=='
string|"'get_all'"
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_check_arg_count'
op|'('
name|'params'
op|','
number|'1'
op|')'
newline|'\n'
name|'return'
name|'get_all'
op|'('
name|'cls'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'func'
op|'=='
string|"'get_all_records'"
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_check_arg_count'
op|'('
name|'params'
op|','
number|'1'
op|')'
newline|'\n'
name|'return'
name|'get_all_records'
op|'('
name|'cls'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'func'
op|'=='
string|"'get_all_records_where'"
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_check_arg_count'
op|'('
name|'params'
op|','
number|'2'
op|')'
newline|'\n'
name|'return'
name|'get_all_records_where'
op|'('
name|'cls'
op|','
name|'params'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'func'
op|'=='
string|"'get_record'"
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_check_arg_count'
op|'('
name|'params'
op|','
number|'2'
op|')'
newline|'\n'
name|'return'
name|'get_record'
op|'('
name|'cls'
op|','
name|'params'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'func'
name|'in'
op|'('
string|"'get_by_name_label'"
op|','
string|"'get_by_uuid'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'_check_arg_count'
op|'('
name|'params'
op|','
number|'2'
op|')'
newline|'\n'
name|'return_singleton'
op|'='
op|'('
name|'func'
op|'=='
string|"'get_by_uuid'"
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'_get_by_field'
op|'('
nl|'\n'
name|'_db_content'
op|'['
name|'cls'
op|']'
op|','
name|'func'
op|'['
name|'len'
op|'('
string|"'get_by_'"
op|')'
op|':'
op|']'
op|','
name|'params'
op|'['
number|'1'
op|']'
op|','
nl|'\n'
name|'return_singleton'
op|'='
name|'return_singleton'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'params'
op|')'
op|'=='
number|'2'
op|':'
newline|'\n'
indent|'            '
name|'field'
op|'='
name|'func'
op|'['
name|'len'
op|'('
string|"'get_'"
op|')'
op|':'
op|']'
newline|'\n'
name|'ref'
op|'='
name|'params'
op|'['
number|'1'
op|']'
newline|'\n'
name|'if'
op|'('
name|'ref'
name|'in'
name|'_db_content'
op|'['
name|'cls'
op|']'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
op|'('
name|'field'
name|'in'
name|'_db_content'
op|'['
name|'cls'
op|']'
op|'['
name|'ref'
op|']'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'return'
name|'_db_content'
op|'['
name|'cls'
op|']'
op|'['
name|'ref'
op|']'
op|'['
name|'field'
op|']'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'Failure'
op|'('
op|'['
string|"'HANDLE_INVALID'"
op|','
name|'cls'
op|','
name|'ref'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'LOG'
op|'.'
name|'debug'
op|'('
string|"'Raising NotImplemented'"
op|')'
newline|'\n'
name|'raise'
name|'NotImplementedError'
op|'('
nl|'\n'
name|'_'
op|'('
string|"'xenapi.fake does not have an implementation for %s or it has '"
nl|'\n'
string|"'been called with the wrong number of arguments'"
op|')'
op|'%'
name|'name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_setter
dedent|''
name|'def'
name|'_setter'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_session'
op|'('
name|'params'
op|')'
newline|'\n'
op|'('
name|'cls'
op|','
name|'func'
op|')'
op|'='
name|'name'
op|'.'
name|'split'
op|'('
string|"'.'"
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'len'
op|'('
name|'params'
op|')'
op|'=='
number|'3'
op|':'
newline|'\n'
indent|'            '
name|'field'
op|'='
name|'func'
op|'['
name|'len'
op|'('
string|"'set_'"
op|')'
op|':'
op|']'
newline|'\n'
name|'ref'
op|'='
name|'params'
op|'['
number|'1'
op|']'
newline|'\n'
name|'val'
op|'='
name|'params'
op|'['
number|'2'
op|']'
newline|'\n'
nl|'\n'
name|'if'
op|'('
name|'ref'
name|'in'
name|'_db_content'
op|'['
name|'cls'
op|']'
name|'and'
nl|'\n'
name|'field'
name|'in'
name|'_db_content'
op|'['
name|'cls'
op|']'
op|'['
name|'ref'
op|']'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'_db_content'
op|'['
name|'cls'
op|']'
op|'['
name|'ref'
op|']'
op|'['
name|'field'
op|']'
op|'='
name|'val'
newline|'\n'
name|'return'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'LOG'
op|'.'
name|'debug'
op|'('
string|"'Raising NotImplemented'"
op|')'
newline|'\n'
name|'raise'
name|'NotImplementedError'
op|'('
nl|'\n'
string|"'xenapi.fake does not have an implementation for %s or it has '"
nl|'\n'
string|"'been called with the wrong number of arguments or the database '"
nl|'\n'
string|"'is missing that field'"
op|'%'
name|'name'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_create
dedent|''
name|'def'
name|'_create'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_session'
op|'('
name|'params'
op|')'
newline|'\n'
name|'is_sr_create'
op|'='
name|'name'
op|'=='
string|"'SR.create'"
newline|'\n'
name|'is_vlan_create'
op|'='
name|'name'
op|'=='
string|"'VLAN.create'"
newline|'\n'
comment|'# Storage Repositories have a different API'
nl|'\n'
name|'expected'
op|'='
name|'is_sr_create'
name|'and'
number|'10'
name|'or'
name|'is_vlan_create'
name|'and'
number|'4'
name|'or'
number|'2'
newline|'\n'
name|'self'
op|'.'
name|'_check_arg_count'
op|'('
name|'params'
op|','
name|'expected'
op|')'
newline|'\n'
op|'('
name|'cls'
op|','
name|'_'
op|')'
op|'='
name|'name'
op|'.'
name|'split'
op|'('
string|"'.'"
op|')'
newline|'\n'
name|'ref'
op|'='
op|'('
name|'is_sr_create'
name|'and'
nl|'\n'
name|'_create_sr'
op|'('
name|'cls'
op|','
name|'params'
op|')'
name|'or'
nl|'\n'
name|'is_vlan_create'
name|'and'
nl|'\n'
name|'_create_vlan'
op|'('
name|'params'
op|'['
number|'1'
op|']'
op|','
name|'params'
op|'['
number|'2'
op|']'
op|','
name|'params'
op|'['
number|'3'
op|']'
op|')'
name|'or'
nl|'\n'
name|'_create_object'
op|'('
name|'cls'
op|','
name|'params'
op|'['
number|'1'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# Call hook to provide any fixups needed (ex. creating backrefs)'
nl|'\n'
name|'after_hook'
op|'='
string|"'after_%s_create'"
op|'%'
name|'cls'
newline|'\n'
name|'if'
name|'after_hook'
name|'in'
name|'globals'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'globals'
op|'('
op|')'
op|'['
name|'after_hook'
op|']'
op|'('
name|'ref'
op|','
name|'params'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'obj'
op|'='
name|'get_record'
op|'('
name|'cls'
op|','
name|'ref'
op|')'
newline|'\n'
nl|'\n'
comment|'# Add RO fields'
nl|'\n'
name|'if'
name|'cls'
op|'=='
string|"'VM'"
op|':'
newline|'\n'
indent|'            '
name|'obj'
op|'['
string|"'power_state'"
op|']'
op|'='
string|"'Halted'"
newline|'\n'
dedent|''
name|'return'
name|'ref'
newline|'\n'
nl|'\n'
DECL|member|_destroy
dedent|''
name|'def'
name|'_destroy'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_check_session'
op|'('
name|'params'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_check_arg_count'
op|'('
name|'params'
op|','
number|'2'
op|')'
newline|'\n'
name|'table'
op|'='
name|'name'
op|'.'
name|'split'
op|'('
string|"'.'"
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
name|'ref'
op|'='
name|'params'
op|'['
number|'1'
op|']'
newline|'\n'
name|'if'
name|'ref'
name|'not'
name|'in'
name|'_db_content'
op|'['
name|'table'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Failure'
op|'('
op|'['
string|"'HANDLE_INVALID'"
op|','
name|'table'
op|','
name|'ref'
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# Call destroy function (if exists)'
nl|'\n'
dedent|''
name|'destroy_func'
op|'='
name|'globals'
op|'('
op|')'
op|'.'
name|'get'
op|'('
string|"'destroy_%s'"
op|'%'
name|'table'
op|'.'
name|'lower'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'destroy_func'
op|':'
newline|'\n'
indent|'            '
name|'destroy_func'
op|'('
name|'ref'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'del'
name|'_db_content'
op|'['
name|'table'
op|']'
op|'['
name|'ref'
op|']'
newline|'\n'
nl|'\n'
DECL|member|_async
dedent|''
dedent|''
name|'def'
name|'_async'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'task_ref'
op|'='
name|'create_task'
op|'('
name|'name'
op|')'
newline|'\n'
name|'task'
op|'='
name|'_db_content'
op|'['
string|"'task'"
op|']'
op|'['
name|'task_ref'
op|']'
newline|'\n'
name|'func'
op|'='
name|'name'
op|'['
name|'len'
op|'('
string|"'Async.'"
op|')'
op|':'
op|']'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'result'
op|'='
name|'self'
op|'.'
name|'xenapi_request'
op|'('
name|'func'
op|','
name|'params'
op|'['
number|'1'
op|':'
op|']'
op|')'
newline|'\n'
name|'if'
name|'result'
op|':'
newline|'\n'
indent|'                '
name|'result'
op|'='
name|'as_value'
op|'('
name|'result'
op|')'
newline|'\n'
dedent|''
name|'task'
op|'['
string|"'result'"
op|']'
op|'='
name|'result'
newline|'\n'
name|'task'
op|'['
string|"'status'"
op|']'
op|'='
string|"'success'"
newline|'\n'
dedent|''
name|'except'
name|'Failure'
name|'as'
name|'exc'
op|':'
newline|'\n'
indent|'            '
name|'task'
op|'['
string|"'error_info'"
op|']'
op|'='
name|'exc'
op|'.'
name|'details'
newline|'\n'
name|'task'
op|'['
string|"'status'"
op|']'
op|'='
string|"'failed'"
newline|'\n'
dedent|''
name|'task'
op|'['
string|"'finished'"
op|']'
op|'='
name|'timeutils'
op|'.'
name|'utcnow'
op|'('
op|')'
newline|'\n'
name|'return'
name|'task_ref'
newline|'\n'
nl|'\n'
DECL|member|_check_session
dedent|''
name|'def'
name|'_check_session'
op|'('
name|'self'
op|','
name|'params'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
op|'('
name|'self'
op|'.'
name|'_session'
name|'is'
name|'None'
name|'or'
nl|'\n'
name|'self'
op|'.'
name|'_session'
name|'not'
name|'in'
name|'_db_content'
op|'['
string|"'session'"
op|']'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Failure'
op|'('
op|'['
string|"'HANDLE_INVALID'"
op|','
string|"'session'"
op|','
name|'self'
op|'.'
name|'_session'
op|']'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'params'
op|')'
op|'=='
number|'0'
name|'or'
name|'params'
op|'['
number|'0'
op|']'
op|'!='
name|'self'
op|'.'
name|'_session'
op|':'
newline|'\n'
indent|'            '
name|'LOG'
op|'.'
name|'debug'
op|'('
string|"'Raising NotImplemented'"
op|')'
newline|'\n'
name|'raise'
name|'NotImplementedError'
op|'('
string|"'Call to XenAPI without using .xenapi'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|_check_arg_count
dedent|''
dedent|''
name|'def'
name|'_check_arg_count'
op|'('
name|'self'
op|','
name|'params'
op|','
name|'expected'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'actual'
op|'='
name|'len'
op|'('
name|'params'
op|')'
newline|'\n'
name|'if'
name|'actual'
op|'!='
name|'expected'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'Failure'
op|'('
op|'['
string|"'MESSAGE_PARAMETER_COUNT_MISMATCH'"
op|','
nl|'\n'
name|'expected'
op|','
name|'actual'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_by_field
dedent|''
dedent|''
name|'def'
name|'_get_by_field'
op|'('
name|'self'
op|','
name|'recs'
op|','
name|'k'
op|','
name|'v'
op|','
name|'return_singleton'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'result'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'ref'
op|','
name|'rec'
name|'in'
name|'recs'
op|'.'
name|'iteritems'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'rec'
op|'.'
name|'get'
op|'('
name|'k'
op|')'
op|'=='
name|'v'
op|':'
newline|'\n'
indent|'                '
name|'result'
op|'.'
name|'append'
op|'('
name|'ref'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'return_singleton'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'return'
name|'result'
op|'['
number|'0'
op|']'
newline|'\n'
dedent|''
name|'except'
name|'IndexError'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'Failure'
op|'('
op|'['
string|"'UUID_INVALID'"
op|','
name|'v'
op|','
name|'result'
op|','
name|'recs'
op|','
name|'k'
op|']'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'return'
name|'result'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|FakeXenAPI
dedent|''
dedent|''
name|'class'
name|'FakeXenAPI'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'Failure'
op|'='
name|'Failure'
newline|'\n'
nl|'\n'
nl|'\n'
comment|'# Based upon _Method from xmlrpclib.'
nl|'\n'
DECL|class|_Dispatcher
dedent|''
dedent|''
name|'class'
name|'_Dispatcher'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'send'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'__send'
op|'='
name|'send'
newline|'\n'
name|'self'
op|'.'
name|'__name'
op|'='
name|'name'
newline|'\n'
nl|'\n'
DECL|member|__repr__
dedent|''
name|'def'
name|'__repr__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'__name'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|"'<xenapi.fake._Dispatcher for %s>'"
op|'%'
name|'self'
op|'.'
name|'__name'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|"'<xenapi.fake._Dispatcher>'"
newline|'\n'
nl|'\n'
DECL|member|__getattr__
dedent|''
dedent|''
name|'def'
name|'__getattr__'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'__name'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'_Dispatcher'
op|'('
name|'self'
op|'.'
name|'__send'
op|','
name|'name'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'_Dispatcher'
op|'('
name|'self'
op|'.'
name|'__send'
op|','
string|'"%s.%s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'__name'
op|','
name|'name'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|member|__call__
dedent|''
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
op|'*'
name|'args'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'__send'
op|'('
name|'self'
op|'.'
name|'__name'
op|','
name|'args'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
