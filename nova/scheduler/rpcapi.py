begin_unit
comment|'# Copyright 2013, Red Hat, Inc.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
string|'"""\nClient side of the scheduler manager RPC API.\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'oslo_messaging'
name|'as'
name|'messaging'
newline|'\n'
nl|'\n'
name|'import'
name|'nova'
op|'.'
name|'conf'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'objects'
name|'import'
name|'base'
name|'as'
name|'objects_base'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'rpc'
newline|'\n'
nl|'\n'
DECL|variable|CONF
name|'CONF'
op|'='
name|'nova'
op|'.'
name|'conf'
op|'.'
name|'CONF'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SchedulerAPI
name|'class'
name|'SchedulerAPI'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
string|"'''Client side of the scheduler rpc API.\n\n    API version history:\n\n        * 1.0 - Initial version.\n        * 1.1 - Changes to prep_resize():\n            * remove instance_uuid, add instance\n            * remove instance_type_id, add instance_type\n            * remove topic, it was unused\n        * 1.2 - Remove topic from run_instance, it was unused\n        * 1.3 - Remove instance_id, add instance to live_migration\n        * 1.4 - Remove update_db from prep_resize\n        * 1.5 - Add reservations argument to prep_resize()\n        * 1.6 - Remove reservations argument to run_instance()\n        * 1.7 - Add create_volume() method, remove topic from live_migration()\n\n        * 2.0 - Remove 1.x backwards compat\n        * 2.1 - Add image_id to create_volume()\n        * 2.2 - Remove reservations argument to create_volume()\n        * 2.3 - Remove create_volume()\n        * 2.4 - Change update_service_capabilities()\n            * accepts a list of capabilities\n        * 2.5 - Add get_backdoor_port()\n        * 2.6 - Add select_hosts()\n\n        ... Grizzly supports message version 2.6.  So, any changes to existing\n        methods in 2.x after that point should be done such that they can\n        handle the version_cap being set to 2.6.\n\n        * 2.7 - Add select_destinations()\n        * 2.8 - Deprecate prep_resize() -- JUST KIDDING.  It is still used\n                by the compute manager for retries.\n        * 2.9 - Added the legacy_bdm_in_spec parameter to run_instance()\n\n        ... Havana supports message version 2.9.  So, any changes to existing\n        methods in 2.x after that point should be done such that they can\n        handle the version_cap being set to 2.9.\n\n        * Deprecated live_migration() call, moved to conductor\n        * Deprecated select_hosts()\n\n        3.0 - Removed backwards compat\n\n        ... Icehouse and Juno support message version 3.0.  So, any changes to\n        existing methods in 3.x after that point should be done such that they\n        can handle the version_cap being set to 3.0.\n\n        * 3.1 - Made select_destinations() send flavor object\n\n        * 4.0 - Removed backwards compat for Icehouse\n        * 4.1 - Add update_aggregates() and delete_aggregate()\n        * 4.2 - Added update_instance_info(), delete_instance_info(), and\n                sync_instance_info()  methods\n\n        ... Kilo and Liberty support message version 4.2. So, any\n        changes to existing methods in 4.x after that point should be\n        done such that they can handle the version_cap being set to\n        4.2.\n\n    '''"
newline|'\n'
nl|'\n'
DECL|variable|VERSION_ALIASES
name|'VERSION_ALIASES'
op|'='
op|'{'
nl|'\n'
string|"'grizzly'"
op|':'
string|"'2.6'"
op|','
nl|'\n'
string|"'havana'"
op|':'
string|"'2.9'"
op|','
nl|'\n'
string|"'icehouse'"
op|':'
string|"'3.0'"
op|','
nl|'\n'
string|"'juno'"
op|':'
string|"'3.0'"
op|','
nl|'\n'
string|"'kilo'"
op|':'
string|"'4.2'"
op|','
nl|'\n'
string|"'liberty'"
op|':'
string|"'4.2'"
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'SchedulerAPI'
op|','
name|'self'
op|')'
op|'.'
name|'__init__'
op|'('
op|')'
newline|'\n'
name|'target'
op|'='
name|'messaging'
op|'.'
name|'Target'
op|'('
name|'topic'
op|'='
name|'CONF'
op|'.'
name|'scheduler_topic'
op|','
name|'version'
op|'='
string|"'4.0'"
op|')'
newline|'\n'
name|'version_cap'
op|'='
name|'self'
op|'.'
name|'VERSION_ALIASES'
op|'.'
name|'get'
op|'('
name|'CONF'
op|'.'
name|'upgrade_levels'
op|'.'
name|'scheduler'
op|','
nl|'\n'
name|'CONF'
op|'.'
name|'upgrade_levels'
op|'.'
name|'scheduler'
op|')'
newline|'\n'
name|'serializer'
op|'='
name|'objects_base'
op|'.'
name|'NovaObjectSerializer'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'='
name|'rpc'
op|'.'
name|'get_client'
op|'('
name|'target'
op|','
name|'version_cap'
op|'='
name|'version_cap'
op|','
nl|'\n'
name|'serializer'
op|'='
name|'serializer'
op|')'
newline|'\n'
nl|'\n'
DECL|member|select_destinations
dedent|''
name|'def'
name|'select_destinations'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'request_spec'
op|','
name|'filter_properties'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'version'
op|'='
string|"'4.0'"
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'select_destinations'"
op|','
nl|'\n'
name|'request_spec'
op|'='
name|'request_spec'
op|','
name|'filter_properties'
op|'='
name|'filter_properties'
op|')'
newline|'\n'
nl|'\n'
DECL|member|update_aggregates
dedent|''
name|'def'
name|'update_aggregates'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'aggregates'
op|')'
op|':'
newline|'\n'
comment|"# NOTE(sbauza): Yes, it's a fanout, we need to update all schedulers"
nl|'\n'
indent|'        '
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'fanout'
op|'='
name|'True'
op|','
name|'version'
op|'='
string|"'4.1'"
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'update_aggregates'"
op|','
name|'aggregates'
op|'='
name|'aggregates'
op|')'
newline|'\n'
nl|'\n'
DECL|member|delete_aggregate
dedent|''
name|'def'
name|'delete_aggregate'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'aggregate'
op|')'
op|':'
newline|'\n'
comment|"# NOTE(sbauza): Yes, it's a fanout, we need to update all schedulers"
nl|'\n'
indent|'        '
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'fanout'
op|'='
name|'True'
op|','
name|'version'
op|'='
string|"'4.1'"
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'delete_aggregate'"
op|','
name|'aggregate'
op|'='
name|'aggregate'
op|')'
newline|'\n'
nl|'\n'
DECL|member|update_instance_info
dedent|''
name|'def'
name|'update_instance_info'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'host_name'
op|','
name|'instance_info'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'version'
op|'='
string|"'4.2'"
op|','
name|'fanout'
op|'='
name|'True'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'update_instance_info'"
op|','
name|'host_name'
op|'='
name|'host_name'
op|','
nl|'\n'
name|'instance_info'
op|'='
name|'instance_info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|delete_instance_info
dedent|''
name|'def'
name|'delete_instance_info'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'host_name'
op|','
name|'instance_uuid'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'version'
op|'='
string|"'4.2'"
op|','
name|'fanout'
op|'='
name|'True'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'delete_instance_info'"
op|','
name|'host_name'
op|'='
name|'host_name'
op|','
nl|'\n'
name|'instance_uuid'
op|'='
name|'instance_uuid'
op|')'
newline|'\n'
nl|'\n'
DECL|member|sync_instance_info
dedent|''
name|'def'
name|'sync_instance_info'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'host_name'
op|','
name|'instance_uuids'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'version'
op|'='
string|"'4.2'"
op|','
name|'fanout'
op|'='
name|'True'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'sync_instance_info'"
op|','
name|'host_name'
op|'='
name|'host_name'
op|','
nl|'\n'
name|'instance_uuids'
op|'='
name|'instance_uuids'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
