begin_unit
comment|'# Copyright 2011 OpenStack, LLC.'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
string|'"""\nThis module provides SchedulerDependentManager, a base class for\nany Manager that has Capabilities that should be related to the\nScheduler.\n\nThese Capabilities are hints that can help the scheduler route\nrequests to the appropriate service instance.\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'sys'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'flags'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'manager'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'scheduler'
name|'import'
name|'api'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'log'
name|'as'
name|'logging'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|variable|FLAGS
name|'FLAGS'
op|'='
name|'flags'
op|'.'
name|'FLAGS'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SchedulerDependentManager
name|'class'
name|'SchedulerDependentManager'
op|'('
name|'manager'
op|'.'
name|'Manager'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Periodically send capability updates to the Scheduler services.\n       Services that need to update the Scheduler of their capabilities\n       should derive from this class. Otherwise they can derive from\n       manager.Manager directly. Updates are only sent after\n       update_service_capabilities is called with non-None values."""'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'host'
op|'='
name|'None'
op|','
name|'db_driver'
op|'='
name|'None'
op|','
name|'service_name'
op|'='
string|'"undefined"'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'last_capabilities'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'service_name'
op|'='
name|'service_name'
newline|'\n'
name|'super'
op|'('
name|'SchedulerDependentManager'
op|','
name|'self'
op|')'
op|'.'
name|'__init__'
op|'('
name|'host'
op|','
name|'db_driver'
op|')'
newline|'\n'
nl|'\n'
DECL|member|update_service_capabilities
dedent|''
name|'def'
name|'update_service_capabilities'
op|'('
name|'self'
op|','
name|'capabilities'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Remember these capabilities to send on next periodic update."""'
newline|'\n'
name|'self'
op|'.'
name|'last_capabilities'
op|'='
name|'capabilities'
newline|'\n'
nl|'\n'
DECL|member|periodic_tasks
dedent|''
name|'def'
name|'periodic_tasks'
op|'('
name|'self'
op|','
name|'context'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Pass data back to the scheduler at a periodic interval"""'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'last_capabilities'
op|':'
newline|'\n'
indent|'            '
name|'logging'
op|'.'
name|'debug'
op|'('
name|'_'
op|'('
string|'"Notifying Schedulers of capabilities ..."'
op|')'
op|')'
newline|'\n'
name|'api'
op|'.'
name|'API'
op|'.'
name|'update_service_capabilities'
op|'('
name|'context'
op|','
name|'self'
op|'.'
name|'service_name'
op|','
nl|'\n'
name|'self'
op|'.'
name|'host'
op|','
name|'self'
op|'.'
name|'last_capabilities'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'super'
op|'('
name|'SchedulerDependentManager'
op|','
name|'self'
op|')'
op|'.'
name|'periodic_tasks'
op|'('
name|'context'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
