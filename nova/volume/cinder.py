begin_unit
comment|'# Copyright 2010 United States Government as represented by the'
nl|'\n'
comment|'# Administrator of the National Aeronautics and Space Administration.'
nl|'\n'
comment|'# All Rights Reserved.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
string|'"""\nHandles all requests relating to volumes + cinder.\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'copy'
newline|'\n'
name|'import'
name|'sys'
newline|'\n'
nl|'\n'
name|'from'
name|'cinderclient'
name|'import'
name|'client'
name|'as'
name|'cinder_client'
newline|'\n'
name|'from'
name|'cinderclient'
name|'import'
name|'exceptions'
name|'as'
name|'cinder_exception'
newline|'\n'
name|'from'
name|'cinderclient'
name|'import'
name|'service_catalog'
newline|'\n'
name|'from'
name|'oslo'
op|'.'
name|'config'
name|'import'
name|'cfg'
newline|'\n'
name|'import'
name|'six'
op|'.'
name|'moves'
op|'.'
name|'urllib'
op|'.'
name|'parse'
name|'as'
name|'urlparse'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'availability_zones'
name|'as'
name|'az'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'i18n'
name|'import'
name|'_'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'i18n'
name|'import'
name|'_LW'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'log'
name|'as'
name|'logging'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'strutils'
newline|'\n'
nl|'\n'
DECL|variable|cinder_opts
name|'cinder_opts'
op|'='
op|'['
nl|'\n'
name|'cfg'
op|'.'
name|'StrOpt'
op|'('
string|"'cinder_catalog_info'"
op|','
nl|'\n'
DECL|variable|default
name|'default'
op|'='
string|"'volume:cinder:publicURL'"
op|','
nl|'\n'
DECL|variable|help
name|'help'
op|'='
string|"'Info to match when looking for cinder in the service '"
nl|'\n'
string|"'catalog. Format is: separated values of the form: '"
nl|'\n'
string|"'<service_type>:<service_name>:<endpoint_type>'"
op|')'
op|','
nl|'\n'
name|'cfg'
op|'.'
name|'StrOpt'
op|'('
string|"'cinder_endpoint_template'"
op|','
nl|'\n'
DECL|variable|help
name|'help'
op|'='
string|"'Override service catalog lookup with template for cinder '"
nl|'\n'
string|"'endpoint e.g. http://localhost:8776/v1/%(project_id)s'"
op|')'
op|','
nl|'\n'
name|'cfg'
op|'.'
name|'StrOpt'
op|'('
string|"'os_region_name'"
op|','
nl|'\n'
DECL|variable|help
name|'help'
op|'='
string|"'Region name of this node'"
op|')'
op|','
nl|'\n'
name|'cfg'
op|'.'
name|'StrOpt'
op|'('
string|"'cinder_ca_certificates_file'"
op|','
nl|'\n'
DECL|variable|help
name|'help'
op|'='
string|"'Location of ca certificates file to use for cinder '"
nl|'\n'
string|"'client requests.'"
op|')'
op|','
nl|'\n'
name|'cfg'
op|'.'
name|'IntOpt'
op|'('
string|"'cinder_http_retries'"
op|','
nl|'\n'
DECL|variable|default
name|'default'
op|'='
number|'3'
op|','
nl|'\n'
DECL|variable|help
name|'help'
op|'='
string|"'Number of cinderclient retries on failed http calls'"
op|')'
op|','
nl|'\n'
name|'cfg'
op|'.'
name|'IntOpt'
op|'('
string|"'cinder_http_timeout'"
op|','
name|'default'
op|'='
name|'None'
op|','
nl|'\n'
DECL|variable|help
name|'help'
op|'='
string|"'HTTP inactivity timeout (in seconds)'"
op|')'
op|','
nl|'\n'
name|'cfg'
op|'.'
name|'BoolOpt'
op|'('
string|"'cinder_api_insecure'"
op|','
nl|'\n'
DECL|variable|default
name|'default'
op|'='
name|'False'
op|','
nl|'\n'
DECL|variable|help
name|'help'
op|'='
string|"'Allow to perform insecure SSL requests to cinder'"
op|')'
op|','
nl|'\n'
name|'cfg'
op|'.'
name|'BoolOpt'
op|'('
string|"'cinder_cross_az_attach'"
op|','
nl|'\n'
DECL|variable|default
name|'default'
op|'='
name|'True'
op|','
nl|'\n'
DECL|variable|help
name|'help'
op|'='
string|"'Allow attach between instance and volume in different '"
nl|'\n'
string|"'availability zones.'"
op|')'
op|','
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
DECL|variable|CONF
name|'CONF'
op|'='
name|'cfg'
op|'.'
name|'CONF'
newline|'\n'
name|'CONF'
op|'.'
name|'register_opts'
op|'('
name|'cinder_opts'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|LOG
name|'LOG'
op|'='
name|'logging'
op|'.'
name|'getLogger'
op|'('
name|'__name__'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|CINDER_URL
name|'CINDER_URL'
op|'='
name|'None'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|cinderclient
name|'def'
name|'cinderclient'
op|'('
name|'context'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'global'
name|'CINDER_URL'
newline|'\n'
name|'version'
op|'='
name|'get_cinder_client_version'
op|'('
name|'context'
op|')'
newline|'\n'
name|'c'
op|'='
name|'cinder_client'
op|'.'
name|'Client'
op|'('
name|'version'
op|','
nl|'\n'
name|'context'
op|'.'
name|'user_id'
op|','
nl|'\n'
name|'context'
op|'.'
name|'auth_token'
op|','
nl|'\n'
name|'project_id'
op|'='
name|'context'
op|'.'
name|'project_id'
op|','
nl|'\n'
name|'auth_url'
op|'='
name|'CINDER_URL'
op|','
nl|'\n'
name|'insecure'
op|'='
name|'CONF'
op|'.'
name|'cinder_api_insecure'
op|','
nl|'\n'
name|'retries'
op|'='
name|'CONF'
op|'.'
name|'cinder_http_retries'
op|','
nl|'\n'
name|'timeout'
op|'='
name|'CONF'
op|'.'
name|'cinder_http_timeout'
op|','
nl|'\n'
name|'cacert'
op|'='
name|'CONF'
op|'.'
name|'cinder_ca_certificates_file'
op|')'
newline|'\n'
comment|'# noauth extracts user_id:project_id from auth_token'
nl|'\n'
name|'c'
op|'.'
name|'client'
op|'.'
name|'auth_token'
op|'='
name|'context'
op|'.'
name|'auth_token'
name|'or'
string|"'%s:%s'"
op|'%'
op|'('
name|'context'
op|'.'
name|'user_id'
op|','
nl|'\n'
name|'context'
op|'.'
name|'project_id'
op|')'
newline|'\n'
name|'c'
op|'.'
name|'client'
op|'.'
name|'management_url'
op|'='
name|'CINDER_URL'
newline|'\n'
name|'return'
name|'c'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_untranslate_volume_summary_view
dedent|''
name|'def'
name|'_untranslate_volume_summary_view'
op|'('
name|'context'
op|','
name|'vol'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Maps keys for volumes summary view."""'
newline|'\n'
name|'d'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'d'
op|'['
string|"'id'"
op|']'
op|'='
name|'vol'
op|'.'
name|'id'
newline|'\n'
name|'d'
op|'['
string|"'status'"
op|']'
op|'='
name|'vol'
op|'.'
name|'status'
newline|'\n'
name|'d'
op|'['
string|"'size'"
op|']'
op|'='
name|'vol'
op|'.'
name|'size'
newline|'\n'
name|'d'
op|'['
string|"'availability_zone'"
op|']'
op|'='
name|'vol'
op|'.'
name|'availability_zone'
newline|'\n'
name|'d'
op|'['
string|"'created_at'"
op|']'
op|'='
name|'vol'
op|'.'
name|'created_at'
newline|'\n'
nl|'\n'
comment|'# TODO(jdg): The calling code expects attach_time and'
nl|'\n'
comment|'#            mountpoint to be set. When the calling'
nl|'\n'
comment|'#            code is more defensive this can be'
nl|'\n'
comment|'#            removed.'
nl|'\n'
name|'d'
op|'['
string|"'attach_time'"
op|']'
op|'='
string|'""'
newline|'\n'
name|'d'
op|'['
string|"'mountpoint'"
op|']'
op|'='
string|'""'
newline|'\n'
nl|'\n'
name|'if'
name|'vol'
op|'.'
name|'attachments'
op|':'
newline|'\n'
indent|'        '
name|'att'
op|'='
name|'vol'
op|'.'
name|'attachments'
op|'['
number|'0'
op|']'
newline|'\n'
name|'d'
op|'['
string|"'attach_status'"
op|']'
op|'='
string|"'attached'"
newline|'\n'
name|'d'
op|'['
string|"'instance_uuid'"
op|']'
op|'='
name|'att'
op|'['
string|"'server_id'"
op|']'
newline|'\n'
name|'d'
op|'['
string|"'mountpoint'"
op|']'
op|'='
name|'att'
op|'['
string|"'device'"
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'['
string|"'attach_status'"
op|']'
op|'='
string|"'detached'"
newline|'\n'
comment|"# NOTE(dzyu) volume(cinder) v2 API uses 'name' instead of 'display_name',"
nl|'\n'
comment|"# and use 'description' instead of 'display_description' for volume."
nl|'\n'
dedent|''
name|'if'
name|'hasattr'
op|'('
name|'vol'
op|','
string|"'display_name'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'['
string|"'display_name'"
op|']'
op|'='
name|'vol'
op|'.'
name|'display_name'
newline|'\n'
name|'d'
op|'['
string|"'display_description'"
op|']'
op|'='
name|'vol'
op|'.'
name|'display_description'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'['
string|"'display_name'"
op|']'
op|'='
name|'vol'
op|'.'
name|'name'
newline|'\n'
name|'d'
op|'['
string|"'display_description'"
op|']'
op|'='
name|'vol'
op|'.'
name|'description'
newline|'\n'
comment|'# TODO(jdg): Information may be lost in this translation'
nl|'\n'
dedent|''
name|'d'
op|'['
string|"'volume_type_id'"
op|']'
op|'='
name|'vol'
op|'.'
name|'volume_type'
newline|'\n'
name|'d'
op|'['
string|"'snapshot_id'"
op|']'
op|'='
name|'vol'
op|'.'
name|'snapshot_id'
newline|'\n'
name|'d'
op|'['
string|"'bootable'"
op|']'
op|'='
name|'strutils'
op|'.'
name|'bool_from_string'
op|'('
name|'vol'
op|'.'
name|'bootable'
op|')'
newline|'\n'
name|'d'
op|'['
string|"'volume_metadata'"
op|']'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'key'
op|','
name|'value'
name|'in'
name|'vol'
op|'.'
name|'metadata'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'['
string|"'volume_metadata'"
op|']'
op|'['
name|'key'
op|']'
op|'='
name|'value'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'hasattr'
op|'('
name|'vol'
op|','
string|"'volume_image_metadata'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'['
string|"'volume_image_metadata'"
op|']'
op|'='
name|'copy'
op|'.'
name|'deepcopy'
op|'('
name|'vol'
op|'.'
name|'volume_image_metadata'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'d'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_untranslate_snapshot_summary_view
dedent|''
name|'def'
name|'_untranslate_snapshot_summary_view'
op|'('
name|'context'
op|','
name|'snapshot'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Maps keys for snapshots summary view."""'
newline|'\n'
name|'d'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
name|'d'
op|'['
string|"'id'"
op|']'
op|'='
name|'snapshot'
op|'.'
name|'id'
newline|'\n'
name|'d'
op|'['
string|"'status'"
op|']'
op|'='
name|'snapshot'
op|'.'
name|'status'
newline|'\n'
name|'d'
op|'['
string|"'progress'"
op|']'
op|'='
name|'snapshot'
op|'.'
name|'progress'
newline|'\n'
name|'d'
op|'['
string|"'size'"
op|']'
op|'='
name|'snapshot'
op|'.'
name|'size'
newline|'\n'
name|'d'
op|'['
string|"'created_at'"
op|']'
op|'='
name|'snapshot'
op|'.'
name|'created_at'
newline|'\n'
nl|'\n'
comment|"# NOTE(dzyu) volume(cinder) v2 API uses 'name' instead of 'display_name',"
nl|'\n'
comment|"# 'description' instead of 'display_description' for snapshot."
nl|'\n'
name|'if'
name|'hasattr'
op|'('
name|'snapshot'
op|','
string|"'display_name'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'['
string|"'display_name'"
op|']'
op|'='
name|'snapshot'
op|'.'
name|'display_name'
newline|'\n'
name|'d'
op|'['
string|"'display_description'"
op|']'
op|'='
name|'snapshot'
op|'.'
name|'display_description'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'['
string|"'display_name'"
op|']'
op|'='
name|'snapshot'
op|'.'
name|'name'
newline|'\n'
name|'d'
op|'['
string|"'display_description'"
op|']'
op|'='
name|'snapshot'
op|'.'
name|'description'
newline|'\n'
nl|'\n'
dedent|''
name|'d'
op|'['
string|"'volume_id'"
op|']'
op|'='
name|'snapshot'
op|'.'
name|'volume_id'
newline|'\n'
name|'d'
op|'['
string|"'project_id'"
op|']'
op|'='
name|'snapshot'
op|'.'
name|'project_id'
newline|'\n'
name|'d'
op|'['
string|"'volume_size'"
op|']'
op|'='
name|'snapshot'
op|'.'
name|'size'
newline|'\n'
nl|'\n'
name|'return'
name|'d'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|translate_volume_exception
dedent|''
name|'def'
name|'translate_volume_exception'
op|'('
name|'method'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Transforms the exception for the volume but keeps its traceback intact.\n    """'
newline|'\n'
DECL|function|wrapper
name|'def'
name|'wrapper'
op|'('
name|'self'
op|','
name|'ctx'
op|','
name|'volume_id'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'res'
op|'='
name|'method'
op|'('
name|'self'
op|','
name|'ctx'
op|','
name|'volume_id'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'cinder_exception'
op|'.'
name|'ClientException'
op|':'
newline|'\n'
indent|'            '
name|'exc_type'
op|','
name|'exc_value'
op|','
name|'exc_trace'
op|'='
name|'sys'
op|'.'
name|'exc_info'
op|'('
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'exc_value'
op|','
name|'cinder_exception'
op|'.'
name|'NotFound'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'exc_value'
op|'='
name|'exception'
op|'.'
name|'VolumeNotFound'
op|'('
name|'volume_id'
op|'='
name|'volume_id'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'isinstance'
op|'('
name|'exc_value'
op|','
name|'cinder_exception'
op|'.'
name|'BadRequest'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'exc_value'
op|'='
name|'exception'
op|'.'
name|'InvalidInput'
op|'('
name|'reason'
op|'='
name|'exc_value'
op|'.'
name|'message'
op|')'
newline|'\n'
dedent|''
name|'raise'
name|'exc_value'
op|','
name|'None'
op|','
name|'exc_trace'
newline|'\n'
dedent|''
name|'except'
name|'cinder_exception'
op|'.'
name|'ConnectionError'
op|':'
newline|'\n'
indent|'            '
name|'exc_type'
op|','
name|'exc_value'
op|','
name|'exc_trace'
op|'='
name|'sys'
op|'.'
name|'exc_info'
op|'('
op|')'
newline|'\n'
name|'exc_value'
op|'='
name|'exception'
op|'.'
name|'CinderConnectionFailed'
op|'('
nl|'\n'
name|'reason'
op|'='
name|'exc_value'
op|'.'
name|'message'
op|')'
newline|'\n'
name|'raise'
name|'exc_value'
op|','
name|'None'
op|','
name|'exc_trace'
newline|'\n'
dedent|''
name|'return'
name|'res'
newline|'\n'
dedent|''
name|'return'
name|'wrapper'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|translate_snapshot_exception
dedent|''
name|'def'
name|'translate_snapshot_exception'
op|'('
name|'method'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Transforms the exception for the snapshot but keeps its traceback\n       intact.\n    """'
newline|'\n'
DECL|function|wrapper
name|'def'
name|'wrapper'
op|'('
name|'self'
op|','
name|'ctx'
op|','
name|'snapshot_id'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'res'
op|'='
name|'method'
op|'('
name|'self'
op|','
name|'ctx'
op|','
name|'snapshot_id'
op|','
op|'*'
name|'args'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'cinder_exception'
op|'.'
name|'ClientException'
op|':'
newline|'\n'
indent|'            '
name|'exc_type'
op|','
name|'exc_value'
op|','
name|'exc_trace'
op|'='
name|'sys'
op|'.'
name|'exc_info'
op|'('
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'exc_value'
op|','
name|'cinder_exception'
op|'.'
name|'NotFound'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'exc_value'
op|'='
name|'exception'
op|'.'
name|'SnapshotNotFound'
op|'('
name|'snapshot_id'
op|'='
name|'snapshot_id'
op|')'
newline|'\n'
dedent|''
name|'raise'
name|'exc_value'
op|','
name|'None'
op|','
name|'exc_trace'
newline|'\n'
dedent|''
name|'except'
name|'cinder_exception'
op|'.'
name|'ConnectionError'
op|':'
newline|'\n'
indent|'            '
name|'exc_type'
op|','
name|'exc_value'
op|','
name|'exc_trace'
op|'='
name|'sys'
op|'.'
name|'exc_info'
op|'('
op|')'
newline|'\n'
name|'exc_value'
op|'='
name|'exception'
op|'.'
name|'CinderConnectionFailed'
op|'('
nl|'\n'
name|'reason'
op|'='
name|'exc_value'
op|'.'
name|'message'
op|')'
newline|'\n'
name|'raise'
name|'exc_value'
op|','
name|'None'
op|','
name|'exc_trace'
newline|'\n'
dedent|''
name|'return'
name|'res'
newline|'\n'
dedent|''
name|'return'
name|'wrapper'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|get_cinder_client_version
dedent|''
name|'def'
name|'get_cinder_client_version'
op|'('
name|'context'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""Parse cinder client version by endpoint url.\n\n    :param context: Nova auth context.\n    :return: str value(1 or 2).\n    """'
newline|'\n'
name|'global'
name|'CINDER_URL'
newline|'\n'
comment|'# FIXME: the cinderclient ServiceCatalog object is mis-named.'
nl|'\n'
comment|'#        It actually contains the entire access blob.'
nl|'\n'
comment|'# Only needed parts of the service catalog are passed in, see'
nl|'\n'
comment|'# nova/context.py.'
nl|'\n'
name|'compat_catalog'
op|'='
op|'{'
nl|'\n'
string|"'access'"
op|':'
op|'{'
string|"'serviceCatalog'"
op|':'
name|'context'
op|'.'
name|'service_catalog'
name|'or'
op|'['
op|']'
op|'}'
nl|'\n'
op|'}'
newline|'\n'
name|'sc'
op|'='
name|'service_catalog'
op|'.'
name|'ServiceCatalog'
op|'('
name|'compat_catalog'
op|')'
newline|'\n'
name|'if'
name|'CONF'
op|'.'
name|'cinder_endpoint_template'
op|':'
newline|'\n'
indent|'        '
name|'url'
op|'='
name|'CONF'
op|'.'
name|'cinder_endpoint_template'
op|'%'
name|'context'
op|'.'
name|'to_dict'
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'info'
op|'='
name|'CONF'
op|'.'
name|'cinder_catalog_info'
newline|'\n'
name|'service_type'
op|','
name|'service_name'
op|','
name|'endpoint_type'
op|'='
name|'info'
op|'.'
name|'split'
op|'('
string|"':'"
op|')'
newline|'\n'
comment|'# extract the region if set in configuration'
nl|'\n'
name|'if'
name|'CONF'
op|'.'
name|'os_region_name'
op|':'
newline|'\n'
indent|'            '
name|'attr'
op|'='
string|"'region'"
newline|'\n'
name|'filter_value'
op|'='
name|'CONF'
op|'.'
name|'os_region_name'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'attr'
op|'='
name|'None'
newline|'\n'
name|'filter_value'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'url'
op|'='
name|'sc'
op|'.'
name|'url_for'
op|'('
name|'attr'
op|'='
name|'attr'
op|','
nl|'\n'
name|'filter_value'
op|'='
name|'filter_value'
op|','
nl|'\n'
name|'service_type'
op|'='
name|'service_type'
op|','
nl|'\n'
name|'service_name'
op|'='
name|'service_name'
op|','
nl|'\n'
name|'endpoint_type'
op|'='
name|'endpoint_type'
op|')'
newline|'\n'
dedent|''
name|'LOG'
op|'.'
name|'debug'
op|'('
string|"'Cinderclient connection created using URL: %s'"
op|','
name|'url'
op|')'
newline|'\n'
nl|'\n'
name|'valid_versions'
op|'='
op|'['
string|"'v1'"
op|','
string|"'v2'"
op|']'
newline|'\n'
name|'magic_tuple'
op|'='
name|'urlparse'
op|'.'
name|'urlsplit'
op|'('
name|'url'
op|')'
newline|'\n'
name|'scheme'
op|','
name|'netloc'
op|','
name|'path'
op|','
name|'query'
op|','
name|'frag'
op|'='
name|'magic_tuple'
newline|'\n'
name|'components'
op|'='
name|'path'
op|'.'
name|'split'
op|'('
string|'"/"'
op|')'
newline|'\n'
name|'for'
name|'version'
name|'in'
name|'valid_versions'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'version'
name|'in'
name|'components'
op|'['
number|'1'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
name|'version'
op|'['
number|'1'
op|':'
op|']'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'CINDER_URL'
name|'and'
name|'version'
op|'=='
string|"'1'"
op|':'
newline|'\n'
indent|'                '
name|'msg'
op|'='
name|'_LW'
op|'('
string|"'Cinder V1 API is deprecated as of the Juno '"
nl|'\n'
string|"'release, and Nova is still configured to use it. '"
nl|'\n'
string|"'Enable the V2 API in Cinder and set '"
nl|'\n'
string|"'cinder_catalog_info in nova.conf to use it.'"
op|')'
newline|'\n'
name|'LOG'
op|'.'
name|'warn'
op|'('
name|'msg'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'CINDER_URL'
op|'='
name|'url'
newline|'\n'
name|'return'
name|'version'
newline|'\n'
dedent|''
dedent|''
name|'msg'
op|'='
name|'_'
op|'('
string|'"Invalid client version, must be one of: %s"'
op|')'
op|'%'
name|'valid_versions'
newline|'\n'
name|'raise'
name|'cinder_exception'
op|'.'
name|'UnsupportedVersion'
op|'('
name|'msg'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|API
dedent|''
name|'class'
name|'API'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""API for interacting with the volume manager."""'
newline|'\n'
nl|'\n'
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|get
name|'def'
name|'get'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'item'
op|'='
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'get'
op|'('
name|'volume_id'
op|')'
newline|'\n'
name|'return'
name|'_untranslate_volume_summary_view'
op|'('
name|'context'
op|','
name|'item'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_all
dedent|''
name|'def'
name|'get_all'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'search_opts'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'search_opts'
op|'='
name|'search_opts'
name|'or'
op|'{'
op|'}'
newline|'\n'
name|'items'
op|'='
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'list'
op|'('
name|'detailed'
op|'='
name|'True'
op|')'
newline|'\n'
name|'rval'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'for'
name|'item'
name|'in'
name|'items'
op|':'
newline|'\n'
indent|'            '
name|'rval'
op|'.'
name|'append'
op|'('
name|'_untranslate_volume_summary_view'
op|'('
name|'context'
op|','
name|'item'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'rval'
newline|'\n'
nl|'\n'
DECL|member|check_attached
dedent|''
name|'def'
name|'check_attached'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'volume'
op|'['
string|"'status'"
op|']'
op|'!='
string|'"in-use"'
op|':'
newline|'\n'
indent|'            '
name|'msg'
op|'='
name|'_'
op|'('
string|'"status must be \'in-use\'"'
op|')'
newline|'\n'
name|'raise'
name|'exception'
op|'.'
name|'InvalidVolume'
op|'('
name|'reason'
op|'='
name|'msg'
op|')'
newline|'\n'
nl|'\n'
DECL|member|check_attach
dedent|''
dedent|''
name|'def'
name|'check_attach'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume'
op|','
name|'instance'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# TODO(vish): abstract status checking?'
nl|'\n'
indent|'        '
name|'if'
name|'volume'
op|'['
string|"'status'"
op|']'
op|'!='
string|'"available"'
op|':'
newline|'\n'
indent|'            '
name|'msg'
op|'='
name|'_'
op|'('
string|'"status must be \'available\'"'
op|')'
newline|'\n'
name|'raise'
name|'exception'
op|'.'
name|'InvalidVolume'
op|'('
name|'reason'
op|'='
name|'msg'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'volume'
op|'['
string|"'attach_status'"
op|']'
op|'=='
string|'"attached"'
op|':'
newline|'\n'
indent|'            '
name|'msg'
op|'='
name|'_'
op|'('
string|'"already attached"'
op|')'
newline|'\n'
name|'raise'
name|'exception'
op|'.'
name|'InvalidVolume'
op|'('
name|'reason'
op|'='
name|'msg'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'instance'
name|'and'
name|'not'
name|'CONF'
op|'.'
name|'cinder_cross_az_attach'
op|':'
newline|'\n'
comment|"# NOTE(sorrison): If instance is on a host we match against it's AZ"
nl|'\n'
comment|'#                 else we check the intended AZ'
nl|'\n'
indent|'            '
name|'if'
name|'instance'
op|'.'
name|'get'
op|'('
string|"'host'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'instance_az'
op|'='
name|'az'
op|'.'
name|'get_instance_availability_zone'
op|'('
nl|'\n'
name|'context'
op|','
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'instance_az'
op|'='
name|'instance'
op|'['
string|"'availability_zone'"
op|']'
newline|'\n'
dedent|''
name|'if'
name|'instance_az'
op|'!='
name|'volume'
op|'['
string|"'availability_zone'"
op|']'
op|':'
newline|'\n'
indent|'                '
name|'msg'
op|'='
name|'_'
op|'('
string|'"Instance and volume not in same availability_zone"'
op|')'
newline|'\n'
name|'raise'
name|'exception'
op|'.'
name|'InvalidVolume'
op|'('
name|'reason'
op|'='
name|'msg'
op|')'
newline|'\n'
nl|'\n'
DECL|member|check_detach
dedent|''
dedent|''
dedent|''
name|'def'
name|'check_detach'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume'
op|')'
op|':'
newline|'\n'
comment|'# TODO(vish): abstract status checking?'
nl|'\n'
indent|'        '
name|'if'
name|'volume'
op|'['
string|"'status'"
op|']'
op|'=='
string|'"available"'
op|':'
newline|'\n'
indent|'            '
name|'msg'
op|'='
name|'_'
op|'('
string|'"already detached"'
op|')'
newline|'\n'
name|'raise'
name|'exception'
op|'.'
name|'InvalidVolume'
op|'('
name|'reason'
op|'='
name|'msg'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|reserve_volume
name|'def'
name|'reserve_volume'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'reserve'
op|'('
name|'volume_id'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|unreserve_volume
name|'def'
name|'unreserve_volume'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'unreserve'
op|'('
name|'volume_id'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|begin_detaching
name|'def'
name|'begin_detaching'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'begin_detaching'
op|'('
name|'volume_id'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|roll_detaching
name|'def'
name|'roll_detaching'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'roll_detaching'
op|'('
name|'volume_id'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|attach
name|'def'
name|'attach'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|','
name|'instance_uuid'
op|','
name|'mountpoint'
op|','
name|'mode'
op|'='
string|"'rw'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'attach'
op|'('
name|'volume_id'
op|','
name|'instance_uuid'
op|','
nl|'\n'
name|'mountpoint'
op|','
name|'mode'
op|'='
name|'mode'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|detach
name|'def'
name|'detach'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'detach'
op|'('
name|'volume_id'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|initialize_connection
name|'def'
name|'initialize_connection'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|','
name|'connector'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'initialize_connection'
op|'('
name|'volume_id'
op|','
nl|'\n'
name|'connector'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|terminate_connection
name|'def'
name|'terminate_connection'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|','
name|'connector'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'terminate_connection'
op|'('
name|'volume_id'
op|','
nl|'\n'
name|'connector'
op|')'
newline|'\n'
nl|'\n'
DECL|member|migrate_volume_completion
dedent|''
name|'def'
name|'migrate_volume_completion'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'old_volume_id'
op|','
name|'new_volume_id'
op|','
nl|'\n'
name|'error'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'migrate_volume_completion'
op|'('
nl|'\n'
name|'old_volume_id'
op|','
name|'new_volume_id'
op|','
name|'error'
op|')'
newline|'\n'
nl|'\n'
DECL|member|create
dedent|''
name|'def'
name|'create'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'size'
op|','
name|'name'
op|','
name|'description'
op|','
name|'snapshot'
op|'='
name|'None'
op|','
nl|'\n'
name|'image_id'
op|'='
name|'None'
op|','
name|'volume_type'
op|'='
name|'None'
op|','
name|'metadata'
op|'='
name|'None'
op|','
nl|'\n'
name|'availability_zone'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'        '
name|'if'
name|'snapshot'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'snapshot_id'
op|'='
name|'snapshot'
op|'['
string|"'id'"
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'snapshot_id'
op|'='
name|'None'
newline|'\n'
nl|'\n'
dedent|''
name|'kwargs'
op|'='
name|'dict'
op|'('
name|'snapshot_id'
op|'='
name|'snapshot_id'
op|','
nl|'\n'
name|'volume_type'
op|'='
name|'volume_type'
op|','
nl|'\n'
name|'user_id'
op|'='
name|'context'
op|'.'
name|'user_id'
op|','
nl|'\n'
name|'project_id'
op|'='
name|'context'
op|'.'
name|'project_id'
op|','
nl|'\n'
name|'availability_zone'
op|'='
name|'availability_zone'
op|','
nl|'\n'
name|'metadata'
op|'='
name|'metadata'
op|','
nl|'\n'
name|'imageRef'
op|'='
name|'image_id'
op|')'
newline|'\n'
nl|'\n'
name|'version'
op|'='
name|'get_cinder_client_version'
op|'('
name|'context'
op|')'
newline|'\n'
name|'if'
name|'version'
op|'=='
string|"'1'"
op|':'
newline|'\n'
indent|'            '
name|'kwargs'
op|'['
string|"'display_name'"
op|']'
op|'='
name|'name'
newline|'\n'
name|'kwargs'
op|'['
string|"'display_description'"
op|']'
op|'='
name|'description'
newline|'\n'
dedent|''
name|'elif'
name|'version'
op|'=='
string|"'2'"
op|':'
newline|'\n'
indent|'            '
name|'kwargs'
op|'['
string|"'name'"
op|']'
op|'='
name|'name'
newline|'\n'
name|'kwargs'
op|'['
string|"'description'"
op|']'
op|'='
name|'description'
newline|'\n'
nl|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'item'
op|'='
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'create'
op|'('
name|'size'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
name|'return'
name|'_untranslate_volume_summary_view'
op|'('
name|'context'
op|','
name|'item'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'cinder_exception'
op|'.'
name|'OverLimit'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'OverQuota'
op|'('
name|'overs'
op|'='
string|"'volumes'"
op|')'
newline|'\n'
dedent|''
name|'except'
name|'cinder_exception'
op|'.'
name|'BadRequest'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'exception'
op|'.'
name|'InvalidInput'
op|'('
name|'reason'
op|'='
name|'unicode'
op|'('
name|'e'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|delete
name|'def'
name|'delete'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'delete'
op|'('
name|'volume_id'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|update
name|'def'
name|'update'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|','
name|'fields'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'NotImplementedError'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_snapshot_exception'
newline|'\n'
DECL|member|get_snapshot
name|'def'
name|'get_snapshot'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'snapshot_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'item'
op|'='
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volume_snapshots'
op|'.'
name|'get'
op|'('
name|'snapshot_id'
op|')'
newline|'\n'
name|'return'
name|'_untranslate_snapshot_summary_view'
op|'('
name|'context'
op|','
name|'item'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_all_snapshots
dedent|''
name|'def'
name|'get_all_snapshots'
op|'('
name|'self'
op|','
name|'context'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'items'
op|'='
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volume_snapshots'
op|'.'
name|'list'
op|'('
name|'detailed'
op|'='
name|'True'
op|')'
newline|'\n'
name|'rvals'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'for'
name|'item'
name|'in'
name|'items'
op|':'
newline|'\n'
indent|'            '
name|'rvals'
op|'.'
name|'append'
op|'('
name|'_untranslate_snapshot_summary_view'
op|'('
name|'context'
op|','
name|'item'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'rvals'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|create_snapshot
name|'def'
name|'create_snapshot'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|','
name|'name'
op|','
name|'description'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'item'
op|'='
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volume_snapshots'
op|'.'
name|'create'
op|'('
name|'volume_id'
op|','
nl|'\n'
name|'False'
op|','
nl|'\n'
name|'name'
op|','
nl|'\n'
name|'description'
op|')'
newline|'\n'
name|'return'
name|'_untranslate_snapshot_summary_view'
op|'('
name|'context'
op|','
name|'item'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|create_snapshot_force
name|'def'
name|'create_snapshot_force'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|','
name|'name'
op|','
name|'description'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'item'
op|'='
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volume_snapshots'
op|'.'
name|'create'
op|'('
name|'volume_id'
op|','
nl|'\n'
name|'True'
op|','
nl|'\n'
name|'name'
op|','
nl|'\n'
name|'description'
op|')'
newline|'\n'
nl|'\n'
name|'return'
name|'_untranslate_snapshot_summary_view'
op|'('
name|'context'
op|','
name|'item'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_snapshot_exception'
newline|'\n'
DECL|member|delete_snapshot
name|'def'
name|'delete_snapshot'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'snapshot_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volume_snapshots'
op|'.'
name|'delete'
op|'('
name|'snapshot_id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_volume_encryption_metadata
dedent|''
name|'def'
name|'get_volume_encryption_metadata'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'get_encryption_metadata'
op|'('
name|'volume_id'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|get_volume_metadata
name|'def'
name|'get_volume_metadata'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vol'
op|'='
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'get'
op|'('
name|'volume_id'
op|')'
newline|'\n'
name|'return'
name|'vol'
op|'.'
name|'metadata'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|delete_volume_metadata
name|'def'
name|'delete_volume_metadata'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|','
name|'keys'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'delete_metadata'
op|'('
name|'volume_id'
op|','
name|'keys'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|update_volume_metadata
name|'def'
name|'update_volume_metadata'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|','
nl|'\n'
name|'metadata'
op|','
name|'delete'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'delete'
op|':'
newline|'\n'
comment|'# Completely replace volume metadata with one given'
nl|'\n'
indent|'            '
name|'return'
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'update_all_metadata'
op|'('
nl|'\n'
name|'volume_id'
op|','
name|'metadata'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'set_metadata'
op|'('
nl|'\n'
name|'volume_id'
op|','
name|'metadata'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
op|'@'
name|'translate_volume_exception'
newline|'\n'
DECL|member|get_volume_metadata_value
name|'def'
name|'get_volume_metadata_value'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'volume_id'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vol'
op|'='
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volumes'
op|'.'
name|'get'
op|'('
name|'volume_id'
op|')'
newline|'\n'
name|'return'
name|'vol'
op|'.'
name|'metadata'
op|'.'
name|'get'
op|'('
name|'key'
op|')'
newline|'\n'
nl|'\n'
dedent|''
op|'@'
name|'translate_snapshot_exception'
newline|'\n'
DECL|member|update_snapshot_status
name|'def'
name|'update_snapshot_status'
op|'('
name|'self'
op|','
name|'context'
op|','
name|'snapshot_id'
op|','
name|'status'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'vs'
op|'='
name|'cinderclient'
op|'('
name|'context'
op|')'
op|'.'
name|'volume_snapshots'
newline|'\n'
nl|'\n'
comment|"# '90%' here is used to tell Cinder that Nova is done"
nl|'\n'
comment|"# with its portion of the 'creating' state. This can"
nl|'\n'
comment|'# be removed when we are able to split the Cinder states'
nl|'\n'
comment|"# into 'creating' and a separate state of"
nl|'\n'
comment|"# 'creating_in_nova'. (Same for 'deleting' state.)"
nl|'\n'
nl|'\n'
name|'vs'
op|'.'
name|'update_snapshot_status'
op|'('
nl|'\n'
name|'snapshot_id'
op|','
nl|'\n'
op|'{'
string|"'status'"
op|':'
name|'status'
op|','
nl|'\n'
string|"'progress'"
op|':'
string|"'90%'"
op|'}'
nl|'\n'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
