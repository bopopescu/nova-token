begin_unit
comment|'# Copyright 2013 Red Hat, Inc.'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
string|'"""\nClient side of the compute RPC API.\n"""'
newline|'\n'
nl|'\n'
name|'from'
name|'oslo'
op|'.'
name|'config'
name|'import'
name|'cfg'
newline|'\n'
name|'from'
name|'oslo'
name|'import'
name|'messaging'
newline|'\n'
nl|'\n'
name|'from'
name|'nova'
name|'import'
name|'block_device'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'exception'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'objects'
name|'import'
name|'base'
name|'as'
name|'objects_base'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
op|'.'
name|'gettextutils'
name|'import'
name|'_'
newline|'\n'
name|'from'
name|'nova'
op|'.'
name|'openstack'
op|'.'
name|'common'
name|'import'
name|'jsonutils'
newline|'\n'
name|'from'
name|'nova'
name|'import'
name|'rpc'
newline|'\n'
nl|'\n'
DECL|variable|rpcapi_opts
name|'rpcapi_opts'
op|'='
op|'['
nl|'\n'
name|'cfg'
op|'.'
name|'StrOpt'
op|'('
string|"'compute_topic'"
op|','
nl|'\n'
DECL|variable|default
name|'default'
op|'='
string|"'compute'"
op|','
nl|'\n'
DECL|variable|help
name|'help'
op|'='
string|"'The topic compute nodes listen on'"
op|')'
op|','
nl|'\n'
op|']'
newline|'\n'
nl|'\n'
DECL|variable|CONF
name|'CONF'
op|'='
name|'cfg'
op|'.'
name|'CONF'
newline|'\n'
name|'CONF'
op|'.'
name|'register_opts'
op|'('
name|'rpcapi_opts'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|rpcapi_cap_opt
name|'rpcapi_cap_opt'
op|'='
name|'cfg'
op|'.'
name|'StrOpt'
op|'('
string|"'compute'"
op|','
nl|'\n'
DECL|variable|help
name|'help'
op|'='
string|"'Set a version cap for messages sent to compute services. If you '"
nl|'\n'
string|"'plan to do a live upgrade from havana to icehouse, you should '"
nl|'\n'
string|'\'set this option to "icehouse-compat" before beginning the live \''
nl|'\n'
string|"'upgrade procedure.'"
op|')'
newline|'\n'
name|'CONF'
op|'.'
name|'register_opt'
op|'('
name|'rpcapi_cap_opt'
op|','
string|"'upgrade_levels'"
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|function|_compute_host
name|'def'
name|'_compute_host'
op|'('
name|'host'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
indent|'    '
string|"'''Get the destination host for a message.\n\n    :param host: explicit host to send the message to.\n    :param instance: If an explicit host was not specified, use\n                     instance['host']\n\n    :returns: A host\n    '''"
newline|'\n'
name|'if'
name|'host'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'host'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'instance'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'exception'
op|'.'
name|'NovaException'
op|'('
name|'_'
op|'('
string|"'No compute host specified'"
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'instance'
op|'['
string|"'host'"
op|']'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'exception'
op|'.'
name|'NovaException'
op|'('
name|'_'
op|'('
string|"'Unable to find host for '"
nl|'\n'
string|"'Instance %s'"
op|')'
op|'%'
name|'instance'
op|'['
string|"'uuid'"
op|']'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'instance'
op|'['
string|"'host'"
op|']'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|ComputeAPI
dedent|''
name|'class'
name|'ComputeAPI'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
string|"'''Client side of the compute rpc API.\n\n    API version history:\n\n        1.0 - Initial version.\n        1.1 - Adds get_host_uptime()\n        1.2 - Adds check_can_live_migrate_[destination|source]\n        1.3 - Adds change_instance_metadata()\n        1.4 - Remove instance_uuid, add instance argument to reboot_instance()\n        1.5 - Remove instance_uuid, add instance argument to pause_instance(),\n              unpause_instance()\n        1.6 - Remove instance_uuid, add instance argument to suspend_instance()\n        1.7 - Remove instance_uuid, add instance argument to\n              get_console_output()\n        1.8 - Remove instance_uuid, add instance argument to\n              add_fixed_ip_to_instance()\n        1.9 - Remove instance_uuid, add instance argument to attach_volume()\n        1.10 - Remove instance_id, add instance argument to\n               check_can_live_migrate_destination()\n        1.11 - Remove instance_id, add instance argument to\n               check_can_live_migrate_source()\n        1.12 - Remove instance_uuid, add instance argument to confirm_resize()\n        1.13 - Remove instance_uuid, add instance argument to detach_volume()\n        1.14 - Remove instance_uuid, add instance argument to finish_resize()\n        1.15 - Remove instance_uuid, add instance argument to\n               finish_revert_resize()\n        1.16 - Remove instance_uuid, add instance argument to get_diagnostics()\n        1.17 - Remove instance_uuid, add instance argument to get_vnc_console()\n        1.18 - Remove instance_uuid, add instance argument to inject_file()\n        1.19 - Remove instance_uuid, add instance argument to\n               inject_network_info()\n        1.20 - Remove instance_id, add instance argument to\n               post_live_migration_at_destination()\n        1.21 - Remove instance_uuid, add instance argument to\n               power_off_instance() and stop_instance()\n        1.22 - Remove instance_uuid, add instance argument to\n               power_on_instance() and start_instance()\n        1.23 - Remove instance_id, add instance argument to\n               pre_live_migration()\n        1.24 - Remove instance_uuid, add instance argument to\n               rebuild_instance()\n        1.25 - Remove instance_uuid, add instance argument to\n               remove_fixed_ip_from_instance()\n        1.26 - Remove instance_id, add instance argument to\n               remove_volume_connection()\n        1.27 - Remove instance_uuid, add instance argument to\n               rescue_instance()\n        1.28 - Remove instance_uuid, add instance argument to reset_network()\n        1.29 - Remove instance_uuid, add instance argument to resize_instance()\n        1.30 - Remove instance_uuid, add instance argument to resume_instance()\n        1.31 - Remove instance_uuid, add instance argument to revert_resize()\n        1.32 - Remove instance_id, add instance argument to\n               rollback_live_migration_at_destination()\n        1.33 - Remove instance_uuid, add instance argument to\n               set_admin_password()\n        1.34 - Remove instance_uuid, add instance argument to\n               snapshot_instance()\n        1.35 - Remove instance_uuid, add instance argument to\n               unrescue_instance()\n        1.36 - Remove instance_uuid, add instance argument to\n               change_instance_metadata()\n        1.37 - Remove instance_uuid, add instance argument to\n               terminate_instance()\n        1.38 - Changes to prep_resize():\n                - remove instance_uuid, add instance\n                - remove instance_type_id, add instance_type\n                - remove topic, it was unused\n        1.39 - Remove instance_uuid, add instance argument to run_instance()\n        1.40 - Remove instance_id, add instance argument to live_migration()\n        1.41 - Adds refresh_instance_security_rules()\n        1.42 - Add reservations arg to prep_resize(), resize_instance(),\n               finish_resize(), confirm_resize(), revert_resize() and\n               finish_revert_resize()\n        1.43 - Add migrate_data to live_migration()\n        1.44 - Adds reserve_block_device_name()\n\n        2.0 - Remove 1.x backwards compat\n        2.1 - Adds orig_sys_metadata to rebuild_instance()\n        2.2 - Adds slave_info parameter to add_aggregate_host() and\n              remove_aggregate_host()\n        2.3 - Adds volume_id to reserve_block_device_name()\n        2.4 - Add bdms to terminate_instance\n        2.5 - Add block device and network info to reboot_instance\n        2.6 - Remove migration_id, add migration to resize_instance\n        2.7 - Remove migration_id, add migration to confirm_resize\n        2.8 - Remove migration_id, add migration to finish_resize\n        2.9 - Add publish_service_capabilities()\n        2.10 - Adds filter_properties and request_spec to prep_resize()\n        2.11 - Adds soft_delete_instance() and restore_instance()\n        2.12 - Remove migration_id, add migration to revert_resize\n        2.13 - Remove migration_id, add migration to finish_revert_resize\n        2.14 - Remove aggregate_id, add aggregate to add_aggregate_host\n        2.15 - Remove aggregate_id, add aggregate to remove_aggregate_host\n        2.16 - Add instance_type to resize_instance\n        2.17 - Add get_backdoor_port()\n        2.18 - Add bdms to rebuild_instance\n        2.19 - Add node to run_instance\n        2.20 - Add node to prep_resize\n        2.21 - Add migrate_data dict param to pre_live_migration()\n        2.22 - Add recreate, on_shared_storage and host arguments to\n               rebuild_instance()\n        2.23 - Remove network_info from reboot_instance\n        2.24 - Added get_spice_console method\n        2.25 - Add attach_interface() and detach_interface()\n        2.26 - Add validate_console_port to ensure the service connects to\n               vnc on the correct port\n        2.27 - Adds 'reservations' to terminate_instance() and\n               soft_delete_instance()\n\n        ... Grizzly supports message version 2.27.  So, any changes to existing\n        methods in 2.x after that point should be done such that they can\n        handle the version_cap being set to 2.27.\n\n        2.28 - Adds check_instance_shared_storage()\n        2.29 - Made start_instance() and stop_instance() take new-world\n               instance objects\n        2.30 - Adds live_snapshot_instance()\n        2.31 - Adds shelve_instance(), shelve_offload_instance, and\n               unshelve_instance()\n        2.32 - Make reboot_instance take a new world instance object\n        2.33 - Made suspend_instance() and resume_instance() take new-world\n               instance objects\n        2.34 - Added swap_volume()\n        2.35 - Made terminate_instance() and soft_delete_instance() take\n               new-world instance objects\n        2.36 - Made pause_instance() and unpause_instance() take new-world\n               instance objects\n        2.37 - Added the legacy_bdm_in_spec parameter to run_instance\n        2.38 - Made check_can_live_migrate_[destination|source] take\n               new-world instance objects\n        2.39 - Made revert_resize() and confirm_resize() take new-world\n               instance objects\n        2.40 - Made reset_network() take new-world instance object\n        2.41 - Make inject_network_info take new-world instance object\n        2.42 - Splits snapshot_instance() into snapshot_instance() and\n               backup_instance() and makes them take new-world instance\n               objects.\n        2.43 - Made prep_resize() take new-world instance object\n        2.44 - Add volume_snapshot_create(), volume_snapshot_delete()\n        2.45 - Made resize_instance() take new-world objects\n        2.46 - Made finish_resize() take new-world objects\n        2.47 - Made finish_revert_resize() take new-world objects\n\n        ... Havana supports message version 2.47.  So, any changes to existing\n        methods in 2.x after that point should be done such that they can\n        handle the version_cap being set to 2.47.\n\n        2.48 - Make add_aggregate_host() and remove_aggregate_host() take\n               new-world objects\n        ...  - Remove live_snapshot() that was never actually used\n\n        3.0 - Remove 2.x compatibility\n        3.1 - Update get_spice_console() to take an instance object\n        3.2 - Update get_vnc_console() to take an instance object\n        3.3 - Update validate_console_port() to take an instance object\n        3.4 - Update rebuild_instance() to take an instance object\n        3.5 - Pass preserve_ephemeral flag to rebuild_instance()\n        3.6 - Make volume_snapshot_{create,delete} use new-world objects\n        3.7 - Update change_instance_metadata() to take an instance object\n        3.8 - Update set_admin_password() to take an instance object\n        3.9 - Update rescue_instance() to take an instance object\n        3.10 - Added get_rdp_console method\n        3.11 - Update unrescue_instance() to take an object\n        3.12 - Update add_fixed_ip_to_instance() to take an object\n        3.13 - Update remove_fixed_ip_from_instance() to take an object\n        3.14 - Update post_live_migration_at_destination() to take an object\n        3.15 - Adds filter_properties and node to unshelve_instance()\n        3.16 - Make reserve_block_device_name and attach_volume use new-world\n              objects, and add disk_bus and device_type params to\n              reserve_block_device_name, and bdm param to attach_volume\n        3.17 - Update attach_interface and detach_interface to take an object\n        3.18 - Update get_diagnostics() to take an instance object\n        ...  - Removed inject_file(), as it was unused.\n        3.19 - Update pre_live_migration to take instance object\n        3.20 - Make restore_instance take an instance object\n        3.21 - Made rebuild take new-world BDM objects\n        3.22 - Made terminate_instance take new-world BDM objects\n        3.23 - Added external_instance_event()\n             - build_and_run_instance was added in Havana and not used or\n               documented.\n\n        ... Icehouse supports message version 3.23.  So, any changes to\n        existing methods in 3.x after that point should be done such that they\n        can handle the version_cap being set to 3.23.\n\n        3.24 - Update rescue_instance() to take optional rescue_image_ref\n        3.25 - Make detach_volume take an object\n        3.26 - Make live_migration() and\n               rollback_live_migration_at_destination() take an object\n        ...  - Removed run_instance()\n        3.27 - Make run_instance() accept a new-world object\n        3.28 - Update get_console_output() to accept a new-world object\n        3.29 - Make check_instance_shared_storage accept a new-world object\n        3.30 - Make remove_volume_connection() accept a new-world object\n    '''"
newline|'\n'
nl|'\n'
DECL|variable|VERSION_ALIASES
name|'VERSION_ALIASES'
op|'='
op|'{'
nl|'\n'
string|"'grizzly'"
op|':'
string|"'2.27'"
op|','
nl|'\n'
string|"'havana'"
op|':'
string|"'2.47'"
op|','
nl|'\n'
comment|"# NOTE(russellb) 'icehouse-compat' is the version that is supported by"
nl|'\n'
comment|"# both havana and icehouse.  Later, 'icehouse' will be added that lists"
nl|'\n'
comment|'# the maximum version supported by icehouse.'
nl|'\n'
string|"'icehouse-compat'"
op|':'
string|"'3.0'"
op|','
nl|'\n'
string|"'icehouse'"
op|':'
string|"'3.23'"
op|','
nl|'\n'
op|'}'
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'ComputeAPI'
op|','
name|'self'
op|')'
op|'.'
name|'__init__'
op|'('
op|')'
newline|'\n'
name|'target'
op|'='
name|'messaging'
op|'.'
name|'Target'
op|'('
name|'topic'
op|'='
name|'CONF'
op|'.'
name|'compute_topic'
op|','
name|'version'
op|'='
string|"'3.0'"
op|')'
newline|'\n'
name|'version_cap'
op|'='
name|'self'
op|'.'
name|'VERSION_ALIASES'
op|'.'
name|'get'
op|'('
name|'CONF'
op|'.'
name|'upgrade_levels'
op|'.'
name|'compute'
op|','
nl|'\n'
name|'CONF'
op|'.'
name|'upgrade_levels'
op|'.'
name|'compute'
op|')'
newline|'\n'
name|'serializer'
op|'='
name|'objects_base'
op|'.'
name|'NovaObjectSerializer'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'='
name|'self'
op|'.'
name|'get_client'
op|'('
name|'target'
op|','
name|'version_cap'
op|','
name|'serializer'
op|')'
newline|'\n'
nl|'\n'
comment|'# Cells overrides this'
nl|'\n'
DECL|member|get_client
dedent|''
name|'def'
name|'get_client'
op|'('
name|'self'
op|','
name|'target'
op|','
name|'version_cap'
op|','
name|'serializer'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'rpc'
op|'.'
name|'get_client'
op|'('
name|'target'
op|','
nl|'\n'
name|'version_cap'
op|'='
name|'version_cap'
op|','
nl|'\n'
name|'serializer'
op|'='
name|'serializer'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_compat_version
dedent|''
name|'def'
name|'_get_compat_version'
op|'('
name|'self'
op|','
name|'current'
op|','
name|'havana_compat'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
name|'current'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'havana_compat'
newline|'\n'
dedent|''
name|'return'
name|'current'
newline|'\n'
nl|'\n'
DECL|member|add_aggregate_host
dedent|''
name|'def'
name|'add_aggregate_host'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'aggregate'
op|','
name|'host_param'
op|','
name|'host'
op|','
nl|'\n'
name|'slave_info'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|"'''Add aggregate host.\n\n        :param ctxt: request context\n        :param aggregate_id:\n        :param host_param: This value is placed in the message to be the 'host'\n                           parameter for the remote method.\n        :param host: This is the host to send the message to.\n        '''"
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.0'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.0'"
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'2.48'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'2.48'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
string|"'2.14'"
newline|'\n'
name|'aggregate'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'aggregate'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'add_aggregate_host'"
op|','
nl|'\n'
name|'aggregate'
op|'='
name|'aggregate'
op|','
name|'host'
op|'='
name|'host_param'
op|','
nl|'\n'
name|'slave_info'
op|'='
name|'slave_info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|add_fixed_ip_to_instance
dedent|''
name|'def'
name|'add_fixed_ip_to_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'network_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.12'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.12'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'add_fixed_ip_to_instance'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'network_id'
op|'='
name|'network_id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|attach_interface
dedent|''
name|'def'
name|'attach_interface'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'network_id'
op|','
name|'port_id'
op|','
nl|'\n'
name|'requested_ip'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.17'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.17'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.25'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'attach_interface'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'network_id'
op|'='
name|'network_id'
op|','
nl|'\n'
name|'port_id'
op|'='
name|'port_id'
op|','
name|'requested_ip'
op|'='
name|'requested_ip'
op|')'
newline|'\n'
nl|'\n'
DECL|member|attach_volume
dedent|''
name|'def'
name|'attach_volume'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'volume_id'
op|','
name|'mountpoint'
op|','
name|'bdm'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(ndipanov): Remove volume_id and mountpoint on the next major'
nl|'\n'
comment|'# version bump - they are not needed when using bdm objects.'
nl|'\n'
indent|'        '
name|'version'
op|'='
string|"'3.16'"
newline|'\n'
name|'kw'
op|'='
op|'{'
string|"'instance'"
op|':'
name|'instance'
op|','
string|"'volume_id'"
op|':'
name|'volume_id'
op|','
nl|'\n'
string|"'mountpoint'"
op|':'
name|'mountpoint'
op|','
string|"'bdm'"
op|':'
name|'bdm'
op|'}'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
name|'version'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'kw'
op|'['
string|"'instance'"
op|']'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
nl|'\n'
name|'objects_base'
op|'.'
name|'obj_to_primitive'
op|'('
name|'instance'
op|')'
op|')'
newline|'\n'
name|'del'
name|'kw'
op|'['
string|"'bdm'"
op|']'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'attach_volume'"
op|','
op|'**'
name|'kw'
op|')'
newline|'\n'
nl|'\n'
DECL|member|change_instance_metadata
dedent|''
name|'def'
name|'change_instance_metadata'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'diff'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.7'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.7'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'change_instance_metadata'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'diff'
op|'='
name|'diff'
op|')'
newline|'\n'
nl|'\n'
DECL|member|check_can_live_migrate_destination
dedent|''
name|'def'
name|'check_can_live_migrate_destination'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'destination'
op|','
nl|'\n'
name|'block_migration'
op|','
name|'disk_over_commit'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.38'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'destination'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'check_can_live_migrate_destination'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
nl|'\n'
name|'block_migration'
op|'='
name|'block_migration'
op|','
nl|'\n'
name|'disk_over_commit'
op|'='
name|'disk_over_commit'
op|')'
newline|'\n'
nl|'\n'
DECL|member|check_can_live_migrate_source
dedent|''
name|'def'
name|'check_can_live_migrate_source'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'dest_check_data'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.38'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'check_can_live_migrate_source'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
nl|'\n'
name|'dest_check_data'
op|'='
name|'dest_check_data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|check_instance_shared_storage
dedent|''
name|'def'
name|'check_instance_shared_storage'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.29'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.29'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.28'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'check_instance_shared_storage'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
nl|'\n'
name|'data'
op|'='
name|'data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|confirm_resize
dedent|''
name|'def'
name|'confirm_resize'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'migration'
op|','
name|'host'
op|','
nl|'\n'
name|'reservations'
op|'='
name|'None'
op|','
name|'cast'
op|'='
name|'True'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.39'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'host'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'rpc_method'
op|'='
name|'cctxt'
op|'.'
name|'cast'
name|'if'
name|'cast'
name|'else'
name|'cctxt'
op|'.'
name|'call'
newline|'\n'
name|'return'
name|'rpc_method'
op|'('
name|'ctxt'
op|','
string|"'confirm_resize'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'migration'
op|'='
name|'migration'
op|','
nl|'\n'
name|'reservations'
op|'='
name|'reservations'
op|')'
newline|'\n'
nl|'\n'
DECL|member|detach_interface
dedent|''
name|'def'
name|'detach_interface'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'port_id'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.17'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.17'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.25'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'detach_interface'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'port_id'
op|'='
name|'port_id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|detach_volume
dedent|''
name|'def'
name|'detach_volume'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'volume_id'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.25'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.25'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'detach_volume'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'volume_id'
op|'='
name|'volume_id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|finish_resize
dedent|''
name|'def'
name|'finish_resize'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'migration'
op|','
name|'image'
op|','
name|'disk_info'
op|','
nl|'\n'
name|'host'
op|','
name|'reservations'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.46'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'finish_resize'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'migration'
op|'='
name|'migration'
op|','
nl|'\n'
name|'image'
op|'='
name|'image'
op|','
name|'disk_info'
op|'='
name|'disk_info'
op|','
name|'reservations'
op|'='
name|'reservations'
op|')'
newline|'\n'
nl|'\n'
DECL|member|finish_revert_resize
dedent|''
name|'def'
name|'finish_revert_resize'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'migration'
op|','
name|'host'
op|','
nl|'\n'
name|'reservations'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.47'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'finish_revert_resize'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'migration'
op|'='
name|'migration'
op|','
nl|'\n'
name|'reservations'
op|'='
name|'reservations'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_console_output
dedent|''
name|'def'
name|'get_console_output'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'tail_length'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.28'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.28'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'get_console_output'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'tail_length'
op|'='
name|'tail_length'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_console_pool_info
dedent|''
name|'def'
name|'get_console_pool_info'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'console_type'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'get_console_pool_info'"
op|','
nl|'\n'
name|'console_type'
op|'='
name|'console_type'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_console_topic
dedent|''
name|'def'
name|'get_console_topic'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'get_console_topic'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_diagnostics
dedent|''
name|'def'
name|'get_diagnostics'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.18'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.18'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'get_diagnostics'"
op|','
name|'instance'
op|'='
name|'instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_vnc_console
dedent|''
name|'def'
name|'get_vnc_console'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'console_type'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.2'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.2'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'get_vnc_console'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'console_type'
op|'='
name|'console_type'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_spice_console
dedent|''
name|'def'
name|'get_spice_console'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'console_type'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.1'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.1'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.24'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'get_spice_console'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'console_type'
op|'='
name|'console_type'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_rdp_console
dedent|''
name|'def'
name|'get_rdp_console'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'console_type'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'version'
op|'='
string|"'3.10'"
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'get_rdp_console'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'console_type'
op|'='
name|'console_type'
op|')'
newline|'\n'
nl|'\n'
DECL|member|validate_console_port
dedent|''
name|'def'
name|'validate_console_port'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'port'
op|','
name|'console_type'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.3'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.3'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.26'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'validate_console_port'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'port'
op|'='
name|'port'
op|','
nl|'\n'
name|'console_type'
op|'='
name|'console_type'
op|')'
newline|'\n'
nl|'\n'
DECL|member|host_maintenance_mode
dedent|''
name|'def'
name|'host_maintenance_mode'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'host_param'
op|','
name|'mode'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'        '
string|"'''Set host maintenance mode\n\n        :param ctxt: request context\n        :param host_param: This value is placed in the message to be the 'host'\n                           parameter for the remote method.\n        :param mode:\n        :param host: This is the host to send the message to.\n        '''"
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'host_maintenance_mode'"
op|','
nl|'\n'
name|'host'
op|'='
name|'host_param'
op|','
name|'mode'
op|'='
name|'mode'
op|')'
newline|'\n'
nl|'\n'
DECL|member|host_power_action
dedent|''
name|'def'
name|'host_power_action'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'action'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'host_power_action'"
op|','
name|'action'
op|'='
name|'action'
op|')'
newline|'\n'
nl|'\n'
DECL|member|inject_network_info
dedent|''
name|'def'
name|'inject_network_info'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.41'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'inject_network_info'"
op|','
name|'instance'
op|'='
name|'instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|live_migration
dedent|''
name|'def'
name|'live_migration'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'dest'
op|','
name|'block_migration'
op|','
name|'host'
op|','
nl|'\n'
name|'migrate_data'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.26'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.26'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'live_migration'"
op|','
name|'instance'
op|'='
name|'instance'
op|','
nl|'\n'
name|'dest'
op|'='
name|'dest'
op|','
name|'block_migration'
op|'='
name|'block_migration'
op|','
nl|'\n'
name|'migrate_data'
op|'='
name|'migrate_data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|pause_instance
dedent|''
name|'def'
name|'pause_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.36'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'pause_instance'"
op|','
name|'instance'
op|'='
name|'instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|post_live_migration_at_destination
dedent|''
name|'def'
name|'post_live_migration_at_destination'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
nl|'\n'
name|'block_migration'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.14'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.14'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'post_live_migration_at_destination'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'block_migration'
op|'='
name|'block_migration'
op|')'
newline|'\n'
nl|'\n'
DECL|member|pre_live_migration
dedent|''
name|'def'
name|'pre_live_migration'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'block_migration'
op|','
name|'disk'
op|','
nl|'\n'
name|'host'
op|','
name|'migrate_data'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.19'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.19'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.21'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'pre_live_migration'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
nl|'\n'
name|'block_migration'
op|'='
name|'block_migration'
op|','
nl|'\n'
name|'disk'
op|'='
name|'disk'
op|','
name|'migrate_data'
op|'='
name|'migrate_data'
op|')'
newline|'\n'
nl|'\n'
DECL|member|prep_resize
dedent|''
name|'def'
name|'prep_resize'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'image'
op|','
name|'instance'
op|','
name|'instance_type'
op|','
name|'host'
op|','
nl|'\n'
name|'reservations'
op|'='
name|'None'
op|','
name|'request_spec'
op|'='
name|'None'
op|','
nl|'\n'
name|'filter_properties'
op|'='
name|'None'
op|','
name|'node'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.43'"
op|')'
newline|'\n'
name|'instance_type_p'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance_type'
op|')'
newline|'\n'
name|'image_p'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'image'
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'prep_resize'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
nl|'\n'
name|'instance_type'
op|'='
name|'instance_type_p'
op|','
nl|'\n'
name|'image'
op|'='
name|'image_p'
op|','
name|'reservations'
op|'='
name|'reservations'
op|','
nl|'\n'
name|'request_spec'
op|'='
name|'request_spec'
op|','
nl|'\n'
name|'filter_properties'
op|'='
name|'filter_properties'
op|','
nl|'\n'
name|'node'
op|'='
name|'node'
op|')'
newline|'\n'
nl|'\n'
DECL|member|reboot_instance
dedent|''
name|'def'
name|'reboot_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'block_device_info'
op|','
nl|'\n'
name|'reboot_type'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.32'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'reboot_instance'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
nl|'\n'
name|'block_device_info'
op|'='
name|'block_device_info'
op|','
nl|'\n'
name|'reboot_type'
op|'='
name|'reboot_type'
op|')'
newline|'\n'
nl|'\n'
DECL|member|rebuild_instance
dedent|''
name|'def'
name|'rebuild_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'new_pass'
op|','
name|'injected_files'
op|','
nl|'\n'
name|'image_ref'
op|','
name|'orig_image_ref'
op|','
name|'orig_sys_metadata'
op|','
name|'bdms'
op|','
nl|'\n'
name|'recreate'
op|'='
name|'False'
op|','
name|'on_shared_storage'
op|'='
name|'False'
op|','
name|'host'
op|'='
name|'None'
op|','
nl|'\n'
name|'preserve_ephemeral'
op|'='
name|'False'
op|','
name|'kwargs'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|"# NOTE(danms): kwargs is only here for cells compatibility, don't"
nl|'\n'
comment|'# actually send it to compute'
nl|'\n'
indent|'        '
name|'extra'
op|'='
op|'{'
string|"'preserve_ephemeral'"
op|':'
name|'preserve_ephemeral'
op|'}'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.21'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.21'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'bdms'
op|'='
name|'block_device'
op|'.'
name|'legacy_mapping'
op|'('
name|'bdms'
op|')'
newline|'\n'
name|'bdms'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'objects_base'
op|'.'
name|'obj_to_primitive'
op|'('
name|'bdms'
op|')'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.5'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'version'
op|'='
string|"'3.5'"
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.4'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'version'
op|'='
string|"'3.4'"
newline|'\n'
name|'extra'
op|'='
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'                '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.22'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
name|'extra'
op|'='
op|'{'
op|'}'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'host'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'rebuild_instance'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'new_pass'
op|'='
name|'new_pass'
op|','
nl|'\n'
name|'injected_files'
op|'='
name|'injected_files'
op|','
name|'image_ref'
op|'='
name|'image_ref'
op|','
nl|'\n'
name|'orig_image_ref'
op|'='
name|'orig_image_ref'
op|','
nl|'\n'
name|'orig_sys_metadata'
op|'='
name|'orig_sys_metadata'
op|','
name|'bdms'
op|'='
name|'bdms'
op|','
nl|'\n'
name|'recreate'
op|'='
name|'recreate'
op|','
name|'on_shared_storage'
op|'='
name|'on_shared_storage'
op|','
nl|'\n'
op|'**'
name|'extra'
op|')'
newline|'\n'
nl|'\n'
DECL|member|refresh_provider_fw_rules
dedent|''
name|'def'
name|'refresh_provider_fw_rules'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'refresh_provider_fw_rules'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|remove_aggregate_host
dedent|''
name|'def'
name|'remove_aggregate_host'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'aggregate'
op|','
name|'host_param'
op|','
name|'host'
op|','
nl|'\n'
name|'slave_info'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
string|"'''Remove aggregate host.\n\n        :param ctxt: request context\n        :param aggregate_id:\n        :param host_param: This value is placed in the message to be the 'host'\n                           parameter for the remote method.\n        :param host: This is the host to send the message to.\n        '''"
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.0'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.0'"
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'2.48'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'2.48'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
string|"'2.15'"
newline|'\n'
name|'aggregate'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'aggregate'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'remove_aggregate_host'"
op|','
nl|'\n'
name|'aggregate'
op|'='
name|'aggregate'
op|','
name|'host'
op|'='
name|'host_param'
op|','
nl|'\n'
name|'slave_info'
op|'='
name|'slave_info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|remove_fixed_ip_from_instance
dedent|''
name|'def'
name|'remove_fixed_ip_from_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'address'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.13'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.13'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'remove_fixed_ip_from_instance'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'address'
op|'='
name|'address'
op|')'
newline|'\n'
nl|'\n'
DECL|member|remove_volume_connection
dedent|''
name|'def'
name|'remove_volume_connection'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'volume_id'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.30'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.30'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'remove_volume_connection'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'volume_id'
op|'='
name|'volume_id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|rescue_instance
dedent|''
name|'def'
name|'rescue_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'rescue_password'
op|','
nl|'\n'
name|'rescue_image_ref'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
name|'msg_args'
op|'='
op|'{'
string|"'rescue_password'"
op|':'
name|'rescue_password'
op|','
string|"'instance'"
op|':'
name|'instance'
op|'}'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.24'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.24'"
newline|'\n'
name|'msg_args'
op|'['
string|"'rescue_image_ref'"
op|']'
op|'='
name|'rescue_image_ref'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.9'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.9'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.44'"
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'rescue_instance'"
op|','
op|'**'
name|'msg_args'
op|')'
newline|'\n'
nl|'\n'
DECL|member|reset_network
dedent|''
name|'def'
name|'reset_network'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.40'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'reset_network'"
op|','
name|'instance'
op|'='
name|'instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|resize_instance
dedent|''
name|'def'
name|'resize_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'migration'
op|','
name|'image'
op|','
name|'instance_type'
op|','
nl|'\n'
name|'reservations'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.45'"
op|')'
newline|'\n'
name|'instance_type_p'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance_type'
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'resize_instance'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'migration'
op|'='
name|'migration'
op|','
nl|'\n'
name|'image'
op|'='
name|'image'
op|','
name|'reservations'
op|'='
name|'reservations'
op|','
nl|'\n'
name|'instance_type'
op|'='
name|'instance_type_p'
op|')'
newline|'\n'
nl|'\n'
DECL|member|resume_instance
dedent|''
name|'def'
name|'resume_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.33'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'resume_instance'"
op|','
name|'instance'
op|'='
name|'instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|revert_resize
dedent|''
name|'def'
name|'revert_resize'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'migration'
op|','
name|'host'
op|','
nl|'\n'
name|'reservations'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.39'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'host'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'revert_resize'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'migration'
op|'='
name|'migration'
op|','
nl|'\n'
name|'reservations'
op|'='
name|'reservations'
op|')'
newline|'\n'
nl|'\n'
DECL|member|rollback_live_migration_at_destination
dedent|''
name|'def'
name|'rollback_live_migration_at_destination'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.26'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.26'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'rollback_live_migration_at_destination'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|')'
newline|'\n'
nl|'\n'
comment|'# NOTE(alaski): Remove this method when the scheduler rpc interface is'
nl|'\n'
comment|'# bumped to 4.x as the only callers of this method will be removed.'
nl|'\n'
DECL|member|run_instance
dedent|''
name|'def'
name|'run_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'host'
op|','
name|'request_spec'
op|','
nl|'\n'
name|'filter_properties'
op|','
name|'requested_networks'
op|','
nl|'\n'
name|'injected_files'
op|','
name|'admin_password'
op|','
nl|'\n'
name|'is_first_time'
op|','
name|'node'
op|'='
name|'None'
op|','
name|'legacy_bdm_in_spec'
op|'='
name|'True'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.37'"
op|')'
newline|'\n'
name|'instance_p'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
name|'msg_kwargs'
op|'='
op|'{'
string|"'instance'"
op|':'
name|'instance_p'
op|','
string|"'request_spec'"
op|':'
name|'request_spec'
op|','
nl|'\n'
string|"'filter_properties'"
op|':'
name|'filter_properties'
op|','
nl|'\n'
string|"'requested_networks'"
op|':'
name|'requested_networks'
op|','
nl|'\n'
string|"'injected_files'"
op|':'
name|'injected_files'
op|','
nl|'\n'
string|"'admin_password'"
op|':'
name|'admin_password'
op|','
nl|'\n'
string|"'is_first_time'"
op|':'
name|'is_first_time'
op|','
string|"'node'"
op|':'
name|'node'
op|','
nl|'\n'
string|"'legacy_bdm_in_spec'"
op|':'
name|'legacy_bdm_in_spec'
op|'}'
newline|'\n'
nl|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'run_instance'"
op|','
op|'**'
name|'msg_kwargs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|set_admin_password
dedent|''
name|'def'
name|'set_admin_password'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'new_pass'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.8'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.8'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'set_admin_password'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'new_pass'
op|'='
name|'new_pass'
op|')'
newline|'\n'
nl|'\n'
DECL|member|set_host_enabled
dedent|''
name|'def'
name|'set_host_enabled'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'enabled'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'set_host_enabled'"
op|','
name|'enabled'
op|'='
name|'enabled'
op|')'
newline|'\n'
nl|'\n'
DECL|member|swap_volume
dedent|''
name|'def'
name|'swap_volume'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'old_volume_id'
op|','
name|'new_volume_id'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.34'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'swap_volume'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'old_volume_id'
op|'='
name|'old_volume_id'
op|','
nl|'\n'
name|'new_volume_id'
op|'='
name|'new_volume_id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|get_host_uptime
dedent|''
name|'def'
name|'get_host_uptime'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'get_host_uptime'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|reserve_block_device_name
dedent|''
name|'def'
name|'reserve_block_device_name'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'device'
op|','
name|'volume_id'
op|','
nl|'\n'
name|'disk_bus'
op|'='
name|'None'
op|','
name|'device_type'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'version'
op|'='
string|"'3.16'"
newline|'\n'
name|'kw'
op|'='
op|'{'
string|"'instance'"
op|':'
name|'instance'
op|','
string|"'device'"
op|':'
name|'device'
op|','
nl|'\n'
string|"'volume_id'"
op|':'
name|'volume_id'
op|','
string|"'disk_bus'"
op|':'
name|'disk_bus'
op|','
nl|'\n'
string|"'device_type'"
op|':'
name|'device_type'
op|'}'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
name|'version'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.3'"
op|')'
newline|'\n'
name|'kw'
op|'['
string|"'instance'"
op|']'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
nl|'\n'
name|'objects_base'
op|'.'
name|'obj_to_primitive'
op|'('
name|'instance'
op|')'
op|')'
newline|'\n'
name|'del'
name|'kw'
op|'['
string|"'disk_bus'"
op|']'
newline|'\n'
name|'del'
name|'kw'
op|'['
string|"'device_type'"
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'return'
name|'cctxt'
op|'.'
name|'call'
op|'('
name|'ctxt'
op|','
string|"'reserve_block_device_name'"
op|','
op|'**'
name|'kw'
op|')'
newline|'\n'
nl|'\n'
DECL|member|backup_instance
dedent|''
name|'def'
name|'backup_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'image_id'
op|','
name|'backup_type'
op|','
nl|'\n'
name|'rotation'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.42'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'backup_instance'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
nl|'\n'
name|'image_id'
op|'='
name|'image_id'
op|','
nl|'\n'
name|'backup_type'
op|'='
name|'backup_type'
op|','
nl|'\n'
name|'rotation'
op|'='
name|'rotation'
op|')'
newline|'\n'
nl|'\n'
DECL|member|snapshot_instance
dedent|''
name|'def'
name|'snapshot_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'image_id'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.42'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'snapshot_instance'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
nl|'\n'
name|'image_id'
op|'='
name|'image_id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|start_instance
dedent|''
name|'def'
name|'start_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.29'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'start_instance'"
op|','
name|'instance'
op|'='
name|'instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|stop_instance
dedent|''
name|'def'
name|'stop_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'do_cast'
op|'='
name|'True'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.29'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'rpc_method'
op|'='
name|'cctxt'
op|'.'
name|'cast'
name|'if'
name|'do_cast'
name|'else'
name|'cctxt'
op|'.'
name|'call'
newline|'\n'
name|'return'
name|'rpc_method'
op|'('
name|'ctxt'
op|','
string|"'stop_instance'"
op|','
name|'instance'
op|'='
name|'instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|suspend_instance
dedent|''
name|'def'
name|'suspend_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.33'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'suspend_instance'"
op|','
name|'instance'
op|'='
name|'instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|terminate_instance
dedent|''
name|'def'
name|'terminate_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'bdms'
op|','
name|'reservations'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.22'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.22'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.35'"
op|')'
newline|'\n'
name|'bdms'
op|'='
name|'block_device'
op|'.'
name|'legacy_mapping'
op|'('
name|'bdms'
op|')'
newline|'\n'
name|'bdms'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'objects_base'
op|'.'
name|'obj_to_primitive'
op|'('
name|'bdms'
op|')'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'terminate_instance'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'bdms'
op|'='
name|'bdms'
op|','
nl|'\n'
name|'reservations'
op|'='
name|'reservations'
op|')'
newline|'\n'
nl|'\n'
DECL|member|unpause_instance
dedent|''
name|'def'
name|'unpause_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.36'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'unpause_instance'"
op|','
name|'instance'
op|'='
name|'instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|unrescue_instance
dedent|''
name|'def'
name|'unrescue_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.11'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.11'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'unrescue_instance'"
op|','
name|'instance'
op|'='
name|'instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|soft_delete_instance
dedent|''
name|'def'
name|'soft_delete_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'reservations'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.35'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'soft_delete_instance'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'reservations'
op|'='
name|'reservations'
op|')'
newline|'\n'
nl|'\n'
DECL|member|restore_instance
dedent|''
name|'def'
name|'restore_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.18'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.20'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'restore_instance'"
op|','
name|'instance'
op|'='
name|'instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|shelve_instance
dedent|''
name|'def'
name|'shelve_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'image_id'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.31'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'shelve_instance'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance'
op|','
name|'image_id'
op|'='
name|'image_id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|shelve_offload_instance
dedent|''
name|'def'
name|'shelve_offload_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.31'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'shelve_offload_instance'"
op|','
name|'instance'
op|'='
name|'instance'
op|')'
newline|'\n'
nl|'\n'
DECL|member|unshelve_instance
dedent|''
name|'def'
name|'unshelve_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'host'
op|','
name|'image'
op|'='
name|'None'
op|','
nl|'\n'
name|'filter_properties'
op|'='
name|'None'
op|','
name|'node'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'msg_kwargs'
op|'='
op|'{'
string|"'instance'"
op|':'
name|'instance'
op|','
string|"'image'"
op|':'
name|'image'
op|'}'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
string|"'3.15'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'version'
op|'='
string|"'3.15'"
newline|'\n'
name|'msg_kwargs'
op|'['
string|"'filter_properties'"
op|']'
op|'='
name|'filter_properties'
newline|'\n'
name|'msg_kwargs'
op|'['
string|"'node'"
op|']'
op|'='
name|'node'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.31'"
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'unshelve_instance'"
op|','
op|'**'
name|'msg_kwargs'
op|')'
newline|'\n'
nl|'\n'
DECL|member|volume_snapshot_create
dedent|''
name|'def'
name|'volume_snapshot_create'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'volume_id'
op|','
nl|'\n'
name|'create_info'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'version'
op|'='
string|"'3.6'"
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
name|'version'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.44'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
nl|'\n'
name|'objects_base'
op|'.'
name|'obj_to_primitive'
op|'('
name|'instance'
op|')'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'volume_snapshot_create'"
op|','
name|'instance'
op|'='
name|'instance'
op|','
nl|'\n'
name|'volume_id'
op|'='
name|'volume_id'
op|','
name|'create_info'
op|'='
name|'create_info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|volume_snapshot_delete
dedent|''
name|'def'
name|'volume_snapshot_delete'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'volume_id'
op|','
name|'snapshot_id'
op|','
nl|'\n'
name|'delete_info'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'version'
op|'='
string|"'3.6'"
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
name|'version'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'            '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.44'"
op|')'
newline|'\n'
name|'instance'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
nl|'\n'
name|'objects_base'
op|'.'
name|'obj_to_primitive'
op|'('
name|'instance'
op|')'
op|')'
newline|'\n'
dedent|''
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'volume_snapshot_delete'"
op|','
name|'instance'
op|'='
name|'instance'
op|','
nl|'\n'
name|'volume_id'
op|'='
name|'volume_id'
op|','
name|'snapshot_id'
op|'='
name|'snapshot_id'
op|','
nl|'\n'
name|'delete_info'
op|'='
name|'delete_info'
op|')'
newline|'\n'
nl|'\n'
DECL|member|external_instance_event
dedent|''
name|'def'
name|'external_instance_event'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instances'
op|','
name|'events'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
nl|'\n'
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instances'
op|'['
number|'0'
op|']'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
string|"'3.23'"
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'external_instance_event'"
op|','
name|'instances'
op|'='
name|'instances'
op|','
nl|'\n'
name|'events'
op|'='
name|'events'
op|')'
newline|'\n'
nl|'\n'
DECL|member|build_and_run_instance
dedent|''
name|'def'
name|'build_and_run_instance'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'instance'
op|','
name|'host'
op|','
name|'image'
op|','
name|'request_spec'
op|','
nl|'\n'
name|'filter_properties'
op|','
name|'admin_password'
op|'='
name|'None'
op|','
name|'injected_files'
op|'='
name|'None'
op|','
nl|'\n'
name|'requested_networks'
op|'='
name|'None'
op|','
name|'security_groups'
op|'='
name|'None'
op|','
nl|'\n'
name|'block_device_mapping'
op|'='
name|'None'
op|','
name|'node'
op|'='
name|'None'
op|','
name|'limits'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
string|"'3.23'"
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'build_and_run_instance'"
op|','
name|'instance'
op|'='
name|'instance'
op|','
nl|'\n'
name|'image'
op|'='
name|'image'
op|','
name|'request_spec'
op|'='
name|'request_spec'
op|','
nl|'\n'
name|'filter_properties'
op|'='
name|'filter_properties'
op|','
nl|'\n'
name|'admin_password'
op|'='
name|'admin_password'
op|','
nl|'\n'
name|'injected_files'
op|'='
name|'injected_files'
op|','
nl|'\n'
name|'requested_networks'
op|'='
name|'requested_networks'
op|','
nl|'\n'
name|'security_groups'
op|'='
name|'security_groups'
op|','
nl|'\n'
name|'block_device_mapping'
op|'='
name|'block_device_mapping'
op|','
name|'node'
op|'='
name|'node'
op|','
nl|'\n'
name|'limits'
op|'='
name|'limits'
op|')'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|SecurityGroupAPI
dedent|''
dedent|''
name|'class'
name|'SecurityGroupAPI'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
indent|'    '
string|"'''Client side of the security group rpc API.\n\n    API version history:\n\n        1.0 - Initial version.\n        1.41 - Adds refresh_instance_security_rules()\n\n        2.0 - Remove 1.x backwards compat\n\n        3.0 - Identical to 2.x, but has to be bumped at the same time as the\n              compute API since it's all together on the server side.\n    '''"
newline|'\n'
nl|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'super'
op|'('
name|'SecurityGroupAPI'
op|','
name|'self'
op|')'
op|'.'
name|'__init__'
op|'('
op|')'
newline|'\n'
name|'target'
op|'='
name|'messaging'
op|'.'
name|'Target'
op|'('
name|'topic'
op|'='
name|'CONF'
op|'.'
name|'compute_topic'
op|','
name|'version'
op|'='
string|"'3.0'"
op|')'
newline|'\n'
name|'version_cap'
op|'='
name|'ComputeAPI'
op|'.'
name|'VERSION_ALIASES'
op|'.'
name|'get'
op|'('
nl|'\n'
name|'CONF'
op|'.'
name|'upgrade_levels'
op|'.'
name|'compute'
op|','
name|'CONF'
op|'.'
name|'upgrade_levels'
op|'.'
name|'compute'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'client'
op|'='
name|'rpc'
op|'.'
name|'get_client'
op|'('
name|'target'
op|','
name|'version_cap'
op|')'
newline|'\n'
nl|'\n'
DECL|member|_get_compat_version
dedent|''
name|'def'
name|'_get_compat_version'
op|'('
name|'self'
op|','
name|'current'
op|','
name|'havana_compat'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'client'
op|'.'
name|'can_send_version'
op|'('
name|'current'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'havana_compat'
newline|'\n'
dedent|''
name|'return'
name|'current'
newline|'\n'
nl|'\n'
DECL|member|refresh_security_group_rules
dedent|''
name|'def'
name|'refresh_security_group_rules'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'security_group_id'
op|','
name|'host'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'refresh_security_group_rules'"
op|','
nl|'\n'
name|'security_group_id'
op|'='
name|'security_group_id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|refresh_security_group_members
dedent|''
name|'def'
name|'refresh_security_group_members'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'security_group_id'
op|','
nl|'\n'
name|'host'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'host'
op|','
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'refresh_security_group_members'"
op|','
nl|'\n'
name|'security_group_id'
op|'='
name|'security_group_id'
op|')'
newline|'\n'
nl|'\n'
DECL|member|refresh_instance_security_rules
dedent|''
name|'def'
name|'refresh_instance_security_rules'
op|'('
name|'self'
op|','
name|'ctxt'
op|','
name|'host'
op|','
name|'instance'
op|')'
op|':'
newline|'\n'
comment|'# NOTE(russellb) Havana compat'
nl|'\n'
indent|'        '
name|'version'
op|'='
name|'self'
op|'.'
name|'_get_compat_version'
op|'('
string|"'3.0'"
op|','
string|"'2.0'"
op|')'
newline|'\n'
name|'instance_p'
op|'='
name|'jsonutils'
op|'.'
name|'to_primitive'
op|'('
name|'instance'
op|')'
newline|'\n'
name|'cctxt'
op|'='
name|'self'
op|'.'
name|'client'
op|'.'
name|'prepare'
op|'('
name|'server'
op|'='
name|'_compute_host'
op|'('
name|'None'
op|','
name|'instance'
op|')'
op|','
nl|'\n'
name|'version'
op|'='
name|'version'
op|')'
newline|'\n'
name|'cctxt'
op|'.'
name|'cast'
op|'('
name|'ctxt'
op|','
string|"'refresh_instance_security_rules'"
op|','
nl|'\n'
name|'instance'
op|'='
name|'instance_p'
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
