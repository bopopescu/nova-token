begin_unit
name|'import'
name|'ratelimiting'
newline|'\n'
name|'import'
name|'time'
newline|'\n'
name|'import'
name|'unittest'
newline|'\n'
nl|'\n'
DECL|class|Test
name|'class'
name|'Test'
op|'('
name|'unittest'
op|'.'
name|'TestCase'
op|')'
op|':'
newline|'\n'
nl|'\n'
DECL|member|setUp
indent|'    '
name|'def'
name|'setUp'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'limits'
op|'='
op|'{'
nl|'\n'
string|"'a'"
op|':'
op|'('
number|'5'
op|','
name|'ratelimiting'
op|'.'
name|'PER_SECOND'
op|')'
op|','
nl|'\n'
string|"'b'"
op|':'
op|'('
number|'5'
op|','
name|'ratelimiting'
op|'.'
name|'PER_MINUTE'
op|')'
op|','
nl|'\n'
string|"'c'"
op|':'
op|'('
number|'5'
op|','
name|'ratelimiting'
op|'.'
name|'PER_HOUR'
op|')'
op|','
nl|'\n'
string|"'d'"
op|':'
op|'('
number|'1'
op|','
name|'ratelimiting'
op|'.'
name|'PER_SECOND'
op|')'
op|','
nl|'\n'
string|"'e'"
op|':'
op|'('
number|'100'
op|','
name|'ratelimiting'
op|'.'
name|'PER_SECOND'
op|')'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'rl'
op|'='
name|'ratelimiting'
op|'.'
name|'Limiter'
op|'('
name|'self'
op|'.'
name|'limits'
op|')'
newline|'\n'
nl|'\n'
DECL|member|exhaust
dedent|''
name|'def'
name|'exhaust'
op|'('
name|'self'
op|','
name|'action'
op|','
name|'times_until_exhausted'
op|','
op|'**'
name|'kwargs'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'times_until_exhausted'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'when'
op|'='
name|'self'
op|'.'
name|'rl'
op|'.'
name|'perform'
op|'('
name|'action'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'when'
op|','
name|'None'
op|')'
newline|'\n'
dedent|''
name|'num'
op|','
name|'period'
op|'='
name|'self'
op|'.'
name|'limits'
op|'['
name|'action'
op|']'
newline|'\n'
name|'delay'
op|'='
name|'period'
op|'*'
number|'1.0'
op|'/'
name|'num'
newline|'\n'
comment|'# Verify that we are now thoroughly delayed'
nl|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'10'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'when'
op|'='
name|'self'
op|'.'
name|'rl'
op|'.'
name|'perform'
op|'('
name|'action'
op|','
op|'**'
name|'kwargs'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertAlmostEqual'
op|'('
name|'when'
op|','
name|'delay'
op|','
number|'2'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_second
dedent|''
dedent|''
name|'def'
name|'test_second'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'exhaust'
op|'('
string|"'a'"
op|','
number|'5'
op|')'
newline|'\n'
name|'time'
op|'.'
name|'sleep'
op|'('
number|'0.2'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'exhaust'
op|'('
string|"'a'"
op|','
number|'1'
op|')'
newline|'\n'
name|'time'
op|'.'
name|'sleep'
op|'('
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'exhaust'
op|'('
string|"'a'"
op|','
number|'5'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_minute
dedent|''
name|'def'
name|'test_minute'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'exhaust'
op|'('
string|"'b'"
op|','
number|'5'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_one_per_period
dedent|''
name|'def'
name|'test_one_per_period'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
DECL|function|allow_once_and_deny_once
indent|'        '
name|'def'
name|'allow_once_and_deny_once'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'when'
op|'='
name|'self'
op|'.'
name|'rl'
op|'.'
name|'perform'
op|'('
string|"'d'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'when'
op|','
name|'None'
op|')'
newline|'\n'
name|'when'
op|'='
name|'self'
op|'.'
name|'rl'
op|'.'
name|'perform'
op|'('
string|"'d'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertAlmostEqual'
op|'('
name|'when'
op|','
number|'1'
op|','
number|'2'
op|')'
newline|'\n'
name|'return'
name|'when'
newline|'\n'
dedent|''
name|'time'
op|'.'
name|'sleep'
op|'('
name|'allow_once_and_deny_once'
op|'('
op|')'
op|')'
newline|'\n'
name|'time'
op|'.'
name|'sleep'
op|'('
name|'allow_once_and_deny_once'
op|'('
op|')'
op|')'
newline|'\n'
name|'allow_once_and_deny_once'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_we_can_go_indefinitely_if_we_spread_out_requests
dedent|''
name|'def'
name|'test_we_can_go_indefinitely_if_we_spread_out_requests'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'200'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'when'
op|'='
name|'self'
op|'.'
name|'rl'
op|'.'
name|'perform'
op|'('
string|"'e'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'assertEqual'
op|'('
name|'when'
op|','
name|'None'
op|')'
newline|'\n'
name|'time'
op|'.'
name|'sleep'
op|'('
number|'0.01'
op|')'
newline|'\n'
nl|'\n'
DECL|member|test_users_get_separate_buckets
dedent|''
dedent|''
name|'def'
name|'test_users_get_separate_buckets'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'exhaust'
op|'('
string|"'c'"
op|','
number|'5'
op|','
name|'username'
op|'='
string|"'alice'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'exhaust'
op|'('
string|"'c'"
op|','
number|'5'
op|','
name|'username'
op|'='
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'exhaust'
op|'('
string|"'c'"
op|','
number|'5'
op|','
name|'username'
op|'='
string|"'chuck'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'exhaust'
op|'('
string|"'c'"
op|','
number|'0'
op|','
name|'username'
op|'='
string|"'chuck'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'exhaust'
op|'('
string|"'c'"
op|','
number|'0'
op|','
name|'username'
op|'='
string|"'bob'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'exhaust'
op|'('
string|"'c'"
op|','
number|'0'
op|','
name|'username'
op|'='
string|"'alice'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'unittest'
op|'.'
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
