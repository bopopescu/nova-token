begin_unit
comment|'#    Copyright 2010 OpenStack LLC'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Licensed under the Apache License, Version 2.0 (the "License"); you may'
nl|'\n'
comment|'#    not use this file except in compliance with the License. You may obtain'
nl|'\n'
comment|'#    a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#         http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#    Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT'
nl|'\n'
comment|'#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the'
nl|'\n'
comment|'#    License for the specific language governing permissions and limitations'
nl|'\n'
comment|'#    under the License.'
nl|'\n'
nl|'\n'
string|'"""Log format for Nova\'s changelog."""'
newline|'\n'
nl|'\n'
name|'import'
name|'bzrlib'
op|'.'
name|'log'
newline|'\n'
name|'from'
name|'bzrlib'
op|'.'
name|'osutils'
name|'import'
name|'format_date'
newline|'\n'
nl|'\n'
nl|'\n'
DECL|class|NovaLogFormat
name|'class'
name|'NovaLogFormat'
op|'('
name|'bzrlib'
op|'.'
name|'log'
op|'.'
name|'GnuChangelogLogFormatter'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""This is mostly stolen from bzrlib.log.GnuChangelogLogFormatter\n    The difference is that it logs the author rather than the committer\n    which for Nova always is Tarmac."""'
newline|'\n'
nl|'\n'
DECL|variable|preferred_levels
name|'preferred_levels'
op|'='
number|'1'
newline|'\n'
nl|'\n'
DECL|member|log_revision
name|'def'
name|'log_revision'
op|'('
name|'self'
op|','
name|'revision'
op|')'
op|':'
newline|'\n'
indent|'        '
string|'"""Log a revision, either merged or not."""'
newline|'\n'
name|'to_file'
op|'='
name|'self'
op|'.'
name|'to_file'
newline|'\n'
nl|'\n'
name|'date_str'
op|'='
name|'format_date'
op|'('
name|'revision'
op|'.'
name|'rev'
op|'.'
name|'timestamp'
op|','
nl|'\n'
name|'revision'
op|'.'
name|'rev'
op|'.'
name|'timezone'
name|'or'
number|'0'
op|','
nl|'\n'
name|'self'
op|'.'
name|'show_timezone'
op|','
nl|'\n'
name|'date_fmt'
op|'='
string|"'%Y-%m-%d'"
op|','
nl|'\n'
name|'show_offset'
op|'='
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'authors'
op|'='
name|'revision'
op|'.'
name|'rev'
op|'.'
name|'get_apparent_authors'
op|'('
op|')'
newline|'\n'
name|'to_file'
op|'.'
name|'write'
op|'('
string|"'%s  %s\\n\\n'"
op|'%'
op|'('
name|'date_str'
op|','
string|'", "'
op|'.'
name|'join'
op|'('
name|'authors'
op|')'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'revision'
op|'.'
name|'delta'
name|'is'
name|'not'
name|'None'
name|'and'
name|'revision'
op|'.'
name|'delta'
op|'.'
name|'has_changed'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'c'
name|'in'
name|'revision'
op|'.'
name|'delta'
op|'.'
name|'added'
op|'+'
name|'revision'
op|'.'
name|'delta'
op|'.'
name|'removed'
op|'+'
name|'revision'
op|'.'
name|'delta'
op|'.'
name|'modified'
op|':'
newline|'\n'
indent|'                '
name|'path'
op|','
op|'='
name|'c'
op|'['
op|':'
number|'1'
op|']'
newline|'\n'
name|'to_file'
op|'.'
name|'write'
op|'('
string|"'\\t* %s:\\n'"
op|'%'
op|'('
name|'path'
op|','
op|')'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'c'
name|'in'
name|'revision'
op|'.'
name|'delta'
op|'.'
name|'renamed'
op|':'
newline|'\n'
indent|'                '
name|'oldpath'
op|','
name|'newpath'
op|'='
name|'c'
op|'['
op|':'
number|'2'
op|']'
newline|'\n'
comment|'# For renamed files, show both the old and the new path'
nl|'\n'
name|'to_file'
op|'.'
name|'write'
op|'('
string|"'\\t* %s:\\n\\t* %s:\\n'"
op|'%'
op|'('
name|'oldpath'
op|','
name|'newpath'
op|')'
op|')'
newline|'\n'
dedent|''
name|'to_file'
op|'.'
name|'write'
op|'('
string|"'\\n'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'not'
name|'revision'
op|'.'
name|'rev'
op|'.'
name|'message'
op|':'
newline|'\n'
indent|'            '
name|'to_file'
op|'.'
name|'write'
op|'('
string|"'\\tNo commit message\\n'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'message'
op|'='
name|'revision'
op|'.'
name|'rev'
op|'.'
name|'message'
op|'.'
name|'rstrip'
op|'('
string|"'\\r\\n'"
op|')'
newline|'\n'
name|'for'
name|'l'
name|'in'
name|'message'
op|'.'
name|'split'
op|'('
string|"'\\n'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'to_file'
op|'.'
name|'write'
op|'('
string|"'\\t%s\\n'"
op|'%'
op|'('
name|'l'
op|'.'
name|'lstrip'
op|'('
op|')'
op|','
op|')'
op|')'
newline|'\n'
dedent|''
name|'to_file'
op|'.'
name|'write'
op|'('
string|"'\\n'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'bzrlib'
op|'.'
name|'log'
op|'.'
name|'register_formatter'
op|'('
string|"'novalog'"
op|','
name|'NovaLogFormat'
op|')'
newline|'\n'
endmarker|''
end_unit
