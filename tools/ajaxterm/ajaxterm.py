begin_unit
comment|'#!/usr/bin/env python'
nl|'\n'
nl|'\n'
string|'""" Ajaxterm """'
newline|'\n'
nl|'\n'
name|'import'
name|'array'
op|','
name|'cgi'
op|','
name|'fcntl'
op|','
name|'glob'
op|','
name|'mimetypes'
op|','
name|'optparse'
op|','
name|'os'
op|','
name|'pty'
op|','
name|'random'
op|','
name|'re'
op|','
name|'signal'
op|','
name|'select'
op|','
name|'sys'
op|','
name|'threading'
op|','
name|'time'
op|','
name|'termios'
op|','
name|'struct'
op|','
name|'pwd'
newline|'\n'
nl|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'normpath'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'__file__'
op|')'
op|')'
op|')'
newline|'\n'
comment|'# Optional: Add QWeb in sys path'
nl|'\n'
name|'sys'
op|'.'
name|'path'
op|'['
number|'0'
op|':'
number|'0'
op|']'
op|'='
name|'glob'
op|'.'
name|'glob'
op|'('
string|"'../../python'"
op|')'
newline|'\n'
nl|'\n'
name|'import'
name|'qweb'
newline|'\n'
name|'import'
name|'string'
op|','
name|'subprocess'
op|','
name|'uuid'
newline|'\n'
nl|'\n'
name|'global'
name|'g_server'
newline|'\n'
nl|'\n'
DECL|class|Terminal
name|'class'
name|'Terminal'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'width'
op|'='
number|'80'
op|','
name|'height'
op|'='
number|'24'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'width'
op|'='
name|'width'
newline|'\n'
name|'self'
op|'.'
name|'height'
op|'='
name|'height'
newline|'\n'
name|'self'
op|'.'
name|'init'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'reset'
op|'('
op|')'
newline|'\n'
DECL|member|init
dedent|''
name|'def'
name|'init'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'esc_seq'
op|'='
op|'{'
nl|'\n'
string|'"\\x00"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x05"'
op|':'
name|'self'
op|'.'
name|'esc_da'
op|','
nl|'\n'
string|'"\\x07"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x08"'
op|':'
name|'self'
op|'.'
name|'esc_0x08'
op|','
nl|'\n'
string|'"\\x09"'
op|':'
name|'self'
op|'.'
name|'esc_0x09'
op|','
nl|'\n'
string|'"\\x0a"'
op|':'
name|'self'
op|'.'
name|'esc_0x0a'
op|','
nl|'\n'
string|'"\\x0b"'
op|':'
name|'self'
op|'.'
name|'esc_0x0a'
op|','
nl|'\n'
string|'"\\x0c"'
op|':'
name|'self'
op|'.'
name|'esc_0x0a'
op|','
nl|'\n'
string|'"\\x0d"'
op|':'
name|'self'
op|'.'
name|'esc_0x0d'
op|','
nl|'\n'
string|'"\\x0e"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x0f"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1b#8"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1b="'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1b>"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1b(0"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1b(A"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1b(B"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1b[c"'
op|':'
name|'self'
op|'.'
name|'esc_da'
op|','
nl|'\n'
string|'"\\x1b[0c"'
op|':'
name|'self'
op|'.'
name|'esc_da'
op|','
nl|'\n'
string|'"\\x1b]R"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1b7"'
op|':'
name|'self'
op|'.'
name|'esc_save'
op|','
nl|'\n'
string|'"\\x1b8"'
op|':'
name|'self'
op|'.'
name|'esc_restore'
op|','
nl|'\n'
string|'"\\x1bD"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1bE"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1bH"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1bM"'
op|':'
name|'self'
op|'.'
name|'esc_ri'
op|','
nl|'\n'
string|'"\\x1bN"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1bO"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1bZ"'
op|':'
name|'self'
op|'.'
name|'esc_da'
op|','
nl|'\n'
string|'"\\x1ba"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1bc"'
op|':'
name|'self'
op|'.'
name|'reset'
op|','
nl|'\n'
string|'"\\x1bn"'
op|':'
name|'None'
op|','
nl|'\n'
string|'"\\x1bo"'
op|':'
name|'None'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'self'
op|'.'
name|'esc_seq'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'v'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'esc_seq'
op|'['
name|'k'
op|']'
op|'='
name|'self'
op|'.'
name|'esc_ignore'
newline|'\n'
comment|'# regex'
nl|'\n'
dedent|''
dedent|''
name|'d'
op|'='
op|'{'
nl|'\n'
string|"r'\\[\\??([0-9;]*)([@ABCDEFGHJKLMPXacdefghlmnqrstu`])'"
op|':'
name|'self'
op|'.'
name|'csi_dispatch'
op|','
nl|'\n'
string|"r'\\]([^\\x07]+)\\x07'"
op|':'
name|'self'
op|'.'
name|'esc_ignore'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'esc_re'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'d'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'esc_re'
op|'.'
name|'append'
op|'('
op|'('
name|'re'
op|'.'
name|'compile'
op|'('
string|"'\\x1b'"
op|'+'
name|'k'
op|')'
op|','
name|'v'
op|')'
op|')'
newline|'\n'
comment|'# define csi sequences'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'csi_seq'
op|'='
op|'{'
nl|'\n'
string|"'@'"
op|':'
op|'('
name|'self'
op|'.'
name|'csi_at'
op|','
op|'['
number|'1'
op|']'
op|')'
op|','
nl|'\n'
string|"'`'"
op|':'
op|'('
name|'self'
op|'.'
name|'csi_G'
op|','
op|'['
number|'1'
op|']'
op|')'
op|','
nl|'\n'
string|"'J'"
op|':'
op|'('
name|'self'
op|'.'
name|'csi_J'
op|','
op|'['
number|'0'
op|']'
op|')'
op|','
nl|'\n'
string|"'K'"
op|':'
op|'('
name|'self'
op|'.'
name|'csi_K'
op|','
op|'['
number|'0'
op|']'
op|')'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'for'
name|'i'
name|'in'
op|'['
name|'i'
op|'['
number|'4'
op|']'
name|'for'
name|'i'
name|'in'
name|'dir'
op|'('
name|'self'
op|')'
name|'if'
name|'i'
op|'.'
name|'startswith'
op|'('
string|"'csi_'"
op|')'
name|'and'
name|'len'
op|'('
name|'i'
op|')'
op|'=='
number|'5'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'self'
op|'.'
name|'csi_seq'
op|'.'
name|'has_key'
op|'('
name|'i'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'csi_seq'
op|'['
name|'i'
op|']'
op|'='
op|'('
name|'getattr'
op|'('
name|'self'
op|','
string|"'csi_'"
op|'+'
name|'i'
op|')'
op|','
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
comment|'# Init 0-256 to latin1 and html translation table'
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'trl1'
op|'='
string|'""'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'256'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'i'
op|'<'
number|'32'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'trl1'
op|'+='
string|'" "'
newline|'\n'
dedent|''
name|'elif'
name|'i'
op|'<'
number|'127'
name|'or'
name|'i'
op|'>'
number|'160'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'trl1'
op|'+='
name|'chr'
op|'('
name|'i'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'trl1'
op|'+='
string|'"?"'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'trhtml'
op|'='
string|'""'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
number|'256'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'i'
op|'=='
number|'0x0a'
name|'or'
op|'('
name|'i'
op|'>'
number|'32'
name|'and'
name|'i'
op|'<'
number|'127'
op|')'
name|'or'
name|'i'
op|'>'
number|'160'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'trhtml'
op|'+='
name|'chr'
op|'('
name|'i'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'i'
op|'<='
number|'32'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'trhtml'
op|'+='
string|'"\\xa0"'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'trhtml'
op|'+='
string|'"?"'
newline|'\n'
DECL|member|reset
dedent|''
dedent|''
dedent|''
name|'def'
name|'reset'
op|'('
name|'self'
op|','
name|'s'
op|'='
string|'""'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'scr'
op|'='
name|'array'
op|'.'
name|'array'
op|'('
string|"'i'"
op|','
op|'['
number|'0x000700'
op|']'
op|'*'
op|'('
name|'self'
op|'.'
name|'width'
op|'*'
name|'self'
op|'.'
name|'height'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'st'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'sb'
op|'='
name|'self'
op|'.'
name|'height'
op|'-'
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'cx_bak'
op|'='
name|'self'
op|'.'
name|'cx'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'cy_bak'
op|'='
name|'self'
op|'.'
name|'cy'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'cl'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'sgr'
op|'='
number|'0x000700'
newline|'\n'
name|'self'
op|'.'
name|'buf'
op|'='
string|'""'
newline|'\n'
name|'self'
op|'.'
name|'outbuf'
op|'='
string|'""'
newline|'\n'
name|'self'
op|'.'
name|'last_html'
op|'='
string|'""'
newline|'\n'
DECL|member|peek
dedent|''
name|'def'
name|'peek'
op|'('
name|'self'
op|','
name|'y1'
op|','
name|'x1'
op|','
name|'y2'
op|','
name|'x2'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'scr'
op|'['
name|'self'
op|'.'
name|'width'
op|'*'
name|'y1'
op|'+'
name|'x1'
op|':'
name|'self'
op|'.'
name|'width'
op|'*'
name|'y2'
op|'+'
name|'x2'
op|']'
newline|'\n'
DECL|member|poke
dedent|''
name|'def'
name|'poke'
op|'('
name|'self'
op|','
name|'y'
op|','
name|'x'
op|','
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pos'
op|'='
name|'self'
op|'.'
name|'width'
op|'*'
name|'y'
op|'+'
name|'x'
newline|'\n'
name|'self'
op|'.'
name|'scr'
op|'['
name|'pos'
op|':'
name|'pos'
op|'+'
name|'len'
op|'('
name|'s'
op|')'
op|']'
op|'='
name|'s'
newline|'\n'
DECL|member|zero
dedent|''
name|'def'
name|'zero'
op|'('
name|'self'
op|','
name|'y1'
op|','
name|'x1'
op|','
name|'y2'
op|','
name|'x2'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'w'
op|'='
name|'self'
op|'.'
name|'width'
op|'*'
op|'('
name|'y2'
op|'-'
name|'y1'
op|')'
op|'+'
name|'x2'
op|'-'
name|'x1'
op|'+'
number|'1'
newline|'\n'
name|'z'
op|'='
name|'array'
op|'.'
name|'array'
op|'('
string|"'i'"
op|','
op|'['
number|'0x000700'
op|']'
op|'*'
name|'w'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'scr'
op|'['
name|'self'
op|'.'
name|'width'
op|'*'
name|'y1'
op|'+'
name|'x1'
op|':'
name|'self'
op|'.'
name|'width'
op|'*'
name|'y2'
op|'+'
name|'x2'
op|'+'
number|'1'
op|']'
op|'='
name|'z'
newline|'\n'
DECL|member|scroll_up
dedent|''
name|'def'
name|'scroll_up'
op|'('
name|'self'
op|','
name|'y1'
op|','
name|'y2'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'poke'
op|'('
name|'y1'
op|','
number|'0'
op|','
name|'self'
op|'.'
name|'peek'
op|'('
name|'y1'
op|'+'
number|'1'
op|','
number|'0'
op|','
name|'y2'
op|','
name|'self'
op|'.'
name|'width'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'zero'
op|'('
name|'y2'
op|','
number|'0'
op|','
name|'y2'
op|','
name|'self'
op|'.'
name|'width'
op|'-'
number|'1'
op|')'
newline|'\n'
DECL|member|scroll_down
dedent|''
name|'def'
name|'scroll_down'
op|'('
name|'self'
op|','
name|'y1'
op|','
name|'y2'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'poke'
op|'('
name|'y1'
op|'+'
number|'1'
op|','
number|'0'
op|','
name|'self'
op|'.'
name|'peek'
op|'('
name|'y1'
op|','
number|'0'
op|','
name|'y2'
op|'-'
number|'1'
op|','
name|'self'
op|'.'
name|'width'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'zero'
op|'('
name|'y1'
op|','
number|'0'
op|','
name|'y1'
op|','
name|'self'
op|'.'
name|'width'
op|'-'
number|'1'
op|')'
newline|'\n'
DECL|member|scroll_right
dedent|''
name|'def'
name|'scroll_right'
op|'('
name|'self'
op|','
name|'y'
op|','
name|'x'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'poke'
op|'('
name|'y'
op|','
name|'x'
op|'+'
number|'1'
op|','
name|'self'
op|'.'
name|'peek'
op|'('
name|'y'
op|','
name|'x'
op|','
name|'y'
op|','
name|'self'
op|'.'
name|'width'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'zero'
op|'('
name|'y'
op|','
name|'x'
op|','
name|'y'
op|','
name|'x'
op|')'
newline|'\n'
DECL|member|cursor_down
dedent|''
name|'def'
name|'cursor_down'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'cy'
op|'>='
name|'self'
op|'.'
name|'st'
name|'and'
name|'self'
op|'.'
name|'cy'
op|'<='
name|'self'
op|'.'
name|'sb'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'cl'
op|'='
number|'0'
newline|'\n'
name|'q'
op|','
name|'r'
op|'='
name|'divmod'
op|'('
name|'self'
op|'.'
name|'cy'
op|'+'
number|'1'
op|','
name|'self'
op|'.'
name|'sb'
op|'+'
number|'1'
op|')'
newline|'\n'
name|'if'
name|'q'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'scroll_up'
op|'('
name|'self'
op|'.'
name|'st'
op|','
name|'self'
op|'.'
name|'sb'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'cy'
op|'='
name|'self'
op|'.'
name|'sb'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'cy'
op|'='
name|'r'
newline|'\n'
DECL|member|cursor_right
dedent|''
dedent|''
dedent|''
name|'def'
name|'cursor_right'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'q'
op|','
name|'r'
op|'='
name|'divmod'
op|'('
name|'self'
op|'.'
name|'cx'
op|'+'
number|'1'
op|','
name|'self'
op|'.'
name|'width'
op|')'
newline|'\n'
name|'if'
name|'q'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'cl'
op|'='
number|'1'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'cx'
op|'='
name|'r'
newline|'\n'
DECL|member|echo
dedent|''
dedent|''
name|'def'
name|'echo'
op|'('
name|'self'
op|','
name|'c'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'cl'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'cursor_down'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'cx'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'scr'
op|'['
op|'('
name|'self'
op|'.'
name|'cy'
op|'*'
name|'self'
op|'.'
name|'width'
op|')'
op|'+'
name|'self'
op|'.'
name|'cx'
op|']'
op|'='
name|'self'
op|'.'
name|'sgr'
op|'|'
name|'ord'
op|'('
name|'c'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'cursor_right'
op|'('
op|')'
newline|'\n'
DECL|member|esc_0x08
dedent|''
name|'def'
name|'esc_0x08'
op|'('
name|'self'
op|','
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cx'
op|'='
name|'max'
op|'('
number|'0'
op|','
name|'self'
op|'.'
name|'cx'
op|'-'
number|'1'
op|')'
newline|'\n'
DECL|member|esc_0x09
dedent|''
name|'def'
name|'esc_0x09'
op|'('
name|'self'
op|','
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'x'
op|'='
name|'self'
op|'.'
name|'cx'
op|'+'
number|'8'
newline|'\n'
name|'q'
op|','
name|'r'
op|'='
name|'divmod'
op|'('
name|'x'
op|','
number|'8'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'cx'
op|'='
op|'('
name|'q'
op|'*'
number|'8'
op|')'
op|'%'
name|'self'
op|'.'
name|'width'
newline|'\n'
DECL|member|esc_0x0a
dedent|''
name|'def'
name|'esc_0x0a'
op|'('
name|'self'
op|','
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cursor_down'
op|'('
op|')'
newline|'\n'
DECL|member|esc_0x0d
dedent|''
name|'def'
name|'esc_0x0d'
op|'('
name|'self'
op|','
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cl'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'cx'
op|'='
number|'0'
newline|'\n'
DECL|member|esc_save
dedent|''
name|'def'
name|'esc_save'
op|'('
name|'self'
op|','
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cx_bak'
op|'='
name|'self'
op|'.'
name|'cx'
newline|'\n'
name|'self'
op|'.'
name|'cy_bak'
op|'='
name|'self'
op|'.'
name|'cy'
newline|'\n'
DECL|member|esc_restore
dedent|''
name|'def'
name|'esc_restore'
op|'('
name|'self'
op|','
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cx'
op|'='
name|'self'
op|'.'
name|'cx_bak'
newline|'\n'
name|'self'
op|'.'
name|'cy'
op|'='
name|'self'
op|'.'
name|'cy_bak'
newline|'\n'
name|'self'
op|'.'
name|'cl'
op|'='
number|'0'
newline|'\n'
DECL|member|esc_da
dedent|''
name|'def'
name|'esc_da'
op|'('
name|'self'
op|','
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'outbuf'
op|'='
string|'"\\x1b[?6c"'
newline|'\n'
DECL|member|esc_ri
dedent|''
name|'def'
name|'esc_ri'
op|'('
name|'self'
op|','
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cy'
op|'='
name|'max'
op|'('
name|'self'
op|'.'
name|'st'
op|','
name|'self'
op|'.'
name|'cy'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'cy'
op|'=='
name|'self'
op|'.'
name|'st'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'scroll_down'
op|'('
name|'self'
op|'.'
name|'st'
op|','
name|'self'
op|'.'
name|'sb'
op|')'
newline|'\n'
DECL|member|esc_ignore
dedent|''
dedent|''
name|'def'
name|'esc_ignore'
op|'('
name|'self'
op|','
op|'*'
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
comment|'#        print "term:ignore: %s"%repr(s)'
nl|'\n'
DECL|member|csi_dispatch
dedent|''
name|'def'
name|'csi_dispatch'
op|'('
name|'self'
op|','
name|'seq'
op|','
name|'mo'
op|')'
op|':'
newline|'\n'
comment|'# CSI sequences'
nl|'\n'
indent|'        '
name|'s'
op|'='
name|'mo'
op|'.'
name|'group'
op|'('
number|'1'
op|')'
newline|'\n'
name|'c'
op|'='
name|'mo'
op|'.'
name|'group'
op|'('
number|'2'
op|')'
newline|'\n'
name|'f'
op|'='
name|'self'
op|'.'
name|'csi_seq'
op|'.'
name|'get'
op|'('
name|'c'
op|','
name|'None'
op|')'
newline|'\n'
name|'if'
name|'f'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'l'
op|'='
op|'['
name|'min'
op|'('
name|'int'
op|'('
name|'i'
op|')'
op|','
number|'1024'
op|')'
name|'for'
name|'i'
name|'in'
name|'s'
op|'.'
name|'split'
op|'('
string|"';'"
op|')'
name|'if'
name|'len'
op|'('
name|'i'
op|')'
op|'<'
number|'4'
op|']'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'                '
name|'l'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'l'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'l'
op|'='
name|'f'
op|'['
number|'1'
op|']'
newline|'\n'
dedent|''
name|'f'
op|'['
number|'0'
op|']'
op|'('
name|'l'
op|')'
newline|'\n'
comment|'#        else:'
nl|'\n'
comment|"#            print 'csi ignore',c,l"
nl|'\n'
DECL|member|csi_at
dedent|''
dedent|''
name|'def'
name|'csi_at'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'l'
op|'['
number|'0'
op|']'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'scroll_right'
op|'('
name|'self'
op|'.'
name|'cy'
op|','
name|'self'
op|'.'
name|'cx'
op|')'
newline|'\n'
DECL|member|csi_A
dedent|''
dedent|''
name|'def'
name|'csi_A'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cy'
op|'='
name|'max'
op|'('
name|'self'
op|'.'
name|'st'
op|','
name|'self'
op|'.'
name|'cy'
op|'-'
name|'l'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
DECL|member|csi_B
dedent|''
name|'def'
name|'csi_B'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cy'
op|'='
name|'min'
op|'('
name|'self'
op|'.'
name|'sb'
op|','
name|'self'
op|'.'
name|'cy'
op|'+'
name|'l'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
DECL|member|csi_C
dedent|''
name|'def'
name|'csi_C'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cx'
op|'='
name|'min'
op|'('
name|'self'
op|'.'
name|'width'
op|'-'
number|'1'
op|','
name|'self'
op|'.'
name|'cx'
op|'+'
name|'l'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'cl'
op|'='
number|'0'
newline|'\n'
DECL|member|csi_D
dedent|''
name|'def'
name|'csi_D'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cx'
op|'='
name|'max'
op|'('
number|'0'
op|','
name|'self'
op|'.'
name|'cx'
op|'-'
name|'l'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'cl'
op|'='
number|'0'
newline|'\n'
DECL|member|csi_E
dedent|''
name|'def'
name|'csi_E'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'csi_B'
op|'('
name|'l'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'cx'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'cl'
op|'='
number|'0'
newline|'\n'
DECL|member|csi_F
dedent|''
name|'def'
name|'csi_F'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'csi_A'
op|'('
name|'l'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'cx'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'cl'
op|'='
number|'0'
newline|'\n'
DECL|member|csi_G
dedent|''
name|'def'
name|'csi_G'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cx'
op|'='
name|'min'
op|'('
name|'self'
op|'.'
name|'width'
op|','
name|'l'
op|'['
number|'0'
op|']'
op|')'
op|'-'
number|'1'
newline|'\n'
DECL|member|csi_H
dedent|''
name|'def'
name|'csi_H'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'len'
op|'('
name|'l'
op|')'
op|'<'
number|'2'
op|':'
name|'l'
op|'='
op|'['
number|'1'
op|','
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'cx'
op|'='
name|'min'
op|'('
name|'self'
op|'.'
name|'width'
op|','
name|'l'
op|'['
number|'1'
op|']'
op|')'
op|'-'
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'cy'
op|'='
name|'min'
op|'('
name|'self'
op|'.'
name|'height'
op|','
name|'l'
op|'['
number|'0'
op|']'
op|')'
op|'-'
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'cl'
op|'='
number|'0'
newline|'\n'
DECL|member|csi_J
dedent|''
name|'def'
name|'csi_J'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'l'
op|'['
number|'0'
op|']'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'zero'
op|'('
name|'self'
op|'.'
name|'cy'
op|','
name|'self'
op|'.'
name|'cx'
op|','
name|'self'
op|'.'
name|'height'
op|'-'
number|'1'
op|','
name|'self'
op|'.'
name|'width'
op|'-'
number|'1'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'l'
op|'['
number|'0'
op|']'
op|'=='
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'zero'
op|'('
number|'0'
op|','
number|'0'
op|','
name|'self'
op|'.'
name|'cy'
op|','
name|'self'
op|'.'
name|'cx'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'l'
op|'['
number|'0'
op|']'
op|'=='
number|'2'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'zero'
op|'('
number|'0'
op|','
number|'0'
op|','
name|'self'
op|'.'
name|'height'
op|'-'
number|'1'
op|','
name|'self'
op|'.'
name|'width'
op|'-'
number|'1'
op|')'
newline|'\n'
DECL|member|csi_K
dedent|''
dedent|''
name|'def'
name|'csi_K'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'l'
op|'['
number|'0'
op|']'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'zero'
op|'('
name|'self'
op|'.'
name|'cy'
op|','
name|'self'
op|'.'
name|'cx'
op|','
name|'self'
op|'.'
name|'cy'
op|','
name|'self'
op|'.'
name|'width'
op|'-'
number|'1'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'l'
op|'['
number|'0'
op|']'
op|'=='
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'zero'
op|'('
name|'self'
op|'.'
name|'cy'
op|','
number|'0'
op|','
name|'self'
op|'.'
name|'cy'
op|','
name|'self'
op|'.'
name|'cx'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'l'
op|'['
number|'0'
op|']'
op|'=='
number|'2'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'zero'
op|'('
name|'self'
op|'.'
name|'cy'
op|','
number|'0'
op|','
name|'self'
op|'.'
name|'cy'
op|','
name|'self'
op|'.'
name|'width'
op|'-'
number|'1'
op|')'
newline|'\n'
DECL|member|csi_L
dedent|''
dedent|''
name|'def'
name|'csi_L'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'l'
op|'['
number|'0'
op|']'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'cy'
op|'<'
name|'self'
op|'.'
name|'sb'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'scroll_down'
op|'('
name|'self'
op|'.'
name|'cy'
op|','
name|'self'
op|'.'
name|'sb'
op|')'
newline|'\n'
DECL|member|csi_M
dedent|''
dedent|''
dedent|''
name|'def'
name|'csi_M'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'cy'
op|'>='
name|'self'
op|'.'
name|'st'
name|'and'
name|'self'
op|'.'
name|'cy'
op|'<='
name|'self'
op|'.'
name|'sb'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'l'
op|'['
number|'0'
op|']'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'scroll_up'
op|'('
name|'self'
op|'.'
name|'cy'
op|','
name|'self'
op|'.'
name|'sb'
op|')'
newline|'\n'
DECL|member|csi_P
dedent|''
dedent|''
dedent|''
name|'def'
name|'csi_P'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'w'
op|','
name|'cx'
op|','
name|'cy'
op|'='
name|'self'
op|'.'
name|'width'
op|','
name|'self'
op|'.'
name|'cx'
op|','
name|'self'
op|'.'
name|'cy'
newline|'\n'
name|'end'
op|'='
name|'self'
op|'.'
name|'peek'
op|'('
name|'cy'
op|','
name|'cx'
op|','
name|'cy'
op|','
name|'w'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'csi_K'
op|'('
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'poke'
op|'('
name|'cy'
op|','
name|'cx'
op|','
name|'end'
op|'['
name|'l'
op|'['
number|'0'
op|']'
op|':'
op|']'
op|')'
newline|'\n'
DECL|member|csi_X
dedent|''
name|'def'
name|'csi_X'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'zero'
op|'('
name|'self'
op|'.'
name|'cy'
op|','
name|'self'
op|'.'
name|'cx'
op|','
name|'self'
op|'.'
name|'cy'
op|','
name|'self'
op|'.'
name|'cx'
op|'+'
name|'l'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
DECL|member|csi_a
dedent|''
name|'def'
name|'csi_a'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'csi_C'
op|'('
name|'l'
op|')'
newline|'\n'
DECL|member|csi_c
dedent|''
name|'def'
name|'csi_c'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
comment|"#'\\x1b[?0c' 0-8 cursor size"
nl|'\n'
indent|'        '
name|'pass'
newline|'\n'
DECL|member|csi_d
dedent|''
name|'def'
name|'csi_d'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'cy'
op|'='
name|'min'
op|'('
name|'self'
op|'.'
name|'height'
op|','
name|'l'
op|'['
number|'0'
op|']'
op|')'
op|'-'
number|'1'
newline|'\n'
DECL|member|csi_e
dedent|''
name|'def'
name|'csi_e'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'csi_B'
op|'('
name|'l'
op|')'
newline|'\n'
DECL|member|csi_f
dedent|''
name|'def'
name|'csi_f'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'csi_H'
op|'('
name|'l'
op|')'
newline|'\n'
DECL|member|csi_h
dedent|''
name|'def'
name|'csi_h'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'l'
op|'['
number|'0'
op|']'
op|'=='
number|'4'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
comment|'#            print "insert on"'
nl|'\n'
DECL|member|csi_l
dedent|''
dedent|''
name|'def'
name|'csi_l'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'l'
op|'['
number|'0'
op|']'
op|'=='
number|'4'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
comment|'#            print "insert off"'
nl|'\n'
DECL|member|csi_m
dedent|''
dedent|''
name|'def'
name|'csi_m'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'i'
name|'in'
name|'l'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'i'
op|'=='
number|'0'
name|'or'
name|'i'
op|'=='
number|'39'
name|'or'
name|'i'
op|'=='
number|'49'
name|'or'
name|'i'
op|'=='
number|'27'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sgr'
op|'='
number|'0x000700'
newline|'\n'
dedent|''
name|'elif'
name|'i'
op|'=='
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sgr'
op|'='
op|'('
name|'self'
op|'.'
name|'sgr'
op|'|'
number|'0x000800'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'i'
op|'=='
number|'7'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'sgr'
op|'='
number|'0x070000'
newline|'\n'
dedent|''
name|'elif'
name|'i'
op|'>='
number|'30'
name|'and'
name|'i'
op|'<='
number|'37'
op|':'
newline|'\n'
indent|'                '
name|'c'
op|'='
name|'i'
op|'-'
number|'30'
newline|'\n'
name|'self'
op|'.'
name|'sgr'
op|'='
op|'('
name|'self'
op|'.'
name|'sgr'
op|'&'
number|'0xff08ff'
op|')'
op|'|'
op|'('
name|'c'
op|'<<'
number|'8'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'i'
op|'>='
number|'40'
name|'and'
name|'i'
op|'<='
number|'47'
op|':'
newline|'\n'
indent|'                '
name|'c'
op|'='
name|'i'
op|'-'
number|'40'
newline|'\n'
name|'self'
op|'.'
name|'sgr'
op|'='
op|'('
name|'self'
op|'.'
name|'sgr'
op|'&'
number|'0x00ffff'
op|')'
op|'|'
op|'('
name|'c'
op|'<<'
number|'16'
op|')'
newline|'\n'
comment|'#            else:'
nl|'\n'
comment|'#                print "CSI sgr ignore",l,i'
nl|'\n'
comment|"#        print 'sgr: %r %x'%(l,self.sgr)"
nl|'\n'
DECL|member|csi_r
dedent|''
dedent|''
dedent|''
name|'def'
name|'csi_r'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'len'
op|'('
name|'l'
op|')'
op|'<'
number|'2'
op|':'
name|'l'
op|'='
op|'['
number|'0'
op|','
name|'self'
op|'.'
name|'height'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'st'
op|'='
name|'min'
op|'('
name|'self'
op|'.'
name|'height'
op|'-'
number|'1'
op|','
name|'l'
op|'['
number|'0'
op|']'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sb'
op|'='
name|'min'
op|'('
name|'self'
op|'.'
name|'height'
op|'-'
number|'1'
op|','
name|'l'
op|'['
number|'1'
op|']'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'sb'
op|'='
name|'max'
op|'('
name|'self'
op|'.'
name|'st'
op|','
name|'self'
op|'.'
name|'sb'
op|')'
newline|'\n'
DECL|member|csi_s
dedent|''
name|'def'
name|'csi_s'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'esc_save'
op|'('
number|'0'
op|')'
newline|'\n'
DECL|member|csi_u
dedent|''
name|'def'
name|'csi_u'
op|'('
name|'self'
op|','
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'esc_restore'
op|'('
number|'0'
op|')'
newline|'\n'
DECL|member|escape
dedent|''
name|'def'
name|'escape'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'e'
op|'='
name|'self'
op|'.'
name|'buf'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'e'
op|')'
op|'>'
number|'32'
op|':'
newline|'\n'
comment|'#            print "error %r"%e'
nl|'\n'
indent|'            '
name|'self'
op|'.'
name|'buf'
op|'='
string|'""'
newline|'\n'
dedent|''
name|'elif'
name|'e'
name|'in'
name|'self'
op|'.'
name|'esc_seq'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'esc_seq'
op|'['
name|'e'
op|']'
op|'('
name|'e'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'buf'
op|'='
string|'""'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'r'
op|','
name|'f'
name|'in'
name|'self'
op|'.'
name|'esc_re'
op|':'
newline|'\n'
indent|'                '
name|'mo'
op|'='
name|'r'
op|'.'
name|'match'
op|'('
name|'e'
op|')'
newline|'\n'
name|'if'
name|'mo'
op|':'
newline|'\n'
indent|'                    '
name|'f'
op|'('
name|'e'
op|','
name|'mo'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'buf'
op|'='
string|'""'
newline|'\n'
name|'break'
newline|'\n'
comment|'#        if self.buf==\'\': print "ESC %r\\n"%e'
nl|'\n'
DECL|member|write
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'write'
op|'('
name|'self'
op|','
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'i'
name|'in'
name|'s'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'len'
op|'('
name|'self'
op|'.'
name|'buf'
op|')'
name|'or'
op|'('
name|'i'
name|'in'
name|'self'
op|'.'
name|'esc_seq'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'buf'
op|'+='
name|'i'
newline|'\n'
name|'self'
op|'.'
name|'escape'
op|'('
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'i'
op|'=='
string|"'\\x1b'"
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'buf'
op|'+='
name|'i'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'echo'
op|'('
name|'i'
op|')'
newline|'\n'
DECL|member|read
dedent|''
dedent|''
dedent|''
name|'def'
name|'read'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'b'
op|'='
name|'self'
op|'.'
name|'outbuf'
newline|'\n'
name|'self'
op|'.'
name|'outbuf'
op|'='
string|'""'
newline|'\n'
name|'return'
name|'b'
newline|'\n'
DECL|member|dump
dedent|''
name|'def'
name|'dump'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'r'
op|'='
string|"''"
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'self'
op|'.'
name|'scr'
op|':'
newline|'\n'
indent|'            '
name|'r'
op|'+='
name|'chr'
op|'('
name|'i'
op|'&'
number|'255'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'r'
newline|'\n'
DECL|member|dumplatin1
dedent|''
name|'def'
name|'dumplatin1'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'dump'
op|'('
op|')'
op|'.'
name|'translate'
op|'('
name|'self'
op|'.'
name|'trl1'
op|')'
newline|'\n'
DECL|member|dumphtml
dedent|''
name|'def'
name|'dumphtml'
op|'('
name|'self'
op|','
name|'color'
op|'='
number|'1'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'h'
op|'='
name|'self'
op|'.'
name|'height'
newline|'\n'
name|'w'
op|'='
name|'self'
op|'.'
name|'width'
newline|'\n'
name|'r'
op|'='
string|'""'
newline|'\n'
name|'span'
op|'='
string|'""'
newline|'\n'
name|'span_bg'
op|','
name|'span_fg'
op|'='
op|'-'
number|'1'
op|','
op|'-'
number|'1'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'h'
op|'*'
name|'w'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'q'
op|','
name|'c'
op|'='
name|'divmod'
op|'('
name|'self'
op|'.'
name|'scr'
op|'['
name|'i'
op|']'
op|','
number|'256'
op|')'
newline|'\n'
name|'if'
name|'color'
op|':'
newline|'\n'
indent|'                '
name|'bg'
op|','
name|'fg'
op|'='
name|'divmod'
op|'('
name|'q'
op|','
number|'256'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'bg'
op|','
name|'fg'
op|'='
number|'0'
op|','
number|'7'
newline|'\n'
dedent|''
name|'if'
name|'i'
op|'=='
name|'self'
op|'.'
name|'cy'
op|'*'
name|'w'
op|'+'
name|'self'
op|'.'
name|'cx'
op|':'
newline|'\n'
indent|'                '
name|'bg'
op|','
name|'fg'
op|'='
number|'1'
op|','
number|'7'
newline|'\n'
dedent|''
name|'if'
op|'('
name|'bg'
op|'!='
name|'span_bg'
name|'or'
name|'fg'
op|'!='
name|'span_fg'
name|'or'
name|'i'
op|'=='
name|'h'
op|'*'
name|'w'
op|'-'
number|'1'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'len'
op|'('
name|'span'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'r'
op|'+='
string|'\'<span class="f%d b%d">%s</span>\''
op|'%'
op|'('
name|'span_fg'
op|','
name|'span_bg'
op|','
name|'cgi'
op|'.'
name|'escape'
op|'('
name|'span'
op|'.'
name|'translate'
op|'('
name|'self'
op|'.'
name|'trhtml'
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
name|'span'
op|'='
string|'""'
newline|'\n'
name|'span_bg'
op|','
name|'span_fg'
op|'='
name|'bg'
op|','
name|'fg'
newline|'\n'
dedent|''
name|'span'
op|'+='
name|'chr'
op|'('
name|'c'
op|')'
newline|'\n'
name|'if'
name|'i'
op|'%'
name|'w'
op|'=='
name|'w'
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'                '
name|'span'
op|'+='
string|"'\\n'"
newline|'\n'
dedent|''
dedent|''
name|'r'
op|'='
string|'\'<?xml version="1.0" encoding="ISO-8859-1"?><pre class="term">%s</pre>\''
op|'%'
name|'r'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'last_html'
op|'=='
name|'r'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|'\'<?xml version="1.0"?><idem></idem>\''
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'last_html'
op|'='
name|'r'
newline|'\n'
comment|'#            print self'
nl|'\n'
name|'return'
name|'r'
newline|'\n'
DECL|member|__repr__
dedent|''
dedent|''
name|'def'
name|'__repr__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'self'
op|'.'
name|'dumplatin1'
op|'('
op|')'
newline|'\n'
name|'r'
op|'='
string|'""'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'self'
op|'.'
name|'height'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'r'
op|'+='
string|'"|%s|\\n"'
op|'%'
name|'d'
op|'['
name|'self'
op|'.'
name|'width'
op|'*'
name|'i'
op|':'
name|'self'
op|'.'
name|'width'
op|'*'
op|'('
name|'i'
op|'+'
number|'1'
op|')'
op|']'
newline|'\n'
dedent|''
name|'return'
name|'r'
newline|'\n'
nl|'\n'
DECL|class|SynchronizedMethod
dedent|''
dedent|''
name|'class'
name|'SynchronizedMethod'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'lock'
op|','
name|'orig'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'lock'
op|'='
name|'lock'
newline|'\n'
name|'self'
op|'.'
name|'orig'
op|'='
name|'orig'
newline|'\n'
DECL|member|__call__
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
op|'*'
name|'l'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'lock'
op|'.'
name|'acquire'
op|'('
op|')'
newline|'\n'
name|'r'
op|'='
name|'self'
op|'.'
name|'orig'
op|'('
op|'*'
name|'l'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'lock'
op|'.'
name|'release'
op|'('
op|')'
newline|'\n'
name|'return'
name|'r'
newline|'\n'
nl|'\n'
DECL|class|Multiplex
dedent|''
dedent|''
name|'class'
name|'Multiplex'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'cmd'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'signal'
op|'.'
name|'signal'
op|'('
name|'signal'
op|'.'
name|'SIGCHLD'
op|','
name|'signal'
op|'.'
name|'SIG_IGN'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'cmd'
op|'='
name|'cmd'
newline|'\n'
name|'self'
op|'.'
name|'proc'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'lock'
op|'='
name|'threading'
op|'.'
name|'RLock'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'thread'
op|'='
name|'threading'
op|'.'
name|'Thread'
op|'('
name|'target'
op|'='
name|'self'
op|'.'
name|'loop'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'alive'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'lastActivity'
op|'='
name|'time'
op|'.'
name|'time'
op|'('
op|')'
newline|'\n'
comment|'# synchronize methods'
nl|'\n'
name|'for'
name|'name'
name|'in'
op|'['
string|"'create'"
op|','
string|"'fds'"
op|','
string|"'proc_read'"
op|','
string|"'proc_write'"
op|','
string|"'dump'"
op|','
string|"'die'"
op|','
string|"'run'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'orig'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
name|'name'
op|')'
newline|'\n'
name|'setattr'
op|'('
name|'self'
op|','
name|'name'
op|','
name|'SynchronizedMethod'
op|'('
name|'self'
op|'.'
name|'lock'
op|','
name|'orig'
op|')'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'thread'
op|'.'
name|'start'
op|'('
op|')'
newline|'\n'
DECL|member|create
dedent|''
name|'def'
name|'create'
op|'('
name|'self'
op|','
name|'w'
op|'='
number|'80'
op|','
name|'h'
op|'='
number|'25'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pid'
op|','
name|'fd'
op|'='
name|'pty'
op|'.'
name|'fork'
op|'('
op|')'
newline|'\n'
name|'if'
name|'pid'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'fdl'
op|'='
op|'['
name|'int'
op|'('
name|'i'
op|')'
name|'for'
name|'i'
name|'in'
name|'os'
op|'.'
name|'listdir'
op|'('
string|"'/proc/self/fd'"
op|')'
op|']'
newline|'\n'
dedent|''
name|'except'
name|'OSError'
op|':'
newline|'\n'
indent|'                '
name|'fdl'
op|'='
name|'range'
op|'('
number|'256'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'i'
name|'in'
op|'['
name|'i'
name|'for'
name|'i'
name|'in'
name|'fdl'
name|'if'
name|'i'
op|'>'
number|'2'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'try'
op|':'
newline|'\n'
indent|'                    '
name|'os'
op|'.'
name|'close'
op|'('
name|'i'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'OSError'
op|':'
newline|'\n'
indent|'                    '
name|'pass'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'self'
op|'.'
name|'cmd'
op|':'
newline|'\n'
indent|'                '
name|'cmd'
op|'='
op|'['
string|"'/bin/sh'"
op|','
string|"'-c'"
op|','
name|'self'
op|'.'
name|'cmd'
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'os'
op|'.'
name|'getuid'
op|'('
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'                '
name|'cmd'
op|'='
op|'['
string|"'/bin/login'"
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'sys'
op|'.'
name|'stdout'
op|'.'
name|'write'
op|'('
string|'"Login: "'
op|')'
newline|'\n'
name|'login'
op|'='
name|'sys'
op|'.'
name|'stdin'
op|'.'
name|'readline'
op|'('
op|')'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'if'
name|'re'
op|'.'
name|'match'
op|'('
string|"'^[0-9A-Za-z-_. ]+$'"
op|','
name|'login'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'cmd'
op|'='
op|'['
string|"'ssh'"
op|']'
newline|'\n'
name|'cmd'
op|'+='
op|'['
string|"'-oPreferredAuthentications=keyboard-interactive,password'"
op|']'
newline|'\n'
name|'cmd'
op|'+='
op|'['
string|"'-oNoHostAuthenticationForLocalhost=yes'"
op|']'
newline|'\n'
name|'cmd'
op|'+='
op|'['
string|"'-oLogLevel=FATAL'"
op|']'
newline|'\n'
name|'cmd'
op|'+='
op|'['
string|"'-F/dev/null'"
op|','
string|"'-l'"
op|','
name|'login'
op|','
string|"'localhost'"
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'os'
op|'.'
name|'_exit'
op|'('
number|'0'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'env'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'env'
op|'['
string|'"COLUMNS"'
op|']'
op|'='
name|'str'
op|'('
name|'w'
op|')'
newline|'\n'
name|'env'
op|'['
string|'"LINES"'
op|']'
op|'='
name|'str'
op|'('
name|'h'
op|')'
newline|'\n'
name|'env'
op|'['
string|'"TERM"'
op|']'
op|'='
string|'"linux"'
newline|'\n'
name|'env'
op|'['
string|'"PATH"'
op|']'
op|'='
name|'os'
op|'.'
name|'environ'
op|'['
string|"'PATH'"
op|']'
newline|'\n'
name|'os'
op|'.'
name|'execvpe'
op|'('
name|'cmd'
op|'['
number|'0'
op|']'
op|','
name|'cmd'
op|','
name|'env'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'fcntl'
op|'.'
name|'fcntl'
op|'('
name|'fd'
op|','
name|'fcntl'
op|'.'
name|'F_SETFL'
op|','
name|'os'
op|'.'
name|'O_NONBLOCK'
op|')'
newline|'\n'
comment|'# python bug http://python.org/sf/1112949 on amd64'
nl|'\n'
name|'fcntl'
op|'.'
name|'ioctl'
op|'('
name|'fd'
op|','
name|'struct'
op|'.'
name|'unpack'
op|'('
string|"'i'"
op|','
name|'struct'
op|'.'
name|'pack'
op|'('
string|"'I'"
op|','
name|'termios'
op|'.'
name|'TIOCSWINSZ'
op|')'
op|')'
op|'['
number|'0'
op|']'
op|','
name|'struct'
op|'.'
name|'pack'
op|'('
string|'"HHHH"'
op|','
name|'h'
op|','
name|'w'
op|','
number|'0'
op|','
number|'0'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'proc'
op|'['
name|'fd'
op|']'
op|'='
op|'{'
string|"'pid'"
op|':'
name|'pid'
op|','
string|"'term'"
op|':'
name|'Terminal'
op|'('
name|'w'
op|','
name|'h'
op|')'
op|','
string|"'buf'"
op|':'
string|"''"
op|','
string|"'time'"
op|':'
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|'}'
newline|'\n'
name|'return'
name|'fd'
newline|'\n'
DECL|member|die
dedent|''
dedent|''
name|'def'
name|'die'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'alive'
op|'='
number|'0'
newline|'\n'
DECL|member|run
dedent|''
name|'def'
name|'run'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'alive'
newline|'\n'
DECL|member|fds
dedent|''
name|'def'
name|'fds'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'proc'
op|'.'
name|'keys'
op|'('
op|')'
newline|'\n'
DECL|member|proc_kill
dedent|''
name|'def'
name|'proc_kill'
op|'('
name|'self'
op|','
name|'fd'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'fd'
name|'in'
name|'self'
op|'.'
name|'proc'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'proc'
op|'['
name|'fd'
op|']'
op|'['
string|"'time'"
op|']'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'t'
op|'='
name|'time'
op|'.'
name|'time'
op|'('
op|')'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'self'
op|'.'
name|'proc'
op|'.'
name|'keys'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'t0'
op|'='
name|'self'
op|'.'
name|'proc'
op|'['
name|'i'
op|']'
op|'['
string|"'time'"
op|']'
newline|'\n'
name|'if'
op|'('
name|'t'
op|'-'
name|'t0'
op|')'
op|'>'
number|'120'
op|':'
newline|'\n'
indent|'                '
name|'try'
op|':'
newline|'\n'
indent|'                    '
name|'os'
op|'.'
name|'close'
op|'('
name|'i'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'kill'
op|'('
name|'self'
op|'.'
name|'proc'
op|'['
name|'i'
op|']'
op|'['
string|"'pid'"
op|']'
op|','
name|'signal'
op|'.'
name|'SIGTERM'
op|')'
newline|'\n'
dedent|''
name|'except'
op|'('
name|'IOError'
op|','
name|'OSError'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'pass'
newline|'\n'
dedent|''
name|'del'
name|'self'
op|'.'
name|'proc'
op|'['
name|'i'
op|']'
newline|'\n'
DECL|member|proc_read
dedent|''
dedent|''
dedent|''
name|'def'
name|'proc_read'
op|'('
name|'self'
op|','
name|'fd'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'t'
op|'='
name|'self'
op|'.'
name|'proc'
op|'['
name|'fd'
op|']'
op|'['
string|"'term'"
op|']'
newline|'\n'
name|'t'
op|'.'
name|'write'
op|'('
name|'os'
op|'.'
name|'read'
op|'('
name|'fd'
op|','
number|'65536'
op|')'
op|')'
newline|'\n'
name|'reply'
op|'='
name|'t'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'if'
name|'reply'
op|':'
newline|'\n'
indent|'                '
name|'os'
op|'.'
name|'write'
op|'('
name|'fd'
op|','
name|'reply'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'proc'
op|'['
name|'fd'
op|']'
op|'['
string|"'time'"
op|']'
op|'='
name|'time'
op|'.'
name|'time'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
op|'('
name|'KeyError'
op|','
name|'IOError'
op|','
name|'OSError'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'proc_kill'
op|'('
name|'fd'
op|')'
newline|'\n'
DECL|member|proc_write
dedent|''
dedent|''
name|'def'
name|'proc_write'
op|'('
name|'self'
op|','
name|'fd'
op|','
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'write'
op|'('
name|'fd'
op|','
name|'s'
op|')'
newline|'\n'
dedent|''
name|'except'
op|'('
name|'IOError'
op|','
name|'OSError'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'proc_kill'
op|'('
name|'fd'
op|')'
newline|'\n'
DECL|member|dump
dedent|''
dedent|''
name|'def'
name|'dump'
op|'('
name|'self'
op|','
name|'fd'
op|','
name|'color'
op|'='
number|'1'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'proc'
op|'['
name|'fd'
op|']'
op|'['
string|"'term'"
op|']'
op|'.'
name|'dumphtml'
op|'('
name|'color'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'KeyError'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'False'
newline|'\n'
DECL|member|loop
dedent|''
dedent|''
name|'def'
name|'loop'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'while'
name|'self'
op|'.'
name|'run'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'fds'
op|'='
name|'self'
op|'.'
name|'fds'
op|'('
op|')'
newline|'\n'
name|'i'
op|','
name|'o'
op|','
name|'e'
op|'='
name|'select'
op|'.'
name|'select'
op|'('
name|'fds'
op|','
op|'['
op|']'
op|','
op|'['
op|']'
op|','
number|'1.0'
op|')'
newline|'\n'
name|'if'
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|'-'
name|'self'
op|'.'
name|'lastActivity'
op|'>'
number|'120'
op|':'
newline|'\n'
indent|'                '
name|'global'
name|'g_server'
newline|'\n'
name|'g_server'
op|'.'
name|'shutdown'
op|'('
op|')'
newline|'\n'
dedent|''
name|'for'
name|'fd'
name|'in'
name|'i'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'proc_read'
op|'('
name|'fd'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'i'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'time'
op|'.'
name|'sleep'
op|'('
number|'0.002'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'for'
name|'i'
name|'in'
name|'self'
op|'.'
name|'proc'
op|'.'
name|'keys'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'os'
op|'.'
name|'close'
op|'('
name|'i'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'kill'
op|'('
name|'self'
op|'.'
name|'proc'
op|'['
name|'i'
op|']'
op|'['
string|"'pid'"
op|']'
op|','
name|'signal'
op|'.'
name|'SIGTERM'
op|')'
newline|'\n'
dedent|''
name|'except'
op|'('
name|'IOError'
op|','
name|'OSError'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
nl|'\n'
DECL|class|AjaxTerm
dedent|''
dedent|''
dedent|''
dedent|''
name|'class'
name|'AjaxTerm'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'cmd'
op|'='
name|'None'
op|','
name|'index_file'
op|'='
string|"'ajaxterm.html'"
op|','
name|'token'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'files'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'token'
op|'='
name|'token'
newline|'\n'
name|'for'
name|'i'
name|'in'
op|'['
string|"'css'"
op|','
string|"'html'"
op|','
string|"'js'"
op|']'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'j'
name|'in'
name|'glob'
op|'.'
name|'glob'
op|'('
string|"'*.%s'"
op|'%'
name|'i'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'files'
op|'['
name|'j'
op|']'
op|'='
name|'file'
op|'('
name|'j'
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'files'
op|'['
string|"'index'"
op|']'
op|'='
name|'file'
op|'('
name|'index_file'
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mime'
op|'='
name|'mimetypes'
op|'.'
name|'types_map'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'mime'
op|'['
string|"'.html'"
op|']'
op|'='
string|"'text/html; charset=UTF-8'"
newline|'\n'
name|'self'
op|'.'
name|'multi'
op|'='
name|'Multiplex'
op|'('
name|'cmd'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session'
op|'='
op|'{'
op|'}'
newline|'\n'
DECL|member|__call__
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'environ'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'req'
op|'='
name|'qweb'
op|'.'
name|'QWebRequest'
op|'('
name|'environ'
op|','
name|'start_response'
op|','
name|'session'
op|'='
name|'None'
op|')'
newline|'\n'
name|'if'
name|'req'
op|'.'
name|'PATH_INFO'
op|'.'
name|'endswith'
op|'('
string|"'/u'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'='
name|'req'
op|'.'
name|'REQUEST'
op|'['
string|'"s"'
op|']'
newline|'\n'
name|'k'
op|'='
name|'req'
op|'.'
name|'REQUEST'
op|'['
string|'"k"'
op|']'
newline|'\n'
name|'c'
op|'='
name|'req'
op|'.'
name|'REQUEST'
op|'['
string|'"c"'
op|']'
newline|'\n'
name|'w'
op|'='
name|'req'
op|'.'
name|'REQUEST'
op|'.'
name|'int'
op|'('
string|'"w"'
op|')'
newline|'\n'
name|'h'
op|'='
name|'req'
op|'.'
name|'REQUEST'
op|'.'
name|'int'
op|'('
string|'"h"'
op|')'
newline|'\n'
name|'if'
name|'s'
name|'in'
name|'self'
op|'.'
name|'session'
op|':'
newline|'\n'
indent|'                '
name|'term'
op|'='
name|'self'
op|'.'
name|'session'
op|'['
name|'s'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'Exception'
op|'('
string|"'Not Authorized'"
op|')'
newline|'\n'
comment|'# The original code below was insecure, because it allowed unauthorized sessions to be created'
nl|'\n'
comment|'# if not (w>2 and w<256 and h>2 and h<100):'
nl|'\n'
comment|'# w,h=80,25'
nl|'\n'
comment|'# term=self.session[s]=self.multi.create(w,h)'
nl|'\n'
dedent|''
name|'if'
name|'k'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'multi'
op|'.'
name|'proc_write'
op|'('
name|'term'
op|','
name|'k'
op|')'
newline|'\n'
dedent|''
name|'time'
op|'.'
name|'sleep'
op|'('
number|'0.002'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'multi'
op|'.'
name|'lastActivity'
op|'='
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|';'
newline|'\n'
name|'dump'
op|'='
name|'self'
op|'.'
name|'multi'
op|'.'
name|'dump'
op|'('
name|'term'
op|','
name|'c'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'response_headers'
op|'['
string|"'Content-Type'"
op|']'
op|'='
string|"'text/xml'"
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'dump'
op|','
name|'str'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'req'
op|'.'
name|'write'
op|'('
name|'dump'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'response_gzencode'
op|'='
number|'1'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'del'
name|'self'
op|'.'
name|'session'
op|'['
name|'s'
op|']'
newline|'\n'
name|'req'
op|'.'
name|'write'
op|'('
string|'\'<?xml version="1.0"?><idem></idem>\''
op|')'
newline|'\n'
comment|'#            print "sessions %r"%self.session'
nl|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'n'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'req'
op|'.'
name|'PATH_INFO'
op|')'
newline|'\n'
name|'if'
name|'n'
name|'in'
name|'self'
op|'.'
name|'files'
op|':'
newline|'\n'
indent|'                '
name|'req'
op|'.'
name|'response_headers'
op|'['
string|"'Content-Type'"
op|']'
op|'='
name|'self'
op|'.'
name|'mime'
op|'.'
name|'get'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'splitext'
op|'('
name|'n'
op|')'
op|'['
number|'1'
op|']'
op|'.'
name|'lower'
op|'('
op|')'
op|','
string|"'application/octet-stream'"
op|')'
newline|'\n'
name|'req'
op|'.'
name|'write'
op|'('
name|'self'
op|'.'
name|'files'
op|'['
name|'n'
op|']'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'req'
op|'.'
name|'REQUEST'
op|'['
string|"'token'"
op|']'
op|'=='
name|'self'
op|'.'
name|'token'
op|':'
newline|'\n'
indent|'                '
name|'req'
op|'.'
name|'response_headers'
op|'['
string|"'Content-Type'"
op|']'
op|'='
string|"'text/html; charset=UTF-8'"
newline|'\n'
name|'session_id'
op|'='
name|'str'
op|'('
name|'uuid'
op|'.'
name|'uuid4'
op|'('
op|')'
op|')'
newline|'\n'
name|'req'
op|'.'
name|'write'
op|'('
name|'string'
op|'.'
name|'Template'
op|'('
name|'self'
op|'.'
name|'files'
op|'['
string|"'index'"
op|']'
op|')'
op|'.'
name|'substitute'
op|'('
name|'session_id'
op|'='
name|'session_id'
op|')'
op|')'
newline|'\n'
name|'term'
op|'='
name|'self'
op|'.'
name|'session'
op|'['
name|'session_id'
op|']'
op|'='
name|'self'
op|'.'
name|'multi'
op|'.'
name|'create'
op|'('
number|'80'
op|','
number|'25'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'Exception'
op|'('
string|'"Not Authorized"'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'req'
newline|'\n'
nl|'\n'
DECL|function|main
dedent|''
dedent|''
name|'def'
name|'main'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'parser'
op|'='
name|'optparse'
op|'.'
name|'OptionParser'
op|'('
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'add_option'
op|'('
string|'"-p"'
op|','
string|'"--port"'
op|','
name|'dest'
op|'='
string|'"port"'
op|','
name|'default'
op|'='
string|'"8022"'
op|','
name|'help'
op|'='
string|'"Set the TCP port (default: 8022)"'
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'add_option'
op|'('
string|'"-c"'
op|','
string|'"--command"'
op|','
name|'dest'
op|'='
string|'"cmd"'
op|','
name|'default'
op|'='
name|'None'
op|','
name|'help'
op|'='
string|'"set the command (default: /bin/login or ssh 0.0.0.0)"'
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'add_option'
op|'('
string|'"-l"'
op|','
string|'"--log"'
op|','
name|'action'
op|'='
string|'"store_true"'
op|','
name|'dest'
op|'='
string|'"log"'
op|','
name|'default'
op|'='
number|'0'
op|','
name|'help'
op|'='
string|'"log requests to stderr (default: quiet mode)"'
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'add_option'
op|'('
string|'"-d"'
op|','
string|'"--daemon"'
op|','
name|'action'
op|'='
string|'"store_true"'
op|','
name|'dest'
op|'='
string|'"daemon"'
op|','
name|'default'
op|'='
number|'0'
op|','
name|'help'
op|'='
string|'"run as daemon in the background"'
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'add_option'
op|'('
string|'"-P"'
op|','
string|'"--pidfile"'
op|','
name|'dest'
op|'='
string|'"pidfile"'
op|','
name|'default'
op|'='
string|'"/var/run/ajaxterm.pid"'
op|','
name|'help'
op|'='
string|'"set the pidfile (default: /var/run/ajaxterm.pid)"'
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'add_option'
op|'('
string|'"-i"'
op|','
string|'"--index"'
op|','
name|'dest'
op|'='
string|'"index_file"'
op|','
name|'default'
op|'='
string|'"ajaxterm.html"'
op|','
name|'help'
op|'='
string|'"default index file (default: ajaxterm.html)"'
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'add_option'
op|'('
string|'"-u"'
op|','
string|'"--uid"'
op|','
name|'dest'
op|'='
string|'"uid"'
op|','
name|'help'
op|'='
string|'"Set the daemon\'s user id"'
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'add_option'
op|'('
string|'"-t"'
op|','
string|'"--token"'
op|','
name|'dest'
op|'='
string|'"token"'
op|','
name|'help'
op|'='
string|'"Set authorization token"'
op|')'
newline|'\n'
op|'('
name|'o'
op|','
name|'a'
op|')'
op|'='
name|'parser'
op|'.'
name|'parse_args'
op|'('
op|')'
newline|'\n'
name|'if'
name|'o'
op|'.'
name|'daemon'
op|':'
newline|'\n'
indent|'        '
name|'pid'
op|'='
name|'os'
op|'.'
name|'fork'
op|'('
op|')'
newline|'\n'
name|'if'
name|'pid'
op|'=='
number|'0'
op|':'
newline|'\n'
comment|'#os.setsid() ?'
nl|'\n'
indent|'            '
name|'os'
op|'.'
name|'setpgrp'
op|'('
op|')'
newline|'\n'
name|'nullin'
op|'='
name|'file'
op|'('
string|"'/dev/null'"
op|','
string|"'r'"
op|')'
newline|'\n'
name|'nullout'
op|'='
name|'file'
op|'('
string|"'/dev/null'"
op|','
string|"'w'"
op|')'
newline|'\n'
name|'os'
op|'.'
name|'dup2'
op|'('
name|'nullin'
op|'.'
name|'fileno'
op|'('
op|')'
op|','
name|'sys'
op|'.'
name|'stdin'
op|'.'
name|'fileno'
op|'('
op|')'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'dup2'
op|'('
name|'nullout'
op|'.'
name|'fileno'
op|'('
op|')'
op|','
name|'sys'
op|'.'
name|'stdout'
op|'.'
name|'fileno'
op|'('
op|')'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'dup2'
op|'('
name|'nullout'
op|'.'
name|'fileno'
op|'('
op|')'
op|','
name|'sys'
op|'.'
name|'stderr'
op|'.'
name|'fileno'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'getuid'
op|'('
op|')'
op|'=='
number|'0'
name|'and'
name|'o'
op|'.'
name|'uid'
op|':'
newline|'\n'
indent|'                '
name|'try'
op|':'
newline|'\n'
indent|'                    '
name|'os'
op|'.'
name|'setuid'
op|'('
name|'int'
op|'('
name|'o'
op|'.'
name|'uid'
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'                    '
name|'os'
op|'.'
name|'setuid'
op|'('
name|'pwd'
op|'.'
name|'getpwnam'
op|'('
name|'o'
op|'.'
name|'uid'
op|')'
op|'.'
name|'pw_uid'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'try'
op|':'
newline|'\n'
indent|'                '
name|'file'
op|'('
name|'o'
op|'.'
name|'pidfile'
op|','
string|"'w+'"
op|')'
op|'.'
name|'write'
op|'('
name|'str'
op|'('
name|'pid'
op|')'
op|'+'
string|"'\\n'"
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'                '
name|'pass'
newline|'\n'
dedent|''
name|'print'
string|"'AjaxTerm at http://0.0.0.0:%s/ pid: %d'"
op|'%'
op|'('
name|'o'
op|'.'
name|'port'
op|','
name|'pid'
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'0'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'AjaxTerm at http://0.0.0.0:%s/'"
op|'%'
name|'o'
op|'.'
name|'port'
newline|'\n'
dedent|''
name|'at'
op|'='
name|'AjaxTerm'
op|'('
name|'o'
op|'.'
name|'cmd'
op|','
name|'o'
op|'.'
name|'index_file'
op|','
name|'o'
op|'.'
name|'token'
op|')'
newline|'\n'
comment|"#    f=lambda:os.system('firefox http://localhost:%s/&'%o.port)"
nl|'\n'
comment|"#    qweb.qweb_wsgi_autorun(at,ip='localhost',port=int(o.port),threaded=0,log=o.log,callback_ready=None)"
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'g_server'
newline|'\n'
name|'g_server'
op|'='
name|'qweb'
op|'.'
name|'QWebWSGIServer'
op|'('
name|'at'
op|','
name|'ip'
op|'='
string|"'0.0.0.0'"
op|','
name|'port'
op|'='
name|'int'
op|'('
name|'o'
op|'.'
name|'port'
op|')'
op|','
name|'threaded'
op|'='
number|'0'
op|','
name|'log'
op|'='
name|'o'
op|'.'
name|'log'
op|')'
newline|'\n'
name|'g_server'
op|'.'
name|'serve_forever'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'KeyboardInterrupt'
op|','
name|'e'
op|':'
newline|'\n'
indent|'        '
name|'sys'
op|'.'
name|'excepthook'
op|'('
op|'*'
name|'sys'
op|'.'
name|'exc_info'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'at'
op|'.'
name|'multi'
op|'.'
name|'die'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'    '
name|'main'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
endmarker|''
end_unit
