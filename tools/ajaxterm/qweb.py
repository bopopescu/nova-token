begin_unit
comment|'#!/usr/bin/python2.3'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# vim:set et ts=4 fdc=0 fdn=2 fdl=0:'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# There are no blank lines between blocks beacause i use folding from:'
nl|'\n'
comment|'# http://www.vim.org/scripts/script.php?script_id=515'
nl|'\n'
comment|'#'
nl|'\n'
nl|'\n'
string|'"""= QWeb Framework =\n\n== What is QWeb ? ==\n\nQWeb is a python based [http://www.python.org/doc/peps/pep-0333/ WSGI]\ncompatible web framework, it provides an infratructure to quickly build web\napplications consisting of:\n\n * A lightweight request handler (QWebRequest)\n * An xml templating engine (QWebXml and QWebHtml)\n * A simple name based controler (qweb_control)\n * A standalone WSGI Server (QWebWSGIServer)\n * A cgi and fastcgi WSGI wrapper (taken from flup)\n * A startup function that starts cgi, factgi or standalone according to the\n   evironement (qweb_autorun).\n\nQWeb applications are runnable in standalone mode (from commandline), via\nFastCGI, Regular CGI or by any python WSGI compliant server.\n\nQWeb doesn\'t provide any database access but it integrates nicely with ORMs\nsuch as SQLObject, SQLAlchemy or plain DB-API.\n\nWritten by Antony Lesuisse (email al AT udev.org)\n\nHomepage: http://antony.lesuisse.org/qweb/trac/\n\nForum: [http://antony.lesuisse.org/qweb/forum/viewforum.php?id=1 Forum]\n\n== Quick Start (for Linux, MacOS X and cygwin) ==\n\nMake sure you have at least python 2.3 installed and run the following commands:\n\n{{{\n$ wget http://antony.lesuisse.org/qweb/files/QWeb-0.7.tar.gz\n$ tar zxvf QWeb-0.7.tar.gz\n$ cd QWeb-0.7/examples/blog\n$ ./blog.py\n}}}\n\nAnd point your browser to http://localhost:8080/\n\nYou may also try AjaxTerm which uses qweb request handler.\n\n== Download ==\n\n * Version 0.7:\n   * Source [/qweb/files/QWeb-0.7.tar.gz QWeb-0.7.tar.gz]\n   * Python 2.3 Egg [/qweb/files/QWeb-0.7-py2.3.egg QWeb-0.7-py2.3.egg]\n   * Python 2.4 Egg [/qweb/files/QWeb-0.7-py2.4.egg QWeb-0.7-py2.4.egg]\n\n * [/qweb/trac/browser Browse the source repository]\n\n== Documentation ==\n\n * [/qweb/trac/browser/trunk/README.txt?format=raw Read the included documentation] \n * QwebTemplating\n\n== Mailin-list ==\n\n * Forum: [http://antony.lesuisse.org/qweb/forum/viewforum.php?id=1 Forum]\n * No mailing-list exists yet, discussion should happen on: [http://mail.python.org/mailman/listinfo/web-sig web-sig] [http://mail.python.org/pipermail/web-sig/ archives]\n\nQWeb Components:\n----------------\n\nQWeb also feature a simple components api, that enables developers to easily\nproduces reusable components.\n\nDefault qweb components:\n\n    - qweb_static:\n        A qweb component to serve static content from the filesystem or from\n        zipfiles.\n\n    - qweb_dbadmin:\n        scaffolding for sqlobject\n\nLicense\n-------\nqweb/fcgi.py wich is BSD-like from saddi.com.\nEverything else is put in the public domain.\n\n\nTODO\n----\n    Announce QWeb to python-announce-list@python.org web-sig@python.org\n    qweb_core\n        rename request methods into\n            request_save_files\n            response_404\n            response_redirect\n            response_download\n        request callback_generator, callback_function ?\n        wsgi callback_server_local\n        xml tags explicitly call render_attributes(t_att)?\n        priority form-checkbox over t-value (for t-option)\n\n"""'
newline|'\n'
nl|'\n'
name|'import'
name|'BaseHTTPServer'
op|','
name|'SocketServer'
op|','
name|'Cookie'
newline|'\n'
name|'import'
name|'cgi'
op|','
name|'datetime'
op|','
name|'email'
op|','
name|'email'
op|'.'
name|'Message'
op|','
name|'errno'
op|','
name|'gzip'
op|','
name|'os'
op|','
name|'random'
op|','
name|'re'
op|','
name|'socket'
op|','
name|'sys'
op|','
name|'tempfile'
op|','
name|'time'
op|','
name|'types'
op|','
name|'urllib'
op|','
name|'urlparse'
op|','
name|'xml'
op|'.'
name|'dom'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'import'
name|'cPickle'
name|'as'
name|'pickle'
newline|'\n'
dedent|''
name|'except'
name|'ImportError'
op|':'
newline|'\n'
indent|'    '
name|'import'
name|'pickle'
newline|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'import'
name|'cStringIO'
name|'as'
name|'StringIO'
newline|'\n'
dedent|''
name|'except'
name|'ImportError'
op|':'
newline|'\n'
indent|'    '
name|'import'
name|'StringIO'
newline|'\n'
nl|'\n'
comment|'#----------------------------------------------------------'
nl|'\n'
comment|'# Qweb Xml t-raw t-esc t-if t-foreach t-set t-call t-trim'
nl|'\n'
comment|'#----------------------------------------------------------'
nl|'\n'
DECL|class|QWebEval
dedent|''
name|'class'
name|'QWebEval'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'data'
op|'='
name|'data'
newline|'\n'
DECL|member|__getitem__
dedent|''
name|'def'
name|'__getitem__'
op|'('
name|'self'
op|','
name|'expr'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'data'
op|'.'
name|'has_key'
op|'('
name|'expr'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'data'
op|'['
name|'expr'
op|']'
newline|'\n'
dedent|''
name|'r'
op|'='
name|'None'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'r'
op|'='
name|'eval'
op|'('
name|'expr'
op|','
name|'self'
op|'.'
name|'data'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'NameError'
op|','
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'except'
name|'AttributeError'
op|','
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'except'
name|'Exception'
op|','
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'print'
string|'"qweb: expression error \'%s\' "'
op|'%'
name|'expr'
op|','
name|'e'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'data'
op|'.'
name|'has_key'
op|'('
string|'"__builtins__"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'del'
name|'self'
op|'.'
name|'data'
op|'['
string|'"__builtins__"'
op|']'
newline|'\n'
dedent|''
name|'return'
name|'r'
newline|'\n'
DECL|member|eval_object
dedent|''
name|'def'
name|'eval_object'
op|'('
name|'self'
op|','
name|'expr'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'['
name|'expr'
op|']'
newline|'\n'
DECL|member|eval_str
dedent|''
name|'def'
name|'eval_str'
op|'('
name|'self'
op|','
name|'expr'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'expr'
op|'=='
string|'"0"'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'data'
op|'['
number|'0'
op|']'
newline|'\n'
dedent|''
name|'if'
name|'isinstance'
op|'('
name|'self'
op|'['
name|'expr'
op|']'
op|','
name|'unicode'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'['
name|'expr'
op|']'
op|'.'
name|'encode'
op|'('
string|'"utf8"'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'str'
op|'('
name|'self'
op|'['
name|'expr'
op|']'
op|')'
newline|'\n'
DECL|member|eval_format
dedent|''
name|'def'
name|'eval_format'
op|'('
name|'self'
op|','
name|'expr'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'str'
op|'('
name|'expr'
op|'%'
name|'self'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|'"qweb: format error \'%s\' "'
op|'%'
name|'expr'
newline|'\n'
comment|'#       if isinstance(r,unicode):'
nl|'\n'
comment|'#           return r.encode("utf8")'
nl|'\n'
DECL|member|eval_bool
dedent|''
dedent|''
name|'def'
name|'eval_bool'
op|'('
name|'self'
op|','
name|'expr'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'eval_object'
op|'('
name|'expr'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
number|'1'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
number|'0'
newline|'\n'
DECL|class|QWebXml
dedent|''
dedent|''
dedent|''
name|'class'
name|'QWebXml'
op|':'
newline|'\n'
indent|'    '
string|'"""QWeb Xml templating engine\n    \n    The templating engine use a very simple syntax, "magic" xml attributes, to\n    produce any kind of texutal output (even non-xml).\n    \n    QWebXml:\n        the template engine core implements the basic magic attributes:\n    \n        t-att t-raw t-esc t-if t-foreach t-set t-call t-trim\n    \n    """'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'x'
op|'='
name|'None'
op|','
name|'zipname'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'node'
op|'='
name|'xml'
op|'.'
name|'dom'
op|'.'
name|'Node'
newline|'\n'
name|'self'
op|'.'
name|'_t'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'self'
op|'.'
name|'_render_tag'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'prefix'
op|'='
string|"'render_tag_'"
newline|'\n'
name|'for'
name|'i'
name|'in'
op|'['
name|'j'
name|'for'
name|'j'
name|'in'
name|'dir'
op|'('
name|'self'
op|')'
name|'if'
name|'j'
op|'.'
name|'startswith'
op|'('
name|'prefix'
op|')'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'name'
op|'='
name|'i'
op|'['
name|'len'
op|'('
name|'prefix'
op|')'
op|':'
op|']'
op|'.'
name|'replace'
op|'('
string|"'_'"
op|','
string|"'-'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_render_tag'
op|'['
name|'name'
op|']'
op|'='
name|'getattr'
op|'('
name|'self'
op|'.'
name|'__class__'
op|','
name|'i'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'_render_att'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'prefix'
op|'='
string|"'render_att_'"
newline|'\n'
name|'for'
name|'i'
name|'in'
op|'['
name|'j'
name|'for'
name|'j'
name|'in'
name|'dir'
op|'('
name|'self'
op|')'
name|'if'
name|'j'
op|'.'
name|'startswith'
op|'('
name|'prefix'
op|')'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'name'
op|'='
name|'i'
op|'['
name|'len'
op|'('
name|'prefix'
op|')'
op|':'
op|']'
op|'.'
name|'replace'
op|'('
string|"'_'"
op|','
string|"'-'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'_render_att'
op|'['
name|'name'
op|']'
op|'='
name|'getattr'
op|'('
name|'self'
op|'.'
name|'__class__'
op|','
name|'i'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'x'
op|'!='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'zipname'
op|'!='
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'import'
name|'zipfile'
newline|'\n'
name|'zf'
op|'='
name|'zipfile'
op|'.'
name|'ZipFile'
op|'('
name|'zipname'
op|','
string|"'r'"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'add_template'
op|'('
name|'zf'
op|'.'
name|'read'
op|'('
name|'x'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'add_template'
op|'('
name|'x'
op|')'
newline|'\n'
DECL|member|register_tag
dedent|''
dedent|''
dedent|''
name|'def'
name|'register_tag'
op|'('
name|'self'
op|','
name|'tag'
op|','
name|'func'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'_render_tag'
op|'['
name|'tag'
op|']'
op|'='
name|'func'
newline|'\n'
DECL|member|add_template
dedent|''
name|'def'
name|'add_template'
op|'('
name|'self'
op|','
name|'x'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'hasattr'
op|'('
name|'x'
op|','
string|"'documentElement'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'dom'
op|'='
name|'x'
newline|'\n'
dedent|''
name|'elif'
name|'x'
op|'.'
name|'startswith'
op|'('
string|'"<?xml"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'import'
name|'xml'
op|'.'
name|'dom'
op|'.'
name|'minidom'
newline|'\n'
name|'dom'
op|'='
name|'xml'
op|'.'
name|'dom'
op|'.'
name|'minidom'
op|'.'
name|'parseString'
op|'('
name|'x'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'import'
name|'xml'
op|'.'
name|'dom'
op|'.'
name|'minidom'
newline|'\n'
name|'dom'
op|'='
name|'xml'
op|'.'
name|'dom'
op|'.'
name|'minidom'
op|'.'
name|'parse'
op|'('
name|'x'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'n'
name|'in'
name|'dom'
op|'.'
name|'documentElement'
op|'.'
name|'childNodes'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'n'
op|'.'
name|'nodeName'
op|'=='
string|'"t"'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'_t'
op|'['
name|'str'
op|'('
name|'n'
op|'.'
name|'getAttribute'
op|'('
string|'"t-name"'
op|')'
op|')'
op|']'
op|'='
name|'n'
newline|'\n'
DECL|member|get_template
dedent|''
dedent|''
dedent|''
name|'def'
name|'get_template'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'_t'
op|'['
name|'name'
op|']'
newline|'\n'
nl|'\n'
DECL|member|eval_object
dedent|''
name|'def'
name|'eval_object'
op|'('
name|'self'
op|','
name|'expr'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'QWebEval'
op|'('
name|'v'
op|')'
op|'.'
name|'eval_object'
op|'('
name|'expr'
op|')'
newline|'\n'
DECL|member|eval_str
dedent|''
name|'def'
name|'eval_str'
op|'('
name|'self'
op|','
name|'expr'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'QWebEval'
op|'('
name|'v'
op|')'
op|'.'
name|'eval_str'
op|'('
name|'expr'
op|')'
newline|'\n'
DECL|member|eval_format
dedent|''
name|'def'
name|'eval_format'
op|'('
name|'self'
op|','
name|'expr'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'QWebEval'
op|'('
name|'v'
op|')'
op|'.'
name|'eval_format'
op|'('
name|'expr'
op|')'
newline|'\n'
DECL|member|eval_bool
dedent|''
name|'def'
name|'eval_bool'
op|'('
name|'self'
op|','
name|'expr'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'QWebEval'
op|'('
name|'v'
op|')'
op|'.'
name|'eval_bool'
op|'('
name|'expr'
op|')'
newline|'\n'
nl|'\n'
DECL|member|render
dedent|''
name|'def'
name|'render'
op|'('
name|'self'
op|','
name|'tname'
op|','
name|'v'
op|'='
op|'{'
op|'}'
op|','
name|'out'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'_t'
op|'.'
name|'has_key'
op|'('
name|'tname'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'render_node'
op|'('
name|'self'
op|'.'
name|'_t'
op|'['
name|'tname'
op|']'
op|','
name|'v'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|'\'qweb: template "%s" not found\''
op|'%'
name|'tname'
newline|'\n'
DECL|member|render_node
dedent|''
dedent|''
name|'def'
name|'render_node'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'r'
op|'='
string|'""'
newline|'\n'
name|'if'
name|'e'
op|'.'
name|'nodeType'
op|'=='
name|'self'
op|'.'
name|'node'
op|'.'
name|'TEXT_NODE'
name|'or'
name|'e'
op|'.'
name|'nodeType'
op|'=='
name|'self'
op|'.'
name|'node'
op|'.'
name|'CDATA_SECTION_NODE'
op|':'
newline|'\n'
indent|'            '
name|'r'
op|'='
name|'e'
op|'.'
name|'data'
op|'.'
name|'encode'
op|'('
string|'"utf8"'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'e'
op|'.'
name|'nodeType'
op|'=='
name|'self'
op|'.'
name|'node'
op|'.'
name|'ELEMENT_NODE'
op|':'
newline|'\n'
indent|'            '
name|'pre'
op|'='
string|'""'
newline|'\n'
name|'g_att'
op|'='
string|'""'
newline|'\n'
name|'t_render'
op|'='
name|'None'
newline|'\n'
name|'t_att'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
op|'('
name|'an'
op|','
name|'av'
op|')'
name|'in'
name|'e'
op|'.'
name|'attributes'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'an'
op|'='
name|'str'
op|'('
name|'an'
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'av'
op|','
name|'types'
op|'.'
name|'UnicodeType'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'av'
op|'='
name|'av'
op|'.'
name|'encode'
op|'('
string|'"utf8"'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'av'
op|'='
name|'av'
op|'.'
name|'nodeValue'
op|'.'
name|'encode'
op|'('
string|'"utf8"'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'an'
op|'.'
name|'startswith'
op|'('
string|'"t-"'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'for'
name|'i'
name|'in'
name|'self'
op|'.'
name|'_render_att'
op|':'
newline|'\n'
indent|'                        '
name|'if'
name|'an'
op|'['
number|'2'
op|':'
op|']'
op|'.'
name|'startswith'
op|'('
name|'i'
op|')'
op|':'
newline|'\n'
indent|'                            '
name|'g_att'
op|'+='
name|'self'
op|'.'
name|'_render_att'
op|'['
name|'i'
op|']'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'an'
op|','
name|'av'
op|','
name|'v'
op|')'
newline|'\n'
name|'break'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'if'
name|'self'
op|'.'
name|'_render_tag'
op|'.'
name|'has_key'
op|'('
name|'an'
op|'['
number|'2'
op|':'
op|']'
op|')'
op|':'
newline|'\n'
indent|'                            '
name|'t_render'
op|'='
name|'an'
op|'['
number|'2'
op|':'
op|']'
newline|'\n'
dedent|''
name|'t_att'
op|'['
name|'an'
op|'['
number|'2'
op|':'
op|']'
op|']'
op|'='
name|'av'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'g_att'
op|'+='
string|'\' %s="%s"\''
op|'%'
op|'('
name|'an'
op|','
name|'cgi'
op|'.'
name|'escape'
op|'('
name|'av'
op|','
number|'1'
op|')'
op|')'
op|';'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'t_render'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'self'
op|'.'
name|'_render_tag'
op|'.'
name|'has_key'
op|'('
name|'t_render'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'r'
op|'='
name|'self'
op|'.'
name|'_render_tag'
op|'['
name|'t_render'
op|']'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'r'
op|'='
name|'self'
op|'.'
name|'render_element'
op|'('
name|'e'
op|','
name|'g_att'
op|','
name|'v'
op|','
name|'pre'
op|','
name|'t_att'
op|'.'
name|'get'
op|'('
string|'"trim"'
op|','
number|'0'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'r'
newline|'\n'
DECL|member|render_element
dedent|''
name|'def'
name|'render_element'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'g_att'
op|','
name|'v'
op|','
name|'pre'
op|'='
string|'""'
op|','
name|'trim'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'g_inner'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'n'
name|'in'
name|'e'
op|'.'
name|'childNodes'
op|':'
newline|'\n'
indent|'            '
name|'g_inner'
op|'.'
name|'append'
op|'('
name|'self'
op|'.'
name|'render_node'
op|'('
name|'n'
op|','
name|'v'
op|')'
op|')'
newline|'\n'
dedent|''
name|'name'
op|'='
name|'str'
op|'('
name|'e'
op|'.'
name|'nodeName'
op|')'
newline|'\n'
name|'inner'
op|'='
string|'""'
op|'.'
name|'join'
op|'('
name|'g_inner'
op|')'
newline|'\n'
name|'if'
name|'trim'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
dedent|''
name|'elif'
name|'trim'
op|'=='
string|"'left'"
op|':'
newline|'\n'
indent|'            '
name|'inner'
op|'='
name|'inner'
op|'.'
name|'lstrip'
op|'('
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'trim'
op|'=='
string|"'right'"
op|':'
newline|'\n'
indent|'            '
name|'inner'
op|'='
name|'inner'
op|'.'
name|'rstrip'
op|'('
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'trim'
op|'=='
string|"'both'"
op|':'
newline|'\n'
indent|'            '
name|'inner'
op|'='
name|'inner'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
dedent|''
name|'if'
name|'name'
op|'=='
string|'"t"'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'inner'
newline|'\n'
dedent|''
name|'elif'
name|'len'
op|'('
name|'inner'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|'"<%s%s>%s%s</%s>"'
op|'%'
op|'('
name|'name'
op|','
name|'g_att'
op|','
name|'pre'
op|','
name|'inner'
op|','
name|'name'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|'"<%s%s/>"'
op|'%'
op|'('
name|'name'
op|','
name|'g_att'
op|')'
newline|'\n'
nl|'\n'
comment|'# Attributes'
nl|'\n'
DECL|member|render_att_att
dedent|''
dedent|''
name|'def'
name|'render_att_att'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'an'
op|','
name|'av'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'an'
op|'.'
name|'startswith'
op|'('
string|'"t-attf-"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'att'
op|','
name|'val'
op|'='
name|'an'
op|'['
number|'7'
op|':'
op|']'
op|','
name|'self'
op|'.'
name|'eval_format'
op|'('
name|'av'
op|','
name|'v'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'an'
op|'.'
name|'startswith'
op|'('
string|'"t-att-"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'att'
op|','
name|'val'
op|'='
op|'('
name|'an'
op|'['
number|'6'
op|':'
op|']'
op|','
name|'self'
op|'.'
name|'eval_str'
op|'('
name|'av'
op|','
name|'v'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'att'
op|','
name|'val'
op|'='
name|'self'
op|'.'
name|'eval_object'
op|'('
name|'av'
op|','
name|'v'
op|')'
newline|'\n'
dedent|''
name|'return'
string|'\' %s="%s"\''
op|'%'
op|'('
name|'att'
op|','
name|'cgi'
op|'.'
name|'escape'
op|'('
name|'val'
op|','
number|'1'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# Tags'
nl|'\n'
DECL|member|render_tag_raw
dedent|''
name|'def'
name|'render_tag_raw'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'eval_str'
op|'('
name|'t_att'
op|'['
string|'"raw"'
op|']'
op|','
name|'v'
op|')'
newline|'\n'
DECL|member|render_tag_rawf
dedent|''
name|'def'
name|'render_tag_rawf'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'eval_format'
op|'('
name|'t_att'
op|'['
string|'"rawf"'
op|']'
op|','
name|'v'
op|')'
newline|'\n'
DECL|member|render_tag_esc
dedent|''
name|'def'
name|'render_tag_esc'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'cgi'
op|'.'
name|'escape'
op|'('
name|'self'
op|'.'
name|'eval_str'
op|'('
name|'t_att'
op|'['
string|'"esc"'
op|']'
op|','
name|'v'
op|')'
op|')'
newline|'\n'
DECL|member|render_tag_escf
dedent|''
name|'def'
name|'render_tag_escf'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'cgi'
op|'.'
name|'escape'
op|'('
name|'self'
op|'.'
name|'eval_format'
op|'('
name|'t_att'
op|'['
string|'"escf"'
op|']'
op|','
name|'v'
op|')'
op|')'
newline|'\n'
DECL|member|render_tag_foreach
dedent|''
name|'def'
name|'render_tag_foreach'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'expr'
op|'='
name|'t_att'
op|'['
string|'"foreach"'
op|']'
newline|'\n'
name|'enum'
op|'='
name|'self'
op|'.'
name|'eval_object'
op|'('
name|'expr'
op|','
name|'v'
op|')'
newline|'\n'
name|'if'
name|'enum'
op|'!='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'var'
op|'='
name|'t_att'
op|'.'
name|'get'
op|'('
string|"'as'"
op|','
name|'expr'
op|')'
op|'.'
name|'replace'
op|'('
string|"'.'"
op|','
string|"'_'"
op|')'
newline|'\n'
name|'d'
op|'='
name|'v'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'size'
op|'='
op|'-'
number|'1'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'enum'
op|','
name|'types'
op|'.'
name|'ListType'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'size'
op|'='
name|'len'
op|'('
name|'enum'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'isinstance'
op|'('
name|'enum'
op|','
name|'types'
op|'.'
name|'TupleType'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'size'
op|'='
name|'len'
op|'('
name|'enum'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'hasattr'
op|'('
name|'enum'
op|','
string|"'count'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'size'
op|'='
name|'enum'
op|'.'
name|'count'
op|'('
op|')'
newline|'\n'
dedent|''
name|'d'
op|'['
string|'"%s_size"'
op|'%'
name|'var'
op|']'
op|'='
name|'size'
newline|'\n'
name|'d'
op|'['
string|'"%s_all"'
op|'%'
name|'var'
op|']'
op|'='
name|'enum'
newline|'\n'
name|'index'
op|'='
number|'0'
newline|'\n'
name|'ru'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'enum'
op|':'
newline|'\n'
indent|'                '
name|'d'
op|'['
string|'"%s_value"'
op|'%'
name|'var'
op|']'
op|'='
name|'i'
newline|'\n'
name|'d'
op|'['
string|'"%s_index"'
op|'%'
name|'var'
op|']'
op|'='
name|'index'
newline|'\n'
name|'d'
op|'['
string|'"%s_first"'
op|'%'
name|'var'
op|']'
op|'='
name|'index'
op|'=='
number|'0'
newline|'\n'
name|'d'
op|'['
string|'"%s_even"'
op|'%'
name|'var'
op|']'
op|'='
name|'index'
op|'%'
number|'2'
newline|'\n'
name|'d'
op|'['
string|'"%s_odd"'
op|'%'
name|'var'
op|']'
op|'='
op|'('
name|'index'
op|'+'
number|'1'
op|')'
op|'%'
number|'2'
newline|'\n'
name|'d'
op|'['
string|'"%s_last"'
op|'%'
name|'var'
op|']'
op|'='
name|'index'
op|'+'
number|'1'
op|'=='
name|'size'
newline|'\n'
name|'if'
name|'index'
op|'%'
number|'2'
op|':'
newline|'\n'
indent|'                    '
name|'d'
op|'['
string|'"%s_parity"'
op|'%'
name|'var'
op|']'
op|'='
string|"'odd'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'d'
op|'['
string|'"%s_parity"'
op|'%'
name|'var'
op|']'
op|'='
string|"'even'"
newline|'\n'
dedent|''
name|'if'
name|'isinstance'
op|'('
name|'i'
op|','
name|'types'
op|'.'
name|'DictType'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'d'
op|'.'
name|'update'
op|'('
name|'i'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'d'
op|'['
name|'var'
op|']'
op|'='
name|'i'
newline|'\n'
dedent|''
name|'ru'
op|'.'
name|'append'
op|'('
name|'self'
op|'.'
name|'render_element'
op|'('
name|'e'
op|','
name|'g_att'
op|','
name|'d'
op|')'
op|')'
newline|'\n'
name|'index'
op|'+='
number|'1'
newline|'\n'
dedent|''
name|'return'
string|'""'
op|'.'
name|'join'
op|'('
name|'ru'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|'"qweb: t-foreach %s not found."'
op|'%'
name|'expr'
newline|'\n'
DECL|member|render_tag_if
dedent|''
dedent|''
name|'def'
name|'render_tag_if'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'eval_bool'
op|'('
name|'t_att'
op|'['
string|'"if"'
op|']'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'self'
op|'.'
name|'render_element'
op|'('
name|'e'
op|','
name|'g_att'
op|','
name|'v'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|'""'
newline|'\n'
DECL|member|render_tag_call
dedent|''
dedent|''
name|'def'
name|'render_tag_call'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
comment|'# TODO t-prefix'
nl|'\n'
indent|'        '
name|'if'
name|'t_att'
op|'.'
name|'has_key'
op|'('
string|'"import"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'d'
op|'='
name|'v'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'d'
op|'='
name|'v'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
dedent|''
name|'d'
op|'['
number|'0'
op|']'
op|'='
name|'self'
op|'.'
name|'render_element'
op|'('
name|'e'
op|','
name|'g_att'
op|','
name|'d'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'render'
op|'('
name|'t_att'
op|'['
string|'"call"'
op|']'
op|','
name|'d'
op|')'
newline|'\n'
DECL|member|render_tag_set
dedent|''
name|'def'
name|'render_tag_set'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'t_att'
op|'.'
name|'has_key'
op|'('
string|'"eval"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'v'
op|'['
name|'t_att'
op|'['
string|'"set"'
op|']'
op|']'
op|'='
name|'self'
op|'.'
name|'eval_object'
op|'('
name|'t_att'
op|'['
string|'"eval"'
op|']'
op|','
name|'v'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'v'
op|'['
name|'t_att'
op|'['
string|'"set"'
op|']'
op|']'
op|'='
name|'self'
op|'.'
name|'render_element'
op|'('
name|'e'
op|','
name|'g_att'
op|','
name|'v'
op|')'
newline|'\n'
dedent|''
name|'return'
string|'""'
newline|'\n'
nl|'\n'
comment|'#----------------------------------------------------------'
nl|'\n'
comment|'# QWeb HTML (+deprecated QWebFORM and QWebOLD)'
nl|'\n'
comment|'#----------------------------------------------------------'
nl|'\n'
DECL|class|QWebURL
dedent|''
dedent|''
name|'class'
name|'QWebURL'
op|':'
newline|'\n'
indent|'    '
string|'""" URL helper\n    assert req.PATH_INFO== "/site/admin/page_edit"\n    u = QWebURL(root_path="/site/",req_path=req.PATH_INFO)\n    s=u.url2_href("user/login",{\'a\':\'1\'})\n    assert s=="../user/login?a=1"\n    \n    """'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'root_path'
op|'='
string|'"/"'
op|','
name|'req_path'
op|'='
string|'"/"'
op|','
name|'defpath'
op|'='
string|'""'
op|','
name|'defparam'
op|'='
op|'{'
op|'}'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'defpath'
op|'='
name|'defpath'
newline|'\n'
name|'self'
op|'.'
name|'defparam'
op|'='
name|'defparam'
newline|'\n'
name|'self'
op|'.'
name|'root_path'
op|'='
name|'root_path'
newline|'\n'
name|'self'
op|'.'
name|'req_path'
op|'='
name|'req_path'
newline|'\n'
name|'self'
op|'.'
name|'req_list'
op|'='
name|'req_path'
op|'.'
name|'split'
op|'('
string|'"/"'
op|')'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'req_len'
op|'='
name|'len'
op|'('
name|'self'
op|'.'
name|'req_list'
op|')'
newline|'\n'
DECL|member|decode
dedent|''
name|'def'
name|'decode'
op|'('
name|'self'
op|','
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'h'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'cgi'
op|'.'
name|'parse_qsl'
op|'('
name|'s'
op|','
number|'1'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'h'
op|'['
name|'k'
op|']'
op|'='
name|'v'
newline|'\n'
dedent|''
name|'return'
name|'h'
newline|'\n'
DECL|member|encode
dedent|''
name|'def'
name|'encode'
op|'('
name|'self'
op|','
name|'h'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'urllib'
op|'.'
name|'urlencode'
op|'('
name|'h'
op|'.'
name|'items'
op|'('
op|')'
op|')'
newline|'\n'
DECL|member|request
dedent|''
name|'def'
name|'request'
op|'('
name|'self'
op|','
name|'req'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'req'
op|'.'
name|'REQUEST'
newline|'\n'
DECL|member|copy
dedent|''
name|'def'
name|'copy'
op|'('
name|'self'
op|','
name|'path'
op|'='
name|'None'
op|','
name|'param'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'npath'
op|'='
name|'self'
op|'.'
name|'defpath'
newline|'\n'
name|'if'
name|'path'
op|':'
newline|'\n'
indent|'            '
name|'npath'
op|'='
name|'path'
newline|'\n'
dedent|''
name|'nparam'
op|'='
name|'self'
op|'.'
name|'defparam'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'if'
name|'param'
op|':'
newline|'\n'
indent|'            '
name|'nparam'
op|'.'
name|'update'
op|'('
name|'param'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'QWebURL'
op|'('
name|'self'
op|'.'
name|'root_path'
op|','
name|'self'
op|'.'
name|'req_path'
op|','
name|'npath'
op|','
name|'nparam'
op|')'
newline|'\n'
DECL|member|path
dedent|''
name|'def'
name|'path'
op|'('
name|'self'
op|','
name|'path'
op|'='
string|"''"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'path'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
name|'self'
op|'.'
name|'defpath'
newline|'\n'
dedent|''
name|'pl'
op|'='
op|'('
name|'self'
op|'.'
name|'root_path'
op|'+'
name|'path'
op|')'
op|'.'
name|'split'
op|'('
string|"'/'"
op|')'
newline|'\n'
name|'i'
op|'='
number|'0'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'min'
op|'('
name|'len'
op|'('
name|'pl'
op|')'
op|','
name|'self'
op|'.'
name|'req_len'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'pl'
op|'['
name|'i'
op|']'
op|'!='
name|'self'
op|'.'
name|'req_list'
op|'['
name|'i'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'break'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'i'
op|'+='
number|'1'
newline|'\n'
dedent|''
name|'dd'
op|'='
name|'self'
op|'.'
name|'req_len'
op|'-'
name|'i'
newline|'\n'
name|'if'
name|'dd'
op|'<'
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'dd'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'return'
string|"'/'"
op|'.'
name|'join'
op|'('
op|'['
string|"'..'"
op|']'
op|'*'
name|'dd'
op|'+'
name|'pl'
op|'['
name|'i'
op|':'
op|']'
op|')'
newline|'\n'
DECL|member|href
dedent|''
name|'def'
name|'href'
op|'('
name|'self'
op|','
name|'path'
op|'='
string|"''"
op|','
name|'arg'
op|'='
op|'{'
op|'}'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'p'
op|'='
name|'self'
op|'.'
name|'path'
op|'('
name|'path'
op|')'
newline|'\n'
name|'tmp'
op|'='
name|'self'
op|'.'
name|'defparam'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'tmp'
op|'.'
name|'update'
op|'('
name|'arg'
op|')'
newline|'\n'
name|'s'
op|'='
name|'self'
op|'.'
name|'encode'
op|'('
name|'tmp'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'s'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'p'
op|'+'
string|'"?"'
op|'+'
name|'s'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'p'
newline|'\n'
DECL|member|form
dedent|''
dedent|''
name|'def'
name|'form'
op|'('
name|'self'
op|','
name|'path'
op|'='
string|"''"
op|','
name|'arg'
op|'='
op|'{'
op|'}'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'p'
op|'='
name|'self'
op|'.'
name|'path'
op|'('
name|'path'
op|')'
newline|'\n'
name|'tmp'
op|'='
name|'self'
op|'.'
name|'defparam'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
name|'tmp'
op|'.'
name|'update'
op|'('
name|'arg'
op|')'
newline|'\n'
name|'r'
op|'='
string|"''"
op|'.'
name|'join'
op|'('
op|'['
string|'\'<input type="hidden" name="%s" value="%s"/>\''
op|'%'
op|'('
name|'k'
op|','
name|'cgi'
op|'.'
name|'escape'
op|'('
name|'str'
op|'('
name|'v'
op|')'
op|','
number|'1'
op|')'
op|')'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'tmp'
op|'.'
name|'items'
op|'('
op|')'
op|']'
op|')'
newline|'\n'
name|'return'
op|'('
name|'p'
op|','
name|'r'
op|')'
newline|'\n'
DECL|class|QWebField
dedent|''
dedent|''
name|'class'
name|'QWebField'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'name'
op|'='
name|'None'
op|','
name|'default'
op|'='
string|'""'
op|','
name|'check'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'name'
op|'='
name|'name'
newline|'\n'
name|'self'
op|'.'
name|'default'
op|'='
name|'default'
newline|'\n'
name|'self'
op|'.'
name|'check'
op|'='
name|'check'
newline|'\n'
comment|'# optional attributes'
nl|'\n'
name|'self'
op|'.'
name|'type'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'trim'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'required'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'cssvalid'
op|'='
string|'"form_valid"'
newline|'\n'
name|'self'
op|'.'
name|'cssinvalid'
op|'='
string|'"form_invalid"'
newline|'\n'
comment|'# set by addfield'
nl|'\n'
name|'self'
op|'.'
name|'form'
op|'='
name|'None'
newline|'\n'
comment|'# set by processing'
nl|'\n'
name|'self'
op|'.'
name|'input'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'css'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'value'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'valid'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'invalid'
op|'='
name|'None'
newline|'\n'
name|'self'
op|'.'
name|'validate'
op|'('
number|'1'
op|')'
newline|'\n'
DECL|member|validate
dedent|''
name|'def'
name|'validate'
op|'('
name|'self'
op|','
name|'val'
op|'='
number|'1'
op|','
name|'update'
op|'='
number|'1'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'val'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'valid'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'invalid'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'css'
op|'='
name|'self'
op|'.'
name|'cssvalid'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'valid'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'invalid'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'css'
op|'='
name|'self'
op|'.'
name|'cssinvalid'
newline|'\n'
dedent|''
name|'if'
name|'update'
name|'and'
name|'self'
op|'.'
name|'form'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'form'
op|'.'
name|'update'
op|'('
op|')'
newline|'\n'
DECL|member|invalidate
dedent|''
dedent|''
name|'def'
name|'invalidate'
op|'('
name|'self'
op|','
name|'update'
op|'='
number|'1'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'validate'
op|'('
number|'0'
op|','
name|'update'
op|')'
newline|'\n'
DECL|class|QWebForm
dedent|''
dedent|''
name|'class'
name|'QWebForm'
op|':'
newline|'\n'
DECL|class|QWebFormF
indent|'    '
name|'class'
name|'QWebFormF'
op|':'
newline|'\n'
indent|'        '
name|'pass'
newline|'\n'
DECL|member|__init__
dedent|''
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'e'
op|'='
name|'None'
op|','
name|'arg'
op|'='
name|'None'
op|','
name|'default'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'fields'
op|'='
op|'{'
op|'}'
newline|'\n'
comment|'# all fields have been submitted'
nl|'\n'
name|'self'
op|'.'
name|'submitted'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'missing'
op|'='
op|'['
op|']'
newline|'\n'
comment|'# at least one field is invalid or missing'
nl|'\n'
name|'self'
op|'.'
name|'invalid'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'error'
op|'='
op|'['
op|']'
newline|'\n'
comment|'# all fields have been submitted and are valid'
nl|'\n'
name|'self'
op|'.'
name|'valid'
op|'='
name|'False'
newline|'\n'
comment|'# fields under self.f for convenience'
nl|'\n'
name|'self'
op|'.'
name|'f'
op|'='
name|'self'
op|'.'
name|'QWebFormF'
op|'('
op|')'
newline|'\n'
name|'if'
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'add_template'
op|'('
name|'e'
op|')'
newline|'\n'
comment|'# assume that the fields are done with the template'
nl|'\n'
dedent|''
name|'if'
name|'default'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'set_default'
op|'('
name|'default'
op|','
name|'e'
op|'=='
name|'None'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'arg'
op|'!='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'process_input'
op|'('
name|'arg'
op|')'
newline|'\n'
DECL|member|__getitem__
dedent|''
dedent|''
name|'def'
name|'__getitem__'
op|'('
name|'self'
op|','
name|'k'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'fields'
op|'['
name|'k'
op|']'
newline|'\n'
DECL|member|set_default
dedent|''
name|'def'
name|'set_default'
op|'('
name|'self'
op|','
name|'default'
op|','
name|'add_missing'
op|'='
number|'1'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'default'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'self'
op|'.'
name|'fields'
op|'.'
name|'has_key'
op|'('
name|'k'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'fields'
op|'['
name|'k'
op|']'
op|'.'
name|'default'
op|'='
name|'str'
op|'('
name|'v'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'add_missing'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'add_field'
op|'('
name|'QWebField'
op|'('
name|'k'
op|','
name|'v'
op|')'
op|')'
newline|'\n'
DECL|member|add_field
dedent|''
dedent|''
dedent|''
name|'def'
name|'add_field'
op|'('
name|'self'
op|','
name|'f'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'fields'
op|'['
name|'f'
op|'.'
name|'name'
op|']'
op|'='
name|'f'
newline|'\n'
name|'f'
op|'.'
name|'form'
op|'='
name|'self'
newline|'\n'
name|'setattr'
op|'('
name|'self'
op|'.'
name|'f'
op|','
name|'f'
op|'.'
name|'name'
op|','
name|'f'
op|')'
newline|'\n'
DECL|member|add_template
dedent|''
name|'def'
name|'add_template'
op|'('
name|'self'
op|','
name|'e'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'att'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
op|'('
name|'an'
op|','
name|'av'
op|')'
name|'in'
name|'e'
op|'.'
name|'attributes'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'an'
op|'='
name|'str'
op|'('
name|'an'
op|')'
newline|'\n'
name|'if'
name|'an'
op|'.'
name|'startswith'
op|'('
string|'"t-"'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'att'
op|'['
name|'an'
op|'['
number|'2'
op|':'
op|']'
op|']'
op|'='
name|'av'
op|'.'
name|'encode'
op|'('
string|'"utf8"'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'for'
name|'i'
name|'in'
op|'['
string|'"form-text"'
op|','
string|'"form-password"'
op|','
string|'"form-radio"'
op|','
string|'"form-checkbox"'
op|','
string|'"form-select"'
op|','
string|'"form-textarea"'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'att'
op|'.'
name|'has_key'
op|'('
name|'i'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'name'
op|'='
name|'att'
op|'['
name|'i'
op|']'
op|'.'
name|'split'
op|'('
string|'"."'
op|')'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'default'
op|'='
name|'att'
op|'.'
name|'get'
op|'('
string|'"default"'
op|','
string|'""'
op|')'
newline|'\n'
name|'check'
op|'='
name|'att'
op|'.'
name|'get'
op|'('
string|'"check"'
op|','
name|'None'
op|')'
newline|'\n'
name|'f'
op|'='
name|'QWebField'
op|'('
name|'name'
op|','
name|'default'
op|','
name|'check'
op|')'
newline|'\n'
name|'if'
name|'i'
op|'=='
string|'"form-textarea"'
op|':'
newline|'\n'
indent|'                    '
name|'f'
op|'.'
name|'type'
op|'='
string|'"textarea"'
newline|'\n'
name|'f'
op|'.'
name|'trim'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'if'
name|'i'
op|'=='
string|'"form-checkbox"'
op|':'
newline|'\n'
indent|'                    '
name|'f'
op|'.'
name|'type'
op|'='
string|'"checkbox"'
newline|'\n'
name|'f'
op|'.'
name|'required'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'add_field'
op|'('
name|'f'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'for'
name|'n'
name|'in'
name|'e'
op|'.'
name|'childNodes'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'n'
op|'.'
name|'nodeType'
op|'=='
name|'n'
op|'.'
name|'ELEMENT_NODE'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'add_template'
op|'('
name|'n'
op|')'
newline|'\n'
DECL|member|process_input
dedent|''
dedent|''
dedent|''
name|'def'
name|'process_input'
op|'('
name|'self'
op|','
name|'arg'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'f'
name|'in'
name|'self'
op|'.'
name|'fields'
op|'.'
name|'values'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'arg'
op|'.'
name|'has_key'
op|'('
name|'f'
op|'.'
name|'name'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'f'
op|'.'
name|'input'
op|'='
name|'arg'
op|'['
name|'f'
op|'.'
name|'name'
op|']'
newline|'\n'
name|'f'
op|'.'
name|'value'
op|'='
name|'f'
op|'.'
name|'input'
newline|'\n'
name|'if'
name|'f'
op|'.'
name|'trim'
op|':'
newline|'\n'
indent|'                    '
name|'f'
op|'.'
name|'input'
op|'='
name|'f'
op|'.'
name|'input'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
dedent|''
name|'f'
op|'.'
name|'validate'
op|'('
number|'1'
op|','
name|'False'
op|')'
newline|'\n'
name|'if'
name|'f'
op|'.'
name|'check'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'                    '
name|'continue'
newline|'\n'
dedent|''
name|'elif'
name|'callable'
op|'('
name|'f'
op|'.'
name|'check'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'pass'
newline|'\n'
dedent|''
name|'elif'
name|'isinstance'
op|'('
name|'f'
op|'.'
name|'check'
op|','
name|'str'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'v'
op|'='
name|'f'
op|'.'
name|'check'
newline|'\n'
name|'if'
name|'f'
op|'.'
name|'check'
op|'=='
string|'"email"'
op|':'
newline|'\n'
indent|'                        '
name|'v'
op|'='
string|'r"/^[^@#!& ]+@[A-Za-z0-9-][.A-Za-z0-9-]{0,64}\\.[A-Za-z]{2,5}$/"'
newline|'\n'
dedent|''
name|'if'
name|'f'
op|'.'
name|'check'
op|'=='
string|'"date"'
op|':'
newline|'\n'
indent|'                        '
name|'v'
op|'='
string|'r"/^(19|20)\\d\\d-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/"'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'re'
op|'.'
name|'match'
op|'('
name|'v'
op|'['
number|'1'
op|':'
op|'-'
number|'1'
op|']'
op|','
name|'f'
op|'.'
name|'input'
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'f'
op|'.'
name|'validate'
op|'('
number|'0'
op|','
name|'False'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'f'
op|'.'
name|'value'
op|'='
name|'f'
op|'.'
name|'default'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'update'
op|'('
op|')'
newline|'\n'
DECL|member|validate_all
dedent|''
name|'def'
name|'validate_all'
op|'('
name|'self'
op|','
name|'val'
op|'='
number|'1'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'f'
name|'in'
name|'self'
op|'.'
name|'fields'
op|'.'
name|'values'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'f'
op|'.'
name|'validate'
op|'('
name|'val'
op|','
number|'0'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'update'
op|'('
op|')'
newline|'\n'
DECL|member|invalidate_all
dedent|''
name|'def'
name|'invalidate_all'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'validate_all'
op|'('
number|'0'
op|')'
newline|'\n'
DECL|member|update
dedent|''
name|'def'
name|'update'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'submitted'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'valid'
op|'='
name|'True'
newline|'\n'
name|'self'
op|'.'
name|'errors'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'f'
name|'in'
name|'self'
op|'.'
name|'fields'
op|'.'
name|'values'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'f'
op|'.'
name|'required'
name|'and'
name|'f'
op|'.'
name|'input'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'submitted'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'valid'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'missing'
op|'.'
name|'append'
op|'('
name|'f'
op|'.'
name|'name'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'f'
op|'.'
name|'invalid'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'valid'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'error'
op|'.'
name|'append'
op|'('
name|'f'
op|'.'
name|'name'
op|')'
newline|'\n'
comment|'# invalid have been submitted and '
nl|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'invalid'
op|'='
name|'self'
op|'.'
name|'submitted'
name|'and'
name|'self'
op|'.'
name|'valid'
op|'=='
name|'False'
newline|'\n'
DECL|member|collect
dedent|''
name|'def'
name|'collect'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'f'
name|'in'
name|'self'
op|'.'
name|'fields'
op|'.'
name|'values'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'d'
op|'['
name|'f'
op|'.'
name|'name'
op|']'
op|'='
name|'f'
op|'.'
name|'value'
newline|'\n'
dedent|''
name|'return'
name|'d'
newline|'\n'
DECL|class|QWebURLEval
dedent|''
dedent|''
name|'class'
name|'QWebURLEval'
op|'('
name|'QWebEval'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'QWebEval'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
name|'data'
op|')'
newline|'\n'
DECL|member|__getitem__
dedent|''
name|'def'
name|'__getitem__'
op|'('
name|'self'
op|','
name|'expr'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'r'
op|'='
name|'QWebEval'
op|'.'
name|'__getitem__'
op|'('
name|'self'
op|','
name|'expr'
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'r'
op|','
name|'str'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'urllib'
op|'.'
name|'quote_plus'
op|'('
name|'r'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'r'
newline|'\n'
DECL|class|QWebHtml
dedent|''
dedent|''
dedent|''
name|'class'
name|'QWebHtml'
op|'('
name|'QWebXml'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'"""QWebHtml\n    QWebURL:\n    QWebField:\n    QWebForm:\n    QWebHtml:\n        an extended template engine, with a few utility class to easily produce\n        HTML, handle URLs and process forms, it adds the following magic attributes:\n    \n        t-href t-action t-form-text t-form-password t-form-textarea t-form-radio\n        t-form-checkbox t-form-select t-option t-selected t-checked t-pager\n    \n    # explication URL:\n    # v[\'tableurl\']=QWebUrl({p=afdmin,saar=,orderby=,des=,mlink;meta_active=})\n    # t-href="tableurl?desc=1"\n    #\n    # explication FORM: t-if="form.valid()"\n    # Foreach i\n    #   email: <input type="text" t-esc-name="i" t-esc-value="form[i].value" t-esc-class="form[i].css"/>\n    #   <input type="radio" name="spamtype" t-esc-value="i" t-selected="i==form.f.spamtype.value"/>\n    #   <option t-esc-value="cc" t-selected="cc==form.f.country.value"><t t-esc="cname"></option>\n    # Simple forms:\n    #   <input t-form-text="form.email" t-check="email"/>\n    #   <input t-form-password="form.email" t-check="email"/>\n    #   <input t-form-radio="form.email" />\n    #   <input t-form-checkbox="form.email" />\n    #   <textarea t-form-textarea="form.email" t-check="email"/>\n    #   <select t-form-select="form.email"/>\n    #       <option t-value="1">\n    #   <input t-form-radio="form.spamtype" t-value="1"/> Cars\n    #   <input t-form-radio="form.spamtype" t-value="2"/> Sprt\n    """'
newline|'\n'
comment|'# QWebForm from a template'
nl|'\n'
DECL|member|form
name|'def'
name|'form'
op|'('
name|'self'
op|','
name|'tname'
op|','
name|'arg'
op|'='
name|'None'
op|','
name|'default'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'form'
op|'='
name|'QWebForm'
op|'('
name|'self'
op|'.'
name|'_t'
op|'['
name|'tname'
op|']'
op|','
name|'arg'
op|','
name|'default'
op|')'
newline|'\n'
name|'return'
name|'form'
newline|'\n'
nl|'\n'
comment|'# HTML Att'
nl|'\n'
DECL|member|eval_url
dedent|''
name|'def'
name|'eval_url'
op|'('
name|'self'
op|','
name|'av'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'s'
op|'='
name|'QWebURLEval'
op|'('
name|'v'
op|')'
op|'.'
name|'eval_format'
op|'('
name|'av'
op|')'
newline|'\n'
name|'a'
op|'='
name|'s'
op|'.'
name|'split'
op|'('
string|"'?'"
op|','
number|'1'
op|')'
newline|'\n'
name|'arg'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'a'
op|')'
op|'>'
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'cgi'
op|'.'
name|'parse_qsl'
op|'('
name|'a'
op|'['
number|'1'
op|']'
op|','
number|'1'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'arg'
op|'['
name|'k'
op|']'
op|'='
name|'v'
newline|'\n'
dedent|''
dedent|''
name|'b'
op|'='
name|'a'
op|'['
number|'0'
op|']'
op|'.'
name|'split'
op|'('
string|"'/'"
op|','
number|'1'
op|')'
newline|'\n'
name|'path'
op|'='
string|"''"
newline|'\n'
name|'if'
name|'len'
op|'('
name|'b'
op|')'
op|'>'
number|'1'
op|':'
newline|'\n'
indent|'            '
name|'path'
op|'='
name|'b'
op|'['
number|'1'
op|']'
newline|'\n'
dedent|''
name|'u'
op|'='
name|'b'
op|'['
number|'0'
op|']'
newline|'\n'
name|'return'
name|'u'
op|','
name|'path'
op|','
name|'arg'
newline|'\n'
DECL|member|render_att_url_
dedent|''
name|'def'
name|'render_att_url_'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'an'
op|','
name|'av'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'u'
op|','
name|'path'
op|','
name|'arg'
op|'='
name|'self'
op|'.'
name|'eval_url'
op|'('
name|'av'
op|','
name|'v'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'isinstance'
op|'('
name|'v'
op|'.'
name|'get'
op|'('
name|'u'
op|','
number|'0'
op|')'
op|','
name|'QWebURL'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'out'
op|'='
string|"'qweb: missing url %r %r %r'"
op|'%'
op|'('
name|'u'
op|','
name|'path'
op|','
name|'arg'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'out'
op|'='
name|'v'
op|'['
name|'u'
op|']'
op|'.'
name|'href'
op|'('
name|'path'
op|','
name|'arg'
op|')'
newline|'\n'
dedent|''
name|'return'
string|'\' %s="%s"\''
op|'%'
op|'('
name|'an'
op|'['
number|'6'
op|':'
op|']'
op|','
name|'cgi'
op|'.'
name|'escape'
op|'('
name|'out'
op|','
number|'1'
op|')'
op|')'
newline|'\n'
DECL|member|render_att_href
dedent|''
name|'def'
name|'render_att_href'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'an'
op|','
name|'av'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'render_att_url_'
op|'('
name|'e'
op|','
string|'"t-url-href"'
op|','
name|'av'
op|','
name|'v'
op|')'
newline|'\n'
DECL|member|render_att_checked
dedent|''
name|'def'
name|'render_att_checked'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'an'
op|','
name|'av'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'eval_bool'
op|'('
name|'av'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|'\' %s="%s"\''
op|'%'
op|'('
name|'an'
op|'['
number|'2'
op|':'
op|']'
op|','
name|'an'
op|'['
number|'2'
op|':'
op|']'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
string|"''"
newline|'\n'
DECL|member|render_att_selected
dedent|''
dedent|''
name|'def'
name|'render_att_selected'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'an'
op|','
name|'av'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'render_att_checked'
op|'('
name|'e'
op|','
name|'an'
op|','
name|'av'
op|','
name|'v'
op|')'
newline|'\n'
nl|'\n'
comment|'# HTML Tags forms'
nl|'\n'
DECL|member|render_tag_rawurl
dedent|''
name|'def'
name|'render_tag_rawurl'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'u'
op|','
name|'path'
op|','
name|'arg'
op|'='
name|'self'
op|'.'
name|'eval_url'
op|'('
name|'t_att'
op|'['
string|'"rawurl"'
op|']'
op|','
name|'v'
op|')'
newline|'\n'
name|'return'
name|'v'
op|'['
name|'u'
op|']'
op|'.'
name|'href'
op|'('
name|'path'
op|','
name|'arg'
op|')'
newline|'\n'
DECL|member|render_tag_escurl
dedent|''
name|'def'
name|'render_tag_escurl'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'u'
op|','
name|'path'
op|','
name|'arg'
op|'='
name|'self'
op|'.'
name|'eval_url'
op|'('
name|'t_att'
op|'['
string|'"escurl"'
op|']'
op|','
name|'v'
op|')'
newline|'\n'
name|'return'
name|'cgi'
op|'.'
name|'escape'
op|'('
name|'v'
op|'['
name|'u'
op|']'
op|'.'
name|'href'
op|'('
name|'path'
op|','
name|'arg'
op|')'
op|')'
newline|'\n'
DECL|member|render_tag_action
dedent|''
name|'def'
name|'render_tag_action'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'u'
op|','
name|'path'
op|','
name|'arg'
op|'='
name|'self'
op|'.'
name|'eval_url'
op|'('
name|'t_att'
op|'['
string|'"action"'
op|']'
op|','
name|'v'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'isinstance'
op|'('
name|'v'
op|'.'
name|'get'
op|'('
name|'u'
op|','
number|'0'
op|')'
op|','
name|'QWebURL'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'action'
op|','
name|'input'
op|'='
op|'('
string|"'qweb: missing url %r %r %r'"
op|'%'
op|'('
name|'u'
op|','
name|'path'
op|','
name|'arg'
op|')'
op|','
string|"''"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'action'
op|','
name|'input'
op|'='
name|'v'
op|'['
name|'u'
op|']'
op|'.'
name|'form'
op|'('
name|'path'
op|','
name|'arg'
op|')'
newline|'\n'
dedent|''
name|'g_att'
op|'+='
string|'\' action="%s"\''
op|'%'
name|'action'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'render_element'
op|'('
name|'e'
op|','
name|'g_att'
op|','
name|'v'
op|','
name|'input'
op|')'
newline|'\n'
DECL|member|render_tag_form_text
dedent|''
name|'def'
name|'render_tag_form_text'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'f'
op|'='
name|'self'
op|'.'
name|'eval_object'
op|'('
name|'t_att'
op|'['
string|'"form-text"'
op|']'
op|','
name|'v'
op|')'
newline|'\n'
name|'g_att'
op|'+='
string|'\' type="text" name="%s" value="%s" class="%s"\''
op|'%'
op|'('
name|'f'
op|'.'
name|'name'
op|','
name|'cgi'
op|'.'
name|'escape'
op|'('
name|'f'
op|'.'
name|'value'
op|','
number|'1'
op|')'
op|','
name|'f'
op|'.'
name|'css'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'render_element'
op|'('
name|'e'
op|','
name|'g_att'
op|','
name|'v'
op|')'
newline|'\n'
DECL|member|render_tag_form_password
dedent|''
name|'def'
name|'render_tag_form_password'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'f'
op|'='
name|'self'
op|'.'
name|'eval_object'
op|'('
name|'t_att'
op|'['
string|'"form-password"'
op|']'
op|','
name|'v'
op|')'
newline|'\n'
name|'g_att'
op|'+='
string|'\' type="password" name="%s" value="%s" class="%s"\''
op|'%'
op|'('
name|'f'
op|'.'
name|'name'
op|','
name|'cgi'
op|'.'
name|'escape'
op|'('
name|'f'
op|'.'
name|'value'
op|','
number|'1'
op|')'
op|','
name|'f'
op|'.'
name|'css'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'render_element'
op|'('
name|'e'
op|','
name|'g_att'
op|','
name|'v'
op|')'
newline|'\n'
DECL|member|render_tag_form_textarea
dedent|''
name|'def'
name|'render_tag_form_textarea'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'type'
op|'='
string|'"textarea"'
newline|'\n'
name|'f'
op|'='
name|'self'
op|'.'
name|'eval_object'
op|'('
name|'t_att'
op|'['
string|'"form-textarea"'
op|']'
op|','
name|'v'
op|')'
newline|'\n'
name|'g_att'
op|'+='
string|'\' name="%s" class="%s"\''
op|'%'
op|'('
name|'f'
op|'.'
name|'name'
op|','
name|'f'
op|'.'
name|'css'
op|')'
newline|'\n'
name|'r'
op|'='
string|'"<%s%s>%s</%s>"'
op|'%'
op|'('
name|'type'
op|','
name|'g_att'
op|','
name|'cgi'
op|'.'
name|'escape'
op|'('
name|'f'
op|'.'
name|'value'
op|','
number|'1'
op|')'
op|','
name|'type'
op|')'
newline|'\n'
name|'return'
name|'r'
newline|'\n'
DECL|member|render_tag_form_radio
dedent|''
name|'def'
name|'render_tag_form_radio'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'f'
op|'='
name|'self'
op|'.'
name|'eval_object'
op|'('
name|'t_att'
op|'['
string|'"form-radio"'
op|']'
op|','
name|'v'
op|')'
newline|'\n'
name|'val'
op|'='
name|'t_att'
op|'['
string|'"value"'
op|']'
newline|'\n'
name|'g_att'
op|'+='
string|'\' type="radio" name="%s" value="%s"\''
op|'%'
op|'('
name|'f'
op|'.'
name|'name'
op|','
name|'val'
op|')'
newline|'\n'
name|'if'
name|'f'
op|'.'
name|'value'
op|'=='
name|'val'
op|':'
newline|'\n'
indent|'            '
name|'g_att'
op|'+='
string|'\' checked="checked"\''
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'render_element'
op|'('
name|'e'
op|','
name|'g_att'
op|','
name|'v'
op|')'
newline|'\n'
DECL|member|render_tag_form_checkbox
dedent|''
name|'def'
name|'render_tag_form_checkbox'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'f'
op|'='
name|'self'
op|'.'
name|'eval_object'
op|'('
name|'t_att'
op|'['
string|'"form-checkbox"'
op|']'
op|','
name|'v'
op|')'
newline|'\n'
name|'val'
op|'='
name|'t_att'
op|'['
string|'"value"'
op|']'
newline|'\n'
name|'g_att'
op|'+='
string|'\' type="checkbox" name="%s" value="%s"\''
op|'%'
op|'('
name|'f'
op|'.'
name|'name'
op|','
name|'val'
op|')'
newline|'\n'
name|'if'
name|'f'
op|'.'
name|'value'
op|'=='
name|'val'
op|':'
newline|'\n'
indent|'            '
name|'g_att'
op|'+='
string|'\' checked="checked"\''
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'render_element'
op|'('
name|'e'
op|','
name|'g_att'
op|','
name|'v'
op|')'
newline|'\n'
DECL|member|render_tag_form_select
dedent|''
name|'def'
name|'render_tag_form_select'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'f'
op|'='
name|'self'
op|'.'
name|'eval_object'
op|'('
name|'t_att'
op|'['
string|'"form-select"'
op|']'
op|','
name|'v'
op|')'
newline|'\n'
name|'g_att'
op|'+='
string|'\' name="%s" class="%s"\''
op|'%'
op|'('
name|'f'
op|'.'
name|'name'
op|','
name|'f'
op|'.'
name|'css'
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'render_element'
op|'('
name|'e'
op|','
name|'g_att'
op|','
name|'v'
op|')'
newline|'\n'
DECL|member|render_tag_option
dedent|''
name|'def'
name|'render_tag_option'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'f'
op|'='
name|'self'
op|'.'
name|'eval_object'
op|'('
name|'e'
op|'.'
name|'parentNode'
op|'.'
name|'getAttribute'
op|'('
string|'"t-form-select"'
op|')'
op|','
name|'v'
op|')'
newline|'\n'
name|'val'
op|'='
name|'t_att'
op|'['
string|'"option"'
op|']'
newline|'\n'
name|'g_att'
op|'+='
string|'\' value="%s"\''
op|'%'
op|'('
name|'val'
op|')'
newline|'\n'
name|'if'
name|'f'
op|'.'
name|'value'
op|'=='
name|'val'
op|':'
newline|'\n'
indent|'            '
name|'g_att'
op|'+='
string|'\' selected="selected"\''
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'render_element'
op|'('
name|'e'
op|','
name|'g_att'
op|','
name|'v'
op|')'
newline|'\n'
nl|'\n'
comment|'# HTML Tags others'
nl|'\n'
DECL|member|render_tag_pager
dedent|''
name|'def'
name|'render_tag_pager'
op|'('
name|'self'
op|','
name|'e'
op|','
name|'t_att'
op|','
name|'g_att'
op|','
name|'v'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'pre'
op|'='
name|'t_att'
op|'['
string|'"pager"'
op|']'
newline|'\n'
name|'total'
op|'='
name|'int'
op|'('
name|'self'
op|'.'
name|'eval_str'
op|'('
name|'t_att'
op|'['
string|'"total"'
op|']'
op|','
name|'v'
op|')'
op|')'
newline|'\n'
name|'start'
op|'='
name|'int'
op|'('
name|'self'
op|'.'
name|'eval_str'
op|'('
name|'t_att'
op|'['
string|'"start"'
op|']'
op|','
name|'v'
op|')'
op|')'
newline|'\n'
name|'step'
op|'='
name|'int'
op|'('
name|'self'
op|'.'
name|'eval_str'
op|'('
name|'t_att'
op|'.'
name|'get'
op|'('
string|'"step"'
op|','
string|'"100"'
op|')'
op|','
name|'v'
op|')'
op|')'
newline|'\n'
name|'scope'
op|'='
name|'int'
op|'('
name|'self'
op|'.'
name|'eval_str'
op|'('
name|'t_att'
op|'.'
name|'get'
op|'('
string|'"scope"'
op|','
string|'"5"'
op|')'
op|','
name|'v'
op|')'
op|')'
newline|'\n'
comment|'# Compute Pager'
nl|'\n'
name|'p'
op|'='
name|'pre'
op|'+'
string|'"_"'
newline|'\n'
name|'d'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'d'
op|'['
name|'p'
op|'+'
string|'"tot_size"'
op|']'
op|'='
name|'total'
newline|'\n'
name|'d'
op|'['
name|'p'
op|'+'
string|'"tot_page"'
op|']'
op|'='
name|'tot_page'
op|'='
name|'total'
op|'/'
name|'step'
newline|'\n'
name|'d'
op|'['
name|'p'
op|'+'
string|'"win_start0"'
op|']'
op|'='
name|'total'
name|'and'
name|'start'
newline|'\n'
name|'d'
op|'['
name|'p'
op|'+'
string|'"win_start1"'
op|']'
op|'='
name|'total'
name|'and'
name|'start'
op|'+'
number|'1'
newline|'\n'
name|'d'
op|'['
name|'p'
op|'+'
string|'"win_end0"'
op|']'
op|'='
name|'max'
op|'('
number|'0'
op|','
name|'min'
op|'('
name|'start'
op|'+'
name|'step'
op|'-'
number|'1'
op|','
name|'total'
op|'-'
number|'1'
op|')'
op|')'
newline|'\n'
name|'d'
op|'['
name|'p'
op|'+'
string|'"win_end1"'
op|']'
op|'='
name|'min'
op|'('
name|'start'
op|'+'
name|'step'
op|','
name|'total'
op|')'
newline|'\n'
name|'d'
op|'['
name|'p'
op|'+'
string|'"win_page0"'
op|']'
op|'='
name|'win_page'
op|'='
name|'start'
op|'/'
name|'step'
newline|'\n'
name|'d'
op|'['
name|'p'
op|'+'
string|'"win_page1"'
op|']'
op|'='
name|'win_page'
op|'+'
number|'1'
newline|'\n'
name|'d'
op|'['
name|'p'
op|'+'
string|'"prev"'
op|']'
op|'='
op|'('
name|'win_page'
op|'!='
number|'0'
op|')'
newline|'\n'
name|'d'
op|'['
name|'p'
op|'+'
string|'"prev_start"'
op|']'
op|'='
op|'('
name|'win_page'
op|'-'
number|'1'
op|')'
op|'*'
name|'step'
newline|'\n'
name|'d'
op|'['
name|'p'
op|'+'
string|'"next"'
op|']'
op|'='
op|'('
name|'tot_page'
op|'>='
name|'win_page'
op|'+'
number|'1'
op|')'
newline|'\n'
name|'d'
op|'['
name|'p'
op|'+'
string|'"next_start"'
op|']'
op|'='
op|'('
name|'win_page'
op|'+'
number|'1'
op|')'
op|'*'
name|'step'
newline|'\n'
name|'l'
op|'='
op|'['
op|']'
newline|'\n'
name|'begin'
op|'='
name|'win_page'
op|'-'
name|'scope'
newline|'\n'
name|'end'
op|'='
name|'win_page'
op|'+'
name|'scope'
newline|'\n'
name|'if'
name|'begin'
op|'<'
number|'0'
op|':'
newline|'\n'
indent|'            '
name|'end'
op|'-='
name|'begin'
newline|'\n'
dedent|''
name|'if'
name|'end'
op|'>'
name|'tot_page'
op|':'
newline|'\n'
indent|'            '
name|'begin'
op|'-='
op|'('
name|'end'
op|'-'
name|'tot_page'
op|')'
newline|'\n'
dedent|''
name|'i'
op|'='
name|'max'
op|'('
number|'0'
op|','
name|'begin'
op|')'
newline|'\n'
name|'while'
name|'i'
op|'<='
name|'min'
op|'('
name|'end'
op|','
name|'tot_page'
op|')'
name|'and'
name|'total'
op|'!='
name|'step'
op|':'
newline|'\n'
indent|'            '
name|'l'
op|'.'
name|'append'
op|'('
op|'{'
name|'p'
op|'+'
string|'"page0"'
op|':'
name|'i'
op|','
name|'p'
op|'+'
string|'"page1"'
op|':'
name|'i'
op|'+'
number|'1'
op|','
name|'p'
op|'+'
string|'"start"'
op|':'
name|'i'
op|'*'
name|'step'
op|','
name|'p'
op|'+'
string|'"sel"'
op|':'
op|'('
name|'win_page'
op|'=='
name|'i'
op|')'
op|'}'
op|')'
newline|'\n'
name|'i'
op|'+='
number|'1'
newline|'\n'
dedent|''
name|'d'
op|'['
name|'p'
op|'+'
string|'"active"'
op|']'
op|'='
name|'len'
op|'('
name|'l'
op|')'
op|'>'
number|'1'
newline|'\n'
name|'d'
op|'['
name|'p'
op|'+'
string|'"list"'
op|']'
op|'='
name|'l'
newline|'\n'
comment|'# Update v'
nl|'\n'
name|'v'
op|'.'
name|'update'
op|'('
name|'d'
op|')'
newline|'\n'
name|'return'
string|'""'
newline|'\n'
nl|'\n'
comment|'#----------------------------------------------------------'
nl|'\n'
comment|'# QWeb Simple Controller'
nl|'\n'
comment|'#----------------------------------------------------------'
nl|'\n'
DECL|function|qweb_control
dedent|''
dedent|''
name|'def'
name|'qweb_control'
op|'('
name|'self'
op|','
name|'jump'
op|'='
string|"'main'"
op|','
name|'p'
op|'='
op|'['
op|']'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'""" qweb_control(self,jump=\'main\',p=[]):\n    A simple function to handle the controler part of your application. It\n    dispatch the control to the jump argument, while ensuring that prefix\n    function have been called.\n\n    qweb_control replace \'/\' to \'_\' and strip \'_\' from the jump argument.\n\n    name1\n    name1_name2\n    name1_name2_name3\n\n    """'
newline|'\n'
name|'jump'
op|'='
name|'jump'
op|'.'
name|'replace'
op|'('
string|"'/'"
op|','
string|"'_'"
op|')'
op|'.'
name|'strip'
op|'('
string|"'_'"
op|')'
newline|'\n'
name|'if'
name|'not'
name|'hasattr'
op|'('
name|'self'
op|','
name|'jump'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
number|'0'
newline|'\n'
dedent|''
name|'done'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'todo'
op|'='
op|'['
op|']'
newline|'\n'
name|'while'
number|'1'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'jump'
op|'!='
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'tmp'
op|'='
string|'""'
newline|'\n'
name|'todo'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'jump'
op|'.'
name|'split'
op|'('
string|'"_"'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'tmp'
op|'+='
name|'i'
op|'+'
string|'"_"'
op|';'
newline|'\n'
name|'if'
name|'not'
name|'done'
op|'.'
name|'has_key'
op|'('
name|'tmp'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'todo'
op|'.'
name|'append'
op|'('
name|'tmp'
op|'['
op|':'
op|'-'
number|'1'
op|']'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'jump'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'elif'
name|'len'
op|'('
name|'todo'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'i'
op|'='
name|'todo'
op|'.'
name|'pop'
op|'('
number|'0'
op|')'
newline|'\n'
name|'done'
op|'['
name|'i'
op|']'
op|'='
number|'1'
newline|'\n'
name|'if'
name|'hasattr'
op|'('
name|'self'
op|','
name|'i'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'f'
op|'='
name|'getattr'
op|'('
name|'self'
op|','
name|'i'
op|')'
newline|'\n'
name|'r'
op|'='
name|'f'
op|'('
op|'*'
name|'p'
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'r'
op|','
name|'types'
op|'.'
name|'StringType'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'jump'
op|'='
name|'r'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'break'
newline|'\n'
dedent|''
dedent|''
name|'return'
number|'1'
newline|'\n'
nl|'\n'
comment|'#----------------------------------------------------------'
nl|'\n'
comment|'# QWeb WSGI Request handler'
nl|'\n'
comment|'#----------------------------------------------------------'
nl|'\n'
DECL|class|QWebSession
dedent|''
name|'class'
name|'QWebSession'
op|'('
name|'dict'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'environ'
op|','
op|'**'
name|'kw'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'dict'
op|'.'
name|'__init__'
op|'('
name|'self'
op|')'
newline|'\n'
name|'default'
op|'='
op|'{'
nl|'\n'
string|'"path"'
op|':'
name|'tempfile'
op|'.'
name|'gettempdir'
op|'('
op|')'
op|','
nl|'\n'
string|'"cookie_name"'
op|':'
string|'"QWEBSID"'
op|','
nl|'\n'
string|'"cookie_lifetime"'
op|':'
number|'0'
op|','
nl|'\n'
string|'"cookie_path"'
op|':'
string|"'/'"
op|','
nl|'\n'
string|'"cookie_domain"'
op|':'
string|"''"
op|','
nl|'\n'
string|'"limit_cache"'
op|':'
number|'1'
op|','
nl|'\n'
string|'"probability"'
op|':'
number|'0.01'
op|','
nl|'\n'
string|'"maxlifetime"'
op|':'
number|'3600'
op|','
nl|'\n'
string|'"disable"'
op|':'
number|'0'
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'default'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'setattr'
op|'('
name|'self'
op|','
string|"'session_%s'"
op|'%'
name|'k'
op|','
name|'kw'
op|'.'
name|'get'
op|'('
name|'k'
op|','
name|'v'
op|')'
op|')'
newline|'\n'
comment|'# Try to find session'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'session_found_cookie'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'session_found_url'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'session_found'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'session_orig'
op|'='
string|'""'
newline|'\n'
comment|'# Try cookie'
nl|'\n'
name|'c'
op|'='
name|'Cookie'
op|'.'
name|'SimpleCookie'
op|'('
op|')'
newline|'\n'
name|'c'
op|'.'
name|'load'
op|'('
name|'environ'
op|'.'
name|'get'
op|'('
string|"'HTTP_COOKIE'"
op|','
string|"''"
op|')'
op|')'
newline|'\n'
name|'if'
name|'c'
op|'.'
name|'has_key'
op|'('
name|'self'
op|'.'
name|'session_cookie_name'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'sid'
op|'='
name|'c'
op|'['
name|'self'
op|'.'
name|'session_cookie_name'
op|']'
op|'.'
name|'value'
op|'['
op|':'
number|'64'
op|']'
newline|'\n'
name|'if'
name|'re'
op|'.'
name|'match'
op|'('
string|"'[a-f0-9]+$'"
op|','
name|'sid'
op|')'
name|'and'
name|'self'
op|'.'
name|'session_load'
op|'('
name|'sid'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'session_id'
op|'='
name|'sid'
newline|'\n'
name|'self'
op|'.'
name|'session_found_cookie'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'session_found'
op|'='
number|'1'
newline|'\n'
comment|'# Try URL'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'not'
name|'self'
op|'.'
name|'session_found_cookie'
op|':'
newline|'\n'
indent|'            '
name|'mo'
op|'='
name|'re'
op|'.'
name|'search'
op|'('
string|"'&%s=([a-f0-9]+)'"
op|'%'
name|'self'
op|'.'
name|'session_cookie_name'
op|','
name|'environ'
op|'.'
name|'get'
op|'('
string|"'QUERY_STRING'"
op|','
string|"''"
op|')'
op|')'
newline|'\n'
name|'if'
name|'mo'
name|'and'
name|'self'
op|'.'
name|'session_load'
op|'('
name|'mo'
op|'.'
name|'group'
op|'('
number|'1'
op|')'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'session_id'
op|'='
name|'mo'
op|'.'
name|'group'
op|'('
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'session_found_url'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'session_found'
op|'='
number|'1'
newline|'\n'
comment|'# New session'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'not'
name|'self'
op|'.'
name|'session_found'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'session_id'
op|'='
string|"'%032x'"
op|'%'
name|'random'
op|'.'
name|'randint'
op|'('
number|'1'
op|','
number|'2'
op|'**'
number|'128'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'session_trans_sid'
op|'='
string|'"&amp;%s=%s"'
op|'%'
op|'('
name|'self'
op|'.'
name|'session_cookie_name'
op|','
name|'self'
op|'.'
name|'session_id'
op|')'
newline|'\n'
comment|'# Clean old session'
nl|'\n'
name|'if'
name|'random'
op|'.'
name|'random'
op|'('
op|')'
op|'<'
name|'self'
op|'.'
name|'session_probability'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'session_clean'
op|'('
op|')'
newline|'\n'
DECL|member|session_get_headers
dedent|''
dedent|''
name|'def'
name|'session_get_headers'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'h'
op|'='
op|'['
op|']'
newline|'\n'
name|'if'
op|'('
name|'not'
name|'self'
op|'.'
name|'session_disable'
op|')'
name|'and'
op|'('
name|'len'
op|'('
name|'self'
op|')'
name|'or'
name|'len'
op|'('
name|'self'
op|'.'
name|'session_orig'
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'session_save'
op|'('
op|')'
newline|'\n'
name|'if'
name|'not'
name|'self'
op|'.'
name|'session_found_cookie'
op|':'
newline|'\n'
indent|'                '
name|'c'
op|'='
name|'Cookie'
op|'.'
name|'SimpleCookie'
op|'('
op|')'
newline|'\n'
name|'c'
op|'['
name|'self'
op|'.'
name|'session_cookie_name'
op|']'
op|'='
name|'self'
op|'.'
name|'session_id'
newline|'\n'
name|'c'
op|'['
name|'self'
op|'.'
name|'session_cookie_name'
op|']'
op|'['
string|"'path'"
op|']'
op|'='
name|'self'
op|'.'
name|'session_cookie_path'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'session_cookie_domain'
op|':'
newline|'\n'
indent|'                    '
name|'c'
op|'['
name|'self'
op|'.'
name|'session_cookie_name'
op|']'
op|'['
string|"'domain'"
op|']'
op|'='
name|'self'
op|'.'
name|'session_cookie_domain'
newline|'\n'
comment|'#               if self.session_cookie_lifetime:'
nl|'\n'
comment|"#                   c[self.session_cookie_name]['expires'] = TODO date localtime or not, datetime.datetime(1970, 1, 1)"
nl|'\n'
dedent|''
name|'h'
op|'.'
name|'append'
op|'('
op|'('
string|'"Set-Cookie"'
op|','
name|'c'
op|'['
name|'self'
op|'.'
name|'session_cookie_name'
op|']'
op|'.'
name|'OutputString'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'self'
op|'.'
name|'session_limit_cache'
op|':'
newline|'\n'
indent|'                '
name|'h'
op|'.'
name|'append'
op|'('
op|'('
string|"'Cache-Control'"
op|','
string|"'no-store, no-cache, must-revalidate, post-check=0, pre-check=0'"
op|')'
op|')'
newline|'\n'
name|'h'
op|'.'
name|'append'
op|'('
op|'('
string|"'Expires'"
op|','
string|"'Thu, 19 Nov 1981 08:52:00 GMT'"
op|')'
op|')'
newline|'\n'
name|'h'
op|'.'
name|'append'
op|'('
op|'('
string|"'Pragma'"
op|','
string|"'no-cache'"
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'h'
newline|'\n'
DECL|member|session_load
dedent|''
name|'def'
name|'session_load'
op|'('
name|'self'
op|','
name|'sid'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'fname'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'session_path'
op|','
string|"'qweb_sess_%s'"
op|'%'
name|'sid'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'orig'
op|'='
name|'file'
op|'('
name|'fname'
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'d'
op|'='
name|'pickle'
op|'.'
name|'loads'
op|'('
name|'orig'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'            '
name|'return'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'session_orig'
op|'='
name|'orig'
newline|'\n'
name|'self'
op|'.'
name|'update'
op|'('
name|'d'
op|')'
newline|'\n'
name|'return'
number|'1'
newline|'\n'
DECL|member|session_save
dedent|''
name|'def'
name|'session_save'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'self'
op|'.'
name|'session_path'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'self'
op|'.'
name|'session_path'
op|')'
newline|'\n'
dedent|''
name|'fname'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'session_path'
op|','
string|"'qweb_sess_%s'"
op|'%'
name|'self'
op|'.'
name|'session_id'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'oldtime'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'getmtime'
op|'('
name|'fname'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'OSError'
op|','
name|'IOError'
op|':'
newline|'\n'
indent|'            '
name|'oldtime'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'dump'
op|'='
name|'pickle'
op|'.'
name|'dumps'
op|'('
name|'self'
op|'.'
name|'copy'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
op|'('
name|'dump'
op|'!='
name|'self'
op|'.'
name|'session_orig'
op|')'
name|'or'
op|'('
name|'time'
op|'.'
name|'time'
op|'('
op|')'
op|'>'
name|'oldtime'
op|'+'
name|'self'
op|'.'
name|'session_maxlifetime'
op|'/'
number|'4'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'tmpname'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'session_path'
op|','
string|"'qweb_sess_%s_%x'"
op|'%'
op|'('
name|'self'
op|'.'
name|'session_id'
op|','
name|'random'
op|'.'
name|'randint'
op|'('
number|'1'
op|','
number|'2'
op|'**'
number|'32'
op|')'
op|')'
op|')'
newline|'\n'
name|'f'
op|'='
name|'file'
op|'('
name|'tmpname'
op|','
string|"'wb'"
op|')'
newline|'\n'
name|'f'
op|'.'
name|'write'
op|'('
name|'dump'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'if'
name|'sys'
op|'.'
name|'platform'
op|'=='
string|"'win32'"
name|'and'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isfile'
op|'('
name|'fname'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'os'
op|'.'
name|'remove'
op|'('
name|'fname'
op|')'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'rename'
op|'('
name|'tmpname'
op|','
name|'fname'
op|')'
newline|'\n'
DECL|member|session_clean
dedent|''
dedent|''
name|'def'
name|'session_clean'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'t'
op|'='
name|'time'
op|'.'
name|'time'
op|'('
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'for'
name|'i'
name|'in'
op|'['
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'session_path'
op|','
name|'i'
op|')'
name|'for'
name|'i'
name|'in'
name|'os'
op|'.'
name|'listdir'
op|'('
name|'self'
op|'.'
name|'session_path'
op|')'
name|'if'
name|'i'
op|'.'
name|'startswith'
op|'('
string|"'qweb_sess_'"
op|')'
op|']'
op|':'
newline|'\n'
indent|'                '
name|'if'
op|'('
name|'t'
op|'>'
name|'os'
op|'.'
name|'path'
op|'.'
name|'getmtime'
op|'('
name|'i'
op|')'
op|'+'
name|'self'
op|'.'
name|'session_maxlifetime'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'os'
op|'.'
name|'unlink'
op|'('
name|'i'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'except'
name|'OSError'
op|','
name|'IOError'
op|':'
newline|'\n'
indent|'            '
name|'pass'
newline|'\n'
DECL|class|QWebSessionMem
dedent|''
dedent|''
dedent|''
name|'class'
name|'QWebSessionMem'
op|'('
name|'QWebSession'
op|')'
op|':'
newline|'\n'
DECL|member|session_load
indent|'    '
name|'def'
name|'session_load'
op|'('
name|'self'
op|','
name|'sid'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'_qweb_sessions'
newline|'\n'
name|'if'
name|'not'
string|'"_qweb_sessions"'
name|'in'
name|'globals'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'_qweb_sessions'
op|'='
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'if'
name|'_qweb_sessions'
op|'.'
name|'has_key'
op|'('
name|'sid'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'session_orig'
op|'='
name|'_qweb_sessions'
op|'['
name|'sid'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'update'
op|'('
name|'self'
op|'.'
name|'session_orig'
op|')'
newline|'\n'
name|'return'
number|'1'
newline|'\n'
DECL|member|session_save
dedent|''
dedent|''
name|'def'
name|'session_save'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'global'
name|'_qweb_sessions'
newline|'\n'
name|'if'
name|'not'
string|'"_qweb_sessions"'
name|'in'
name|'globals'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'_qweb_sessions'
op|'='
op|'{'
op|'}'
newline|'\n'
dedent|''
name|'_qweb_sessions'
op|'['
name|'self'
op|'.'
name|'session_id'
op|']'
op|'='
name|'self'
op|'.'
name|'copy'
op|'('
op|')'
newline|'\n'
DECL|class|QWebSessionService
dedent|''
dedent|''
name|'class'
name|'QWebSessionService'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'wsgiapp'
op|','
name|'url_rewrite'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'wsgiapp'
op|'='
name|'wsgiapp'
newline|'\n'
name|'self'
op|'.'
name|'url_rewrite_tags'
op|'='
string|'"a=href,area=href,frame=src,form=,fieldset="'
newline|'\n'
DECL|member|__call__
dedent|''
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'environ'
op|','
name|'start_response'
op|')'
op|':'
newline|'\n'
comment|'# TODO'
nl|'\n'
comment|'# use QWebSession to provide environ["qweb.session"]'
nl|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'wsgiapp'
op|'('
name|'environ'
op|','
name|'start_response'
op|')'
newline|'\n'
DECL|class|QWebDict
dedent|''
dedent|''
name|'class'
name|'QWebDict'
op|'('
name|'dict'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'p'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'dict'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'p'
op|')'
newline|'\n'
DECL|member|__getitem__
dedent|''
name|'def'
name|'__getitem__'
op|'('
name|'self'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'get'
op|'('
name|'key'
op|','
string|'""'
op|')'
newline|'\n'
DECL|member|int
dedent|''
name|'def'
name|'int'
op|'('
name|'self'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'int'
op|'('
name|'self'
op|'.'
name|'get'
op|'('
name|'key'
op|','
string|'"0"'
op|')'
op|')'
newline|'\n'
dedent|''
name|'except'
name|'ValueError'
op|':'
newline|'\n'
indent|'            '
name|'return'
number|'0'
newline|'\n'
DECL|class|QWebListDict
dedent|''
dedent|''
dedent|''
name|'class'
name|'QWebListDict'
op|'('
name|'dict'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'    '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'p'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'dict'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
op|'*'
name|'p'
op|')'
newline|'\n'
DECL|member|__getitem__
dedent|''
name|'def'
name|'__getitem__'
op|'('
name|'self'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'get'
op|'('
name|'key'
op|','
op|'['
op|']'
op|')'
newline|'\n'
DECL|member|appendlist
dedent|''
name|'def'
name|'appendlist'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'val'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'has_key'
op|'('
name|'key'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'['
name|'key'
op|']'
op|'.'
name|'append'
op|'('
name|'val'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'['
name|'key'
op|']'
op|'='
op|'['
name|'val'
op|']'
newline|'\n'
DECL|member|get_qwebdict
dedent|''
dedent|''
name|'def'
name|'get_qwebdict'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'d'
op|'='
name|'QWebDict'
op|'('
op|')'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'self'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'d'
op|'['
name|'k'
op|']'
op|'='
name|'v'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
dedent|''
name|'return'
name|'d'
newline|'\n'
DECL|class|QWebRequest
dedent|''
dedent|''
name|'class'
name|'QWebRequest'
op|':'
newline|'\n'
indent|'    '
string|'"""QWebRequest a WSGI request handler.\n\n    QWebRequest is a WSGI request handler that feature GET, POST and POST\n    multipart methods, handles cookies and headers and provide a dict-like\n    SESSION Object (either on the filesystem or in memory).\n\n    It is constructed with the environ and start_response WSGI arguments:\n    \n      req=qweb.QWebRequest(environ, start_response)\n    \n    req has the folowing attributes :\n    \n      req.environ standard WSGI dict (CGI and wsgi ones)\n    \n    Some CGI vars as attributes from environ for convenience: \n    \n      req.SCRIPT_NAME\n      req.PATH_INFO\n      req.REQUEST_URI\n    \n    Some computed value (also for convenience)\n    \n      req.FULL_URL full URL recontructed (http://host/query)\n      req.FULL_PATH (URL path before ?querystring)\n    \n    Dict constructed from querystring and POST datas, PHP-like.\n    \n      req.GET contains GET vars\n      req.POST contains POST vars\n      req.REQUEST contains merge of GET and POST\n      req.FILES contains uploaded files\n      req.GET_LIST req.POST_LIST req.REQUEST_LIST req.FILES_LIST multiple arguments versions\n      req.debug() returns an HTML dump of those vars\n    \n    A dict-like session object.\n    \n      req.SESSION the session start when the dict is not empty.\n    \n    Attribute for handling the response\n    \n      req.response_headers dict-like to set headers\n      req.response_cookies a SimpleCookie to set cookies\n      req.response_status a string to set the status like \'200 OK\'\n    \n      req.write() to write to the buffer\n    \n    req itselfs is an iterable object with the buffer, it will also also call\n    start_response automatically before returning anything via the iterator.\n    \n    To make it short, it means that you may use\n    \n      return req\n    \n    at the end of your request handling to return the reponse to any WSGI\n    application server.\n    """'
newline|'\n'
comment|'#'
nl|'\n'
comment|'# This class contains part ripped from colubrid (with the permission of'
nl|'\n'
comment|'# mitsuhiko) see http://wsgiarea.pocoo.org/colubrid/'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# - the class HttpHeaders'
nl|'\n'
comment|'# - the method load_post_data (tuned version)'
nl|'\n'
comment|'#'
nl|'\n'
DECL|class|HttpHeaders
name|'class'
name|'HttpHeaders'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|member|__init__
indent|'        '
name|'def'
name|'__init__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'data'
op|'='
op|'['
op|'('
string|"'Content-Type'"
op|','
string|"'text/html'"
op|')'
op|']'
newline|'\n'
DECL|member|__setitem__
dedent|''
name|'def'
name|'__setitem__'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'set'
op|'('
name|'key'
op|','
name|'value'
op|')'
newline|'\n'
DECL|member|__delitem__
dedent|''
name|'def'
name|'__delitem__'
op|'('
name|'self'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'remove'
op|'('
name|'key'
op|')'
newline|'\n'
DECL|member|__contains__
dedent|''
name|'def'
name|'__contains__'
op|'('
name|'self'
op|','
name|'key'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'key'
op|'='
name|'key'
op|'.'
name|'lower'
op|'('
op|')'
newline|'\n'
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'self'
op|'.'
name|'data'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'k'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
name|'key'
op|':'
newline|'\n'
indent|'                    '
name|'return'
name|'True'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'False'
newline|'\n'
DECL|member|add
dedent|''
name|'def'
name|'add'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'data'
op|'.'
name|'append'
op|'('
op|'('
name|'key'
op|','
name|'value'
op|')'
op|')'
newline|'\n'
DECL|member|remove
dedent|''
name|'def'
name|'remove'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'count'
op|'='
op|'-'
number|'1'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'removed'
op|'='
number|'0'
newline|'\n'
name|'data'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'_key'
op|','
name|'_value'
name|'in'
name|'self'
op|'.'
name|'data'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'_key'
op|'.'
name|'lower'
op|'('
op|')'
op|'!='
name|'key'
op|'.'
name|'lower'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'count'
op|'>'
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'                        '
name|'if'
name|'removed'
op|'>='
name|'count'
op|':'
newline|'\n'
indent|'                            '
name|'break'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                            '
name|'removed'
op|'+='
number|'1'
newline|'\n'
dedent|''
dedent|''
name|'data'
op|'.'
name|'append'
op|'('
op|'('
name|'_key'
op|','
name|'_value'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'data'
op|'='
name|'data'
newline|'\n'
DECL|member|clear
dedent|''
name|'def'
name|'clear'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'data'
op|'='
op|'['
op|']'
newline|'\n'
DECL|member|set
dedent|''
name|'def'
name|'set'
op|'('
name|'self'
op|','
name|'key'
op|','
name|'value'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'remove'
op|'('
name|'key'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'add'
op|'('
name|'key'
op|','
name|'value'
op|')'
newline|'\n'
DECL|member|get
dedent|''
name|'def'
name|'get'
op|'('
name|'self'
op|','
name|'key'
op|'='
name|'False'
op|','
name|'httpformat'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'key'
op|':'
newline|'\n'
indent|'                '
name|'result'
op|'='
name|'self'
op|'.'
name|'data'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'result'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'_key'
op|','
name|'_value'
name|'in'
name|'self'
op|'.'
name|'data'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'_key'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
name|'key'
op|'.'
name|'lower'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'result'
op|'.'
name|'append'
op|'('
op|'('
name|'_key'
op|','
name|'_value'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'httpformat'
op|':'
newline|'\n'
indent|'                '
name|'return'
string|"'\\n'"
op|'.'
name|'join'
op|'('
op|'['
string|"'%s: %s'"
op|'%'
name|'item'
name|'for'
name|'item'
name|'in'
name|'result'
op|']'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'result'
newline|'\n'
DECL|member|load_post_data
dedent|''
dedent|''
name|'def'
name|'load_post_data'
op|'('
name|'self'
op|','
name|'environ'
op|','
name|'POST'
op|','
name|'FILES'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'length'
op|'='
name|'int'
op|'('
name|'environ'
op|'['
string|"'CONTENT_LENGTH'"
op|']'
op|')'
newline|'\n'
name|'DATA'
op|'='
name|'environ'
op|'['
string|"'wsgi.input'"
op|']'
op|'.'
name|'read'
op|'('
name|'length'
op|')'
newline|'\n'
name|'if'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'CONTENT_TYPE'"
op|','
string|"''"
op|')'
op|'.'
name|'startswith'
op|'('
string|"'multipart'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'lines'
op|'='
op|'['
string|"'Content-Type: %s'"
op|'%'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'CONTENT_TYPE'"
op|','
string|"''"
op|')'
op|']'
newline|'\n'
name|'for'
name|'key'
op|','
name|'value'
name|'in'
name|'environ'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'key'
op|'.'
name|'startswith'
op|'('
string|"'HTTP_'"
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'lines'
op|'.'
name|'append'
op|'('
string|"'%s: %s'"
op|'%'
op|'('
name|'key'
op|','
name|'value'
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'raw'
op|'='
string|"'\\r\\n'"
op|'.'
name|'join'
op|'('
name|'lines'
op|')'
op|'+'
string|"'\\r\\n\\r\\n'"
op|'+'
name|'DATA'
newline|'\n'
name|'msg'
op|'='
name|'email'
op|'.'
name|'message_from_string'
op|'('
name|'raw'
op|')'
newline|'\n'
name|'for'
name|'sub'
name|'in'
name|'msg'
op|'.'
name|'get_payload'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'not'
name|'isinstance'
op|'('
name|'sub'
op|','
name|'email'
op|'.'
name|'Message'
op|'.'
name|'Message'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'continue'
newline|'\n'
dedent|''
name|'name_dict'
op|'='
name|'cgi'
op|'.'
name|'parse_header'
op|'('
name|'sub'
op|'['
string|"'Content-Disposition'"
op|']'
op|')'
op|'['
number|'1'
op|']'
newline|'\n'
name|'if'
string|"'filename'"
name|'in'
name|'name_dict'
op|':'
newline|'\n'
comment|"# Nested MIME Messages are not supported'"
nl|'\n'
indent|'                    '
name|'if'
name|'type'
op|'('
op|'['
op|']'
op|')'
op|'=='
name|'type'
op|'('
name|'sub'
op|'.'
name|'get_payload'
op|'('
op|')'
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'continue'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'name_dict'
op|'['
string|"'filename'"
op|']'
op|'.'
name|'strip'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'continue'
newline|'\n'
dedent|''
name|'filename'
op|'='
name|'name_dict'
op|'['
string|"'filename'"
op|']'
newline|'\n'
comment|"# why not keep all the filename? because IE always send 'C:\\documents and settings\\blub\\blub.png'"
nl|'\n'
name|'filename'
op|'='
name|'filename'
op|'['
name|'filename'
op|'.'
name|'rfind'
op|'('
string|"'\\\\'"
op|')'
op|'+'
number|'1'
op|':'
op|']'
newline|'\n'
name|'if'
string|"'Content-Type'"
name|'in'
name|'sub'
op|':'
newline|'\n'
indent|'                        '
name|'content_type'
op|'='
name|'sub'
op|'['
string|"'Content-Type'"
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                        '
name|'content_type'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'s'
op|'='
op|'{'
string|'"name"'
op|':'
name|'filename'
op|','
string|'"type"'
op|':'
name|'content_type'
op|','
string|'"data"'
op|':'
name|'sub'
op|'.'
name|'get_payload'
op|'('
op|')'
op|'}'
newline|'\n'
name|'FILES'
op|'.'
name|'appendlist'
op|'('
name|'name_dict'
op|'['
string|"'name'"
op|']'
op|','
name|'s'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                    '
name|'POST'
op|'.'
name|'appendlist'
op|'('
name|'name_dict'
op|'['
string|"'name'"
op|']'
op|','
name|'sub'
op|'.'
name|'get_payload'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'POST'
op|'.'
name|'update'
op|'('
name|'cgi'
op|'.'
name|'parse_qs'
op|'('
name|'DATA'
op|','
name|'keep_blank_values'
op|'='
number|'1'
op|')'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'DATA'
newline|'\n'
nl|'\n'
DECL|member|__init__
dedent|''
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'environ'
op|','
name|'start_response'
op|','
name|'session'
op|'='
name|'QWebSession'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'environ'
op|'='
name|'environ'
newline|'\n'
name|'self'
op|'.'
name|'start_response'
op|'='
name|'start_response'
newline|'\n'
name|'self'
op|'.'
name|'buffer'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'SCRIPT_NAME'
op|'='
name|'environ'
op|'.'
name|'get'
op|'('
string|"'SCRIPT_NAME'"
op|','
string|"''"
op|')'
newline|'\n'
name|'self'
op|'.'
name|'PATH_INFO'
op|'='
name|'environ'
op|'.'
name|'get'
op|'('
string|"'PATH_INFO'"
op|','
string|"''"
op|')'
newline|'\n'
comment|'# extensions:'
nl|'\n'
name|'self'
op|'.'
name|'FULL_URL'
op|'='
name|'environ'
op|'['
string|"'FULL_URL'"
op|']'
op|'='
name|'self'
op|'.'
name|'get_full_url'
op|'('
name|'environ'
op|')'
newline|'\n'
comment|'# REQUEST_URI is optional, fake it if absent'
nl|'\n'
name|'if'
name|'not'
name|'environ'
op|'.'
name|'has_key'
op|'('
string|'"REQUEST_URI"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'environ'
op|'['
string|'"REQUEST_URI"'
op|']'
op|'='
name|'urllib'
op|'.'
name|'quote'
op|'('
name|'self'
op|'.'
name|'SCRIPT_NAME'
op|'+'
name|'self'
op|'.'
name|'PATH_INFO'
op|')'
newline|'\n'
name|'if'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'QUERY_STRING'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'environ'
op|'['
string|'"REQUEST_URI"'
op|']'
op|'+='
string|"'?'"
op|'+'
name|'environ'
op|'['
string|"'QUERY_STRING'"
op|']'
newline|'\n'
dedent|''
dedent|''
name|'self'
op|'.'
name|'REQUEST_URI'
op|'='
name|'environ'
op|'['
string|'"REQUEST_URI"'
op|']'
newline|'\n'
comment|'# full quote url path before the ?'
nl|'\n'
name|'self'
op|'.'
name|'FULL_PATH'
op|'='
name|'environ'
op|'['
string|"'FULL_PATH'"
op|']'
op|'='
name|'self'
op|'.'
name|'REQUEST_URI'
op|'.'
name|'split'
op|'('
string|"'?'"
op|')'
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'request_cookies'
op|'='
name|'Cookie'
op|'.'
name|'SimpleCookie'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'request_cookies'
op|'.'
name|'load'
op|'('
name|'environ'
op|'.'
name|'get'
op|'('
string|"'HTTP_COOKIE'"
op|','
string|"''"
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'response_started'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'response_gzencode'
op|'='
name|'False'
newline|'\n'
name|'self'
op|'.'
name|'response_cookies'
op|'='
name|'Cookie'
op|'.'
name|'SimpleCookie'
op|'('
op|')'
newline|'\n'
comment|"# to delete a cookie use: c[key]['expires'] = datetime.datetime(1970, 1, 1)"
nl|'\n'
name|'self'
op|'.'
name|'response_headers'
op|'='
name|'self'
op|'.'
name|'HttpHeaders'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'response_status'
op|'='
string|'"200 OK"'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'php'
op|'='
name|'None'
newline|'\n'
name|'if'
name|'self'
op|'.'
name|'environ'
op|'.'
name|'has_key'
op|'('
string|'"php"'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'php'
op|'='
name|'environ'
op|'['
string|'"php"'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'SESSION'
op|'='
name|'self'
op|'.'
name|'php'
op|'.'
name|'_SESSION'
newline|'\n'
name|'self'
op|'.'
name|'GET'
op|'='
name|'self'
op|'.'
name|'php'
op|'.'
name|'_GET'
newline|'\n'
name|'self'
op|'.'
name|'POST'
op|'='
name|'self'
op|'.'
name|'php'
op|'.'
name|'_POST'
newline|'\n'
name|'self'
op|'.'
name|'REQUEST'
op|'='
name|'self'
op|'.'
name|'php'
op|'.'
name|'_ARG'
newline|'\n'
name|'self'
op|'.'
name|'FILES'
op|'='
name|'self'
op|'.'
name|'php'
op|'.'
name|'_FILES'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'isinstance'
op|'('
name|'session'
op|','
name|'QWebSession'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'SESSION'
op|'='
name|'session'
newline|'\n'
dedent|''
name|'elif'
name|'session'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'SESSION'
op|'='
name|'session'
op|'('
name|'environ'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'SESSION'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'GET_LIST'
op|'='
name|'QWebListDict'
op|'('
name|'cgi'
op|'.'
name|'parse_qs'
op|'('
name|'environ'
op|'.'
name|'get'
op|'('
string|"'QUERY_STRING'"
op|','
string|"''"
op|')'
op|','
name|'keep_blank_values'
op|'='
number|'1'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'POST_LIST'
op|'='
name|'QWebListDict'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'FILES_LIST'
op|'='
name|'QWebListDict'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'REQUEST_LIST'
op|'='
name|'QWebListDict'
op|'('
name|'self'
op|'.'
name|'GET_LIST'
op|')'
newline|'\n'
name|'if'
name|'environ'
op|'['
string|"'REQUEST_METHOD'"
op|']'
op|'=='
string|"'POST'"
op|':'
newline|'\n'
indent|'                '
name|'self'
op|'.'
name|'DATA'
op|'='
name|'self'
op|'.'
name|'load_post_data'
op|'('
name|'environ'
op|','
name|'self'
op|'.'
name|'POST_LIST'
op|','
name|'self'
op|'.'
name|'FILES_LIST'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'REQUEST_LIST'
op|'.'
name|'update'
op|'('
name|'self'
op|'.'
name|'POST_LIST'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'GET'
op|'='
name|'self'
op|'.'
name|'GET_LIST'
op|'.'
name|'get_qwebdict'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'POST'
op|'='
name|'self'
op|'.'
name|'POST_LIST'
op|'.'
name|'get_qwebdict'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'FILES'
op|'='
name|'self'
op|'.'
name|'FILES_LIST'
op|'.'
name|'get_qwebdict'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'REQUEST'
op|'='
name|'self'
op|'.'
name|'REQUEST_LIST'
op|'.'
name|'get_qwebdict'
op|'('
op|')'
newline|'\n'
DECL|member|get_full_url
dedent|''
dedent|''
name|'def'
name|'get_full_url'
op|'('
name|'environ'
op|')'
op|':'
newline|'\n'
comment|'# taken from PEP 333'
nl|'\n'
indent|'        '
name|'if'
string|"'FULL_URL'"
name|'in'
name|'environ'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'environ'
op|'['
string|"'FULL_URL'"
op|']'
newline|'\n'
dedent|''
name|'url'
op|'='
name|'environ'
op|'['
string|"'wsgi.url_scheme'"
op|']'
op|'+'
string|"'://'"
newline|'\n'
name|'if'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'HTTP_HOST'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'url'
op|'+='
name|'environ'
op|'['
string|"'HTTP_HOST'"
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'url'
op|'+='
name|'environ'
op|'['
string|"'SERVER_NAME'"
op|']'
newline|'\n'
name|'if'
name|'environ'
op|'['
string|"'wsgi.url_scheme'"
op|']'
op|'=='
string|"'https'"
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'environ'
op|'['
string|"'SERVER_PORT'"
op|']'
op|'!='
string|"'443'"
op|':'
newline|'\n'
indent|'                    '
name|'url'
op|'+='
string|"':'"
op|'+'
name|'environ'
op|'['
string|"'SERVER_PORT'"
op|']'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'environ'
op|'['
string|"'SERVER_PORT'"
op|']'
op|'!='
string|"'80'"
op|':'
newline|'\n'
indent|'                    '
name|'url'
op|'+='
string|"':'"
op|'+'
name|'environ'
op|'['
string|"'SERVER_PORT'"
op|']'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'environ'
op|'.'
name|'has_key'
op|'('
string|"'REQUEST_URI'"
op|')'
op|':'
newline|'\n'
indent|'            '
name|'url'
op|'+='
name|'environ'
op|'['
string|"'REQUEST_URI'"
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'url'
op|'+='
name|'urllib'
op|'.'
name|'quote'
op|'('
name|'environ'
op|'.'
name|'get'
op|'('
string|"'SCRIPT_NAME'"
op|','
string|"''"
op|')'
op|')'
newline|'\n'
name|'url'
op|'+='
name|'urllib'
op|'.'
name|'quote'
op|'('
name|'environ'
op|'.'
name|'get'
op|'('
string|"'PATH_INFO'"
op|','
string|"''"
op|')'
op|')'
newline|'\n'
name|'if'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'QUERY_STRING'"
op|')'
op|':'
newline|'\n'
indent|'                '
name|'url'
op|'+='
string|"'?'"
op|'+'
name|'environ'
op|'['
string|"'QUERY_STRING'"
op|']'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'url'
newline|'\n'
DECL|variable|get_full_url
dedent|''
name|'get_full_url'
op|'='
name|'staticmethod'
op|'('
name|'get_full_url'
op|')'
newline|'\n'
DECL|member|save_files
name|'def'
name|'save_files'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'self'
op|'.'
name|'FILES'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'v'
op|'.'
name|'has_key'
op|'('
string|'"tmp_file"'
op|')'
op|':'
newline|'\n'
indent|'                '
name|'f'
op|'='
name|'tempfile'
op|'.'
name|'NamedTemporaryFile'
op|'('
op|')'
newline|'\n'
name|'f'
op|'.'
name|'write'
op|'('
name|'v'
op|'['
string|'"data"'
op|']'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'flush'
op|'('
op|')'
newline|'\n'
name|'v'
op|'['
string|'"tmp_file"'
op|']'
op|'='
name|'f'
newline|'\n'
name|'v'
op|'['
string|'"tmp_name"'
op|']'
op|'='
name|'f'
op|'.'
name|'name'
newline|'\n'
DECL|member|debug
dedent|''
dedent|''
dedent|''
name|'def'
name|'debug'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'body'
op|'='
string|"''"
newline|'\n'
name|'for'
name|'name'
op|','
name|'d'
name|'in'
op|'['
nl|'\n'
op|'('
string|'"GET"'
op|','
name|'self'
op|'.'
name|'GET'
op|')'
op|','
op|'('
string|'"POST"'
op|','
name|'self'
op|'.'
name|'POST'
op|')'
op|','
op|'('
string|'"REQUEST"'
op|','
name|'self'
op|'.'
name|'REQUEST'
op|')'
op|','
op|'('
string|'"FILES"'
op|','
name|'self'
op|'.'
name|'FILES'
op|')'
op|','
nl|'\n'
op|'('
string|'"GET_LIST"'
op|','
name|'self'
op|'.'
name|'GET_LIST'
op|')'
op|','
op|'('
string|'"POST_LIST"'
op|','
name|'self'
op|'.'
name|'POST_LIST'
op|')'
op|','
op|'('
string|'"REQUEST_LIST"'
op|','
name|'self'
op|'.'
name|'REQUEST_LIST'
op|')'
op|','
op|'('
string|'"FILES_LIST"'
op|','
name|'self'
op|'.'
name|'FILES_LIST'
op|')'
op|','
nl|'\n'
op|'('
string|'"SESSION"'
op|','
name|'self'
op|'.'
name|'SESSION'
op|')'
op|','
op|'('
string|'"environ"'
op|','
name|'self'
op|'.'
name|'environ'
op|')'
op|','
nl|'\n'
op|']'
op|':'
newline|'\n'
indent|'            '
name|'body'
op|'+='
string|'\'<table border="1" width="100%" align="center">\\n\''
newline|'\n'
name|'body'
op|'+='
string|'\'<tr><th colspan="2" align="center">%s</th></tr>\\n\''
op|'%'
name|'name'
newline|'\n'
name|'keys'
op|'='
name|'d'
op|'.'
name|'keys'
op|'('
op|')'
newline|'\n'
name|'keys'
op|'.'
name|'sort'
op|'('
op|')'
newline|'\n'
name|'body'
op|'+='
string|"''"
op|'.'
name|'join'
op|'('
op|'['
string|"'<tr><td>%s</td><td>%s</td></tr>\\n'"
op|'%'
op|'('
name|'k'
op|','
name|'cgi'
op|'.'
name|'escape'
op|'('
name|'repr'
op|'('
name|'d'
op|'['
name|'k'
op|']'
op|')'
op|')'
op|')'
name|'for'
name|'k'
name|'in'
name|'keys'
op|']'
op|')'
newline|'\n'
name|'body'
op|'+='
string|"'</table><br><br>\\n\\n'"
newline|'\n'
dedent|''
name|'return'
name|'body'
newline|'\n'
DECL|member|write
dedent|''
name|'def'
name|'write'
op|'('
name|'self'
op|','
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'buffer'
op|'.'
name|'append'
op|'('
name|'s'
op|')'
newline|'\n'
DECL|member|echo
dedent|''
name|'def'
name|'echo'
op|'('
name|'self'
op|','
op|'*'
name|'s'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'buffer'
op|'.'
name|'extend'
op|'('
op|'['
name|'str'
op|'('
name|'i'
op|')'
name|'for'
name|'i'
name|'in'
name|'s'
op|']'
op|')'
newline|'\n'
DECL|member|response
dedent|''
name|'def'
name|'response'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'self'
op|'.'
name|'response_started'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'self'
op|'.'
name|'php'
op|':'
newline|'\n'
indent|'                '
name|'for'
name|'k'
op|','
name|'v'
name|'in'
name|'self'
op|'.'
name|'FILES'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'v'
op|'.'
name|'has_key'
op|'('
string|'"tmp_file"'
op|')'
op|':'
newline|'\n'
indent|'                        '
name|'try'
op|':'
newline|'\n'
indent|'                            '
name|'v'
op|'['
string|'"tmp_file"'
op|']'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'OSError'
op|':'
newline|'\n'
indent|'                            '
name|'pass'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'self'
op|'.'
name|'response_gzencode'
name|'and'
name|'self'
op|'.'
name|'environ'
op|'.'
name|'get'
op|'('
string|"'HTTP_ACCEPT_ENCODING'"
op|','
string|"''"
op|')'
op|'.'
name|'find'
op|'('
string|"'gzip'"
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'                    '
name|'zbuf'
op|'='
name|'StringIO'
op|'.'
name|'StringIO'
op|'('
op|')'
newline|'\n'
name|'zfile'
op|'='
name|'gzip'
op|'.'
name|'GzipFile'
op|'('
name|'mode'
op|'='
string|"'wb'"
op|','
name|'fileobj'
op|'='
name|'zbuf'
op|')'
newline|'\n'
name|'zfile'
op|'.'
name|'write'
op|'('
string|"''"
op|'.'
name|'join'
op|'('
name|'self'
op|'.'
name|'buffer'
op|')'
op|')'
newline|'\n'
name|'zfile'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'zbuf'
op|'='
name|'zbuf'
op|'.'
name|'getvalue'
op|'('
op|')'
newline|'\n'
name|'self'
op|'.'
name|'buffer'
op|'='
op|'['
name|'zbuf'
op|']'
newline|'\n'
name|'self'
op|'.'
name|'response_headers'
op|'['
string|"'Content-Encoding'"
op|']'
op|'='
string|'"gzip"'
newline|'\n'
name|'self'
op|'.'
name|'response_headers'
op|'['
string|"'Content-Length'"
op|']'
op|'='
name|'str'
op|'('
name|'len'
op|'('
name|'zbuf'
op|')'
op|')'
newline|'\n'
dedent|''
name|'headers'
op|'='
name|'self'
op|'.'
name|'response_headers'
op|'.'
name|'get'
op|'('
op|')'
newline|'\n'
name|'if'
name|'isinstance'
op|'('
name|'self'
op|'.'
name|'SESSION'
op|','
name|'QWebSession'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'headers'
op|'.'
name|'extend'
op|'('
name|'self'
op|'.'
name|'SESSION'
op|'.'
name|'session_get_headers'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'headers'
op|'.'
name|'extend'
op|'('
op|'['
op|'('
string|"'Set-Cookie'"
op|','
name|'self'
op|'.'
name|'response_cookies'
op|'['
name|'i'
op|']'
op|'.'
name|'OutputString'
op|'('
op|')'
op|')'
name|'for'
name|'i'
name|'in'
name|'self'
op|'.'
name|'response_cookies'
op|']'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'start_response'
op|'('
name|'self'
op|'.'
name|'response_status'
op|','
name|'headers'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'response_started'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'return'
name|'self'
op|'.'
name|'buffer'
newline|'\n'
DECL|member|__iter__
dedent|''
name|'def'
name|'__iter__'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'response'
op|'('
op|')'
op|'.'
name|'__iter__'
op|'('
op|')'
newline|'\n'
DECL|member|http_redirect
dedent|''
name|'def'
name|'http_redirect'
op|'('
name|'self'
op|','
name|'url'
op|','
name|'permanent'
op|'='
number|'1'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'permanent'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'response_status'
op|'='
string|'"301 Moved Permanently"'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'response_status'
op|'='
string|'"302 Found"'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'response_headers'
op|'['
string|'"Location"'
op|']'
op|'='
name|'url'
newline|'\n'
DECL|member|http_404
dedent|''
name|'def'
name|'http_404'
op|'('
name|'self'
op|','
name|'msg'
op|'='
string|'"<h1>404 Not Found</h1>"'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'response_status'
op|'='
string|'"404 Not Found"'
newline|'\n'
name|'if'
name|'msg'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'write'
op|'('
name|'msg'
op|')'
newline|'\n'
DECL|member|http_download
dedent|''
dedent|''
name|'def'
name|'http_download'
op|'('
name|'self'
op|','
name|'fname'
op|','
name|'fstr'
op|','
name|'partial'
op|'='
number|'0'
op|')'
op|':'
newline|'\n'
comment|'#       allow fstr to be a file-like object'
nl|'\n'
comment|'#       if parital:'
nl|'\n'
comment|'#           say accept ranages'
nl|'\n'
comment|'#           parse range headers...'
nl|'\n'
comment|'#           if range:'
nl|'\n'
comment|'#               header("HTTP/1.1 206 Partial Content");'
nl|'\n'
comment|'#               header("Content-Range: bytes $offset-".($fsize-1)."/".$fsize);'
nl|'\n'
comment|'#               header("Content-Length: ".($fsize-$offset));'
nl|'\n'
comment|'#               fseek($fd,$offset);'
nl|'\n'
comment|'#           else:'
nl|'\n'
indent|'        '
name|'self'
op|'.'
name|'response_headers'
op|'['
string|'"Content-Type"'
op|']'
op|'='
string|'"application/octet-stream"'
newline|'\n'
name|'self'
op|'.'
name|'response_headers'
op|'['
string|'"Content-Disposition"'
op|']'
op|'='
string|'"attachment; filename=\\"%s\\""'
op|'%'
name|'fname'
newline|'\n'
name|'self'
op|'.'
name|'response_headers'
op|'['
string|'"Content-Transfer-Encoding"'
op|']'
op|'='
string|'"binary"'
newline|'\n'
name|'self'
op|'.'
name|'response_headers'
op|'['
string|'"Content-Length"'
op|']'
op|'='
string|'"%d"'
op|'%'
name|'len'
op|'('
name|'fstr'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'write'
op|'('
name|'fstr'
op|')'
newline|'\n'
nl|'\n'
comment|'#----------------------------------------------------------'
nl|'\n'
comment|'# QWeb WSGI HTTP Server to run any WSGI app'
nl|'\n'
comment|'# autorun, run an app as FCGI or CGI otherwise launch the server'
nl|'\n'
comment|'#----------------------------------------------------------'
nl|'\n'
DECL|class|QWebWSGIHandler
dedent|''
dedent|''
name|'class'
name|'QWebWSGIHandler'
op|'('
name|'BaseHTTPServer'
op|'.'
name|'BaseHTTPRequestHandler'
op|')'
op|':'
newline|'\n'
DECL|member|log_message
indent|'    '
name|'def'
name|'log_message'
op|'('
name|'self'
op|','
op|'*'
name|'p'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'server'
op|'.'
name|'log'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'BaseHTTPServer'
op|'.'
name|'BaseHTTPRequestHandler'
op|'.'
name|'log_message'
op|'('
name|'self'
op|','
op|'*'
name|'p'
op|')'
newline|'\n'
DECL|member|address_string
dedent|''
dedent|''
name|'def'
name|'address_string'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'self'
op|'.'
name|'client_address'
op|'['
number|'0'
op|']'
newline|'\n'
DECL|member|start_response
dedent|''
name|'def'
name|'start_response'
op|'('
name|'self'
op|','
name|'status'
op|','
name|'headers'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'l'
op|'='
name|'status'
op|'.'
name|'split'
op|'('
string|"' '"
op|','
number|'1'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'send_response'
op|'('
name|'int'
op|'('
name|'l'
op|'['
number|'0'
op|']'
op|')'
op|','
name|'l'
op|'['
number|'1'
op|']'
op|')'
newline|'\n'
name|'ctype_sent'
op|'='
number|'0'
newline|'\n'
name|'for'
name|'i'
name|'in'
name|'headers'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'i'
op|'['
number|'0'
op|']'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|'"content-type"'
op|':'
newline|'\n'
indent|'                '
name|'ctype_sent'
op|'='
number|'1'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'send_header'
op|'('
op|'*'
name|'i'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'ctype_sent'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'send_header'
op|'('
string|'"Content-type"'
op|','
string|'"text/html"'
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'end_headers'
op|'('
op|')'
newline|'\n'
name|'return'
name|'self'
op|'.'
name|'write'
newline|'\n'
DECL|member|write
dedent|''
name|'def'
name|'write'
op|'('
name|'self'
op|','
name|'data'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'wfile'
op|'.'
name|'write'
op|'('
name|'data'
op|')'
newline|'\n'
dedent|''
name|'except'
op|'('
name|'socket'
op|'.'
name|'error'
op|','
name|'socket'
op|'.'
name|'timeout'
op|')'
op|','
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'print'
name|'e'
newline|'\n'
DECL|member|bufferon
dedent|''
dedent|''
name|'def'
name|'bufferon'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'getattr'
op|'('
name|'self'
op|','
string|"'wfile_buf'"
op|','
number|'0'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'wfile_buf'
op|'='
number|'1'
newline|'\n'
name|'self'
op|'.'
name|'wfile_bak'
op|'='
name|'self'
op|'.'
name|'wfile'
newline|'\n'
name|'self'
op|'.'
name|'wfile'
op|'='
name|'StringIO'
op|'.'
name|'StringIO'
op|'('
op|')'
newline|'\n'
DECL|member|bufferoff
dedent|''
dedent|''
name|'def'
name|'bufferoff'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'wfile_buf'
op|':'
newline|'\n'
indent|'            '
name|'buf'
op|'='
name|'self'
op|'.'
name|'wfile'
newline|'\n'
name|'self'
op|'.'
name|'wfile'
op|'='
name|'self'
op|'.'
name|'wfile_bak'
newline|'\n'
name|'self'
op|'.'
name|'write'
op|'('
name|'buf'
op|'.'
name|'getvalue'
op|'('
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'wfile_buf'
op|'='
number|'0'
newline|'\n'
DECL|member|serve
dedent|''
dedent|''
name|'def'
name|'serve'
op|'('
name|'self'
op|','
name|'type'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'path_info'
op|','
name|'parameters'
op|','
name|'query'
op|'='
name|'urlparse'
op|'.'
name|'urlparse'
op|'('
name|'self'
op|'.'
name|'path'
op|')'
op|'['
number|'2'
op|':'
number|'5'
op|']'
newline|'\n'
name|'environ'
op|'='
op|'{'
nl|'\n'
string|"'wsgi.version'"
op|':'
op|'('
number|'1'
op|','
number|'0'
op|')'
op|','
nl|'\n'
string|"'wsgi.url_scheme'"
op|':'
string|"'http'"
op|','
nl|'\n'
string|"'wsgi.input'"
op|':'
name|'self'
op|'.'
name|'rfile'
op|','
nl|'\n'
string|"'wsgi.errors'"
op|':'
name|'sys'
op|'.'
name|'stderr'
op|','
nl|'\n'
string|"'wsgi.multithread'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'wsgi.multiprocess'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'wsgi.run_once'"
op|':'
number|'0'
op|','
nl|'\n'
string|"'REQUEST_METHOD'"
op|':'
name|'self'
op|'.'
name|'command'
op|','
nl|'\n'
string|"'SCRIPT_NAME'"
op|':'
string|"''"
op|','
nl|'\n'
string|"'QUERY_STRING'"
op|':'
name|'query'
op|','
nl|'\n'
string|"'CONTENT_TYPE'"
op|':'
name|'self'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Content-Type'"
op|','
string|"''"
op|')'
op|','
nl|'\n'
string|"'CONTENT_LENGTH'"
op|':'
name|'self'
op|'.'
name|'headers'
op|'.'
name|'get'
op|'('
string|"'Content-Length'"
op|','
string|"''"
op|')'
op|','
nl|'\n'
string|"'REMOTE_ADDR'"
op|':'
name|'self'
op|'.'
name|'client_address'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
string|"'REMOTE_PORT'"
op|':'
name|'str'
op|'('
name|'self'
op|'.'
name|'client_address'
op|'['
number|'1'
op|']'
op|')'
op|','
nl|'\n'
string|"'SERVER_NAME'"
op|':'
name|'self'
op|'.'
name|'server'
op|'.'
name|'server_address'
op|'['
number|'0'
op|']'
op|','
nl|'\n'
string|"'SERVER_PORT'"
op|':'
name|'str'
op|'('
name|'self'
op|'.'
name|'server'
op|'.'
name|'server_address'
op|'['
number|'1'
op|']'
op|')'
op|','
nl|'\n'
string|"'SERVER_PROTOCOL'"
op|':'
name|'self'
op|'.'
name|'request_version'
op|','
nl|'\n'
comment|'# extention'
nl|'\n'
string|"'FULL_PATH'"
op|':'
name|'self'
op|'.'
name|'path'
op|','
nl|'\n'
string|"'qweb.mode'"
op|':'
string|"'standalone'"
op|','
nl|'\n'
op|'}'
newline|'\n'
name|'if'
name|'path_info'
op|':'
newline|'\n'
indent|'            '
name|'environ'
op|'['
string|"'PATH_INFO'"
op|']'
op|'='
name|'urllib'
op|'.'
name|'unquote'
op|'('
name|'path_info'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'key'
op|','
name|'value'
name|'in'
name|'self'
op|'.'
name|'headers'
op|'.'
name|'items'
op|'('
op|')'
op|':'
newline|'\n'
indent|'            '
name|'environ'
op|'['
string|"'HTTP_'"
op|'+'
name|'key'
op|'.'
name|'upper'
op|'('
op|')'
op|'.'
name|'replace'
op|'('
string|"'-'"
op|','
string|"'_'"
op|')'
op|']'
op|'='
name|'value'
newline|'\n'
comment|'# Hack to avoid may TCP packets'
nl|'\n'
dedent|''
name|'self'
op|'.'
name|'bufferon'
op|'('
op|')'
newline|'\n'
name|'appiter'
op|'='
name|'self'
op|'.'
name|'server'
op|'.'
name|'wsgiapp'
op|'('
name|'environ'
op|','
name|'self'
op|'.'
name|'start_response'
op|')'
newline|'\n'
name|'for'
name|'data'
name|'in'
name|'appiter'
op|':'
newline|'\n'
indent|'            '
name|'self'
op|'.'
name|'write'
op|'('
name|'data'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'bufferoff'
op|'('
op|')'
newline|'\n'
dedent|''
name|'self'
op|'.'
name|'bufferoff'
op|'('
op|')'
newline|'\n'
DECL|member|do_GET
dedent|''
name|'def'
name|'do_GET'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'serve'
op|'('
string|"'GET'"
op|')'
newline|'\n'
DECL|member|do_POST
dedent|''
name|'def'
name|'do_POST'
op|'('
name|'self'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'serve'
op|'('
string|"'GET'"
op|')'
newline|'\n'
DECL|class|QWebWSGIServer
dedent|''
dedent|''
name|'class'
name|'QWebWSGIServer'
op|'('
name|'SocketServer'
op|'.'
name|'ThreadingMixIn'
op|','
name|'BaseHTTPServer'
op|'.'
name|'HTTPServer'
op|')'
op|':'
newline|'\n'
indent|'    '
string|'""" QWebWSGIServer\n        qweb_wsgi_autorun(wsgiapp,ip=\'127.0.0.1\',port=8080,threaded=1)\n        A WSGI HTTP server threaded or not and a function to automatically run your\n        app according to the environement (either standalone, CGI or FastCGI).\n\n        This feature is called QWeb autorun. If you want to  To use it on your\n        application use the following lines at the end of the main application\n        python file:\n\n        if __name__ == \'__main__\':\n            qweb.qweb_wsgi_autorun(your_wsgi_app)\n\n        this function will select the approriate running mode according to the\n        calling environement (http-server, FastCGI or CGI).\n    """'
newline|'\n'
DECL|member|__init__
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'wsgiapp'
op|','
name|'ip'
op|','
name|'port'
op|','
name|'threaded'
op|'='
number|'1'
op|','
name|'log'
op|'='
number|'1'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'BaseHTTPServer'
op|'.'
name|'HTTPServer'
op|'.'
name|'__init__'
op|'('
name|'self'
op|','
op|'('
name|'ip'
op|','
name|'port'
op|')'
op|','
name|'QWebWSGIHandler'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'wsgiapp'
op|'='
name|'wsgiapp'
newline|'\n'
name|'self'
op|'.'
name|'threaded'
op|'='
name|'threaded'
newline|'\n'
name|'self'
op|'.'
name|'log'
op|'='
name|'log'
newline|'\n'
DECL|member|process_request
dedent|''
name|'def'
name|'process_request'
op|'('
name|'self'
op|','
op|'*'
name|'p'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'self'
op|'.'
name|'threaded'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'SocketServer'
op|'.'
name|'ThreadingMixIn'
op|'.'
name|'process_request'
op|'('
name|'self'
op|','
op|'*'
name|'p'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'            '
name|'return'
name|'BaseHTTPServer'
op|'.'
name|'HTTPServer'
op|'.'
name|'process_request'
op|'('
name|'self'
op|','
op|'*'
name|'p'
op|')'
newline|'\n'
DECL|function|qweb_wsgi_autorun
dedent|''
dedent|''
dedent|''
name|'def'
name|'qweb_wsgi_autorun'
op|'('
name|'wsgiapp'
op|','
name|'ip'
op|'='
string|"'127.0.0.1'"
op|','
name|'port'
op|'='
number|'8080'
op|','
name|'threaded'
op|'='
number|'1'
op|','
name|'log'
op|'='
number|'1'
op|','
name|'callback_ready'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'sys'
op|'.'
name|'platform'
op|'=='
string|"'win32'"
op|':'
newline|'\n'
indent|'        '
name|'fcgi'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'fcgi'
op|'='
number|'1'
newline|'\n'
name|'sock'
op|'='
name|'socket'
op|'.'
name|'fromfd'
op|'('
number|'0'
op|','
name|'socket'
op|'.'
name|'AF_INET'
op|','
name|'socket'
op|'.'
name|'SOCK_STREAM'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'sock'
op|'.'
name|'getpeername'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'socket'
op|'.'
name|'error'
op|','
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'e'
op|'['
number|'0'
op|']'
op|'=='
name|'errno'
op|'.'
name|'ENOTSOCK'
op|':'
newline|'\n'
indent|'                '
name|'fcgi'
op|'='
number|'0'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'fcgi'
name|'or'
name|'os'
op|'.'
name|'environ'
op|'.'
name|'has_key'
op|'('
string|"'REQUEST_METHOD'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'import'
name|'fcgi'
newline|'\n'
name|'fcgi'
op|'.'
name|'WSGIServer'
op|'('
name|'wsgiapp'
op|','
name|'multithreaded'
op|'='
name|'False'
op|')'
op|'.'
name|'run'
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'log'
op|':'
newline|'\n'
indent|'            '
name|'print'
string|"'Serving on %s:%d'"
op|'%'
op|'('
name|'ip'
op|','
name|'port'
op|')'
newline|'\n'
dedent|''
name|'s'
op|'='
name|'QWebWSGIServer'
op|'('
name|'wsgiapp'
op|','
name|'ip'
op|'='
name|'ip'
op|','
name|'port'
op|'='
name|'port'
op|','
name|'threaded'
op|'='
name|'threaded'
op|','
name|'log'
op|'='
name|'log'
op|')'
newline|'\n'
name|'if'
name|'callback_ready'
op|':'
newline|'\n'
indent|'            '
name|'callback_ready'
op|'('
op|')'
newline|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'            '
name|'s'
op|'.'
name|'serve_forever'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'KeyboardInterrupt'
op|','
name|'e'
op|':'
newline|'\n'
indent|'            '
name|'sys'
op|'.'
name|'excepthook'
op|'('
op|'*'
name|'sys'
op|'.'
name|'exc_info'
op|'('
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'#----------------------------------------------------------'
nl|'\n'
comment|'# Qweb Documentation'
nl|'\n'
comment|'#----------------------------------------------------------'
nl|'\n'
DECL|function|qweb_doc
dedent|''
dedent|''
dedent|''
name|'def'
name|'qweb_doc'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'body'
op|'='
name|'__doc__'
newline|'\n'
name|'for'
name|'i'
name|'in'
op|'['
name|'QWebXml'
op|','
name|'QWebHtml'
op|','
name|'QWebForm'
op|','
name|'QWebURL'
op|','
name|'qweb_control'
op|','
name|'QWebRequest'
op|','
name|'QWebSession'
op|','
name|'QWebWSGIServer'
op|','
name|'qweb_wsgi_autorun'
op|']'
op|':'
newline|'\n'
indent|'        '
name|'n'
op|'='
name|'i'
op|'.'
name|'__name__'
newline|'\n'
name|'d'
op|'='
name|'i'
op|'.'
name|'__doc__'
newline|'\n'
name|'body'
op|'+='
string|"'\\n\\n%s\\n%s\\n\\n%s'"
op|'%'
op|'('
name|'n'
op|','
string|"'-'"
op|'*'
name|'len'
op|'('
name|'n'
op|')'
op|','
name|'d'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'body'
newline|'\n'
nl|'\n'
name|'print'
name|'qweb_doc'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'#'
nl|'\n'
dedent|''
endmarker|''
end_unit
